var eB=Object.defineProperty;var tB=(t,e,n)=>e in t?eB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var U=(t,e,n)=>tB(t,typeof e!="symbol"?e+"":e,n);function nB(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var rf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jm={exports:{}},Bl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u3;function rB(){if(u3)return Bl;u3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return Bl.Fragment=e,Bl.jsx=n,Bl.jsxs=n,Bl}var f3;function iB(){return f3||(f3=1,jm.exports=rB()),jm.exports}var p=iB(),Lm={exports:{}},Ul={},Bm={exports:{}},Um={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var d3;function sB(){return d3||(d3=1,function(t){function e($,Q){var oe=$.length;$.push(Q);e:for(;0<oe;){var K=oe-1>>>1,L=$[K];if(0<i(L,Q))$[K]=Q,$[oe]=L,oe=K;else break e}}function n($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var Q=$[0],oe=$.pop();if(oe!==Q){$[0]=oe;e:for(var K=0,L=$.length,W=L>>>1;K<W;){var fe=2*(K+1)-1,se=$[fe],z=fe+1,X=$[z];if(0>i(se,oe))z<L&&0>i(X,se)?($[K]=X,$[z]=oe,K=z):($[K]=se,$[fe]=oe,K=fe);else if(z<L&&0>i(X,oe))$[K]=X,$[z]=oe,K=z;else break e}}return Q}function i($,Q){var oe=$.sortIndex-Q.sortIndex;return oe!==0?oe:$.id-Q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var u=[],d=[],h=1,g=null,_=3,x=!1,w=!1,S=!1,b=!1,T=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E($){for(var Q=n(d);Q!==null;){if(Q.callback===null)r(d);else if(Q.startTime<=$)r(d),Q.sortIndex=Q.expirationTime,e(u,Q);else break;Q=n(d)}}function C($){if(S=!1,E($),!w)if(n(u)!==null)w=!0,O||(O=!0,V());else{var Q=n(d);Q!==null&&Y(C,Q.startTime-$)}}var O=!1,P=-1,k=5,I=-1;function N(){return b?!0:!(t.unstable_now()-I<k)}function B(){if(b=!1,O){var $=t.unstable_now();I=$;var Q=!0;try{e:{w=!1,S&&(S=!1,A(P),P=-1),x=!0;var oe=_;try{t:{for(E($),g=n(u);g!==null&&!(g.expirationTime>$&&N());){var K=g.callback;if(typeof K=="function"){g.callback=null,_=g.priorityLevel;var L=K(g.expirationTime<=$);if($=t.unstable_now(),typeof L=="function"){g.callback=L,E($),Q=!0;break t}g===n(u)&&r(u),E($)}else r(u);g=n(u)}if(g!==null)Q=!0;else{var W=n(d);W!==null&&Y(C,W.startTime-$),Q=!1}}break e}finally{g=null,_=oe,x=!1}Q=void 0}}finally{Q?V():O=!1}}}var V;if(typeof R=="function")V=function(){R(B)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,j=Z.port2;Z.port1.onmessage=B,V=function(){j.postMessage(null)}}else V=function(){T(B,0)};function Y($,Q){P=T(function(){$(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function($){switch(_){case 1:case 2:case 3:var Q=3;break;default:Q=_}var oe=_;_=Q;try{return $()}finally{_=oe}},t.unstable_requestPaint=function(){b=!0},t.unstable_runWithPriority=function($,Q){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var oe=_;_=$;try{return Q()}finally{_=oe}},t.unstable_scheduleCallback=function($,Q,oe){var K=t.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?K+oe:K):oe=K,$){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=oe+L,$={id:h++,callback:Q,priorityLevel:$,startTime:oe,expirationTime:L,sortIndex:-1},oe>K?($.sortIndex=oe,e(d,$),n(u)===null&&$===n(d)&&(S?(A(P),P=-1):S=!0,Y(C,oe-K))):($.sortIndex=L,e(u,$),w||x||(w=!0,O||(O=!0,V()))),$},t.unstable_shouldYield=N,t.unstable_wrapCallback=function($){var Q=_;return function(){var oe=_;_=Q;try{return $.apply(this,arguments)}finally{_=oe}}}}(Um)),Um}var h3;function aB(){return h3||(h3=1,Bm.exports=sB()),Bm.exports}var Fm={exports:{}},Fe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p3;function oB(){if(p3)return Fe;p3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.iterator;function _(L){return L===null||typeof L!="object"?null:(L=g&&L[g]||L["@@iterator"],typeof L=="function"?L:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,S={};function b(L,W,fe){this.props=L,this.context=W,this.refs=S,this.updater=fe||x}b.prototype.isReactComponent={},b.prototype.setState=function(L,W){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,W,"setState")},b.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function T(){}T.prototype=b.prototype;function A(L,W,fe){this.props=L,this.context=W,this.refs=S,this.updater=fe||x}var R=A.prototype=new T;R.constructor=A,w(R,b.prototype),R.isPureReactComponent=!0;var E=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function P(L,W,fe,se,z,X){return fe=X.ref,{$$typeof:t,type:L,key:W,ref:fe!==void 0?fe:null,props:X}}function k(L,W){return P(L.type,W,void 0,void 0,void 0,L.props)}function I(L){return typeof L=="object"&&L!==null&&L.$$typeof===t}function N(L){var W={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(fe){return W[fe]})}var B=/\/+/g;function V(L,W){return typeof L=="object"&&L!==null&&L.key!=null?N(""+L.key):W.toString(36)}function Z(){}function j(L){switch(L.status){case"fulfilled":return L.value;case"rejected":throw L.reason;default:switch(typeof L.status=="string"?L.then(Z,Z):(L.status="pending",L.then(function(W){L.status==="pending"&&(L.status="fulfilled",L.value=W)},function(W){L.status==="pending"&&(L.status="rejected",L.reason=W)})),L.status){case"fulfilled":return L.value;case"rejected":throw L.reason}}throw L}function Y(L,W,fe,se,z){var X=typeof L;(X==="undefined"||X==="boolean")&&(L=null);var J=!1;if(L===null)J=!0;else switch(X){case"bigint":case"string":case"number":J=!0;break;case"object":switch(L.$$typeof){case t:case e:J=!0;break;case h:return J=L._init,Y(J(L._payload),W,fe,se,z)}}if(J)return z=z(L),J=se===""?"."+V(L,0):se,E(z)?(fe="",J!=null&&(fe=J.replace(B,"$&/")+"/"),Y(z,W,fe,"",function(Ae){return Ae})):z!=null&&(I(z)&&(z=k(z,fe+(z.key==null||L&&L.key===z.key?"":(""+z.key).replace(B,"$&/")+"/")+J)),W.push(z)),1;J=0;var pe=se===""?".":se+":";if(E(L))for(var xe=0;xe<L.length;xe++)se=L[xe],X=pe+V(se,xe),J+=Y(se,W,fe,X,z);else if(xe=_(L),typeof xe=="function")for(L=xe.call(L),xe=0;!(se=L.next()).done;)se=se.value,X=pe+V(se,xe++),J+=Y(se,W,fe,X,z);else if(X==="object"){if(typeof L.then=="function")return Y(j(L),W,fe,se,z);throw W=String(L),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return J}function $(L,W,fe){if(L==null)return L;var se=[],z=0;return Y(L,se,"","",function(X){return W.call(fe,X,z++)}),se}function Q(L){if(L._status===-1){var W=L._result;W=W(),W.then(function(fe){(L._status===0||L._status===-1)&&(L._status=1,L._result=fe)},function(fe){(L._status===0||L._status===-1)&&(L._status=2,L._result=fe)}),L._status===-1&&(L._status=0,L._result=W)}if(L._status===1)return L._result.default;throw L._result}var oe=typeof reportError=="function"?reportError:function(L){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof L=="object"&&L!==null&&typeof L.message=="string"?String(L.message):String(L),error:L});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",L);return}console.error(L)};function K(){}return Fe.Children={map:$,forEach:function(L,W,fe){$(L,function(){W.apply(this,arguments)},fe)},count:function(L){var W=0;return $(L,function(){W++}),W},toArray:function(L){return $(L,function(W){return W})||[]},only:function(L){if(!I(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Fe.Component=b,Fe.Fragment=n,Fe.Profiler=i,Fe.PureComponent=A,Fe.StrictMode=r,Fe.Suspense=u,Fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Fe.__COMPILER_RUNTIME={__proto__:null,c:function(L){return C.H.useMemoCache(L)}},Fe.cache=function(L){return function(){return L.apply(null,arguments)}},Fe.cloneElement=function(L,W,fe){if(L==null)throw Error("The argument must be a React element, but you passed "+L+".");var se=w({},L.props),z=L.key,X=void 0;if(W!=null)for(J in W.ref!==void 0&&(X=void 0),W.key!==void 0&&(z=""+W.key),W)!O.call(W,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&W.ref===void 0||(se[J]=W[J]);var J=arguments.length-2;if(J===1)se.children=fe;else if(1<J){for(var pe=Array(J),xe=0;xe<J;xe++)pe[xe]=arguments[xe+2];se.children=pe}return P(L.type,z,void 0,void 0,X,se)},Fe.createContext=function(L){return L={$$typeof:o,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null},L.Provider=L,L.Consumer={$$typeof:s,_context:L},L},Fe.createElement=function(L,W,fe){var se,z={},X=null;if(W!=null)for(se in W.key!==void 0&&(X=""+W.key),W)O.call(W,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(z[se]=W[se]);var J=arguments.length-2;if(J===1)z.children=fe;else if(1<J){for(var pe=Array(J),xe=0;xe<J;xe++)pe[xe]=arguments[xe+2];z.children=pe}if(L&&L.defaultProps)for(se in J=L.defaultProps,J)z[se]===void 0&&(z[se]=J[se]);return P(L,X,void 0,void 0,null,z)},Fe.createRef=function(){return{current:null}},Fe.forwardRef=function(L){return{$$typeof:l,render:L}},Fe.isValidElement=I,Fe.lazy=function(L){return{$$typeof:h,_payload:{_status:-1,_result:L},_init:Q}},Fe.memo=function(L,W){return{$$typeof:d,type:L,compare:W===void 0?null:W}},Fe.startTransition=function(L){var W=C.T,fe={};C.T=fe;try{var se=L(),z=C.S;z!==null&&z(fe,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(K,oe)}catch(X){oe(X)}finally{C.T=W}},Fe.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},Fe.use=function(L){return C.H.use(L)},Fe.useActionState=function(L,W,fe){return C.H.useActionState(L,W,fe)},Fe.useCallback=function(L,W){return C.H.useCallback(L,W)},Fe.useContext=function(L){return C.H.useContext(L)},Fe.useDebugValue=function(){},Fe.useDeferredValue=function(L,W){return C.H.useDeferredValue(L,W)},Fe.useEffect=function(L,W,fe){var se=C.H;if(typeof fe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return se.useEffect(L,W)},Fe.useId=function(){return C.H.useId()},Fe.useImperativeHandle=function(L,W,fe){return C.H.useImperativeHandle(L,W,fe)},Fe.useInsertionEffect=function(L,W){return C.H.useInsertionEffect(L,W)},Fe.useLayoutEffect=function(L,W){return C.H.useLayoutEffect(L,W)},Fe.useMemo=function(L,W){return C.H.useMemo(L,W)},Fe.useOptimistic=function(L,W){return C.H.useOptimistic(L,W)},Fe.useReducer=function(L,W,fe){return C.H.useReducer(L,W,fe)},Fe.useRef=function(L){return C.H.useRef(L)},Fe.useState=function(L){return C.H.useState(L)},Fe.useSyncExternalStore=function(L,W,fe){return C.H.useSyncExternalStore(L,W,fe)},Fe.useTransition=function(){return C.H.useTransition()},Fe.version="19.1.0",Fe}var m3;function c1(){return m3||(m3=1,Fm.exports=oB()),Fm.exports}var zm={exports:{}},vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g3;function lB(){if(g3)return vn;g3=1;var t=c1();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:d,implementation:h}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,vn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},vn.flushSync=function(u){var d=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=d,r.p=h,r.d.f()}},vn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},vn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},vn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,x=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:x}):h==="script"&&r.d.X(u,{crossOrigin:g,integrity:_,fetchPriority:x,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},vn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},vn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin);r.d.L(u,h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},vn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},vn.requestFormReset=function(u){r.d.r(u)},vn.unstable_batchedUpdates=function(u,d){return u(d)},vn.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},vn.useFormStatus=function(){return o.H.useHostTransitionStatus()},vn.version="19.1.0",vn}var _3;function KM(){if(_3)return zm.exports;_3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),zm.exports=lB(),zm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v3;function cB(){if(v3)return Ul;v3=1;var t=aB(),e=c1(),n=KM();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,m=c;;){var v=f.return;if(v===null)break;var y=v.alternate;if(y===null){if(m=v.return,m!==null){f=m;continue}break}if(v.child===y.child){for(y=v.child;y;){if(y===f)return l(v),a;if(y===m)return l(v),c;y=y.sibling}throw Error(r(188))}if(f.return!==m.return)f=v,m=y;else{for(var M=!1,F=v.child;F;){if(F===f){M=!0,f=v,m=y;break}if(F===m){M=!0,m=v,f=y;break}F=F.sibling}if(!M){for(F=y.child;F;){if(F===f){M=!0,f=y,m=v;break}if(F===m){M=!0,m=y,f=v;break}F=F.sibling}if(!M)throw Error(r(189))}}if(f.alternate!==m)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function d(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=d(a),c!==null)return c;a=a.sibling}return null}var h=Object.assign,g=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function V(a){return a===null||typeof a!="object"?null:(a=B&&a[B]||a["@@iterator"],typeof a=="function"?a:null)}var Z=Symbol.for("react.client.reference");function j(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case w:return"Fragment";case b:return"Profiler";case S:return"StrictMode";case C:return"Suspense";case O:return"SuspenseList";case I:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case x:return"Portal";case R:return(a.displayName||"Context")+".Provider";case A:return(a._context.displayName||"Context")+".Consumer";case E:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case P:return c=a.displayName||null,c!==null?c:j(a.type)||"Memo";case k:c=a._payload,a=a._init;try{return j(a(c))}catch{}}return null}var Y=Array.isArray,$=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},K=[],L=-1;function W(a){return{current:a}}function fe(a){0>L||(a.current=K[L],K[L]=null,L--)}function se(a,c){L++,K[L]=a.current,a.current=c}var z=W(null),X=W(null),J=W(null),pe=W(null);function xe(a,c){switch(se(J,c),se(X,a),se(z,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?BT(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=BT(c),a=UT(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}fe(z),se(z,a)}function Ae(){fe(z),fe(X),fe(J)}function Ne(a){a.memoizedState!==null&&se(pe,a);var c=z.current,f=UT(c,a.type);c!==f&&(se(X,a),se(z,f))}function be(a){X.current===a&&(fe(z),fe(X)),pe.current===a&&(fe(pe),Ol._currentValue=oe)}var we=Object.prototype.hasOwnProperty,ke=t.unstable_scheduleCallback,Xe=t.unstable_cancelCallback,Le=t.unstable_shouldYield,Kt=t.unstable_requestPaint,Ie=t.unstable_now,nn=t.unstable_getCurrentPriorityLevel,ot=t.unstable_ImmediatePriority,pt=t.unstable_UserBlockingPriority,Mt=t.unstable_NormalPriority,rn=t.unstable_LowPriority,Ge=t.unstable_IdlePriority,Se=t.log,Me=t.unstable_setDisableYieldValue,nt=null,qe=null;function Ze(a){if(typeof Se=="function"&&Me(a),qe&&typeof qe.setStrictMode=="function")try{qe.setStrictMode(nt,a)}catch{}}var yt=Math.clz32?Math.clz32:br,mn=Math.log,ei=Math.LN2;function br(a){return a>>>=0,a===0?32:31-(mn(a)/ei|0)|0}var Ft=256,zt=4194304;function kn(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function wr(a,c,f){var m=a.pendingLanes;if(m===0)return 0;var v=0,y=a.suspendedLanes,M=a.pingedLanes;a=a.warmLanes;var F=m&134217727;return F!==0?(m=F&~y,m!==0?v=kn(m):(M&=F,M!==0?v=kn(M):f||(f=F&~a,f!==0&&(v=kn(f))))):(F=m&~y,F!==0?v=kn(F):M!==0?v=kn(M):f||(f=m&~a,f!==0&&(v=kn(f)))),v===0?0:c!==0&&c!==v&&(c&y)===0&&(y=v&-v,f=c&-c,y>=f||y===32&&(f&4194048)!==0)?c:v}function Jn(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function Te(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lt(){var a=Ft;return Ft<<=1,(Ft&4194048)===0&&(Ft=256),a}function Ct(){var a=zt;return zt<<=1,(zt&62914560)===0&&(zt=4194304),a}function rt(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function wt(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function ma(a,c,f,m,v,y){var M=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var F=a.entanglements,G=a.expirationTimes,ue=a.hiddenUpdates;for(f=M&~f;0<f;){var me=31-yt(f),ve=1<<me;F[me]=0,G[me]=-1;var de=ue[me];if(de!==null)for(ue[me]=null,me=0;me<de.length;me++){var he=de[me];he!==null&&(he.lane&=-536870913)}f&=~ve}m!==0&&Vo(a,m,0),y!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=y&~(M&~c))}function Vo(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var m=31-yt(c);a.entangledLanes|=c,a.entanglements[m]=a.entanglements[m]|1073741824|f&4194090}function T2(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var m=31-yt(f),v=1<<m;v&c|a[m]&c&&(a[m]|=c),f&=~v}}function Ah(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Rh(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function E2(){var a=Q.p;return a!==0?a:(a=window.event,a===void 0?32:i3(a.type))}function Vj(a,c){var f=Q.p;try{return Q.p=a,c()}finally{Q.p=f}}var Ai=Math.random().toString(36).slice(2),gn="__reactFiber$"+Ai,Mn="__reactProps$"+Ai,ga="__reactContainer$"+Ai,Ch="__reactEvents$"+Ai,qj="__reactListeners$"+Ai,Hj="__reactHandles$"+Ai,A2="__reactResources$"+Ai,qo="__reactMarker$"+Ai;function Nh(a){delete a[gn],delete a[Mn],delete a[Ch],delete a[qj],delete a[Hj]}function _a(a){var c=a[gn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[ga]||f[gn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=VT(a);a!==null;){if(f=a[gn])return f;a=VT(a)}return c}a=f,f=a.parentNode}return null}function va(a){if(a=a[gn]||a[ga]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function Ho(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function xa(a){var c=a[A2];return c||(c=a[A2]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function sn(a){a[qo]=!0}var R2=new Set,C2={};function ms(a,c){ya(a,c),ya(a+"Capture",c)}function ya(a,c){for(C2[a]=c,a=0;a<c.length;a++)R2.add(c[a])}var Wj=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),N2={},k2={};function Xj(a){return we.call(k2,a)?!0:we.call(N2,a)?!1:Wj.test(a)?k2[a]=!0:(N2[a]=!0,!1)}function Xc(a,c,f){if(Xj(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var m=c.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function Yc(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function ti(a,c,f,m){if(m===null)a.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+m)}}var kh,M2;function ba(a){if(kh===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);kh=c&&c[1]||"",M2=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+kh+a+M2}var Mh=!1;function Ih(a,c){if(!a||Mh)return"";Mh=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(he){var de=he}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(he){de=he}a.call(ve.prototype)}}else{try{throw Error()}catch(he){de=he}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(he){if(he&&de&&typeof he.stack=="string")return[he.stack,de.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=m.DetermineComponentFrameRoot(),M=y[0],F=y[1];if(M&&F){var G=M.split(`
`),ue=F.split(`
`);for(v=m=0;m<G.length&&!G[m].includes("DetermineComponentFrameRoot");)m++;for(;v<ue.length&&!ue[v].includes("DetermineComponentFrameRoot");)v++;if(m===G.length||v===ue.length)for(m=G.length-1,v=ue.length-1;1<=m&&0<=v&&G[m]!==ue[v];)v--;for(;1<=m&&0<=v;m--,v--)if(G[m]!==ue[v]){if(m!==1||v!==1)do if(m--,v--,0>v||G[m]!==ue[v]){var me=`
`+G[m].replace(" at new "," at ");return a.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",a.displayName)),me}while(1<=m&&0<=v);break}}}finally{Mh=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?ba(f):""}function Yj(a){switch(a.tag){case 26:case 27:case 5:return ba(a.type);case 16:return ba("Lazy");case 13:return ba("Suspense");case 19:return ba("SuspenseList");case 0:case 15:return Ih(a.type,!1);case 11:return Ih(a.type.render,!1);case 1:return Ih(a.type,!0);case 31:return ba("Activity");default:return""}}function I2(a){try{var c="";do c+=Yj(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function er(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function O2(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Gj(a){var c=O2(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),m=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,y=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(M){m=""+M,y.call(this,M)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return m},setValue:function(M){m=""+M},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Gc(a){a._valueTracker||(a._valueTracker=Gj(a))}function P2(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),m="";return a&&(m=O2(a)?a.checked?"true":"false":a.value),a=m,a!==f?(c.setValue(a),!0):!1}function Kc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Kj=/[\n"\\]/g;function tr(a){return a.replace(Kj,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Oh(a,c,f,m,v,y,M,F){a.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?a.type=M:a.removeAttribute("type"),c!=null?M==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+er(c)):a.value!==""+er(c)&&(a.value=""+er(c)):M!=="submit"&&M!=="reset"||a.removeAttribute("value"),c!=null?Ph(a,M,er(c)):f!=null?Ph(a,M,er(f)):m!=null&&a.removeAttribute("value"),v==null&&y!=null&&(a.defaultChecked=!!y),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?a.name=""+er(F):a.removeAttribute("name")}function D2(a,c,f,m,v,y,M,F){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(a.type=y),c!=null||f!=null){if(!(y!=="submit"&&y!=="reset"||c!=null))return;f=f!=null?""+er(f):"",c=c!=null?""+er(c):f,F||c===a.value||(a.value=c),a.defaultValue=c}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=F?a.checked:!!m,a.defaultChecked=!!m,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.name=M)}function Ph(a,c,f){c==="number"&&Kc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function wa(a,c,f,m){if(a=a.options,c){c={};for(var v=0;v<f.length;v++)c["$"+f[v]]=!0;for(f=0;f<a.length;f++)v=c.hasOwnProperty("$"+a[f].value),a[f].selected!==v&&(a[f].selected=v),v&&m&&(a[f].defaultSelected=!0)}else{for(f=""+er(f),c=null,v=0;v<a.length;v++){if(a[v].value===f){a[v].selected=!0,m&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function j2(a,c,f){if(c!=null&&(c=""+er(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+er(f):""}function L2(a,c,f,m){if(c==null){if(m!=null){if(f!=null)throw Error(r(92));if(Y(m)){if(1<m.length)throw Error(r(93));m=m[0]}f=m}f==null&&(f=""),c=f}f=er(c),a.defaultValue=f,m=a.textContent,m===f&&m!==""&&m!==null&&(a.value=m)}function Sa(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var Zj=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function B2(a,c,f){var m=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?m?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":m?a.setProperty(c,f):typeof f!="number"||f===0||Zj.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function U2(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var m in f)!f.hasOwnProperty(m)||c!=null&&c.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var v in c)m=c[v],c.hasOwnProperty(v)&&f[v]!==m&&B2(a,v,m)}else for(var y in c)c.hasOwnProperty(y)&&B2(a,y,c[y])}function Dh(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qj=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Jj=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Zc(a){return Jj.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var jh=null;function Lh(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ta=null,Ea=null;function F2(a){var c=va(a);if(c&&(a=c.stateNode)){var f=a[Mn]||null;e:switch(a=c.stateNode,c.type){case"input":if(Oh(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+tr(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var m=f[c];if(m!==a&&m.form===a.form){var v=m[Mn]||null;if(!v)throw Error(r(90));Oh(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<f.length;c++)m=f[c],m.form===a.form&&P2(m)}break e;case"textarea":j2(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&wa(a,!!f.multiple,c,!1)}}}var Bh=!1;function z2(a,c,f){if(Bh)return a(c,f);Bh=!0;try{var m=a(c);return m}finally{if(Bh=!1,(Ta!==null||Ea!==null)&&(ju(),Ta&&(c=Ta,a=Ea,Ea=Ta=null,F2(c),a)))for(c=0;c<a.length;c++)F2(a[c])}}function Wo(a,c){var f=a.stateNode;if(f===null)return null;var m=f[Mn]||null;if(m===null)return null;f=m[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uh=!1;if(ni)try{var Xo={};Object.defineProperty(Xo,"passive",{get:function(){Uh=!0}}),window.addEventListener("test",Xo,Xo),window.removeEventListener("test",Xo,Xo)}catch{Uh=!1}var Ri=null,Fh=null,Qc=null;function $2(){if(Qc)return Qc;var a,c=Fh,f=c.length,m,v="value"in Ri?Ri.value:Ri.textContent,y=v.length;for(a=0;a<f&&c[a]===v[a];a++);var M=f-a;for(m=1;m<=M&&c[f-m]===v[y-m];m++);return Qc=v.slice(a,1<m?1-m:void 0)}function Jc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function eu(){return!0}function V2(){return!1}function In(a){function c(f,m,v,y,M){this._reactName=f,this._targetInst=v,this.type=m,this.nativeEvent=y,this.target=M,this.currentTarget=null;for(var F in a)a.hasOwnProperty(F)&&(f=a[F],this[F]=f?f(y):y[F]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?eu:V2,this.isPropagationStopped=V2,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=eu)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=eu)},persist:function(){},isPersistent:eu}),c}var gs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tu=In(gs),Yo=h({},gs,{view:0,detail:0}),e6=In(Yo),zh,$h,Go,nu=h({},Yo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Go&&(Go&&a.type==="mousemove"?(zh=a.screenX-Go.screenX,$h=a.screenY-Go.screenY):$h=zh=0,Go=a),zh)},movementY:function(a){return"movementY"in a?a.movementY:$h}}),q2=In(nu),t6=h({},nu,{dataTransfer:0}),n6=In(t6),r6=h({},Yo,{relatedTarget:0}),Vh=In(r6),i6=h({},gs,{animationName:0,elapsedTime:0,pseudoElement:0}),s6=In(i6),a6=h({},gs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),o6=In(a6),l6=h({},gs,{data:0}),H2=In(l6),c6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},u6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},f6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function d6(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=f6[a])?!!c[a]:!1}function qh(){return d6}var h6=h({},Yo,{key:function(a){if(a.key){var c=c6[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Jc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?u6[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qh,charCode:function(a){return a.type==="keypress"?Jc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Jc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),p6=In(h6),m6=h({},nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),W2=In(m6),g6=h({},Yo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qh}),_6=In(g6),v6=h({},gs,{propertyName:0,elapsedTime:0,pseudoElement:0}),x6=In(v6),y6=h({},nu,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),b6=In(y6),w6=h({},gs,{newState:0,oldState:0}),S6=In(w6),T6=[9,13,27,32],Hh=ni&&"CompositionEvent"in window,Ko=null;ni&&"documentMode"in document&&(Ko=document.documentMode);var E6=ni&&"TextEvent"in window&&!Ko,X2=ni&&(!Hh||Ko&&8<Ko&&11>=Ko),Y2=" ",G2=!1;function K2(a,c){switch(a){case"keyup":return T6.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Z2(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Aa=!1;function A6(a,c){switch(a){case"compositionend":return Z2(c);case"keypress":return c.which!==32?null:(G2=!0,Y2);case"textInput":return a=c.data,a===Y2&&G2?null:a;default:return null}}function R6(a,c){if(Aa)return a==="compositionend"||!Hh&&K2(a,c)?(a=$2(),Qc=Fh=Ri=null,Aa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return X2&&c.locale!=="ko"?null:c.data;default:return null}}var C6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Q2(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!C6[a.type]:c==="textarea"}function J2(a,c,f,m){Ta?Ea?Ea.push(m):Ea=[m]:Ta=m,c=$u(c,"onChange"),0<c.length&&(f=new tu("onChange","change",null,f,m),a.push({event:f,listeners:c}))}var Zo=null,Qo=null;function N6(a){OT(a,0)}function ru(a){var c=Ho(a);if(P2(c))return a}function ew(a,c){if(a==="change")return c}var tw=!1;if(ni){var Wh;if(ni){var Xh="oninput"in document;if(!Xh){var nw=document.createElement("div");nw.setAttribute("oninput","return;"),Xh=typeof nw.oninput=="function"}Wh=Xh}else Wh=!1;tw=Wh&&(!document.documentMode||9<document.documentMode)}function rw(){Zo&&(Zo.detachEvent("onpropertychange",iw),Qo=Zo=null)}function iw(a){if(a.propertyName==="value"&&ru(Qo)){var c=[];J2(c,Qo,a,Lh(a)),z2(N6,c)}}function k6(a,c,f){a==="focusin"?(rw(),Zo=c,Qo=f,Zo.attachEvent("onpropertychange",iw)):a==="focusout"&&rw()}function M6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ru(Qo)}function I6(a,c){if(a==="click")return ru(c)}function O6(a,c){if(a==="input"||a==="change")return ru(c)}function P6(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Bn=typeof Object.is=="function"?Object.is:P6;function Jo(a,c){if(Bn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),m=Object.keys(c);if(f.length!==m.length)return!1;for(m=0;m<f.length;m++){var v=f[m];if(!we.call(c,v)||!Bn(a[v],c[v]))return!1}return!0}function sw(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function aw(a,c){var f=sw(a);a=0;for(var m;f;){if(f.nodeType===3){if(m=a+f.textContent.length,a<=c&&m>=c)return{node:f,offset:c-a};a=m}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=sw(f)}}function ow(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?ow(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function lw(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Kc(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=Kc(a.document)}return c}function Yh(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var D6=ni&&"documentMode"in document&&11>=document.documentMode,Ra=null,Gh=null,el=null,Kh=!1;function cw(a,c,f){var m=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Kh||Ra==null||Ra!==Kc(m)||(m=Ra,"selectionStart"in m&&Yh(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),el&&Jo(el,m)||(el=m,m=$u(Gh,"onSelect"),0<m.length&&(c=new tu("onSelect","select",null,c,f),a.push({event:c,listeners:m}),c.target=Ra)))}function _s(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var Ca={animationend:_s("Animation","AnimationEnd"),animationiteration:_s("Animation","AnimationIteration"),animationstart:_s("Animation","AnimationStart"),transitionrun:_s("Transition","TransitionRun"),transitionstart:_s("Transition","TransitionStart"),transitioncancel:_s("Transition","TransitionCancel"),transitionend:_s("Transition","TransitionEnd")},Zh={},uw={};ni&&(uw=document.createElement("div").style,"AnimationEvent"in window||(delete Ca.animationend.animation,delete Ca.animationiteration.animation,delete Ca.animationstart.animation),"TransitionEvent"in window||delete Ca.transitionend.transition);function vs(a){if(Zh[a])return Zh[a];if(!Ca[a])return a;var c=Ca[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in uw)return Zh[a]=c[f];return a}var fw=vs("animationend"),dw=vs("animationiteration"),hw=vs("animationstart"),j6=vs("transitionrun"),L6=vs("transitionstart"),B6=vs("transitioncancel"),pw=vs("transitionend"),mw=new Map,Qh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qh.push("scrollEnd");function Sr(a,c){mw.set(a,c),ms(c,[a])}var gw=new WeakMap;function nr(a,c){if(typeof a=="object"&&a!==null){var f=gw.get(a);return f!==void 0?f:(c={value:a,source:c,stack:I2(c)},gw.set(a,c),c)}return{value:a,source:c,stack:I2(c)}}var rr=[],Na=0,Jh=0;function iu(){for(var a=Na,c=Jh=Na=0;c<a;){var f=rr[c];rr[c++]=null;var m=rr[c];rr[c++]=null;var v=rr[c];rr[c++]=null;var y=rr[c];if(rr[c++]=null,m!==null&&v!==null){var M=m.pending;M===null?v.next=v:(v.next=M.next,M.next=v),m.pending=v}y!==0&&_w(f,v,y)}}function su(a,c,f,m){rr[Na++]=a,rr[Na++]=c,rr[Na++]=f,rr[Na++]=m,Jh|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function ep(a,c,f,m){return su(a,c,f,m),au(a)}function ka(a,c){return su(a,null,null,c),au(a)}function _w(a,c,f){a.lanes|=f;var m=a.alternate;m!==null&&(m.lanes|=f);for(var v=!1,y=a.return;y!==null;)y.childLanes|=f,m=y.alternate,m!==null&&(m.childLanes|=f),y.tag===22&&(a=y.stateNode,a===null||a._visibility&1||(v=!0)),a=y,y=y.return;return a.tag===3?(y=a.stateNode,v&&c!==null&&(v=31-yt(f),a=y.hiddenUpdates,m=a[v],m===null?a[v]=[c]:m.push(c),c.lane=f|536870912),y):null}function au(a){if(50<El)throw El=0,am=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Ma={};function U6(a,c,f,m){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Un(a,c,f,m){return new U6(a,c,f,m)}function tp(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ri(a,c){var f=a.alternate;return f===null?(f=Un(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function vw(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function ou(a,c,f,m,v,y){var M=0;if(m=a,typeof a=="function")tp(a)&&(M=1);else if(typeof a=="string")M=zL(a,f,z.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case I:return a=Un(31,f,c,v),a.elementType=I,a.lanes=y,a;case w:return xs(f.children,v,y,c);case S:M=8,v|=24;break;case b:return a=Un(12,f,c,v|2),a.elementType=b,a.lanes=y,a;case C:return a=Un(13,f,c,v),a.elementType=C,a.lanes=y,a;case O:return a=Un(19,f,c,v),a.elementType=O,a.lanes=y,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case T:case R:M=10;break e;case A:M=9;break e;case E:M=11;break e;case P:M=14;break e;case k:M=16,m=null;break e}M=29,f=Error(r(130,a===null?"null":typeof a,"")),m=null}return c=Un(M,f,c,v),c.elementType=a,c.type=m,c.lanes=y,c}function xs(a,c,f,m){return a=Un(7,a,m,c),a.lanes=f,a}function np(a,c,f){return a=Un(6,a,null,c),a.lanes=f,a}function rp(a,c,f){return c=Un(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Ia=[],Oa=0,lu=null,cu=0,ir=[],sr=0,ys=null,ii=1,si="";function bs(a,c){Ia[Oa++]=cu,Ia[Oa++]=lu,lu=a,cu=c}function xw(a,c,f){ir[sr++]=ii,ir[sr++]=si,ir[sr++]=ys,ys=a;var m=ii;a=si;var v=32-yt(m)-1;m&=~(1<<v),f+=1;var y=32-yt(c)+v;if(30<y){var M=v-v%5;y=(m&(1<<M)-1).toString(32),m>>=M,v-=M,ii=1<<32-yt(c)+v|f<<v|m,si=y+a}else ii=1<<y|f<<v|m,si=a}function ip(a){a.return!==null&&(bs(a,1),xw(a,1,0))}function sp(a){for(;a===lu;)lu=Ia[--Oa],Ia[Oa]=null,cu=Ia[--Oa],Ia[Oa]=null;for(;a===ys;)ys=ir[--sr],ir[sr]=null,si=ir[--sr],ir[sr]=null,ii=ir[--sr],ir[sr]=null}var Tn=null,It=null,Qe=!1,ws=null,Lr=!1,ap=Error(r(519));function Ss(a){var c=Error(r(418,""));throw rl(nr(c,a)),ap}function yw(a){var c=a.stateNode,f=a.type,m=a.memoizedProps;switch(c[gn]=a,c[Mn]=m,f){case"dialog":We("cancel",c),We("close",c);break;case"iframe":case"object":case"embed":We("load",c);break;case"video":case"audio":for(f=0;f<Rl.length;f++)We(Rl[f],c);break;case"source":We("error",c);break;case"img":case"image":case"link":We("error",c),We("load",c);break;case"details":We("toggle",c);break;case"input":We("invalid",c),D2(c,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),Gc(c);break;case"select":We("invalid",c);break;case"textarea":We("invalid",c),L2(c,m.value,m.defaultValue,m.children),Gc(c)}f=m.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||m.suppressHydrationWarning===!0||LT(c.textContent,f)?(m.popover!=null&&(We("beforetoggle",c),We("toggle",c)),m.onScroll!=null&&We("scroll",c),m.onScrollEnd!=null&&We("scrollend",c),m.onClick!=null&&(c.onclick=Vu),c=!0):c=!1,c||Ss(a)}function bw(a){for(Tn=a.return;Tn;)switch(Tn.tag){case 5:case 13:Lr=!1;return;case 27:case 3:Lr=!0;return;default:Tn=Tn.return}}function tl(a){if(a!==Tn)return!1;if(!Qe)return bw(a),Qe=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||wm(a.type,a.memoizedProps)),f=!f),f&&It&&Ss(a),bw(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){It=Er(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}It=null}}else c===27?(c=It,Vi(a.type)?(a=Am,Am=null,It=a):It=c):It=Tn?Er(a.stateNode.nextSibling):null;return!0}function nl(){It=Tn=null,Qe=!1}function ww(){var a=ws;return a!==null&&(Dn===null?Dn=a:Dn.push.apply(Dn,a),ws=null),a}function rl(a){ws===null?ws=[a]:ws.push(a)}var op=W(null),Ts=null,ai=null;function Ci(a,c,f){se(op,c._currentValue),c._currentValue=f}function oi(a){a._currentValue=op.current,fe(op)}function lp(a,c,f){for(;a!==null;){var m=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,m!==null&&(m.childLanes|=c)):m!==null&&(m.childLanes&c)!==c&&(m.childLanes|=c),a===f)break;a=a.return}}function cp(a,c,f,m){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var y=v.dependencies;if(y!==null){var M=v.child;y=y.firstContext;e:for(;y!==null;){var F=y;y=v;for(var G=0;G<c.length;G++)if(F.context===c[G]){y.lanes|=f,F=y.alternate,F!==null&&(F.lanes|=f),lp(y.return,f,a),m||(M=null);break e}y=F.next}}else if(v.tag===18){if(M=v.return,M===null)throw Error(r(341));M.lanes|=f,y=M.alternate,y!==null&&(y.lanes|=f),lp(M,f,a),M=null}else M=v.child;if(M!==null)M.return=v;else for(M=v;M!==null;){if(M===a){M=null;break}if(v=M.sibling,v!==null){v.return=M.return,M=v;break}M=M.return}v=M}}function il(a,c,f,m){a=null;for(var v=c,y=!1;v!==null;){if(!y){if((v.flags&524288)!==0)y=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var M=v.alternate;if(M===null)throw Error(r(387));if(M=M.memoizedProps,M!==null){var F=v.type;Bn(v.pendingProps.value,M.value)||(a!==null?a.push(F):a=[F])}}else if(v===pe.current){if(M=v.alternate,M===null)throw Error(r(387));M.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(Ol):a=[Ol])}v=v.return}a!==null&&cp(c,a,f,m),c.flags|=262144}function uu(a){for(a=a.firstContext;a!==null;){if(!Bn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Es(a){Ts=a,ai=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function _n(a){return Sw(Ts,a)}function fu(a,c){return Ts===null&&Es(a),Sw(a,c)}function Sw(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},ai===null){if(a===null)throw Error(r(308));ai=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else ai=ai.next=c;return f}var F6=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,m){a.push(m)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},z6=t.unstable_scheduleCallback,$6=t.unstable_NormalPriority,Zt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function up(){return{controller:new F6,data:new Map,refCount:0}}function sl(a){a.refCount--,a.refCount===0&&z6($6,function(){a.controller.abort()})}var al=null,fp=0,Pa=0,Da=null;function V6(a,c){if(al===null){var f=al=[];fp=0,Pa=hm(),Da={status:"pending",value:void 0,then:function(m){f.push(m)}}}return fp++,c.then(Tw,Tw),c}function Tw(){if(--fp===0&&al!==null){Da!==null&&(Da.status="fulfilled");var a=al;al=null,Pa=0,Da=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function q6(a,c){var f=[],m={status:"pending",value:null,reason:null,then:function(v){f.push(v)}};return a.then(function(){m.status="fulfilled",m.value=c;for(var v=0;v<f.length;v++)(0,f[v])(c)},function(v){for(m.status="rejected",m.reason=v,v=0;v<f.length;v++)(0,f[v])(void 0)}),m}var Ew=$.S;$.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&V6(a,c),Ew!==null&&Ew(a,c)};var As=W(null);function dp(){var a=As.current;return a!==null?a:vt.pooledCache}function du(a,c){c===null?se(As,As.current):se(As,c.pool)}function Aw(){var a=dp();return a===null?null:{parent:Zt._currentValue,pool:a}}var ol=Error(r(460)),Rw=Error(r(474)),hu=Error(r(542)),hp={then:function(){}};function Cw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function pu(){}function Nw(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(pu,pu),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Mw(a),a;default:if(typeof c.status=="string")c.then(pu,pu);else{if(a=vt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(m){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=m}},function(m){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=m}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,Mw(a),a}throw ll=c,ol}}var ll=null;function kw(){if(ll===null)throw Error(r(459));var a=ll;return ll=null,a}function Mw(a){if(a===ol||a===hu)throw Error(r(483))}var Ni=!1;function pp(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mp(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ki(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Mi(a,c,f){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(st&2)!==0){var v=m.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),m.pending=c,c=au(a),_w(a,null,f),c}return su(a,m,c,f),au(a)}function cl(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var m=c.lanes;m&=a.pendingLanes,f|=m,c.lanes=f,T2(a,f)}}function gp(a,c){var f=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,f===m)){var v=null,y=null;if(f=f.firstBaseUpdate,f!==null){do{var M={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};y===null?v=y=M:y=y.next=M,f=f.next}while(f!==null);y===null?v=y=c:y=y.next=c}else v=y=c;f={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:y,shared:m.shared,callbacks:m.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var _p=!1;function ul(){if(_p){var a=Da;if(a!==null)throw a}}function fl(a,c,f,m){_p=!1;var v=a.updateQueue;Ni=!1;var y=v.firstBaseUpdate,M=v.lastBaseUpdate,F=v.shared.pending;if(F!==null){v.shared.pending=null;var G=F,ue=G.next;G.next=null,M===null?y=ue:M.next=ue,M=G;var me=a.alternate;me!==null&&(me=me.updateQueue,F=me.lastBaseUpdate,F!==M&&(F===null?me.firstBaseUpdate=ue:F.next=ue,me.lastBaseUpdate=G))}if(y!==null){var ve=v.baseState;M=0,me=ue=G=null,F=y;do{var de=F.lane&-536870913,he=de!==F.lane;if(he?(Ye&de)===de:(m&de)===de){de!==0&&de===Pa&&(_p=!0),me!==null&&(me=me.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var Be=a,Pe=F;de=c;var ft=f;switch(Pe.tag){case 1:if(Be=Pe.payload,typeof Be=="function"){ve=Be.call(ft,ve,de);break e}ve=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=Pe.payload,de=typeof Be=="function"?Be.call(ft,ve,de):Be,de==null)break e;ve=h({},ve,de);break e;case 2:Ni=!0}}de=F.callback,de!==null&&(a.flags|=64,he&&(a.flags|=8192),he=v.callbacks,he===null?v.callbacks=[de]:he.push(de))}else he={lane:de,tag:F.tag,payload:F.payload,callback:F.callback,next:null},me===null?(ue=me=he,G=ve):me=me.next=he,M|=de;if(F=F.next,F===null){if(F=v.shared.pending,F===null)break;he=F,F=he.next,he.next=null,v.lastBaseUpdate=he,v.shared.pending=null}}while(!0);me===null&&(G=ve),v.baseState=G,v.firstBaseUpdate=ue,v.lastBaseUpdate=me,y===null&&(v.shared.lanes=0),Ui|=M,a.lanes=M,a.memoizedState=ve}}function Iw(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function Ow(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)Iw(f[a],c)}var ja=W(null),mu=W(0);function Pw(a,c){a=pi,se(mu,a),se(ja,c),pi=a|c.baseLanes}function vp(){se(mu,pi),se(ja,ja.current)}function xp(){pi=mu.current,fe(ja),fe(mu)}var Ii=0,$e=null,ct=null,$t=null,gu=!1,La=!1,Rs=!1,_u=0,dl=0,Ba=null,H6=0;function Bt(){throw Error(r(321))}function yp(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!Bn(a[f],c[f]))return!1;return!0}function bp(a,c,f,m,v,y){return Ii=y,$e=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,$.H=a===null||a.memoizedState===null?_S:vS,Rs=!1,y=f(m,v),Rs=!1,La&&(y=jw(c,f,m,v)),Dw(a),y}function Dw(a){$.H=Su;var c=ct!==null&&ct.next!==null;if(Ii=0,$t=ct=$e=null,gu=!1,dl=0,Ba=null,c)throw Error(r(300));a===null||an||(a=a.dependencies,a!==null&&uu(a)&&(an=!0))}function jw(a,c,f,m){$e=a;var v=0;do{if(La&&(Ba=null),dl=0,La=!1,25<=v)throw Error(r(301));if(v+=1,$t=ct=null,a.updateQueue!=null){var y=a.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}$.H=Q6,y=c(f,m)}while(La);return y}function W6(){var a=$.H,c=a.useState()[0];return c=typeof c.then=="function"?hl(c):c,a=a.useState()[0],(ct!==null?ct.memoizedState:null)!==a&&($e.flags|=1024),c}function wp(){var a=_u!==0;return _u=0,a}function Sp(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function Tp(a){if(gu){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}gu=!1}Ii=0,$t=ct=$e=null,La=!1,dl=_u=0,Ba=null}function On(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?$e.memoizedState=$t=a:$t=$t.next=a,$t}function Vt(){if(ct===null){var a=$e.alternate;a=a!==null?a.memoizedState:null}else a=ct.next;var c=$t===null?$e.memoizedState:$t.next;if(c!==null)$t=c,ct=a;else{if(a===null)throw $e.alternate===null?Error(r(467)):Error(r(310));ct=a,a={memoizedState:ct.memoizedState,baseState:ct.baseState,baseQueue:ct.baseQueue,queue:ct.queue,next:null},$t===null?$e.memoizedState=$t=a:$t=$t.next=a}return $t}function Ep(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hl(a){var c=dl;return dl+=1,Ba===null&&(Ba=[]),a=Nw(Ba,a,c),c=$e,($t===null?c.memoizedState:$t.next)===null&&(c=c.alternate,$.H=c===null||c.memoizedState===null?_S:vS),a}function vu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return hl(a);if(a.$$typeof===R)return _n(a)}throw Error(r(438,String(a)))}function Ap(a){var c=null,f=$e.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var m=$e.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(c={data:m.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=Ep(),$e.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),m=0;m<a;m++)f[m]=N;return c.index++,f}function li(a,c){return typeof c=="function"?c(a):c}function xu(a){var c=Vt();return Rp(c,ct,a)}function Rp(a,c,f){var m=a.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=f;var v=a.baseQueue,y=m.pending;if(y!==null){if(v!==null){var M=v.next;v.next=y.next,y.next=M}c.baseQueue=v=y,m.pending=null}if(y=a.baseState,v===null)a.memoizedState=y;else{c=v.next;var F=M=null,G=null,ue=c,me=!1;do{var ve=ue.lane&-536870913;if(ve!==ue.lane?(Ye&ve)===ve:(Ii&ve)===ve){var de=ue.revertLane;if(de===0)G!==null&&(G=G.next={lane:0,revertLane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),ve===Pa&&(me=!0);else if((Ii&de)===de){ue=ue.next,de===Pa&&(me=!0);continue}else ve={lane:0,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(F=G=ve,M=y):G=G.next=ve,$e.lanes|=de,Ui|=de;ve=ue.action,Rs&&f(y,ve),y=ue.hasEagerState?ue.eagerState:f(y,ve)}else de={lane:ve,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(F=G=de,M=y):G=G.next=de,$e.lanes|=ve,Ui|=ve;ue=ue.next}while(ue!==null&&ue!==c);if(G===null?M=y:G.next=F,!Bn(y,a.memoizedState)&&(an=!0,me&&(f=Da,f!==null)))throw f;a.memoizedState=y,a.baseState=M,a.baseQueue=G,m.lastRenderedState=y}return v===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Cp(a){var c=Vt(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var m=f.dispatch,v=f.pending,y=c.memoizedState;if(v!==null){f.pending=null;var M=v=v.next;do y=a(y,M.action),M=M.next;while(M!==v);Bn(y,c.memoizedState)||(an=!0),c.memoizedState=y,c.baseQueue===null&&(c.baseState=y),f.lastRenderedState=y}return[y,m]}function Lw(a,c,f){var m=$e,v=Vt(),y=Qe;if(y){if(f===void 0)throw Error(r(407));f=f()}else f=c();var M=!Bn((ct||v).memoizedState,f);M&&(v.memoizedState=f,an=!0),v=v.queue;var F=Fw.bind(null,m,v,a);if(pl(2048,8,F,[a]),v.getSnapshot!==c||M||$t!==null&&$t.memoizedState.tag&1){if(m.flags|=2048,Ua(9,yu(),Uw.bind(null,m,v,f,c),null),vt===null)throw Error(r(349));y||(Ii&124)!==0||Bw(m,c,f)}return f}function Bw(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=$e.updateQueue,c===null?(c=Ep(),$e.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function Uw(a,c,f,m){c.value=f,c.getSnapshot=m,zw(c)&&$w(a)}function Fw(a,c,f){return f(function(){zw(c)&&$w(a)})}function zw(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!Bn(a,f)}catch{return!0}}function $w(a){var c=ka(a,2);c!==null&&qn(c,a,2)}function Np(a){var c=On();if(typeof a=="function"){var f=a;if(a=f(),Rs){Ze(!0);try{f()}finally{Ze(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:a},c}function Vw(a,c,f,m){return a.baseState=f,Rp(a,ct,typeof m=="function"?m:li)}function X6(a,c,f,m,v){if(wu(a))throw Error(r(485));if(a=c.action,a!==null){var y={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){y.listeners.push(M)}};$.T!==null?f(!0):y.isTransition=!1,m(y),f=c.pending,f===null?(y.next=c.pending=y,qw(c,y)):(y.next=f.next,c.pending=f.next=y)}}function qw(a,c){var f=c.action,m=c.payload,v=a.state;if(c.isTransition){var y=$.T,M={};$.T=M;try{var F=f(v,m),G=$.S;G!==null&&G(M,F),Hw(a,c,F)}catch(ue){kp(a,c,ue)}finally{$.T=y}}else try{y=f(v,m),Hw(a,c,y)}catch(ue){kp(a,c,ue)}}function Hw(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(m){Ww(a,c,m)},function(m){return kp(a,c,m)}):Ww(a,c,f)}function Ww(a,c,f){c.status="fulfilled",c.value=f,Xw(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,qw(a,f)))}function kp(a,c,f){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do c.status="rejected",c.reason=f,Xw(c),c=c.next;while(c!==m)}a.action=null}function Xw(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function Yw(a,c){return c}function Gw(a,c){if(Qe){var f=vt.formState;if(f!==null){e:{var m=$e;if(Qe){if(It){t:{for(var v=It,y=Lr;v.nodeType!==8;){if(!y){v=null;break t}if(v=Er(v.nextSibling),v===null){v=null;break t}}y=v.data,v=y==="F!"||y==="F"?v:null}if(v){It=Er(v.nextSibling),m=v.data==="F!";break e}}Ss(m)}m=!1}m&&(c=f[0])}}return f=On(),f.memoizedState=f.baseState=c,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yw,lastRenderedState:c},f.queue=m,f=pS.bind(null,$e,m),m.dispatch=f,m=Np(!1),y=Dp.bind(null,$e,!1,m.queue),m=On(),v={state:c,dispatch:null,action:a,pending:null},m.queue=v,f=X6.bind(null,$e,v,y,f),v.dispatch=f,m.memoizedState=a,[c,f,!1]}function Kw(a){var c=Vt();return Zw(c,ct,a)}function Zw(a,c,f){if(c=Rp(a,c,Yw)[0],a=xu(li)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var m=hl(c)}catch(M){throw M===ol?hu:M}else m=c;c=Vt();var v=c.queue,y=v.dispatch;return f!==c.memoizedState&&($e.flags|=2048,Ua(9,yu(),Y6.bind(null,v,f),null)),[m,y,a]}function Y6(a,c){a.action=c}function Qw(a){var c=Vt(),f=ct;if(f!==null)return Zw(c,f,a);Vt(),c=c.memoizedState,f=Vt();var m=f.queue.dispatch;return f.memoizedState=a,[c,m,!1]}function Ua(a,c,f,m){return a={tag:a,create:f,deps:m,inst:c,next:null},c=$e.updateQueue,c===null&&(c=Ep(),$e.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(m=f.next,f.next=a,a.next=m,c.lastEffect=a),a}function yu(){return{destroy:void 0,resource:void 0}}function Jw(){return Vt().memoizedState}function bu(a,c,f,m){var v=On();m=m===void 0?null:m,$e.flags|=a,v.memoizedState=Ua(1|c,yu(),f,m)}function pl(a,c,f,m){var v=Vt();m=m===void 0?null:m;var y=v.memoizedState.inst;ct!==null&&m!==null&&yp(m,ct.memoizedState.deps)?v.memoizedState=Ua(c,y,f,m):($e.flags|=a,v.memoizedState=Ua(1|c,y,f,m))}function eS(a,c){bu(8390656,8,a,c)}function tS(a,c){pl(2048,8,a,c)}function nS(a,c){return pl(4,2,a,c)}function rS(a,c){return pl(4,4,a,c)}function iS(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function sS(a,c,f){f=f!=null?f.concat([a]):null,pl(4,4,iS.bind(null,c,a),f)}function Mp(){}function aS(a,c){var f=Vt();c=c===void 0?null:c;var m=f.memoizedState;return c!==null&&yp(c,m[1])?m[0]:(f.memoizedState=[a,c],a)}function oS(a,c){var f=Vt();c=c===void 0?null:c;var m=f.memoizedState;if(c!==null&&yp(c,m[1]))return m[0];if(m=a(),Rs){Ze(!0);try{a()}finally{Ze(!1)}}return f.memoizedState=[m,c],m}function Ip(a,c,f){return f===void 0||(Ii&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=uT(),$e.lanes|=a,Ui|=a,f)}function lS(a,c,f,m){return Bn(f,c)?f:ja.current!==null?(a=Ip(a,f,m),Bn(a,c)||(an=!0),a):(Ii&42)===0?(an=!0,a.memoizedState=f):(a=uT(),$e.lanes|=a,Ui|=a,c)}function cS(a,c,f,m,v){var y=Q.p;Q.p=y!==0&&8>y?y:8;var M=$.T,F={};$.T=F,Dp(a,!1,c,f);try{var G=v(),ue=$.S;if(ue!==null&&ue(F,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var me=q6(G,m);ml(a,c,me,Vn(a))}else ml(a,c,m,Vn(a))}catch(ve){ml(a,c,{then:function(){},status:"rejected",reason:ve},Vn())}finally{Q.p=y,$.T=M}}function G6(){}function Op(a,c,f,m){if(a.tag!==5)throw Error(r(476));var v=uS(a).queue;cS(a,v,c,oe,f===null?G6:function(){return fS(a),f(m)})}function uS(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:oe},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function fS(a){var c=uS(a).next.queue;ml(a,c,{},Vn())}function Pp(){return _n(Ol)}function dS(){return Vt().memoizedState}function hS(){return Vt().memoizedState}function K6(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=Vn();a=ki(f);var m=Mi(c,a,f);m!==null&&(qn(m,c,f),cl(m,c,f)),c={cache:up()},a.payload=c;return}c=c.return}}function Z6(a,c,f){var m=Vn();f={lane:m,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},wu(a)?mS(c,f):(f=ep(a,c,f,m),f!==null&&(qn(f,a,m),gS(f,c,m)))}function pS(a,c,f){var m=Vn();ml(a,c,f,m)}function ml(a,c,f,m){var v={lane:m,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(wu(a))mS(c,v);else{var y=a.alternate;if(a.lanes===0&&(y===null||y.lanes===0)&&(y=c.lastRenderedReducer,y!==null))try{var M=c.lastRenderedState,F=y(M,f);if(v.hasEagerState=!0,v.eagerState=F,Bn(F,M))return su(a,c,v,0),vt===null&&iu(),!1}catch{}finally{}if(f=ep(a,c,v,m),f!==null)return qn(f,a,m),gS(f,c,m),!0}return!1}function Dp(a,c,f,m){if(m={lane:2,revertLane:hm(),action:m,hasEagerState:!1,eagerState:null,next:null},wu(a)){if(c)throw Error(r(479))}else c=ep(a,f,m,2),c!==null&&qn(c,a,2)}function wu(a){var c=a.alternate;return a===$e||c!==null&&c===$e}function mS(a,c){La=gu=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function gS(a,c,f){if((f&4194048)!==0){var m=c.lanes;m&=a.pendingLanes,f|=m,c.lanes=f,T2(a,f)}}var Su={readContext:_n,use:vu,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useLayoutEffect:Bt,useInsertionEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useSyncExternalStore:Bt,useId:Bt,useHostTransitionStatus:Bt,useFormState:Bt,useActionState:Bt,useOptimistic:Bt,useMemoCache:Bt,useCacheRefresh:Bt},_S={readContext:_n,use:vu,useCallback:function(a,c){return On().memoizedState=[a,c===void 0?null:c],a},useContext:_n,useEffect:eS,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,bu(4194308,4,iS.bind(null,c,a),f)},useLayoutEffect:function(a,c){return bu(4194308,4,a,c)},useInsertionEffect:function(a,c){bu(4,2,a,c)},useMemo:function(a,c){var f=On();c=c===void 0?null:c;var m=a();if(Rs){Ze(!0);try{a()}finally{Ze(!1)}}return f.memoizedState=[m,c],m},useReducer:function(a,c,f){var m=On();if(f!==void 0){var v=f(c);if(Rs){Ze(!0);try{f(c)}finally{Ze(!1)}}}else v=c;return m.memoizedState=m.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},m.queue=a,a=a.dispatch=Z6.bind(null,$e,a),[m.memoizedState,a]},useRef:function(a){var c=On();return a={current:a},c.memoizedState=a},useState:function(a){a=Np(a);var c=a.queue,f=pS.bind(null,$e,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:Mp,useDeferredValue:function(a,c){var f=On();return Ip(f,a,c)},useTransition:function(){var a=Np(!1);return a=cS.bind(null,$e,a.queue,!0,!1),On().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var m=$e,v=On();if(Qe){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),vt===null)throw Error(r(349));(Ye&124)!==0||Bw(m,c,f)}v.memoizedState=f;var y={value:f,getSnapshot:c};return v.queue=y,eS(Fw.bind(null,m,y,a),[a]),m.flags|=2048,Ua(9,yu(),Uw.bind(null,m,y,f,c),null),f},useId:function(){var a=On(),c=vt.identifierPrefix;if(Qe){var f=si,m=ii;f=(m&~(1<<32-yt(m)-1)).toString(32)+f,c=""+c+"R"+f,f=_u++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=H6++,c=""+c+"r"+f.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:Pp,useFormState:Gw,useActionState:Gw,useOptimistic:function(a){var c=On();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=Dp.bind(null,$e,!0,f),f.dispatch=c,[a,c]},useMemoCache:Ap,useCacheRefresh:function(){return On().memoizedState=K6.bind(null,$e)}},vS={readContext:_n,use:vu,useCallback:aS,useContext:_n,useEffect:tS,useImperativeHandle:sS,useInsertionEffect:nS,useLayoutEffect:rS,useMemo:oS,useReducer:xu,useRef:Jw,useState:function(){return xu(li)},useDebugValue:Mp,useDeferredValue:function(a,c){var f=Vt();return lS(f,ct.memoizedState,a,c)},useTransition:function(){var a=xu(li)[0],c=Vt().memoizedState;return[typeof a=="boolean"?a:hl(a),c]},useSyncExternalStore:Lw,useId:dS,useHostTransitionStatus:Pp,useFormState:Kw,useActionState:Kw,useOptimistic:function(a,c){var f=Vt();return Vw(f,ct,a,c)},useMemoCache:Ap,useCacheRefresh:hS},Q6={readContext:_n,use:vu,useCallback:aS,useContext:_n,useEffect:tS,useImperativeHandle:sS,useInsertionEffect:nS,useLayoutEffect:rS,useMemo:oS,useReducer:Cp,useRef:Jw,useState:function(){return Cp(li)},useDebugValue:Mp,useDeferredValue:function(a,c){var f=Vt();return ct===null?Ip(f,a,c):lS(f,ct.memoizedState,a,c)},useTransition:function(){var a=Cp(li)[0],c=Vt().memoizedState;return[typeof a=="boolean"?a:hl(a),c]},useSyncExternalStore:Lw,useId:dS,useHostTransitionStatus:Pp,useFormState:Qw,useActionState:Qw,useOptimistic:function(a,c){var f=Vt();return ct!==null?Vw(f,ct,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:Ap,useCacheRefresh:hS},Fa=null,gl=0;function Tu(a){var c=gl;return gl+=1,Fa===null&&(Fa=[]),Nw(Fa,a,c)}function _l(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function Eu(a,c){throw c.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function xS(a){var c=a._init;return c(a._payload)}function yS(a){function c(ie,ee){if(a){var ce=ie.deletions;ce===null?(ie.deletions=[ee],ie.flags|=16):ce.push(ee)}}function f(ie,ee){if(!a)return null;for(;ee!==null;)c(ie,ee),ee=ee.sibling;return null}function m(ie){for(var ee=new Map;ie!==null;)ie.key!==null?ee.set(ie.key,ie):ee.set(ie.index,ie),ie=ie.sibling;return ee}function v(ie,ee){return ie=ri(ie,ee),ie.index=0,ie.sibling=null,ie}function y(ie,ee,ce){return ie.index=ce,a?(ce=ie.alternate,ce!==null?(ce=ce.index,ce<ee?(ie.flags|=67108866,ee):ce):(ie.flags|=67108866,ee)):(ie.flags|=1048576,ee)}function M(ie){return a&&ie.alternate===null&&(ie.flags|=67108866),ie}function F(ie,ee,ce,ge){return ee===null||ee.tag!==6?(ee=np(ce,ie.mode,ge),ee.return=ie,ee):(ee=v(ee,ce),ee.return=ie,ee)}function G(ie,ee,ce,ge){var Ce=ce.type;return Ce===w?me(ie,ee,ce.props.children,ge,ce.key):ee!==null&&(ee.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===k&&xS(Ce)===ee.type)?(ee=v(ee,ce.props),_l(ee,ce),ee.return=ie,ee):(ee=ou(ce.type,ce.key,ce.props,null,ie.mode,ge),_l(ee,ce),ee.return=ie,ee)}function ue(ie,ee,ce,ge){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ce.containerInfo||ee.stateNode.implementation!==ce.implementation?(ee=rp(ce,ie.mode,ge),ee.return=ie,ee):(ee=v(ee,ce.children||[]),ee.return=ie,ee)}function me(ie,ee,ce,ge,Ce){return ee===null||ee.tag!==7?(ee=xs(ce,ie.mode,ge,Ce),ee.return=ie,ee):(ee=v(ee,ce),ee.return=ie,ee)}function ve(ie,ee,ce){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=np(""+ee,ie.mode,ce),ee.return=ie,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case _:return ce=ou(ee.type,ee.key,ee.props,null,ie.mode,ce),_l(ce,ee),ce.return=ie,ce;case x:return ee=rp(ee,ie.mode,ce),ee.return=ie,ee;case k:var ge=ee._init;return ee=ge(ee._payload),ve(ie,ee,ce)}if(Y(ee)||V(ee))return ee=xs(ee,ie.mode,ce,null),ee.return=ie,ee;if(typeof ee.then=="function")return ve(ie,Tu(ee),ce);if(ee.$$typeof===R)return ve(ie,fu(ie,ee),ce);Eu(ie,ee)}return null}function de(ie,ee,ce,ge){var Ce=ee!==null?ee.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ce!==null?null:F(ie,ee,""+ce,ge);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:return ce.key===Ce?G(ie,ee,ce,ge):null;case x:return ce.key===Ce?ue(ie,ee,ce,ge):null;case k:return Ce=ce._init,ce=Ce(ce._payload),de(ie,ee,ce,ge)}if(Y(ce)||V(ce))return Ce!==null?null:me(ie,ee,ce,ge,null);if(typeof ce.then=="function")return de(ie,ee,Tu(ce),ge);if(ce.$$typeof===R)return de(ie,ee,fu(ie,ce),ge);Eu(ie,ce)}return null}function he(ie,ee,ce,ge,Ce){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ie=ie.get(ce)||null,F(ee,ie,""+ge,Ce);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case _:return ie=ie.get(ge.key===null?ce:ge.key)||null,G(ee,ie,ge,Ce);case x:return ie=ie.get(ge.key===null?ce:ge.key)||null,ue(ee,ie,ge,Ce);case k:var Ve=ge._init;return ge=Ve(ge._payload),he(ie,ee,ce,ge,Ce)}if(Y(ge)||V(ge))return ie=ie.get(ce)||null,me(ee,ie,ge,Ce,null);if(typeof ge.then=="function")return he(ie,ee,ce,Tu(ge),Ce);if(ge.$$typeof===R)return he(ie,ee,ce,fu(ee,ge),Ce);Eu(ee,ge)}return null}function Be(ie,ee,ce,ge){for(var Ce=null,Ve=null,Oe=ee,De=ee=0,ln=null;Oe!==null&&De<ce.length;De++){Oe.index>De?(ln=Oe,Oe=null):ln=Oe.sibling;var Ke=de(ie,Oe,ce[De],ge);if(Ke===null){Oe===null&&(Oe=ln);break}a&&Oe&&Ke.alternate===null&&c(ie,Oe),ee=y(Ke,ee,De),Ve===null?Ce=Ke:Ve.sibling=Ke,Ve=Ke,Oe=ln}if(De===ce.length)return f(ie,Oe),Qe&&bs(ie,De),Ce;if(Oe===null){for(;De<ce.length;De++)Oe=ve(ie,ce[De],ge),Oe!==null&&(ee=y(Oe,ee,De),Ve===null?Ce=Oe:Ve.sibling=Oe,Ve=Oe);return Qe&&bs(ie,De),Ce}for(Oe=m(Oe);De<ce.length;De++)ln=he(Oe,ie,De,ce[De],ge),ln!==null&&(a&&ln.alternate!==null&&Oe.delete(ln.key===null?De:ln.key),ee=y(ln,ee,De),Ve===null?Ce=ln:Ve.sibling=ln,Ve=ln);return a&&Oe.forEach(function(Yi){return c(ie,Yi)}),Qe&&bs(ie,De),Ce}function Pe(ie,ee,ce,ge){if(ce==null)throw Error(r(151));for(var Ce=null,Ve=null,Oe=ee,De=ee=0,ln=null,Ke=ce.next();Oe!==null&&!Ke.done;De++,Ke=ce.next()){Oe.index>De?(ln=Oe,Oe=null):ln=Oe.sibling;var Yi=de(ie,Oe,Ke.value,ge);if(Yi===null){Oe===null&&(Oe=ln);break}a&&Oe&&Yi.alternate===null&&c(ie,Oe),ee=y(Yi,ee,De),Ve===null?Ce=Yi:Ve.sibling=Yi,Ve=Yi,Oe=ln}if(Ke.done)return f(ie,Oe),Qe&&bs(ie,De),Ce;if(Oe===null){for(;!Ke.done;De++,Ke=ce.next())Ke=ve(ie,Ke.value,ge),Ke!==null&&(ee=y(Ke,ee,De),Ve===null?Ce=Ke:Ve.sibling=Ke,Ve=Ke);return Qe&&bs(ie,De),Ce}for(Oe=m(Oe);!Ke.done;De++,Ke=ce.next())Ke=he(Oe,ie,De,Ke.value,ge),Ke!==null&&(a&&Ke.alternate!==null&&Oe.delete(Ke.key===null?De:Ke.key),ee=y(Ke,ee,De),Ve===null?Ce=Ke:Ve.sibling=Ke,Ve=Ke);return a&&Oe.forEach(function(JL){return c(ie,JL)}),Qe&&bs(ie,De),Ce}function ft(ie,ee,ce,ge){if(typeof ce=="object"&&ce!==null&&ce.type===w&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:e:{for(var Ce=ce.key;ee!==null;){if(ee.key===Ce){if(Ce=ce.type,Ce===w){if(ee.tag===7){f(ie,ee.sibling),ge=v(ee,ce.props.children),ge.return=ie,ie=ge;break e}}else if(ee.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===k&&xS(Ce)===ee.type){f(ie,ee.sibling),ge=v(ee,ce.props),_l(ge,ce),ge.return=ie,ie=ge;break e}f(ie,ee);break}else c(ie,ee);ee=ee.sibling}ce.type===w?(ge=xs(ce.props.children,ie.mode,ge,ce.key),ge.return=ie,ie=ge):(ge=ou(ce.type,ce.key,ce.props,null,ie.mode,ge),_l(ge,ce),ge.return=ie,ie=ge)}return M(ie);case x:e:{for(Ce=ce.key;ee!==null;){if(ee.key===Ce)if(ee.tag===4&&ee.stateNode.containerInfo===ce.containerInfo&&ee.stateNode.implementation===ce.implementation){f(ie,ee.sibling),ge=v(ee,ce.children||[]),ge.return=ie,ie=ge;break e}else{f(ie,ee);break}else c(ie,ee);ee=ee.sibling}ge=rp(ce,ie.mode,ge),ge.return=ie,ie=ge}return M(ie);case k:return Ce=ce._init,ce=Ce(ce._payload),ft(ie,ee,ce,ge)}if(Y(ce))return Be(ie,ee,ce,ge);if(V(ce)){if(Ce=V(ce),typeof Ce!="function")throw Error(r(150));return ce=Ce.call(ce),Pe(ie,ee,ce,ge)}if(typeof ce.then=="function")return ft(ie,ee,Tu(ce),ge);if(ce.$$typeof===R)return ft(ie,ee,fu(ie,ce),ge);Eu(ie,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ee!==null&&ee.tag===6?(f(ie,ee.sibling),ge=v(ee,ce),ge.return=ie,ie=ge):(f(ie,ee),ge=np(ce,ie.mode,ge),ge.return=ie,ie=ge),M(ie)):f(ie,ee)}return function(ie,ee,ce,ge){try{gl=0;var Ce=ft(ie,ee,ce,ge);return Fa=null,Ce}catch(Oe){if(Oe===ol||Oe===hu)throw Oe;var Ve=Un(29,Oe,null,ie.mode);return Ve.lanes=ge,Ve.return=ie,Ve}finally{}}}var za=yS(!0),bS=yS(!1),ar=W(null),Br=null;function Oi(a){var c=a.alternate;se(Qt,Qt.current&1),se(ar,a),Br===null&&(c===null||ja.current!==null||c.memoizedState!==null)&&(Br=a)}function wS(a){if(a.tag===22){if(se(Qt,Qt.current),se(ar,a),Br===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Br=a)}}else Pi()}function Pi(){se(Qt,Qt.current),se(ar,ar.current)}function ci(a){fe(ar),Br===a&&(Br=null),fe(Qt)}var Qt=W(0);function Au(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||Em(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function jp(a,c,f,m){c=a.memoizedState,f=f(m,c),f=f==null?c:h({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var Lp={enqueueSetState:function(a,c,f){a=a._reactInternals;var m=Vn(),v=ki(m);v.payload=c,f!=null&&(v.callback=f),c=Mi(a,v,m),c!==null&&(qn(c,a,m),cl(c,a,m))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var m=Vn(),v=ki(m);v.tag=1,v.payload=c,f!=null&&(v.callback=f),c=Mi(a,v,m),c!==null&&(qn(c,a,m),cl(c,a,m))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=Vn(),m=ki(f);m.tag=2,c!=null&&(m.callback=c),c=Mi(a,m,f),c!==null&&(qn(c,a,f),cl(c,a,f))}};function SS(a,c,f,m,v,y,M){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,y,M):c.prototype&&c.prototype.isPureReactComponent?!Jo(f,m)||!Jo(v,y):!0}function TS(a,c,f,m){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,m),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,m),c.state!==a&&Lp.enqueueReplaceState(c,c.state,null)}function Cs(a,c){var f=c;if("ref"in c){f={};for(var m in c)m!=="ref"&&(f[m]=c[m])}if(a=a.defaultProps){f===c&&(f=h({},f));for(var v in a)f[v]===void 0&&(f[v]=a[v])}return f}var Ru=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function ES(a){Ru(a)}function AS(a){console.error(a)}function RS(a){Ru(a)}function Cu(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(m){setTimeout(function(){throw m})}}function CS(a,c,f){try{var m=a.onCaughtError;m(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Bp(a,c,f){return f=ki(f),f.tag=3,f.payload={element:null},f.callback=function(){Cu(a,c)},f}function NS(a){return a=ki(a),a.tag=3,a}function kS(a,c,f,m){var v=f.type.getDerivedStateFromError;if(typeof v=="function"){var y=m.value;a.payload=function(){return v(y)},a.callback=function(){CS(c,f,m)}}var M=f.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(a.callback=function(){CS(c,f,m),typeof v!="function"&&(Fi===null?Fi=new Set([this]):Fi.add(this));var F=m.stack;this.componentDidCatch(m.value,{componentStack:F!==null?F:""})})}function J6(a,c,f,m,v){if(f.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(c=f.alternate,c!==null&&il(c,f,v,!0),f=ar.current,f!==null){switch(f.tag){case 13:return Br===null?lm():f.alternate===null&&Ot===0&&(Ot=3),f.flags&=-257,f.flags|=65536,f.lanes=v,m===hp?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([m]):c.add(m),um(a,m,v)),!1;case 22:return f.flags|=65536,m===hp?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([m])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([m]):f.add(m)),um(a,m,v)),!1}throw Error(r(435,f.tag))}return um(a,m,v),lm(),!1}if(Qe)return c=ar.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,m!==ap&&(a=Error(r(422),{cause:m}),rl(nr(a,f)))):(m!==ap&&(c=Error(r(423),{cause:m}),rl(nr(c,f))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,m=nr(m,f),v=Bp(a.stateNode,m,v),gp(a,v),Ot!==4&&(Ot=2)),!1;var y=Error(r(520),{cause:m});if(y=nr(y,f),Tl===null?Tl=[y]:Tl.push(y),Ot!==4&&(Ot=2),c===null)return!0;m=nr(m,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=v&-v,f.lanes|=a,a=Bp(f.stateNode,m,a),gp(f,a),!1;case 1:if(c=f.type,y=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Fi===null||!Fi.has(y))))return f.flags|=65536,v&=-v,f.lanes|=v,v=NS(v),kS(v,a,f,m),gp(f,v),!1}f=f.return}while(f!==null);return!1}var MS=Error(r(461)),an=!1;function un(a,c,f,m){c.child=a===null?bS(c,null,f,m):za(c,a.child,f,m)}function IS(a,c,f,m,v){f=f.render;var y=c.ref;if("ref"in m){var M={};for(var F in m)F!=="ref"&&(M[F]=m[F])}else M=m;return Es(c),m=bp(a,c,f,M,y,v),F=wp(),a!==null&&!an?(Sp(a,c,v),ui(a,c,v)):(Qe&&F&&ip(c),c.flags|=1,un(a,c,m,v),c.child)}function OS(a,c,f,m,v){if(a===null){var y=f.type;return typeof y=="function"&&!tp(y)&&y.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=y,PS(a,c,y,m,v)):(a=ou(f.type,null,m,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(y=a.child,!Wp(a,v)){var M=y.memoizedProps;if(f=f.compare,f=f!==null?f:Jo,f(M,m)&&a.ref===c.ref)return ui(a,c,v)}return c.flags|=1,a=ri(y,m),a.ref=c.ref,a.return=c,c.child=a}function PS(a,c,f,m,v){if(a!==null){var y=a.memoizedProps;if(Jo(y,m)&&a.ref===c.ref)if(an=!1,c.pendingProps=m=y,Wp(a,v))(a.flags&131072)!==0&&(an=!0);else return c.lanes=a.lanes,ui(a,c,v)}return Up(a,c,f,m,v)}function DS(a,c,f){var m=c.pendingProps,v=m.children,y=a!==null?a.memoizedState:null;if(m.mode==="hidden"){if((c.flags&128)!==0){if(m=y!==null?y.baseLanes|f:f,a!==null){for(v=c.child=a.child,y=0;v!==null;)y=y|v.lanes|v.childLanes,v=v.sibling;c.childLanes=y&~m}else c.childLanes=0,c.child=null;return jS(a,c,m,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&du(c,y!==null?y.cachePool:null),y!==null?Pw(c,y):vp(),wS(c);else return c.lanes=c.childLanes=536870912,jS(a,c,y!==null?y.baseLanes|f:f,f)}else y!==null?(du(c,y.cachePool),Pw(c,y),Pi(),c.memoizedState=null):(a!==null&&du(c,null),vp(),Pi());return un(a,c,v,f),c.child}function jS(a,c,f,m){var v=dp();return v=v===null?null:{parent:Zt._currentValue,pool:v},c.memoizedState={baseLanes:f,cachePool:v},a!==null&&du(c,null),vp(),wS(c),a!==null&&il(a,c,m,!0),null}function Nu(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function Up(a,c,f,m,v){return Es(c),f=bp(a,c,f,m,void 0,v),m=wp(),a!==null&&!an?(Sp(a,c,v),ui(a,c,v)):(Qe&&m&&ip(c),c.flags|=1,un(a,c,f,v),c.child)}function LS(a,c,f,m,v,y){return Es(c),c.updateQueue=null,f=jw(c,m,f,v),Dw(a),m=wp(),a!==null&&!an?(Sp(a,c,y),ui(a,c,y)):(Qe&&m&&ip(c),c.flags|=1,un(a,c,f,y),c.child)}function BS(a,c,f,m,v){if(Es(c),c.stateNode===null){var y=Ma,M=f.contextType;typeof M=="object"&&M!==null&&(y=_n(M)),y=new f(m,y),c.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Lp,c.stateNode=y,y._reactInternals=c,y=c.stateNode,y.props=m,y.state=c.memoizedState,y.refs={},pp(c),M=f.contextType,y.context=typeof M=="object"&&M!==null?_n(M):Ma,y.state=c.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&(jp(c,f,M,m),y.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(M=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),M!==y.state&&Lp.enqueueReplaceState(y,y.state,null),fl(c,m,y,v),ul(),y.state=c.memoizedState),typeof y.componentDidMount=="function"&&(c.flags|=4194308),m=!0}else if(a===null){y=c.stateNode;var F=c.memoizedProps,G=Cs(f,F);y.props=G;var ue=y.context,me=f.contextType;M=Ma,typeof me=="object"&&me!==null&&(M=_n(me));var ve=f.getDerivedStateFromProps;me=typeof ve=="function"||typeof y.getSnapshotBeforeUpdate=="function",F=c.pendingProps!==F,me||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(F||ue!==M)&&TS(c,y,m,M),Ni=!1;var de=c.memoizedState;y.state=de,fl(c,m,y,v),ul(),ue=c.memoizedState,F||de!==ue||Ni?(typeof ve=="function"&&(jp(c,f,ve,m),ue=c.memoizedState),(G=Ni||SS(c,f,G,m,de,ue,M))?(me||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(c.flags|=4194308)):(typeof y.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=m,c.memoizedState=ue),y.props=m,y.state=ue,y.context=M,m=G):(typeof y.componentDidMount=="function"&&(c.flags|=4194308),m=!1)}else{y=c.stateNode,mp(a,c),M=c.memoizedProps,me=Cs(f,M),y.props=me,ve=c.pendingProps,de=y.context,ue=f.contextType,G=Ma,typeof ue=="object"&&ue!==null&&(G=_n(ue)),F=f.getDerivedStateFromProps,(ue=typeof F=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(M!==ve||de!==G)&&TS(c,y,m,G),Ni=!1,de=c.memoizedState,y.state=de,fl(c,m,y,v),ul();var he=c.memoizedState;M!==ve||de!==he||Ni||a!==null&&a.dependencies!==null&&uu(a.dependencies)?(typeof F=="function"&&(jp(c,f,F,m),he=c.memoizedState),(me=Ni||SS(c,f,me,m,de,he,G)||a!==null&&a.dependencies!==null&&uu(a.dependencies))?(ue||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(m,he,G),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(m,he,G)),typeof y.componentDidUpdate=="function"&&(c.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof y.componentDidUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),c.memoizedProps=m,c.memoizedState=he),y.props=m,y.state=he,y.context=G,m=me):(typeof y.componentDidUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),m=!1)}return y=m,Nu(a,c),m=(c.flags&128)!==0,y||m?(y=c.stateNode,f=m&&typeof f.getDerivedStateFromError!="function"?null:y.render(),c.flags|=1,a!==null&&m?(c.child=za(c,a.child,null,v),c.child=za(c,null,f,v)):un(a,c,f,v),c.memoizedState=y.state,a=c.child):a=ui(a,c,v),a}function US(a,c,f,m){return nl(),c.flags|=256,un(a,c,f,m),c.child}var Fp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zp(a){return{baseLanes:a,cachePool:Aw()}}function $p(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=or),a}function FS(a,c,f){var m=c.pendingProps,v=!1,y=(c.flags&128)!==0,M;if((M=y)||(M=a!==null&&a.memoizedState===null?!1:(Qt.current&2)!==0),M&&(v=!0,c.flags&=-129),M=(c.flags&32)!==0,c.flags&=-33,a===null){if(Qe){if(v?Oi(c):Pi(),Qe){var F=It,G;if(G=F){e:{for(G=F,F=Lr;G.nodeType!==8;){if(!F){F=null;break e}if(G=Er(G.nextSibling),G===null){F=null;break e}}F=G}F!==null?(c.memoizedState={dehydrated:F,treeContext:ys!==null?{id:ii,overflow:si}:null,retryLane:536870912,hydrationErrors:null},G=Un(18,null,null,0),G.stateNode=F,G.return=c,c.child=G,Tn=c,It=null,G=!0):G=!1}G||Ss(c)}if(F=c.memoizedState,F!==null&&(F=F.dehydrated,F!==null))return Em(F)?c.lanes=32:c.lanes=536870912,null;ci(c)}return F=m.children,m=m.fallback,v?(Pi(),v=c.mode,F=ku({mode:"hidden",children:F},v),m=xs(m,v,f,null),F.return=c,m.return=c,F.sibling=m,c.child=F,v=c.child,v.memoizedState=zp(f),v.childLanes=$p(a,M,f),c.memoizedState=Fp,m):(Oi(c),Vp(c,F))}if(G=a.memoizedState,G!==null&&(F=G.dehydrated,F!==null)){if(y)c.flags&256?(Oi(c),c.flags&=-257,c=qp(a,c,f)):c.memoizedState!==null?(Pi(),c.child=a.child,c.flags|=128,c=null):(Pi(),v=m.fallback,F=c.mode,m=ku({mode:"visible",children:m.children},F),v=xs(v,F,f,null),v.flags|=2,m.return=c,v.return=c,m.sibling=v,c.child=m,za(c,a.child,null,f),m=c.child,m.memoizedState=zp(f),m.childLanes=$p(a,M,f),c.memoizedState=Fp,c=v);else if(Oi(c),Em(F)){if(M=F.nextSibling&&F.nextSibling.dataset,M)var ue=M.dgst;M=ue,m=Error(r(419)),m.stack="",m.digest=M,rl({value:m,source:null,stack:null}),c=qp(a,c,f)}else if(an||il(a,c,f,!1),M=(f&a.childLanes)!==0,an||M){if(M=vt,M!==null&&(m=f&-f,m=(m&42)!==0?1:Ah(m),m=(m&(M.suspendedLanes|f))!==0?0:m,m!==0&&m!==G.retryLane))throw G.retryLane=m,ka(a,m),qn(M,a,m),MS;F.data==="$?"||lm(),c=qp(a,c,f)}else F.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=G.treeContext,It=Er(F.nextSibling),Tn=c,Qe=!0,ws=null,Lr=!1,a!==null&&(ir[sr++]=ii,ir[sr++]=si,ir[sr++]=ys,ii=a.id,si=a.overflow,ys=c),c=Vp(c,m.children),c.flags|=4096);return c}return v?(Pi(),v=m.fallback,F=c.mode,G=a.child,ue=G.sibling,m=ri(G,{mode:"hidden",children:m.children}),m.subtreeFlags=G.subtreeFlags&65011712,ue!==null?v=ri(ue,v):(v=xs(v,F,f,null),v.flags|=2),v.return=c,m.return=c,m.sibling=v,c.child=m,m=v,v=c.child,F=a.child.memoizedState,F===null?F=zp(f):(G=F.cachePool,G!==null?(ue=Zt._currentValue,G=G.parent!==ue?{parent:ue,pool:ue}:G):G=Aw(),F={baseLanes:F.baseLanes|f,cachePool:G}),v.memoizedState=F,v.childLanes=$p(a,M,f),c.memoizedState=Fp,m):(Oi(c),f=a.child,a=f.sibling,f=ri(f,{mode:"visible",children:m.children}),f.return=c,f.sibling=null,a!==null&&(M=c.deletions,M===null?(c.deletions=[a],c.flags|=16):M.push(a)),c.child=f,c.memoizedState=null,f)}function Vp(a,c){return c=ku({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function ku(a,c){return a=Un(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function qp(a,c,f){return za(c,a.child,null,f),a=Vp(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function zS(a,c,f){a.lanes|=c;var m=a.alternate;m!==null&&(m.lanes|=c),lp(a.return,c,f)}function Hp(a,c,f,m,v){var y=a.memoizedState;y===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:m,tail:f,tailMode:v}:(y.isBackwards=c,y.rendering=null,y.renderingStartTime=0,y.last=m,y.tail=f,y.tailMode=v)}function $S(a,c,f){var m=c.pendingProps,v=m.revealOrder,y=m.tail;if(un(a,c,m.children,f),m=Qt.current,(m&2)!==0)m=m&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&zS(a,f,c);else if(a.tag===19)zS(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}m&=1}switch(se(Qt,m),v){case"forwards":for(f=c.child,v=null;f!==null;)a=f.alternate,a!==null&&Au(a)===null&&(v=f),f=f.sibling;f=v,f===null?(v=c.child,c.child=null):(v=f.sibling,f.sibling=null),Hp(c,!1,v,f,y);break;case"backwards":for(f=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&Au(a)===null){c.child=v;break}a=v.sibling,v.sibling=f,f=v,v=a}Hp(c,!0,f,null,y);break;case"together":Hp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ui(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Ui|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(il(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=ri(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=ri(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Wp(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&uu(a)))}function eL(a,c,f){switch(c.tag){case 3:xe(c,c.stateNode.containerInfo),Ci(c,Zt,a.memoizedState.cache),nl();break;case 27:case 5:Ne(c);break;case 4:xe(c,c.stateNode.containerInfo);break;case 10:Ci(c,c.type,c.memoizedProps.value);break;case 13:var m=c.memoizedState;if(m!==null)return m.dehydrated!==null?(Oi(c),c.flags|=128,null):(f&c.child.childLanes)!==0?FS(a,c,f):(Oi(c),a=ui(a,c,f),a!==null?a.sibling:null);Oi(c);break;case 19:var v=(a.flags&128)!==0;if(m=(f&c.childLanes)!==0,m||(il(a,c,f,!1),m=(f&c.childLanes)!==0),v){if(m)return $S(a,c,f);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),se(Qt,Qt.current),m)break;return null;case 22:case 23:return c.lanes=0,DS(a,c,f);case 24:Ci(c,Zt,a.memoizedState.cache)}return ui(a,c,f)}function VS(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)an=!0;else{if(!Wp(a,f)&&(c.flags&128)===0)return an=!1,eL(a,c,f);an=(a.flags&131072)!==0}else an=!1,Qe&&(c.flags&1048576)!==0&&xw(c,cu,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var m=c.elementType,v=m._init;if(m=v(m._payload),c.type=m,typeof m=="function")tp(m)?(a=Cs(m,a),c.tag=1,c=BS(null,c,m,a,f)):(c.tag=0,c=Up(null,c,m,a,f));else{if(m!=null){if(v=m.$$typeof,v===E){c.tag=11,c=IS(null,c,m,a,f);break e}else if(v===P){c.tag=14,c=OS(null,c,m,a,f);break e}}throw c=j(m)||m,Error(r(306,c,""))}}return c;case 0:return Up(a,c,c.type,c.pendingProps,f);case 1:return m=c.type,v=Cs(m,c.pendingProps),BS(a,c,m,v,f);case 3:e:{if(xe(c,c.stateNode.containerInfo),a===null)throw Error(r(387));m=c.pendingProps;var y=c.memoizedState;v=y.element,mp(a,c),fl(c,m,null,f);var M=c.memoizedState;if(m=M.cache,Ci(c,Zt,m),m!==y.cache&&cp(c,[Zt],f,!0),ul(),m=M.element,y.isDehydrated)if(y={element:m,isDehydrated:!1,cache:M.cache},c.updateQueue.baseState=y,c.memoizedState=y,c.flags&256){c=US(a,c,m,f);break e}else if(m!==v){v=nr(Error(r(424)),c),rl(v),c=US(a,c,m,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(It=Er(a.firstChild),Tn=c,Qe=!0,ws=null,Lr=!0,f=bS(c,null,m,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(nl(),m===v){c=ui(a,c,f);break e}un(a,c,m,f)}c=c.child}return c;case 26:return Nu(a,c),a===null?(f=XT(c.type,null,c.pendingProps,null))?c.memoizedState=f:Qe||(f=c.type,a=c.pendingProps,m=qu(J.current).createElement(f),m[gn]=c,m[Mn]=a,dn(m,f,a),sn(m),c.stateNode=m):c.memoizedState=XT(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Ne(c),a===null&&Qe&&(m=c.stateNode=qT(c.type,c.pendingProps,J.current),Tn=c,Lr=!0,v=It,Vi(c.type)?(Am=v,It=Er(m.firstChild)):It=v),un(a,c,c.pendingProps.children,f),Nu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Qe&&((v=m=It)&&(m=CL(m,c.type,c.pendingProps,Lr),m!==null?(c.stateNode=m,Tn=c,It=Er(m.firstChild),Lr=!1,v=!0):v=!1),v||Ss(c)),Ne(c),v=c.type,y=c.pendingProps,M=a!==null?a.memoizedProps:null,m=y.children,wm(v,y)?m=null:M!==null&&wm(v,M)&&(c.flags|=32),c.memoizedState!==null&&(v=bp(a,c,W6,null,null,f),Ol._currentValue=v),Nu(a,c),un(a,c,m,f),c.child;case 6:return a===null&&Qe&&((a=f=It)&&(f=NL(f,c.pendingProps,Lr),f!==null?(c.stateNode=f,Tn=c,It=null,a=!0):a=!1),a||Ss(c)),null;case 13:return FS(a,c,f);case 4:return xe(c,c.stateNode.containerInfo),m=c.pendingProps,a===null?c.child=za(c,null,m,f):un(a,c,m,f),c.child;case 11:return IS(a,c,c.type,c.pendingProps,f);case 7:return un(a,c,c.pendingProps,f),c.child;case 8:return un(a,c,c.pendingProps.children,f),c.child;case 12:return un(a,c,c.pendingProps.children,f),c.child;case 10:return m=c.pendingProps,Ci(c,c.type,m.value),un(a,c,m.children,f),c.child;case 9:return v=c.type._context,m=c.pendingProps.children,Es(c),v=_n(v),m=m(v),c.flags|=1,un(a,c,m,f),c.child;case 14:return OS(a,c,c.type,c.pendingProps,f);case 15:return PS(a,c,c.type,c.pendingProps,f);case 19:return $S(a,c,f);case 31:return m=c.pendingProps,f=c.mode,m={mode:m.mode,children:m.children},a===null?(f=ku(m,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=ri(a.child,m),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return DS(a,c,f);case 24:return Es(c),m=_n(Zt),a===null?(v=dp(),v===null&&(v=vt,y=up(),v.pooledCache=y,y.refCount++,y!==null&&(v.pooledCacheLanes|=f),v=y),c.memoizedState={parent:m,cache:v},pp(c),Ci(c,Zt,v)):((a.lanes&f)!==0&&(mp(a,c),fl(c,null,null,f),ul()),v=a.memoizedState,y=c.memoizedState,v.parent!==m?(v={parent:m,cache:m},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),Ci(c,Zt,m)):(m=y.cache,Ci(c,Zt,m),m!==v.cache&&cp(c,[Zt],f,!0))),un(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function fi(a){a.flags|=4}function qS(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!QT(c)){if(c=ar.current,c!==null&&((Ye&4194048)===Ye?Br!==null:(Ye&62914560)!==Ye&&(Ye&536870912)===0||c!==Br))throw ll=hp,Rw;a.flags|=8192}}function Mu(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Ct():536870912,a.lanes|=c,Ha|=c)}function vl(a,c){if(!Qe)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Nt(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,m=0;if(c)for(var v=a.child;v!==null;)f|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)f|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=m,a.childLanes=f,c}function tL(a,c,f){var m=c.pendingProps;switch(sp(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nt(c),null;case 1:return Nt(c),null;case 3:return f=c.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),c.memoizedState.cache!==m&&(c.flags|=2048),oi(Zt),Ae(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(tl(c)?fi(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,ww())),Nt(c),null;case 26:return f=c.memoizedState,a===null?(fi(c),f!==null?(Nt(c),qS(c,f)):(Nt(c),c.flags&=-16777217)):f?f!==a.memoizedState?(fi(c),Nt(c),qS(c,f)):(Nt(c),c.flags&=-16777217):(a.memoizedProps!==m&&fi(c),Nt(c),c.flags&=-16777217),null;case 27:be(c),f=J.current;var v=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==m&&fi(c);else{if(!m){if(c.stateNode===null)throw Error(r(166));return Nt(c),null}a=z.current,tl(c)?yw(c):(a=qT(v,m,f),c.stateNode=a,fi(c))}return Nt(c),null;case 5:if(be(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==m&&fi(c);else{if(!m){if(c.stateNode===null)throw Error(r(166));return Nt(c),null}if(a=z.current,tl(c))yw(c);else{switch(v=qu(J.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof m.is=="string"?v.createElement("select",{is:m.is}):v.createElement("select"),m.multiple?a.multiple=!0:m.size&&(a.size=m.size);break;default:a=typeof m.is=="string"?v.createElement(f,{is:m.is}):v.createElement(f)}}a[gn]=c,a[Mn]=m;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=a;e:switch(dn(a,f,m),f){case"button":case"input":case"select":case"textarea":a=!!m.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&fi(c)}}return Nt(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==m&&fi(c);else{if(typeof m!="string"&&c.stateNode===null)throw Error(r(166));if(a=J.current,tl(c)){if(a=c.stateNode,f=c.memoizedProps,m=null,v=Tn,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}a[gn]=c,a=!!(a.nodeValue===f||m!==null&&m.suppressHydrationWarning===!0||LT(a.nodeValue,f)),a||Ss(c)}else a=qu(a).createTextNode(m),a[gn]=c,c.stateNode=a}return Nt(c),null;case 13:if(m=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=tl(c),m!==null&&m.dehydrated!==null){if(a===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[gn]=c}else nl(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Nt(c),v=!1}else v=ww(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(ci(c),c):(ci(c),null)}if(ci(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=m!==null,a=a!==null&&a.memoizedState!==null,f){m=c.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool);var y=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(y=m.memoizedState.cachePool.pool),y!==v&&(m.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),Mu(c,c.updateQueue),Nt(c),null;case 4:return Ae(),a===null&&_m(c.stateNode.containerInfo),Nt(c),null;case 10:return oi(c.type),Nt(c),null;case 19:if(fe(Qt),v=c.memoizedState,v===null)return Nt(c),null;if(m=(c.flags&128)!==0,y=v.rendering,y===null)if(m)vl(v,!1);else{if(Ot!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(y=Au(a),y!==null){for(c.flags|=128,vl(v,!1),a=y.updateQueue,c.updateQueue=a,Mu(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)vw(f,a),f=f.sibling;return se(Qt,Qt.current&1|2),c.child}a=a.sibling}v.tail!==null&&Ie()>Pu&&(c.flags|=128,m=!0,vl(v,!1),c.lanes=4194304)}else{if(!m)if(a=Au(y),a!==null){if(c.flags|=128,m=!0,a=a.updateQueue,c.updateQueue=a,Mu(c,a),vl(v,!0),v.tail===null&&v.tailMode==="hidden"&&!y.alternate&&!Qe)return Nt(c),null}else 2*Ie()-v.renderingStartTime>Pu&&f!==536870912&&(c.flags|=128,m=!0,vl(v,!1),c.lanes=4194304);v.isBackwards?(y.sibling=c.child,c.child=y):(a=v.last,a!==null?a.sibling=y:c.child=y,v.last=y)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Ie(),c.sibling=null,a=Qt.current,se(Qt,m?a&1|2:a&1),c):(Nt(c),null);case 22:case 23:return ci(c),xp(),m=c.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(c.flags|=8192):m&&(c.flags|=8192),m?(f&536870912)!==0&&(c.flags&128)===0&&(Nt(c),c.subtreeFlags&6&&(c.flags|=8192)):Nt(c),f=c.updateQueue,f!==null&&Mu(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),m=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==f&&(c.flags|=2048),a!==null&&fe(As),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),oi(Zt),Nt(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function nL(a,c){switch(sp(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return oi(Zt),Ae(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return be(c),null;case 13:if(ci(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));nl()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return fe(Qt),null;case 4:return Ae(),null;case 10:return oi(c.type),null;case 22:case 23:return ci(c),xp(),a!==null&&fe(As),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return oi(Zt),null;case 25:return null;default:return null}}function HS(a,c){switch(sp(c),c.tag){case 3:oi(Zt),Ae();break;case 26:case 27:case 5:be(c);break;case 4:Ae();break;case 13:ci(c);break;case 19:fe(Qt);break;case 10:oi(c.type);break;case 22:case 23:ci(c),xp(),a!==null&&fe(As);break;case 24:oi(Zt)}}function xl(a,c){try{var f=c.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var v=m.next;f=v;do{if((f.tag&a)===a){m=void 0;var y=f.create,M=f.inst;m=y(),M.destroy=m}f=f.next}while(f!==v)}}catch(F){mt(c,c.return,F)}}function Di(a,c,f){try{var m=c.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var y=v.next;m=y;do{if((m.tag&a)===a){var M=m.inst,F=M.destroy;if(F!==void 0){M.destroy=void 0,v=c;var G=f,ue=F;try{ue()}catch(me){mt(v,G,me)}}}m=m.next}while(m!==y)}}catch(me){mt(c,c.return,me)}}function WS(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{Ow(c,f)}catch(m){mt(a,a.return,m)}}}function XS(a,c,f){f.props=Cs(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(m){mt(a,c,m)}}function yl(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof f=="function"?a.refCleanup=f(m):f.current=m}}catch(v){mt(a,c,v)}}function Ur(a,c){var f=a.ref,m=a.refCleanup;if(f!==null)if(typeof m=="function")try{m()}catch(v){mt(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(v){mt(a,c,v)}else f.current=null}function YS(a){var c=a.type,f=a.memoizedProps,m=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&m.focus();break e;case"img":f.src?m.src=f.src:f.srcSet&&(m.srcset=f.srcSet)}}catch(v){mt(a,a.return,v)}}function Xp(a,c,f){try{var m=a.stateNode;SL(m,a.type,f,c),m[Mn]=c}catch(v){mt(a,a.return,v)}}function GS(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Vi(a.type)||a.tag===4}function Yp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||GS(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Vi(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Gp(a,c,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Vu));else if(m!==4&&(m===27&&Vi(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Gp(a,c,f),a=a.sibling;a!==null;)Gp(a,c,f),a=a.sibling}function Iu(a,c,f){var m=a.tag;if(m===5||m===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(m!==4&&(m===27&&Vi(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(Iu(a,c,f),a=a.sibling;a!==null;)Iu(a,c,f),a=a.sibling}function KS(a){var c=a.stateNode,f=a.memoizedProps;try{for(var m=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);dn(c,m,f),c[gn]=a,c[Mn]=f}catch(y){mt(a,a.return,y)}}var di=!1,Ut=!1,Kp=!1,ZS=typeof WeakSet=="function"?WeakSet:Set,on=null;function rL(a,c){if(a=a.containerInfo,ym=Ku,a=lw(a),Yh(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var m=f.getSelection&&f.getSelection();if(m&&m.rangeCount!==0){f=m.anchorNode;var v=m.anchorOffset,y=m.focusNode;m=m.focusOffset;try{f.nodeType,y.nodeType}catch{f=null;break e}var M=0,F=-1,G=-1,ue=0,me=0,ve=a,de=null;t:for(;;){for(var he;ve!==f||v!==0&&ve.nodeType!==3||(F=M+v),ve!==y||m!==0&&ve.nodeType!==3||(G=M+m),ve.nodeType===3&&(M+=ve.nodeValue.length),(he=ve.firstChild)!==null;)de=ve,ve=he;for(;;){if(ve===a)break t;if(de===f&&++ue===v&&(F=M),de===y&&++me===m&&(G=M),(he=ve.nextSibling)!==null)break;ve=de,de=ve.parentNode}ve=he}f=F===-1||G===-1?null:{start:F,end:G}}else f=null}f=f||{start:0,end:0}}else f=null;for(bm={focusedElem:a,selectionRange:f},Ku=!1,on=c;on!==null;)if(c=on,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,on=a;else for(;on!==null;){switch(c=on,y=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&y!==null){a=void 0,f=c,v=y.memoizedProps,y=y.memoizedState,m=f.stateNode;try{var Be=Cs(f.type,v,f.elementType===f.type);a=m.getSnapshotBeforeUpdate(Be,y),m.__reactInternalSnapshotBeforeUpdate=a}catch(Pe){mt(f,f.return,Pe)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)Tm(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Tm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,on=a;break}on=c.return}}function QS(a,c,f){var m=f.flags;switch(f.tag){case 0:case 11:case 15:ji(a,f),m&4&&xl(5,f);break;case 1:if(ji(a,f),m&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(M){mt(f,f.return,M)}else{var v=Cs(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(M){mt(f,f.return,M)}}m&64&&WS(f),m&512&&yl(f,f.return);break;case 3:if(ji(a,f),m&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{Ow(a,c)}catch(M){mt(f,f.return,M)}}break;case 27:c===null&&m&4&&KS(f);case 26:case 5:ji(a,f),c===null&&m&4&&YS(f),m&512&&yl(f,f.return);break;case 12:ji(a,f);break;case 13:ji(a,f),m&4&&tT(a,f),m&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=dL.bind(null,f),kL(a,f))));break;case 22:if(m=f.memoizedState!==null||di,!m){c=c!==null&&c.memoizedState!==null||Ut,v=di;var y=Ut;di=m,(Ut=c)&&!y?Li(a,f,(f.subtreeFlags&8772)!==0):ji(a,f),di=v,Ut=y}break;case 30:break;default:ji(a,f)}}function JS(a){var c=a.alternate;c!==null&&(a.alternate=null,JS(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&Nh(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var St=null,Pn=!1;function hi(a,c,f){for(f=f.child;f!==null;)eT(a,c,f),f=f.sibling}function eT(a,c,f){if(qe&&typeof qe.onCommitFiberUnmount=="function")try{qe.onCommitFiberUnmount(nt,f)}catch{}switch(f.tag){case 26:Ut||Ur(f,c),hi(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Ut||Ur(f,c);var m=St,v=Pn;Vi(f.type)&&(St=f.stateNode,Pn=!1),hi(a,c,f),Nl(f.stateNode),St=m,Pn=v;break;case 5:Ut||Ur(f,c);case 6:if(m=St,v=Pn,St=null,hi(a,c,f),St=m,Pn=v,St!==null)if(Pn)try{(St.nodeType===9?St.body:St.nodeName==="HTML"?St.ownerDocument.body:St).removeChild(f.stateNode)}catch(y){mt(f,c,y)}else try{St.removeChild(f.stateNode)}catch(y){mt(f,c,y)}break;case 18:St!==null&&(Pn?(a=St,$T(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),Ll(a)):$T(St,f.stateNode));break;case 4:m=St,v=Pn,St=f.stateNode.containerInfo,Pn=!0,hi(a,c,f),St=m,Pn=v;break;case 0:case 11:case 14:case 15:Ut||Di(2,f,c),Ut||Di(4,f,c),hi(a,c,f);break;case 1:Ut||(Ur(f,c),m=f.stateNode,typeof m.componentWillUnmount=="function"&&XS(f,c,m)),hi(a,c,f);break;case 21:hi(a,c,f);break;case 22:Ut=(m=Ut)||f.memoizedState!==null,hi(a,c,f),Ut=m;break;default:hi(a,c,f)}}function tT(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Ll(a)}catch(f){mt(c,c.return,f)}}function iL(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new ZS),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new ZS),c;default:throw Error(r(435,a.tag))}}function Zp(a,c){var f=iL(a);c.forEach(function(m){var v=hL.bind(null,a,m);f.has(m)||(f.add(m),m.then(v,v))})}function Fn(a,c){var f=c.deletions;if(f!==null)for(var m=0;m<f.length;m++){var v=f[m],y=a,M=c,F=M;e:for(;F!==null;){switch(F.tag){case 27:if(Vi(F.type)){St=F.stateNode,Pn=!1;break e}break;case 5:St=F.stateNode,Pn=!1;break e;case 3:case 4:St=F.stateNode.containerInfo,Pn=!0;break e}F=F.return}if(St===null)throw Error(r(160));eT(y,M,v),St=null,Pn=!1,y=v.alternate,y!==null&&(y.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)nT(c,a),c=c.sibling}var Tr=null;function nT(a,c){var f=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Fn(c,a),zn(a),m&4&&(Di(3,a,a.return),xl(3,a),Di(5,a,a.return));break;case 1:Fn(c,a),zn(a),m&512&&(Ut||f===null||Ur(f,f.return)),m&64&&di&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?m:f.concat(m))));break;case 26:var v=Tr;if(Fn(c,a),zn(a),m&512&&(Ut||f===null||Ur(f,f.return)),m&4){var y=f!==null?f.memoizedState:null;if(m=a.memoizedState,f===null)if(m===null)if(a.stateNode===null){e:{m=a.type,f=a.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":y=v.getElementsByTagName("title")[0],(!y||y[qo]||y[gn]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=v.createElement(m),v.head.insertBefore(y,v.querySelector("head > title"))),dn(y,m,f),y[gn]=a,sn(y),m=y;break e;case"link":var M=KT("link","href",v).get(m+(f.href||""));if(M){for(var F=0;F<M.length;F++)if(y=M[F],y.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&y.getAttribute("rel")===(f.rel==null?null:f.rel)&&y.getAttribute("title")===(f.title==null?null:f.title)&&y.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){M.splice(F,1);break t}}y=v.createElement(m),dn(y,m,f),v.head.appendChild(y);break;case"meta":if(M=KT("meta","content",v).get(m+(f.content||""))){for(F=0;F<M.length;F++)if(y=M[F],y.getAttribute("content")===(f.content==null?null:""+f.content)&&y.getAttribute("name")===(f.name==null?null:f.name)&&y.getAttribute("property")===(f.property==null?null:f.property)&&y.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&y.getAttribute("charset")===(f.charSet==null?null:f.charSet)){M.splice(F,1);break t}}y=v.createElement(m),dn(y,m,f),v.head.appendChild(y);break;default:throw Error(r(468,m))}y[gn]=a,sn(y),m=y}a.stateNode=m}else ZT(v,a.type,a.stateNode);else a.stateNode=GT(v,m,a.memoizedProps);else y!==m?(y===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):y.count--,m===null?ZT(v,a.type,a.stateNode):GT(v,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Xp(a,a.memoizedProps,f.memoizedProps)}break;case 27:Fn(c,a),zn(a),m&512&&(Ut||f===null||Ur(f,f.return)),f!==null&&m&4&&Xp(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Fn(c,a),zn(a),m&512&&(Ut||f===null||Ur(f,f.return)),a.flags&32){v=a.stateNode;try{Sa(v,"")}catch(he){mt(a,a.return,he)}}m&4&&a.stateNode!=null&&(v=a.memoizedProps,Xp(a,v,f!==null?f.memoizedProps:v)),m&1024&&(Kp=!0);break;case 6:if(Fn(c,a),zn(a),m&4){if(a.stateNode===null)throw Error(r(162));m=a.memoizedProps,f=a.stateNode;try{f.nodeValue=m}catch(he){mt(a,a.return,he)}}break;case 3:if(Xu=null,v=Tr,Tr=Hu(c.containerInfo),Fn(c,a),Tr=v,zn(a),m&4&&f!==null&&f.memoizedState.isDehydrated)try{Ll(c.containerInfo)}catch(he){mt(a,a.return,he)}Kp&&(Kp=!1,rT(a));break;case 4:m=Tr,Tr=Hu(a.stateNode.containerInfo),Fn(c,a),zn(a),Tr=m;break;case 12:Fn(c,a),zn(a);break;case 13:Fn(c,a),zn(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(rm=Ie()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Zp(a,m)));break;case 22:v=a.memoizedState!==null;var G=f!==null&&f.memoizedState!==null,ue=di,me=Ut;if(di=ue||v,Ut=me||G,Fn(c,a),Ut=me,di=ue,zn(a),m&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(f===null||G||di||Ut||Ns(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){G=f=c;try{if(y=G.stateNode,v)M=y.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{F=G.stateNode;var ve=G.memoizedProps.style,de=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;F.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(he){mt(G,G.return,he)}}}else if(c.tag===6){if(f===null){G=c;try{G.stateNode.nodeValue=v?"":G.memoizedProps}catch(he){mt(G,G.return,he)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}m&4&&(m=a.updateQueue,m!==null&&(f=m.retryQueue,f!==null&&(m.retryQueue=null,Zp(a,f))));break;case 19:Fn(c,a),zn(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Zp(a,m)));break;case 30:break;case 21:break;default:Fn(c,a),zn(a)}}function zn(a){var c=a.flags;if(c&2){try{for(var f,m=a.return;m!==null;){if(GS(m)){f=m;break}m=m.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var v=f.stateNode,y=Yp(a);Iu(a,y,v);break;case 5:var M=f.stateNode;f.flags&32&&(Sa(M,""),f.flags&=-33);var F=Yp(a);Iu(a,F,M);break;case 3:case 4:var G=f.stateNode.containerInfo,ue=Yp(a);Gp(a,ue,G);break;default:throw Error(r(161))}}catch(me){mt(a,a.return,me)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function rT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;rT(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function ji(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)QS(a,c.alternate,c),c=c.sibling}function Ns(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Di(4,c,c.return),Ns(c);break;case 1:Ur(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&XS(c,c.return,f),Ns(c);break;case 27:Nl(c.stateNode);case 26:case 5:Ur(c,c.return),Ns(c);break;case 22:c.memoizedState===null&&Ns(c);break;case 30:Ns(c);break;default:Ns(c)}a=a.sibling}}function Li(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var m=c.alternate,v=a,y=c,M=y.flags;switch(y.tag){case 0:case 11:case 15:Li(v,y,f),xl(4,y);break;case 1:if(Li(v,y,f),m=y,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(ue){mt(m,m.return,ue)}if(m=y,v=m.updateQueue,v!==null){var F=m.stateNode;try{var G=v.shared.hiddenCallbacks;if(G!==null)for(v.shared.hiddenCallbacks=null,v=0;v<G.length;v++)Iw(G[v],F)}catch(ue){mt(m,m.return,ue)}}f&&M&64&&WS(y),yl(y,y.return);break;case 27:KS(y);case 26:case 5:Li(v,y,f),f&&m===null&&M&4&&YS(y),yl(y,y.return);break;case 12:Li(v,y,f);break;case 13:Li(v,y,f),f&&M&4&&tT(v,y);break;case 22:y.memoizedState===null&&Li(v,y,f),yl(y,y.return);break;case 30:break;default:Li(v,y,f)}c=c.sibling}}function Qp(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&sl(f))}function Jp(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&sl(a))}function Fr(a,c,f,m){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)iT(a,c,f,m),c=c.sibling}function iT(a,c,f,m){var v=c.flags;switch(c.tag){case 0:case 11:case 15:Fr(a,c,f,m),v&2048&&xl(9,c);break;case 1:Fr(a,c,f,m);break;case 3:Fr(a,c,f,m),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&sl(a)));break;case 12:if(v&2048){Fr(a,c,f,m),a=c.stateNode;try{var y=c.memoizedProps,M=y.id,F=y.onPostCommit;typeof F=="function"&&F(M,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(G){mt(c,c.return,G)}}else Fr(a,c,f,m);break;case 13:Fr(a,c,f,m);break;case 23:break;case 22:y=c.stateNode,M=c.alternate,c.memoizedState!==null?y._visibility&2?Fr(a,c,f,m):bl(a,c):y._visibility&2?Fr(a,c,f,m):(y._visibility|=2,$a(a,c,f,m,(c.subtreeFlags&10256)!==0)),v&2048&&Qp(M,c);break;case 24:Fr(a,c,f,m),v&2048&&Jp(c.alternate,c);break;default:Fr(a,c,f,m)}}function $a(a,c,f,m,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var y=a,M=c,F=f,G=m,ue=M.flags;switch(M.tag){case 0:case 11:case 15:$a(y,M,F,G,v),xl(8,M);break;case 23:break;case 22:var me=M.stateNode;M.memoizedState!==null?me._visibility&2?$a(y,M,F,G,v):bl(y,M):(me._visibility|=2,$a(y,M,F,G,v)),v&&ue&2048&&Qp(M.alternate,M);break;case 24:$a(y,M,F,G,v),v&&ue&2048&&Jp(M.alternate,M);break;default:$a(y,M,F,G,v)}c=c.sibling}}function bl(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,m=c,v=m.flags;switch(m.tag){case 22:bl(f,m),v&2048&&Qp(m.alternate,m);break;case 24:bl(f,m),v&2048&&Jp(m.alternate,m);break;default:bl(f,m)}c=c.sibling}}var wl=8192;function Va(a){if(a.subtreeFlags&wl)for(a=a.child;a!==null;)sT(a),a=a.sibling}function sT(a){switch(a.tag){case 26:Va(a),a.flags&wl&&a.memoizedState!==null&&VL(Tr,a.memoizedState,a.memoizedProps);break;case 5:Va(a);break;case 3:case 4:var c=Tr;Tr=Hu(a.stateNode.containerInfo),Va(a),Tr=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=wl,wl=16777216,Va(a),wl=c):Va(a));break;default:Va(a)}}function aT(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function Sl(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];on=m,lT(m,a)}aT(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)oT(a),a=a.sibling}function oT(a){switch(a.tag){case 0:case 11:case 15:Sl(a),a.flags&2048&&Di(9,a,a.return);break;case 3:Sl(a);break;case 12:Sl(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Ou(a)):Sl(a);break;default:Sl(a)}}function Ou(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var m=c[f];on=m,lT(m,a)}aT(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Di(8,c,c.return),Ou(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Ou(c));break;default:Ou(c)}a=a.sibling}}function lT(a,c){for(;on!==null;){var f=on;switch(f.tag){case 0:case 11:case 15:Di(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var m=f.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:sl(f.memoizedState.cache)}if(m=f.child,m!==null)m.return=f,on=m;else e:for(f=a;on!==null;){m=on;var v=m.sibling,y=m.return;if(JS(m),m===f){on=null;break e}if(v!==null){v.return=y,on=v;break e}on=y}}}var sL={getCacheForType:function(a){var c=_n(Zt),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},aL=typeof WeakMap=="function"?WeakMap:Map,st=0,vt=null,He=null,Ye=0,at=0,$n=null,Bi=!1,qa=!1,em=!1,pi=0,Ot=0,Ui=0,ks=0,tm=0,or=0,Ha=0,Tl=null,Dn=null,nm=!1,rm=0,Pu=1/0,Du=null,Fi=null,fn=0,zi=null,Wa=null,Xa=0,im=0,sm=null,cT=null,El=0,am=null;function Vn(){if((st&2)!==0&&Ye!==0)return Ye&-Ye;if($.T!==null){var a=Pa;return a!==0?a:hm()}return E2()}function uT(){or===0&&(or=(Ye&536870912)===0||Qe?lt():536870912);var a=ar.current;return a!==null&&(a.flags|=32),or}function qn(a,c,f){(a===vt&&(at===2||at===9)||a.cancelPendingCommit!==null)&&(Ya(a,0),$i(a,Ye,or,!1)),wt(a,f),((st&2)===0||a!==vt)&&(a===vt&&((st&2)===0&&(ks|=f),Ot===4&&$i(a,Ye,or,!1)),zr(a))}function fT(a,c,f){if((st&6)!==0)throw Error(r(327));var m=!f&&(c&124)===0&&(c&a.expiredLanes)===0||Jn(a,c),v=m?cL(a,c):cm(a,c,!0),y=m;do{if(v===0){qa&&!m&&$i(a,c,0,!1);break}else{if(f=a.current.alternate,y&&!oL(f)){v=cm(a,c,!1),y=!1;continue}if(v===2){if(y=c,a.errorRecoveryDisabledLanes&y)var M=0;else M=a.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){c=M;e:{var F=a;v=Tl;var G=F.current.memoizedState.isDehydrated;if(G&&(Ya(F,M).flags|=256),M=cm(F,M,!1),M!==2){if(em&&!G){F.errorRecoveryDisabledLanes|=y,ks|=y,v=4;break e}y=Dn,Dn=v,y!==null&&(Dn===null?Dn=y:Dn.push.apply(Dn,y))}v=M}if(y=!1,v!==2)continue}}if(v===1){Ya(a,0),$i(a,c,0,!0);break}e:{switch(m=a,y=v,y){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:$i(m,c,or,!Bi);break e;case 2:Dn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(v=rm+300-Ie(),10<v)){if($i(m,c,or,!Bi),wr(m,0,!0)!==0)break e;m.timeoutHandle=FT(dT.bind(null,m,f,Dn,Du,nm,c,or,ks,Ha,Bi,y,2,-0,0),v);break e}dT(m,f,Dn,Du,nm,c,or,ks,Ha,Bi,y,0,-0,0)}}break}while(!0);zr(a)}function dT(a,c,f,m,v,y,M,F,G,ue,me,ve,de,he){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(Il={stylesheets:null,count:0,unsuspend:$L},sT(c),ve=qL(),ve!==null)){a.cancelPendingCommit=ve(xT.bind(null,a,c,y,f,m,v,M,F,G,me,1,de,he)),$i(a,y,M,!ue);return}xT(a,c,y,f,m,v,M,F,G)}function oL(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var m=0;m<f.length;m++){var v=f[m],y=v.getSnapshot;v=v.value;try{if(!Bn(y(),v))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function $i(a,c,f,m){c&=~tm,c&=~ks,a.suspendedLanes|=c,a.pingedLanes&=~c,m&&(a.warmLanes|=c),m=a.expirationTimes;for(var v=c;0<v;){var y=31-yt(v),M=1<<y;m[y]=-1,v&=~M}f!==0&&Vo(a,f,c)}function ju(){return(st&6)===0?(Al(0),!1):!0}function om(){if(He!==null){if(at===0)var a=He.return;else a=He,ai=Ts=null,Tp(a),Fa=null,gl=0,a=He;for(;a!==null;)HS(a.alternate,a),a=a.return;He=null}}function Ya(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,EL(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),om(),vt=a,He=f=ri(a.current,null),Ye=c,at=0,$n=null,Bi=!1,qa=Jn(a,c),em=!1,Ha=or=tm=ks=Ui=Ot=0,Dn=Tl=null,nm=!1,(c&8)!==0&&(c|=c&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=c;0<m;){var v=31-yt(m),y=1<<v;c|=a[v],m&=~y}return pi=c,iu(),f}function hT(a,c){$e=null,$.H=Su,c===ol||c===hu?(c=kw(),at=3):c===Rw?(c=kw(),at=4):at=c===MS?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,$n=c,He===null&&(Ot=1,Cu(a,nr(c,a.current)))}function pT(){var a=$.H;return $.H=Su,a===null?Su:a}function mT(){var a=$.A;return $.A=sL,a}function lm(){Ot=4,Bi||(Ye&4194048)!==Ye&&ar.current!==null||(qa=!0),(Ui&134217727)===0&&(ks&134217727)===0||vt===null||$i(vt,Ye,or,!1)}function cm(a,c,f){var m=st;st|=2;var v=pT(),y=mT();(vt!==a||Ye!==c)&&(Du=null,Ya(a,c)),c=!1;var M=Ot;e:do try{if(at!==0&&He!==null){var F=He,G=$n;switch(at){case 8:om(),M=6;break e;case 3:case 2:case 9:case 6:ar.current===null&&(c=!0);var ue=at;if(at=0,$n=null,Ga(a,F,G,ue),f&&qa){M=0;break e}break;default:ue=at,at=0,$n=null,Ga(a,F,G,ue)}}lL(),M=Ot;break}catch(me){hT(a,me)}while(!0);return c&&a.shellSuspendCounter++,ai=Ts=null,st=m,$.H=v,$.A=y,He===null&&(vt=null,Ye=0,iu()),M}function lL(){for(;He!==null;)gT(He)}function cL(a,c){var f=st;st|=2;var m=pT(),v=mT();vt!==a||Ye!==c?(Du=null,Pu=Ie()+500,Ya(a,c)):qa=Jn(a,c);e:do try{if(at!==0&&He!==null){c=He;var y=$n;t:switch(at){case 1:at=0,$n=null,Ga(a,c,y,1);break;case 2:case 9:if(Cw(y)){at=0,$n=null,_T(c);break}c=function(){at!==2&&at!==9||vt!==a||(at=7),zr(a)},y.then(c,c);break e;case 3:at=7;break e;case 4:at=5;break e;case 7:Cw(y)?(at=0,$n=null,_T(c)):(at=0,$n=null,Ga(a,c,y,7));break;case 5:var M=null;switch(He.tag){case 26:M=He.memoizedState;case 5:case 27:var F=He;if(!M||QT(M)){at=0,$n=null;var G=F.sibling;if(G!==null)He=G;else{var ue=F.return;ue!==null?(He=ue,Lu(ue)):He=null}break t}}at=0,$n=null,Ga(a,c,y,5);break;case 6:at=0,$n=null,Ga(a,c,y,6);break;case 8:om(),Ot=6;break e;default:throw Error(r(462))}}uL();break}catch(me){hT(a,me)}while(!0);return ai=Ts=null,$.H=m,$.A=v,st=f,He!==null?0:(vt=null,Ye=0,iu(),Ot)}function uL(){for(;He!==null&&!Le();)gT(He)}function gT(a){var c=VS(a.alternate,a,pi);a.memoizedProps=a.pendingProps,c===null?Lu(a):He=c}function _T(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=LS(f,c,c.pendingProps,c.type,void 0,Ye);break;case 11:c=LS(f,c,c.pendingProps,c.type.render,c.ref,Ye);break;case 5:Tp(c);default:HS(f,c),c=He=vw(c,pi),c=VS(f,c,pi)}a.memoizedProps=a.pendingProps,c===null?Lu(a):He=c}function Ga(a,c,f,m){ai=Ts=null,Tp(c),Fa=null,gl=0;var v=c.return;try{if(J6(a,v,c,f,Ye)){Ot=1,Cu(a,nr(f,a.current)),He=null;return}}catch(y){if(v!==null)throw He=v,y;Ot=1,Cu(a,nr(f,a.current)),He=null;return}c.flags&32768?(Qe||m===1?a=!0:qa||(Ye&536870912)!==0?a=!1:(Bi=a=!0,(m===2||m===9||m===3||m===6)&&(m=ar.current,m!==null&&m.tag===13&&(m.flags|=16384))),vT(c,a)):Lu(c)}function Lu(a){var c=a;do{if((c.flags&32768)!==0){vT(c,Bi);return}a=c.return;var f=tL(c.alternate,c,pi);if(f!==null){He=f;return}if(c=c.sibling,c!==null){He=c;return}He=c=a}while(c!==null);Ot===0&&(Ot=5)}function vT(a,c){do{var f=nL(a.alternate,a);if(f!==null){f.flags&=32767,He=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){He=a;return}He=a=f}while(a!==null);Ot=6,He=null}function xT(a,c,f,m,v,y,M,F,G){a.cancelPendingCommit=null;do Bu();while(fn!==0);if((st&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(y=c.lanes|c.childLanes,y|=Jh,ma(a,f,y,M,F,G),a===vt&&(He=vt=null,Ye=0),Wa=c,zi=a,Xa=f,im=y,sm=v,cT=m,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,pL(Mt,function(){return TT(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||m){m=$.T,$.T=null,v=Q.p,Q.p=2,M=st,st|=4;try{rL(a,c,f)}finally{st=M,Q.p=v,$.T=m}}fn=1,yT(),bT(),wT()}}function yT(){if(fn===1){fn=0;var a=zi,c=Wa,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=$.T,$.T=null;var m=Q.p;Q.p=2;var v=st;st|=4;try{nT(c,a);var y=bm,M=lw(a.containerInfo),F=y.focusedElem,G=y.selectionRange;if(M!==F&&F&&F.ownerDocument&&ow(F.ownerDocument.documentElement,F)){if(G!==null&&Yh(F)){var ue=G.start,me=G.end;if(me===void 0&&(me=ue),"selectionStart"in F)F.selectionStart=ue,F.selectionEnd=Math.min(me,F.value.length);else{var ve=F.ownerDocument||document,de=ve&&ve.defaultView||window;if(de.getSelection){var he=de.getSelection(),Be=F.textContent.length,Pe=Math.min(G.start,Be),ft=G.end===void 0?Pe:Math.min(G.end,Be);!he.extend&&Pe>ft&&(M=ft,ft=Pe,Pe=M);var ie=aw(F,Pe),ee=aw(F,ft);if(ie&&ee&&(he.rangeCount!==1||he.anchorNode!==ie.node||he.anchorOffset!==ie.offset||he.focusNode!==ee.node||he.focusOffset!==ee.offset)){var ce=ve.createRange();ce.setStart(ie.node,ie.offset),he.removeAllRanges(),Pe>ft?(he.addRange(ce),he.extend(ee.node,ee.offset)):(ce.setEnd(ee.node,ee.offset),he.addRange(ce))}}}}for(ve=[],he=F;he=he.parentNode;)he.nodeType===1&&ve.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<ve.length;F++){var ge=ve[F];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}Ku=!!ym,bm=ym=null}finally{st=v,Q.p=m,$.T=f}}a.current=c,fn=2}}function bT(){if(fn===2){fn=0;var a=zi,c=Wa,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=$.T,$.T=null;var m=Q.p;Q.p=2;var v=st;st|=4;try{QS(a,c.alternate,c)}finally{st=v,Q.p=m,$.T=f}}fn=3}}function wT(){if(fn===4||fn===3){fn=0,Kt();var a=zi,c=Wa,f=Xa,m=cT;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?fn=5:(fn=0,Wa=zi=null,ST(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Fi=null),Rh(f),c=c.stateNode,qe&&typeof qe.onCommitFiberRoot=="function")try{qe.onCommitFiberRoot(nt,c,void 0,(c.current.flags&128)===128)}catch{}if(m!==null){c=$.T,v=Q.p,Q.p=2,$.T=null;try{for(var y=a.onRecoverableError,M=0;M<m.length;M++){var F=m[M];y(F.value,{componentStack:F.stack})}}finally{$.T=c,Q.p=v}}(Xa&3)!==0&&Bu(),zr(a),v=a.pendingLanes,(f&4194090)!==0&&(v&42)!==0?a===am?El++:(El=0,am=a):El=0,Al(0)}}function ST(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,sl(c)))}function Bu(a){return yT(),bT(),wT(),TT()}function TT(){if(fn!==5)return!1;var a=zi,c=im;im=0;var f=Rh(Xa),m=$.T,v=Q.p;try{Q.p=32>f?32:f,$.T=null,f=sm,sm=null;var y=zi,M=Xa;if(fn=0,Wa=zi=null,Xa=0,(st&6)!==0)throw Error(r(331));var F=st;if(st|=4,oT(y.current),iT(y,y.current,M,f),st=F,Al(0,!1),qe&&typeof qe.onPostCommitFiberRoot=="function")try{qe.onPostCommitFiberRoot(nt,y)}catch{}return!0}finally{Q.p=v,$.T=m,ST(a,c)}}function ET(a,c,f){c=nr(f,c),c=Bp(a.stateNode,c,2),a=Mi(a,c,2),a!==null&&(wt(a,2),zr(a))}function mt(a,c,f){if(a.tag===3)ET(a,a,f);else for(;c!==null;){if(c.tag===3){ET(c,a,f);break}else if(c.tag===1){var m=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Fi===null||!Fi.has(m))){a=nr(f,a),f=NS(2),m=Mi(c,f,2),m!==null&&(kS(f,m,c,a),wt(m,2),zr(m));break}}c=c.return}}function um(a,c,f){var m=a.pingCache;if(m===null){m=a.pingCache=new aL;var v=new Set;m.set(c,v)}else v=m.get(c),v===void 0&&(v=new Set,m.set(c,v));v.has(f)||(em=!0,v.add(f),a=fL.bind(null,a,c,f),c.then(a,a))}function fL(a,c,f){var m=a.pingCache;m!==null&&m.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,vt===a&&(Ye&f)===f&&(Ot===4||Ot===3&&(Ye&62914560)===Ye&&300>Ie()-rm?(st&2)===0&&Ya(a,0):tm|=f,Ha===Ye&&(Ha=0)),zr(a)}function AT(a,c){c===0&&(c=Ct()),a=ka(a,c),a!==null&&(wt(a,c),zr(a))}function dL(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),AT(a,f)}function hL(a,c){var f=0;switch(a.tag){case 13:var m=a.stateNode,v=a.memoizedState;v!==null&&(f=v.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(c),AT(a,f)}function pL(a,c){return ke(a,c)}var Uu=null,Ka=null,fm=!1,Fu=!1,dm=!1,Ms=0;function zr(a){a!==Ka&&a.next===null&&(Ka===null?Uu=Ka=a:Ka=Ka.next=a),Fu=!0,fm||(fm=!0,gL())}function Al(a,c){if(!dm&&Fu){dm=!0;do for(var f=!1,m=Uu;m!==null;){if(a!==0){var v=m.pendingLanes;if(v===0)var y=0;else{var M=m.suspendedLanes,F=m.pingedLanes;y=(1<<31-yt(42|a)+1)-1,y&=v&~(M&~F),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(f=!0,kT(m,y))}else y=Ye,y=wr(m,m===vt?y:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(y&3)===0||Jn(m,y)||(f=!0,kT(m,y));m=m.next}while(f);dm=!1}}function mL(){RT()}function RT(){Fu=fm=!1;var a=0;Ms!==0&&(TL()&&(a=Ms),Ms=0);for(var c=Ie(),f=null,m=Uu;m!==null;){var v=m.next,y=CT(m,c);y===0?(m.next=null,f===null?Uu=v:f.next=v,v===null&&(Ka=f)):(f=m,(a!==0||(y&3)!==0)&&(Fu=!0)),m=v}Al(a)}function CT(a,c){for(var f=a.suspendedLanes,m=a.pingedLanes,v=a.expirationTimes,y=a.pendingLanes&-62914561;0<y;){var M=31-yt(y),F=1<<M,G=v[M];G===-1?((F&f)===0||(F&m)!==0)&&(v[M]=Te(F,c)):G<=c&&(a.expiredLanes|=F),y&=~F}if(c=vt,f=Ye,f=wr(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,f===0||a===c&&(at===2||at===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Xe(m),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Jn(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(m!==null&&Xe(m),Rh(f)){case 2:case 8:f=pt;break;case 32:f=Mt;break;case 268435456:f=Ge;break;default:f=Mt}return m=NT.bind(null,a),f=ke(f,m),a.callbackPriority=c,a.callbackNode=f,c}return m!==null&&m!==null&&Xe(m),a.callbackPriority=2,a.callbackNode=null,2}function NT(a,c){if(fn!==0&&fn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Bu()&&a.callbackNode!==f)return null;var m=Ye;return m=wr(a,a===vt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(fT(a,m,c),CT(a,Ie()),a.callbackNode!=null&&a.callbackNode===f?NT.bind(null,a):null)}function kT(a,c){if(Bu())return null;fT(a,c,!0)}function gL(){AL(function(){(st&6)!==0?ke(ot,mL):RT()})}function hm(){return Ms===0&&(Ms=lt()),Ms}function MT(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Zc(""+a)}function IT(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function _L(a,c,f,m,v){if(c==="submit"&&f&&f.stateNode===v){var y=MT((v[Mn]||null).action),M=m.submitter;M&&(c=(c=M[Mn]||null)?MT(c.formAction):M.getAttribute("formAction"),c!==null&&(y=c,M=null));var F=new tu("action","action",null,m,v);a.push({event:F,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Ms!==0){var G=M?IT(v,M):new FormData(v);Op(f,{pending:!0,data:G,method:v.method,action:y},null,G)}}else typeof y=="function"&&(F.preventDefault(),G=M?IT(v,M):new FormData(v),Op(f,{pending:!0,data:G,method:v.method,action:y},y,G))},currentTarget:v}]})}}for(var pm=0;pm<Qh.length;pm++){var mm=Qh[pm],vL=mm.toLowerCase(),xL=mm[0].toUpperCase()+mm.slice(1);Sr(vL,"on"+xL)}Sr(fw,"onAnimationEnd"),Sr(dw,"onAnimationIteration"),Sr(hw,"onAnimationStart"),Sr("dblclick","onDoubleClick"),Sr("focusin","onFocus"),Sr("focusout","onBlur"),Sr(j6,"onTransitionRun"),Sr(L6,"onTransitionStart"),Sr(B6,"onTransitionCancel"),Sr(pw,"onTransitionEnd"),ya("onMouseEnter",["mouseout","mouseover"]),ya("onMouseLeave",["mouseout","mouseover"]),ya("onPointerEnter",["pointerout","pointerover"]),ya("onPointerLeave",["pointerout","pointerover"]),ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ms("onBeforeInput",["compositionend","keypress","textInput","paste"]),ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rl));function OT(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var m=a[f],v=m.event;m=m.listeners;e:{var y=void 0;if(c)for(var M=m.length-1;0<=M;M--){var F=m[M],G=F.instance,ue=F.currentTarget;if(F=F.listener,G!==y&&v.isPropagationStopped())break e;y=F,v.currentTarget=ue;try{y(v)}catch(me){Ru(me)}v.currentTarget=null,y=G}else for(M=0;M<m.length;M++){if(F=m[M],G=F.instance,ue=F.currentTarget,F=F.listener,G!==y&&v.isPropagationStopped())break e;y=F,v.currentTarget=ue;try{y(v)}catch(me){Ru(me)}v.currentTarget=null,y=G}}}}function We(a,c){var f=c[Ch];f===void 0&&(f=c[Ch]=new Set);var m=a+"__bubble";f.has(m)||(PT(c,a,2,!1),f.add(m))}function gm(a,c,f){var m=0;c&&(m|=4),PT(f,a,m,c)}var zu="_reactListening"+Math.random().toString(36).slice(2);function _m(a){if(!a[zu]){a[zu]=!0,R2.forEach(function(f){f!=="selectionchange"&&(yL.has(f)||gm(f,!1,a),gm(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[zu]||(c[zu]=!0,gm("selectionchange",!1,c))}}function PT(a,c,f,m){switch(i3(c)){case 2:var v=XL;break;case 8:v=YL;break;default:v=Mm}f=v.bind(null,c,f,a),v=void 0,!Uh||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),m?v!==void 0?a.addEventListener(c,f,{capture:!0,passive:v}):a.addEventListener(c,f,!0):v!==void 0?a.addEventListener(c,f,{passive:v}):a.addEventListener(c,f,!1)}function vm(a,c,f,m,v){var y=m;if((c&1)===0&&(c&2)===0&&m!==null)e:for(;;){if(m===null)return;var M=m.tag;if(M===3||M===4){var F=m.stateNode.containerInfo;if(F===v)break;if(M===4)for(M=m.return;M!==null;){var G=M.tag;if((G===3||G===4)&&M.stateNode.containerInfo===v)return;M=M.return}for(;F!==null;){if(M=_a(F),M===null)return;if(G=M.tag,G===5||G===6||G===26||G===27){m=y=M;continue e}F=F.parentNode}}m=m.return}z2(function(){var ue=y,me=Lh(f),ve=[];e:{var de=mw.get(a);if(de!==void 0){var he=tu,Be=a;switch(a){case"keypress":if(Jc(f)===0)break e;case"keydown":case"keyup":he=p6;break;case"focusin":Be="focus",he=Vh;break;case"focusout":Be="blur",he=Vh;break;case"beforeblur":case"afterblur":he=Vh;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=q2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=n6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=_6;break;case fw:case dw:case hw:he=s6;break;case pw:he=x6;break;case"scroll":case"scrollend":he=e6;break;case"wheel":he=b6;break;case"copy":case"cut":case"paste":he=o6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=W2;break;case"toggle":case"beforetoggle":he=S6}var Pe=(c&4)!==0,ft=!Pe&&(a==="scroll"||a==="scrollend"),ie=Pe?de!==null?de+"Capture":null:de;Pe=[];for(var ee=ue,ce;ee!==null;){var ge=ee;if(ce=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||ce===null||ie===null||(ge=Wo(ee,ie),ge!=null&&Pe.push(Cl(ee,ge,ce))),ft)break;ee=ee.return}0<Pe.length&&(de=new he(de,Be,null,f,me),ve.push({event:de,listeners:Pe}))}}if((c&7)===0){e:{if(de=a==="mouseover"||a==="pointerover",he=a==="mouseout"||a==="pointerout",de&&f!==jh&&(Be=f.relatedTarget||f.fromElement)&&(_a(Be)||Be[ga]))break e;if((he||de)&&(de=me.window===me?me:(de=me.ownerDocument)?de.defaultView||de.parentWindow:window,he?(Be=f.relatedTarget||f.toElement,he=ue,Be=Be?_a(Be):null,Be!==null&&(ft=s(Be),Pe=Be.tag,Be!==ft||Pe!==5&&Pe!==27&&Pe!==6)&&(Be=null)):(he=null,Be=ue),he!==Be)){if(Pe=q2,ge="onMouseLeave",ie="onMouseEnter",ee="mouse",(a==="pointerout"||a==="pointerover")&&(Pe=W2,ge="onPointerLeave",ie="onPointerEnter",ee="pointer"),ft=he==null?de:Ho(he),ce=Be==null?de:Ho(Be),de=new Pe(ge,ee+"leave",he,f,me),de.target=ft,de.relatedTarget=ce,ge=null,_a(me)===ue&&(Pe=new Pe(ie,ee+"enter",Be,f,me),Pe.target=ce,Pe.relatedTarget=ft,ge=Pe),ft=ge,he&&Be)t:{for(Pe=he,ie=Be,ee=0,ce=Pe;ce;ce=Za(ce))ee++;for(ce=0,ge=ie;ge;ge=Za(ge))ce++;for(;0<ee-ce;)Pe=Za(Pe),ee--;for(;0<ce-ee;)ie=Za(ie),ce--;for(;ee--;){if(Pe===ie||ie!==null&&Pe===ie.alternate)break t;Pe=Za(Pe),ie=Za(ie)}Pe=null}else Pe=null;he!==null&&DT(ve,de,he,Pe,!1),Be!==null&&ft!==null&&DT(ve,ft,Be,Pe,!0)}}e:{if(de=ue?Ho(ue):window,he=de.nodeName&&de.nodeName.toLowerCase(),he==="select"||he==="input"&&de.type==="file")var Ce=ew;else if(Q2(de))if(tw)Ce=O6;else{Ce=M6;var Ve=k6}else he=de.nodeName,!he||he.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ue&&Dh(ue.elementType)&&(Ce=ew):Ce=I6;if(Ce&&(Ce=Ce(a,ue))){J2(ve,Ce,f,me);break e}Ve&&Ve(a,de,ue),a==="focusout"&&ue&&de.type==="number"&&ue.memoizedProps.value!=null&&Ph(de,"number",de.value)}switch(Ve=ue?Ho(ue):window,a){case"focusin":(Q2(Ve)||Ve.contentEditable==="true")&&(Ra=Ve,Gh=ue,el=null);break;case"focusout":el=Gh=Ra=null;break;case"mousedown":Kh=!0;break;case"contextmenu":case"mouseup":case"dragend":Kh=!1,cw(ve,f,me);break;case"selectionchange":if(D6)break;case"keydown":case"keyup":cw(ve,f,me)}var Oe;if(Hh)e:{switch(a){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else Aa?K2(a,f)&&(De="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(De="onCompositionStart");De&&(X2&&f.locale!=="ko"&&(Aa||De!=="onCompositionStart"?De==="onCompositionEnd"&&Aa&&(Oe=$2()):(Ri=me,Fh="value"in Ri?Ri.value:Ri.textContent,Aa=!0)),Ve=$u(ue,De),0<Ve.length&&(De=new H2(De,a,null,f,me),ve.push({event:De,listeners:Ve}),Oe?De.data=Oe:(Oe=Z2(f),Oe!==null&&(De.data=Oe)))),(Oe=E6?A6(a,f):R6(a,f))&&(De=$u(ue,"onBeforeInput"),0<De.length&&(Ve=new H2("onBeforeInput","beforeinput",null,f,me),ve.push({event:Ve,listeners:De}),Ve.data=Oe)),_L(ve,a,ue,f,me)}OT(ve,c)})}function Cl(a,c,f){return{instance:a,listener:c,currentTarget:f}}function $u(a,c){for(var f=c+"Capture",m=[];a!==null;){var v=a,y=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||y===null||(v=Wo(a,f),v!=null&&m.unshift(Cl(a,v,y)),v=Wo(a,c),v!=null&&m.push(Cl(a,v,y))),a.tag===3)return m;a=a.return}return[]}function Za(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function DT(a,c,f,m,v){for(var y=c._reactName,M=[];f!==null&&f!==m;){var F=f,G=F.alternate,ue=F.stateNode;if(F=F.tag,G!==null&&G===m)break;F!==5&&F!==26&&F!==27||ue===null||(G=ue,v?(ue=Wo(f,y),ue!=null&&M.unshift(Cl(f,ue,G))):v||(ue=Wo(f,y),ue!=null&&M.push(Cl(f,ue,G)))),f=f.return}M.length!==0&&a.push({event:c,listeners:M})}var bL=/\r\n?/g,wL=/\u0000|\uFFFD/g;function jT(a){return(typeof a=="string"?a:""+a).replace(bL,`
`).replace(wL,"")}function LT(a,c){return c=jT(c),jT(a)===c}function Vu(){}function ut(a,c,f,m,v,y){switch(f){case"children":typeof m=="string"?c==="body"||c==="textarea"&&m===""||Sa(a,m):(typeof m=="number"||typeof m=="bigint")&&c!=="body"&&Sa(a,""+m);break;case"className":Yc(a,"class",m);break;case"tabIndex":Yc(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Yc(a,f,m);break;case"style":U2(a,m,y);break;case"data":if(c!=="object"){Yc(a,"data",m);break}case"src":case"href":if(m===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=Zc(""+m),a.setAttribute(f,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(f==="formAction"?(c!=="input"&&ut(a,c,"name",v.name,v,null),ut(a,c,"formEncType",v.formEncType,v,null),ut(a,c,"formMethod",v.formMethod,v,null),ut(a,c,"formTarget",v.formTarget,v,null)):(ut(a,c,"encType",v.encType,v,null),ut(a,c,"method",v.method,v,null),ut(a,c,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(f);break}m=Zc(""+m),a.setAttribute(f,m);break;case"onClick":m!=null&&(a.onclick=Vu);break;case"onScroll":m!=null&&We("scroll",a);break;case"onScrollEnd":m!=null&&We("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}f=Zc(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""+m):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":m===!0?a.setAttribute(f,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(f,m):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(f,m):a.removeAttribute(f);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(f):a.setAttribute(f,m);break;case"popover":We("beforetoggle",a),We("toggle",a),Xc(a,"popover",m);break;case"xlinkActuate":ti(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":ti(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":ti(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":ti(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":ti(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":ti(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":ti(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":ti(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":ti(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Xc(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Qj.get(f)||f,Xc(a,f,m))}}function xm(a,c,f,m,v,y){switch(f){case"style":U2(a,m,y);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(f=m.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof m=="string"?Sa(a,m):(typeof m=="number"||typeof m=="bigint")&&Sa(a,""+m);break;case"onScroll":m!=null&&We("scroll",a);break;case"onScrollEnd":m!=null&&We("scrollend",a);break;case"onClick":m!=null&&(a.onclick=Vu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!C2.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(v=f.endsWith("Capture"),c=f.slice(2,v?f.length-7:void 0),y=a[Mn]||null,y=y!=null?y[f]:null,typeof y=="function"&&a.removeEventListener(c,y,v),typeof m=="function")){typeof y!="function"&&y!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,m,v);break e}f in a?a[f]=m:m===!0?a.setAttribute(f,""):Xc(a,f,m)}}}function dn(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":We("error",a),We("load",a);var m=!1,v=!1,y;for(y in f)if(f.hasOwnProperty(y)){var M=f[y];if(M!=null)switch(y){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ut(a,c,y,M,f,null)}}v&&ut(a,c,"srcSet",f.srcSet,f,null),m&&ut(a,c,"src",f.src,f,null);return;case"input":We("invalid",a);var F=y=M=v=null,G=null,ue=null;for(m in f)if(f.hasOwnProperty(m)){var me=f[m];if(me!=null)switch(m){case"name":v=me;break;case"type":M=me;break;case"checked":G=me;break;case"defaultChecked":ue=me;break;case"value":y=me;break;case"defaultValue":F=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,c));break;default:ut(a,c,m,me,f,null)}}D2(a,y,F,G,ue,M,v,!1),Gc(a);return;case"select":We("invalid",a),m=M=y=null;for(v in f)if(f.hasOwnProperty(v)&&(F=f[v],F!=null))switch(v){case"value":y=F;break;case"defaultValue":M=F;break;case"multiple":m=F;default:ut(a,c,v,F,f,null)}c=y,f=M,a.multiple=!!m,c!=null?wa(a,!!m,c,!1):f!=null&&wa(a,!!m,f,!0);return;case"textarea":We("invalid",a),y=v=m=null;for(M in f)if(f.hasOwnProperty(M)&&(F=f[M],F!=null))switch(M){case"value":m=F;break;case"defaultValue":v=F;break;case"children":y=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(r(91));break;default:ut(a,c,M,F,f,null)}L2(a,m,v,y),Gc(a);return;case"option":for(G in f)if(f.hasOwnProperty(G)&&(m=f[G],m!=null))switch(G){case"selected":a.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:ut(a,c,G,m,f,null)}return;case"dialog":We("beforetoggle",a),We("toggle",a),We("cancel",a),We("close",a);break;case"iframe":case"object":We("load",a);break;case"video":case"audio":for(m=0;m<Rl.length;m++)We(Rl[m],a);break;case"image":We("error",a),We("load",a);break;case"details":We("toggle",a);break;case"embed":case"source":case"link":We("error",a),We("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in f)if(f.hasOwnProperty(ue)&&(m=f[ue],m!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ut(a,c,ue,m,f,null)}return;default:if(Dh(c)){for(me in f)f.hasOwnProperty(me)&&(m=f[me],m!==void 0&&xm(a,c,me,m,f,void 0));return}}for(F in f)f.hasOwnProperty(F)&&(m=f[F],m!=null&&ut(a,c,F,m,f,null))}function SL(a,c,f,m){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,y=null,M=null,F=null,G=null,ue=null,me=null;for(he in f){var ve=f[he];if(f.hasOwnProperty(he)&&ve!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":G=ve;default:m.hasOwnProperty(he)||ut(a,c,he,null,m,ve)}}for(var de in m){var he=m[de];if(ve=f[de],m.hasOwnProperty(de)&&(he!=null||ve!=null))switch(de){case"type":y=he;break;case"name":v=he;break;case"checked":ue=he;break;case"defaultChecked":me=he;break;case"value":M=he;break;case"defaultValue":F=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:he!==ve&&ut(a,c,de,he,m,ve)}}Oh(a,M,F,G,ue,me,y,v);return;case"select":he=M=F=de=null;for(y in f)if(G=f[y],f.hasOwnProperty(y)&&G!=null)switch(y){case"value":break;case"multiple":he=G;default:m.hasOwnProperty(y)||ut(a,c,y,null,m,G)}for(v in m)if(y=m[v],G=f[v],m.hasOwnProperty(v)&&(y!=null||G!=null))switch(v){case"value":de=y;break;case"defaultValue":F=y;break;case"multiple":M=y;default:y!==G&&ut(a,c,v,y,m,G)}c=F,f=M,m=he,de!=null?wa(a,!!f,de,!1):!!m!=!!f&&(c!=null?wa(a,!!f,c,!0):wa(a,!!f,f?[]:"",!1));return;case"textarea":he=de=null;for(F in f)if(v=f[F],f.hasOwnProperty(F)&&v!=null&&!m.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:ut(a,c,F,null,m,v)}for(M in m)if(v=m[M],y=f[M],m.hasOwnProperty(M)&&(v!=null||y!=null))switch(M){case"value":de=v;break;case"defaultValue":he=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==y&&ut(a,c,M,v,m,y)}j2(a,de,he);return;case"option":for(var Be in f)if(de=f[Be],f.hasOwnProperty(Be)&&de!=null&&!m.hasOwnProperty(Be))switch(Be){case"selected":a.selected=!1;break;default:ut(a,c,Be,null,m,de)}for(G in m)if(de=m[G],he=f[G],m.hasOwnProperty(G)&&de!==he&&(de!=null||he!=null))switch(G){case"selected":a.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:ut(a,c,G,de,m,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Pe in f)de=f[Pe],f.hasOwnProperty(Pe)&&de!=null&&!m.hasOwnProperty(Pe)&&ut(a,c,Pe,null,m,de);for(ue in m)if(de=m[ue],he=f[ue],m.hasOwnProperty(ue)&&de!==he&&(de!=null||he!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,c));break;default:ut(a,c,ue,de,m,he)}return;default:if(Dh(c)){for(var ft in f)de=f[ft],f.hasOwnProperty(ft)&&de!==void 0&&!m.hasOwnProperty(ft)&&xm(a,c,ft,void 0,m,de);for(me in m)de=m[me],he=f[me],!m.hasOwnProperty(me)||de===he||de===void 0&&he===void 0||xm(a,c,me,de,m,he);return}}for(var ie in f)de=f[ie],f.hasOwnProperty(ie)&&de!=null&&!m.hasOwnProperty(ie)&&ut(a,c,ie,null,m,de);for(ve in m)de=m[ve],he=f[ve],!m.hasOwnProperty(ve)||de===he||de==null&&he==null||ut(a,c,ve,de,m,he)}var ym=null,bm=null;function qu(a){return a.nodeType===9?a:a.ownerDocument}function BT(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function UT(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function wm(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Sm=null;function TL(){var a=window.event;return a&&a.type==="popstate"?a===Sm?!1:(Sm=a,!0):(Sm=null,!1)}var FT=typeof setTimeout=="function"?setTimeout:void 0,EL=typeof clearTimeout=="function"?clearTimeout:void 0,zT=typeof Promise=="function"?Promise:void 0,AL=typeof queueMicrotask=="function"?queueMicrotask:typeof zT<"u"?function(a){return zT.resolve(null).then(a).catch(RL)}:FT;function RL(a){setTimeout(function(){throw a})}function Vi(a){return a==="head"}function $T(a,c){var f=c,m=0,v=0;do{var y=f.nextSibling;if(a.removeChild(f),y&&y.nodeType===8)if(f=y.data,f==="/$"){if(0<m&&8>m){f=m;var M=a.ownerDocument;if(f&1&&Nl(M.documentElement),f&2&&Nl(M.body),f&4)for(f=M.head,Nl(f),M=f.firstChild;M;){var F=M.nextSibling,G=M.nodeName;M[qo]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&M.rel.toLowerCase()==="stylesheet"||f.removeChild(M),M=F}}if(v===0){a.removeChild(y),Ll(c);return}v--}else f==="$"||f==="$?"||f==="$!"?v++:m=f.charCodeAt(0)-48;else m=0;f=y}while(f);Ll(c)}function Tm(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Tm(f),Nh(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function CL(a,c,f,m){for(;a.nodeType===1;){var v=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[qo])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(y=a.getAttribute("rel"),y==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(y!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(y=a.getAttribute("src"),(y!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&y&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var y=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===y)return a}else return a;if(a=Er(a.nextSibling),a===null)break}return null}function NL(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=Er(a.nextSibling),a===null))return null;return a}function Em(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function kL(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var m=function(){c(),f.removeEventListener("DOMContentLoaded",m)};f.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function Er(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var Am=null;function VT(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function qT(a,c,f){switch(c=qu(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Nl(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);Nh(a)}var lr=new Map,HT=new Set;function Hu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var mi=Q.d;Q.d={f:ML,r:IL,D:OL,C:PL,L:DL,m:jL,X:BL,S:LL,M:UL};function ML(){var a=mi.f(),c=ju();return a||c}function IL(a){var c=va(a);c!==null&&c.tag===5&&c.type==="form"?fS(c):mi.r(a)}var Qa=typeof document>"u"?null:document;function WT(a,c,f){var m=Qa;if(m&&typeof c=="string"&&c){var v=tr(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof f=="string"&&(v+='[crossorigin="'+f+'"]'),HT.has(v)||(HT.add(v),a={rel:a,crossOrigin:f,href:c},m.querySelector(v)===null&&(c=m.createElement("link"),dn(c,"link",a),sn(c),m.head.appendChild(c)))}}function OL(a){mi.D(a),WT("dns-prefetch",a,null)}function PL(a,c){mi.C(a,c),WT("preconnect",a,c)}function DL(a,c,f){mi.L(a,c,f);var m=Qa;if(m&&a&&c){var v='link[rel="preload"][as="'+tr(c)+'"]';c==="image"&&f&&f.imageSrcSet?(v+='[imagesrcset="'+tr(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(v+='[imagesizes="'+tr(f.imageSizes)+'"]')):v+='[href="'+tr(a)+'"]';var y=v;switch(c){case"style":y=Ja(a);break;case"script":y=eo(a)}lr.has(y)||(a=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),lr.set(y,a),m.querySelector(v)!==null||c==="style"&&m.querySelector(kl(y))||c==="script"&&m.querySelector(Ml(y))||(c=m.createElement("link"),dn(c,"link",a),sn(c),m.head.appendChild(c)))}}function jL(a,c){mi.m(a,c);var f=Qa;if(f&&a){var m=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+tr(m)+'"][href="'+tr(a)+'"]',y=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=eo(a)}if(!lr.has(y)&&(a=h({rel:"modulepreload",href:a},c),lr.set(y,a),f.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Ml(y)))return}m=f.createElement("link"),dn(m,"link",a),sn(m),f.head.appendChild(m)}}}function LL(a,c,f){mi.S(a,c,f);var m=Qa;if(m&&a){var v=xa(m).hoistableStyles,y=Ja(a);c=c||"default";var M=v.get(y);if(!M){var F={loading:0,preload:null};if(M=m.querySelector(kl(y)))F.loading=5;else{a=h({rel:"stylesheet",href:a,"data-precedence":c},f),(f=lr.get(y))&&Rm(a,f);var G=M=m.createElement("link");sn(G),dn(G,"link",a),G._p=new Promise(function(ue,me){G.onload=ue,G.onerror=me}),G.addEventListener("load",function(){F.loading|=1}),G.addEventListener("error",function(){F.loading|=2}),F.loading|=4,Wu(M,c,m)}M={type:"stylesheet",instance:M,count:1,state:F},v.set(y,M)}}}function BL(a,c){mi.X(a,c);var f=Qa;if(f&&a){var m=xa(f).hoistableScripts,v=eo(a),y=m.get(v);y||(y=f.querySelector(Ml(v)),y||(a=h({src:a,async:!0},c),(c=lr.get(v))&&Cm(a,c),y=f.createElement("script"),sn(y),dn(y,"link",a),f.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},m.set(v,y))}}function UL(a,c){mi.M(a,c);var f=Qa;if(f&&a){var m=xa(f).hoistableScripts,v=eo(a),y=m.get(v);y||(y=f.querySelector(Ml(v)),y||(a=h({src:a,async:!0,type:"module"},c),(c=lr.get(v))&&Cm(a,c),y=f.createElement("script"),sn(y),dn(y,"link",a),f.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},m.set(v,y))}}function XT(a,c,f,m){var v=(v=J.current)?Hu(v):null;if(!v)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ja(f.href),f=xa(v).hoistableStyles,m=f.get(c),m||(m={type:"style",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ja(f.href);var y=xa(v).hoistableStyles,M=y.get(a);if(M||(v=v.ownerDocument||v,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(a,M),(y=v.querySelector(kl(a)))&&!y._p&&(M.instance=y,M.state.loading=5),lr.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},lr.set(a,f),y||FL(v,a,f,M.state))),c&&m===null)throw Error(r(528,""));return M}if(c&&m!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=eo(f),f=xa(v).hoistableScripts,m=f.get(c),m||(m={type:"script",instance:null,count:0,state:null},f.set(c,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Ja(a){return'href="'+tr(a)+'"'}function kl(a){return'link[rel="stylesheet"]['+a+"]"}function YT(a){return h({},a,{"data-precedence":a.precedence,precedence:null})}function FL(a,c,f,m){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?m.loading=1:(c=a.createElement("link"),m.preload=c,c.addEventListener("load",function(){return m.loading|=1}),c.addEventListener("error",function(){return m.loading|=2}),dn(c,"link",f),sn(c),a.head.appendChild(c))}function eo(a){return'[src="'+tr(a)+'"]'}function Ml(a){return"script[async]"+a}function GT(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var m=a.querySelector('style[data-href~="'+tr(f.href)+'"]');if(m)return c.instance=m,sn(m),m;var v=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),sn(m),dn(m,"style",v),Wu(m,f.precedence,a),c.instance=m;case"stylesheet":v=Ja(f.href);var y=a.querySelector(kl(v));if(y)return c.state.loading|=4,c.instance=y,sn(y),y;m=YT(f),(v=lr.get(v))&&Rm(m,v),y=(a.ownerDocument||a).createElement("link"),sn(y);var M=y;return M._p=new Promise(function(F,G){M.onload=F,M.onerror=G}),dn(y,"link",m),c.state.loading|=4,Wu(y,f.precedence,a),c.instance=y;case"script":return y=eo(f.src),(v=a.querySelector(Ml(y)))?(c.instance=v,sn(v),v):(m=f,(v=lr.get(y))&&(m=h({},f),Cm(m,v)),a=a.ownerDocument||a,v=a.createElement("script"),sn(v),dn(v,"link",m),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(m=c.instance,c.state.loading|=4,Wu(m,f.precedence,a));return c.instance}function Wu(a,c,f){for(var m=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,y=v,M=0;M<m.length;M++){var F=m[M];if(F.dataset.precedence===c)y=F;else if(y!==v)break}y?y.parentNode.insertBefore(a,y.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function Rm(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function Cm(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Xu=null;function KT(a,c,f){if(Xu===null){var m=new Map,v=Xu=new Map;v.set(f,m)}else v=Xu,m=v.get(f),m||(m=new Map,v.set(f,m));if(m.has(a))return m;for(m.set(a,null),f=f.getElementsByTagName(a),v=0;v<f.length;v++){var y=f[v];if(!(y[qo]||y[gn]||a==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var M=y.getAttribute(c)||"";M=a+M;var F=m.get(M);F?F.push(y):m.set(M,[y])}}return m}function ZT(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function zL(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function QT(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Il=null;function $L(){}function VL(a,c,f){if(Il===null)throw Error(r(475));var m=Il;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Ja(f.href),y=a.querySelector(kl(v));if(y){a=y._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(m.count++,m=Yu.bind(m),a.then(m,m)),c.state.loading|=4,c.instance=y,sn(y);return}y=a.ownerDocument||a,f=YT(f),(v=lr.get(v))&&Rm(f,v),y=y.createElement("link"),sn(y);var M=y;M._p=new Promise(function(F,G){M.onload=F,M.onerror=G}),dn(y,"link",f),c.instance=y}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(m.count++,c=Yu.bind(m),a.addEventListener("load",c),a.addEventListener("error",c))}}function qL(){if(Il===null)throw Error(r(475));var a=Il;return a.stylesheets&&a.count===0&&Nm(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&Nm(a,a.stylesheets),a.unsuspend){var m=a.unsuspend;a.unsuspend=null,m()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function Yu(){if(this.count--,this.count===0){if(this.stylesheets)Nm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Gu=null;function Nm(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Gu=new Map,c.forEach(HL,a),Gu=null,Yu.call(a))}function HL(a,c){if(!(c.state.loading&4)){var f=Gu.get(a);if(f)var m=f.get(null);else{f=new Map,Gu.set(a,f);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<v.length;y++){var M=v[y];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(f.set(M.dataset.precedence,M),m=M)}m&&f.set(null,m)}v=c.instance,M=v.getAttribute("data-precedence"),y=f.get(M)||m,y===m&&f.set(null,v),f.set(M,v),this.count++,m=Yu.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),y?y.parentNode.insertBefore(v,y.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var Ol={$$typeof:R,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function WL(a,c,f,m,v,y,M,F){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=rt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rt(0),this.hiddenUpdates=rt(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=y,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=F,this.incompleteTransitions=new Map}function JT(a,c,f,m,v,y,M,F,G,ue,me,ve){return a=new WL(a,c,f,M,F,G,ue,ve),c=1,y===!0&&(c|=24),y=Un(3,null,null,c),a.current=y,y.stateNode=a,c=up(),c.refCount++,a.pooledCache=c,c.refCount++,y.memoizedState={element:m,isDehydrated:f,cache:c},pp(y),a}function e3(a){return a?(a=Ma,a):Ma}function t3(a,c,f,m,v,y){v=e3(v),m.context===null?m.context=v:m.pendingContext=v,m=ki(c),m.payload={element:f},y=y===void 0?null:y,y!==null&&(m.callback=y),f=Mi(a,m,c),f!==null&&(qn(f,a,c),cl(f,a,c))}function n3(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function km(a,c){n3(a,c),(a=a.alternate)&&n3(a,c)}function r3(a){if(a.tag===13){var c=ka(a,67108864);c!==null&&qn(c,a,67108864),km(a,67108864)}}var Ku=!0;function XL(a,c,f,m){var v=$.T;$.T=null;var y=Q.p;try{Q.p=2,Mm(a,c,f,m)}finally{Q.p=y,$.T=v}}function YL(a,c,f,m){var v=$.T;$.T=null;var y=Q.p;try{Q.p=8,Mm(a,c,f,m)}finally{Q.p=y,$.T=v}}function Mm(a,c,f,m){if(Ku){var v=Im(m);if(v===null)vm(a,c,m,Zu,f),s3(a,m);else if(KL(v,a,c,f,m))m.stopPropagation();else if(s3(a,m),c&4&&-1<GL.indexOf(a)){for(;v!==null;){var y=va(v);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var M=kn(y.pendingLanes);if(M!==0){var F=y;for(F.pendingLanes|=2,F.entangledLanes|=2;M;){var G=1<<31-yt(M);F.entanglements[1]|=G,M&=~G}zr(y),(st&6)===0&&(Pu=Ie()+500,Al(0))}}break;case 13:F=ka(y,2),F!==null&&qn(F,y,2),ju(),km(y,2)}if(y=Im(m),y===null&&vm(a,c,m,Zu,f),y===v)break;v=y}v!==null&&m.stopPropagation()}else vm(a,c,m,null,f)}}function Im(a){return a=Lh(a),Om(a)}var Zu=null;function Om(a){if(Zu=null,a=_a(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Zu=a,null}function i3(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nn()){case ot:return 2;case pt:return 8;case Mt:case rn:return 32;case Ge:return 268435456;default:return 32}default:return 32}}var Pm=!1,qi=null,Hi=null,Wi=null,Pl=new Map,Dl=new Map,Xi=[],GL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function s3(a,c){switch(a){case"focusin":case"focusout":qi=null;break;case"dragenter":case"dragleave":Hi=null;break;case"mouseover":case"mouseout":Wi=null;break;case"pointerover":case"pointerout":Pl.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dl.delete(c.pointerId)}}function jl(a,c,f,m,v,y){return a===null||a.nativeEvent!==y?(a={blockedOn:c,domEventName:f,eventSystemFlags:m,nativeEvent:y,targetContainers:[v]},c!==null&&(c=va(c),c!==null&&r3(c)),a):(a.eventSystemFlags|=m,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function KL(a,c,f,m,v){switch(c){case"focusin":return qi=jl(qi,a,c,f,m,v),!0;case"dragenter":return Hi=jl(Hi,a,c,f,m,v),!0;case"mouseover":return Wi=jl(Wi,a,c,f,m,v),!0;case"pointerover":var y=v.pointerId;return Pl.set(y,jl(Pl.get(y)||null,a,c,f,m,v)),!0;case"gotpointercapture":return y=v.pointerId,Dl.set(y,jl(Dl.get(y)||null,a,c,f,m,v)),!0}return!1}function a3(a){var c=_a(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,Vj(a.priority,function(){if(f.tag===13){var m=Vn();m=Ah(m);var v=ka(f,m);v!==null&&qn(v,f,m),km(f,m)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Qu(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=Im(a.nativeEvent);if(f===null){f=a.nativeEvent;var m=new f.constructor(f.type,f);jh=m,f.target.dispatchEvent(m),jh=null}else return c=va(f),c!==null&&r3(c),a.blockedOn=f,!1;c.shift()}return!0}function o3(a,c,f){Qu(a)&&f.delete(c)}function ZL(){Pm=!1,qi!==null&&Qu(qi)&&(qi=null),Hi!==null&&Qu(Hi)&&(Hi=null),Wi!==null&&Qu(Wi)&&(Wi=null),Pl.forEach(o3),Dl.forEach(o3)}function Ju(a,c){a.blockedOn===c&&(a.blockedOn=null,Pm||(Pm=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,ZL)))}var ef=null;function l3(a){ef!==a&&(ef=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ef===a&&(ef=null);for(var c=0;c<a.length;c+=3){var f=a[c],m=a[c+1],v=a[c+2];if(typeof m!="function"){if(Om(m||f)===null)continue;break}var y=va(f);y!==null&&(a.splice(c,3),c-=3,Op(y,{pending:!0,data:v,method:f.method,action:m},m,v))}}))}function Ll(a){function c(G){return Ju(G,a)}qi!==null&&Ju(qi,a),Hi!==null&&Ju(Hi,a),Wi!==null&&Ju(Wi,a),Pl.forEach(c),Dl.forEach(c);for(var f=0;f<Xi.length;f++){var m=Xi[f];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Xi.length&&(f=Xi[0],f.blockedOn===null);)a3(f),f.blockedOn===null&&Xi.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(m=0;m<f.length;m+=3){var v=f[m],y=f[m+1],M=v[Mn]||null;if(typeof y=="function")M||l3(f);else if(M){var F=null;if(y&&y.hasAttribute("formAction")){if(v=y,M=y[Mn]||null)F=M.formAction;else if(Om(v)!==null)continue}else F=M.action;typeof F=="function"?f[m+1]=F:(f.splice(m,3),m-=3),l3(f)}}}function Dm(a){this._internalRoot=a}tf.prototype.render=Dm.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,m=Vn();t3(f,m,a,c,null,null)},tf.prototype.unmount=Dm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;t3(a.current,2,null,a,null,null),ju(),c[ga]=null}};function tf(a){this._internalRoot=a}tf.prototype.unstable_scheduleHydration=function(a){if(a){var c=E2();a={blockedOn:null,target:a,priority:c};for(var f=0;f<Xi.length&&c!==0&&c<Xi[f].priority;f++);Xi.splice(f,0,a),f===0&&a3(a)}};var c3=e.version;if(c3!=="19.1.0")throw Error(r(527,c3,"19.1.0"));Q.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var QL={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nf.isDisabled&&nf.supportsFiber)try{nt=nf.inject(QL),qe=nf}catch{}}return Ul.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,m="",v=ES,y=AS,M=RS,F=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(m=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(y=c.onCaughtError),c.onRecoverableError!==void 0&&(M=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(F=c.unstable_transitionCallbacks)),c=JT(a,1,!1,null,null,f,m,v,y,M,F,null),a[ga]=c.current,_m(a),new Dm(c)},Ul.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var m=!1,v="",y=ES,M=AS,F=RS,G=null,ue=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(y=f.onUncaughtError),f.onCaughtError!==void 0&&(M=f.onCaughtError),f.onRecoverableError!==void 0&&(F=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(G=f.unstable_transitionCallbacks),f.formState!==void 0&&(ue=f.formState)),c=JT(a,1,!0,c,f??null,m,v,y,M,F,G,ue),c.context=e3(null),f=c.current,m=Vn(),m=Ah(m),v=ki(m),v.callback=null,Mi(f,v,m),f=m,c.current.lanes=f,wt(c,f),zr(c),a[ga]=c.current,_m(a),new tf(c)},Ul.version="19.1.0",Ul}var x3;function uB(){if(x3)return Lm.exports;x3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Lm.exports=cB(),Lm.exports}var fB=uB(),D=c1();const vc=l1(D),dB=nB({__proto__:null,default:vc},[D]);KM();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xc(){return xc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},xc.apply(this,arguments)}var is;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(is||(is={}));const y3="popstate";function hB(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return t0("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:QM(i)}return mB(e,n,null,t)}function tn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ZM(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pB(){return Math.random().toString(36).substr(2,8)}function b3(t,e){return{usr:t.state,key:t.key,idx:e}}function t0(t,e,n,r){return n===void 0&&(n=null),xc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Do(e):e,{state:n,key:e&&e.key||r||pB()})}function QM(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Do(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function mB(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l=is.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(xc({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function g(){l=is.Pop;let b=h(),T=b==null?null:b-d;d=b,u&&u({action:l,location:S.location,delta:T})}function _(b,T){l=is.Push;let A=t0(S.location,b,T);d=h()+1;let R=b3(A,d),E=S.createHref(A);try{o.pushState(R,"",E)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(E)}s&&u&&u({action:l,location:S.location,delta:1})}function x(b,T){l=is.Replace;let A=t0(S.location,b,T);d=h();let R=b3(A,d),E=S.createHref(A);o.replaceState(R,"",E),s&&u&&u({action:l,location:S.location,delta:0})}function w(b){let T=i.location.origin!=="null"?i.location.origin:i.location.href,A=typeof b=="string"?b:QM(b);return A=A.replace(/ $/,"%20"),tn(T,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,T)}let S={get action(){return l},get location(){return t(i,o)},listen(b){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(y3,g),u=b,()=>{i.removeEventListener(y3,g),u=null}},createHref(b){return e(i,b)},createURL:w,encodeLocation(b){let T=w(b);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:_,replace:x,go(b){return o.go(b)}};return S}var w3;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(w3||(w3={}));function gB(t,e,n){return n===void 0&&(n="/"),_B(t,e,n)}function _B(t,e,n,r){let i=typeof e=="string"?Do(e):e,s=tI(i.pathname||"/",n);if(s==null)return null;let o=JM(t);vB(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=kB(s);l=RB(o[u],d)}return l}function JM(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,o,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(tn(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=zs([r,u.relativePath]),h=n.concat(u);s.children&&s.children.length>0&&(tn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),JM(s.children,e,h,d)),!(s.path==null&&!s.index)&&e.push({path:d,score:EB(d,s.index),routesMeta:h})};return t.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,o);else for(let u of eI(s.path))i(s,o,u)}),e}function eI(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=eI(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function vB(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:AB(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const xB=/^:[\w-]+$/,yB=3,bB=2,wB=1,SB=10,TB=-2,S3=t=>t==="*";function EB(t,e){let n=t.split("/"),r=n.length;return n.some(S3)&&(r+=TB),e&&(r+=bB),n.filter(i=>!S3(i)).reduce((i,s)=>i+(xB.test(s)?yB:s===""?wB:SB),r)}function AB(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function RB(t,e,n){let{routesMeta:r}=t,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",g=CB({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),_=u.route;if(!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:zs([s,g.pathname]),pathnameBase:jB(zs([s,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(s=zs([s,g.pathnameBase]))}return o}function CB(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=NB(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,h,g)=>{let{paramName:_,isOptional:x}=h;if(_==="*"){let S=l[g]||"";o=s.slice(0,s.length-S.length).replace(/(.)\/+$/,"$1")}const w=l[g];return x&&!w?d[_]=void 0:d[_]=(w||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:t}}function NB(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),ZM(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function kB(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ZM(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function tI(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function MB(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Do(t):t;return{pathname:n?n.startsWith("/")?n:IB(n,e):e,search:LB(r),hash:BB(i)}}function IB(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function $m(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function OB(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function PB(t,e){let n=OB(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function DB(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=Do(t):(i=xc({},t),tn(!i.pathname||!i.pathname.includes("?"),$m("?","pathname","search",i)),tn(!i.pathname||!i.pathname.includes("#"),$m("#","pathname","hash",i)),tn(!i.search||!i.search.includes("#"),$m("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=n;else{let g=e.length-1;if(!r&&o.startsWith("..")){let _=o.split("/");for(;_[0]==="..";)_.shift(),g-=1;i.pathname=_.join("/")}l=g>=0?e[g]:"/"}let u=MB(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const zs=t=>t.join("/").replace(/\/\/+/g,"/"),jB=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),LB=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,BB=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function UB(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const nI=["post","put","patch","delete"];new Set(nI);const FB=["get",...nI];new Set(FB);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yc(){return yc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},yc.apply(this,arguments)}const u1=D.createContext(null),zB=D.createContext(null),qd=D.createContext(null),Hd=D.createContext(null),na=D.createContext({outlet:null,matches:[],isDataRoute:!1}),rI=D.createContext(null);function Wd(){return D.useContext(Hd)!=null}function ra(){return Wd()||tn(!1),D.useContext(Hd).location}function iI(t){D.useContext(qd).static||D.useLayoutEffect(t)}function _r(){let{isDataRoute:t}=D.useContext(na);return t?e5():$B()}function $B(){Wd()||tn(!1);let t=D.useContext(u1),{basename:e,future:n,navigator:r}=D.useContext(qd),{matches:i}=D.useContext(na),{pathname:s}=ra(),o=JSON.stringify(PB(i,n.v7_relativeSplatPath)),l=D.useRef(!1);return iI(()=>{l.current=!0}),D.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let g=DB(d,JSON.parse(o),s,h.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:zs([e,g.pathname])),(h.replace?r.replace:r.push)(g,h.state,h)},[e,r,o,s,t])}function f1(){let{matches:t}=D.useContext(na),e=t[t.length-1];return e?e.params:{}}function VB(t,e){return qB(t,e)}function qB(t,e,n,r){Wd()||tn(!1);let{navigator:i}=D.useContext(qd),{matches:s}=D.useContext(na),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=ra(),h;if(e){var g;let b=typeof e=="string"?Do(e):e;u==="/"||(g=b.pathname)!=null&&g.startsWith(u)||tn(!1),h=b}else h=d;let _=h.pathname||"/",x=_;if(u!=="/"){let b=u.replace(/^\//,"").split("/");x="/"+_.replace(/^\//,"").split("/").slice(b.length).join("/")}let w=gB(t,{pathname:x}),S=GB(w&&w.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:zs([u,i.encodeLocation?i.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?u:zs([u,i.encodeLocation?i.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),s,n,r);return e&&S?D.createElement(Hd.Provider,{value:{location:yc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:is.Pop}},S):S}function HB(){let t=JB(),e=UB(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),n?D.createElement("pre",{style:i},n):null,null)}const WB=D.createElement(HB,null);class XB extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?D.createElement(na.Provider,{value:this.props.routeContext},D.createElement(rI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function YB(t){let{routeContext:e,match:n,children:r}=t,i=D.useContext(u1);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),D.createElement(na.Provider,{value:e},r)}function GB(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(i=n)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(g=>g.route.id&&(l==null?void 0:l[g.route.id])!==void 0);h>=0||tn(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let g=o[h];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=h),g.route.id){let{loaderData:_,errors:x}=n,w=g.route.loader&&_[g.route.id]===void 0&&(!x||x[g.route.id]===void 0);if(g.route.lazy||w){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,g,_)=>{let x,w=!1,S=null,b=null;n&&(x=l&&g.route.id?l[g.route.id]:void 0,S=g.route.errorElement||WB,u&&(d<0&&_===0?(t5("route-fallback"),w=!0,b=null):d===_&&(w=!0,b=g.route.hydrateFallbackElement||null)));let T=e.concat(o.slice(0,_+1)),A=()=>{let R;return x?R=S:w?R=b:g.route.Component?R=D.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=h,D.createElement(YB,{match:g,routeContext:{outlet:h,matches:T,isDataRoute:n!=null},children:R})};return n&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?D.createElement(XB,{location:n.location,revalidation:n.revalidation,component:S,error:x,children:A(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):A()},null)}var sI=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(sI||{}),aI=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(aI||{});function KB(t){let e=D.useContext(u1);return e||tn(!1),e}function ZB(t){let e=D.useContext(zB);return e||tn(!1),e}function QB(t){let e=D.useContext(na);return e||tn(!1),e}function oI(t){let e=QB(),n=e.matches[e.matches.length-1];return n.route.id||tn(!1),n.route.id}function JB(){var t;let e=D.useContext(rI),n=ZB(),r=oI();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function e5(){let{router:t}=KB(sI.UseNavigateStable),e=oI(aI.UseNavigateStable),n=D.useRef(!1);return iI(()=>{n.current=!0}),D.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,yc({fromRouteId:e},s)))},[t,e])}const T3={};function t5(t,e,n){T3[t]||(T3[t]=!0)}function n5(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Xn(t){tn(!1)}function r5(t){let{basename:e="/",children:n=null,location:r,navigationType:i=is.Pop,navigator:s,static:o=!1,future:l}=t;Wd()&&tn(!1);let u=e.replace(/^\/*/,"/"),d=D.useMemo(()=>({basename:u,navigator:s,static:o,future:yc({v7_relativeSplatPath:!1},l)}),[u,l,s,o]);typeof r=="string"&&(r=Do(r));let{pathname:h="/",search:g="",hash:_="",state:x=null,key:w="default"}=r,S=D.useMemo(()=>{let b=tI(h,u);return b==null?null:{location:{pathname:b,search:g,hash:_,state:x,key:w},navigationType:i}},[u,h,g,_,x,w,i]);return S==null?null:D.createElement(qd.Provider,{value:d},D.createElement(Hd.Provider,{children:n,value:S}))}function i5(t){let{children:e,location:n}=t;return VB(n0(e),n)}new Promise(()=>{});function n0(t,e){e===void 0&&(e=[]);let n=[];return D.Children.forEach(t,(r,i)=>{if(!D.isValidElement(r))return;let s=[...e,i];if(r.type===D.Fragment){n.push.apply(n,n0(r.props.children,s));return}r.type!==Xn&&tn(!1),!r.props.index||!r.props.children||tn(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=n0(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function r0(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function s5(t,e){let n=r0(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(s=>{n.append(i,s)})}),n}const a5="6";try{window.__reactRouterVersion=a5}catch{}const o5="startTransition",E3=dB[o5];function l5(t){let{basename:e,children:n,future:r,window:i}=t,s=D.useRef();s.current==null&&(s.current=hB({window:i,v5Compat:!0}));let o=s.current,[l,u]=D.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=D.useCallback(g=>{d&&E3?E3(()=>u(g)):u(g)},[u,d]);return D.useLayoutEffect(()=>o.listen(h),[o,h]),D.useEffect(()=>n5(r),[r]),D.createElement(r5,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}var A3;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(A3||(A3={}));var R3;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(R3||(R3={}));function c5(t){let e=D.useRef(r0(t)),n=D.useRef(!1),r=ra(),i=D.useMemo(()=>s5(r.search,n.current?null:e.current),[r.search]),s=_r(),o=D.useCallback((l,u)=>{const d=r0(typeof l=="function"?l(i):l);n.current=!0,s("?"+d,u)},[s,i]);return[i,o]}const u5=()=>(console.log("Using default API base: /api"),"/api"),xn={BASE_URL:u5(),ENDPOINTS:{CREATE_SESSION:"/create-session",GET_SESSION:"/session",UPLOAD:"/upload-tree-sequence",UPLOADED_FILES:"/uploaded-files/",TREE_SEQUENCE_METADATA:"/tree-sequence-metadata",DELETE_TREE_SEQUENCE:"/tree-sequence",DOWNLOAD_TREE_SEQUENCE:"/download-tree-sequence",GRAPH_DATA:"/graph-data",INFER_LOCATIONS_FAST:"/infer-locations-fast",INFER_LOCATIONS_GAIA_QUADRATIC:"/infer-locations-gaia-quadratic",INFER_LOCATIONS_MIDPOINT:"/infer-locations-midpoint",INFER_LOCATIONS_SPARG:"/infer-locations-sparg",INFER_TIMES_TSDATE:"/infer-times-tsdate",SIMULATE_TREE_SEQUENCE:"/simulate-tree-sequence/"}},f5={LOADING_DOTS_INTERVAL:420},ss={DEFAULT_MAX_SAMPLES:25,MIN_SAMPLES:2,WARNING_THRESHOLD:25},Vm={ACCEPTED_FORMATS:{"application/octet-stream":[".trees",".tsz"],"application/x-trees":[".trees"],"application/x-tsz":[".tsz"]},CSV_FORMATS:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]}},Fl={UPLOAD_FAILED:"Upload failed",DOWNLOAD_FAILED:"Download failed",FETCH_FAILED:"Failed to fetch data",NO_SPATIAL_DATA:"No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.",NO_SPATIAL_RANGE:"No spatial data found in this genomic range.",UNKNOWN_ERROR:"Unknown error occurred"},lI=D.createContext(void 0);function d5({children:t}){const[e,n]=D.useState(null),[r,i]=D.useState(ss.DEFAULT_MAX_SAMPLES),s=l=>{if(n(l),l!=null&&l.num_samples){const u=Math.min(ss.DEFAULT_MAX_SAMPLES,l.num_samples);i(u)}},o=l=>{if(e!=null&&e.num_samples){const u=Math.max(ss.MIN_SAMPLES,Math.min(l,e.num_samples));i(u)}else i(Math.min(l,ss.DEFAULT_MAX_SAMPLES))};return p.jsx(lI.Provider,{value:{treeSequence:e,setTreeSequence:s,maxSamples:r,setMaxSamples:o},children:t})}function ia(){const t=D.useContext(lI);if(t===void 0)throw new Error("useTreeSequence must be used within a TreeSequenceProvider");return t}var cI=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t))(cI||{});class h5{constructor(){U(this,"logLevel");U(this,"isDevelopment");this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:2}shouldLog(e){return e>=this.logLevel}formatMessage(e,n,r){const i=new Date().toISOString(),s=r!=null&&r.component?`[${r.component}]`:"",o=r!=null&&r.action?`(${r.action})`:"";return`[${i}] ${e} ${s}${o} ${n}`}logToConsole(e,n,r,i){const s=cI[e],o=this.formatMessage(s,n,r);switch(e){case 0:console.debug(o,r==null?void 0:r.data);break;case 1:console.info(o,r==null?void 0:r.data);break;case 2:console.warn(o,r==null?void 0:r.data);break;case 3:console.error(o,i||(r==null?void 0:r.error),r==null?void 0:r.data);break}}debug(e,n){this.shouldLog(0)&&this.logToConsole(0,e,n)}info(e,n){this.shouldLog(1)&&this.logToConsole(1,e,n)}warn(e,n){this.shouldLog(2)&&this.logToConsole(2,e,n)}error(e,n){this.shouldLog(3)&&this.logToConsole(3,e,n,n==null?void 0:n.error)}apiCall(e,n="GET",r){this.debug(`API ${n} ${e}`,{action:"api-call",data:{endpoint:e,method:n,payload:r}})}apiSuccess(e,n="GET",r){this.info(`API ${n} ${e} succeeded`,{action:"api-success",data:{endpoint:e,method:n,response:r}})}apiError(e,n,r="GET"){this.error(`API ${r} ${e} failed`,{action:"api-error",error:n,data:{endpoint:e,method:r}})}componentMount(e,n){this.debug(`${e} mounted`,{component:e,action:"mount",data:n})}componentUnmount(e){this.debug(`${e} unmounted`,{component:e,action:"unmount"})}userAction(e,n,r){this.info(`User action: ${e}`,{component:r,action:"user-action",data:n})}dataProcessing(e,n,r,i){this.debug(`Data processing: ${e}`,{component:n,action:"data-processing",data:{operation:e,inputSize:r,outputSize:i}})}navigation(e,n){this.info(`Navigation: ${e}  ${n}`,{action:"navigation",data:{from:e,to:n}})}performance(e,n,r){this.info(`Performance: ${e} took ${n}ms`,{component:r,action:"performance",data:{operation:e,duration:n}})}}const Hn=new h5,Re={debug:(t,e)=>Hn.debug(t,e),info:(t,e)=>Hn.info(t,e),warn:(t,e)=>Hn.warn(t,e),error:(t,e)=>Hn.error(t,e),api:{call:(t,e,n)=>Hn.apiCall(t,e,n),success:(t,e,n)=>Hn.apiSuccess(t,e,n),error:(t,e,n)=>Hn.apiError(t,e,n)},component:{mount:(t,e)=>Hn.componentMount(t,e),unmount:t=>Hn.componentUnmount(t)},user:{action:(t,e,n)=>Hn.userAction(t,e,n)},data:{processing:(t,e,n,r)=>Hn.dataProcessing(t,e,n,r)},nav:(t,e)=>Hn.navigation(t,e),perf:(t,e,n)=>Hn.performance(t,e,n)};class p5{constructor(){U(this,"baseURL");this.baseURL=xn.BASE_URL}async request(e,n={}){const r=`${this.baseURL}${e}`,i=n.method||"GET";Re.api.call(e,i,n.body);try{const s=new AbortController,o=setTimeout(()=>s.abort(),6e4),l=await fetch(r,{...n,headers:{"Content-Type":"application/json",...n.headers},signal:s.signal});if(clearTimeout(o),!l.ok){const d=await l.json().catch(()=>null),h={message:`HTTP error! status: ${l.status}`,status:l.status,details:(d==null?void 0:d.detail)||"No details available"};throw Re.api.error(e,new Error(h.message),i),h}const u=await l.json();return Re.api.success(e,i,u),{data:u,status:l.status}}catch(s){if(s instanceof Error){if(s.name==="AbortError"){const l=new Error("Request timed out after 60 seconds");throw Re.api.error(e,l,i),l}throw Re.api.error(e,s,i),s}const o={message:Fl.UNKNOWN_ERROR,details:String(s)};throw Re.api.error(e,new Error(o.message),i),o}}async uploadFile(e,n){const r=`${this.baseURL}${e}`,i=new FormData;i.append("file",n),Re.api.call(e,"POST",{filename:n.name,size:n.size});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok)throw new Error(Fl.UPLOAD_FAILED);const o=await s.json();return Re.api.success(e,"POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:Fl.UPLOAD_FAILED;throw Re.api.error(e,new Error(o),"POST"),s}}async getCurrentSession(){return this.request(xn.ENDPOINTS.GET_SESSION)}async uploadTreeSequence(e){return this.uploadFile(xn.ENDPOINTS.UPLOAD,e)}async getUploadedFiles(){return this.request(xn.ENDPOINTS.UPLOADED_FILES)}async getTreeSequenceMetadata(e){return this.request(`${xn.ENDPOINTS.TREE_SEQUENCE_METADATA}/${encodeURIComponent(e)}`)}async deleteTreeSequence(e){return this.request(`${xn.ENDPOINTS.DELETE_TREE_SEQUENCE}/${encodeURIComponent(e)}`,{method:"DELETE"})}async downloadTreeSequence(e,n="trees"){const r=`${this.baseURL}${xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE}/${encodeURIComponent(e)}?format=${n}`;Re.api.call(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{filename:e,format:n});try{const i=await fetch(r);if(!i.ok)throw new Error(Fl.DOWNLOAD_FAILED);const s=await i.blob();return Re.api.success(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{size:s.size,format:n}),s}catch(i){const s=i instanceof Error?i.message:Fl.DOWNLOAD_FAILED;throw Re.api.error(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,new Error(s),"GET"),i}}async getGraphData(e,n={}){const r=new URLSearchParams;n.maxSamples&&r.append("max_samples",n.maxSamples.toString()),n.genomicStart!==void 0&&r.append("genomic_start",n.genomicStart.toString()),n.genomicEnd!==void 0&&r.append("genomic_end",n.genomicEnd.toString()),n.treeStartIdx!==void 0&&r.append("tree_start_idx",n.treeStartIdx.toString()),n.treeEndIdx!==void 0&&r.append("tree_end_idx",n.treeEndIdx.toString()),n.sampleOrder&&r.append("sample_order",n.sampleOrder);const i=`${xn.ENDPOINTS.GRAPH_DATA}/${encodeURIComponent(e)}?${r}`;return this.request(i)}async inferLocationsFast(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_FAST,{method:"POST",body:JSON.stringify(e)})}async inferLocationsSparg(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_SPARG,{method:"POST",body:JSON.stringify(e)})}async inferLocationsGaiaQuadratic(e){return this.request("/infer-locations-gaia-quadratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsGaiaLinear(e){return this.request("/infer-locations-gaia-linear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsMidpoint(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_MIDPOINT,{method:"POST",body:JSON.stringify(e)})}async simulateTreeSequence(e){return this.request(xn.ENDPOINTS.SIMULATE_TREE_SEQUENCE,{method:"POST",body:JSON.stringify(e)})}async uploadLocationCSV(e,n){const r=`${this.baseURL}/upload-location-csv?csv_type=${n}`,i=new FormData;i.append("file",e),Re.api.call("/upload-location-csv","POST",{filename:e.name,csvType:n});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok){const l=await s.json().catch(()=>null);throw new Error((l==null?void 0:l.detail)||"Failed to upload CSV")}const o=await s.json();return Re.api.success("/upload-location-csv","POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:"Failed to upload CSV";throw Re.api.error("/upload-location-csv",new Error(o),"POST"),s}}async updateTreeSequenceLocations(e){return this.request("/update-tree-sequence-locations",{method:"POST",body:JSON.stringify(e)})}async getAvailableCRS(){return this.request("/geographic/crs")}async getAvailableShapes(){return this.request("/geographic/shapes")}async uploadShapefile(e){return this.uploadFile("/geographic/upload-shapefile",e)}async getShapeData(e){return this.request(`/geographic/shape/${encodeURIComponent(e)}`)}async transformCoordinates(e){return this.request("/geographic/transform-coordinates",{method:"POST",body:JSON.stringify(e)})}async validateSpatialData(e){return this.request("/geographic/validate-spatial",{method:"POST",body:JSON.stringify(e)})}async inferTimesTsdate(e){return this.request(xn.ENDPOINTS.INFER_TIMES_TSDATE,{method:"POST",body:JSON.stringify(e)})}}const Pt=new p5,et={getCurrentSession:()=>Pt.getCurrentSession(),uploadTreeSequence:t=>Pt.uploadTreeSequence(t),getUploadedFiles:()=>Pt.getUploadedFiles(),getTreeSequenceMetadata:t=>Pt.getTreeSequenceMetadata(t),deleteTreeSequence:t=>Pt.deleteTreeSequence(t),downloadTreeSequence:(t,e="trees")=>Pt.downloadTreeSequence(t,e),getGraphData:(t,e)=>Pt.getGraphData(t,e),inferLocationsFast:t=>Pt.inferLocationsFast(t),inferLocationsSparg:t=>Pt.inferLocationsSparg(t),inferLocationsGaiaQuadratic:t=>Pt.inferLocationsGaiaQuadratic(t),inferLocationsGaiaLinear:t=>Pt.inferLocationsGaiaLinear(t),inferLocationsMidpoint:t=>Pt.inferLocationsMidpoint(t),simulateTreeSequence:t=>Pt.simulateTreeSequence(t),uploadLocationCSV:(t,e)=>Pt.uploadLocationCSV(t,e),updateTreeSequenceLocations:t=>Pt.updateTreeSequenceLocations(t),getAvailableCRS:()=>Pt.getAvailableCRS(),getAvailableShapes:()=>Pt.getAvailableShapes(),uploadShapefile:t=>Pt.uploadShapefile(t),getShapeData:t=>Pt.getShapeData(t),transformCoordinates:t=>Pt.transformCoordinates(t),validateSpatialData:t=>Pt.validateSpatialData(t),inferTimesTsdate:t=>Pt.inferTimesTsdate(t)};function uI({isOpen:t,title:e,message:n,buttonText:r="OK",onClose:i,type:s="info"}){if(D.useEffect(()=>{const h=g=>{g.key==="Escape"&&i()};return t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[t,i]),!t)return null;const o=()=>{switch(s){case"success":return{icon:p.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-green-500/10",buttonColor:"bg-green-600 hover:bg-green-500 text-white"};case"error":return{icon:p.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-red-500/10",buttonColor:"bg-red-600 hover:bg-red-500 text-white"};default:return{icon:p.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-sp-pale-green/10",buttonColor:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}}},{icon:l,bgColor:u,buttonColor:d}=o();return p.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[p.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:i}),p.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u}`,children:l}),p.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),p.jsx("div",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),p.jsx("div",{className:"flex justify-end",children:p.jsx("button",{onClick:i,className:`font-bold py-3 px-6 rounded-xl transition-all duration-200 ${d}`,children:r})})]})})]})}function bc({filename:t,onError:e}){const[n,r]=D.useState(!1),i=async s=>{try{const o=await et.downloadTreeSequence(t,s),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const d=`${t.replace(/\.(trees|tsz)$/,"")}.${s}`;u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),Re.user.action("download-tree-sequence",{filename:t,format:s},"DownloadDropdown"),r(!1)}catch(o){Re.error("Download failed",{component:"DownloadDropdown",error:o instanceof Error?o:new Error(String(o)),data:{filename:t}}),e&&o instanceof Error&&e(o)}};return p.jsxs("div",{className:"relative",children:[p.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>r(!n),children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download",p.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&p.jsx("div",{className:"absolute z-50 w-48 mt-2 right-0 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:p.jsxs("div",{className:"py-2",children:[p.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("trees"),children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download .trees"]}),p.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("tsz"),children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Download .tsz"]})]})})]})}const C3={tskit:{background:"#03303E",containerBackground:"#0f1419",nodeDefault:[96,160,183,255],nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:[80,160,175,255],nodeSelected:[255,255,255,255],edgeDefault:[153,153,153,102],edgeHighlight:[255,255,255,200],text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"},grayscale:{background:"#ffffff",containerBackground:"#f8f9fa",nodeDefault:[100,100,100,255],nodeRoot:[50,50,50,255],nodeSample:[70,70,70,255],nodeCombined:[120,120,120,255],nodeSelected:[0,0,0,255],edgeDefault:[140,140,140,128],edgeHighlight:[40,40,40,200],text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",exportBackground:"#ffffff",accentPrimary:"#085167",accentSecondary:"#085167",geographicGrid:[140,140,140,102],temporalGrid:[140,140,140,77],tooltipBackground:"rgba(0, 0, 0, 0.9)",tooltipText:"#ffffff",headerText:"#212529",controlPanelText:"#212529",buttonText:"#212529"}},fI=D.createContext(void 0),sf="argscape_custom_themes",qm="argscape_selected_theme",zl="argscape_selected_custom_theme",m5=({children:t})=>{const[e,n]=D.useState("tskit"),[r,i]=D.useState([]),[s,o]=D.useState(null),[l,u]=D.useState("any");D.useEffect(()=>{try{const b=localStorage.getItem(sf);b&&i(JSON.parse(b));const T=localStorage.getItem(qm);T&&(T==="tskit"||T==="grayscale"||T==="custom")&&n(T);const A=localStorage.getItem(zl);A&&o(A)}catch(b){console.warn("Failed to load saved color themes:",b)}},[]);const d=D.useCallback(b=>{n(b),localStorage.setItem(qm,b)},[]),h=D.useCallback(b=>{o(b),b?localStorage.setItem(zl,b):localStorage.removeItem(zl)},[]),g=D.useCallback((b,T)=>{const A=`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={id:A,name:b,colors:T};return i(E=>{const C=[...E,R];return localStorage.setItem(sf,JSON.stringify(C)),C}),n("custom"),o(A),localStorage.setItem(qm,"custom"),localStorage.setItem(zl,A),A},[]),_=D.useCallback(b=>{i(T=>{const A=T.filter(R=>R.id!==b);return localStorage.setItem(sf,JSON.stringify(A)),A}),s===b&&(o(null),localStorage.removeItem(zl))},[s]),x=D.useCallback((b,T,A)=>{i(R=>{const E=R.map(C=>C.id===b?{...C,name:T,colors:A}:C);return localStorage.setItem(sf,JSON.stringify(E)),E})},[]),w=vc.useMemo(()=>{if(e==="custom"&&s){const b=r.find(T=>T.id===s);if(b)return b.colors}return C3[e]||C3.tskit},[e,s,r]),S={theme:e,setTheme:d,colors:w,customThemes:r,selectedCustomTheme:s,setSelectedCustomTheme:h,saveCustomTheme:g,deleteCustomTheme:_,updateCustomTheme:x,currentVisualizationType:l,setCurrentVisualizationType:u};return p.jsx(fI.Provider,{value:S,children:t})},bt=()=>{const t=D.useContext(fI);if(t===void 0)throw new Error("useColorTheme must be used within a ColorThemeProvider");return t},dI=t=>{if(t.startsWith("#")){const n=t.slice(1),r=parseInt(n.substr(0,2),16),i=parseInt(n.substr(2,2),16),s=parseInt(n.substr(4,2),16);return[r,i,s,255]}const e=t.match(/rgba?\(([^)]+)\)/);if(e){const n=e[1].split(",").map(r=>parseFloat(r.trim()));return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round((n[3]??1)*255)]}return[128,128,128,255]},hI=t=>{const e=["background","nodeSample","nodeRoot","nodeDefault","edgeDefault"];switch(t){case"force-directed":return e;case"spatial-3d":return[...e,"geographicGrid","temporalGrid"];case"spatial-diff":return[...e,"geographicGrid","temporalGrid"];case"any":default:return[...e,"geographicGrid","temporalGrid"]}},g5=t=>{const e=["background","containerBackground","nodeDefault","nodeRoot","nodeSample","nodeCombined","nodeSelected","edgeDefault","edgeHighlight","text","textSecondary","border","exportBackground","accentPrimary","accentSecondary","geographicGrid","temporalGrid","tooltipBackground","tooltipText","headerText","controlPanelText","buttonText"],n=hI(t);return e.filter(r=>!n.includes(r))},pI=t=>`#${t[0].toString(16).padStart(2,"0")}${t[1].toString(16).padStart(2,"0")}${t[2].toString(16).padStart(2,"0")}`;function mI({isOpen:t,title:e,message:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:s,onCancel:o,type:l="default"}){if(D.useEffect(()=>{const d=h=>{h.key==="Escape"&&o()};return t&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}},[t,o]),!t)return null;const u=l==="danger";return p.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[p.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),p.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u?"bg-red-500/10":"bg-sp-pale-green/10"}`,children:u?p.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):p.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),p.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),p.jsx("p",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),p.jsxs("div",{className:"flex gap-3",children:[p.jsx("button",{onClick:o,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:i}),p.jsx("button",{onClick:s,className:`flex-1 font-bold py-3 px-4 rounded-xl transition-all duration-200 ${u?"bg-red-600 hover:bg-red-500 text-white":"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}`,children:r})]})]})})]})}function gI({onSelect:t,className:e=""}){const[n,r]=D.useState([]),[i,s]=D.useState({}),[o,l]=D.useState(!1),[u,d]=D.useState(""),[h,g]=D.useState(new Set),[_,x]=D.useState(-1),{treeSequence:w}=ia(),[S,b]=D.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default"}),[T,A]=D.useState({isOpen:!1,title:"",message:"",type:"info"}),R=async()=>{var N;l(!0);try{Re.data.processing("fetch-available-tree-sequences","TreeSequenceSelector");const V=(await et.getUploadedFiles()).data;r(V.uploaded_tree_sequences||[]),Re.info(`Loaded ${((N=V.uploaded_tree_sequences)==null?void 0:N.length)||0} tree sequences`,{component:"TreeSequenceSelector",action:"fetch-available"})}catch(B){Re.error("Failed to fetch available tree sequences",{component:"TreeSequenceSelector",error:B instanceof Error?B:new Error(String(B))}),r([])}finally{l(!1)}},E=async N=>{try{Re.data.processing("fetch-metadata","TreeSequenceSelector",void 0,void 0);const V=(await et.getTreeSequenceMetadata(N)).data;return Re.debug(`Retrieved metadata for ${N}`,{component:"TreeSequenceSelector",data:{filename:N,num_samples:V.num_samples,num_nodes:V.num_nodes,num_mutations:V.num_mutations}}),{filename:V.filename,num_samples:V.num_samples,num_nodes:V.num_nodes,num_edges:V.num_edges,num_trees:V.num_trees,num_mutations:V.num_mutations,has_temporal:V.has_temporal,has_sample_spatial:V.has_sample_spatial,has_all_spatial:V.has_all_spatial,spatial_status:V.spatial_status}}catch(B){return Re.error(`Failed to get metadata for ${N}`,{component:"TreeSequenceSelector",error:B instanceof Error?B:new Error(String(B)),data:{filename:N}}),null}};D.useEffect(()=>{R()},[]),D.useEffect(()=>{const N=async()=>{const B={};for(const V of n){const Z=await E(V);Z&&(B[V]=Z)}s(B)};n.length>0&&N()},[n]);const C=()=>{u&&i[u]&&t(i[u])},O=(N,B,V)=>{if((V.shiftKey||V.ctrlKey||V.metaKey)&&V.preventDefault(),V.shiftKey&&_!==-1){const Z=Math.min(_,B),j=Math.max(_,B),Y=new Set;for(let $=Z;$<=j;$++)Y.add(n[$]);g(Y)}else if(V.ctrlKey||V.metaKey){const Z=new Set(h);Z.has(N)?Z.delete(N):Z.add(N),g(Z),x(B)}else d(N),g(new Set([N])),x(B)},P=async(N,B)=>{B.stopPropagation(),b({isOpen:!0,title:"Delete Tree Sequence",message:`Are you sure you want to delete "${N}"?`,type:"danger",onConfirm:async()=>{b({...S,isOpen:!1});try{Re.user.action("delete-tree-sequence",{filename:N},"TreeSequenceSelector");const V=await et.deleteTreeSequence(N);Re.info(`Successfully deleted tree sequence: ${N}`,{component:"TreeSequenceSelector",data:{filename:N}}),r(Z=>Z.filter(j=>j!==N)),s(Z=>{const j={...Z};return delete j[N],j}),u===N&&d(""),g(Z=>{const j=new Set(Z);return j.delete(N),j})}catch(V){Re.error("Failed to delete tree sequence",{component:"TreeSequenceSelector",error:V instanceof Error?V:new Error(String(V)),data:{filename:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequence: ${V instanceof Error?V.message:"Unknown error"}`,type:"error"})}}})},k=async()=>{if(h.size===0)return;const N=Array.from(h),B=N.length===1?`Are you sure you want to delete "${N[0]}"?`:`Are you sure you want to delete ${N.length} tree sequences?`;b({isOpen:!0,title:"Delete Tree Sequences",message:B,type:"danger",onConfirm:async()=>{b({...S,isOpen:!1});try{const V=N.map(Z=>et.deleteTreeSequence(Z));await Promise.all(V),Re.info(`Successfully deleted ${N.length} tree sequences`,{component:"TreeSequenceSelector",data:{filenames:N}}),r(Z=>Z.filter(j=>!N.includes(j))),s(Z=>{const j={...Z};return N.forEach(Y=>delete j[Y]),j}),g(new Set),N.includes(u)&&d("")}catch(V){Re.error("Failed to delete selected tree sequences",{component:"TreeSequenceSelector",error:V instanceof Error?V:new Error(String(V)),data:{filenames:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequences: ${V instanceof Error?V.message:"Unknown error"}`,type:"error"})}}})},I=async()=>{n.length!==0&&b({isOpen:!0,title:"Clear All Tree Sequences",message:`Are you sure you want to delete ALL ${n.length} tree sequences? This action cannot be undone.`,type:"danger",onConfirm:async()=>{b({...S,isOpen:!1});try{const N=n.map(B=>et.deleteTreeSequence(B));await Promise.all(N),Re.info(`Successfully cleared all ${n.length} tree sequences`,{component:"TreeSequenceSelector",data:{count:n.length}}),r([]),s({}),g(new Set),d("")}catch(N){Re.error("Failed to clear all tree sequences",{component:"TreeSequenceSelector",error:N instanceof Error?N:new Error(String(N))}),A({isOpen:!0,title:"Clear Failed",message:`Failed to clear all tree sequences: ${N instanceof Error?N.message:"Unknown error"}`,type:"error"}),R()}}})};return o?p.jsx("div",{className:`flex items-center justify-center p-8 ${e}`,children:p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sp-pale-green"})}):n.length===0?p.jsx("div",{className:e,children:p.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-8 text-center",children:[p.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[p.jsx("div",{className:"w-10 h-10 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:p.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),p.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"No Existing Tree Sequences"})]}),p.jsx("p",{className:"text-sp-white/60 text-sm mb-6",children:"No previously uploaded sequences found. Upload or simulate a tree sequence first."}),p.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2 mx-auto",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}):p.jsxs("div",{className:e,children:[p.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5 mb-4",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:p.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Select Existing Tree Sequence"}),p.jsx("p",{className:"text-sp-white/60 text-xs",children:"Choose from previously uploaded sequences"})]}),h.size>0&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("span",{className:"text-sm text-sp-white/70",children:[h.size," selected"]}),p.jsxs("button",{onClick:k,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-1",title:`Delete ${h.size} selected tree sequence${h.size>1?"s":""}`,children:[p.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete"]})]})]}),p.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto select-none",children:n.map((N,B)=>{const V=i[N],Z=(w==null?void 0:w.filename)===N,j=u===N,Y=h.has(N);return p.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${j?"border-sp-pale-green bg-sp-very-dark-blue shadow-lg":Y?"border-blue-400 bg-sp-very-dark-blue shadow-md":"border-sp-pale-green/20 bg-sp-very-dark-blue hover:border-sp-pale-green/50 hover:shadow-md"} ${Z?"ring-2 ring-sp-pale-green ring-offset-2 ring-offset-sp-dark-blue":""}`,onClick:$=>O(N,B,$),children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx("input",{type:"checkbox",checked:Y,onChange:()=>{},className:"w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"})}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("span",{className:"font-mono text-sp-pale-green text-sm font-medium truncate",title:N,children:N}),Z&&p.jsx("span",{className:"text-xs bg-sp-pale-green text-sp-very-dark-blue px-2 py-1 rounded-full font-medium",children:"Current"})]}),V?p.jsxs("div",{className:"text-xs text-sp-white/70 space-y-0.5",children:[p.jsxs("div",{className:"flex gap-4",children:[p.jsxs("span",{children:[V.num_samples," samples"]}),p.jsxs("span",{children:[V.num_nodes," nodes"]})]}),p.jsxs("div",{className:"flex gap-4",children:[p.jsxs("span",{children:[V.num_edges," edges"]}),p.jsxs("span",{children:[V.num_trees," trees"]})]})]}):p.jsx("div",{className:"text-xs text-sp-white/50",children:"Loading info..."})]})]}),p.jsx("button",{onClick:$=>P(N,$),className:"ml-3 text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-400/10 transition-all duration-200",title:"Delete tree sequence",children:p.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},N)})}),p.jsx("div",{className:"mt-3 text-xs text-sp-white/60 text-center",children:"Click to select for loading  Ctrl+click to multi-select  Shift+click to select range"})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{onClick:C,disabled:!u||!i[u],className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Load Selected"]}),p.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),p.jsxs("button",{onClick:I,disabled:n.length===0,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2",title:"Delete all tree sequences",children:[p.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Clear All"]})]}),p.jsx(mI,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,confirmText:"Delete",cancelText:"Cancel",onConfirm:S.onConfirm,onCancel:()=>b({...S,isOpen:!1})}),p.jsx(uI,{isOpen:T.isOpen,title:T.title,message:T.message,type:T.type,onClose:()=>A({...T,isOpen:!1})})]})}function wc({isOpen:t,onClose:e,onSelect:n}){const{colors:r}=bt();return t?p.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[p.jsx("div",{className:"fixed inset-0 transition-opacity",style:{backgroundColor:`${r.background}CC`},onClick:e}),p.jsx("div",{className:"flex items-start justify-center min-h-screen pt-16 px-4",children:p.jsxs("div",{className:"relative rounded-xl shadow-xl max-w-3xl w-full p-6 border",style:{backgroundColor:r.background,borderColor:r.border},children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h2",{className:"text-lg font-medium",style:{color:r.text},children:"Switch Tree Sequence"}),p.jsx("button",{className:"rounded-lg p-2 transition-colors",style:{color:r.text},onClick:e,onMouseEnter:i=>{i.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent"},children:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p.jsx(gI,{onSelect:n})]})})]}):null}function sa({className:t="",style:e={},size:n="medium",showSubtext:r=!1}){const i=_r(),{colors:s}=bt(),o=()=>{i("/",{state:{forceIntro:!0}})},l=()=>{switch(n){case"small":return"text-xl md:text-2xl";case"medium":return"text-2xl md:text-3xl";case"large":return"text-[3rem] md:text-[4rem]";default:return"text-2xl md:text-3xl"}};return p.jsxs("div",{className:"cursor-pointer select-none",onClick:o,children:[p.jsxs("h1",{className:`${l()} font-extrabold tracking-tight ${t}`,style:{letterSpacing:"-0.04em",...e},children:["ARG",p.jsx("span",{style:{color:s.accentPrimary},children:"scape"})]}),r&&p.jsx("div",{className:"mt-2 text-center",children:p.jsx("div",{className:"text-sm font-medium",style:{color:s.accentPrimary},children:"Visualizing Ancestral Recombination Graphs"})})]})}function aa(){const t=_r(),e=ra(),{colors:n}=bt(),r=[{label:"Upload",path:"/upload"},{label:"Simulate",path:"/simulate"},{label:"Load",path:"/load"},{label:"Learn",path:"/tutorials"},{label:"Docs",path:"/docs"}],i=s=>s==="/upload"&&e.pathname==="/"?!0:e.pathname.startsWith(s);return p.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md bg-sp-very-dark-blue/80 border-b border-sp-pale-green/10",children:p.jsxs("div",{className:"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between",children:[p.jsx("div",{className:"flex-shrink-0 transition-transform hover:scale-105",children:p.jsx(sa,{size:"small"})}),p.jsx("div",{className:"hidden md:flex items-center justify-center space-x-1",children:r.map(s=>p.jsxs("button",{onClick:()=>t(s.path),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 relative group ${i(s.path)?"text-sp-pale-green bg-sp-pale-green/10":"text-sp-white hover:text-sp-pale-green"}`,children:[s.label,p.jsx("span",{className:`absolute bottom-0 left-1/2 transform -translate-x-1/2 w-0 h-0.5 bg-sp-pale-green transition-all duration-200 ${i(s.path)?"w-full":"group-hover:w-full"}`})]},s.path))}),p.jsx("button",{className:"w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-200 hover:bg-sp-pale-green/10 hover:text-sp-pale-green text-sp-white","aria-label":"Settings",children:p.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),p.jsx("button",{className:"md:hidden w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-200 hover:bg-sp-pale-green/10 hover:text-sp-pale-green text-sp-white","aria-label":"Menu",children:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})})}const _5=[{id:"sparg",name:"sparg",description:"Spatial inference using Brownian motion on the full ancestral recombination graph. Modified to include node ID tracking. Best for small ARGs.",reference:"https://www.biorxiv.org/content/10.1101/2024.04.10.588900v2",github:"https://github.com/osmond-lab/sparg",github2:"",speed:1,enabled:!0},{id:"spacetrees",name:"spacetrees",description:"Spatial inference using genome-wide genealogies. Coming Soon!",reference:"https://elifesciences.org/articles/72177",github:"https://github.com/osmond-lab/spacetrees",github2:"",speed:2,enabled:!1},{id:"gaia_quadratic",name:"gaia quadratic",description:"High-accuracy spatial inference using quadratic parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"gaia_linear",name:"gaia linear",description:"High-accuracy spatial inference using linear parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"fastgaia",name:"fastgaia",description:"Fast spatial inference using a greedy algorithm. Best for large ARGs where GAIA is too slow.",reference:"",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/blueraleigh/gaia",speed:4,enabled:!0},{id:"midpoint",name:"Wohns midpoint",description:"Weighted midpoint-based spatial inference. Simple and fast for ARGs of all sizes.",reference:"https://doi.org/10.1126/science.abi8264",github:"https://github.com/awohns/unified_genealogy_paper/",github2:"",speed:5,enabled:!0}];function v5({selectedMethod:t,onMethodSelect:e,disabled:n,isInferring:r,data:i}){const[s,o]=D.useState(!1),[l,u]=D.useState(null),d=_5.map(_=>({..._,isReInference:(i==null?void 0:i.spatial_status)==="all"})),h=d.find(_=>_.enabled),g=d.find(_=>_.id===t)||h||d[0];return p.jsxs("div",{className:"relative",children:[p.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 w-full ${n&&"opacity-50 cursor-not-allowed hover:transform-none"} ${r&&"opacity-75 cursor-not-allowed hover:transform-none"}`,onClick:()=>!n&&!r&&o(!s),disabled:n||r,children:[r&&p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),p.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),p.jsx("span",{children:r?"Inferring...":`${g.isReInference?"Re-infer":"Infer"} locations (${g.name})`}),p.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&p.jsx("div",{className:"absolute z-50 w-full mt-2 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:p.jsx("div",{className:"py-2",children:d.map(_=>p.jsxs("div",{className:"relative group",onMouseEnter:()=>u(_),onMouseLeave:x=>{const w=document.querySelector(`[data-tooltip-id="${_.id}"]`);w&&!w.contains(x.relatedTarget)&&u(null)},children:[p.jsx("button",{className:`w-full px-4 py-2 text-left transition-colors duration-200 ${_.enabled?t===_.id?"bg-sp-pale-green/10 hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"text-sp-white/50 cursor-not-allowed"}`,onClick:()=>{_.enabled&&(e(_),o(!1))},disabled:r||!_.enabled,children:p.jsxs("div",{className:"font-medium flex items-center justify-between",children:[p.jsx("span",{children:_.name}),!_.enabled&&p.jsx("span",{className:"text-xs text-sp-pale-green/50",children:"Coming Soon"})]})}),(l==null?void 0:l.id)===_.id&&p.jsxs("div",{"data-tooltip-id":_.id,className:"fixed z-50 w-72 p-4 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",style:{left:"var(--tooltip-x, 0)",top:"var(--tooltip-y, 0)"},ref:x=>{var w;if(x){const S=(w=x.parentElement)==null?void 0:w.getBoundingClientRect();if(S){const b=window.innerHeight-S.bottom,T=S.top,A=x.offsetHeight,R=S.left-x.offsetWidth-8;let E;b>=A?E=S.top:T>=A?E=S.bottom-A:E=Math.max(8,Math.min(window.innerHeight-A-8,S.top-(A-S.height)/2)),x.style.setProperty("--tooltip-x",`${R}px`),x.style.setProperty("--tooltip-y",`${E}px`)}}},onMouseEnter:()=>u(_),onMouseLeave:()=>u(null),children:[p.jsx("h4",{className:"font-bold text-sp-pale-green mb-2",children:l.name}),p.jsx("p",{className:"text-sm text-sp-white/80 mb-2",children:l.description}),p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx("span",{className:"text-xs text-sp-white/80",children:"Speed:"}),p.jsx("div",{className:"flex items-center gap-[2px]",children:[...Array(5)].map((x,w)=>p.jsx("div",{className:`w-3 h-5 rounded-sm transition-all ${w<l.speed?w===0?"bg-yellow-400":w===1?"bg-yellow-500":w===2?"bg-lime-500":w===3?"bg-green-400":"bg-green-500":"bg-gray-700"}`},w))})]}),p.jsxs("div",{className:"flex flex-col gap-1",children:[l.reference&&p.jsx("a",{href:l.reference,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View reference"}),l.id==="gaia_quadratic"||l.id==="gaia_linear"?p.jsxs(p.Fragment,{children:[p.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"}),p.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaiapy on GitHub"})]}):l.id==="fastgaia"?p.jsxs(p.Fragment,{children:[p.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View fastgaia on GitHub"}),p.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"})]}):l.github&&p.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View on GitHub"})]})]})]},_.id))})}),p.jsxs("div",{className:"absolute -right-8 top-1/2 transform -translate-y-1/2 group",children:[p.jsx("div",{className:"p-1 cursor-help",children:p.jsx("svg",{className:"w-4 h-4 text-sp-pale-green/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),p.jsx("div",{className:"hidden group-hover:block absolute right-full mr-2 w-64 p-3 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg shadow-xl",children:p.jsx("p",{className:"text-xs text-sp-white/80",children:"Choose from different methods to infer ancestral locations in your ARG. Each method has its own strengths and is optimized for different scenarios."})})]})]})}const Hm=t=>t.toExponential(8);function x5({isOpen:t,onClose:e,onConfirm:n,defaultRate:r=1e-8}){const[i,s]=D.useState(Hm(r)),[o,l]=D.useState(!0),[u,d]=D.useState(!1),[h,g]=D.useState("1000000"),[_,x]=D.useState(!0),[w,S]=D.useState(!1),[b,T]=D.useState(!1),[A,R]=D.useState(!1),E=C=>{C.preventDefault();const O=parseFloat(i),P=h?parseFloat(h):void 0;!isNaN(O)&&O>0&&n(O,o,u,P,_,w,b,A)};return t?p.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl p-6 w-full max-w-md",children:[p.jsx("h3",{className:"text-xl font-bold text-sp-white mb-4",children:"Set Mutation Rate"}),p.jsxs("form",{onSubmit:E,className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80 mb-2",children:"Mutation Rate (per base pair per generation)"}),p.jsx("input",{type:"text",id:"mutation-rate",value:i,onChange:C=>{const O=C.target.value;s(O)},onBlur:C=>{const O=C.target.value,P=parseFloat(O);isNaN(P)||P<=0?s(Hm(r)):s(Hm(P))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),p.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"preprocess",checked:o,onChange:C=>l(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"preprocess",className:"ml-2 block text-sm text-sp-white/80",children:"Preprocess tree sequence"})]}),o&&p.jsxs("div",{className:"ml-6 space-y-3 border-l-2 border-sp-pale-green/20 pl-4",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"remove-telomeres",checked:u,onChange:C=>d(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"remove-telomeres",className:"ml-2 block text-sm text-sp-white/80",children:"Remove telomeres (flanking regions)"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"minimum-gap",className:"block text-sm text-sp-white/80 mb-1",children:"Minimum gap between sites (bp)"}),p.jsx("input",{type:"text",id:"minimum-gap",value:h,onChange:C=>g(C.target.value),onBlur:C=>{const O=C.target.value,P=parseFloat(O);(isNaN(P)||P<0)&&g("1000000")},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1000000"}),p.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1,000,000 bp"})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"split-disjoint",checked:_,onChange:C=>x(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"split-disjoint",className:"ml-2 block text-sm text-sp-white/80",children:"Split disjoint nodes"})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"filter-populations",checked:w,onChange:C=>S(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"filter-populations",className:"ml-2 block text-sm text-sp-white/80",children:"Filter populations"})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"filter-individuals",checked:b,onChange:C=>T(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"filter-individuals",className:"ml-2 block text-sm text-sp-white/80",children:"Filter individuals"})]}),p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"filter-sites",checked:A,onChange:C=>R(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),p.jsx("label",{htmlFor:"filter-sites",className:"ml-2 block text-sm text-sp-white/80",children:"Filter sites"})]}),p.jsx("p",{className:"text-xs text-sp-white/60",children:"Preprocessing simplifies the tree sequence by removing unary nodes and splitting disjoint nodes. Telomeres are flanking regions that may contain missing data."})]})]}),p.jsxs("div",{className:"flex justify-end gap-3",children:[p.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sp-white/80 hover:text-sp-white transition-colors",children:"Cancel"}),p.jsx("button",{type:"submit",className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold px-4 py-2 rounded-lg transition-colors",children:"Run tsdate"})]})]})]})}):null}function y5(){const t=_r(),e=ra(),{treeSequence:n,maxSamples:r,setMaxSamples:i,setTreeSequence:s}=ia(),[o,l]=D.useState(null),[u,d]=D.useState(!1),[h,g]=D.useState(!1),[_,x]=D.useState(!1),[w,S]=D.useState(!1),[b,T]=D.useState(!1),[A,R]=D.useState(!1),[E,C]=D.useState(r.toString()),[O,P]=D.useState("gaia_quadratic"),[k,I]=D.useState(!1),[N,B]=D.useState(!1),[V,Z]=D.useState(!1),[j,Y]=D.useState(null),[$,Q]=D.useState({isOpen:!1,title:"",message:"",type:"info"});D.useEffect(()=>{n!=null&&n.num_samples&&l(n.num_samples)},[n]),D.useEffect(()=>{C(r.toString())},[r]),n!=null&&n.has_temporal;const oe=(n==null?void 0:n.spatial_status)==="sample_only"||(n==null?void 0:n.spatial_status)==="all",K=!!(n!=null&&n.has_temporal&&(n!=null&&n.has_all_spatial)),L=K,W=(n==null?void 0:n.num_mutations)!==void 0&&n.num_mutations>0,fe=async()=>{if(!(!(n!=null&&n.filename)||u)){d(!0);try{Re.user.action("fast-location-inference-start",{filename:n.filename},"ResultPage");const be=await et.inferLocationsFast({filename:n.filename,weight_span:!0,weight_branch_length:!0});Re.info("Fast location inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:be.data}});const we=be.data,ke={...n,filename:we.new_filename,has_sample_spatial:we.has_sample_spatial,has_all_spatial:we.has_all_spatial,spatial_status:we.spatial_status};s(ke),Q({isOpen:!0,title:"Success!",message:`Fast location inference completed successfully!
Inferred locations for ${we.num_inferred_locations} nodes.
New file: ${we.new_filename}`,type:"success"})}catch(be){Re.error("Fast location inference failed",{component:"ResultPage",error:be instanceof Error?be:new Error(String(be)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Fast location inference failed: ${be instanceof Error?be.message:"Unknown error"}`,type:"error"})}finally{d(!1)}}},se=async()=>{if(!(!(n!=null&&n.filename)||h)){g(!0);try{Re.user.action("gaia-quadratic-inference-start",{filename:n.filename},"ResultPage");const be=await et.inferLocationsGaiaQuadratic({filename:n.filename});Re.info("GAIA quadratic inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:be.data}});const we=be.data,ke={...n,filename:we.new_filename,has_sample_spatial:we.has_sample_spatial,has_all_spatial:we.has_all_spatial,spatial_status:we.spatial_status};s(ke),Q({isOpen:!0,title:"Success!",message:`GAIA quadratic inference completed successfully!
Inferred locations for ${we.num_inferred_locations} nodes.
New file: ${we.new_filename}`,type:"success"})}catch(be){Re.error("GAIA quadratic inference failed",{component:"ResultPage",error:be instanceof Error?be:new Error(String(be)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA quadratic inference failed: ${be instanceof Error?be.message:"Unknown error"}`,type:"error"})}finally{g(!1)}}},z=be=>{Re.user.action("switch-tree-sequence",{treeSequence:be},"ResultPage"),s(be),R(!1)},X=()=>{var we;const be=(we=e.state)==null?void 0:we.fromIntermediate;be?be==="load"?(Re.nav("result","landing"),t("/",{state:{fromInternal:!0}})):(Re.nav("result","intermediate"),t("/",{state:{fromResult:!0,selectedOption:be}})):(Re.nav("result","landing"),t("/",{state:{fromInternal:!0}}))},J=async be=>{if(n!=null&&n.filename)switch(be.id){case"fastgaia":await fe();break;case"gaia_quadratic":await se();break;case"gaia_linear":if(_)return;x(!0);try{Re.user.action("gaia-linear-inference-start",{filename:n.filename},"ResultPage");const we=await et.inferLocationsGaiaLinear({filename:n.filename});Re.info("GAIA linear inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:we.data}});const ke=we.data,Xe={...n,filename:ke.new_filename,has_sample_spatial:ke.has_sample_spatial,has_all_spatial:ke.has_all_spatial,spatial_status:ke.spatial_status};s(Xe),Q({isOpen:!0,title:"Success!",message:`GAIA linear inference completed successfully!
Inferred locations for ${ke.num_inferred_locations} nodes.
New file: ${ke.new_filename}`,type:"success"})}catch(we){Re.error("GAIA linear inference failed",{component:"ResultPage",error:we instanceof Error?we:new Error(String(we)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA linear inference failed: ${we instanceof Error?we.message:"Unknown error"}`,type:"error"})}finally{x(!1)}break;case"sparg":if(b)return;T(!0);try{Re.user.action("sparg-inference-start",{filename:n.filename},"ResultPage");const we=await et.inferLocationsSparg({filename:n.filename});Re.info("sparg inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:we.data}});const ke=we.data,Xe={...n,filename:ke.new_filename,has_sample_spatial:ke.has_sample_spatial,has_all_spatial:ke.has_all_spatial,spatial_status:ke.spatial_status};s(Xe),Q({isOpen:!0,title:"Success!",message:`sparg inference completed successfully!
Inferred locations for ${ke.num_inferred_locations} nodes.
New file: ${ke.new_filename}`,type:"success"})}catch(we){Re.error("sparg inference failed",{component:"ResultPage",error:we instanceof Error?we:new Error(String(we)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`sparg inference failed: ${we instanceof Error?we.message:"Unknown error"}`,type:"error"})}finally{T(!1)}break;case"midpoint":if(w)return;S(!0);try{Re.user.action("midpoint-inference-start",{filename:n.filename},"ResultPage");const we=await et.inferLocationsMidpoint({filename:n.filename});Re.info("Midpoint inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:we.data}});const ke=we.data,Xe={...n,filename:ke.new_filename,has_sample_spatial:ke.has_sample_spatial,has_all_spatial:ke.has_all_spatial,spatial_status:ke.spatial_status};s(Xe),Q({isOpen:!0,title:"Success!",message:`Midpoint inference completed successfully!
Inferred locations for ${ke.num_inferred_locations} nodes.
New file: ${ke.new_filename}`,type:"success"})}catch(we){Re.error("Midpoint inference failed",{component:"ResultPage",error:we instanceof Error?we:new Error(String(we)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Midpoint inference failed: ${we instanceof Error?we.message:"Unknown error"}`,type:"error"})}finally{S(!1)}break;default:Q({isOpen:!0,title:"Not Implemented",message:`The ${be.name} inference method is not yet implemented.`,type:"info"})}},pe=u||h||_||w||b,xe=async(be,we,ke,Xe,Le,Kt,Ie,nn)=>{if(!(!(n!=null&&n.filename)||N)){B(!0),I(!1);try{Re.user.action("tsdate-inference-start",{filename:n.filename,mutationRate:be,preprocess:we,removeTelomeres:ke,minimumGap:Xe,splitDisjoint:Le,filterPopulations:Kt,filterIndividuals:Ie,filterSites:nn},"ResultPage");const ot=await et.inferTimesTsdate({filename:n.filename,mutation_rate:be,preprocess:we,remove_telomeres:ke,minimum_gap:Xe,split_disjoint:Le,filter_populations:Kt,filter_individuals:Ie,filter_sites:nn});Re.info("tsdate inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:ot.data}});const pt=ot.data,Mt={...n,filename:pt.new_filename,has_temporal:pt.has_temporal};s(Mt);const rn=pt.preprocessing.preprocessed?`
Preprocessing: ${[pt.preprocessing.remove_telomeres?"with telomere removal":"without telomere removal",pt.preprocessing.minimum_gap?`minimum gap ${pt.preprocessing.minimum_gap}bp`:null,pt.preprocessing.split_disjoint?"split disjoint nodes":null,pt.preprocessing.filter_populations?"filtered populations":null,pt.preprocessing.filter_individuals?"filtered individuals":null,pt.preprocessing.filter_sites?"filtered sites":null].filter(Boolean).join(", ")}`:`
No preprocessing applied`;Q({isOpen:!0,title:"Success!",message:`tsdate inference completed successfully!${rn}
Inferred times for ${pt.num_inferred_times} nodes.
New file: ${pt.new_filename}`,type:"success"})}catch(ot){Re.error("tsdate inference failed",{component:"ResultPage",error:ot instanceof Error?ot:new Error(String(ot)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`tsdate inference failed: ${ot instanceof Error?ot.message:"Unknown error"}`,type:"error"})}finally{B(!1)}}},Ae=()=>{L&&Z(!0)},Ne=be=>{if(n){if(!be.has_temporal||!be.has_all_spatial||be.filename===n.filename){Q({isOpen:!0,title:"Invalid Selection",message:"The selected tree sequence must have temporal and spatial data, and must be different from the current tree sequence.",type:"error"});return}Y(be),Z(!1),t(`/visualize-spatial-diff/${encodeURIComponent(n.filename)}?second=${encodeURIComponent(be.filename)}`)}};return n?p.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen flex flex-col",children:[p.jsx(aa,{}),p.jsxs("div",{className:"flex-grow px-4 pt-24 pb-20",children:[p.jsx("div",{className:"max-w-7xl mx-auto mb-8",children:p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Tree Sequence Analysis"}),p.jsx("p",{className:"text-sp-white/70 text-lg font-mono break-all",children:n.filename})]})}),p.jsx("div",{className:"max-w-7xl mx-auto",children:p.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:p.jsxs("div",{className:"p-8 space-y-6",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{className:"flex flex-wrap gap-3",children:[p.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_temporal?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[p.jsx("span",{className:`inline-block ${n.has_temporal?"text-sp-white":"text-red-400"}`,children:n.has_temporal?"":""}),"Temporal"]}),p.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_sample_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[p.jsx("span",{className:`inline-block ${n.has_sample_spatial?"text-sp-white":"text-red-400"}`,children:n.has_sample_spatial?"":""}),"Sample Coords"]}),p.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_all_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[p.jsx("span",{className:`inline-block ${n.has_all_spatial?"text-sp-white":"text-red-400"}`,children:n.has_all_spatial?"":""}),"All Coords"]}),p.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${W?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[p.jsx("span",{className:`inline-block ${W?"text-sp-white":"text-red-400"}`,children:W?"":""}),"Mutations"]})]}),p.jsxs("div",{className:"flex gap-2",children:[p.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>R(!A),children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),A?"Cancel":"Switch Tree Sequence"]}),p.jsx(bc,{filename:n.filename,onError:be=>{Q({isOpen:!0,title:"Download Failed",message:`Failed to download tree sequence: ${be.message}`,type:"error"})}})]})]}),p.jsx(wc,{isOpen:A,onClose:()=>R(!1),onSelect:z}),p.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[p.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_samples}),p.jsx("div",{className:"text-xs text-sp-white/70",children:"Samples"})]}),p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[p.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_nodes}),p.jsx("div",{className:"text-xs text-sp-white/70",children:"Nodes"})]}),p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[p.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_edges}),p.jsx("div",{className:"text-xs text-sp-white/70",children:"Edges"})]}),p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[p.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_trees}),p.jsx("div",{className:"text-xs text-sp-white/70",children:"Local Trees"})]}),p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[p.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_mutations??0}),p.jsx("div",{className:"text-xs text-sp-white/70",children:"Mutations"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[p.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 ${!W&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!W||N,onClick:()=>I(!0),children:[N&&p.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsx("span",{children:N?"Inferring...":"Infer ages (tsdate)"})]}),p.jsx(v5,{selectedMethod:O,onMethodSelect:be=>{P(be.id),J(be)},disabled:!oe,isInferring:pe,data:n})]}),p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-4",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:p.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),p.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Visualization Sample Count"})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("input",{type:"range",id:"sample-slider",min:"2",max:o||ss.DEFAULT_MAX_SAMPLES,value:Math.max(r,2),onChange:be=>i(parseInt(be.target.value)),className:"flex-1 h-2 bg-sp-dark-blue rounded-lg appearance-none cursor-pointer accent-sp-pale-green"}),p.jsxs("div",{className:"flex items-center gap-2 min-w-[8rem]",children:[p.jsx("input",{type:"number",value:E,onChange:be=>{const we=be.target.value;if(C(we),we!==""){const ke=parseInt(we);isNaN(ke)||i(ke)}},onBlur:be=>{const we=parseInt(be.target.value);let ke=2;isNaN(we)||(ke=Math.max(2,Math.min(we,o||ss.DEFAULT_MAX_SAMPLES))),i(ke),C(ke.toString())},min:"2",max:o||ss.DEFAULT_MAX_SAMPLES,className:"w-20 bg-sp-dark-blue border border-sp-pale-green/20 rounded px-2 py-1 text-sm text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green"}),p.jsxs("span",{className:"text-sm font-mono text-sp-white/70",children:["/ ",o||"?"]})]})]}),p.jsxs("div",{className:"mt-2",children:[p.jsx("p",{className:"text-xs text-sp-white/60",children:"Adjust before visualizing to control the number of samples shown (minimum: 2)"}),o&&o>ss.WARNING_THRESHOLD&&p.jsx("p",{className:"text-xs text-sp-white/60 mt-1",children:"Note: Large sample numbers may affect visualization performance"})]})]}),p.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[p.jsxs("button",{className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 false",disabled:!1,onClick:()=>t(`/visualize/${encodeURIComponent(n.filename)}`),children:[p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),p.jsxs("div",{className:"text-center",children:[p.jsx("span",{className:"text-base font-bold",children:"Visualize ARG"}),p.jsx("span",{className:"text-sm opacity-80 block",children:"Interactive D3"})]})]}),p.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!K&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!K,onClick:()=>t(`/visualize-spatial/${encodeURIComponent(n.filename)}`),children:[p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsxs("div",{className:"text-center",children:[p.jsx("span",{className:"text-base font-bold",children:"Spatial ARG"}),p.jsx("span",{className:"text-sm opacity-80 block",children:"3D coordinates"})]})]}),p.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!L&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!L,onClick:Ae,children:[p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),p.jsxs("div",{className:"text-center",children:[p.jsx("span",{className:"text-base font-bold",children:"Spatial Diff"}),p.jsx("span",{className:"text-sm opacity-80 block",children:"Compare locations"})]})]}),p.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Pretty ARG visualization coming soon",children:[p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})}),p.jsxs("div",{className:"text-center",children:[p.jsx("span",{className:"text-base font-bold",children:"Pretty ARG"}),p.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]})]})]})})}),p.jsx(x5,{isOpen:k,onClose:()=>I(!1),onConfirm:xe}),V&&n&&p.jsx(wc,{isOpen:V,onClose:()=>Z(!1),onSelect:Ne}),p.jsx(uI,{isOpen:$.isOpen,title:$.title,message:$.message,type:$.type,onClose:()=>Q({...$,isOpen:!1})})]})]}):p.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-sp-very-dark-blue text-sp-white",children:[p.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No data loaded"}),p.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4",onClick:X,children:"Back to Home"})]})}var b5={value:()=>{}};function Oc(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Rf(n)}function Rf(t){this._=t}function w5(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Rf.prototype=Oc.prototype={constructor:Rf,on:function(t,e){var n=this._,r=w5(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=S5(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=N3(n[i],t.name,e);else if(e==null)for(i in n)n[i]=N3(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Rf(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function S5(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function N3(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=b5,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var i0="http://www.w3.org/1999/xhtml";const k3={svg:"http://www.w3.org/2000/svg",xhtml:i0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Xd(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),k3.hasOwnProperty(e)?{space:k3[e],local:t}:t}function T5(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===i0&&e.documentElement.namespaceURI===i0?e.createElement(t):e.createElementNS(n,t)}}function E5(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function _I(t){var e=Xd(t);return(e.local?E5:T5)(e)}function A5(){}function d1(t){return t==null?A5:function(){return this.querySelector(t)}}function R5(t){typeof t!="function"&&(t=d1(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=new Array(o),u,d,h=0;h<o;++h)(u=s[h])&&(d=t.call(u,u.__data__,h,s))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new Qn(r,this._parents)}function C5(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function N5(){return[]}function vI(t){return t==null?N5:function(){return this.querySelectorAll(t)}}function k5(t){return function(){return C5(t.apply(this,arguments))}}function M5(t){typeof t=="function"?t=k5(t):t=vI(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(t.call(u,u.__data__,d,o)),i.push(u));return new Qn(r,i)}function xI(t){return function(){return this.matches(t)}}function yI(t){return function(e){return e.matches(t)}}var I5=Array.prototype.find;function O5(t){return function(){return I5.call(this.children,t)}}function P5(){return this.firstElementChild}function D5(t){return this.select(t==null?P5:O5(typeof t=="function"?t:yI(t)))}var j5=Array.prototype.filter;function L5(){return Array.from(this.children)}function B5(t){return function(){return j5.call(this.children,t)}}function U5(t){return this.selectAll(t==null?L5:B5(typeof t=="function"?t:yI(t)))}function F5(t){typeof t!="function"&&(t=xI(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new Qn(r,this._parents)}function bI(t){return new Array(t.length)}function z5(){return new Qn(this._enter||this._groups.map(bI),this._parents)}function zf(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}zf.prototype={constructor:zf,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function $5(t){return function(){return t}}function V5(t,e,n,r,i,s){for(var o=0,l,u=e.length,d=s.length;o<d;++o)(l=e[o])?(l.__data__=s[o],r[o]=l):n[o]=new zf(t,s[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function q5(t,e,n,r,i,s,o){var l,u,d=new Map,h=e.length,g=s.length,_=new Array(h),x;for(l=0;l<h;++l)(u=e[l])&&(_[l]=x=o.call(u,u.__data__,l,e)+"",d.has(x)?i[l]=u:d.set(x,u));for(l=0;l<g;++l)x=o.call(t,s[l],l,s)+"",(u=d.get(x))?(r[l]=u,u.__data__=s[l],d.delete(x)):n[l]=new zf(t,s[l]);for(l=0;l<h;++l)(u=e[l])&&d.get(_[l])===u&&(i[l]=u)}function H5(t){return t.__data__}function W5(t,e){if(!arguments.length)return Array.from(this,H5);var n=e?q5:V5,r=this._parents,i=this._groups;typeof t!="function"&&(t=$5(t));for(var s=i.length,o=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var h=r[d],g=i[d],_=g.length,x=X5(t.call(h,h&&h.__data__,d,r)),w=x.length,S=l[d]=new Array(w),b=o[d]=new Array(w),T=u[d]=new Array(_);n(h,g,S,b,T,x,e);for(var A=0,R=0,E,C;A<w;++A)if(E=S[A]){for(A>=R&&(R=A+1);!(C=b[R])&&++R<w;);E._next=C||null}}return o=new Qn(o,r),o._enter=l,o._exit=u,o}function X5(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Y5(){return new Qn(this._exit||this._groups.map(bI),this._parents)}function G5(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function K5(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),l=new Array(i),u=0;u<o;++u)for(var d=n[u],h=r[u],g=d.length,_=l[u]=new Array(g),x,w=0;w<g;++w)(x=d[w]||h[w])&&(_[w]=x);for(;u<i;++u)l[u]=n[u];return new Qn(l,this._parents)}function Z5(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Q5(t){t||(t=J5);function e(g,_){return g&&_?t(g.__data__,_.__data__):!g-!_}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],l=o.length,u=i[s]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(e)}return new Qn(i,this._parents).order()}function J5(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function eU(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function tU(){return Array.from(this)}function nU(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function rU(){let t=0;for(const e of this)++t;return t}function iU(){return!this.node()}function sU(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,l;s<o;++s)(l=i[s])&&t.call(l,l.__data__,s,i);return this}function aU(t){return function(){this.removeAttribute(t)}}function oU(t){return function(){this.removeAttributeNS(t.space,t.local)}}function lU(t,e){return function(){this.setAttribute(t,e)}}function cU(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function uU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function fU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function dU(t,e){var n=Xd(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?oU:aU:typeof e=="function"?n.local?fU:uU:n.local?cU:lU)(n,e))}function wI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function hU(t){return function(){this.style.removeProperty(t)}}function pU(t,e,n){return function(){this.style.setProperty(t,e,n)}}function mU(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function gU(t,e,n){return arguments.length>1?this.each((e==null?hU:typeof e=="function"?mU:pU)(t,e,n??"")):wo(this.node(),t)}function wo(t,e){return t.style.getPropertyValue(e)||wI(t).getComputedStyle(t,null).getPropertyValue(e)}function _U(t){return function(){delete this[t]}}function vU(t,e){return function(){this[t]=e}}function xU(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function yU(t,e){return arguments.length>1?this.each((e==null?_U:typeof e=="function"?xU:vU)(t,e)):this.node()[t]}function SI(t){return t.trim().split(/^|\s+/)}function h1(t){return t.classList||new TI(t)}function TI(t){this._node=t,this._names=SI(t.getAttribute("class")||"")}TI.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function EI(t,e){for(var n=h1(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function AI(t,e){for(var n=h1(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function bU(t){return function(){EI(this,t)}}function wU(t){return function(){AI(this,t)}}function SU(t,e){return function(){(e.apply(this,arguments)?EI:AI)(this,t)}}function TU(t,e){var n=SI(t+"");if(arguments.length<2){for(var r=h1(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?SU:e?bU:wU)(n,e))}function EU(){this.textContent=""}function AU(t){return function(){this.textContent=t}}function RU(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function CU(t){return arguments.length?this.each(t==null?EU:(typeof t=="function"?RU:AU)(t)):this.node().textContent}function NU(){this.innerHTML=""}function kU(t){return function(){this.innerHTML=t}}function MU(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function IU(t){return arguments.length?this.each(t==null?NU:(typeof t=="function"?MU:kU)(t)):this.node().innerHTML}function OU(){this.nextSibling&&this.parentNode.appendChild(this)}function PU(){return this.each(OU)}function DU(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jU(){return this.each(DU)}function LU(t){var e=typeof t=="function"?t:_I(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function BU(){return null}function UU(t,e){var n=typeof t=="function"?t:_I(t),r=e==null?BU:typeof e=="function"?e:d1(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function FU(){var t=this.parentNode;t&&t.removeChild(this)}function zU(){return this.each(FU)}function $U(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function VU(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function qU(t){return this.select(t?VU:$U)}function HU(t){return arguments.length?this.property("__data__",t):this.node().__data__}function WU(t){return function(e){t.call(this,e,this.__data__)}}function XU(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function YU(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function GU(t,e,n){return function(){var r=this.__on,i,s=WU(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function KU(t,e,n){var r=XU(t+""),i,s=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(i=0,h=l[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(l=e?GU:YU,i=0;i<s;++i)this.each(l(r[i],e,n));return this}function RI(t,e,n){var r=wI(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ZU(t,e){return function(){return RI(this,t,e)}}function QU(t,e){return function(){return RI(this,t,e.apply(this,arguments))}}function JU(t,e){return this.each((typeof e=="function"?QU:ZU)(t,e))}function*e8(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var CI=[null];function Qn(t,e){this._groups=t,this._parents=e}function Pc(){return new Qn([[document.documentElement]],CI)}function t8(){return this}Qn.prototype=Pc.prototype={constructor:Qn,select:R5,selectAll:M5,selectChild:D5,selectChildren:U5,filter:F5,data:W5,enter:z5,exit:Y5,join:G5,merge:K5,selection:t8,order:Z5,sort:Q5,call:eU,nodes:tU,node:nU,size:rU,empty:iU,each:sU,attr:dU,style:gU,property:yU,classed:TU,text:CU,html:IU,raise:PU,lower:jU,append:LU,insert:UU,remove:zU,clone:qU,datum:HU,on:KU,dispatch:JU,[Symbol.iterator]:e8};function fr(t){return typeof t=="string"?new Qn([[document.querySelector(t)]],[document.documentElement]):new Qn([[t]],CI)}function n8(t){let e;for(;e=t.sourceEvent;)t=e;return t}function _i(t,e){if(t=n8(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const r8={passive:!1},Sc={capture:!0,passive:!1};function Wm(t){t.stopImmediatePropagation()}function vo(t){t.preventDefault(),t.stopImmediatePropagation()}function NI(t){var e=t.document.documentElement,n=fr(t).on("dragstart.drag",vo,Sc);"onselectstart"in e?n.on("selectstart.drag",vo,Sc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function kI(t,e){var n=t.document.documentElement,r=fr(t).on("dragstart.drag",null);e&&(r.on("click.drag",vo,Sc),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const af=t=>()=>t;function s0(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}s0.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function i8(t){return!t.ctrlKey&&!t.button}function s8(){return this.parentNode}function a8(t,e){return e??{x:t.x,y:t.y}}function o8(){return navigator.maxTouchPoints||"ontouchstart"in this}function l8(){var t=i8,e=s8,n=a8,r=o8,i={},s=Oc("start","drag","end"),o=0,l,u,d,h,g=0;function _(E){E.on("mousedown.drag",x).filter(r).on("touchstart.drag",b).on("touchmove.drag",T,r8).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function x(E,C){if(!(h||!t.call(this,E,C))){var O=R(this,e.call(this,E,C),E,C,"mouse");O&&(fr(E.view).on("mousemove.drag",w,Sc).on("mouseup.drag",S,Sc),NI(E.view),Wm(E),d=!1,l=E.clientX,u=E.clientY,O("start",E))}}function w(E){if(vo(E),!d){var C=E.clientX-l,O=E.clientY-u;d=C*C+O*O>g}i.mouse("drag",E)}function S(E){fr(E.view).on("mousemove.drag mouseup.drag",null),kI(E.view,d),vo(E),i.mouse("end",E)}function b(E,C){if(t.call(this,E,C)){var O=E.changedTouches,P=e.call(this,E,C),k=O.length,I,N;for(I=0;I<k;++I)(N=R(this,P,E,C,O[I].identifier,O[I]))&&(Wm(E),N("start",E,O[I]))}}function T(E){var C=E.changedTouches,O=C.length,P,k;for(P=0;P<O;++P)(k=i[C[P].identifier])&&(vo(E),k("drag",E,C[P]))}function A(E){var C=E.changedTouches,O=C.length,P,k;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),P=0;P<O;++P)(k=i[C[P].identifier])&&(Wm(E),k("end",E,C[P]))}function R(E,C,O,P,k,I){var N=s.copy(),B=_i(I||O,C),V,Z,j;if((j=n.call(E,new s0("beforestart",{sourceEvent:O,target:_,identifier:k,active:o,x:B[0],y:B[1],dx:0,dy:0,dispatch:N}),P))!=null)return V=j.x-B[0]||0,Z=j.y-B[1]||0,function Y($,Q,oe){var K=B,L;switch($){case"start":i[k]=Y,L=o++;break;case"end":delete i[k],--o;case"drag":B=_i(oe||Q,C),L=o;break}N.call($,E,new s0($,{sourceEvent:Q,subject:j,target:_,identifier:k,active:L,x:B[0]+V,y:B[1]+Z,dx:B[0]-K[0],dy:B[1]-K[1],dispatch:N}),P)}}return _.filter=function(E){return arguments.length?(t=typeof E=="function"?E:af(!!E),_):t},_.container=function(E){return arguments.length?(e=typeof E=="function"?E:af(E),_):e},_.subject=function(E){return arguments.length?(n=typeof E=="function"?E:af(E),_):n},_.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:af(!!E),_):r},_.on=function(){var E=s.on.apply(s,arguments);return E===s?_:E},_.clickDistance=function(E){return arguments.length?(g=(E=+E)*E,_):Math.sqrt(g)},_}function p1(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function MI(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Dc(){}var Tc=.7,$f=1/Tc,xo="\\s*([+-]?\\d+)\\s*",Ec="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c8=/^#([0-9a-f]{3,8})$/,u8=new RegExp(`^rgb\\(${xo},${xo},${xo}\\)$`),f8=new RegExp(`^rgb\\(${Gr},${Gr},${Gr}\\)$`),d8=new RegExp(`^rgba\\(${xo},${xo},${xo},${Ec}\\)$`),h8=new RegExp(`^rgba\\(${Gr},${Gr},${Gr},${Ec}\\)$`),p8=new RegExp(`^hsl\\(${Ec},${Gr},${Gr}\\)$`),m8=new RegExp(`^hsla\\(${Ec},${Gr},${Gr},${Ec}\\)$`),M3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};p1(Dc,Ac,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:I3,formatHex:I3,formatHex8:g8,formatHsl:_8,formatRgb:O3,toString:O3});function I3(){return this.rgb().formatHex()}function g8(){return this.rgb().formatHex8()}function _8(){return II(this).formatHsl()}function O3(){return this.rgb().formatRgb()}function Ac(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=c8.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?P3(e):n===3?new jn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?of(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?of(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=u8.exec(t))?new jn(e[1],e[2],e[3],1):(e=f8.exec(t))?new jn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=d8.exec(t))?of(e[1],e[2],e[3],e[4]):(e=h8.exec(t))?of(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=p8.exec(t))?L3(e[1],e[2]/100,e[3]/100,1):(e=m8.exec(t))?L3(e[1],e[2]/100,e[3]/100,e[4]):M3.hasOwnProperty(t)?P3(M3[t]):t==="transparent"?new jn(NaN,NaN,NaN,0):null}function P3(t){return new jn(t>>16&255,t>>8&255,t&255,1)}function of(t,e,n,r){return r<=0&&(t=e=n=NaN),new jn(t,e,n,r)}function v8(t){return t instanceof Dc||(t=Ac(t)),t?(t=t.rgb(),new jn(t.r,t.g,t.b,t.opacity)):new jn}function a0(t,e,n,r){return arguments.length===1?v8(t):new jn(t,e,n,r??1)}function jn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}p1(jn,a0,MI(Dc,{brighter(t){return t=t==null?$f:Math.pow($f,t),new jn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Tc:Math.pow(Tc,t),new jn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new jn($s(this.r),$s(this.g),$s(this.b),Vf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:D3,formatHex:D3,formatHex8:x8,formatRgb:j3,toString:j3}));function D3(){return`#${Us(this.r)}${Us(this.g)}${Us(this.b)}`}function x8(){return`#${Us(this.r)}${Us(this.g)}${Us(this.b)}${Us((isNaN(this.opacity)?1:this.opacity)*255)}`}function j3(){const t=Vf(this.opacity);return`${t===1?"rgb(":"rgba("}${$s(this.r)}, ${$s(this.g)}, ${$s(this.b)}${t===1?")":`, ${t})`}`}function Vf(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function $s(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Us(t){return t=$s(t),(t<16?"0":"")+t.toString(16)}function L3(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Nr(t,e,n,r)}function II(t){if(t instanceof Nr)return new Nr(t.h,t.s,t.l,t.opacity);if(t instanceof Dc||(t=Ac(t)),!t)return new Nr;if(t instanceof Nr)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,l=s-i,u=(s+i)/2;return l?(e===s?o=(n-r)/l+(n<r)*6:n===s?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?s+i:2-s-i,o*=60):l=u>0&&u<1?0:o,new Nr(o,l,u,t.opacity)}function y8(t,e,n,r){return arguments.length===1?II(t):new Nr(t,e,n,r??1)}function Nr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}p1(Nr,y8,MI(Dc,{brighter(t){return t=t==null?$f:Math.pow($f,t),new Nr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Tc:Math.pow(Tc,t),new Nr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new jn(Xm(t>=240?t-240:t+120,i,r),Xm(t,i,r),Xm(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Nr(B3(this.h),lf(this.s),lf(this.l),Vf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Vf(this.opacity);return`${t===1?"hsl(":"hsla("}${B3(this.h)}, ${lf(this.s)*100}%, ${lf(this.l)*100}%${t===1?")":`, ${t})`}`}}));function B3(t){return t=(t||0)%360,t<0?t+360:t}function lf(t){return Math.max(0,Math.min(1,t||0))}function Xm(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const OI=t=>()=>t;function b8(t,e){return function(n){return t+n*e}}function w8(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function S8(t){return(t=+t)==1?PI:function(e,n){return n-e?w8(e,n,t):OI(isNaN(e)?n:e)}}function PI(t,e){var n=e-t;return n?b8(t,n):OI(isNaN(t)?e:t)}const U3=function t(e){var n=S8(e);function r(i,s){var o=n((i=a0(i)).r,(s=a0(s)).r),l=n(i.g,s.g),u=n(i.b,s.b),d=PI(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=l(h),i.b=u(h),i.opacity=d(h),i+""}}return r.gamma=t,r}(1);function Ji(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var o0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ym=new RegExp(o0.source,"g");function T8(t){return function(){return t}}function E8(t){return function(e){return t(e)+""}}function A8(t,e){var n=o0.lastIndex=Ym.lastIndex=0,r,i,s,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=o0.exec(t))&&(i=Ym.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:Ji(r,i)})),n=Ym.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?u[0]?E8(u[0].x):T8(e):(e=u.length,function(d){for(var h=0,g;h<e;++h)l[(g=u[h]).i]=g.x(d);return l.join("")})}var F3=180/Math.PI,l0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function DI(t,e,n,r,i,s){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*F3,skewX:Math.atan(u)*F3,scaleX:o,scaleY:l}}var cf;function R8(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?l0:DI(e.a,e.b,e.c,e.d,e.e,e.f)}function C8(t){return t==null||(cf||(cf=document.createElementNS("http://www.w3.org/2000/svg","g")),cf.setAttribute("transform",t),!(t=cf.transform.baseVal.consolidate()))?l0:(t=t.matrix,DI(t.a,t.b,t.c,t.d,t.e,t.f))}function jI(t,e,n,r){function i(d){return d.length?d.pop()+" ":""}function s(d,h,g,_,x,w){if(d!==g||h!==_){var S=x.push("translate(",null,e,null,n);w.push({i:S-4,x:Ji(d,g)},{i:S-2,x:Ji(h,_)})}else(g||_)&&x.push("translate("+g+e+_+n)}function o(d,h,g,_){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),_.push({i:g.push(i(g)+"rotate(",null,r)-2,x:Ji(d,h)})):h&&g.push(i(g)+"rotate("+h+r)}function l(d,h,g,_){d!==h?_.push({i:g.push(i(g)+"skewX(",null,r)-2,x:Ji(d,h)}):h&&g.push(i(g)+"skewX("+h+r)}function u(d,h,g,_,x,w){if(d!==g||h!==_){var S=x.push(i(x)+"scale(",null,",",null,")");w.push({i:S-4,x:Ji(d,g)},{i:S-2,x:Ji(h,_)})}else(g!==1||_!==1)&&x.push(i(x)+"scale("+g+","+_+")")}return function(d,h){var g=[],_=[];return d=t(d),h=t(h),s(d.translateX,d.translateY,h.translateX,h.translateY,g,_),o(d.rotate,h.rotate,g,_),l(d.skewX,h.skewX,g,_),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,g,_),d=h=null,function(x){for(var w=-1,S=_.length,b;++w<S;)g[(b=_[w]).i]=b.x(x);return g.join("")}}}var N8=jI(R8,"px, ","px)","deg)"),k8=jI(C8,", ",")",")"),M8=1e-12;function z3(t){return((t=Math.exp(t))+1/t)/2}function I8(t){return((t=Math.exp(t))-1/t)/2}function O8(t){return((t=Math.exp(2*t))-1)/(t+1)}const P8=function t(e,n,r){function i(s,o){var l=s[0],u=s[1],d=s[2],h=o[0],g=o[1],_=o[2],x=h-l,w=g-u,S=x*x+w*w,b,T;if(S<M8)T=Math.log(_/d)/e,b=function(P){return[l+P*x,u+P*w,d*Math.exp(e*P*T)]};else{var A=Math.sqrt(S),R=(_*_-d*d+r*S)/(2*d*n*A),E=(_*_-d*d-r*S)/(2*_*n*A),C=Math.log(Math.sqrt(R*R+1)-R),O=Math.log(Math.sqrt(E*E+1)-E);T=(O-C)/e,b=function(P){var k=P*T,I=z3(C),N=d/(n*A)*(I*O8(e*k+C)-I8(C));return[l+N*x,u+N*w,d*I/z3(e*k+C)]}}return b.duration=T*1e3*e/Math.SQRT2,b}return i.rho=function(s){var o=Math.max(.001,+s),l=o*o,u=l*l;return t(o,l,u)},i}(Math.SQRT2,2,4);var So=0,Yl=0,$l=0,LI=1e3,qf,Gl,Hf=0,Gs=0,Yd=0,Rc=typeof performance=="object"&&performance.now?performance:Date,BI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function m1(){return Gs||(BI(D8),Gs=Rc.now()+Yd)}function D8(){Gs=0}function Wf(){this._call=this._time=this._next=null}Wf.prototype=g1.prototype={constructor:Wf,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?m1():+n)+(e==null?0:+e),!this._next&&Gl!==this&&(Gl?Gl._next=this:qf=this,Gl=this),this._call=t,this._time=n,c0()},stop:function(){this._call&&(this._call=null,this._time=1/0,c0())}};function g1(t,e,n){var r=new Wf;return r.restart(t,e,n),r}function j8(){m1(),++So;for(var t=qf,e;t;)(e=Gs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--So}function $3(){Gs=(Hf=Rc.now())+Yd,So=Yl=0;try{j8()}finally{So=0,B8(),Gs=0}}function L8(){var t=Rc.now(),e=t-Hf;e>LI&&(Yd-=e,Hf=t)}function B8(){for(var t,e=qf,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:qf=n);Gl=t,c0(r)}function c0(t){if(!So){Yl&&(Yl=clearTimeout(Yl));var e=t-Gs;e>24?(t<1/0&&(Yl=setTimeout($3,t-Rc.now()-Yd)),$l&&($l=clearInterval($l))):($l||(Hf=Rc.now(),$l=setInterval(L8,LI)),So=1,BI($3))}}function V3(t,e,n){var r=new Wf;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var U8=Oc("start","end","cancel","interrupt"),F8=[],UI=0,q3=1,u0=2,Cf=3,H3=4,f0=5,Nf=6;function Gd(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;z8(t,n,{name:e,index:r,group:i,on:U8,tween:F8,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:UI})}function _1(t,e){var n=Pr(t,e);if(n.state>UI)throw new Error("too late; already scheduled");return n}function Zr(t,e){var n=Pr(t,e);if(n.state>Cf)throw new Error("too late; already running");return n}function Pr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function z8(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=g1(s,0,n.time);function s(d){n.state=q3,n.timer.restart(o,n.delay,n.time),n.delay<=d&&o(d-n.delay)}function o(d){var h,g,_,x;if(n.state!==q3)return u();for(h in r)if(x=r[h],x.name===n.name){if(x.state===Cf)return V3(o);x.state===H3?(x.state=Nf,x.timer.stop(),x.on.call("interrupt",t,t.__data__,x.index,x.group),delete r[h]):+h<e&&(x.state=Nf,x.timer.stop(),x.on.call("cancel",t,t.__data__,x.index,x.group),delete r[h])}if(V3(function(){n.state===Cf&&(n.state=H3,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=u0,n.on.call("start",t,t.__data__,n.index,n.group),n.state===u0){for(n.state=Cf,i=new Array(_=n.tween.length),h=0,g=-1;h<_;++h)(x=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++g]=x);i.length=g+1}}function l(d){for(var h=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=f0,1),g=-1,_=i.length;++g<_;)i[g].call(t,h);n.state===f0&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Nf,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function kf(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>u0&&r.state<f0,r.state=Nf,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function $8(t){return this.each(function(){kf(this,t)})}function V8(t,e){var n,r;return function(){var i=Zr(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function q8(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Zr(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}s.tween=i}}function H8(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Pr(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?V8:q8)(n,t,e))}function v1(t,e,n){var r=t._id;return t.each(function(){var i=Zr(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Pr(i,r).value[e]}}function FI(t,e){var n;return(typeof e=="number"?Ji:e instanceof Ac?U3:(n=Ac(e))?(e=n,U3):A8)(t,e)}function W8(t){return function(){this.removeAttribute(t)}}function X8(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Y8(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function G8(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function K8(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function Z8(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function Q8(t,e){var n=Xd(t),r=n==="transform"?k8:FI;return this.attrTween(t,typeof e=="function"?(n.local?Z8:K8)(n,r,v1(this,"attr."+t,e)):e==null?(n.local?X8:W8)(n):(n.local?G8:Y8)(n,r,e))}function J8(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function eF(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function tF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&eF(t,s)),n}return i._value=e,i}function nF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&J8(t,s)),n}return i._value=e,i}function rF(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Xd(t);return this.tween(n,(r.local?tF:nF)(r,e))}function iF(t,e){return function(){_1(this,t).delay=+e.apply(this,arguments)}}function sF(t,e){return e=+e,function(){_1(this,t).delay=e}}function aF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?iF:sF)(e,t)):Pr(this.node(),e).delay}function oF(t,e){return function(){Zr(this,t).duration=+e.apply(this,arguments)}}function lF(t,e){return e=+e,function(){Zr(this,t).duration=e}}function cF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?oF:lF)(e,t)):Pr(this.node(),e).duration}function uF(t,e){if(typeof e!="function")throw new Error;return function(){Zr(this,t).ease=e}}function fF(t){var e=this._id;return arguments.length?this.each(uF(e,t)):Pr(this.node(),e).ease}function dF(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Zr(this,t).ease=n}}function hF(t){if(typeof t!="function")throw new Error;return this.each(dF(this._id,t))}function pF(t){typeof t!="function"&&(t=xI(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new wi(r,this._parents,this._name,this._id)}function mF(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),l=0;l<s;++l)for(var u=e[l],d=n[l],h=u.length,g=o[l]=new Array(h),_,x=0;x<h;++x)(_=u[x]||d[x])&&(g[x]=_);for(;l<r;++l)o[l]=e[l];return new wi(o,this._parents,this._name,this._id)}function gF(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function _F(t,e,n){var r,i,s=gF(e)?_1:Zr;return function(){var o=s(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function vF(t,e){var n=this._id;return arguments.length<2?Pr(this.node(),n).on.on(t):this.each(_F(n,t,e))}function xF(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function yF(){return this.on("end.remove",xF(this._id))}function bF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=d1(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=s[o]=new Array(u),h,g,_=0;_<u;++_)(h=l[_])&&(g=t.call(h,h.__data__,_,l))&&("__data__"in h&&(g.__data__=h.__data__),d[_]=g,Gd(d[_],e,n,_,d,Pr(h,n)));return new wi(s,this._parents,e,n)}function wF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=vI(t));for(var r=this._groups,i=r.length,s=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,h,g=0;g<d;++g)if(h=u[g]){for(var _=t.call(h,h.__data__,g,u),x,w=Pr(h,n),S=0,b=_.length;S<b;++S)(x=_[S])&&Gd(x,e,n,S,_,w);s.push(_),o.push(h)}return new wi(s,o,e,n)}var SF=Pc.prototype.constructor;function TF(){return new SF(this._groups,this._parents)}function EF(t,e){var n,r,i;return function(){var s=wo(this,t),o=(this.style.removeProperty(t),wo(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function zI(t){return function(){this.style.removeProperty(t)}}function AF(t,e,n){var r,i=n+"",s;return function(){var o=wo(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function RF(t,e,n){var r,i,s;return function(){var o=wo(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),wo(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l))}}function CF(t,e){var n,r,i,s="style."+e,o="end."+s,l;return function(){var u=Zr(this,t),d=u.on,h=u.value[s]==null?l||(l=zI(e)):void 0;(d!==n||i!==h)&&(r=(n=d).copy()).on(o,i=h),u.on=r}}function NF(t,e,n){var r=(t+="")=="transform"?N8:FI;return e==null?this.styleTween(t,EF(t,r)).on("end.style."+t,zI(t)):typeof e=="function"?this.styleTween(t,RF(t,r,v1(this,"style."+t,e))).each(CF(this._id,t)):this.styleTween(t,AF(t,r,e),n).on("end.style."+t,null)}function kF(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function MF(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&kF(t,o,n)),r}return s._value=e,s}function IF(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,MF(t,e,n??""))}function OF(t){return function(){this.textContent=t}}function PF(t){return function(){var e=t(this);this.textContent=e??""}}function DF(t){return this.tween("text",typeof t=="function"?PF(v1(this,"text",t)):OF(t==null?"":t+""))}function jF(t){return function(e){this.textContent=t.call(this,e)}}function LF(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&jF(i)),e}return r._value=t,r}function BF(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,LF(t))}function UF(){for(var t=this._name,e=this._id,n=$I(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=Pr(u,e);Gd(u,t,n,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new wi(r,this._parents,t,n)}function FF(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var l={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var d=Zr(this,r),h=d.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&s()})}var zF=0;function wi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function $I(){return++zF}var gi=Pc.prototype;wi.prototype={constructor:wi,select:bF,selectAll:wF,selectChild:gi.selectChild,selectChildren:gi.selectChildren,filter:pF,merge:mF,selection:TF,transition:UF,call:gi.call,nodes:gi.nodes,node:gi.node,size:gi.size,empty:gi.empty,each:gi.each,on:vF,attr:Q8,attrTween:rF,style:NF,styleTween:IF,text:DF,textTween:BF,remove:yF,tween:H8,delay:aF,duration:cF,ease:fF,easeVarying:hF,end:FF,[Symbol.iterator]:gi[Symbol.iterator]};function $F(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var VF={time:null,delay:0,duration:250,ease:$F};function qF(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function HF(t){var e,n;t instanceof wi?(e=t._id,t=t._name):(e=$I(),(n=VF).time=m1(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&Gd(u,t,e,d,o,n||qF(u,e));return new wi(r,this._parents,t,e)}Pc.prototype.interrupt=$8;Pc.prototype.transition=HF;function WF(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return VI(this.cover(e,n),e,n,t)}function VI(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},l=t._x0,u=t._y0,d=t._x1,h=t._y1,g,_,x,w,S,b,T,A;if(!s)return t._root=o,t;for(;s.length;)if((S=e>=(g=(l+d)/2))?l=g:d=g,(b=n>=(_=(u+h)/2))?u=_:h=_,i=s,!(s=s[T=b<<1|S]))return i[T]=o,t;if(x=+t._x.call(null,s.data),w=+t._y.call(null,s.data),e===x&&n===w)return o.next=s,i?i[T]=o:t._root=o,t;do i=i?i[T]=new Array(4):t._root=new Array(4),(S=e>=(g=(l+d)/2))?l=g:d=g,(b=n>=(_=(u+h)/2))?u=_:h=_;while((T=b<<1|S)===(A=(w>=_)<<1|x>=g));return i[A]=s,i[T]=o,t}function XF(t){var e,n,r=t.length,i,s,o=new Array(r),l=new Array(r),u=1/0,d=1/0,h=-1/0,g=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,l[n]=s,i<u&&(u=i),i>h&&(h=i),s<d&&(d=s),s>g&&(g=s));if(u>h||d>g)return this;for(this.cover(u,d).cover(h,g),n=0;n<r;++n)VI(this,o[n],l[n],t[n]);return this}function YF(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,l=this._root,u,d;n>t||t>=i||r>e||e>=s;)switch(d=(e<r)<<1|t<n,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function GF(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function KF(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Rn(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function ZF(t,e,n){var r,i=this._x0,s=this._y0,o,l,u,d,h=this._x1,g=this._y1,_=[],x=this._root,w,S;for(x&&_.push(new Rn(x,i,s,h,g)),n==null?n=1/0:(i=t-n,s=e-n,h=t+n,g=e+n,n*=n);w=_.pop();)if(!(!(x=w.node)||(o=w.x0)>h||(l=w.y0)>g||(u=w.x1)<i||(d=w.y1)<s))if(x.length){var b=(o+u)/2,T=(l+d)/2;_.push(new Rn(x[3],b,T,u,d),new Rn(x[2],o,T,b,d),new Rn(x[1],b,l,u,T),new Rn(x[0],o,l,b,T)),(S=(e>=T)<<1|t>=b)&&(w=_[_.length-1],_[_.length-1]=_[_.length-1-S],_[_.length-1-S]=w)}else{var A=t-+this._x.call(null,x.data),R=e-+this._y.call(null,x.data),E=A*A+R*R;if(E<n){var C=Math.sqrt(n=E);i=t-C,s=e-C,h=t+C,g=e+C,r=x.data}}return r}function QF(t){if(isNaN(h=+this._x.call(null,t))||isNaN(g=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,g,_,x,w,S,b,T;if(!n)return this;if(n.length)for(;;){if((w=h>=(_=(o+u)/2))?o=_:u=_,(S=g>=(x=(l+d)/2))?l=x:d=x,e=n,!(n=n[b=S<<1|w]))return this;if(!n.length)break;(e[b+1&3]||e[b+2&3]||e[b+3&3])&&(r=e,T=b)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[b]=s:delete e[b],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[T]=n:this._root=n),this):(this._root=s,this)}function JF(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function ez(){return this._root}function tz(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function nz(t){var e=[],n,r=this._root,i,s,o,l,u;for(r&&e.push(new Rn(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,l=n.x1,u=n.y1)&&r.length){var d=(s+l)/2,h=(o+u)/2;(i=r[3])&&e.push(new Rn(i,d,h,l,u)),(i=r[2])&&e.push(new Rn(i,s,h,d,u)),(i=r[1])&&e.push(new Rn(i,d,o,l,h)),(i=r[0])&&e.push(new Rn(i,s,o,d,h))}return this}function rz(t){var e=[],n=[],r;for(this._root&&e.push(new Rn(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,l=r.y0,u=r.x1,d=r.y1,h=(o+u)/2,g=(l+d)/2;(s=i[0])&&e.push(new Rn(s,o,l,h,g)),(s=i[1])&&e.push(new Rn(s,h,l,u,g)),(s=i[2])&&e.push(new Rn(s,o,g,h,d)),(s=i[3])&&e.push(new Rn(s,h,g,u,d))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function iz(t){return t[0]}function sz(t){return arguments.length?(this._x=t,this):this._x}function az(t){return t[1]}function oz(t){return arguments.length?(this._y=t,this):this._y}function x1(t,e,n){var r=new y1(e??iz,n??az,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function y1(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function W3(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Nn=x1.prototype=y1.prototype;Nn.copy=function(){var t=new y1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=W3(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=W3(r));return t};Nn.add=WF;Nn.addAll=XF;Nn.cover=YF;Nn.data=GF;Nn.extent=KF;Nn.find=ZF;Nn.remove=QF;Nn.removeAll=JF;Nn.root=ez;Nn.size=tz;Nn.visit=nz;Nn.visitAfter=rz;Nn.x=sz;Nn.y=oz;function Cn(t){return function(){return t}}function as(t){return(t()-.5)*1e-6}function lz(t){return t.x+t.vx}function cz(t){return t.y+t.vy}function uz(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Cn(t==null?1:+t));function o(){for(var d,h=e.length,g,_,x,w,S,b,T=0;T<s;++T)for(g=x1(e,lz,cz).visitAfter(l),d=0;d<h;++d)_=e[d],S=n[_.index],b=S*S,x=_.x+_.vx,w=_.y+_.vy,g.visit(A);function A(R,E,C,O,P){var k=R.data,I=R.r,N=S+I;if(k){if(k.index>_.index){var B=x-k.x-k.vx,V=w-k.y-k.vy,Z=B*B+V*V;Z<N*N&&(B===0&&(B=as(r),Z+=B*B),V===0&&(V=as(r),Z+=V*V),Z=(N-(Z=Math.sqrt(Z)))/Z*i,_.vx+=(B*=Z)*(N=(I*=I)/(b+I)),_.vy+=(V*=Z)*N,k.vx-=B*(N=1-N),k.vy-=V*N)}return}return E>x+N||O<x-N||C>w+N||P<w-N}}function l(d){if(d.data)return d.r=n[d.data.index];for(var h=d.r=0;h<4;++h)d[h]&&d[h].r>d.r&&(d.r=d[h].r)}function u(){if(e){var d,h=e.length,g;for(n=new Array(h),d=0;d<h;++d)g=e[d],n[g.index]=+t(g,d,e)}}return o.initialize=function(d,h){e=d,r=h,u()},o.iterations=function(d){return arguments.length?(s=+d,o):s},o.strength=function(d){return arguments.length?(i=+d,o):i},o.radius=function(d){return arguments.length?(t=typeof d=="function"?d:Cn(+d),u(),o):t},o}function fz(t){return t.index}function X3(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function dz(t){var e=fz,n=g,r,i=Cn(30),s,o,l,u,d,h=1;t==null&&(t=[]);function g(b){return 1/Math.min(l[b.source.index],l[b.target.index])}function _(b){for(var T=0,A=t.length;T<h;++T)for(var R=0,E,C,O,P,k,I,N;R<A;++R)E=t[R],C=E.source,O=E.target,P=O.x+O.vx-C.x-C.vx||as(d),k=O.y+O.vy-C.y-C.vy||as(d),I=Math.sqrt(P*P+k*k),I=(I-s[R])/I*b*r[R],P*=I,k*=I,O.vx-=P*(N=u[R]),O.vy-=k*N,C.vx+=P*(N=1-N),C.vy+=k*N}function x(){if(o){var b,T=o.length,A=t.length,R=new Map(o.map((C,O)=>[e(C,O,o),C])),E;for(b=0,l=new Array(T);b<A;++b)E=t[b],E.index=b,typeof E.source!="object"&&(E.source=X3(R,E.source)),typeof E.target!="object"&&(E.target=X3(R,E.target)),l[E.source.index]=(l[E.source.index]||0)+1,l[E.target.index]=(l[E.target.index]||0)+1;for(b=0,u=new Array(A);b<A;++b)E=t[b],u[b]=l[E.source.index]/(l[E.source.index]+l[E.target.index]);r=new Array(A),w(),s=new Array(A),S()}}function w(){if(o)for(var b=0,T=t.length;b<T;++b)r[b]=+n(t[b],b,t)}function S(){if(o)for(var b=0,T=t.length;b<T;++b)s[b]=+i(t[b],b,t)}return _.initialize=function(b,T){o=b,d=T,x()},_.links=function(b){return arguments.length?(t=b,x(),_):t},_.id=function(b){return arguments.length?(e=b,_):e},_.iterations=function(b){return arguments.length?(h=+b,_):h},_.strength=function(b){return arguments.length?(n=typeof b=="function"?b:Cn(+b),w(),_):n},_.distance=function(b){return arguments.length?(i=typeof b=="function"?b:Cn(+b),S(),_):i},_}const hz=1664525,pz=1013904223,Y3=4294967296;function mz(){let t=1;return()=>(t=(hz*t+pz)%Y3)/Y3}function gz(t){return t.x}function _z(t){return t.y}var vz=10,xz=Math.PI*(3-Math.sqrt(5));function yz(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,l=new Map,u=g1(g),d=Oc("tick","end"),h=mz();t==null&&(t=[]);function g(){_(),d.call("tick",e),n<r&&(u.stop(),d.call("end",e))}function _(S){var b,T=t.length,A;S===void 0&&(S=1);for(var R=0;R<S;++R)for(n+=(s-n)*i,l.forEach(function(E){E(n)}),b=0;b<T;++b)A=t[b],A.fx==null?A.x+=A.vx*=o:(A.x=A.fx,A.vx=0),A.fy==null?A.y+=A.vy*=o:(A.y=A.fy,A.vy=0);return e}function x(){for(var S=0,b=t.length,T;S<b;++S){if(T=t[S],T.index=S,T.fx!=null&&(T.x=T.fx),T.fy!=null&&(T.y=T.fy),isNaN(T.x)||isNaN(T.y)){var A=vz*Math.sqrt(.5+S),R=S*xz;T.x=A*Math.cos(R),T.y=A*Math.sin(R)}(isNaN(T.vx)||isNaN(T.vy))&&(T.vx=T.vy=0)}}function w(S){return S.initialize&&S.initialize(t,h),S}return x(),e={tick:_,restart:function(){return u.restart(g),e},stop:function(){return u.stop(),e},nodes:function(S){return arguments.length?(t=S,x(),l.forEach(w),e):t},alpha:function(S){return arguments.length?(n=+S,e):n},alphaMin:function(S){return arguments.length?(r=+S,e):r},alphaDecay:function(S){return arguments.length?(i=+S,e):+i},alphaTarget:function(S){return arguments.length?(s=+S,e):s},velocityDecay:function(S){return arguments.length?(o=1-S,e):1-o},randomSource:function(S){return arguments.length?(h=S,l.forEach(w),e):h},force:function(S,b){return arguments.length>1?(b==null?l.delete(S):l.set(S,w(b)),e):l.get(S)},find:function(S,b,T){var A=0,R=t.length,E,C,O,P,k;for(T==null?T=1/0:T*=T,A=0;A<R;++A)P=t[A],E=S-P.x,C=b-P.y,O=E*E+C*C,O<T&&(k=P,T=O);return k},on:function(S,b){return arguments.length>1?(d.on(S,b),e):d.on(S)}}}function bz(){var t,e,n,r,i=Cn(-30),s,o=1,l=1/0,u=.81;function d(x){var w,S=t.length,b=x1(t,gz,_z).visitAfter(g);for(r=x,w=0;w<S;++w)e=t[w],b.visit(_)}function h(){if(t){var x,w=t.length,S;for(s=new Array(w),x=0;x<w;++x)S=t[x],s[S.index]=+i(S,x,t)}}function g(x){var w=0,S,b,T=0,A,R,E;if(x.length){for(A=R=E=0;E<4;++E)(S=x[E])&&(b=Math.abs(S.value))&&(w+=S.value,T+=b,A+=b*S.x,R+=b*S.y);x.x=A/T,x.y=R/T}else{S=x,S.x=S.data.x,S.y=S.data.y;do w+=s[S.data.index];while(S=S.next)}x.value=w}function _(x,w,S,b){if(!x.value)return!0;var T=x.x-e.x,A=x.y-e.y,R=b-w,E=T*T+A*A;if(R*R/u<E)return E<l&&(T===0&&(T=as(n),E+=T*T),A===0&&(A=as(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)),e.vx+=T*x.value*r/E,e.vy+=A*x.value*r/E),!0;if(x.length||E>=l)return;(x.data!==e||x.next)&&(T===0&&(T=as(n),E+=T*T),A===0&&(A=as(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)));do x.data!==e&&(R=s[x.data.index]*r/E,e.vx+=T*R,e.vy+=A*R);while(x=x.next)}return d.initialize=function(x,w){t=x,n=w,h()},d.strength=function(x){return arguments.length?(i=typeof x=="function"?x:Cn(+x),h(),d):i},d.distanceMin=function(x){return arguments.length?(o=x*x,d):Math.sqrt(o)},d.distanceMax=function(x){return arguments.length?(l=x*x,d):Math.sqrt(l)},d.theta=function(x){return arguments.length?(u=x*x,d):Math.sqrt(u)},d}function wz(t){var e=Cn(.1),n,r,i;typeof t!="function"&&(t=Cn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vx+=(i[u]-h.x)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Cn(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Cn(+l),o(),s):t},s}function Sz(t){var e=Cn(.1),n,r,i;typeof t!="function"&&(t=Cn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vy+=(i[u]-h.y)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Cn(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Cn(+l),o(),s):t},s}const uf=t=>()=>t;function Tz(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function bi(t,e,n){this.k=t,this.x=e,this.y=n}bi.prototype={constructor:bi,scale:function(t){return t===1?this:new bi(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new bi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Kd=new bi(1,0,0);bi.prototype;function Gm(t){t.stopImmediatePropagation()}function Vl(t){t.preventDefault(),t.stopImmediatePropagation()}function Ez(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Az(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function G3(){return this.__zoom||Kd}function Rz(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Cz(){return navigator.maxTouchPoints||"ontouchstart"in this}function Nz(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function kz(){var t=Ez,e=Az,n=Nz,r=Rz,i=Cz,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=P8,d=Oc("start","zoom","end"),h,g,_,x=500,w=150,S=0,b=10;function T(j){j.property("__zoom",G3).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",N).filter(i).on("touchstart.zoom",B).on("touchmove.zoom",V).on("touchend.zoom touchcancel.zoom",Z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(j,Y,$,Q){var oe=j.selection?j.selection():j;oe.property("__zoom",G3),j!==oe?C(j,Y,$,Q):oe.interrupt().each(function(){O(this,arguments).event(Q).start().zoom(null,typeof Y=="function"?Y.apply(this,arguments):Y).end()})},T.scaleBy=function(j,Y,$,Q){T.scaleTo(j,function(){var oe=this.__zoom.k,K=typeof Y=="function"?Y.apply(this,arguments):Y;return oe*K},$,Q)},T.scaleTo=function(j,Y,$,Q){T.transform(j,function(){var oe=e.apply(this,arguments),K=this.__zoom,L=$==null?E(oe):typeof $=="function"?$.apply(this,arguments):$,W=K.invert(L),fe=typeof Y=="function"?Y.apply(this,arguments):Y;return n(R(A(K,fe),L,W),oe,o)},$,Q)},T.translateBy=function(j,Y,$,Q){T.transform(j,function(){return n(this.__zoom.translate(typeof Y=="function"?Y.apply(this,arguments):Y,typeof $=="function"?$.apply(this,arguments):$),e.apply(this,arguments),o)},null,Q)},T.translateTo=function(j,Y,$,Q,oe){T.transform(j,function(){var K=e.apply(this,arguments),L=this.__zoom,W=Q==null?E(K):typeof Q=="function"?Q.apply(this,arguments):Q;return n(Kd.translate(W[0],W[1]).scale(L.k).translate(typeof Y=="function"?-Y.apply(this,arguments):-Y,typeof $=="function"?-$.apply(this,arguments):-$),K,o)},Q,oe)};function A(j,Y){return Y=Math.max(s[0],Math.min(s[1],Y)),Y===j.k?j:new bi(Y,j.x,j.y)}function R(j,Y,$){var Q=Y[0]-$[0]*j.k,oe=Y[1]-$[1]*j.k;return Q===j.x&&oe===j.y?j:new bi(j.k,Q,oe)}function E(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function C(j,Y,$,Q){j.on("start.zoom",function(){O(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(Q).end()}).tween("zoom",function(){var oe=this,K=arguments,L=O(oe,K).event(Q),W=e.apply(oe,K),fe=$==null?E(W):typeof $=="function"?$.apply(oe,K):$,se=Math.max(W[1][0]-W[0][0],W[1][1]-W[0][1]),z=oe.__zoom,X=typeof Y=="function"?Y.apply(oe,K):Y,J=u(z.invert(fe).concat(se/z.k),X.invert(fe).concat(se/X.k));return function(pe){if(pe===1)pe=X;else{var xe=J(pe),Ae=se/xe[2];pe=new bi(Ae,fe[0]-xe[0]*Ae,fe[1]-xe[1]*Ae)}L.zoom(null,pe)}})}function O(j,Y,$){return!$&&j.__zooming||new P(j,Y)}function P(j,Y){this.that=j,this.args=Y,this.active=0,this.sourceEvent=null,this.extent=e.apply(j,Y),this.taps=0}P.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,Y){return this.mouse&&j!=="mouse"&&(this.mouse[1]=Y.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=Y.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=Y.invert(this.touch1[0])),this.that.__zoom=Y,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var Y=fr(this.that).datum();d.call(j,this.that,new Tz(j,{sourceEvent:this.sourceEvent,target:T,transform:this.that.__zoom,dispatch:d}),Y)}};function k(j,...Y){if(!t.apply(this,arguments))return;var $=O(this,Y).event(j),Q=this.__zoom,oe=Math.max(s[0],Math.min(s[1],Q.k*Math.pow(2,r.apply(this,arguments)))),K=_i(j);if($.wheel)($.mouse[0][0]!==K[0]||$.mouse[0][1]!==K[1])&&($.mouse[1]=Q.invert($.mouse[0]=K)),clearTimeout($.wheel);else{if(Q.k===oe)return;$.mouse=[K,Q.invert(K)],kf(this),$.start()}Vl(j),$.wheel=setTimeout(L,w),$.zoom("mouse",n(R(A(Q,oe),$.mouse[0],$.mouse[1]),$.extent,o));function L(){$.wheel=null,$.end()}}function I(j,...Y){if(_||!t.apply(this,arguments))return;var $=j.currentTarget,Q=O(this,Y,!0).event(j),oe=fr(j.view).on("mousemove.zoom",fe,!0).on("mouseup.zoom",se,!0),K=_i(j,$),L=j.clientX,W=j.clientY;NI(j.view),Gm(j),Q.mouse=[K,this.__zoom.invert(K)],kf(this),Q.start();function fe(z){if(Vl(z),!Q.moved){var X=z.clientX-L,J=z.clientY-W;Q.moved=X*X+J*J>S}Q.event(z).zoom("mouse",n(R(Q.that.__zoom,Q.mouse[0]=_i(z,$),Q.mouse[1]),Q.extent,o))}function se(z){oe.on("mousemove.zoom mouseup.zoom",null),kI(z.view,Q.moved),Vl(z),Q.event(z).end()}}function N(j,...Y){if(t.apply(this,arguments)){var $=this.__zoom,Q=_i(j.changedTouches?j.changedTouches[0]:j,this),oe=$.invert(Q),K=$.k*(j.shiftKey?.5:2),L=n(R(A($,K),Q,oe),e.apply(this,Y),o);Vl(j),l>0?fr(this).transition().duration(l).call(C,L,Q,j):fr(this).call(T.transform,L,Q,j)}}function B(j,...Y){if(t.apply(this,arguments)){var $=j.touches,Q=$.length,oe=O(this,Y,j.changedTouches.length===Q).event(j),K,L,W,fe;for(Gm(j),L=0;L<Q;++L)W=$[L],fe=_i(W,this),fe=[fe,this.__zoom.invert(fe),W.identifier],oe.touch0?!oe.touch1&&oe.touch0[2]!==fe[2]&&(oe.touch1=fe,oe.taps=0):(oe.touch0=fe,K=!0,oe.taps=1+!!h);h&&(h=clearTimeout(h)),K&&(oe.taps<2&&(g=fe[0],h=setTimeout(function(){h=null},x)),kf(this),oe.start())}}function V(j,...Y){if(this.__zooming){var $=O(this,Y).event(j),Q=j.changedTouches,oe=Q.length,K,L,W,fe;for(Vl(j),K=0;K<oe;++K)L=Q[K],W=_i(L,this),$.touch0&&$.touch0[2]===L.identifier?$.touch0[0]=W:$.touch1&&$.touch1[2]===L.identifier&&($.touch1[0]=W);if(L=$.that.__zoom,$.touch1){var se=$.touch0[0],z=$.touch0[1],X=$.touch1[0],J=$.touch1[1],pe=(pe=X[0]-se[0])*pe+(pe=X[1]-se[1])*pe,xe=(xe=J[0]-z[0])*xe+(xe=J[1]-z[1])*xe;L=A(L,Math.sqrt(pe/xe)),W=[(se[0]+X[0])/2,(se[1]+X[1])/2],fe=[(z[0]+J[0])/2,(z[1]+J[1])/2]}else if($.touch0)W=$.touch0[0],fe=$.touch0[1];else return;$.zoom("touch",n(R(L,W,fe),$.extent,o))}}function Z(j,...Y){if(this.__zooming){var $=O(this,Y).event(j),Q=j.changedTouches,oe=Q.length,K,L;for(Gm(j),_&&clearTimeout(_),_=setTimeout(function(){_=null},x),K=0;K<oe;++K)L=Q[K],$.touch0&&$.touch0[2]===L.identifier?delete $.touch0:$.touch1&&$.touch1[2]===L.identifier&&delete $.touch1;if($.touch1&&!$.touch0&&($.touch0=$.touch1,delete $.touch1),$.touch0)$.touch0[1]=this.__zoom.invert($.touch0[0]);else if($.end(),$.taps===2&&(L=_i(L,this),Math.hypot(g[0]-L[0],g[1]-L[1])<b)){var W=fr(this).on("dblclick.zoom");W&&W.apply(this,arguments)}}}return T.wheelDelta=function(j){return arguments.length?(r=typeof j=="function"?j:uf(+j),T):r},T.filter=function(j){return arguments.length?(t=typeof j=="function"?j:uf(!!j),T):t},T.touchable=function(j){return arguments.length?(i=typeof j=="function"?j:uf(!!j),T):i},T.extent=function(j){return arguments.length?(e=typeof j=="function"?j:uf([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),T):e},T.scaleExtent=function(j){return arguments.length?(s[0]=+j[0],s[1]=+j[1],T):[s[0],s[1]]},T.translateExtent=function(j){return arguments.length?(o[0][0]=+j[0][0],o[1][0]=+j[1][0],o[0][1]=+j[0][1],o[1][1]=+j[1][1],T):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},T.constrain=function(j){return arguments.length?(n=j,T):n},T.duration=function(j){return arguments.length?(l=+j,T):l},T.interpolate=function(j){return arguments.length?(u=j,T):u},T.on=function(){var j=d.on.apply(d,arguments);return j===d?T:j},T.clickDistance=function(j){return arguments.length?(S=(j=+j)*j,T):Math.sqrt(S)},T.tapDistance=function(j){return arguments.length?(b=+j,T):b},T}function b1(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Km,K3;function Mz(){if(K3)return Km;K3=1;function t(){this.__data__=[],this.size=0}return Km=t,Km}var Zm,Z3;function jo(){if(Z3)return Zm;Z3=1;function t(e,n){return e===n||e!==e&&n!==n}return Zm=t,Zm}var Qm,Q3;function Zd(){if(Q3)return Qm;Q3=1;var t=jo();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return Qm=e,Qm}var Jm,J3;function Iz(){if(J3)return Jm;J3=1;var t=Zd(),e=Array.prototype,n=e.splice;function r(i){var s=this.__data__,o=t(s,i);if(o<0)return!1;var l=s.length-1;return o==l?s.pop():n.call(s,o,1),--this.size,!0}return Jm=r,Jm}var eg,eE;function Oz(){if(eE)return eg;eE=1;var t=Zd();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return eg=e,eg}var tg,tE;function Pz(){if(tE)return tg;tE=1;var t=Zd();function e(n){return t(this.__data__,n)>-1}return tg=e,tg}var ng,nE;function Dz(){if(nE)return ng;nE=1;var t=Zd();function e(n,r){var i=this.__data__,s=t(i,n);return s<0?(++this.size,i.push([n,r])):i[s][1]=r,this}return ng=e,ng}var rg,rE;function Qd(){if(rE)return rg;rE=1;var t=Mz(),e=Iz(),n=Oz(),r=Pz(),i=Dz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,rg=s,rg}var ig,iE;function jz(){if(iE)return ig;iE=1;var t=Qd();function e(){this.__data__=new t,this.size=0}return ig=e,ig}var sg,sE;function Lz(){if(sE)return sg;sE=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return sg=t,sg}var ag,aE;function Bz(){if(aE)return ag;aE=1;function t(e){return this.__data__.get(e)}return ag=t,ag}var og,oE;function Uz(){if(oE)return og;oE=1;function t(e){return this.__data__.has(e)}return og=t,og}var lg,lE;function qI(){if(lE)return lg;lE=1;var t=typeof rf=="object"&&rf&&rf.Object===Object&&rf;return lg=t,lg}var cg,cE;function Dr(){if(cE)return cg;cE=1;var t=qI(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return cg=n,cg}var ug,uE;function Lo(){if(uE)return ug;uE=1;var t=Dr(),e=t.Symbol;return ug=e,ug}var fg,fE;function Fz(){if(fE)return fg;fE=1;var t=Lo(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function s(o){var l=n.call(o,i),u=o[i];try{o[i]=void 0;var d=!0}catch{}var h=r.call(o);return d&&(l?o[i]=u:delete o[i]),h}return fg=s,fg}var dg,dE;function zz(){if(dE)return dg;dE=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return dg=n,dg}var hg,hE;function oa(){if(hE)return hg;hE=1;var t=Lo(),e=Fz(),n=zz(),r="[object Null]",i="[object Undefined]",s=t?t.toStringTag:void 0;function o(l){return l==null?l===void 0?i:r:s&&s in Object(l)?e(l):n(l)}return hg=o,hg}var pg,pE;function vr(){if(pE)return pg;pE=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return pg=t,pg}var mg,mE;function jc(){if(mE)return mg;mE=1;var t=oa(),e=vr(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function o(l){if(!e(l))return!1;var u=t(l);return u==r||u==i||u==n||u==s}return mg=o,mg}var gg,gE;function $z(){if(gE)return gg;gE=1;var t=Dr(),e=t["__core-js_shared__"];return gg=e,gg}var _g,_E;function Vz(){if(_E)return _g;_E=1;var t=$z(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return _g=n,_g}var vg,vE;function HI(){if(vE)return vg;vE=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return vg=n,vg}var xg,xE;function qz(){if(xE)return xg;xE=1;var t=jc(),e=Vz(),n=vr(),r=HI(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,u=o.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function g(_){if(!n(_)||e(_))return!1;var x=t(_)?h:s;return x.test(r(_))}return xg=g,xg}var yg,yE;function Hz(){if(yE)return yg;yE=1;function t(e,n){return e==null?void 0:e[n]}return yg=t,yg}var bg,bE;function la(){if(bE)return bg;bE=1;var t=qz(),e=Hz();function n(r,i){var s=e(r,i);return t(s)?s:void 0}return bg=n,bg}var wg,wE;function w1(){if(wE)return wg;wE=1;var t=la(),e=Dr(),n=t(e,"Map");return wg=n,wg}var Sg,SE;function Jd(){if(SE)return Sg;SE=1;var t=la(),e=t(Object,"create");return Sg=e,Sg}var Tg,TE;function Wz(){if(TE)return Tg;TE=1;var t=Jd();function e(){this.__data__=t?t(null):{},this.size=0}return Tg=e,Tg}var Eg,EE;function Xz(){if(EE)return Eg;EE=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return Eg=t,Eg}var Ag,AE;function Yz(){if(AE)return Ag;AE=1;var t=Jd(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(s){var o=this.__data__;if(t){var l=o[s];return l===e?void 0:l}return r.call(o,s)?o[s]:void 0}return Ag=i,Ag}var Rg,RE;function Gz(){if(RE)return Rg;RE=1;var t=Jd(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var s=this.__data__;return t?s[i]!==void 0:n.call(s,i)}return Rg=r,Rg}var Cg,CE;function Kz(){if(CE)return Cg;CE=1;var t=Jd(),e="__lodash_hash_undefined__";function n(r,i){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=t&&i===void 0?e:i,this}return Cg=n,Cg}var Ng,NE;function Zz(){if(NE)return Ng;NE=1;var t=Wz(),e=Xz(),n=Yz(),r=Gz(),i=Kz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,Ng=s,Ng}var kg,kE;function Qz(){if(kE)return kg;kE=1;var t=Zz(),e=Qd(),n=w1();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return kg=r,kg}var Mg,ME;function Jz(){if(ME)return Mg;ME=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return Mg=t,Mg}var Ig,IE;function eh(){if(IE)return Ig;IE=1;var t=Jz();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return Ig=e,Ig}var Og,OE;function e7(){if(OE)return Og;OE=1;var t=eh();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return Og=e,Og}var Pg,PE;function t7(){if(PE)return Pg;PE=1;var t=eh();function e(n){return t(this,n).get(n)}return Pg=e,Pg}var Dg,DE;function n7(){if(DE)return Dg;DE=1;var t=eh();function e(n){return t(this,n).has(n)}return Dg=e,Dg}var jg,jE;function r7(){if(jE)return jg;jE=1;var t=eh();function e(n,r){var i=t(this,n),s=i.size;return i.set(n,r),this.size+=i.size==s?0:1,this}return jg=e,jg}var Lg,LE;function S1(){if(LE)return Lg;LE=1;var t=Qz(),e=e7(),n=t7(),r=n7(),i=r7();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,Lg=s,Lg}var Bg,BE;function i7(){if(BE)return Bg;BE=1;var t=Qd(),e=w1(),n=S1(),r=200;function i(s,o){var l=this.__data__;if(l instanceof t){var u=l.__data__;if(!e||u.length<r-1)return u.push([s,o]),this.size=++l.size,this;l=this.__data__=new n(u)}return l.set(s,o),this.size=l.size,this}return Bg=i,Bg}var Ug,UE;function th(){if(UE)return Ug;UE=1;var t=Qd(),e=jz(),n=Lz(),r=Bz(),i=Uz(),s=i7();function o(l){var u=this.__data__=new t(l);this.size=u.size}return o.prototype.clear=e,o.prototype.delete=n,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,Ug=o,Ug}var Fg,FE;function T1(){if(FE)return Fg;FE=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return Fg=t,Fg}var zg,zE;function WI(){if(zE)return zg;zE=1;var t=la(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return zg=e,zg}var $g,$E;function nh(){if($E)return $g;$E=1;var t=WI();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return $g=e,$g}var Vg,VE;function rh(){if(VE)return Vg;VE=1;var t=nh(),e=jo(),n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l){var u=s[o];(!(r.call(s,o)&&e(u,l))||l===void 0&&!(o in s))&&t(s,o,l)}return Vg=i,Vg}var qg,qE;function Lc(){if(qE)return qg;qE=1;var t=rh(),e=nh();function n(r,i,s,o){var l=!s;s||(s={});for(var u=-1,d=i.length;++u<d;){var h=i[u],g=o?o(s[h],r[h],h,s,r):void 0;g===void 0&&(g=r[h]),l?e(s,h,g):t(s,h,g)}return s}return qg=n,qg}var Hg,HE;function s7(){if(HE)return Hg;HE=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return Hg=t,Hg}var Wg,WE;function Qr(){if(WE)return Wg;WE=1;function t(e){return e!=null&&typeof e=="object"}return Wg=t,Wg}var Xg,XE;function a7(){if(XE)return Xg;XE=1;var t=oa(),e=Qr(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return Xg=r,Xg}var Yg,YE;function Bc(){if(YE)return Yg;YE=1;var t=a7(),e=Qr(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,s=t(function(){return arguments}())?t:function(o){return e(o)&&r.call(o,"callee")&&!i.call(o,"callee")};return Yg=s,Yg}var Gg,GE;function Gt(){if(GE)return Gg;GE=1;var t=Array.isArray;return Gg=t,Gg}var Kl={exports:{}},Kg,KE;function o7(){if(KE)return Kg;KE=1;function t(){return!1}return Kg=t,Kg}Kl.exports;var ZE;function Bo(){return ZE||(ZE=1,function(t,e){var n=Dr(),r=o7(),i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,o=s&&s.exports===i,l=o?n.Buffer:void 0,u=l?l.isBuffer:void 0,d=u||r;t.exports=d}(Kl,Kl.exports)),Kl.exports}var Zg,QE;function ih(){if(QE)return Zg;QE=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var s=typeof r;return i=i??t,!!i&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return Zg=n,Zg}var Qg,JE;function E1(){if(JE)return Qg;JE=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Qg=e,Qg}var Jg,eA;function l7(){if(eA)return Jg;eA=1;var t=oa(),e=E1(),n=Qr(),r="[object Arguments]",i="[object Array]",s="[object Boolean]",o="[object Date]",l="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",g="[object Object]",_="[object RegExp]",x="[object Set]",w="[object String]",S="[object WeakMap]",b="[object ArrayBuffer]",T="[object DataView]",A="[object Float32Array]",R="[object Float64Array]",E="[object Int8Array]",C="[object Int16Array]",O="[object Int32Array]",P="[object Uint8Array]",k="[object Uint8ClampedArray]",I="[object Uint16Array]",N="[object Uint32Array]",B={};B[A]=B[R]=B[E]=B[C]=B[O]=B[P]=B[k]=B[I]=B[N]=!0,B[r]=B[i]=B[b]=B[s]=B[T]=B[o]=B[l]=B[u]=B[d]=B[h]=B[g]=B[_]=B[x]=B[w]=B[S]=!1;function V(Z){return n(Z)&&e(Z.length)&&!!B[t(Z)]}return Jg=V,Jg}var e_,tA;function sh(){if(tA)return e_;tA=1;function t(e){return function(n){return e(n)}}return e_=t,e_}var Zl={exports:{}};Zl.exports;var nA;function A1(){return nA||(nA=1,function(t,e){var n=qI(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s&&n.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();t.exports=l}(Zl,Zl.exports)),Zl.exports}var t_,rA;function Uc(){if(rA)return t_;rA=1;var t=l7(),e=sh(),n=A1(),r=n&&n.isTypedArray,i=r?e(r):t;return t_=i,t_}var n_,iA;function XI(){if(iA)return n_;iA=1;var t=s7(),e=Bc(),n=Gt(),r=Bo(),i=ih(),s=Uc(),o=Object.prototype,l=o.hasOwnProperty;function u(d,h){var g=n(d),_=!g&&e(d),x=!g&&!_&&r(d),w=!g&&!_&&!x&&s(d),S=g||_||x||w,b=S?t(d.length,String):[],T=b.length;for(var A in d)(h||l.call(d,A))&&!(S&&(A=="length"||x&&(A=="offset"||A=="parent")||w&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||i(A,T)))&&b.push(A);return b}return n_=u,n_}var r_,sA;function ah(){if(sA)return r_;sA=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return r_=e,r_}var i_,aA;function YI(){if(aA)return i_;aA=1;function t(e,n){return function(r){return e(n(r))}}return i_=t,i_}var s_,oA;function c7(){if(oA)return s_;oA=1;var t=YI(),e=t(Object.keys,Object);return s_=e,s_}var a_,lA;function R1(){if(lA)return a_;lA=1;var t=ah(),e=c7(),n=Object.prototype,r=n.hasOwnProperty;function i(s){if(!t(s))return e(s);var o=[];for(var l in Object(s))r.call(s,l)&&l!="constructor"&&o.push(l);return o}return a_=i,a_}var o_,cA;function Ti(){if(cA)return o_;cA=1;var t=jc(),e=E1();function n(r){return r!=null&&e(r.length)&&!t(r)}return o_=n,o_}var l_,uA;function ps(){if(uA)return l_;uA=1;var t=XI(),e=R1(),n=Ti();function r(i){return n(i)?t(i):e(i)}return l_=r,l_}var c_,fA;function u7(){if(fA)return c_;fA=1;var t=Lc(),e=ps();function n(r,i){return r&&t(i,e(i),r)}return c_=n,c_}var u_,dA;function f7(){if(dA)return u_;dA=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return u_=t,u_}var f_,hA;function d7(){if(hA)return f_;hA=1;var t=vr(),e=ah(),n=f7(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!t(o))return n(o);var l=e(o),u=[];for(var d in o)d=="constructor"&&(l||!i.call(o,d))||u.push(d);return u}return f_=s,f_}var d_,pA;function ca(){if(pA)return d_;pA=1;var t=XI(),e=d7(),n=Ti();function r(i){return n(i)?t(i,!0):e(i)}return d_=r,d_}var h_,mA;function h7(){if(mA)return h_;mA=1;var t=Lc(),e=ca();function n(r,i){return r&&t(i,e(i),r)}return h_=n,h_}var Ql={exports:{}};Ql.exports;var gA;function GI(){return gA||(gA=1,function(t,e){var n=Dr(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s?n.Buffer:void 0,l=o?o.allocUnsafe:void 0;function u(d,h){if(h)return d.slice();var g=d.length,_=l?l(g):new d.constructor(g);return d.copy(_),_}t.exports=u}(Ql,Ql.exports)),Ql.exports}var p_,_A;function KI(){if(_A)return p_;_A=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return p_=t,p_}var m_,vA;function ZI(){if(vA)return m_;vA=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=0,o=[];++r<i;){var l=e[r];n(l,r,e)&&(o[s++]=l)}return o}return m_=t,m_}var g_,xA;function QI(){if(xA)return g_;xA=1;function t(){return[]}return g_=t,g_}var __,yA;function C1(){if(yA)return __;yA=1;var t=ZI(),e=QI(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(o){return o==null?[]:(o=Object(o),t(i(o),function(l){return r.call(o,l)}))}:e;return __=s,__}var v_,bA;function p7(){if(bA)return v_;bA=1;var t=Lc(),e=C1();function n(r,i){return t(r,e(r),i)}return v_=n,v_}var x_,wA;function N1(){if(wA)return x_;wA=1;function t(e,n){for(var r=-1,i=n.length,s=e.length;++r<i;)e[s+r]=n[r];return e}return x_=t,x_}var y_,SA;function oh(){if(SA)return y_;SA=1;var t=YI(),e=t(Object.getPrototypeOf,Object);return y_=e,y_}var b_,TA;function JI(){if(TA)return b_;TA=1;var t=N1(),e=oh(),n=C1(),r=QI(),i=Object.getOwnPropertySymbols,s=i?function(o){for(var l=[];o;)t(l,n(o)),o=e(o);return l}:r;return b_=s,b_}var w_,EA;function m7(){if(EA)return w_;EA=1;var t=Lc(),e=JI();function n(r,i){return t(r,e(r),i)}return w_=n,w_}var S_,AA;function eO(){if(AA)return S_;AA=1;var t=N1(),e=Gt();function n(r,i,s){var o=i(r);return e(r)?o:t(o,s(r))}return S_=n,S_}var T_,RA;function tO(){if(RA)return T_;RA=1;var t=eO(),e=C1(),n=ps();function r(i){return t(i,n,e)}return T_=r,T_}var E_,CA;function g7(){if(CA)return E_;CA=1;var t=eO(),e=JI(),n=ca();function r(i){return t(i,n,e)}return E_=r,E_}var A_,NA;function _7(){if(NA)return A_;NA=1;var t=la(),e=Dr(),n=t(e,"DataView");return A_=n,A_}var R_,kA;function v7(){if(kA)return R_;kA=1;var t=la(),e=Dr(),n=t(e,"Promise");return R_=n,R_}var C_,MA;function nO(){if(MA)return C_;MA=1;var t=la(),e=Dr(),n=t(e,"Set");return C_=n,C_}var N_,IA;function x7(){if(IA)return N_;IA=1;var t=la(),e=Dr(),n=t(e,"WeakMap");return N_=n,N_}var k_,OA;function Uo(){if(OA)return k_;OA=1;var t=_7(),e=w1(),n=v7(),r=nO(),i=x7(),s=oa(),o=HI(),l="[object Map]",u="[object Object]",d="[object Promise]",h="[object Set]",g="[object WeakMap]",_="[object DataView]",x=o(t),w=o(e),S=o(n),b=o(r),T=o(i),A=s;return(t&&A(new t(new ArrayBuffer(1)))!=_||e&&A(new e)!=l||n&&A(n.resolve())!=d||r&&A(new r)!=h||i&&A(new i)!=g)&&(A=function(R){var E=s(R),C=E==u?R.constructor:void 0,O=C?o(C):"";if(O)switch(O){case x:return _;case w:return l;case S:return d;case b:return h;case T:return g}return E}),k_=A,k_}var M_,PA;function y7(){if(PA)return M_;PA=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}return M_=n,M_}var I_,DA;function rO(){if(DA)return I_;DA=1;var t=Dr(),e=t.Uint8Array;return I_=e,I_}var O_,jA;function k1(){if(jA)return O_;jA=1;var t=rO();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return O_=e,O_}var P_,LA;function b7(){if(LA)return P_;LA=1;var t=k1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return P_=e,P_}var D_,BA;function w7(){if(BA)return D_;BA=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return D_=e,D_}var j_,UA;function S7(){if(UA)return j_;UA=1;var t=Lo(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return j_=r,j_}var L_,FA;function iO(){if(FA)return L_;FA=1;var t=k1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return L_=e,L_}var B_,zA;function T7(){if(zA)return B_;zA=1;var t=k1(),e=b7(),n=w7(),r=S7(),i=iO(),s="[object Boolean]",o="[object Date]",l="[object Map]",u="[object Number]",d="[object RegExp]",h="[object Set]",g="[object String]",_="[object Symbol]",x="[object ArrayBuffer]",w="[object DataView]",S="[object Float32Array]",b="[object Float64Array]",T="[object Int8Array]",A="[object Int16Array]",R="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",O="[object Uint16Array]",P="[object Uint32Array]";function k(I,N,B){var V=I.constructor;switch(N){case x:return t(I);case s:case o:return new V(+I);case w:return e(I,B);case S:case b:case T:case A:case R:case E:case C:case O:case P:return i(I,B);case l:return new V;case u:case g:return new V(I);case d:return n(I);case h:return new V;case _:return r(I)}}return B_=k,B_}var U_,$A;function sO(){if($A)return U_;$A=1;var t=vr(),e=Object.create,n=function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var s=new r;return r.prototype=void 0,s}}();return U_=n,U_}var F_,VA;function aO(){if(VA)return F_;VA=1;var t=sO(),e=oh(),n=ah();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return F_=r,F_}var z_,qA;function E7(){if(qA)return z_;qA=1;var t=Uo(),e=Qr(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return z_=r,z_}var $_,HA;function A7(){if(HA)return $_;HA=1;var t=E7(),e=sh(),n=A1(),r=n&&n.isMap,i=r?e(r):t;return $_=i,$_}var V_,WA;function R7(){if(WA)return V_;WA=1;var t=Uo(),e=Qr(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return V_=r,V_}var q_,XA;function C7(){if(XA)return q_;XA=1;var t=R7(),e=sh(),n=A1(),r=n&&n.isSet,i=r?e(r):t;return q_=i,q_}var H_,YA;function oO(){if(YA)return H_;YA=1;var t=th(),e=T1(),n=rh(),r=u7(),i=h7(),s=GI(),o=KI(),l=p7(),u=m7(),d=tO(),h=g7(),g=Uo(),_=y7(),x=T7(),w=aO(),S=Gt(),b=Bo(),T=A7(),A=vr(),R=C7(),E=ps(),C=ca(),O=1,P=2,k=4,I="[object Arguments]",N="[object Array]",B="[object Boolean]",V="[object Date]",Z="[object Error]",j="[object Function]",Y="[object GeneratorFunction]",$="[object Map]",Q="[object Number]",oe="[object Object]",K="[object RegExp]",L="[object Set]",W="[object String]",fe="[object Symbol]",se="[object WeakMap]",z="[object ArrayBuffer]",X="[object DataView]",J="[object Float32Array]",pe="[object Float64Array]",xe="[object Int8Array]",Ae="[object Int16Array]",Ne="[object Int32Array]",be="[object Uint8Array]",we="[object Uint8ClampedArray]",ke="[object Uint16Array]",Xe="[object Uint32Array]",Le={};Le[I]=Le[N]=Le[z]=Le[X]=Le[B]=Le[V]=Le[J]=Le[pe]=Le[xe]=Le[Ae]=Le[Ne]=Le[$]=Le[Q]=Le[oe]=Le[K]=Le[L]=Le[W]=Le[fe]=Le[be]=Le[we]=Le[ke]=Le[Xe]=!0,Le[Z]=Le[j]=Le[se]=!1;function Kt(Ie,nn,ot,pt,Mt,rn){var Ge,Se=nn&O,Me=nn&P,nt=nn&k;if(ot&&(Ge=Mt?ot(Ie,pt,Mt,rn):ot(Ie)),Ge!==void 0)return Ge;if(!A(Ie))return Ie;var qe=S(Ie);if(qe){if(Ge=_(Ie),!Se)return o(Ie,Ge)}else{var Ze=g(Ie),yt=Ze==j||Ze==Y;if(b(Ie))return s(Ie,Se);if(Ze==oe||Ze==I||yt&&!Mt){if(Ge=Me||yt?{}:w(Ie),!Se)return Me?u(Ie,i(Ge,Ie)):l(Ie,r(Ge,Ie))}else{if(!Le[Ze])return Mt?Ie:{};Ge=x(Ie,Ze,Se)}}rn||(rn=new t);var mn=rn.get(Ie);if(mn)return mn;rn.set(Ie,Ge),R(Ie)?Ie.forEach(function(Ft){Ge.add(Kt(Ft,nn,ot,Ft,Ie,rn))}):T(Ie)&&Ie.forEach(function(Ft,zt){Ge.set(zt,Kt(Ft,nn,ot,zt,Ie,rn))});var ei=nt?Me?h:d:Me?C:E,br=qe?void 0:ei(Ie);return e(br||Ie,function(Ft,zt){br&&(zt=Ft,Ft=Ie[zt]),n(Ge,zt,Kt(Ft,nn,ot,zt,Ie,rn))}),Ge}return H_=Kt,H_}var W_,GA;function N7(){if(GA)return W_;GA=1;var t=oO(),e=4;function n(r){return t(r,e)}return W_=n,W_}var X_,KA;function M1(){if(KA)return X_;KA=1;function t(e){return function(){return e}}return X_=t,X_}var Y_,ZA;function k7(){if(ZA)return Y_;ZA=1;function t(e){return function(n,r,i){for(var s=-1,o=Object(n),l=i(n),u=l.length;u--;){var d=l[e?u:++s];if(r(o[d],d,o)===!1)break}return n}}return Y_=t,Y_}var G_,QA;function I1(){if(QA)return G_;QA=1;var t=k7(),e=t();return G_=e,G_}var K_,JA;function O1(){if(JA)return K_;JA=1;var t=I1(),e=ps();function n(r,i){return r&&t(r,i,e)}return K_=n,K_}var Z_,eR;function M7(){if(eR)return Z_;eR=1;var t=Ti();function e(n,r){return function(i,s){if(i==null)return i;if(!t(i))return n(i,s);for(var o=i.length,l=r?o:-1,u=Object(i);(r?l--:++l<o)&&s(u[l],l,u)!==!1;);return i}}return Z_=e,Z_}var Q_,tR;function lh(){if(tR)return Q_;tR=1;var t=O1(),e=M7(),n=e(t);return Q_=n,Q_}var J_,nR;function ua(){if(nR)return J_;nR=1;function t(e){return e}return J_=t,J_}var ev,rR;function lO(){if(rR)return ev;rR=1;var t=ua();function e(n){return typeof n=="function"?n:t}return ev=e,ev}var tv,iR;function cO(){if(iR)return tv;iR=1;var t=T1(),e=lh(),n=lO(),r=Gt();function i(s,o){var l=r(s)?t:e;return l(s,n(o))}return tv=i,tv}var nv,sR;function uO(){return sR||(sR=1,nv=cO()),nv}var rv,aR;function I7(){if(aR)return rv;aR=1;var t=lh();function e(n,r){var i=[];return t(n,function(s,o,l){r(s,o,l)&&i.push(s)}),i}return rv=e,rv}var iv,oR;function O7(){if(oR)return iv;oR=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return iv=e,iv}var sv,lR;function P7(){if(lR)return sv;lR=1;function t(e){return this.__data__.has(e)}return sv=t,sv}var av,cR;function fO(){if(cR)return av;cR=1;var t=S1(),e=O7(),n=P7();function r(i){var s=-1,o=i==null?0:i.length;for(this.__data__=new t;++s<o;)this.add(i[s])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,av=r,av}var ov,uR;function D7(){if(uR)return ov;uR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return ov=t,ov}var lv,fR;function dO(){if(fR)return lv;fR=1;function t(e,n){return e.has(n)}return lv=t,lv}var cv,dR;function hO(){if(dR)return cv;dR=1;var t=fO(),e=D7(),n=dO(),r=1,i=2;function s(o,l,u,d,h,g){var _=u&r,x=o.length,w=l.length;if(x!=w&&!(_&&w>x))return!1;var S=g.get(o),b=g.get(l);if(S&&b)return S==l&&b==o;var T=-1,A=!0,R=u&i?new t:void 0;for(g.set(o,l),g.set(l,o);++T<x;){var E=o[T],C=l[T];if(d)var O=_?d(C,E,T,l,o,g):d(E,C,T,o,l,g);if(O!==void 0){if(O)continue;A=!1;break}if(R){if(!e(l,function(P,k){if(!n(R,k)&&(E===P||h(E,P,u,d,g)))return R.push(k)})){A=!1;break}}else if(!(E===C||h(E,C,u,d,g))){A=!1;break}}return g.delete(o),g.delete(l),A}return cv=s,cv}var uv,hR;function j7(){if(hR)return uv;hR=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,s){r[++n]=[s,i]}),r}return uv=t,uv}var fv,pR;function P1(){if(pR)return fv;pR=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return fv=t,fv}var dv,mR;function L7(){if(mR)return dv;mR=1;var t=Lo(),e=rO(),n=jo(),r=hO(),i=j7(),s=P1(),o=1,l=2,u="[object Boolean]",d="[object Date]",h="[object Error]",g="[object Map]",_="[object Number]",x="[object RegExp]",w="[object Set]",S="[object String]",b="[object Symbol]",T="[object ArrayBuffer]",A="[object DataView]",R=t?t.prototype:void 0,E=R?R.valueOf:void 0;function C(O,P,k,I,N,B,V){switch(k){case A:if(O.byteLength!=P.byteLength||O.byteOffset!=P.byteOffset)return!1;O=O.buffer,P=P.buffer;case T:return!(O.byteLength!=P.byteLength||!B(new e(O),new e(P)));case u:case d:case _:return n(+O,+P);case h:return O.name==P.name&&O.message==P.message;case x:case S:return O==P+"";case g:var Z=i;case w:var j=I&o;if(Z||(Z=s),O.size!=P.size&&!j)return!1;var Y=V.get(O);if(Y)return Y==P;I|=l,V.set(O,P);var $=r(Z(O),Z(P),I,N,B,V);return V.delete(O),$;case b:if(E)return E.call(O)==E.call(P)}return!1}return dv=C,dv}var hv,gR;function B7(){if(gR)return hv;gR=1;var t=tO(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l,u,d,h){var g=l&e,_=t(s),x=_.length,w=t(o),S=w.length;if(x!=S&&!g)return!1;for(var b=x;b--;){var T=_[b];if(!(g?T in o:r.call(o,T)))return!1}var A=h.get(s),R=h.get(o);if(A&&R)return A==o&&R==s;var E=!0;h.set(s,o),h.set(o,s);for(var C=g;++b<x;){T=_[b];var O=s[T],P=o[T];if(u)var k=g?u(P,O,T,o,s,h):u(O,P,T,s,o,h);if(!(k===void 0?O===P||d(O,P,l,u,h):k)){E=!1;break}C||(C=T=="constructor")}if(E&&!C){var I=s.constructor,N=o.constructor;I!=N&&"constructor"in s&&"constructor"in o&&!(typeof I=="function"&&I instanceof I&&typeof N=="function"&&N instanceof N)&&(E=!1)}return h.delete(s),h.delete(o),E}return hv=i,hv}var pv,_R;function U7(){if(_R)return pv;_R=1;var t=th(),e=hO(),n=L7(),r=B7(),i=Uo(),s=Gt(),o=Bo(),l=Uc(),u=1,d="[object Arguments]",h="[object Array]",g="[object Object]",_=Object.prototype,x=_.hasOwnProperty;function w(S,b,T,A,R,E){var C=s(S),O=s(b),P=C?h:i(S),k=O?h:i(b);P=P==d?g:P,k=k==d?g:k;var I=P==g,N=k==g,B=P==k;if(B&&o(S)){if(!o(b))return!1;C=!0,I=!1}if(B&&!I)return E||(E=new t),C||l(S)?e(S,b,T,A,R,E):n(S,b,P,T,A,R,E);if(!(T&u)){var V=I&&x.call(S,"__wrapped__"),Z=N&&x.call(b,"__wrapped__");if(V||Z){var j=V?S.value():S,Y=Z?b.value():b;return E||(E=new t),R(j,Y,T,A,E)}}return B?(E||(E=new t),r(S,b,T,A,R,E)):!1}return pv=w,pv}var mv,vR;function pO(){if(vR)return mv;vR=1;var t=U7(),e=Qr();function n(r,i,s,o,l){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,s,o,n,l)}return mv=n,mv}var gv,xR;function F7(){if(xR)return gv;xR=1;var t=th(),e=pO(),n=1,r=2;function i(s,o,l,u){var d=l.length,h=d,g=!u;if(s==null)return!h;for(s=Object(s);d--;){var _=l[d];if(g&&_[2]?_[1]!==s[_[0]]:!(_[0]in s))return!1}for(;++d<h;){_=l[d];var x=_[0],w=s[x],S=_[1];if(g&&_[2]){if(w===void 0&&!(x in s))return!1}else{var b=new t;if(u)var T=u(w,S,x,s,o,b);if(!(T===void 0?e(S,w,n|r,u,b):T))return!1}}return!0}return gv=i,gv}var _v,yR;function mO(){if(yR)return _v;yR=1;var t=vr();function e(n){return n===n&&!t(n)}return _v=e,_v}var vv,bR;function z7(){if(bR)return vv;bR=1;var t=mO(),e=ps();function n(r){for(var i=e(r),s=i.length;s--;){var o=i[s],l=r[o];i[s]=[o,l,t(l)]}return i}return vv=n,vv}var xv,wR;function gO(){if(wR)return xv;wR=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return xv=t,xv}var yv,SR;function $7(){if(SR)return yv;SR=1;var t=F7(),e=z7(),n=gO();function r(i){var s=e(i);return s.length==1&&s[0][2]?n(s[0][0],s[0][1]):function(o){return o===i||t(o,i,s)}}return yv=r,yv}var bv,TR;function Fo(){if(TR)return bv;TR=1;var t=oa(),e=Qr(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return bv=r,bv}var wv,ER;function D1(){if(ER)return wv;ER=1;var t=Gt(),e=Fo(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){if(t(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||e(s)?!0:r.test(s)||!n.test(s)||o!=null&&s in Object(o)}return wv=i,wv}var Sv,AR;function V7(){if(AR)return Sv;AR=1;var t=S1(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var s=function(){var o=arguments,l=i?i.apply(this,o):o[0],u=s.cache;if(u.has(l))return u.get(l);var d=r.apply(this,o);return s.cache=u.set(l,d)||u,d};return s.cache=new(n.Cache||t),s}return n.Cache=t,Sv=n,Sv}var Tv,RR;function q7(){if(RR)return Tv;RR=1;var t=V7(),e=500;function n(r){var i=t(r,function(o){return s.size===e&&s.clear(),o}),s=i.cache;return i}return Tv=n,Tv}var Ev,CR;function H7(){if(CR)return Ev;CR=1;var t=q7(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(e,function(o,l,u,d){s.push(u?d.replace(n,"$1"):l||o)}),s});return Ev=r,Ev}var Av,NR;function ch(){if(NR)return Av;NR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=Array(i);++r<i;)s[r]=n(e[r],r,e);return s}return Av=t,Av}var Rv,kR;function W7(){if(kR)return Rv;kR=1;var t=Lo(),e=ch(),n=Gt(),r=Fo(),i=t?t.prototype:void 0,s=i?i.toString:void 0;function o(l){if(typeof l=="string")return l;if(n(l))return e(l,o)+"";if(r(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}return Rv=o,Rv}var Cv,MR;function _O(){if(MR)return Cv;MR=1;var t=W7();function e(n){return n==null?"":t(n)}return Cv=e,Cv}var Nv,IR;function uh(){if(IR)return Nv;IR=1;var t=Gt(),e=D1(),n=H7(),r=_O();function i(s,o){return t(s)?s:e(s,o)?[s]:n(r(s))}return Nv=i,Nv}var kv,OR;function Fc(){if(OR)return kv;OR=1;var t=Fo();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return kv=e,kv}var Mv,PR;function fh(){if(PR)return Mv;PR=1;var t=uh(),e=Fc();function n(r,i){i=t(i,r);for(var s=0,o=i.length;r!=null&&s<o;)r=r[e(i[s++])];return s&&s==o?r:void 0}return Mv=n,Mv}var Iv,DR;function X7(){if(DR)return Iv;DR=1;var t=fh();function e(n,r,i){var s=n==null?void 0:t(n,r);return s===void 0?i:s}return Iv=e,Iv}var Ov,jR;function Y7(){if(jR)return Ov;jR=1;function t(e,n){return e!=null&&n in Object(e)}return Ov=t,Ov}var Pv,LR;function vO(){if(LR)return Pv;LR=1;var t=uh(),e=Bc(),n=Gt(),r=ih(),i=E1(),s=Fc();function o(l,u,d){u=t(u,l);for(var h=-1,g=u.length,_=!1;++h<g;){var x=s(u[h]);if(!(_=l!=null&&d(l,x)))break;l=l[x]}return _||++h!=g?_:(g=l==null?0:l.length,!!g&&i(g)&&r(x,g)&&(n(l)||e(l)))}return Pv=o,Pv}var Dv,BR;function xO(){if(BR)return Dv;BR=1;var t=Y7(),e=vO();function n(r,i){return r!=null&&e(r,i,t)}return Dv=n,Dv}var jv,UR;function G7(){if(UR)return jv;UR=1;var t=pO(),e=X7(),n=xO(),r=D1(),i=mO(),s=gO(),o=Fc(),l=1,u=2;function d(h,g){return r(h)&&i(g)?s(o(h),g):function(_){var x=e(_,h);return x===void 0&&x===g?n(_,h):t(g,x,l|u)}}return jv=d,jv}var Lv,FR;function yO(){if(FR)return Lv;FR=1;function t(e){return function(n){return n==null?void 0:n[e]}}return Lv=t,Lv}var Bv,zR;function K7(){if(zR)return Bv;zR=1;var t=fh();function e(n){return function(r){return t(r,n)}}return Bv=e,Bv}var Uv,$R;function Z7(){if($R)return Uv;$R=1;var t=yO(),e=K7(),n=D1(),r=Fc();function i(s){return n(s)?t(r(s)):e(s)}return Uv=i,Uv}var Fv,VR;function Ei(){if(VR)return Fv;VR=1;var t=$7(),e=G7(),n=ua(),r=Gt(),i=Z7();function s(o){return typeof o=="function"?o:o==null?n:typeof o=="object"?r(o)?e(o[0],o[1]):t(o):i(o)}return Fv=s,Fv}var zv,qR;function bO(){if(qR)return zv;qR=1;var t=ZI(),e=I7(),n=Ei(),r=Gt();function i(s,o){var l=r(s)?t:e;return l(s,n(o,3))}return zv=i,zv}var $v,HR;function Q7(){if(HR)return $v;HR=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,i){return r!=null&&e.call(r,i)}return $v=n,$v}var Vv,WR;function wO(){if(WR)return Vv;WR=1;var t=Q7(),e=vO();function n(r,i){return r!=null&&e(r,i,t)}return Vv=n,Vv}var qv,XR;function J7(){if(XR)return qv;XR=1;var t=R1(),e=Uo(),n=Bc(),r=Gt(),i=Ti(),s=Bo(),o=ah(),l=Uc(),u="[object Map]",d="[object Set]",h=Object.prototype,g=h.hasOwnProperty;function _(x){if(x==null)return!0;if(i(x)&&(r(x)||typeof x=="string"||typeof x.splice=="function"||s(x)||l(x)||n(x)))return!x.length;var w=e(x);if(w==u||w==d)return!x.size;if(o(x))return!t(x).length;for(var S in x)if(g.call(x,S))return!1;return!0}return qv=_,qv}var Hv,YR;function SO(){if(YR)return Hv;YR=1;function t(e){return e===void 0}return Hv=t,Hv}var Wv,GR;function TO(){if(GR)return Wv;GR=1;var t=lh(),e=Ti();function n(r,i){var s=-1,o=e(r)?Array(r.length):[];return t(r,function(l,u,d){o[++s]=i(l,u,d)}),o}return Wv=n,Wv}var Xv,KR;function EO(){if(KR)return Xv;KR=1;var t=ch(),e=Ei(),n=TO(),r=Gt();function i(s,o){var l=r(s)?t:n;return l(s,e(o,3))}return Xv=i,Xv}var Yv,ZR;function e9(){if(ZR)return Yv;ZR=1;function t(e,n,r,i){var s=-1,o=e==null?0:e.length;for(i&&o&&(r=e[++s]);++s<o;)r=n(r,e[s],s,e);return r}return Yv=t,Yv}var Gv,QR;function t9(){if(QR)return Gv;QR=1;function t(e,n,r,i,s){return s(e,function(o,l,u){r=i?(i=!1,o):n(r,o,l,u)}),r}return Gv=t,Gv}var Kv,JR;function AO(){if(JR)return Kv;JR=1;var t=e9(),e=lh(),n=Ei(),r=t9(),i=Gt();function s(o,l,u){var d=i(o)?t:r,h=arguments.length<3;return d(o,n(l,4),u,h,e)}return Kv=s,Kv}var Zv,eC;function n9(){if(eC)return Zv;eC=1;var t=oa(),e=Gt(),n=Qr(),r="[object String]";function i(s){return typeof s=="string"||!e(s)&&n(s)&&t(s)==r}return Zv=i,Zv}var Qv,tC;function r9(){if(tC)return Qv;tC=1;var t=yO(),e=t("length");return Qv=e,Qv}var Jv,nC;function i9(){if(nC)return Jv;nC=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="\\u200d",l=RegExp("["+o+t+i+s+"]");function u(d){return l.test(d)}return Jv=u,Jv}var ex,rC;function s9(){if(rC)return ex;rC=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="["+t+"]",l="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+u+")",h="[^"+t+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",x="\\u200d",w=d+"?",S="["+s+"]?",b="(?:"+x+"(?:"+[h,g,_].join("|")+")"+S+w+")*",T=S+w+b,A="(?:"+[h+l+"?",l,g,_,o].join("|")+")",R=RegExp(u+"(?="+u+")|"+A+T,"g");function E(C){for(var O=R.lastIndex=0;R.test(C);)++O;return O}return ex=E,ex}var tx,iC;function a9(){if(iC)return tx;iC=1;var t=r9(),e=i9(),n=s9();function r(i){return e(i)?n(i):t(i)}return tx=r,tx}var nx,sC;function o9(){if(sC)return nx;sC=1;var t=R1(),e=Uo(),n=Ti(),r=n9(),i=a9(),s="[object Map]",o="[object Set]";function l(u){if(u==null)return 0;if(n(u))return r(u)?i(u):u.length;var d=e(u);return d==s||d==o?u.size:t(u).length}return nx=l,nx}var rx,aC;function l9(){if(aC)return rx;aC=1;var t=T1(),e=sO(),n=O1(),r=Ei(),i=oh(),s=Gt(),o=Bo(),l=jc(),u=vr(),d=Uc();function h(g,_,x){var w=s(g),S=w||o(g)||d(g);if(_=r(_,4),x==null){var b=g&&g.constructor;S?x=w?new b:[]:u(g)?x=l(b)?e(i(g)):{}:x={}}return(S?t:n)(g,function(T,A,R){return _(x,T,A,R)}),x}return rx=h,rx}var ix,oC;function c9(){if(oC)return ix;oC=1;var t=Lo(),e=Bc(),n=Gt(),r=t?t.isConcatSpreadable:void 0;function i(s){return n(s)||e(s)||!!(r&&s&&s[r])}return ix=i,ix}var sx,lC;function j1(){if(lC)return sx;lC=1;var t=N1(),e=c9();function n(r,i,s,o,l){var u=-1,d=r.length;for(s||(s=e),l||(l=[]);++u<d;){var h=r[u];i>0&&s(h)?i>1?n(h,i-1,s,o,l):t(l,h):o||(l[l.length]=h)}return l}return sx=n,sx}var ax,cC;function u9(){if(cC)return ax;cC=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return ax=t,ax}var ox,uC;function RO(){if(uC)return ox;uC=1;var t=u9(),e=Math.max;function n(r,i,s){return i=e(i===void 0?r.length-1:i,0),function(){for(var o=arguments,l=-1,u=e(o.length-i,0),d=Array(u);++l<u;)d[l]=o[i+l];l=-1;for(var h=Array(i+1);++l<i;)h[l]=o[l];return h[i]=s(d),t(r,this,h)}}return ox=n,ox}var lx,fC;function f9(){if(fC)return lx;fC=1;var t=M1(),e=WI(),n=ua(),r=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(s),writable:!0})}:n;return lx=r,lx}var cx,dC;function d9(){if(dC)return cx;dC=1;var t=800,e=16,n=Date.now;function r(i){var s=0,o=0;return function(){var l=n(),u=e-(l-o);if(o=l,u>0){if(++s>=t)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return cx=r,cx}var ux,hC;function CO(){if(hC)return ux;hC=1;var t=f9(),e=d9(),n=e(t);return ux=n,ux}var fx,pC;function dh(){if(pC)return fx;pC=1;var t=ua(),e=RO(),n=CO();function r(i,s){return n(e(i,s,t),i+"")}return fx=r,fx}var dx,mC;function NO(){if(mC)return dx;mC=1;function t(e,n,r,i){for(var s=e.length,o=r+(i?1:-1);i?o--:++o<s;)if(n(e[o],o,e))return o;return-1}return dx=t,dx}var hx,gC;function h9(){if(gC)return hx;gC=1;function t(e){return e!==e}return hx=t,hx}var px,_C;function p9(){if(_C)return px;_C=1;function t(e,n,r){for(var i=r-1,s=e.length;++i<s;)if(e[i]===n)return i;return-1}return px=t,px}var mx,vC;function m9(){if(vC)return mx;vC=1;var t=NO(),e=h9(),n=p9();function r(i,s,o){return s===s?n(i,s,o):t(i,e,o)}return mx=r,mx}var gx,xC;function g9(){if(xC)return gx;xC=1;var t=m9();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return gx=e,gx}var _x,yC;function _9(){if(yC)return _x;yC=1;function t(e,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(n,e[i]))return!0;return!1}return _x=t,_x}var vx,bC;function v9(){if(bC)return vx;bC=1;function t(){}return vx=t,vx}var xx,wC;function x9(){if(wC)return xx;wC=1;var t=nO(),e=v9(),n=P1(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(s){return new t(s)}:e;return xx=i,xx}var yx,SC;function y9(){if(SC)return yx;SC=1;var t=fO(),e=g9(),n=_9(),r=dO(),i=x9(),s=P1(),o=200;function l(u,d,h){var g=-1,_=e,x=u.length,w=!0,S=[],b=S;if(h)w=!1,_=n;else if(x>=o){var T=d?null:i(u);if(T)return s(T);w=!1,_=r,b=new t}else b=d?[]:S;e:for(;++g<x;){var A=u[g],R=d?d(A):A;if(A=h||A!==0?A:0,w&&R===R){for(var E=b.length;E--;)if(b[E]===R)continue e;d&&b.push(R),S.push(A)}else _(b,R,h)||(b!==S&&b.push(R),S.push(A))}return S}return yx=l,yx}var bx,TC;function kO(){if(TC)return bx;TC=1;var t=Ti(),e=Qr();function n(r){return e(r)&&t(r)}return bx=n,bx}var wx,EC;function b9(){if(EC)return wx;EC=1;var t=j1(),e=dh(),n=y9(),r=kO(),i=e(function(s){return n(t(s,1,r,!0))});return wx=i,wx}var Sx,AC;function w9(){if(AC)return Sx;AC=1;var t=ch();function e(n,r){return t(r,function(i){return n[i]})}return Sx=e,Sx}var Tx,RC;function MO(){if(RC)return Tx;RC=1;var t=w9(),e=ps();function n(r){return r==null?[]:t(r,e(r))}return Tx=n,Tx}var Ex,CC;function xr(){if(CC)return Ex;CC=1;var t;if(typeof b1=="function")try{t={clone:N7(),constant:M1(),each:uO(),filter:bO(),has:wO(),isArray:Gt(),isEmpty:J7(),isFunction:jc(),isUndefined:SO(),keys:ps(),map:EO(),reduce:AO(),size:o9(),transform:l9(),union:b9(),values:MO()}}catch{}return t||(t=window._),Ex=t,Ex}var Ax,NC;function L1(){if(NC)return Ax;NC=1;var t=xr();Ax=i;var e="\0",n="\0",r="";function i(h){this._isDirected=t.has(h,"directed")?h.directed:!0,this._isMultigraph=t.has(h,"multigraph")?h.multigraph:!1,this._isCompound=t.has(h,"compound")?h.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(h){return this._label=h,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultNodeLabelFn=h,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._in[g])})},i.prototype.sinks=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._out[g])})},i.prototype.setNodes=function(h,g){var _=arguments,x=this;return t.each(h,function(w){_.length>1?x.setNode(w,g):x.setNode(w)}),this},i.prototype.setNode=function(h,g){return t.has(this._nodes,h)?(arguments.length>1&&(this._nodes[h]=g),this):(this._nodes[h]=arguments.length>1?g:this._defaultNodeLabelFn(h),this._isCompound&&(this._parent[h]=n,this._children[h]={},this._children[n][h]=!0),this._in[h]={},this._preds[h]={},this._out[h]={},this._sucs[h]={},++this._nodeCount,this)},i.prototype.node=function(h){return this._nodes[h]},i.prototype.hasNode=function(h){return t.has(this._nodes,h)},i.prototype.removeNode=function(h){var g=this;if(t.has(this._nodes,h)){var _=function(x){g.removeEdge(g._edgeObjs[x])};delete this._nodes[h],this._isCompound&&(this._removeFromParentsChildList(h),delete this._parent[h],t.each(this.children(h),function(x){g.setParent(x)}),delete this._children[h]),t.each(t.keys(this._in[h]),_),delete this._in[h],delete this._preds[h],t.each(t.keys(this._out[h]),_),delete this._out[h],delete this._sucs[h],--this._nodeCount}return this},i.prototype.setParent=function(h,g){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(g))g=n;else{g+="";for(var _=g;!t.isUndefined(_);_=this.parent(_))if(_===h)throw new Error("Setting "+g+" as parent of "+h+" would create a cycle");this.setNode(g)}return this.setNode(h),this._removeFromParentsChildList(h),this._parent[h]=g,this._children[g][h]=!0,this},i.prototype._removeFromParentsChildList=function(h){delete this._children[this._parent[h]][h]},i.prototype.parent=function(h){if(this._isCompound){var g=this._parent[h];if(g!==n)return g}},i.prototype.children=function(h){if(t.isUndefined(h)&&(h=n),this._isCompound){var g=this._children[h];if(g)return t.keys(g)}else{if(h===n)return this.nodes();if(this.hasNode(h))return[]}},i.prototype.predecessors=function(h){var g=this._preds[h];if(g)return t.keys(g)},i.prototype.successors=function(h){var g=this._sucs[h];if(g)return t.keys(g)},i.prototype.neighbors=function(h){var g=this.predecessors(h);if(g)return t.union(g,this.successors(h))},i.prototype.isLeaf=function(h){var g;return this.isDirected()?g=this.successors(h):g=this.neighbors(h),g.length===0},i.prototype.filterNodes=function(h){var g=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});g.setGraph(this.graph());var _=this;t.each(this._nodes,function(S,b){h(b)&&g.setNode(b,S)}),t.each(this._edgeObjs,function(S){g.hasNode(S.v)&&g.hasNode(S.w)&&g.setEdge(S,_.edge(S))});var x={};function w(S){var b=_.parent(S);return b===void 0||g.hasNode(b)?(x[S]=b,b):b in x?x[b]:w(b)}return this._isCompound&&t.each(g.nodes(),function(S){g.setParent(S,w(S))}),g},i.prototype.setDefaultEdgeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultEdgeLabelFn=h,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(h,g){var _=this,x=arguments;return t.reduce(h,function(w,S){return x.length>1?_.setEdge(w,S,g):_.setEdge(w,S),S}),this},i.prototype.setEdge=function(){var h,g,_,x,w=!1,S=arguments[0];typeof S=="object"&&S!==null&&"v"in S?(h=S.v,g=S.w,_=S.name,arguments.length===2&&(x=arguments[1],w=!0)):(h=S,g=arguments[1],_=arguments[3],arguments.length>2&&(x=arguments[2],w=!0)),h=""+h,g=""+g,t.isUndefined(_)||(_=""+_);var b=l(this._isDirected,h,g,_);if(t.has(this._edgeLabels,b))return w&&(this._edgeLabels[b]=x),this;if(!t.isUndefined(_)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(h),this.setNode(g),this._edgeLabels[b]=w?x:this._defaultEdgeLabelFn(h,g,_);var T=u(this._isDirected,h,g,_);return h=T.v,g=T.w,Object.freeze(T),this._edgeObjs[b]=T,s(this._preds[g],h),s(this._sucs[h],g),this._in[g][b]=T,this._out[h][b]=T,this._edgeCount++,this},i.prototype.edge=function(h,g,_){var x=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return this._edgeLabels[x]},i.prototype.hasEdge=function(h,g,_){var x=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return t.has(this._edgeLabels,x)},i.prototype.removeEdge=function(h,g,_){var x=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_),w=this._edgeObjs[x];return w&&(h=w.v,g=w.w,delete this._edgeLabels[x],delete this._edgeObjs[x],o(this._preds[g],h),o(this._sucs[h],g),delete this._in[g][x],delete this._out[h][x],this._edgeCount--),this},i.prototype.inEdges=function(h,g){var _=this._in[h];if(_){var x=t.values(_);return g?t.filter(x,function(w){return w.v===g}):x}},i.prototype.outEdges=function(h,g){var _=this._out[h];if(_){var x=t.values(_);return g?t.filter(x,function(w){return w.w===g}):x}},i.prototype.nodeEdges=function(h,g){var _=this.inEdges(h,g);if(_)return _.concat(this.outEdges(h,g))};function s(h,g){h[g]?h[g]++:h[g]=1}function o(h,g){--h[g]||delete h[g]}function l(h,g,_,x){var w=""+g,S=""+_;if(!h&&w>S){var b=w;w=S,S=b}return w+r+S+r+(t.isUndefined(x)?e:x)}function u(h,g,_,x){var w=""+g,S=""+_;if(!h&&w>S){var b=w;w=S,S=b}var T={v:w,w:S};return x&&(T.name=x),T}function d(h,g){return l(h,g.v,g.w,g.name)}return Ax}var Rx,kC;function S9(){return kC||(kC=1,Rx="2.1.8"),Rx}var Cx,MC;function T9(){return MC||(MC=1,Cx={Graph:L1(),version:S9()}),Cx}var Nx,IC;function E9(){if(IC)return Nx;IC=1;var t=xr(),e=L1();Nx={write:n,read:s};function n(o){var l={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:i(o)};return t.isUndefined(o.graph())||(l.value=t.clone(o.graph())),l}function r(o){return t.map(o.nodes(),function(l){var u=o.node(l),d=o.parent(l),h={v:l};return t.isUndefined(u)||(h.value=u),t.isUndefined(d)||(h.parent=d),h})}function i(o){return t.map(o.edges(),function(l){var u=o.edge(l),d={v:l.v,w:l.w};return t.isUndefined(l.name)||(d.name=l.name),t.isUndefined(u)||(d.value=u),d})}function s(o){var l=new e(o.options).setGraph(o.value);return t.each(o.nodes,function(u){l.setNode(u.v,u.value),u.parent&&l.setParent(u.v,u.parent)}),t.each(o.edges,function(u){l.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),l}return Nx}var kx,OC;function A9(){if(OC)return kx;OC=1;var t=xr();kx=e;function e(n){var r={},i=[],s;function o(l){t.has(r,l)||(r[l]=!0,s.push(l),t.each(n.successors(l),o),t.each(n.predecessors(l),o))}return t.each(n.nodes(),function(l){s=[],o(l),s.length&&i.push(s)}),i}return kx}var Mx,PC;function IO(){if(PC)return Mx;PC=1;var t=xr();Mx=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var i=this._keyIndices;if(n=String(n),!t.has(i,n)){var s=this._arr,o=s.length;return i[n]=o,s.push({key:n,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var i=this._keyIndices[n];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(n){var r=this._arr,i=2*n,s=i+1,o=n;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==n&&(this._swap(n,o),this._heapify(o)))},e.prototype._decrease=function(n){for(var r=this._arr,i=r[n].priority,s;n!==0&&(s=n>>1,!(r[s].priority<i));)this._swap(n,s),n=s},e.prototype._swap=function(n,r){var i=this._arr,s=this._keyIndices,o=i[n],l=i[r];i[n]=l,i[r]=o,s[l.key]=n,s[o.key]=r},Mx}var Ix,DC;function OO(){if(DC)return Ix;DC=1;var t=xr(),e=IO();Ix=r;var n=t.constant(1);function r(s,o,l,u){return i(s,String(o),l||n,u||function(d){return s.outEdges(d)})}function i(s,o,l,u){var d={},h=new e,g,_,x=function(w){var S=w.v!==g?w.v:w.w,b=d[S],T=l(w),A=_.distance+T;if(T<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+w+" Weight: "+T);A<b.distance&&(b.distance=A,b.predecessor=g,h.decrease(S,A))};for(s.nodes().forEach(function(w){var S=w===o?0:Number.POSITIVE_INFINITY;d[w]={distance:S},h.add(w,S)});h.size()>0&&(g=h.removeMin(),_=d[g],_.distance!==Number.POSITIVE_INFINITY);)u(g).forEach(x);return d}return Ix}var Ox,jC;function R9(){if(jC)return Ox;jC=1;var t=OO(),e=xr();Ox=n;function n(r,i,s){return e.transform(r.nodes(),function(o,l){o[l]=t(r,l,i,s)},{})}return Ox}var Px,LC;function PO(){if(LC)return Px;LC=1;var t=xr();Px=e;function e(n){var r=0,i=[],s={},o=[];function l(u){var d=s[u]={onStack:!0,lowlink:r,index:r++};if(i.push(u),n.successors(u).forEach(function(_){t.has(s,_)?s[_].onStack&&(d.lowlink=Math.min(d.lowlink,s[_].index)):(l(_),d.lowlink=Math.min(d.lowlink,s[_].lowlink))}),d.lowlink===d.index){var h=[],g;do g=i.pop(),s[g].onStack=!1,h.push(g);while(u!==g);o.push(h)}}return n.nodes().forEach(function(u){t.has(s,u)||l(u)}),o}return Px}var Dx,BC;function C9(){if(BC)return Dx;BC=1;var t=xr(),e=PO();Dx=n;function n(r){return t.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return Dx}var jx,UC;function N9(){if(UC)return jx;UC=1;var t=xr();jx=n;var e=t.constant(1);function n(i,s,o){return r(i,s||e,o||function(l){return i.outEdges(l)})}function r(i,s,o){var l={},u=i.nodes();return u.forEach(function(d){l[d]={},l[d][d]={distance:0},u.forEach(function(h){d!==h&&(l[d][h]={distance:Number.POSITIVE_INFINITY})}),o(d).forEach(function(h){var g=h.v===d?h.w:h.v,_=s(h);l[d][g]={distance:_,predecessor:d}})}),u.forEach(function(d){var h=l[d];u.forEach(function(g){var _=l[g];u.forEach(function(x){var w=_[d],S=h[x],b=_[x],T=w.distance+S.distance;T<b.distance&&(b.distance=T,b.predecessor=S.predecessor)})})}),l}return jx}var Lx,FC;function DO(){if(FC)return Lx;FC=1;var t=xr();Lx=e,e.CycleException=n;function e(r){var i={},s={},o=[];function l(u){if(t.has(s,u))throw new n;t.has(i,u)||(s[u]=!0,i[u]=!0,t.each(r.predecessors(u),l),delete s[u],o.push(u))}if(t.each(r.sinks(),l),t.size(i)!==r.nodeCount())throw new n;return o}function n(){}return n.prototype=new Error,Lx}var Bx,zC;function k9(){if(zC)return Bx;zC=1;var t=DO();Bx=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return Bx}var Ux,$C;function jO(){if($C)return Ux;$C=1;var t=xr();Ux=e;function e(r,i,s){t.isArray(i)||(i=[i]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),l=[],u={};return t.each(i,function(d){if(!r.hasNode(d))throw new Error("Graph does not have node: "+d);n(r,d,s==="post",u,o,l)}),l}function n(r,i,s,o,l,u){t.has(o,i)||(o[i]=!0,s||u.push(i),t.each(l(i),function(d){n(r,d,s,o,l,u)}),s&&u.push(i))}return Ux}var Fx,VC;function M9(){if(VC)return Fx;VC=1;var t=jO();Fx=e;function e(n,r){return t(n,r,"post")}return Fx}var zx,qC;function I9(){if(qC)return zx;qC=1;var t=jO();zx=e;function e(n,r){return t(n,r,"pre")}return zx}var $x,HC;function O9(){if(HC)return $x;HC=1;var t=xr(),e=L1(),n=IO();$x=r;function r(i,s){var o=new e,l={},u=new n,d;function h(_){var x=_.v===d?_.w:_.v,w=u.priority(x);if(w!==void 0){var S=s(_);S<w&&(l[x]=d,u.decrease(x,S))}}if(i.nodeCount()===0)return o;t.each(i.nodes(),function(_){u.add(_,Number.POSITIVE_INFINITY),o.setNode(_)}),u.decrease(i.nodes()[0],0);for(var g=!1;u.size()>0;){if(d=u.removeMin(),t.has(l,d))o.setEdge(d,l[d]);else{if(g)throw new Error("Input graph is not connected: "+i);g=!0}i.nodeEdges(d).forEach(h)}return o}return $x}var Vx,WC;function P9(){return WC||(WC=1,Vx={components:A9(),dijkstra:OO(),dijkstraAll:R9(),findCycles:C9(),floydWarshall:N9(),isAcyclic:k9(),postorder:M9(),preorder:I9(),prim:O9(),tarjan:PO(),topsort:DO()}),Vx}var qx,XC;function D9(){if(XC)return qx;XC=1;var t=T9();return qx={Graph:t.Graph,json:E9(),alg:P9(),version:t.version},qx}var Hx,YC;function Ir(){if(YC)return Hx;YC=1;var t;if(typeof b1=="function")try{t=D9()}catch{}return t||(t=window.graphlib),Hx=t,Hx}var Wx,GC;function j9(){if(GC)return Wx;GC=1;var t=oO(),e=1,n=4;function r(i){return t(i,e|n)}return Wx=r,Wx}var Xx,KC;function hh(){if(KC)return Xx;KC=1;var t=jo(),e=Ti(),n=ih(),r=vr();function i(s,o,l){if(!r(l))return!1;var u=typeof o;return(u=="number"?e(l)&&n(o,l.length):u=="string"&&o in l)?t(l[o],s):!1}return Xx=i,Xx}var Yx,ZC;function L9(){if(ZC)return Yx;ZC=1;var t=dh(),e=jo(),n=hh(),r=ca(),i=Object.prototype,s=i.hasOwnProperty,o=t(function(l,u){l=Object(l);var d=-1,h=u.length,g=h>2?u[2]:void 0;for(g&&n(u[0],u[1],g)&&(h=1);++d<h;)for(var _=u[d],x=r(_),w=-1,S=x.length;++w<S;){var b=x[w],T=l[b];(T===void 0||e(T,i[b])&&!s.call(l,b))&&(l[b]=_[b])}return l});return Yx=o,Yx}var Gx,QC;function B9(){if(QC)return Gx;QC=1;var t=Ei(),e=Ti(),n=ps();function r(i){return function(s,o,l){var u=Object(s);if(!e(s)){var d=t(o,3);s=n(s),o=function(g){return d(u[g],g,u)}}var h=i(s,o,l);return h>-1?u[d?s[h]:h]:void 0}}return Gx=r,Gx}var Kx,JC;function U9(){if(JC)return Kx;JC=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return Kx=e,Kx}var Zx,eN;function F9(){if(eN)return Zx;eN=1;var t=U9(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return Zx=n,Zx}var Qx,tN;function z9(){if(tN)return Qx;tN=1;var t=F9(),e=vr(),n=Fo(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(n(d))return r;if(e(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=e(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=t(d);var g=s.test(d);return g||o.test(d)?l(d.slice(2),g?2:8):i.test(d)?r:+d}return Qx=u,Qx}var Jx,nN;function LO(){if(nN)return Jx;nN=1;var t=z9(),e=1/0,n=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-1/0){var s=i<0?-1:1;return s*n}return i===i?i:0}return Jx=r,Jx}var ey,rN;function $9(){if(rN)return ey;rN=1;var t=LO();function e(n){var r=t(n),i=r%1;return r===r?i?r-i:r:0}return ey=e,ey}var ty,iN;function V9(){if(iN)return ty;iN=1;var t=NO(),e=Ei(),n=$9(),r=Math.max;function i(s,o,l){var u=s==null?0:s.length;if(!u)return-1;var d=l==null?0:n(l);return d<0&&(d=r(u+d,0)),t(s,e(o,3),d)}return ty=i,ty}var ny,sN;function q9(){if(sN)return ny;sN=1;var t=B9(),e=V9(),n=t(e);return ny=n,ny}var ry,aN;function BO(){if(aN)return ry;aN=1;var t=j1();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return ry=e,ry}var iy,oN;function H9(){if(oN)return iy;oN=1;var t=I1(),e=lO(),n=ca();function r(i,s){return i==null?i:t(i,e(s),n)}return iy=r,iy}var sy,lN;function W9(){if(lN)return sy;lN=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return sy=t,sy}var ay,cN;function X9(){if(cN)return ay;cN=1;var t=nh(),e=O1(),n=Ei();function r(i,s){var o={};return s=n(s,3),e(i,function(l,u,d){t(o,u,s(l,u,d))}),o}return ay=r,ay}var oy,uN;function B1(){if(uN)return oy;uN=1;var t=Fo();function e(n,r,i){for(var s=-1,o=n.length;++s<o;){var l=n[s],u=r(l);if(u!=null&&(d===void 0?u===u&&!t(u):i(u,d)))var d=u,h=l}return h}return oy=e,oy}var ly,fN;function Y9(){if(fN)return ly;fN=1;function t(e,n){return e>n}return ly=t,ly}var cy,dN;function G9(){if(dN)return cy;dN=1;var t=B1(),e=Y9(),n=ua();function r(i){return i&&i.length?t(i,n,e):void 0}return cy=r,cy}var uy,hN;function UO(){if(hN)return uy;hN=1;var t=nh(),e=jo();function n(r,i,s){(s!==void 0&&!e(r[i],s)||s===void 0&&!(i in r))&&t(r,i,s)}return uy=n,uy}var fy,pN;function K9(){if(pN)return fy;pN=1;var t=oa(),e=oh(),n=Qr(),r="[object Object]",i=Function.prototype,s=Object.prototype,o=i.toString,l=s.hasOwnProperty,u=o.call(Object);function d(h){if(!n(h)||t(h)!=r)return!1;var g=e(h);if(g===null)return!0;var _=l.call(g,"constructor")&&g.constructor;return typeof _=="function"&&_ instanceof _&&o.call(_)==u}return fy=d,fy}var dy,mN;function FO(){if(mN)return dy;mN=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return dy=t,dy}var hy,gN;function Z9(){if(gN)return hy;gN=1;var t=Lc(),e=ca();function n(r){return t(r,e(r))}return hy=n,hy}var py,_N;function Q9(){if(_N)return py;_N=1;var t=UO(),e=GI(),n=iO(),r=KI(),i=aO(),s=Bc(),o=Gt(),l=kO(),u=Bo(),d=jc(),h=vr(),g=K9(),_=Uc(),x=FO(),w=Z9();function S(b,T,A,R,E,C,O){var P=x(b,A),k=x(T,A),I=O.get(k);if(I){t(b,A,I);return}var N=C?C(P,k,A+"",b,T,O):void 0,B=N===void 0;if(B){var V=o(k),Z=!V&&u(k),j=!V&&!Z&&_(k);N=k,V||Z||j?o(P)?N=P:l(P)?N=r(P):Z?(B=!1,N=e(k,!0)):j?(B=!1,N=n(k,!0)):N=[]:g(k)||s(k)?(N=P,s(P)?N=w(P):(!h(P)||d(P))&&(N=i(k))):B=!1}B&&(O.set(k,N),E(N,k,R,C,O),O.delete(k)),t(b,A,N)}return py=S,py}var my,vN;function J9(){if(vN)return my;vN=1;var t=th(),e=UO(),n=I1(),r=Q9(),i=vr(),s=ca(),o=FO();function l(u,d,h,g,_){u!==d&&n(d,function(x,w){if(_||(_=new t),i(x))r(u,d,w,h,l,g,_);else{var S=g?g(o(u,w),x,w+"",u,d,_):void 0;S===void 0&&(S=x),e(u,w,S)}},s)}return my=l,my}var gy,xN;function e$(){if(xN)return gy;xN=1;var t=dh(),e=hh();function n(r){return t(function(i,s){var o=-1,l=s.length,u=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(s[0],s[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++o<l;){var h=s[o];h&&r(i,h,o,u)}return i})}return gy=n,gy}var _y,yN;function t$(){if(yN)return _y;yN=1;var t=J9(),e=e$(),n=e(function(r,i,s){t(r,i,s)});return _y=n,_y}var vy,bN;function zO(){if(bN)return vy;bN=1;function t(e,n){return e<n}return vy=t,vy}var xy,wN;function n$(){if(wN)return xy;wN=1;var t=B1(),e=zO(),n=ua();function r(i){return i&&i.length?t(i,n,e):void 0}return xy=r,xy}var yy,SN;function r$(){if(SN)return yy;SN=1;var t=B1(),e=Ei(),n=zO();function r(i,s){return i&&i.length?t(i,e(s,2),n):void 0}return yy=r,yy}var by,TN;function i$(){if(TN)return by;TN=1;var t=Dr(),e=function(){return t.Date.now()};return by=e,by}var wy,EN;function s$(){if(EN)return wy;EN=1;var t=rh(),e=uh(),n=ih(),r=vr(),i=Fc();function s(o,l,u,d){if(!r(o))return o;l=e(l,o);for(var h=-1,g=l.length,_=g-1,x=o;x!=null&&++h<g;){var w=i(l[h]),S=u;if(w==="__proto__"||w==="constructor"||w==="prototype")return o;if(h!=_){var b=x[w];S=d?d(b,w,x):void 0,S===void 0&&(S=r(b)?b:n(l[h+1])?[]:{})}t(x,w,S),x=x[w]}return o}return wy=s,wy}var Sy,AN;function a$(){if(AN)return Sy;AN=1;var t=fh(),e=s$(),n=uh();function r(i,s,o){for(var l=-1,u=s.length,d={};++l<u;){var h=s[l],g=t(i,h);o(g,h)&&e(d,n(h,i),g)}return d}return Sy=r,Sy}var Ty,RN;function o$(){if(RN)return Ty;RN=1;var t=a$(),e=xO();function n(r,i){return t(r,i,function(s,o){return e(r,o)})}return Ty=n,Ty}var Ey,CN;function l$(){if(CN)return Ey;CN=1;var t=BO(),e=RO(),n=CO();function r(i){return n(e(i,void 0,t),i+"")}return Ey=r,Ey}var Ay,NN;function c$(){if(NN)return Ay;NN=1;var t=o$(),e=l$(),n=e(function(r,i){return r==null?{}:t(r,i)});return Ay=n,Ay}var Ry,kN;function u$(){if(kN)return Ry;kN=1;var t=Math.ceil,e=Math.max;function n(r,i,s,o){for(var l=-1,u=e(t((i-r)/(s||1)),0),d=Array(u);u--;)d[o?u:++l]=r,r+=s;return d}return Ry=n,Ry}var Cy,MN;function f$(){if(MN)return Cy;MN=1;var t=u$(),e=hh(),n=LO();function r(i){return function(s,o,l){return l&&typeof l!="number"&&e(s,o,l)&&(o=l=void 0),s=n(s),o===void 0?(o=s,s=0):o=n(o),l=l===void 0?s<o?1:-1:n(l),t(s,o,l,i)}}return Cy=r,Cy}var Ny,IN;function d$(){if(IN)return Ny;IN=1;var t=f$(),e=t();return Ny=e,Ny}var ky,ON;function h$(){if(ON)return ky;ON=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return ky=t,ky}var My,PN;function p$(){if(PN)return My;PN=1;var t=Fo();function e(n,r){if(n!==r){var i=n!==void 0,s=n===null,o=n===n,l=t(n),u=r!==void 0,d=r===null,h=r===r,g=t(r);if(!d&&!g&&!l&&n>r||l&&u&&h&&!d&&!g||s&&u&&h||!i&&h||!o)return 1;if(!s&&!l&&!g&&n<r||g&&i&&o&&!s&&!l||d&&i&&o||!u&&o||!h)return-1}return 0}return My=e,My}var Iy,DN;function m$(){if(DN)return Iy;DN=1;var t=p$();function e(n,r,i){for(var s=-1,o=n.criteria,l=r.criteria,u=o.length,d=i.length;++s<u;){var h=t(o[s],l[s]);if(h){if(s>=d)return h;var g=i[s];return h*(g=="desc"?-1:1)}}return n.index-r.index}return Iy=e,Iy}var Oy,jN;function g$(){if(jN)return Oy;jN=1;var t=ch(),e=fh(),n=Ei(),r=TO(),i=h$(),s=sh(),o=m$(),l=ua(),u=Gt();function d(h,g,_){g.length?g=t(g,function(S){return u(S)?function(b){return e(b,S.length===1?S[0]:S)}:S}):g=[l];var x=-1;g=t(g,s(n));var w=r(h,function(S,b,T){var A=t(g,function(R){return R(S)});return{criteria:A,index:++x,value:S}});return i(w,function(S,b){return o(S,b,_)})}return Oy=d,Oy}var Py,LN;function _$(){if(LN)return Py;LN=1;var t=j1(),e=g$(),n=dh(),r=hh(),i=n(function(s,o){if(s==null)return[];var l=o.length;return l>1&&r(s,o[0],o[1])?o=[]:l>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(s,t(o,1),[])});return Py=i,Py}var Dy,BN;function v$(){if(BN)return Dy;BN=1;var t=_O(),e=0;function n(r){var i=++e;return t(r)+i}return Dy=n,Dy}var jy,UN;function x$(){if(UN)return jy;UN=1;function t(e,n,r){for(var i=-1,s=e.length,o=n.length,l={};++i<s;){var u=i<o?n[i]:void 0;r(l,e[i],u)}return l}return jy=t,jy}var Ly,FN;function y$(){if(FN)return Ly;FN=1;var t=rh(),e=x$();function n(r,i){return e(r||[],i||[],t)}return Ly=n,Ly}var By,zN;function At(){if(zN)return By;zN=1;var t;if(typeof b1=="function")try{t={cloneDeep:j9(),constant:M1(),defaults:L9(),each:uO(),filter:bO(),find:q9(),flatten:BO(),forEach:cO(),forIn:H9(),has:wO(),isUndefined:SO(),last:W9(),map:EO(),mapValues:X9(),max:G9(),merge:t$(),min:n$(),minBy:r$(),now:i$(),pick:c$(),range:d$(),reduce:AO(),sortBy:_$(),uniqueId:v$(),values:MO(),zipObject:y$()}}catch{}return t||(t=window._),By=t,By}var Uy,$N;function b$(){if($N)return Uy;$N=1,Uy=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},t.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},t.prototype.toString=function(){for(var r=[],i=this._sentinel,s=i._prev;s!==i;)r.push(JSON.stringify(s,n)),s=s._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,i){if(r!=="_next"&&r!=="_prev")return i}return Uy}var Fy,VN;function w$(){if(VN)return Fy;VN=1;var t=At(),e=Ir().Graph,n=b$();Fy=i;var r=t.constant(1);function i(d,h){if(d.nodeCount()<=1)return[];var g=l(d,h||r),_=s(g.graph,g.buckets,g.zeroIdx);return t.flatten(t.map(_,function(x){return d.outEdges(x.v,x.w)}),!0)}function s(d,h,g){for(var _=[],x=h[h.length-1],w=h[0],S;d.nodeCount();){for(;S=w.dequeue();)o(d,h,g,S);for(;S=x.dequeue();)o(d,h,g,S);if(d.nodeCount()){for(var b=h.length-2;b>0;--b)if(S=h[b].dequeue(),S){_=_.concat(o(d,h,g,S,!0));break}}}return _}function o(d,h,g,_,x){var w=x?[]:void 0;return t.forEach(d.inEdges(_.v),function(S){var b=d.edge(S),T=d.node(S.v);x&&w.push({v:S.v,w:S.w}),T.out-=b,u(h,g,T)}),t.forEach(d.outEdges(_.v),function(S){var b=d.edge(S),T=S.w,A=d.node(T);A.in-=b,u(h,g,A)}),d.removeNode(_.v),w}function l(d,h){var g=new e,_=0,x=0;t.forEach(d.nodes(),function(b){g.setNode(b,{v:b,in:0,out:0})}),t.forEach(d.edges(),function(b){var T=g.edge(b.v,b.w)||0,A=h(b),R=T+A;g.setEdge(b.v,b.w,R),x=Math.max(x,g.node(b.v).out+=A),_=Math.max(_,g.node(b.w).in+=A)});var w=t.range(x+_+3).map(function(){return new n}),S=_+1;return t.forEach(g.nodes(),function(b){u(w,S,g.node(b))}),{graph:g,buckets:w,zeroIdx:S}}function u(d,h,g){g.out?g.in?d[g.out-g.in+h].enqueue(g):d[d.length-1].enqueue(g):d[0].enqueue(g)}return Fy}var zy,qN;function S$(){if(qN)return zy;qN=1;var t=At(),e=w$();zy={run:n,undo:i};function n(s){var o=s.graph().acyclicer==="greedy"?e(s,l(s)):r(s);t.forEach(o,function(u){var d=s.edge(u);s.removeEdge(u),d.forwardName=u.name,d.reversed=!0,s.setEdge(u.w,u.v,d,t.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(s){var o=[],l={},u={};function d(h){t.has(u,h)||(u[h]=!0,l[h]=!0,t.forEach(s.outEdges(h),function(g){t.has(l,g.w)?o.push(g):d(g.w)}),delete l[h])}return t.forEach(s.nodes(),d),o}function i(s){t.forEach(s.edges(),function(o){var l=s.edge(o);if(l.reversed){s.removeEdge(o);var u=l.forwardName;delete l.reversed,delete l.forwardName,s.setEdge(o.w,o.v,l,u)}})}return zy}var $y,HN;function Ln(){if(HN)return $y;HN=1;var t=At(),e=Ir().Graph;$y={addDummyNode:n,simplify:r,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:o,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:h,addBorderNode:g,maxRank:_,partition:x,time:w,notime:S};function n(b,T,A,R){var E;do E=t.uniqueId(R);while(b.hasNode(E));return A.dummy=T,b.setNode(E,A),E}function r(b){var T=new e().setGraph(b.graph());return t.forEach(b.nodes(),function(A){T.setNode(A,b.node(A))}),t.forEach(b.edges(),function(A){var R=T.edge(A.v,A.w)||{weight:0,minlen:1},E=b.edge(A);T.setEdge(A.v,A.w,{weight:R.weight+E.weight,minlen:Math.max(R.minlen,E.minlen)})}),T}function i(b){var T=new e({multigraph:b.isMultigraph()}).setGraph(b.graph());return t.forEach(b.nodes(),function(A){b.children(A).length||T.setNode(A,b.node(A))}),t.forEach(b.edges(),function(A){T.setEdge(A,b.edge(A))}),T}function s(b){var T=t.map(b.nodes(),function(A){var R={};return t.forEach(b.outEdges(A),function(E){R[E.w]=(R[E.w]||0)+b.edge(E).weight}),R});return t.zipObject(b.nodes(),T)}function o(b){var T=t.map(b.nodes(),function(A){var R={};return t.forEach(b.inEdges(A),function(E){R[E.v]=(R[E.v]||0)+b.edge(E).weight}),R});return t.zipObject(b.nodes(),T)}function l(b,T){var A=b.x,R=b.y,E=T.x-A,C=T.y-R,O=b.width/2,P=b.height/2;if(!E&&!C)throw new Error("Not possible to find intersection inside of the rectangle");var k,I;return Math.abs(C)*O>Math.abs(E)*P?(C<0&&(P=-P),k=P*E/C,I=P):(E<0&&(O=-O),k=O,I=O*C/E),{x:A+k,y:R+I}}function u(b){var T=t.map(t.range(_(b)+1),function(){return[]});return t.forEach(b.nodes(),function(A){var R=b.node(A),E=R.rank;t.isUndefined(E)||(T[E][R.order]=A)}),T}function d(b){var T=t.min(t.map(b.nodes(),function(A){return b.node(A).rank}));t.forEach(b.nodes(),function(A){var R=b.node(A);t.has(R,"rank")&&(R.rank-=T)})}function h(b){var T=t.min(t.map(b.nodes(),function(C){return b.node(C).rank})),A=[];t.forEach(b.nodes(),function(C){var O=b.node(C).rank-T;A[O]||(A[O]=[]),A[O].push(C)});var R=0,E=b.graph().nodeRankFactor;t.forEach(A,function(C,O){t.isUndefined(C)&&O%E!==0?--R:R&&t.forEach(C,function(P){b.node(P).rank+=R})})}function g(b,T,A,R){var E={width:0,height:0};return arguments.length>=4&&(E.rank=A,E.order=R),n(b,"border",E,T)}function _(b){return t.max(t.map(b.nodes(),function(T){var A=b.node(T).rank;if(!t.isUndefined(A))return A}))}function x(b,T){var A={lhs:[],rhs:[]};return t.forEach(b,function(R){T(R)?A.lhs.push(R):A.rhs.push(R)}),A}function w(b,T){var A=t.now();try{return T()}finally{console.log(b+" time: "+(t.now()-A)+"ms")}}function S(b,T){return T()}return $y}var Vy,WN;function T$(){if(WN)return Vy;WN=1;var t=At(),e=Ln();Vy={run:n,undo:i};function n(s){s.graph().dummyChains=[],t.forEach(s.edges(),function(o){r(s,o)})}function r(s,o){var l=o.v,u=s.node(l).rank,d=o.w,h=s.node(d).rank,g=o.name,_=s.edge(o),x=_.labelRank;if(h!==u+1){s.removeEdge(o);var w,S,b;for(b=0,++u;u<h;++b,++u)_.points=[],S={width:0,height:0,edgeLabel:_,edgeObj:o,rank:u},w=e.addDummyNode(s,"edge",S,"_d"),u===x&&(S.width=_.width,S.height=_.height,S.dummy="edge-label",S.labelpos=_.labelpos),s.setEdge(l,w,{weight:_.weight},g),b===0&&s.graph().dummyChains.push(w),l=w;s.setEdge(l,d,{weight:_.weight},g)}}function i(s){t.forEach(s.graph().dummyChains,function(o){var l=s.node(o),u=l.edgeLabel,d;for(s.setEdge(l.edgeObj,u);l.dummy;)d=s.successors(o)[0],s.removeNode(o),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),o=d,l=s.node(o)})}return Vy}var qy,XN;function Xf(){if(XN)return qy;XN=1;var t=At();qy={longestPath:e,slack:n};function e(r){var i={};function s(o){var l=r.node(o);if(t.has(i,o))return l.rank;i[o]=!0;var u=t.min(t.map(r.outEdges(o),function(d){return s(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}t.forEach(r.sources(),s)}function n(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return qy}var Hy,YN;function $O(){if(YN)return Hy;YN=1;var t=At(),e=Ir().Graph,n=Xf().slack;Hy=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],h=l.nodeCount();u.setNode(d,{});for(var g,_;i(u,l)<h;)g=s(u,l),_=u.hasNode(g.v)?n(l,g):-n(l,g),o(u,l,_);return u}function i(l,u){function d(h){t.forEach(u.nodeEdges(h),function(g){var _=g.v,x=h===_?g.w:_;!l.hasNode(x)&&!n(u,g)&&(l.setNode(x,{}),l.setEdge(h,x,{}),d(x))})}return t.forEach(l.nodes(),d),l.nodeCount()}function s(l,u){return t.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return n(u,d)})}function o(l,u,d){t.forEach(l.nodes(),function(h){u.node(h).rank+=d})}return Hy}var Wy,GN;function E$(){if(GN)return Wy;GN=1;var t=At(),e=$O(),n=Xf().slack,r=Xf().longestPath,i=Ir().alg.preorder,s=Ir().alg.postorder,o=Ln().simplify;Wy=l,l.initLowLimValues=g,l.initCutValues=u,l.calcCutValue=h,l.leaveEdge=x,l.enterEdge=w,l.exchangeEdges=S;function l(R){R=o(R),r(R);var E=e(R);g(E),u(E,R);for(var C,O;C=x(E);)O=w(E,R,C),S(E,R,C,O)}function u(R,E){var C=s(R,R.nodes());C=C.slice(0,C.length-1),t.forEach(C,function(O){d(R,E,O)})}function d(R,E,C){var O=R.node(C),P=O.parent;R.edge(C,P).cutvalue=h(R,E,C)}function h(R,E,C){var O=R.node(C),P=O.parent,k=!0,I=E.edge(C,P),N=0;return I||(k=!1,I=E.edge(P,C)),N=I.weight,t.forEach(E.nodeEdges(C),function(B){var V=B.v===C,Z=V?B.w:B.v;if(Z!==P){var j=V===k,Y=E.edge(B).weight;if(N+=j?Y:-Y,T(R,C,Z)){var $=R.edge(C,Z).cutvalue;N+=j?-$:$}}}),N}function g(R,E){arguments.length<2&&(E=R.nodes()[0]),_(R,{},1,E)}function _(R,E,C,O,P){var k=C,I=R.node(O);return E[O]=!0,t.forEach(R.neighbors(O),function(N){t.has(E,N)||(C=_(R,E,C,N,O))}),I.low=k,I.lim=C++,P?I.parent=P:delete I.parent,C}function x(R){return t.find(R.edges(),function(E){return R.edge(E).cutvalue<0})}function w(R,E,C){var O=C.v,P=C.w;E.hasEdge(O,P)||(O=C.w,P=C.v);var k=R.node(O),I=R.node(P),N=k,B=!1;k.lim>I.lim&&(N=I,B=!0);var V=t.filter(E.edges(),function(Z){return B===A(R,R.node(Z.v),N)&&B!==A(R,R.node(Z.w),N)});return t.minBy(V,function(Z){return n(E,Z)})}function S(R,E,C,O){var P=C.v,k=C.w;R.removeEdge(P,k),R.setEdge(O.v,O.w,{}),g(R),u(R,E),b(R,E)}function b(R,E){var C=t.find(R.nodes(),function(P){return!E.node(P).parent}),O=i(R,C);O=O.slice(1),t.forEach(O,function(P){var k=R.node(P).parent,I=E.edge(P,k),N=!1;I||(I=E.edge(k,P),N=!0),E.node(P).rank=E.node(k).rank+(N?I.minlen:-I.minlen)})}function T(R,E,C){return R.hasEdge(E,C)}function A(R,E,C){return C.low<=E.lim&&E.lim<=C.lim}return Wy}var Xy,KN;function A$(){if(KN)return Xy;KN=1;var t=Xf(),e=t.longestPath,n=$O(),r=E$();Xy=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":o(u);break;case"longest-path":s(u);break;default:l(u)}}var s=e;function o(u){e(u),n(u)}function l(u){r(u)}return Xy}var Yy,ZN;function R$(){if(ZN)return Yy;ZN=1;var t=At();Yy=e;function e(i){var s=r(i);t.forEach(i.graph().dummyChains,function(o){for(var l=i.node(o),u=l.edgeObj,d=n(i,s,u.v,u.w),h=d.path,g=d.lca,_=0,x=h[_],w=!0;o!==u.w;){if(l=i.node(o),w){for(;(x=h[_])!==g&&i.node(x).maxRank<l.rank;)_++;x===g&&(w=!1)}if(!w){for(;_<h.length-1&&i.node(x=h[_+1]).minRank<=l.rank;)_++;x=h[_]}i.setParent(o,x),o=i.successors(o)[0]}})}function n(i,s,o,l){var u=[],d=[],h=Math.min(s[o].low,s[l].low),g=Math.max(s[o].lim,s[l].lim),_,x;_=o;do _=i.parent(_),u.push(_);while(_&&(s[_].low>h||g>s[_].lim));for(x=_,_=l;(_=i.parent(_))!==x;)d.push(_);return{path:u.concat(d.reverse()),lca:x}}function r(i){var s={},o=0;function l(u){var d=o;t.forEach(i.children(u),l),s[u]={low:d,lim:o++}}return t.forEach(i.children(),l),s}return Yy}var Gy,QN;function C$(){if(QN)return Gy;QN=1;var t=At(),e=Ln();Gy={run:n,cleanup:o};function n(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),h=t.max(t.values(d))-1,g=2*h+1;l.graph().nestingRoot=u,t.forEach(l.edges(),function(x){l.edge(x).minlen*=g});var _=s(l)+1;t.forEach(l.children(),function(x){r(l,u,g,_,h,d,x)}),l.graph().nodeRankFactor=g}function r(l,u,d,h,g,_,x){var w=l.children(x);if(!w.length){x!==u&&l.setEdge(u,x,{weight:0,minlen:d});return}var S=e.addBorderNode(l,"_bt"),b=e.addBorderNode(l,"_bb"),T=l.node(x);l.setParent(S,x),T.borderTop=S,l.setParent(b,x),T.borderBottom=b,t.forEach(w,function(A){r(l,u,d,h,g,_,A);var R=l.node(A),E=R.borderTop?R.borderTop:A,C=R.borderBottom?R.borderBottom:A,O=R.borderTop?h:2*h,P=E!==C?1:g-_[x]+1;l.setEdge(S,E,{weight:O,minlen:P,nestingEdge:!0}),l.setEdge(C,b,{weight:O,minlen:P,nestingEdge:!0})}),l.parent(x)||l.setEdge(u,S,{weight:0,minlen:g+_[x]})}function i(l){var u={};function d(h,g){var _=l.children(h);_&&_.length&&t.forEach(_,function(x){d(x,g+1)}),u[h]=g}return t.forEach(l.children(),function(h){d(h,1)}),u}function s(l){return t.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function o(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,t.forEach(l.edges(),function(d){var h=l.edge(d);h.nestingEdge&&l.removeEdge(d)})}return Gy}var Ky,JN;function N$(){if(JN)return Ky;JN=1;var t=At(),e=Ln();Ky=n;function n(i){function s(o){var l=i.children(o),u=i.node(o);if(l.length&&t.forEach(l,s),t.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,h=u.maxRank+1;d<h;++d)r(i,"borderLeft","_bl",o,u,d),r(i,"borderRight","_br",o,u,d)}}t.forEach(i.children(),s)}function r(i,s,o,l,u,d){var h={width:0,height:0,rank:d,borderType:s},g=u[s][d-1],_=e.addDummyNode(i,"border",h,o);u[s][d]=_,i.setParent(_,l),g&&i.setEdge(g,_,{weight:1})}return Ky}var Zy,ek;function k$(){if(ek)return Zy;ek=1;var t=At();Zy={adjust:e,undo:n};function e(d){var h=d.graph().rankdir.toLowerCase();(h==="lr"||h==="rl")&&r(d)}function n(d){var h=d.graph().rankdir.toLowerCase();(h==="bt"||h==="rl")&&s(d),(h==="lr"||h==="rl")&&(l(d),r(d))}function r(d){t.forEach(d.nodes(),function(h){i(d.node(h))}),t.forEach(d.edges(),function(h){i(d.edge(h))})}function i(d){var h=d.width;d.width=d.height,d.height=h}function s(d){t.forEach(d.nodes(),function(h){o(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,o),t.has(g,"y")&&o(g)})}function o(d){d.y=-d.y}function l(d){t.forEach(d.nodes(),function(h){u(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,u),t.has(g,"x")&&u(g)})}function u(d){var h=d.x;d.x=d.y,d.y=h}return Zy}var Qy,tk;function M$(){if(tk)return Qy;tk=1;var t=At();Qy=e;function e(n){var r={},i=t.filter(n.nodes(),function(d){return!n.children(d).length}),s=t.max(t.map(i,function(d){return n.node(d).rank})),o=t.map(t.range(s+1),function(){return[]});function l(d){if(!t.has(r,d)){r[d]=!0;var h=n.node(d);o[h.rank].push(d),t.forEach(n.successors(d),l)}}var u=t.sortBy(i,function(d){return n.node(d).rank});return t.forEach(u,l),o}return Qy}var Jy,nk;function I$(){if(nk)return Jy;nk=1;var t=At();Jy=e;function e(r,i){for(var s=0,o=1;o<i.length;++o)s+=n(r,i[o-1],i[o]);return s}function n(r,i,s){for(var o=t.zipObject(s,t.map(s,function(_,x){return x})),l=t.flatten(t.map(i,function(_){return t.sortBy(t.map(r.outEdges(_),function(x){return{pos:o[x.w],weight:r.edge(x).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var d=2*u-1;u-=1;var h=t.map(new Array(d),function(){return 0}),g=0;return t.forEach(l.forEach(function(_){var x=_.pos+u;h[x]+=_.weight;for(var w=0;x>0;)x%2&&(w+=h[x+1]),x=x-1>>1,h[x]+=_.weight;g+=_.weight*w})),g}return Jy}var eb,rk;function O$(){if(rk)return eb;rk=1;var t=At();eb=e;function e(n,r){return t.map(r,function(i){var s=n.inEdges(i);if(s.length){var o=t.reduce(s,function(l,u){var d=n.edge(u),h=n.node(u.v);return{sum:l.sum+d.weight*h.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:i}})}return eb}var tb,ik;function P$(){if(ik)return tb;ik=1;var t=At();tb=e;function e(i,s){var o={};t.forEach(i,function(u,d){var h=o[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};t.isUndefined(u.barycenter)||(h.barycenter=u.barycenter,h.weight=u.weight)}),t.forEach(s.edges(),function(u){var d=o[u.v],h=o[u.w];!t.isUndefined(d)&&!t.isUndefined(h)&&(h.indegree++,d.out.push(o[u.w]))});var l=t.filter(o,function(u){return!u.indegree});return n(l)}function n(i){var s=[];function o(d){return function(h){h.merged||(t.isUndefined(h.barycenter)||t.isUndefined(d.barycenter)||h.barycenter>=d.barycenter)&&r(d,h)}}function l(d){return function(h){h.in.push(d),--h.indegree===0&&i.push(h)}}for(;i.length;){var u=i.pop();s.push(u),t.forEach(u.in.reverse(),o(u)),t.forEach(u.out,l(u))}return t.map(t.filter(s,function(d){return!d.merged}),function(d){return t.pick(d,["vs","i","barycenter","weight"])})}function r(i,s){var o=0,l=0;i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),s.weight&&(o+=s.barycenter*s.weight,l+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=o/l,i.weight=l,i.i=Math.min(s.i,i.i),s.merged=!0}return tb}var nb,sk;function D$(){if(sk)return nb;sk=1;var t=At(),e=Ln();nb=n;function n(s,o){var l=e.partition(s,function(S){return t.has(S,"barycenter")}),u=l.lhs,d=t.sortBy(l.rhs,function(S){return-S.i}),h=[],g=0,_=0,x=0;u.sort(i(!!o)),x=r(h,d,x),t.forEach(u,function(S){x+=S.vs.length,h.push(S.vs),g+=S.barycenter*S.weight,_+=S.weight,x=r(h,d,x)});var w={vs:t.flatten(h,!0)};return _&&(w.barycenter=g/_,w.weight=_),w}function r(s,o,l){for(var u;o.length&&(u=t.last(o)).i<=l;)o.pop(),s.push(u.vs),l++;return l}function i(s){return function(o,l){return o.barycenter<l.barycenter?-1:o.barycenter>l.barycenter?1:s?l.i-o.i:o.i-l.i}}return nb}var rb,ak;function j$(){if(ak)return rb;ak=1;var t=At(),e=O$(),n=P$(),r=D$();rb=i;function i(l,u,d,h){var g=l.children(u),_=l.node(u),x=_?_.borderLeft:void 0,w=_?_.borderRight:void 0,S={};x&&(g=t.filter(g,function(C){return C!==x&&C!==w}));var b=e(l,g);t.forEach(b,function(C){if(l.children(C.v).length){var O=i(l,C.v,d,h);S[C.v]=O,t.has(O,"barycenter")&&o(C,O)}});var T=n(b,d);s(T,S);var A=r(T,h);if(x&&(A.vs=t.flatten([x,A.vs,w],!0),l.predecessors(x).length)){var R=l.node(l.predecessors(x)[0]),E=l.node(l.predecessors(w)[0]);t.has(A,"barycenter")||(A.barycenter=0,A.weight=0),A.barycenter=(A.barycenter*A.weight+R.order+E.order)/(A.weight+2),A.weight+=2}return A}function s(l,u){t.forEach(l,function(d){d.vs=t.flatten(d.vs.map(function(h){return u[h]?u[h].vs:h}),!0)})}function o(l,u){t.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return rb}var ib,ok;function L$(){if(ok)return ib;ok=1;var t=At(),e=Ir().Graph;ib=n;function n(i,s,o){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return t.forEach(i.nodes(),function(d){var h=i.node(d),g=i.parent(d);(h.rank===s||h.minRank<=s&&s<=h.maxRank)&&(u.setNode(d),u.setParent(d,g||l),t.forEach(i[o](d),function(_){var x=_.v===d?_.w:_.v,w=u.edge(x,d),S=t.isUndefined(w)?0:w.weight;u.setEdge(x,d,{weight:i.edge(_).weight+S})}),t.has(h,"minRank")&&u.setNode(d,{borderLeft:h.borderLeft[s],borderRight:h.borderRight[s]}))}),u}function r(i){for(var s;i.hasNode(s=t.uniqueId("_root")););return s}return ib}var sb,lk;function B$(){if(lk)return sb;lk=1;var t=At();sb=e;function e(n,r,i){var s={},o;t.forEach(i,function(l){for(var u=n.parent(l),d,h;u;){if(d=n.parent(u),d?(h=s[d],s[d]=u):(h=o,o=u),h&&h!==u){r.setEdge(h,u);return}u=d}})}return sb}var ab,ck;function U$(){if(ck)return ab;ck=1;var t=At(),e=M$(),n=I$(),r=j$(),i=L$(),s=B$(),o=Ir().Graph,l=Ln();ab=u;function u(_){var x=l.maxRank(_),w=d(_,t.range(1,x+1),"inEdges"),S=d(_,t.range(x-1,-1,-1),"outEdges"),b=e(_);g(_,b);for(var T=Number.POSITIVE_INFINITY,A,R=0,E=0;E<4;++R,++E){h(R%2?w:S,R%4>=2),b=l.buildLayerMatrix(_);var C=n(_,b);C<T&&(E=0,A=t.cloneDeep(b),T=C)}g(_,A)}function d(_,x,w){return t.map(x,function(S){return i(_,S,w)})}function h(_,x){var w=new o;t.forEach(_,function(S){var b=S.graph().root,T=r(S,b,w,x);t.forEach(T.vs,function(A,R){S.node(A).order=R}),s(S,w,T.vs)})}function g(_,x){t.forEach(x,function(w){t.forEach(w,function(S,b){_.node(S).order=b})})}return ab}var ob,uk;function F$(){if(uk)return ob;uk=1;var t=At(),e=Ir().Graph,n=Ln();ob={positionX:w,findType1Conflicts:r,findType2Conflicts:i,addConflict:o,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:_,findSmallestWidthAlignment:g,balance:x};function r(T,A){var R={};function E(C,O){var P=0,k=0,I=C.length,N=t.last(O);return t.forEach(O,function(B,V){var Z=s(T,B),j=Z?T.node(Z).order:I;(Z||B===N)&&(t.forEach(O.slice(k,V+1),function(Y){t.forEach(T.predecessors(Y),function($){var Q=T.node($),oe=Q.order;(oe<P||j<oe)&&!(Q.dummy&&T.node(Y).dummy)&&o(R,$,Y)})}),k=V+1,P=j)}),O}return t.reduce(A,E),R}function i(T,A){var R={};function E(O,P,k,I,N){var B;t.forEach(t.range(P,k),function(V){B=O[V],T.node(B).dummy&&t.forEach(T.predecessors(B),function(Z){var j=T.node(Z);j.dummy&&(j.order<I||j.order>N)&&o(R,Z,B)})})}function C(O,P){var k=-1,I,N=0;return t.forEach(P,function(B,V){if(T.node(B).dummy==="border"){var Z=T.predecessors(B);Z.length&&(I=T.node(Z[0]).order,E(P,N,V,k,I),N=V,k=I)}E(P,N,P.length,I,O.length)}),P}return t.reduce(A,C),R}function s(T,A){if(T.node(A).dummy)return t.find(T.predecessors(A),function(R){return T.node(R).dummy})}function o(T,A,R){if(A>R){var E=A;A=R,R=E}var C=T[A];C||(T[A]=C={}),C[R]=!0}function l(T,A,R){if(A>R){var E=A;A=R,R=E}return t.has(T[A],R)}function u(T,A,R,E){var C={},O={},P={};return t.forEach(A,function(k){t.forEach(k,function(I,N){C[I]=I,O[I]=I,P[I]=N})}),t.forEach(A,function(k){var I=-1;t.forEach(k,function(N){var B=E(N);if(B.length){B=t.sortBy(B,function($){return P[$]});for(var V=(B.length-1)/2,Z=Math.floor(V),j=Math.ceil(V);Z<=j;++Z){var Y=B[Z];O[N]===N&&I<P[Y]&&!l(R,N,Y)&&(O[Y]=N,O[N]=C[N]=C[Y],I=P[Y])}}})}),{root:C,align:O}}function d(T,A,R,E,C){var O={},P=h(T,A,R,C),k=C?"borderLeft":"borderRight";function I(V,Z){for(var j=P.nodes(),Y=j.pop(),$={};Y;)$[Y]?V(Y):($[Y]=!0,j.push(Y),j=j.concat(Z(Y))),Y=j.pop()}function N(V){O[V]=P.inEdges(V).reduce(function(Z,j){return Math.max(Z,O[j.v]+P.edge(j))},0)}function B(V){var Z=P.outEdges(V).reduce(function(Y,$){return Math.min(Y,O[$.w]-P.edge($))},Number.POSITIVE_INFINITY),j=T.node(V);Z!==Number.POSITIVE_INFINITY&&j.borderType!==k&&(O[V]=Math.max(O[V],Z))}return I(N,P.predecessors.bind(P)),I(B,P.successors.bind(P)),t.forEach(E,function(V){O[V]=O[R[V]]}),O}function h(T,A,R,E){var C=new e,O=T.graph(),P=S(O.nodesep,O.edgesep,E);return t.forEach(A,function(k){var I;t.forEach(k,function(N){var B=R[N];if(C.setNode(B),I){var V=R[I],Z=C.edge(V,B);C.setEdge(V,B,Math.max(P(T,N,I),Z||0))}I=N})}),C}function g(T,A){return t.minBy(t.values(A),function(R){var E=Number.NEGATIVE_INFINITY,C=Number.POSITIVE_INFINITY;return t.forIn(R,function(O,P){var k=b(T,P)/2;E=Math.max(O+k,E),C=Math.min(O-k,C)}),E-C})}function _(T,A){var R=t.values(A),E=t.min(R),C=t.max(R);t.forEach(["u","d"],function(O){t.forEach(["l","r"],function(P){var k=O+P,I=T[k],N;if(I!==A){var B=t.values(I);N=P==="l"?E-t.min(B):C-t.max(B),N&&(T[k]=t.mapValues(I,function(V){return V+N}))}})})}function x(T,A){return t.mapValues(T.ul,function(R,E){if(A)return T[A.toLowerCase()][E];var C=t.sortBy(t.map(T,E));return(C[1]+C[2])/2})}function w(T){var A=n.buildLayerMatrix(T),R=t.merge(r(T,A),i(T,A)),E={},C;t.forEach(["u","d"],function(P){C=P==="u"?A:t.values(A).reverse(),t.forEach(["l","r"],function(k){k==="r"&&(C=t.map(C,function(V){return t.values(V).reverse()}));var I=(P==="u"?T.predecessors:T.successors).bind(T),N=u(T,C,R,I),B=d(T,C,N.root,N.align,k==="r");k==="r"&&(B=t.mapValues(B,function(V){return-V})),E[P+k]=B})});var O=g(T,E);return _(E,O),x(E,T.graph().align)}function S(T,A,R){return function(E,C,O){var P=E.node(C),k=E.node(O),I=0,N;if(I+=P.width/2,t.has(P,"labelpos"))switch(P.labelpos.toLowerCase()){case"l":N=-P.width/2;break;case"r":N=P.width/2;break}if(N&&(I+=R?N:-N),N=0,I+=(P.dummy?A:T)/2,I+=(k.dummy?A:T)/2,I+=k.width/2,t.has(k,"labelpos"))switch(k.labelpos.toLowerCase()){case"l":N=k.width/2;break;case"r":N=-k.width/2;break}return N&&(I+=R?N:-N),N=0,I}}function b(T,A){return T.node(A).width}return ob}var lb,fk;function z$(){if(fk)return lb;fk=1;var t=At(),e=Ln(),n=F$().positionX;lb=r;function r(s){s=e.asNonCompoundGraph(s),i(s),t.forEach(n(s),function(o,l){s.node(l).x=o})}function i(s){var o=e.buildLayerMatrix(s),l=s.graph().ranksep,u=0;t.forEach(o,function(d){var h=t.max(t.map(d,function(g){return s.node(g).height}));t.forEach(d,function(g){s.node(g).y=u+h/2}),u+=h+l})}return lb}var cb,dk;function $$(){if(dk)return cb;dk=1;var t=At(),e=S$(),n=T$(),r=A$(),i=Ln().normalizeRanks,s=R$(),o=Ln().removeEmptyRanks,l=C$(),u=N$(),d=k$(),h=U$(),g=z$(),_=Ln(),x=Ir().Graph;cb=w;function w(z,X){var J=X&&X.debugTiming?_.time:_.notime;J("layout",function(){var pe=J("  buildLayoutGraph",function(){return I(z)});J("  runLayout",function(){S(pe,J)}),J("  updateInputGraph",function(){b(z,pe)})})}function S(z,X){X("    makeSpaceForEdgeLabels",function(){N(z)}),X("    removeSelfEdges",function(){K(z)}),X("    acyclic",function(){e.run(z)}),X("    nestingGraph.run",function(){l.run(z)}),X("    rank",function(){r(_.asNonCompoundGraph(z))}),X("    injectEdgeLabelProxies",function(){B(z)}),X("    removeEmptyRanks",function(){o(z)}),X("    nestingGraph.cleanup",function(){l.cleanup(z)}),X("    normalizeRanks",function(){i(z)}),X("    assignRankMinMax",function(){V(z)}),X("    removeEdgeLabelProxies",function(){Z(z)}),X("    normalize.run",function(){n.run(z)}),X("    parentDummyChains",function(){s(z)}),X("    addBorderSegments",function(){u(z)}),X("    order",function(){h(z)}),X("    insertSelfEdges",function(){L(z)}),X("    adjustCoordinateSystem",function(){d.adjust(z)}),X("    position",function(){g(z)}),X("    positionSelfEdges",function(){W(z)}),X("    removeBorderNodes",function(){oe(z)}),X("    normalize.undo",function(){n.undo(z)}),X("    fixupEdgeLabelCoords",function(){$(z)}),X("    undoCoordinateSystem",function(){d.undo(z)}),X("    translateGraph",function(){j(z)}),X("    assignNodeIntersects",function(){Y(z)}),X("    reversePoints",function(){Q(z)}),X("    acyclic.undo",function(){e.undo(z)})}function b(z,X){t.forEach(z.nodes(),function(J){var pe=z.node(J),xe=X.node(J);pe&&(pe.x=xe.x,pe.y=xe.y,X.children(J).length&&(pe.width=xe.width,pe.height=xe.height))}),t.forEach(z.edges(),function(J){var pe=z.edge(J),xe=X.edge(J);pe.points=xe.points,t.has(xe,"x")&&(pe.x=xe.x,pe.y=xe.y)}),z.graph().width=X.graph().width,z.graph().height=X.graph().height}var T=["nodesep","edgesep","ranksep","marginx","marginy"],A={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},R=["acyclicer","ranker","rankdir","align"],E=["width","height"],C={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],P={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},k=["labelpos"];function I(z){var X=new x({multigraph:!0,compound:!0}),J=se(z.graph());return X.setGraph(t.merge({},A,fe(J,T),t.pick(J,R))),t.forEach(z.nodes(),function(pe){var xe=se(z.node(pe));X.setNode(pe,t.defaults(fe(xe,E),C)),X.setParent(pe,z.parent(pe))}),t.forEach(z.edges(),function(pe){var xe=se(z.edge(pe));X.setEdge(pe,t.merge({},P,fe(xe,O),t.pick(xe,k)))}),X}function N(z){var X=z.graph();X.ranksep/=2,t.forEach(z.edges(),function(J){var pe=z.edge(J);pe.minlen*=2,pe.labelpos.toLowerCase()!=="c"&&(X.rankdir==="TB"||X.rankdir==="BT"?pe.width+=pe.labeloffset:pe.height+=pe.labeloffset)})}function B(z){t.forEach(z.edges(),function(X){var J=z.edge(X);if(J.width&&J.height){var pe=z.node(X.v),xe=z.node(X.w),Ae={rank:(xe.rank-pe.rank)/2+pe.rank,e:X};_.addDummyNode(z,"edge-proxy",Ae,"_ep")}})}function V(z){var X=0;t.forEach(z.nodes(),function(J){var pe=z.node(J);pe.borderTop&&(pe.minRank=z.node(pe.borderTop).rank,pe.maxRank=z.node(pe.borderBottom).rank,X=t.max(X,pe.maxRank))}),z.graph().maxRank=X}function Z(z){t.forEach(z.nodes(),function(X){var J=z.node(X);J.dummy==="edge-proxy"&&(z.edge(J.e).labelRank=J.rank,z.removeNode(X))})}function j(z){var X=Number.POSITIVE_INFINITY,J=0,pe=Number.POSITIVE_INFINITY,xe=0,Ae=z.graph(),Ne=Ae.marginx||0,be=Ae.marginy||0;function we(ke){var Xe=ke.x,Le=ke.y,Kt=ke.width,Ie=ke.height;X=Math.min(X,Xe-Kt/2),J=Math.max(J,Xe+Kt/2),pe=Math.min(pe,Le-Ie/2),xe=Math.max(xe,Le+Ie/2)}t.forEach(z.nodes(),function(ke){we(z.node(ke))}),t.forEach(z.edges(),function(ke){var Xe=z.edge(ke);t.has(Xe,"x")&&we(Xe)}),X-=Ne,pe-=be,t.forEach(z.nodes(),function(ke){var Xe=z.node(ke);Xe.x-=X,Xe.y-=pe}),t.forEach(z.edges(),function(ke){var Xe=z.edge(ke);t.forEach(Xe.points,function(Le){Le.x-=X,Le.y-=pe}),t.has(Xe,"x")&&(Xe.x-=X),t.has(Xe,"y")&&(Xe.y-=pe)}),Ae.width=J-X+Ne,Ae.height=xe-pe+be}function Y(z){t.forEach(z.edges(),function(X){var J=z.edge(X),pe=z.node(X.v),xe=z.node(X.w),Ae,Ne;J.points?(Ae=J.points[0],Ne=J.points[J.points.length-1]):(J.points=[],Ae=xe,Ne=pe),J.points.unshift(_.intersectRect(pe,Ae)),J.points.push(_.intersectRect(xe,Ne))})}function $(z){t.forEach(z.edges(),function(X){var J=z.edge(X);if(t.has(J,"x"))switch((J.labelpos==="l"||J.labelpos==="r")&&(J.width-=J.labeloffset),J.labelpos){case"l":J.x-=J.width/2+J.labeloffset;break;case"r":J.x+=J.width/2+J.labeloffset;break}})}function Q(z){t.forEach(z.edges(),function(X){var J=z.edge(X);J.reversed&&J.points.reverse()})}function oe(z){t.forEach(z.nodes(),function(X){if(z.children(X).length){var J=z.node(X),pe=z.node(J.borderTop),xe=z.node(J.borderBottom),Ae=z.node(t.last(J.borderLeft)),Ne=z.node(t.last(J.borderRight));J.width=Math.abs(Ne.x-Ae.x),J.height=Math.abs(xe.y-pe.y),J.x=Ae.x+J.width/2,J.y=pe.y+J.height/2}}),t.forEach(z.nodes(),function(X){z.node(X).dummy==="border"&&z.removeNode(X)})}function K(z){t.forEach(z.edges(),function(X){if(X.v===X.w){var J=z.node(X.v);J.selfEdges||(J.selfEdges=[]),J.selfEdges.push({e:X,label:z.edge(X)}),z.removeEdge(X)}})}function L(z){var X=_.buildLayerMatrix(z);t.forEach(X,function(J){var pe=0;t.forEach(J,function(xe,Ae){var Ne=z.node(xe);Ne.order=Ae+pe,t.forEach(Ne.selfEdges,function(be){_.addDummyNode(z,"selfedge",{width:be.label.width,height:be.label.height,rank:Ne.rank,order:Ae+ ++pe,e:be.e,label:be.label},"_se")}),delete Ne.selfEdges})})}function W(z){t.forEach(z.nodes(),function(X){var J=z.node(X);if(J.dummy==="selfedge"){var pe=z.node(J.e.v),xe=pe.x+pe.width/2,Ae=pe.y,Ne=J.x-xe,be=pe.height/2;z.setEdge(J.e,J.label),z.removeNode(X),J.label.points=[{x:xe+2*Ne/3,y:Ae-be},{x:xe+5*Ne/6,y:Ae-be},{x:xe+Ne,y:Ae},{x:xe+5*Ne/6,y:Ae+be},{x:xe+2*Ne/3,y:Ae+be}],J.label.x=J.x,J.label.y=J.y}})}function fe(z,X){return t.mapValues(t.pick(z,X),Number)}function se(z){var X={};return t.forEach(z,function(J,pe){X[pe.toLowerCase()]=J}),X}return cb}var ub,hk;function V$(){if(hk)return ub;hk=1;var t=At(),e=Ln(),n=Ir().Graph;ub={debugOrdering:r};function r(i){var s=e.buildLayerMatrix(i),o=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(i.nodes(),function(l){o.setNode(l,{label:l}),o.setParent(l,"layer"+i.node(l).rank)}),t.forEach(i.edges(),function(l){o.setEdge(l.v,l.w,{},l.name)}),t.forEach(s,function(l,u){var d="layer"+u;o.setNode(d,{rank:"same"}),t.reduce(l,function(h,g){return o.setEdge(h,g,{style:"invis"}),g})}),o}return ub}var fb,pk;function q$(){return pk||(pk=1,fb="0.8.5"),fb}var db,mk;function H$(){return mk||(mk=1,db={graphlib:Ir(),layout:$$(),debug:V$(),util:{time:Ln().time,notime:Ln().notime},version:q$()}),db}var gk=H$();const W$={sample:8,root:6,other:5};function d0(t,e,n,r){return t.is_sample||Jl(t,n,r)?t.is_sample?e.sample:e.root:e.other}const ze={ROOT_NODE_STROKE_WIDTH:2,SAMPLE_NODE_STROKE_WIDTH:1,EDGE_STROKE_WIDTH:1,COLLISION_RADIUS:15,TOOLTIP_FONT_SIZE:"12px",PADDING_RATIO:.1,MAX_SIBLING_DISTANCE:50,FORCE_STRENGTH:{LINK_SIBLING:.9,LINK_SAMPLE:.8,LINK_DEFAULT:.3,CHARGE:-20,X_POSITION:.15,Y_POSITION:1,ALPHA_START:.8,ALPHA_DECAY:.05,VELOCITY_DECAY:.7},ZOOM:{MIN_SCALE:.1,MAX_SCALE:4,FOCUS_SCALE:1.5,GRAPH_FIT_SCALE_MIN:.2,GRAPH_FIT_SCALE_MAX:1.5,TRANSITION_DURATION:750,ALPHA_TARGET:.3},LAYOUT:{BOTTOM_MARGIN_RATIO:.15},PERFORMANCE:{ALPHA_THRESHOLD:.1}};function To(t,e){const n=typeof t.source=="number"?e.find(i=>i.id===t.source)||null:t.source,r=typeof t.target=="number"?e.find(i=>i.id===t.target)||null:t.target;return{source:n,target:r}}function VO(t,e,n){const r=new Set,i=new Set,s=[t];for(;s.length>0;){const o=s.shift();if(i.has(o.id))continue;i.add(o.id),n.filter(u=>{const{source:d,target:h}=To(u,e);return(d==null?void 0:d.id)===o.id&&h&&h.timeIndex>o.timeIndex}).forEach(u=>{const{target:d}=To(u,e);d&&(d.is_sample?r.add(d):i.has(d.id)||s.push(d))})}return Array.from(r)}function Mf(t,e,n){const r=VO(t,e,n);if(r.length===0)return null;const i=r.map(s=>s.x);return{min:Math.min(...i),max:Math.max(...i)}}function X$(t,e,n){const r=Mf(t,e,n);r&&t.x!==void 0&&(t.x=Math.max(r.min,Math.min(r.max,t.x)))}function Yf(t,e,n){const r=n.find(s=>{const{source:o,target:l}=To(s,e);return(l==null?void 0:l.id)===t.id&&o&&o.timeIndex<t.timeIndex});if(!r)return null;const{source:i}=To(r,e);return i}function _k(t,e,n){const r=Yf(t,e,n);return r?e.filter(i=>{if(i.id===t.id||i.timeIndex<=r.timeIndex)return!1;const s=Yf(i,e,n);return(s==null?void 0:s.id)===r.id}):[]}function hb(t,e,n,r,i,s,o=5){const l=Math.sqrt((t-n)**2+(e-r)**2),u=Math.sqrt((t-i)**2+(e-s)**2),d=Math.sqrt((i-n)**2+(s-r)**2);return Math.abs(l+u-d)<=o}function Y$(t,e,n,r,i,s,o){const l=new Set(e.filter(g=>{const _=typeof g.source=="number"?g.source:g.source.id,x=typeof g.target=="number"?g.target:g.target.id;return _===t.id||x===t.id}).map(g=>`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`)),u=e.filter(g=>{const _=`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`;if(l.has(_))return!1;const x=typeof g.source=="number"?n.find(S=>S.id===g.source):g.source,w=typeof g.target=="number"?n.find(S=>S.id===g.target):g.target;return!x||!w?!1:hb(t.x,t.y,x.x,x.y,w.x,w.y,r*2)});if(u.length===0)return{x:t.x,y:t.y};const d=30,h=5;for(let g=h;g<=d;g+=h){const _=Math.min(t.x+g,s);let x=!1;for(const b of u){const T=typeof b.source=="number"?n.find(R=>R.id===b.source):b.source,A=typeof b.target=="number"?n.find(R=>R.id===b.target):b.target;if(hb(_,t.y,T.x,T.y,A.x,A.y,r*2)){x=!0;break}}if(!x)return{x:_,y:t.y};const w=Math.max(t.x-g,i);let S=!1;for(const b of u){const T=typeof b.source=="number"?n.find(R=>R.id===b.source):b.source,A=typeof b.target=="number"?n.find(R=>R.id===b.target):b.target;if(hb(w,t.y,T.x,T.y,A.x,A.y,r*2)){S=!0;break}}if(!S)return{x:w,y:t.y}}return{x:t.x,y:t.y}}function G$(t,e){return e.filter(n=>{const r=typeof n.source=="number"?n.source:n.source.id,i=typeof n.target=="number"?n.target:n.target.id;return r===t.id||i===t.id})}function K$(t,e,n){const r=vk(t,n),i=vk(e,n);if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}function vk(t,e){const n=new Set;return G$(t,e).forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id;i!==t.id&&n.add(i),s!==t.id&&n.add(s)}),n}function Z$(t,e){const n=new Set,r=[],i=new Map;for(let o=0;o<t.length;o++){if(n.has(t[o].id))continue;const l=t[o];if(l.is_sample){r.push(l),i.set(l.id,l.id),n.add(l.id);continue}const u=Q$(l,t,e,n,o),d=J$(l,u);r.push(d),u.forEach(h=>{i.set(h.id,d.id),n.add(h.id)})}const s=eV(e,i);return{nodes:r,edges:s}}function Q$(t,e,n,r,i){const s=[t];for(let o=i+1;o<e.length;o++){const l=e[o];r.has(l.id)||l.is_sample||t.time===l.time&&K$(t,l,n)&&s.push(l)}return s}function J$(t,e){return e.length===1?t:{...t,is_combined:!0,combined_nodes:e.map(n=>n.id)}}function eV(t,e){const n=[];return t.forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id,o=e.get(i),l=e.get(s);o!==void 0&&l!==void 0&&n.push({...r,source:o,target:l})}),n}function Jl(t,e,n){const r=n.some(s=>{const{target:o}=To(s,e);return(o==null?void 0:o.id)===t.id}),i=n.some(s=>{const{source:o}=To(s,e);return(o==null?void 0:o.id)===t.id});return!r&&i}function tV(t,e,n,r,i){return(s,o,l)=>{if(s)if(l.length===0){const u=o.find(x=>x.id===s.id);if(!u)return;const d=u.x??0,g=r*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO)-u.timeIndex*i,_=Kd.translate(n/2,r/2).scale(ze.ZOOM.FOCUS_SCALE).translate(-d,-g);t.transition().duration(ze.ZOOM.TRANSITION_DURATION).call(e.transform,_)}else{const u=o.filter(g=>g.x!==void 0&&g.timeIndex!==void 0);if(u.length===0)return;const d=nV(u,r,i),h=rV(d,n,r);t.transition().duration(ze.ZOOM.TRANSITION_DURATION).call(e.transform,h)}}}function nV(t,e,n){const r=t.map(o=>o.x),i=e*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),s=t.map(o=>i-o.timeIndex*n);return{minX:Math.min(...r),maxX:Math.max(...r),minY:Math.min(...s),maxY:Math.max(...s)}}function rV(t,e,n){const r=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2,s=t.maxX-t.minX,o=t.maxY-t.minY,l=50,u=(e-2*l)/(s||1),d=(n-2*l)/(o||1),h=Math.min(Math.max(ze.ZOOM.GRAPH_FIT_SCALE_MIN,Math.min(u,d)),ze.ZOOM.GRAPH_FIT_SCALE_MAX);return Kd.translate(e/2,n/2).scale(h).translate(-r,-i)}function iV(t,e,n,r){const i=new Map;t.forEach(s=>{if(!s.is_sample){const o=Math.round(s.x*100)/100,l=i.get(o)||[];l.push(s),i.set(o,l)}}),i.forEach((s,o)=>{if(s.length>1){s.sort((l,u)=>l.y-u.y);for(let l=0;l<s.length;l++)for(let u=l+1;u<s.length;u++){const d=s[l],h=s[u];if(!e.some(_=>{const x=typeof _.source=="number"?_.source:_.source.id,w=typeof _.target=="number"?_.target:_.target.id;return x===d.id&&w===h.id||x===h.id&&w===d.id})){const w=((h.id*1e4+d.id)%1e3/1e3-.5)*15,S=Math.max(n,Math.min(r,h.x+w));h.x=S,h.fx=S}}}})}function cr(t,e,n,r){if(e.length<=1)return n/2;const i=e[0],s=e[e.length-1],o=s-i;let l;switch(r){case"log":const u=i===0?.1:i;l=(Math.log(t===0?.1:t)-Math.log(u))/(Math.log(s)-Math.log(u));break;case"linear":l=(t-i)/o;break;case"equal":default:l=e.indexOf(t)/(e.length-1);break}return n-l*n}function sV(t,e,n,r,i,s,o="equal"){const l=Array.from(new Set(t.map(x=>x.time))).sort((x,w)=>x-w),u=new Map(l.map((x,w)=>[x,w])),d=r*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h=d/(l.length-1||1),g=n*ze.PADDING_RATIO,_=n-2*g;if(t.forEach(x=>{x.timeIndex=u.get(x.time)??0}),i==="dagre"){console.log("Setting up dagre layout...");const x=new gk.graphlib.Graph;x.setGraph({rankdir:"TB",nodesep:50,ranksep:75,marginx:g,marginy:20,ranker:"network-simplex",acyclicer:"greedy",align:"UL"}),x.setDefaultEdgeLabel(()=>({})),t.forEach(I=>{x.setNode(I.id.toString(),{width:20,height:20,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:5})}),e.forEach(I=>{const N=typeof I.source=="number"?I.source:I.source.id,B=typeof I.target=="number"?I.target:I.target.id,V=t.find(Y=>Y.id===N),Z=t.find(Y=>Y.id===B);let j=1;V&&Z&&((V.is_sample||Z.is_sample)&&(j=3),Math.abs(V.time-Z.time)===1&&(j+=1)),x.setEdge(N.toString(),B.toString(),{weight:j})}),gk.layout(x);const w=t.filter(I=>I.is_sample);let S=1/0,b=-1/0;w.forEach(I=>{const N=x.node(I.id.toString());N&&(S=Math.min(S,N.x),b=Math.max(b,N.x))});const T=100,A=b-S,E=Math.min(A,T*(w.length-1))/A;t.forEach(I=>{const N=x.node(I.id.toString());if(N){const B=(N.x-S)*E+S;I.x=B,I.y=N.y,I.fx=I.x,I.fy=I.y}}),iV(t,e,S,b);const C=new Set;let O=!0;const P=3;let k=0;for(;O&&k<P;){O=!1,k++;const I=t.filter(N=>!C.has(N.id)).sort((N,B)=>{const V=e.filter(j=>{const Y=typeof j.source=="number"?j.source:j.source.id,$=typeof j.target=="number"?j.target:j.target.id;return Y===N.id||$===N.id}).length;return e.filter(j=>{const Y=typeof j.source=="number"?j.source:j.source.id,$=typeof j.target=="number"?j.target:j.target.id;return Y===B.id||$===B.id}).length-V});for(const N of I){if(N.is_sample){C.add(N.id);continue}const B=s?d0(N,s,t,e):5,V=Y$(N,e,t,B,S,b);(V.x!==N.x||V.y!==N.y)&&(N.x=V.x,N.fx=V.x,N.y=V.y,N.fy=V.y,O=!0),C.add(N.id)}}console.log("Dagre layout complete. Node count:",t.length)}else{const x=t.filter(S=>S.is_sample),w=_/(x.length-1||1);x.sort((S,b)=>S.order_position!==void 0&&b.order_position!==void 0?S.order_position-b.order_position:S.order_position!==void 0?-1:b.order_position!==void 0?1:(b.degree??0)-(S.degree??0)),x.forEach((S,b)=>{S.x=g+b*w,S.fx=S.x,S.y=cr(S.time,l,d,o),S.fy=S.y}),t.filter(S=>!S.is_sample).forEach(S=>{S.fx=null,S.fy=null,S.y=cr(S.time,l,d,o)})}return{timeSpacing:h,uniqueTimes:l}}const aV=D.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,onEdgeClick:s,focalNode:o,nodeSizes:l=W$,sampleOrder:u="degree",edgeThickness:d=ze.EDGE_STROKE_WIDTH,temporalSpacingMode:h="equal"},g)=>{const{colors:_}=bt(),x=D.useMemo(()=>t?`${t.nodes.length}-${t.edges.length}-${t.metadata.genomic_start||0}-${t.metadata.genomic_end||t.metadata.sequence_length}`:null,[t==null?void 0:t.nodes.length,t==null?void 0:t.edges.length,t==null?void 0:t.metadata.genomic_start,t==null?void 0:t.metadata.genomic_end,t==null?void 0:t.metadata.sequence_length]),w=D.useRef({data:null,key:null}),S=D.useMemo(()=>!t||!x?null:w.current.key===x&&w.current.data?w.current.data:(w.current={data:t,key:x},t),[t,x]);return D.useEffect(()=>{if(!g||typeof g=="function"||!g.current||!S)return;const b=g.current.getBoundingClientRect(),T=e||b.width||800,A=n||b.height||600,R=A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),{nodes:E,edges:C}=Z$(S.nodes,S.edges);Array.from(new Set(E.map(K=>K.time))).sort((K,L)=>K-L),fr(g.current).selectAll("*").remove();const O=fr(g.current).attr("width",T).attr("height",A).attr("viewBox",[0,0,T,A]).attr("style","max-width: 100%; height: auto;"),P=O.append("g"),k=kz().scaleExtent([ze.ZOOM.MIN_SCALE,ze.ZOOM.MAX_SCALE]).on("zoom",K=>{P.attr("transform",K.transform)});O.call(k);const I=tV(O,k,T,A,0),{uniqueTimes:N}=sV(E,C,T,A,u,l,h);o&&I(o,E,C);const B=fr("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color",_.tooltipBackground).style("color",_.tooltipText).style("border",`1px solid ${_.border}`).style("padding","8px").style("border-radius","4px").style("font-size",ze.TOOLTIP_FONT_SIZE).style("pointer-events","none"),V=yz(E).alpha(u==="dagre"?0:ze.FORCE_STRENGTH.ALPHA_START).alphaDecay(u==="dagre"?1:ze.FORCE_STRENGTH.ALPHA_DECAY).velocityDecay(u==="dagre"?1:ze.FORCE_STRENGTH.VELOCITY_DECAY).force("link",u==="dagre"?null:dz(C).id(K=>K.id).distance(50).strength(K=>{const L=typeof K.source=="number"?E.find(z=>z.id===K.source):K.source,W=typeof K.target=="number"?E.find(z=>z.id===K.target):K.target,fe=Yf(L,E,C),se=Yf(W,E,C);return fe&&se&&fe.id===se.id?ze.FORCE_STRENGTH.LINK_SIBLING:L!=null&&L.is_sample||W!=null&&W.is_sample?ze.FORCE_STRENGTH.LINK_SAMPLE:ze.FORCE_STRENGTH.LINK_DEFAULT})).force("charge",u==="dagre"?null:bz().strength(ze.FORCE_STRENGTH.CHARGE)).force("x",u==="dagre"?null:wz(K=>{if(K.is_sample)return K.x;const L=Mf(K,E,C),W=_k(K,E,C);if(W.length>0){const fe=W.reduce((se,z)=>se+(z.x??0),0)/W.length;if(L){const se=(fe+(L.min+L.max)/2)/2;return Math.max(L.min,Math.min(L.max,se))}return fe}return L?(L.min+L.max)/2:K.x??T/2}).strength(ze.FORCE_STRENGTH.X_POSITION)).force("y",Sz(K=>cr(K.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)).strength(u==="dagre"?1:ze.FORCE_STRENGTH.Y_POSITION)).force("collision",u==="dagre"?null:uz().radius(ze.COLLISION_RADIUS)),Z=P.append("g").selectAll("line").data(C).join("line").attr("stroke",`rgb(${_.edgeDefault[0]}, ${_.edgeDefault[1]}, ${_.edgeDefault[2]})`).attr("stroke-opacity",_.edgeDefault[3]/255).attr("stroke-width",d).attr("x1",K=>{const L=typeof K.source=="number"?E.find(W=>W.id===K.source):K.source;return(L==null?void 0:L.x)??0}).attr("y1",K=>{const L=typeof K.source=="number"?E.find(W=>W.id===K.source):K.source;return cr(L.time,N,R,h)}).attr("x2",K=>{const L=typeof K.target=="number"?E.find(W=>W.id===K.target):K.target;return(L==null?void 0:L.x)??0}).attr("y2",K=>{const L=typeof K.target=="number"?E.find(W=>W.id===K.target):K.target;return cr(L.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).on("click",(K,L)=>s==null?void 0:s(L));function j(K){K.active||V.alphaTarget(ze.ZOOM.ALPHA_TARGET).restart(),K.subject.fx=K.subject.x,K.subject.fy=cr(K.subject.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function Y(K){if(!S)return;const L=Mf(K.subject,E,C),W=_k(K.subject,E,C);let fe=K.x;if(L)fe=Math.max(L.min,Math.min(L.max,fe));else{const se=T*ze.PADDING_RATIO;fe=Math.max(se,Math.min(T-se,fe))}if(W.length>0){const se=W.reduce((z,X)=>z+(X.x??0),0)/W.length;fe=Math.max(se-ze.MAX_SIBLING_DISTANCE,Math.min(se+ze.MAX_SIBLING_DISTANCE,fe))}K.subject.fx=fe,K.subject.fy=cr(K.subject.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function $(K){K.active||V.alphaTarget(0),K.subject.fx=null;const L=Mf(K.subject,E,C);let W=K.subject.x??0;if(L)W=Math.max(L.min,Math.min(L.max,W));else{const fe=T*ze.PADDING_RATIO;W=Math.max(fe,Math.min(T-fe,W))}K.subject.x=W,K.subject.fy=cr(K.subject.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}const Q=P.append("g").selectAll("circle").data(E).join("circle").attr("r",K=>d0(K,l,E,C)).attr("fill",K=>K.is_sample?`rgb(${_.nodeSample[0]}, ${_.nodeSample[1]}, ${_.nodeSample[2]})`:K.is_combined?`rgb(${_.nodeCombined[0]}, ${_.nodeCombined[1]}, ${_.nodeCombined[2]})`:Jl(K,E,C)?`rgb(${_.nodeRoot[0]}, ${_.nodeRoot[1]}, ${_.nodeRoot[2]})`:`rgb(${_.nodeDefault[0]}, ${_.nodeDefault[1]}, ${_.nodeDefault[2]})`).attr("stroke",K=>Jl(K,E,C)?`rgb(${_.nodeSelected[0]}, ${_.nodeSelected[1]}, ${_.nodeSelected[2]})`:K.is_sample?_.background:"none").attr("stroke-width",K=>Jl(K,E,C)?ze.ROOT_NODE_STROKE_WIDTH:K.is_sample?ze.SAMPLE_NODE_STROKE_WIDTH:0).style("cursor","pointer").call(l8().on("start",j).on("drag",Y).on("end",$)).on("click",(K,L)=>{K.preventDefault(),r==null||r(L)}).on("contextmenu",(K,L)=>{K.preventDefault(),i==null||i(L)}).on("mouseover",(K,L)=>{var fe;let W="";if(L.is_sample)W=`Sample node ${L.id}<br>Time: ${L.time}`;else if(L.is_combined)W=`Combined node ${L.id}<br>Contains nodes: ${(fe=L.combined_nodes)==null?void 0:fe.join(", ")}<br>Time: ${L.time}`;else if(Jl(L,E,C)){const se=[...new Set(C.filter(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return(J==null?void 0:J.id)===L.id}).map(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J),z=VO(L,E,C).map(X=>X.id).sort((X,J)=>X-J);W=`Root node ${L.id}<br>Time: ${L.time}`,se.length>0&&(W+=`<br>Children: ${se.join(", ")}`),z.length>0&&(W+=`<br>Descendant samples: ${z.join(", ")}`)}else{const se=[...new Set(C.filter(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return(J==null?void 0:J.id)===L.id}).map(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J),z=[...new Set(C.filter(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return(J==null?void 0:J.id)===L.id}).map(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J);W=`Internal node ${L.id}<br>Time: ${L.time}`,se.length>0&&(W+=`<br>Parents: ${se.join(", ")}`),z.length>0&&(W+=`<br>Children: ${z.join(", ")}`)}if(L.individual!==void 0&&L.individual!==-1&&(W+=`<br>Individual: ${L.individual}`),L.location){const se=L.location,z=se.x>=-180&&se.x<=180&&se.y>=-90&&se.y<=90&&(se.x!==0||se.y!==0);se.z!==void 0?z?W+=`<br>Location: Lat: ${se.y.toFixed(3)}, Lon: ${se.x.toFixed(3)}, Z: ${se.z.toFixed(2)}`:W+=`<br>Location: (${se.x.toFixed(2)}, ${se.y.toFixed(2)}, ${se.z.toFixed(2)})`:z?W+=`<br>Location: Lat: ${se.y.toFixed(3)}, Lon: ${se.x.toFixed(3)}`:W+=`<br>Location: (${se.x.toFixed(2)}, ${se.y.toFixed(2)})`}B.style("visibility","visible").html(W).style("left",K.pageX+10+"px").style("top",K.pageY-10+"px")}).on("mousemove",K=>{B.style("left",K.pageX+10+"px").style("top",K.pageY-10+"px")}).on("mouseout",()=>{B.style("visibility","hidden")}),oe=P.append("g").selectAll("text").data(E.filter(K=>K.is_sample)).join("text").text(K=>K.id.toString()).attr("font-size",K=>`${l.sample*1.2}px`).attr("fill",_.text).attr("text-anchor","middle").attr("dx",0).attr("dy",K=>d0(K,l,E,C)+12);return V.on("tick",()=>{S&&(V.alpha()>ze.PERFORMANCE.ALPHA_THRESHOLD&&E.forEach(K=>{K.is_sample||X$(K,E,C)}),Z.attr("x1",K=>{const L=typeof K.source=="number"?E.find(W=>W.id===K.source):K.source;return(L==null?void 0:L.x)??0}).attr("y1",K=>{const L=typeof K.source=="number"?E.find(W=>W.id===K.source):K.source;return cr(L.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).attr("x2",K=>{const L=typeof K.target=="number"?E.find(W=>W.id===K.target):K.target;return(L==null?void 0:L.x)??0}).attr("y2",K=>{const L=typeof K.target=="number"?E.find(W=>W.id===K.target):K.target;return cr(L.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)}),Q.attr("cx",K=>K.x??0).attr("cy",K=>cr(K.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)),oe.attr("x",K=>K.x??0).attr("y",K=>cr(K.time,N,A*(1-ze.LAYOUT.BOTTOM_MARGIN_RATIO),h)))}),()=>{V&&V.stop(),B&&B.remove()}},[S,e,n,r,i,s,o,l,g,u,d,h]),p.jsx("div",{className:"w-full h-full",children:p.jsx("svg",{ref:g,className:"w-full h-full"})})}),oV=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,genomicRange:o,sequenceLength:l,isFiltered:u=!1,isFilterSectionCollapsed:d=!0})=>{const{colors:h}=bt(),[g,_]=D.useState(!0),x=t&&n?(n/t*100).toFixed(1):null,w=e&&r?(r/e*100).toFixed(1):null;if(!(t||n||i))return null;const b=T=>T>=1e6?`${(T/1e6).toFixed(1)}M`:T>=1e3?`${(T/1e3).toFixed(1)}K`:T.toString();return p.jsxs("div",{className:"absolute top-4 right-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${h.background}F0`,borderColor:h.border,color:h.text},children:[p.jsxs("div",{onClick:()=>_(!g),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:g?"transparent":`${h.containerBackground}80`},onMouseEnter:T=>{g||(T.currentTarget.style.backgroundColor=`${h.border}40`)},onMouseLeave:T=>{g||(T.currentTarget.style.backgroundColor=`${h.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:h.text},children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-180":""}`,style:{color:h.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Graph Statistics"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Original ARG:"}),p.jsxs("span",{style:{color:h.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"SubARG:"}),p.jsxs("span",{style:{color:h.text},children:[n.toLocaleString()," nodes (",x,"%), ",r.toLocaleString()," edges (",w,"%)"]})]}),i&&s&&(i!==n||s!==r)&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Displayed:"}),p.jsxs("span",{style:{color:h.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Reduction:"}),p.jsxs("span",{style:{color:h.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),u&&o&&l&&p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Filter Information"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Range:"}),p.jsxs("span",{style:{color:h.text},children:[b(o[0])," - ",b(o[1])]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Length:"}),p.jsxs("span",{style:{color:h.text},children:[b(o[1]-o[0])," bp"]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:h.accentPrimary},children:"Coverage:"}),p.jsxs("span",{style:{color:h.text},children:[((o[1]-o[0])/l*100).toFixed(1),"% of sequence"]})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"View Controls"}),p.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${h.text}CC`},children:[p.jsx("div",{children:" Drag: Pan view"}),p.jsx("div",{children:" Scroll: Zoom in/out"}),p.jsx("div",{children:" Left click: Select node"}),p.jsx("div",{children:" Right click: Show ancestors"}),p.jsx("div",{children:" Drag nodes to reposition"})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Node Types"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]})`,borderColor:h.background,borderWidth:"0.5px"}}),p.jsx("span",{style:{color:h.text},children:"Sample Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]})`}}),p.jsx("span",{style:{color:h.text},children:"Internal Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeCombined[0]}, ${h.nodeCombined[1]}, ${h.nodeCombined[2]})`}}),p.jsx("span",{style:{color:h.text},children:"Combined Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]})`,borderColor:`rgb(${h.nodeSelected[0]}, ${h.nodeSelected[1]}, ${h.nodeSelected[2]})`}}),p.jsx("span",{style:{color:h.text},children:"Root Nodes"})]})]})]})]})]})},lV=[{value:"degree",label:"Degree",description:"Order by node connectivity (current default)"},{value:"center_minlex",label:"Center Tree",description:"Minlex postorder of tree at center genomic position"},{value:"first_tree",label:"First Tree",description:"Minlex postorder of first tree"},{value:"custom",label:"Consensus",description:"Majority vote across multiple trees"},{value:"numeric",label:"Numeric",description:"Simple numeric order (0, 1, 2, ...)"},{value:"dagre",label:"Layer-based",description:"Order nodes in each layer using dagre-d3 algorithm"}],cV=({value:t,onChange:e,className:n=""})=>{const{colors:r}=bt();return p.jsxs("div",{className:`flex items-center gap-2 ${n}`,children:[p.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Sample Order:"}),p.jsx("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:lV.map(i=>p.jsx("button",{onClick:()=>e(i.value),className:"px-3 py-1 text-xs font-medium transition-colors whitespace-nowrap",style:{backgroundColor:t===i.value?r.textSecondary:r.containerBackground,color:t===i.value?r.background:r.text},title:i.description,children:i.label},i.value))})]})},uV=({sampleOrder:t,onSampleOrderChange:e,nodeSizes:n,onNodeSizeChange:r,edgeThickness:i,onEdgeThicknessChange:s,temporalSpacing:o,onTemporalSpacingChange:l,temporalSpacingMode:u,onTemporalSpacingModeChange:d,isLoading:h=!1})=>{const{colors:g}=bt(),[_,x]=D.useState(!0);return p.jsxs("div",{className:"absolute top-4 left-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${g.background}F0`,borderColor:g.border,color:g.text},children:[p.jsxs("div",{onClick:()=>x(!_),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:_?"transparent":`${g.containerBackground}80`},onMouseEnter:w=>{_||(w.currentTarget.style.backgroundColor=`${g.border}40`)},onMouseLeave:w=>{_||(w.currentTarget.style.backgroundColor=`${g.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:g.text},children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),"Graph Controls"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${_?"rotate-180":""}`,style:{color:g.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Temporal Spacing"}),p.jsxs("div",{className:"flex gap-2",children:[p.jsx("button",{onClick:()=>d("equal"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="equal"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="equal"?g.accentPrimary:`${g.border}40`,color:u==="equal"?g.background:g.text},children:"Equal"}),p.jsx("button",{onClick:()=>d("log"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="log"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="log"?g.accentPrimary:`${g.border}40`,color:u==="log"?g.background:g.text},children:"Log"}),p.jsx("button",{onClick:()=>d("linear"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="linear"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="linear"?g.accentPrimary:`${g.border}40`,color:u==="linear"?g.background:g.text},children:"Linear"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("label",{className:"text-xs font-medium",style:{color:g.text},children:["Spacing: ",o]})}),p.jsx("input",{type:"range",min:5,max:50,step:1,value:o,onChange:w=>l(Number(w.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(o-5)/45*100}%, ${g.border} ${(o-5)/45*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),p.jsxs("div",{className:"text-xs",style:{color:`${g.text}CC`},children:[u==="equal"&&p.jsx("div",{children:" Time points are spaced equally"}),u==="log"&&p.jsx("div",{children:" Time points are spaced logarithmically based on their actual values"}),u==="linear"&&p.jsx("div",{children:" Time points are spaced according to their actual time values"})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Sample Order"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx(cV,{value:t,onChange:e}),h&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:g.accentPrimary}}),p.jsx("span",{className:"text-xs",style:{color:g.text},children:"Updating sample order..."})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Node Sizes"}),p.jsxs("div",{className:"space-y-3",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Sample Nodes"}),p.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.sample,"px"]})]}),p.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.sample,onChange:w=>r({...n,sample:parseInt(w.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.sample-3)/12*100}%, ${g.border} ${(n.sample-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Root Nodes"}),p.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.root,"px"]})]}),p.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.root,onChange:w=>r({...n,root:parseInt(w.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.root-3)/12*100}%, ${g.border} ${(n.root-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Internal & Combined"}),p.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.other,"px"]})]}),p.jsx("input",{type:"range",min:"2",max:"10",step:"1",value:n.other,onChange:w=>r({...n,other:parseInt(w.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.other-2)/8*100}%, ${g.border} ${(n.other-2)/8*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Edge Thickness"}),p.jsxs("div",{className:"space-y-1",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Edge Width"}),p.jsxs("span",{className:"text-xs",style:{color:g.text},children:[i,"px"]})]}),p.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:i,onChange:w=>s(parseFloat(w.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(i-.5)/2.5*100}%, ${g.border} ${(i-.5)/2.5*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Graph Layout"}),p.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${g.text}CC`},children:[p.jsx("div",{children:" Sample nodes are positioned based on the selected order"}),p.jsx("div",{children:" Internal nodes position themselves relative to descendants"}),p.jsx("div",{children:" Drag nodes to manually adjust positions"}),p.jsx("div",{children:" Use zoom and pan to navigate the graph"})]})]})]})]})},qO=({min:t,max:e,step:n=1,value:r,onChange:i,formatValue:s=l=>l.toString(),className:o=""})=>{const{colors:l}=bt(),[u,d]=D.useState(null),[h,g]=D.useState({x:0,startValue:[0,0]}),[_,x]=D.useState(!1),[w,S]=D.useState(null),b=D.useRef(null);D.useEffect(()=>{const k=N=>{if(N.key==="Shift"){if(x(!0),w===null){const B=Math.abs(r[1]-r[0]);S(Math.max(B,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},I=N=>{N.key==="Shift"&&(x(!1),S(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",k),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",k),document.removeEventListener("keyup",I),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,w,n]);const T=D.useCallback(k=>{if(!b.current)return t;const I=b.current.getBoundingClientRect(),N=Math.max(0,Math.min(1,(k-I.left)/I.width)),B=t+N*(e-t);return Math.round(B/n)*n},[t,e,n]),A=D.useCallback(k=>(k-t)/(e-t)*100,[t,e]),R=D.useCallback((k,I)=>{k.preventDefault(),k.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",d(I),g({x:k.clientX,startValue:r})},[r]),E=D.useCallback(k=>{if(!u||!b.current)return;const I=T(k.clientX),[N,B]=r;if(u==="left"){const V=Math.min(I,B-n);i([Math.max(t,V),B])}else if(u==="right"){const V=Math.max(I,N+n);i([N,Math.min(e,V)])}else if(u==="range"){const V=k.clientX-h.x,Z=b.current.getBoundingClientRect(),j=V/Z.width*(e-t),[Y,$]=h.startValue;let Q=Math.abs($-Y);_&&w!==null&&(Q=w);const K=(Y+$)/2+j;let L,W;_&&w!==null?(L=K-Q/2,W=K+Q/2):(L=Y+j,W=$+j),L<t&&(L=t,W=t+Q),W>e&&(W=e,L=e-Q),i([Math.round(L/n)*n,Math.round(W/n)*n])}},[u,r,i,T,t,e,n,h,_,w]),C=D.useCallback(()=>{d(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);D.useEffect(()=>{if(u)return document.addEventListener("mousemove",E),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",C)}},[u,E,C]);const O=A(r[0]),P=A(r[1]);return p.jsxs("div",{className:`relative w-full ${o}`,style:{userSelect:"none"},children:[p.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:l.text},children:[p.jsx("span",{children:s(r[0])}),p.jsx("span",{children:s(r[1])})]}),p.jsxs("div",{ref:b,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:l.containerBackground},onMouseDown:k=>{const I=T(k.clientX),[N,B]=r,V=Math.abs(I-N),Z=Math.abs(I-B);_||Math.abs(B-N)<n*2?R(k,"range"):V<Z?R(k,"left"):R(k,"right")},children:[p.jsx("div",{className:`absolute h-full rounded-full transition-opacity ${_?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{left:`${O}%`,width:`${P-O}%`,backgroundColor:_?l.text:l.textSecondary,opacity:_?.8:1,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"range")}}),p.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${O}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"left")}}),p.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${P}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"right")}})]}),p.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs",style:{color:l.text},children:[p.jsx("span",{children:s(t)}),p.jsx("div",{className:"flex items-center justify-center",children:_&&p.jsx("div",{className:"px-2 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:l.textSecondary,color:l.background,fontSize:"10px"},children:"Fixed Size"})}),p.jsx("span",{children:s(e)})]})]})},HO=({treeIntervals:t,value:e,onChange:n,className:r=""})=>{const{colors:i}=bt(),[s,o]=D.useState(null),[l,u]=D.useState({x:0,startValue:[0,0]}),d=D.useRef(null);if(!t||t.length===0)return null;const h=0,g=t.length-1,_=t[g].right-t[0].left,x=D.useCallback(P=>{if(!d.current)return h;const k=d.current.getBoundingClientRect(),I=Math.max(0,Math.min(1,(P-k.left)/k.width)),N=t[0].left+I*_;for(let B=0;B<t.length;B++){const V=t[B],Z=(V.left+V.right)/2;if(B===t.length-1||N<=Z)return B}return g},[t,_]),w=D.useCallback(P=>{if(P<0||P>=t.length)return 0;const k=t[P];return((k.left+k.right)/2-t[0].left)/_*100},[t,_]),S=D.useCallback(P=>{if(P<0||P>=t.length)return"Invalid";const k=t[P];return`Tree ${P} (${k.left.toFixed(1)}-${k.right.toFixed(1)})`},[t]),b=D.useCallback((P,k)=>{if(P<0||k>=t.length||P>k)return"Invalid range";const I=t[P].left,N=t[k].right,B=N-I;return`${(Z=>Z>=1e6?`${(Z/1e6).toFixed(1)}M`:Z>=1e3?`${(Z/1e3).toFixed(1)}K`:Z.toFixed(1))(B)} bp (${I.toFixed(1)}-${N.toFixed(1)})`},[t]),T=D.useCallback((P,k)=>{P.preventDefault(),o(k),u({x:P.clientX,startValue:e})},[e]),A=D.useCallback(P=>{if(!s||!d.current)return;const k=x(P.clientX),[I,N]=e;if(s==="left")k<=N?n([Math.max(h,Math.min(g,k)),N]):n([N,Math.max(h,Math.min(g,k))]);else if(s==="right")k>=I?n([I,Math.max(h,Math.min(g,k))]):n([Math.max(h,Math.min(g,k)),I]);else if(s==="range"){const B=P.clientX-l.x,V=d.current.getBoundingClientRect(),j=B/V.width*_,[Y,$]=l.startValue,Q=(t[Y].left+t[Y].right)/2,oe=(t[$].left+t[$].right)/2,K=Q+j,L=oe+j;let W=Y,fe=$;for(let z=0;z<t.length;z++){const X=(t[z].left+t[z].right)/2;if(K<=X||z===t.length-1){W=z;break}}for(let z=0;z<t.length;z++){const X=(t[z].left+t[z].right)/2;if(L<=X||z===t.length-1){fe=z;break}}W=Math.max(h,Math.min(g,W)),fe=Math.max(h,Math.min(g,fe));const se=$-Y;W!==fe&&Math.abs(fe-W)!==se&&(W+se<=g?fe=W+se:fe-se>=h&&(W=fe-se)),n([W,fe])}},[s,e,n,x,h,g,l,_,t]),R=D.useCallback(()=>{o(null)},[]);D.useEffect(()=>{if(s)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R)}},[s,A,R]);const E=w(e[0]),C=w(e[1]),O=e[1]-e[0]+1;return p.jsxs("div",{className:`relative w-full ${r}`,children:[p.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:i.text},children:[p.jsx("span",{children:S(e[0])}),p.jsx("span",{children:S(e[1])})]}),p.jsxs("div",{ref:d,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:i.containerBackground},onMouseDown:P=>{const k=x(P.clientX),[I,N]=e,B=Math.abs(k-I),V=Math.abs(k-N);B<V?T(P,"left"):T(P,"right")},children:[p.jsx("div",{className:"absolute h-full rounded-full cursor-grab active:cursor-grabbing",style:{left:`${E}%`,width:`${C-E}%`,backgroundColor:i.textSecondary},onMouseDown:P=>T(P,"range")}),p.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${E}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:P=>T(P,"left")}),p.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${C}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:P=>T(P,"right")})]}),p.jsxs("div",{className:"flex justify-between mt-1 text-xs",style:{color:i.text},children:[p.jsx("span",{children:"Tree 0"}),p.jsxs("div",{className:"text-center",children:[p.jsxs("div",{children:[O," tree",O!==1?"s":""," selected"]}),p.jsx("div",{style:{color:i.textSecondary},children:b(e[0],e[1])})]}),p.jsxs("span",{children:["Tree ",g]})]})]})},fV=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u===o&&!i.has(d)&&(r.add(d),s.push(d))}))}return r},dV=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id;(typeof l.target=="number"?l.target:l.target.id)===o&&!i.has(u)&&(r.add(u),s.push(u))}))}return r},hV=1,pV={nodeSizes:{sample:8,root:6,other:5},edgeThickness:1,temporalSpacingMode:"equal"},mV=D.forwardRef(({filename:t,max_samples:e=25},n)=>{var br,Ft,zt,kn,wr,Jn;const{colors:r}=bt(),{treeSequence:i}=ia(),[s,o]=D.useState(null),[l,u]=D.useState(null),[d,h]=D.useState(null),[g,_]=D.useState(!0),[x,w]=D.useState("full"),[S,b]=D.useState(null),[T,A]=D.useState([0,0]),[R,E]=D.useState(0),[C,O]=D.useState(!1),[P,k]=D.useState([0,0]),[I,N]=D.useState(!1),[B,V]=D.useState(!1),[Z,j]=D.useState("genomic"),[Y,$]=D.useState([0,0]),[Q,oe]=D.useState([0,0]),[K,L]=D.useState(!1),[W,fe]=D.useState([]),[se,z]=D.useState(!1),[X,J]=D.useState("degree"),[pe,xe]=D.useState(!0),[Ae,Ne]=D.useState({sample:8,root:6,other:5}),[be,we]=D.useState(hV),[ke,Xe]=D.useState(!1),[Le,Kt]=D.useState(pV),[Ie,nn]=D.useState(!1),ot=D.useCallback(Te=>Te.map(([lt,Ct,rt])=>({index:lt,left:Ct,right:rt})),[]);D.useEffect(()=>{se&&Z==="genomic"&&N(!0);const Te=setTimeout(()=>{k(T),N(!1)},500);return()=>clearTimeout(Te)},[T,se,Z]),D.useEffect(()=>{se&&Z==="tree"&&L(!0);const Te=setTimeout(()=>{oe(Y),L(!1)},500);return()=>clearTimeout(Te)},[Y,se,Z]),D.useEffect(()=>{const Te=async()=>{try{_(!0),console.log("Fetching initial graph data for file:",t,"with max_samples:",e);const Ct=(await et.getGraphData(t,{maxSamples:e,sampleOrder:X})).data;if(console.log("Received initial graph data:",Ct),Ct.metadata.sequence_length){E(Ct.metadata.sequence_length);const rt=[0,Ct.metadata.sequence_length];A(rt),k(rt)}if(Ct.metadata.tree_intervals&&Ct.metadata.tree_intervals.length>0){const rt=ot(Ct.metadata.tree_intervals);fe(rt);const wt=[0,rt.length-1];$(wt),oe(wt)}V(!0),o(Ct),u(Ct),h(null)}catch(lt){console.error("Error fetching initial graph data:",lt),h(lt instanceof Error?lt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}};V(!1),z(!1),Te()},[t,e,ot]),D.useEffect(()=>{if(!B)return;let Te=!1,lt=null,Ct=null;if(se&&(Z==="genomic"?P[0]===0&&P[1]===R||(Te=!0,lt={genomic_start:P[0],genomic_end:P[1]}):Z==="tree"&&!(Q[0]===0&&Q[1]===W.length-1)&&W.length>0&&(Te=!0,Ct={tree_start_idx:Q[0],tree_end_idx:Q[1]})),!Te)if(!s||s.metadata.sample_order!==X)Te=!0,console.log("Making API call due to sample order change");else{console.log("Skipping API call - using existing data (full range or filter disabled)");return}(async()=>{try{_(!0);let wt={maxSamples:e,sampleOrder:X};lt?(console.log("Fetching filtered graph data for genomic range:",P),wt.genomicStart=lt.genomic_start,wt.genomicEnd=lt.genomic_end):Ct?(console.log("Fetching filtered graph data for tree range:",Q),wt.treeStartIdx=Ct.tree_start_idx,wt.treeEndIdx=Ct.tree_end_idx):console.log("Fetching unfiltered graph data");const Vo=(await et.getGraphData(t,wt)).data;console.log("Received graph data:",Vo),o(Vo),h(null)}catch(wt){console.error("Error fetching graph data:",wt),h(wt instanceof Error?wt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}})()},[t,e,P,Q,se,Z,B,R,W,X]),D.useEffect(()=>{se||xe(!0)},[se]);const pt=()=>{if(!s||!S)return s;switch(x){case"subgraph":{const Te=fV(S,s.nodes,s.edges);Te.add(S.id);const lt=s.nodes.filter(rt=>Te.has(rt.id)),Ct=s.edges.filter(rt=>{const wt=typeof rt.source=="number"?rt.source:rt.source.id,ma=typeof rt.target=="number"?rt.target:rt.target.id;return Te.has(wt)&&Te.has(ma)});return{...s,nodes:lt,edges:Ct,metadata:{...s.metadata,is_subset:!0}}}case"ancestors":{const Te=dV(S,s.nodes,s.edges);Te.add(S.id);const lt=s.nodes.filter(rt=>Te.has(rt.id)),Ct=s.edges.filter(rt=>{const wt=typeof rt.source=="number"?rt.source:rt.source.id,ma=typeof rt.target=="number"?rt.target:rt.target.id;return Te.has(wt)&&Te.has(ma)});return{...s,nodes:lt,edges:Ct,metadata:{...s.metadata,is_subset:!0}}}default:return s}},Mt=()=>{if(!l||!s||!i)return null;const Te=pt();return Te?{originalNodes:s.metadata.original_num_nodes||i.num_nodes,originalEdges:s.metadata.original_num_edges||i.num_edges,subArgNodes:l.nodes.length,subArgEdges:l.edges.length,displayedNodes:Te.nodes.length,displayedEdges:Te.edges.length}:null},rn=Te=>{x==="full"?(b(Te),w("subgraph")):(S==null?void 0:S.id)===Te.id?(w("full"),b(null)):(b(Te),w("subgraph"))},Ge=Te=>{b(Te),w("ancestors")},Se=Te=>{console.log("Edge clicked:",Te)},Me=()=>{w("full"),b(null)},nt=D.useCallback(Te=>{(Te[0]!==T[0]||Te[1]!==T[1])&&A(Te)},[T]),qe=D.useCallback(Te=>{(Te[0]!==Y[0]||Te[1]!==Y[1])&&$(Te)},[Y]),Ze=D.useCallback(()=>{const Te=!se;if(z(Te),Te){if(Z==="genomic")A([0,R]),k([0,R]);else if(Z==="tree"&&W.length>0){const lt=[0,W.length-1];$(lt),oe(lt)}xe(!1)}else xe(!0)},[se,Z,R,W]),yt=D.useCallback(Te=>{if(j(Te),Te==="genomic")A([0,R]),k([0,R]);else if(Te==="tree"&&W.length>0){const lt=[0,W.length-1];$(lt),oe(lt)}},[R,W]),mn=D.useCallback(Te=>Te>=1e6?`${(Te/1e6).toFixed(1)}M`:Te>=1e3?`${(Te/1e3).toFixed(1)}K`:Te.toString(),[]),ei=()=>{let Te="";switch(x){case"subgraph":Te=`SubARG at Root ${S==null?void 0:S.id}`;break;case"ancestors":Te=`Parent ARG of Node ${S==null?void 0:S.id}`;break;default:Te="Full ARG"}return se&&(s==null?void 0:s.metadata.genomic_start)!==void 0&&(s==null?void 0:s.metadata.genomic_end)!==void 0&&(Te+=` (${mn(s.metadata.genomic_start)} - ${mn(s.metadata.genomic_end)})`),Te};return g?p.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:r.accentPrimary}}),p.jsx("p",{style:{color:r.text},children:"Loading force-directed ARG visualization..."})]})}):d?p.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:p.jsxs("div",{className:"text-center",style:{color:r.text},children:[p.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),p.jsx("p",{className:"text-sm",style:{color:`${r.text}B3`},children:d})]})}):p.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:r.background},children:[p.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:p.jsx("div",{className:"px-4 py-2",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"flex flex-col gap-2",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("h2",{className:"text-lg font-semibold",style:{color:r.headerText},children:ei()}),(R>0||W.length>0)&&p.jsx("div",{className:"flex items-center gap-4",children:R>0&&p.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:r.headerText},children:[p.jsx("input",{type:"checkbox",checked:se,onChange:Ze,className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:r.accentPrimary}}),"Filter Genomic Range"]})}),x!=="full"&&p.jsx("button",{onClick:Me,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:r.containerBackground,color:r.text,borderColor:`${r.accentPrimary}33`},onMouseEnter:Te=>{Te.currentTarget.style.borderColor=`${r.accentPrimary}66`,Te.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:Te=>{Te.currentTarget.style.borderColor=`${r.accentPrimary}33`,Te.currentTarget.style.backgroundColor=r.containerBackground},children:"Return to Full ARG"})]})}),p.jsxs("div",{className:"flex items-center gap-6",children:[se&&p.jsxs("button",{onClick:()=>xe(!pe),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:r.accentPrimary,color:r.background},onMouseEnter:Te=>{Te.currentTarget.style.opacity="0.8"},onMouseLeave:Te=>{Te.currentTarget.style.opacity="1"},children:[p.jsx("span",{children:pe?"Show Controls":"Hide Controls"}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:r.headerText},children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${r.nodeSample[0]}, ${r.nodeSample[1]}, ${r.nodeSample[2]})`,borderColor:r.background,borderWidth:"0.5px"}}),p.jsx("span",{children:"Sample"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeDefault[0]}, ${r.nodeDefault[1]}, ${r.nodeDefault[2]})`}}),p.jsx("span",{children:"Internal"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeCombined[0]}, ${r.nodeCombined[1]}, ${r.nodeCombined[2]})`}}),p.jsx("span",{children:"Combined"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${r.nodeRoot[0]}, ${r.nodeRoot[1]}, ${r.nodeRoot[2]})`,borderColor:`rgb(${r.nodeSelected[0]}, ${r.nodeSelected[1]}, ${r.nodeSelected[2]})`}}),p.jsx("span",{children:"Root"})]})]}),p.jsx("div",{className:"text-xs border-l pl-4",style:{color:r.headerText,borderLeftColor:r.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})})}),se&&p.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:!pe&&p.jsx("div",{className:"px-4 py-3",children:p.jsxs("div",{className:"flex items-start justify-between gap-6",children:[p.jsx("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:W.length>0&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Genomic Mode:"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:[p.jsx("button",{onClick:()=>yt("genomic"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="genomic"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="genomic"?r.accentPrimary:r.containerBackground,color:Z==="genomic"?r.background:r.text},children:"Genomic"}),p.jsx("button",{onClick:()=>yt("tree"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="tree"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="tree"?r.accentPrimary:r.containerBackground,color:Z==="tree"?r.background:r.text},children:"Tree Index"})]})]})}),p.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[p.jsx("div",{className:"flex-1 max-w-md min-w-0",children:Z==="genomic"&&R>0?p.jsx(qO,{min:0,max:R,step:Math.max(1,Math.floor(R/1e3)),value:T,onChange:nt,formatValue:mn,className:"w-full"}):Z==="tree"&&W.length>0?p.jsx(HO,{treeIntervals:W,value:Y,onChange:qe,className:"w-full"}):null}),p.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:r.text},children:[Z==="genomic"?p.jsxs("span",{children:[mn(T[1]-T[0])," bp (",((T[1]-T[0])/R*100).toFixed(1),"%)",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&p.jsxs(p.Fragment,{children:["  ",s.metadata.num_local_trees," trees"]})]}):Z==="tree"&&W.length>0?p.jsxs("span",{children:["Trees ",Y[0],"-",Y[1]," (",Y[1]-Y[0]+1," of ",W.length,")",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&p.jsxs(p.Fragment,{children:["  ",s.metadata.expected_tree_count??s.metadata.num_local_trees," displayed"]}),(s==null?void 0:s.metadata.tree_count_mismatch)&&p.jsxs(p.Fragment,{children:["  (actual: ",s.metadata.num_local_trees,")"]})]}):null,g&&p.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:r.accentPrimary}})]})]})]})})}),p.jsx("div",{className:"flex-1 overflow-hidden",children:p.jsxs("div",{className:"w-full h-full relative",children:[p.jsx(aV,{ref:n,data:pt(),onNodeClick:rn,onNodeRightClick:Ge,onEdgeClick:Se,focalNode:S,nodeSizes:Ae,sampleOrder:X,edgeThickness:be,temporalSpacingMode:Le.temporalSpacingMode}),p.jsx(uV,{sampleOrder:X,onSampleOrderChange:J,nodeSizes:Ae,onNodeSizeChange:Te=>Ne(Te),edgeThickness:be,onEdgeThicknessChange:Te=>we(Te),temporalSpacingMode:Le.temporalSpacingMode,onTemporalSpacingModeChange:Te=>Kt(lt=>({...lt,temporalSpacingMode:Te})),isLoading:Ie}),p.jsx(oV,{originalNodeCount:(br=Mt())==null?void 0:br.originalNodes,originalEdgeCount:(Ft=Mt())==null?void 0:Ft.originalEdges,subargNodeCount:(zt=Mt())==null?void 0:zt.subArgNodes,subargEdgeCount:(kn=Mt())==null?void 0:kn.subArgEdges,displayedNodeCount:(wr=Mt())==null?void 0:wr.displayedNodes,displayedEdgeCount:(Jn=Mt())==null?void 0:Jn.displayedEdges,genomicRange:se?T:void 0,sequenceLength:R,isFiltered:se,isFilterSectionCollapsed:pe})]})})]})});function gV(t){const e=t.querySelectorAll("circle, line, path, text, rect, ellipse, polygon, polyline");let n=1/0,r=-1/0,i=1/0,s=-1/0;if(e.forEach(u=>{try{const d=u.getBBox();d.width>0&&d.height>0&&(n=Math.min(n,d.x),r=Math.max(r,d.x+d.width),i=Math.min(i,d.y),s=Math.max(s,d.y+d.height))}catch(d){console.warn("Could not get bounding box for element:",u,d)}}),n===1/0){const u=t.viewBox.baseVal;n=u.x,i=u.y,r=u.x+u.width,s=u.y+u.height}const o=r-n,l=s-i;return{minX:n,maxX:r,minY:i,maxY:s,width:o,height:l,centerX:n+o/2,centerY:i+l/2}}async function _V(t,e){const{filename:n,padding:r=50,maxWidth:i=8192,maxHeight:s=8192,backgroundColor:o="#03303E",scale:l=3,watermark:u}=e;try{const d=gV(t),h=d.width+r*2,g=d.height+r*2,_=Math.min(i/h,s/g),x=Math.min(l,_),w=Math.round(h*x),S=Math.round(g*x),b=t.cloneNode(!0);b.removeAttribute("transform");const T=d.minX-r,A=d.minY-r;b.setAttribute("viewBox",`${T} ${A} ${h} ${g}`),b.setAttribute("width",w.toString()),b.setAttribute("height",S.toString()),b.setAttribute("shape-rendering","geometricPrecision"),b.setAttribute("text-rendering","geometricPrecision"),b.setAttribute("xmlns","http://www.w3.org/2000/svg"),b.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const R=document.createElementNS("http://www.w3.org/2000/svg","rect");R.setAttribute("x",T.toString()),R.setAttribute("y",A.toString()),R.setAttribute("width",h.toString()),R.setAttribute("height",g.toString()),R.setAttribute("fill",o),R.setAttribute("stroke","none"),b.insertBefore(R,b.firstChild),b.querySelectorAll("*").forEach(V=>{const Z=window.getComputedStyle(V),j=V.getAttribute("style")||"";["fill","stroke","stroke-width","stroke-opacity","fill-opacity","opacity"].forEach($=>{const Q=$.replace(/([A-Z])/g,"-$1").toLowerCase(),oe=Z.getPropertyValue(Q);oe&&oe!=="none"&&!V.hasAttribute(Q)&&V.setAttribute(Q,oe)})});const C=new XMLSerializer().serializeToString(b),O=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),P=URL.createObjectURL(O),k=document.createElement("canvas");k.width=w,k.height=S;const I=k.getContext("2d",{alpha:!1});if(!I)throw new Error("Could not get canvas context");I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",I.fillStyle=o,I.fillRect(0,0,w,S);const N=new Image,B=setTimeout(()=>{throw URL.revokeObjectURL(P),new Error("SVG loading timed out")},1e4);N.onload=()=>{clearTimeout(B);try{I.fillStyle=o,I.fillRect(0,0,w,S),I.globalCompositeOperation="source-over",I.drawImage(N,0,0,w,S),u&&F1(I,w,S,u),k.toBlob(V=>{if(!V)throw new Error("Failed to create image blob");U1(V,n)},"image/png",1),URL.revokeObjectURL(P)}catch(V){throw URL.revokeObjectURL(P),new Error(`Failed to draw SVG to canvas: ${V}`)}},N.onerror=V=>{throw clearTimeout(B),URL.revokeObjectURL(P),new Error(`Failed to load SVG image: ${V}`)},N.crossOrigin="anonymous",N.src=P}catch(d){throw console.error("Error exporting SVG image:",d),d}}async function WO(t,e,n){var h,g,_,x;const{filename:r,padding:i=50,maxWidth:s=4096,maxHeight:o=4096,backgroundColor:l="#03303E",scale:u=2,watermark:d}=n;try{if(!e.current||!t.nodes.length)throw new Error("No 3D visualization data available for export");const{bounds:w,currentViewState:S}=t,b=(w.minX+w.maxX)/2,T=(w.minY+w.maxY)/2,A=(w.minZ+w.maxZ)/2,R=w.maxX-w.minX,E=w.maxY-w.minY,C=w.maxZ-w.minZ,O=Math.max(R,E,C),k=Math.max(.1,Math.min(3,1/(O*1.3)));let I=null;if((g=(h=e.current)==null?void 0:h.deck)!=null&&g.canvas)I=e.current.deck.canvas;else if((_=e.current)!=null&&_.canvas)I=e.current.canvas;else{const oe=((x=e.current)==null?void 0:x.domElement)||e.current;oe&&(I=oe.querySelector("canvas"))}if(!I)throw new Error("Could not access DeckGL canvas - trying fallback method");const N={...S},B={...S,target:[b,T,A],zoom:k},V=I.width/I.height;let Z=Math.min(s,2048*u),j=Math.min(o,Z/V);j>o&&(j=o,Z=j*V),Z=Math.round(Z),j=Math.round(j);const Y=I.width,$=I.height,Q={width:I.style.width,height:I.style.height};try{I.width=Z,I.height=j,I.style.width=`${Z}px`,I.style.height=`${j}px`,e.current.setProps({width:Z,height:j,viewState:B}),await new Promise(L=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(L,200)})})});const oe=document.createElement("canvas");oe.width=Z,oe.height=j;const K=oe.getContext("2d");if(!K)throw new Error("Could not get export canvas context");K.imageSmoothingEnabled=!0,K.imageSmoothingQuality="high",K.fillStyle=l,K.fillRect(0,0,Z,j),K.drawImage(I,0,0),d&&F1(K,Z,j,d),oe.toBlob(L=>{if(!L)throw new Error("Failed to create image blob");U1(L,r)},"image/png",1)}finally{I.width=Y,I.height=$,I.style.width=Q.width,I.style.height=Q.height,e.current.setProps({width:Y,height:$,viewState:N}),await new Promise(oe=>{requestAnimationFrame(()=>{requestAnimationFrame(oe)})})}}catch(w){throw console.error("Error exporting 3D visualization image:",w),w}}async function XO(t,e){const{filename:n,padding:r=50,maxWidth:i=4096,maxHeight:s=4096,backgroundColor:o="#03303E",scale:l=2,watermark:u}=e;try{await new Promise(x=>requestAnimationFrame(x));const d=Math.min(i,t.width*l),h=Math.min(s,t.height*l),g=document.createElement("canvas");g.width=d,g.height=h;const _=g.getContext("2d");if(!_)throw new Error("Could not get canvas context");_.imageSmoothingEnabled=!0,_.imageSmoothingQuality="high",_.fillStyle=o,_.fillRect(0,0,d,h),_.drawImage(t,0,0,d,h),u&&F1(_,d,h,u),g.toBlob(x=>{if(!x)throw new Error("Failed to create image blob");U1(x,n)},"image/png",1)}catch(d){throw console.error("Error exporting canvas image:",d),d}}function U1(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function F1(t,e,n,r){const{text:i,subtext:s,position:o="bottom-right",color:l="#14E2A8",backgroundColor:u="rgba(3, 48, 62, 0.8)",fontSize:d=24,fontFamily:h="Arial, sans-serif",opacity:g=.9}=r;t.save(),t.globalAlpha=g,t.font=`bold ${d}px ${h}`,t.textAlign="left",t.textBaseline="top";const _=t.measureText(i),x=s?t.measureText(s):{width:0},w=Math.max(_.width,x.width),S=d,b=4,T=s?S*2+b:S,A=16,R=12,E=w+A*2,C=T+R*2;let O,P;const k=20;switch(o){case"top-left":O=k,P=k;break;case"top-right":O=e-E-k,P=k;break;case"bottom-left":O=k,P=n-C-k;break;case"bottom-right":O=e-E-k,P=n-C-k;break;case"top-center":O=(e-E)/2,P=k;break;case"bottom-center":default:O=(e-E)/2,P=n-C-k;break}t.fillStyle=u,t.beginPath(),t.roundRect?t.roundRect(O,P,E,C,6):t.rect(O,P,E,C),t.fill(),t.fillStyle=l,t.fillText(i,O+A,P+R),s&&(t.font=`${Math.round(d*.7)}px ${h}`,t.fillStyle=l,t.fillText(s,O+A,P+R+S+b)),t.restore()}const ph=(t,e)=>{const n=u=>{let d=u.replace("#","");if(d.length===3&&(d=d.split("").map(w=>w+w).join("")),d.length!==6)return console.warn("Invalid hex color:",u),0;const h=parseInt(d.substr(0,2),16)/255,g=parseInt(d.substr(2,2),16)/255,_=parseInt(d.substr(4,2),16)/255,x=w=>w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4);return .2126*x(h)+.7152*x(g)+.0722*x(_)};if(!t||!e)return console.warn("Missing colors for contrast check:",{color1:t,color2:e}),21;const r=n(t),i=n(e),s=Math.max(r,i),o=Math.min(r,i),l=(s+.05)/(o+.05);return t.toLowerCase()==="#ffffff"&&e.toLowerCase()==="#ffffff"&&console.log("White/white contrast check:",{color1:t,color2:e,lum1:r,lum2:i,ratio:l}),l},vV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&ph(e,r)<3;return p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),i&&p.jsxs("div",{className:"relative group",children:[p.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),p.jsx("input",{id:`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),p.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]})]})},xV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=pI(e),s=e[3],o=d=>{const h=dI(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&ph(i,r)<3;return p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),u&&p.jsxs("div",{className:"relative group",children:[p.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),p.jsx("input",{id:`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),p.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-xs text-sp-white/70 flex-shrink-0",children:"Opacity:"}),p.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"flex-1 min-w-0"}),p.jsxs("span",{className:"text-xs text-sp-white/70 w-10 text-right flex-shrink-0",children:[Math.round(s/255*100),"%"]})]})]})},yV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=pI(e),s=e[3],o=d=>{const h=dI(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&ph(i,r)<3;return p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),u&&p.jsxs("div",{className:"relative group",children:[p.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),p.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),p.jsx("div",{className:"flex-1",children:p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-xs text-sp-white/70",children:"Opacity:"}),p.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"w-20"}),p.jsxs("span",{className:"text-xs text-sp-white/70 w-8 text-right",children:[Math.round(s/255*100),"%"]})]})]})})]})]})},bV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&ph(e,r)<3;return p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),i&&p.jsxs("div",{className:"relative group",children:[p.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),p.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),p.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),p.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"})]})]})},wV=({isOpen:t,onClose:e,editingTheme:n})=>{const{saveCustomTheme:r,updateCustomTheme:i,currentVisualizationType:s}=bt(),[o,l]=D.useState(""),[u,d]=D.useState(!1),[h,g]=D.useState(()=>{const k=[96,160,183,255],I=[153,153,153,102],N=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];return{background:"#03303E",containerBackground:"#0f1419",nodeDefault:k,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:k,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"}});D.useEffect(()=>{if(n)l(n.name),g(n.colors);else{l("");const k=[96,160,183,255],I=[153,153,153,102],N=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];g({background:"#03303E",containerBackground:"#0f1419",nodeDefault:k,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:k,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"})}},[n,t]),D.useEffect(()=>{const k=I=>{I.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",k),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",k),document.body.style.overflow="unset"}},[t,e]);const _=()=>{if(!o.trim()){alert("Please enter a theme name");return}n?i(n.id,o.trim(),h):r(o.trim(),h),e()},x=k=>I=>{g(N=>({...N,[k]:I}))},w=k=>I=>{g(N=>({...N,[k]:I}))},S=k=>{const I=k.replace("#",""),N=parseInt(I.substr(0,2),16),B=parseInt(I.substr(2,2),16),V=parseInt(I.substr(4,2),16);return(.299*N+.587*B+.114*V)/255>.5?"#000000":"#ffffff"},b=k=>{const I=S(k);g(N=>({...N,background:k,headerText:I,controlPanelText:I,buttonText:I,text:I}))},T=k=>{const I=[Math.min(255,Math.round(k[0]*1.5)),Math.min(255,Math.round(k[1]*1.5)),Math.min(255,Math.round(k[2]*1.5)),Math.min(255,Math.round(k[3]*1.3))];g(N=>({...N,edgeDefault:k,edgeHighlight:I}))},A=k=>{g(I=>({...I,nodeDefault:k,nodeCombined:k}))},R=hI(s),E=g5(s),C=k=>k==="nodeDefault"?A:k==="edgeDefault"?T:x(k),O=k=>({background:"Visualization Background",containerBackground:"Container Background",nodeDefault:"Internal Nodes (combined nodes will match)",nodeRoot:"Root Nodes",nodeSample:"Sample Nodes",nodeCombined:"Combined Nodes",nodeSelected:"Selected Nodes",edgeDefault:"Edges (highlighted edges will be auto-brightened)",edgeHighlight:"Highlighted Edges",text:"Primary Text",textSecondary:"Secondary Text",border:"Borders",exportBackground:"Export Background",accentPrimary:"Primary Accent",accentSecondary:"Secondary Accent",geographicGrid:"Geographic Shapes & Grid",temporalGrid:"Temporal Grid Lines",tooltipBackground:"Tooltip Background",tooltipText:"Tooltip Text",headerText:"Header Text",controlPanelText:"Control Panel Text",buttonText:"Button Text"})[k]||k,P=k=>{const I=h[k];return typeof I=="string"?p.jsx(bV,{label:O(k),value:I,onChange:k==="background"?b:w(k),backgroundColor:k==="tooltipText"?h.tooltipBackground:void 0},k):p.jsx(yV,{label:O(k),value:I,onChange:C(k),backgroundColor:h.background},k)};return t?p.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[p.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),p.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden transform transition-all",children:p.jsxs("div",{className:"p-6 overflow-y-auto max-h-[85vh] overflow-x-hidden",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[p.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-sp-pale-green/10",children:p.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})})}),p.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:n?"Edit Custom Theme":"Create Custom Theme"})]}),p.jsxs("div",{className:"mb-6",children:[p.jsx("label",{className:"block text-sm font-medium text-sp-white mb-2",children:"Theme Name"}),p.jsx("input",{type:"text",value:o,onChange:k=>l(k.target.value),className:"w-full px-3 py-2 rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"Enter theme name...",maxLength:50})]}),p.jsxs("div",{className:"space-y-4 mb-6",children:[p.jsx("h4",{className:"text-base font-semibold text-sp-pale-green",children:"Main Colors"}),R.map(k=>P(k))]}),p.jsxs("div",{className:"space-y-4 mb-6",children:[p.jsxs("button",{onClick:()=>d(!u),className:"flex items-center gap-2 text-base font-semibold text-sp-pale-green hover:text-sp-very-pale-green transition-colors",children:[p.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Other Colors"]}),u&&p.jsx("div",{className:"space-y-6 pl-6 border-l-2 border-sp-pale-green/20",children:p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 min-w-0",children:E.map(k=>{try{const I=h[k];return I?typeof I=="string"?p.jsx(vV,{label:O(k),value:I,onChange:w(k),backgroundColor:k==="tooltipText"?h.tooltipBackground:h.background},k):p.jsx(xV,{label:O(k),value:I,onChange:x(k),backgroundColor:h.background},k):null}catch(I){return console.warn(`Error rendering color picker for ${k}:`,I),null}})})})]}),p.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-sp-pale-green/20 bg-sp-dark-blue/20",children:[p.jsx("h4",{className:"text-sm font-semibold text-sp-pale-green mb-3",children:"Preview"}),p.jsxs("div",{className:"p-4 rounded border text-sm",style:{backgroundColor:h.background,borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`,color:h.text},children:[p.jsx("div",{style:{color:h.headerText},className:"font-semibold mb-2",children:"3D ARG Visualization"}),p.jsx("div",{style:{color:h.controlPanelText},className:"mb-3",children:"Control panel text sample"}),p.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:h.background}}),p.jsx("span",{className:"text-xs",children:"Background"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:`rgba(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]}, ${h.nodeSample[3]/255})`,borderColor:h.background}}),p.jsx("span",{className:"text-xs",children:"Sample"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]}, ${h.nodeRoot[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Root"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]}, ${h.nodeDefault[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Internal"})]})]}),p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeDefault[0]}, ${h.edgeDefault[1]}, ${h.edgeDefault[2]}, ${h.edgeDefault[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Edges"}),p.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeHighlight[0]}, ${h.edgeHighlight[1]}, ${h.edgeHighlight[2]}, ${h.edgeHighlight[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Highlighted"})]}),p.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[p.jsx("div",{className:"w-6 h-6 border-2 rounded",style:{borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Geographic Grid"}),p.jsx("div",{className:"w-6 h-1 rounded",style:{backgroundColor:`rgba(${h.temporalGrid[0]}, ${h.temporalGrid[1]}, ${h.temporalGrid[2]}, ${h.temporalGrid[3]/255})`}}),p.jsx("span",{className:"text-xs",children:"Temporal Grid"})]}),p.jsx("div",{className:"text-xs inline-block px-2 py-1 rounded",style:{color:h.tooltipText,backgroundColor:h.tooltipBackground,border:`1px solid rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, 0.3)`},children:"Sample tooltip text"})]})]}),p.jsxs("div",{className:"flex gap-3 mt-6",children:[p.jsx("button",{onClick:e,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:"Cancel"}),p.jsx("button",{onClick:_,disabled:!o.trim(),className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-4 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Update Theme":"Save Theme"})]})]})})]}):null},xk=[{value:"tskit",label:"tskit",icon:""},{value:"grayscale",label:"B&W",icon:""},{value:"custom",label:"Custom",icon:""}],z1=()=>{const{theme:t,setTheme:e,colors:n,customThemes:r,selectedCustomTheme:i,setSelectedCustomTheme:s,deleteCustomTheme:o}=bt(),[l,u]=D.useState(!1),[d,h]=D.useState(!1),[g,_]=D.useState(null),[x,w]=D.useState({isOpen:!1,themeId:"",themeName:""}),S=D.useRef(null),b=xk.find(N=>N.value===t),T=t==="custom"&&i?r.find(N=>N.id===i):null;D.useEffect(()=>{const N=B=>{S.current&&!S.current.contains(B.target)&&u(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[]);const A=N=>{N==="custom"?r.length===0?(h(!0),_(null)):(e("custom"),i||s(r[0].id)):e(N),u(!1)},R=N=>{e("custom"),s(N),u(!1)},E=()=>{_(null),h(!0),u(!1)},C=N=>{const B=r.find(V=>V.id===N);B&&(_(B),h(!0)),u(!1)},O=N=>{const B=r.find(V=>V.id===N);B&&w({isOpen:!0,themeId:N,themeName:B.name}),u(!1)},P=()=>{o(x.themeId),w({isOpen:!1,themeId:"",themeName:""}),i===x.themeId&&r.length<=1&&e("tskit")},k=()=>t==="custom"&&T?T.name.length>12?`${T.name.slice(0,12)}...`:T.name:(b==null?void 0:b.label)||"Custom",I=()=>t==="custom"?"":(b==null?void 0:b.icon)||"";return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"relative",ref:S,children:[p.jsxs("button",{className:"font-medium px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1",style:{backgroundColor:n.containerBackground,color:n.text,border:`1px solid ${n.border}`},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor=n.containerBackground},onClick:()=>u(!l),title:"Select color theme",children:[I()," ",k(),p.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&p.jsxs("div",{className:"absolute right-0 mt-1 py-1 rounded-md shadow-lg z-50 min-w-[160px] max-w-[250px]",style:{backgroundColor:n.containerBackground,border:`1px solid ${n.border}`},children:[xk.filter(N=>N.value!=="custom").map(N=>p.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:t===N.value?n.textSecondary:n.text,backgroundColor:t===N.value?n.border:"transparent"},onMouseEnter:B=>{t!==N.value&&(B.currentTarget.style.backgroundColor=n.border)},onMouseLeave:B=>{t!==N.value&&(B.currentTarget.style.backgroundColor="transparent")},onClick:()=>A(N.value),children:[N.icon," ",N.label,t===N.value&&p.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},N.value)),p.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),p.jsx("div",{className:"px-3 py-1",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("span",{className:"text-xs font-medium",style:{color:n.textSecondary},children:"Custom Themes"}),p.jsx("button",{onClick:E,className:"text-xs hover:underline",style:{color:n.textSecondary},title:"Create new custom theme",children:"+ New"})]})}),r.length===0?p.jsx("div",{className:"px-3 py-2 text-xs",style:{color:n.text+"80"},children:"No custom themes yet"}):r.map(N=>p.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors group",style:{backgroundColor:t==="custom"&&i===N.id?n.border:"transparent"},onMouseEnter:B=>{t==="custom"&&i===N.id||(B.currentTarget.style.backgroundColor=n.border)},onMouseLeave:B=>{t==="custom"&&i===N.id||(B.currentTarget.style.backgroundColor="transparent")},children:[p.jsxs("button",{onClick:()=>R(N.id),className:"flex-1 text-left flex items-center gap-2 min-w-0",style:{color:t==="custom"&&i===N.id?n.textSecondary:n.text},children:["",p.jsx("span",{className:"truncate",children:N.name}),t==="custom"&&i===N.id&&p.jsx("svg",{className:"w-4 h-4 ml-auto flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),p.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[p.jsx("button",{onClick:()=>C(N.id),className:"p-1 rounded hover:bg-opacity-20",style:{color:n.textSecondary},title:"Edit theme",children:p.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),p.jsx("button",{onClick:()=>O(N.id),className:"p-1 rounded hover:bg-red-500 hover:bg-opacity-20",style:{color:"#ef4444"},title:"Delete theme",children:p.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},N.id)),r.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),p.jsx("button",{onClick:E,className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:n.textSecondary},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor="transparent"},children:" Create New Theme"})]})]})]}),p.jsx(wV,{isOpen:d,onClose:()=>{h(!1),_(null)},editingTheme:g}),p.jsx(mI,{isOpen:x.isOpen,title:"Delete Custom Theme",message:`Are you sure you want to delete the custom theme "${x.themeName}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",cancelText:"Cancel",onConfirm:P,onCancel:()=>w({isOpen:!1,themeId:"",themeName:""})})]})};function SV(){const{filename:t}=f1(),e=_r(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=ia(),{colors:s,setCurrentVisualizationType:o}=bt(),l=D.useRef(null),[u,d]=D.useState(!1);if(D.useEffect(()=>{o("force-directed")},[o]),!t)return p.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",style:{backgroundColor:s.background,color:s.text},children:[p.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),p.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4 transition-colors",onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=x=>{Re.user.action("switch-tree-sequence-force-directed",{treeSequence:x},"ArgVisualizationPage"),i(x),d(!1),e(`/visualize/${encodeURIComponent(x.filename)}`)},_=async()=>{const x=l.current;if(x)try{const w=`${h.replace(/\.(trees|tsz)$/,"")}_arg.png`;await _V(x,{filename:w,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:3,watermark:{text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"}}),console.log("High-resolution ARG image downloaded successfully")}catch(w){console.error("Error downloading ARG image:",w)}};return p.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[p.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[p.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:x=>{x.currentTarget.style.color=`${s.accentPrimary}CC`},onMouseLeave:x=>{x.currentTarget.style.color=s.accentPrimary},onClick:()=>e("/result"),children:[p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),p.jsx(sa,{size:"medium"})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[p.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"ARG Visualization"}),p.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),p.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[p.jsx(z1,{}),p.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:x=>{x.currentTarget.style.borderColor=`${s.accentPrimary}66`,x.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:x=>{x.currentTarget.style.borderColor=`${s.accentPrimary}33`,x.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),p.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:x=>{x.currentTarget.style.backgroundColor=s.accentPrimary,x.currentTarget.style.color=s.background},onMouseLeave:x=>{x.currentTarget.style.backgroundColor=s.containerBackground,x.currentTarget.style.color=s.text},onClick:_,title:"Download ARG visualization as PNG",children:"Download Image"}),r&&p.jsx(bc,{filename:r.filename})]})]})]})}),p.jsx(wc,{isOpen:u,onClose:()=>d(!1),onSelect:g}),p.jsx("main",{className:"flex-1 overflow-hidden",children:D.useMemo(()=>p.jsx(mV,{ref:l,filename:h,max_samples:n}),[h,n])})]})}function TV(){const e=ra().pathname.startsWith("/visualize"),{colors:n,theme:r}=bt(),s=e&&!(e&&r==="custom")?n:null;return p.jsx("footer",{className:`fixed bottom-0 left-0 right-0 py-4 text-center text-sm backdrop-blur-sm border-t z-50 ${e?"":"text-sp-white bg-sp-very-dark-blue/90 border-t-sp-dark-blue/50"}`,style:e&&s?{color:s.text,backgroundColor:s.background+"E6",borderTopColor:s.border+"80"}:{},children:p.jsxs("div",{className:"flex flex-col items-center gap-3",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("p",{children:[" ",new Date().getFullYear()," ",p.jsx("a",{href:"https://chris-a-talbot.com",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-pale-green hover:text-sp-white transition-colors",style:e&&s?{color:s.accentPrimary}:{},children:"Chris Talbot"}),". All rights reserved."]}),p.jsx("a",{href:"https://github.com/chris-a-talbot/argscape",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary}:{},title:"View source on GitHub",children:p.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})})})]}),p.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[p.jsx("span",{className:e?"":"text-sp-white/70",style:e&&s?{color:s.textSecondary,opacity:.7}:{},children:"Resources:"}),p.jsx("a",{href:"https://tskit.dev/",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tskit"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/tskit-dev/tszip",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tszip"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/tskit-dev/tsdate",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tsdate"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://tskit.dev/msprime/docs/stable/intro.html",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"msprime"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/blueraleigh/gaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaia"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/chris-a-talbot/gaiapy",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaiapy"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/chris-a-talbot/fastgaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"fastgaia"}),p.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),p.jsx("a",{href:"https://github.com/osmond-lab/sparg",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"sparg"})]})]})})}const EV="modulepreload",AV=function(t){return"/"+t},yk={},bk=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(d=>{if(d=AV(d),d in yk)return;yk[d]=!0;const h=d.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":EV,h||(_.as="script"),_.crossOrigin="",_.href=d,u&&_.setAttribute("nonce",u),document.head.appendChild(_),h)return new Promise((x,w)=>{_.addEventListener("load",x),_.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};function Gf(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const $1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),wk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wk&&parseFloat(wk[1]);const ff=globalThis,to=globalThis.process||{},RV=globalThis.navigator||{};function YO(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function fa(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||YO()}function CV(t){return fa()?YO()?"Electron":(RV.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const GO="4.1.0";function NV(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class kV{constructor(e,n,r="sessionStorage"){this.storage=NV(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function MV(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function IV(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Kf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Kf||(Kf={}));const OV=10;function Sk(t){return typeof t!="string"?t:(t=t.toUpperCase(),Kf[t]||Kf.WHITE)}function PV(t,e,n){return!fa&&typeof t=="string"&&(e&&(t=`\x1B[${Sk(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Sk(n)+OV}m${t}\x1B[49m`)),t}function DV(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(t)))}}function V1(t,e){if(!t)throw new Error("Assertion failed")}function no(){var e,n,r;let t;if(fa()&&ff.performance)t=(n=(e=ff==null?void 0:ff.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in to){const i=(r=to==null?void 0:to.hrtime)==null?void 0:r.call(to);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const ro={debug:fa()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jV={enabled:!0,level:0};function io(){}const Tk={},Ek={once:!0};class zc{constructor({id:e}={id:""}){this.VERSION=GO,this._startTs=no(),this._deltaTs=no(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new kV(`__probe-${this.id}__`,jV),this.timeStamp(`${this.id} started`),DV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((no()-this._startTs).toPrecision(10))}getDelta(){return Number((no()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ro.warn,arguments,Ek)}error(e){return this._getLogFunction(0,e,ro.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ro.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ro.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ro.debug||ro.info,arguments,Ek)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||io,r&&[r],{tag:BV(n)}):io}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||io)}group(e,n,r={collapsed:!1}){const i=Ak({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||io)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=KO(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=Ak({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,V1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=no();const o=s.tag||s.message;if(s.once&&o)if(!Tk[o])Tk[o]=no();else return io;return n=LV(this.id,s.message,s),r.bind(console,n,...s.args)}return io}}zc.VERSION=GO;function KO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return V1(Number.isFinite(e)&&e>=0),e}function Ak(t){const{logLevel:e,message:n}=t;t.logLevel=KO(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return V1(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function LV(t,e,n){if(typeof e=="string"){const r=n.time?IV(MV(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=PV(e,n.color,n.background)}return e}function BV(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const pb="4.3.2",UV=pb[0]>="0"&&pb[0]<="9"?`v${pb}`:"";function FV(){const t=new zc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=UV,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const zV=FV();function $V(t,e){return ZO(t||{},e)}function ZO(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=ZO(r[i]||{},e[i],n+1):r[i]=e[i];return r}const VV="latest";function qV(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const HV=qV();function hs(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Vs=typeof process!="object"||String(process)!=="[object process]"||process.browser,WV=typeof window<"u"&&typeof window.orientation<"u",Rk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rk&&parseFloat(Rk[1]);class XV{constructor(e,n){U(this,"name");U(this,"workerThread");U(this,"isRunning",!0);U(this,"result");U(this,"_resolve",()=>{});U(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){hs(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){hs(this.isRunning),this.isRunning=!1,this._reject(e)}}class mb{terminate(){}}const gb=new Map;function YV(t){hs(t.source&&!t.url||!t.source&&t.url);let e=gb.get(t.source||t.url);return e||(t.url&&(e=GV(t.url),gb.set(t.url,e)),t.source&&(e=QO(t.source),gb.set(t.source,e))),hs(e),e}function GV(t){if(!t.startsWith("http"))return t;const e=KV(t);return QO(e)}function QO(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function KV(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function JO(t,e=!0,n){const r=n||new Set;if(t){if(Ck(t))r.add(t);else if(Ck(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)JO(t[i],e,r)}}return n===void 0?Array.from(r):[]}function Ck(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const _b=()=>{};class h0{constructor(e){U(this,"name");U(this,"source");U(this,"url");U(this,"terminated",!1);U(this,"worker");U(this,"onMessage");U(this,"onError");U(this,"_loadableURL","");const{name:n,source:r,url:i}=e;hs(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=_b,this.onError=s=>console.log(s),this.worker=Vs?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Vs||typeof mb<"u"&&!Vs}destroy(){this.onMessage=_b,this.onError=_b,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||JO(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=YV({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new mb(r,{eval:!1})}else if(this.source)e=new mb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class ZV{constructor(e){U(this,"name","unnamed");U(this,"source");U(this,"url");U(this,"maxConcurrency",1);U(this,"maxMobileConcurrency",1);U(this,"onDebug",()=>{});U(this,"reuseWorkers",!0);U(this,"props",{});U(this,"jobQueue",[]);U(this,"idleQueue",[]);U(this,"count",0);U(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return h0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new XV(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Vs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new h0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return WV?this.maxMobileConcurrency:this.maxConcurrency}}const QV={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ts=class ts{constructor(e){U(this,"props");U(this,"workerPools",new Map);this.props={...QV},this.setProps(e),this.workerPools=new Map}static isSupported(){return h0.isSupported()}static getWorkerFarm(e={}){return ts._workerFarm=ts._workerFarm||new ts({}),ts._workerFarm.setProps(e),ts._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new ZV({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};U(ts,"_workerFarm");let Zf=ts;function JV(t,e={}){const n=e[t.id]||{},r=Vs?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Vs?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=VV);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return hs(i),i}function eq(t,e=HV){hs(t,"no worker provided");const n=t.version;return!(!e||!n)}function tq(t,e){return!Zf.isSupported()||!Vs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function nq(t,e,n,r,i){const s=t.id,o=JV(t,n),u=Zf.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",rq.bind(null,i));return d.postMessage("process",{input:e,options:n,context:r}),await(await d.result).result}async function rq(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await t(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function iq(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function sq(...t){return aq(t)}function aq(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function oq(t){const e=[];for await(const n of t)e.push(n);return sq(...e)}function Nk(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class kk{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Nk(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Nk()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class mh{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof kk?i=e:i=new kk(n,r),this.stats[n]=i),i}}let lq="";const Mk={};function cq(t){for(const e in Mk)if(t.startsWith(e)){const n=Mk[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${lq}${t}`),t}function uq(t){return t&&typeof t=="object"&&t.isBuffer}function eP(t){if(uq(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function tP(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function fq(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const dq=t=>typeof t=="boolean",oc=t=>typeof t=="function",$c=t=>t!==null&&typeof t=="object",Ik=t=>$c(t)&&t.constructor==={}.constructor,hq=t=>!!t&&typeof t[Symbol.iterator]=="function",pq=t=>t&&typeof t[Symbol.asyncIterator]=="function",da=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ha=t=>typeof Blob<"u"&&t instanceof Blob,mq=t=>t&&typeof t=="object"&&t.isBuffer,gq=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||$c(t)&&oc(t.tee)&&oc(t.cancel)&&oc(t.getReader),_q=t=>$c(t)&&oc(t.read)&&oc(t.pipe)&&dq(t.readable),nP=t=>gq(t)||_q(t);class vq extends Error{constructor(n,r){super(n);U(this,"reason");U(this,"url");U(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const xq=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,yq=/^([-\w.]+\/[-\w.+]+)/;function Ok(t,e){return t.toLowerCase()===e.toLowerCase()}function bq(t){const e=yq.exec(t);return e?e[1]:t}function Pk(t){const e=xq.exec(t);return e?e[1]:""}const rP=/\?.*/;function wq(t){const e=t.match(rP);return e&&e[0]}function q1(t){return t.replace(rP,"")}function Sq(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function gh(t){return da(t)?t.url:ha(t)?t.name||"":typeof t=="string"?t:""}function H1(t){if(da(t)){const e=t,n=e.headers.get("content-type")||"",r=q1(e.url);return bq(n)||Pk(r)}return ha(t)?t.type||"":typeof t=="string"?Pk(t):""}function Tq(t){return da(t)?t.headers["content-length"]||-1:ha(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function iP(t){if(da(t))return t;const e={},n=Tq(t);n>=0&&(e["content-length"]=String(n));const r=gh(t),i=H1(t);i&&(e["content-type"]=i);const s=await Rq(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function Eq(t){if(!t.ok)throw await Aq(t)}async function Aq(t){const e=Sq(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new vq(n,r)}async function Rq(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${Cq(n)}`}return null}function Cq(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function Nq(t){return!kq(t)&&!Mq(t)}function kq(t){return t.startsWith("http:")||t.startsWith("https:")}function Mq(t){return t.startsWith("data:")}async function Dk(t,e){var n,r;if(typeof t=="string"){const i=cq(t);return Nq(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await iP(t)}const jk=new zc({id:"loaders.gl"});class Iq{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Oq{constructor(){U(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const sP={fetch:null,mimeType:void 0,nothrow:!1,log:new Oq,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:$1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Pq={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function aP(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function oP(){const t=aP();return t.globalOptions=t.globalOptions||{...sP},t.globalOptions}function Dq(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],jq(t,n),Bq(e,t,r)}function jq(t,e){Lk(t,null,sP,Pq,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Lk(r,n.id,i,s,e)}}function Lk(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in t){const u=!e&&$c(t[l]),d=l==="baseUri"&&!e,h=l==="workerUrl"&&e;if(!(l in n)&&!d&&!h){if(l in r)jk.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const g=Lq(l,i);jk.warn(`${s} loader option '${o}${l}' not recognized. ${g}`)()}}}}function Lq(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function Bq(t,e,n){const i={...t.options||{}};return Uq(i,n),i.log===null&&(i.log=new Iq),Bk(i,oP()),Bk(i,e),i}function Bk(t,e){for(const n in e)if(n in e){const r=e[n];Ik(r)&&Ik(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Uq(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function W1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function X1(t){Gf(t,"null loader"),Gf(W1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const lP=()=>{const t=aP();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Fq(t){const e=lP();t=Array.isArray(t)?t:[t];for(const n of t){const r=X1(n);e.find(i=>r===i)||e.unshift(r)}}function zq(){return lP()}const $q=/\.([^.]+)$/;async function Vq(t,e=[],n,r){if(!cP(t))return null;let i=Uk(t,e,{...n,nothrow:!0},r);if(i)return i;if(ha(t)&&(t=await t.slice(0,10).arrayBuffer(),i=Uk(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(uP(t));return i}function Uk(t,e=[],n,r){if(!cP(t))return null;if(e&&!Array.isArray(e))return X1(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...zq()),Hq(i);const s=qq(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(uP(t));return s}function qq(t,e,n,r){const i=gh(t),s=H1(t),o=q1(i)||(r==null?void 0:r.url);let l=null,u="";return n!=null&&n.mimeType&&(l=vb(e,n==null?void 0:n.mimeType),u=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),l=l||Wq(e,o),u=u||(l?`matched url ${o}`:""),l=l||vb(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||Yq(e,t),u=u||(l?`matched initial data ${fP(t)}`:""),n!=null&&n.fallbackMimeType&&(l=l||vb(e,n==null?void 0:n.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&zV.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${u}.`),l}function cP(t){return!(t instanceof Response&&t.status===204)}function uP(t){const e=gh(t),n=H1(t);let r="No valid loader found (";r+=e?`${tP(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?fP(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function Hq(t){for(const e of t)X1(e)}function Wq(t,e){const n=e&&$q.exec(e),r=n&&n[1];return r?Xq(t,r):null}function Xq(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function vb(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>Ok(e,i))||Ok(e,`application/x.${r.id}`))return r;return null}function Yq(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(Gq(e,n))return n}else if(ArrayBuffer.isView(e)){if(Fk(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Fk(e,0,n))return n;return null}function Gq(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Fk(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>Kq(t,e,n,i))}function Kq(t,e,n,r){if(r instanceof ArrayBuffer)return iq(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=p0(t,e,r.length);return r===i;default:return!1}}function fP(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?p0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?p0(t,0,e):""}function p0(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const Zq=256*1024;function*Qq(t,e){const n=(e==null?void 0:e.chunkSize)||Zq;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const Jq=256*1024;function*eH(t,e={}){const{chunkSize:n=Jq}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const tH=1024*1024;async function*nH(t,e){const n=(e==null?void 0:e.chunkSize)||tH;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function zk(t,e){return $1?rH(t,e):iH(t)}async function*rH(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield eP(o)}}catch{n.releaseLock()}}async function*iH(t,e){for await(const n of t)yield eP(n)}function sH(t,e){if(typeof t=="string")return Qq(t,e);if(t instanceof ArrayBuffer)return eH(t,e);if(ha(t))return nH(t,e);if(nP(t))return zk(t,e);if(da(t))return zk(t.body,e);throw new Error("makeIterator")}const dP="Cannot convert supplied data type";function aH(t,e,n){if(e.text&&typeof t=="string")return t;if(mq(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(dP)}async function oH(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return aH(t,e);if(ha(t)&&(t=await iP(t)),da(t)){const i=t;return await Eq(i),e.binary?await i.arrayBuffer():await i.text()}if(nP(t)&&(t=sH(t,n)),hq(t)||pq(t))return oq(t);throw new Error(dP)}function hP(t,e){const n=oP(),r=t||n;return typeof r.fetch=="function"?r.fetch:$c(r.fetch)?i=>Dk(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Dk}function lH(t,e,n){if(n)return n;const r={fetch:hP(e,t),...t};if(r.url){const i=q1(r.url);r.baseUrl=i,r.queryString=wq(r.url),r.filename=tP(i),r.baseUrl=fq(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function cH(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Qf(t,e,n,r){e&&!Array.isArray(e)&&!W1(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=gh(t),o=cH(e,r),l=await Vq(t,o,n);return l?(n=Dq(n,l,o,i),r=lH({url:i,_parse:Qf,loaders:o},n,r||null),await uH(l,t,n,r)):null}async function uH(t,e,n,r){if(eq(t),n=$V(t.options,n),da(e)){const s=e,{ok:o,redirected:l,status:u,statusText:d,type:h,url:g}=s,_=Object.fromEntries(s.headers.entries());r.response={headers:_,ok:o,redirected:l,status:u,statusText:d,type:h,url:g}}e=await oH(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(tq(t,n))return await nq(t,e,n,r,Qf);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw hs(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function m0(t,e,n,r){let i,s;!Array.isArray(e)&&!W1(e)?(i=[],s=e):(i=e,s=n);const o=hP(s);let l=t;return typeof t=="string"&&(l=await o(t)),ha(t)&&(l=await o(t)),Array.isArray(i)?await Qf(l,i,s):await Qf(l,i,s)}const fH="4.3.2";var GM;const dH=(GM=globalThis.loaders)==null?void 0:GM.parseImageNode,g0=typeof Image<"u",_0=typeof ImageBitmap<"u",hH=!!dH,v0=$1?!0:hH;function pH(t){switch(t){case"auto":return _0||g0||v0;case"imagebitmap":return _0;case"image":return g0;case"data":return v0;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function mH(){if(_0)return"imagebitmap";if(g0)return"image";if(v0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function gH(t){const e=vH(t);if(!e)throw new Error("Not an image");return e}function _H(t){switch(gH(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function vH(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const xH=/^data:image\/svg\+xml/,yH=/\.svg((\?|#).*)?$/;function Y1(t){return t&&(xH.test(t)||yH.test(t))}function bH(t,e){if(Y1(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return pP(t,e)}function pP(t,e){if(Y1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function mP(t,e,n){const r=bH(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await wH(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function wH(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const SH={};let $k=!0;async function TH(t,e,n){let r;Y1(n)?r=await mP(t,e,n):r=pP(t,n);const i=e&&e.imagebitmap;return await EH(r,i)}async function EH(t,e=null){if((AH(e)||!$k)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),$k=!1}return await createImageBitmap(t)}function AH(t){for(const e in t||SH)return!1;return!0}function RH(t){return!MH(t,"ftyp",4)||(t[8]&96)===0?null:CH(t)}function CH(t){switch(NH(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function NH(t,e,n){return String.fromCharCode(...t.slice(e,n))}function kH(t){return[...t].map(e=>e.charCodeAt(0))}function MH(t,e,n=0){const r=kH(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Xr=!1,lc=!0;function gP(t){const e=Vc(t);return OH(e)||jH(e)||PH(e)||DH(e)||IH(e)}function IH(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=RH(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function OH(t){const e=Vc(t);return e.byteLength>=24&&e.getUint32(0,Xr)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Xr),height:e.getUint32(20,Xr)}:null}function PH(t){const e=Vc(t);return e.byteLength>=10&&e.getUint32(0,Xr)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,lc),height:e.getUint16(8,lc)}:null}function DH(t){const e=Vc(t);return e.byteLength>=14&&e.getUint16(0,Xr)===16973&&e.getUint32(2,lc)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,lc),height:e.getUint32(22,lc)}:null}function jH(t){const e=Vc(t);if(!(e.byteLength>=3&&e.getUint16(0,Xr)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=LH();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Xr);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Xr),width:e.getUint16(s+7,Xr)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Xr)}return null}function LH(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Vc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function BH(t,e){var i;const{mimeType:n}=gP(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Gf(r),await r(t,n)}async function UH(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=FH(i);let l;switch(o){case"imagebitmap":l=await TH(t,e,s);break;case"image":l=await mP(t,e,s);break;case"data":l=await BH(t);break;default:Gf(!1)}return i==="data"&&(l=_H(l)),l}function FH(t){switch(t){case"auto":case"data":return mH();default:return pH(t),t}}const zH=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],$H=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],VH={image:{type:"auto",decode:!0}},qH={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:fH,mimeTypes:$H,extensions:zH,parse:UH,tests:[t=>!!gP(new DataView(t))],options:VH},xt=new zc({id:"deck"});let x0={};function HH(t){x0=t}function An(t,e,n,r){xt.level>0&&x0[t]&&x0[t].call(null,e,n,r)}function WH(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const XH={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:WH,parseTextSync:JSON.parse};function YH(){const t="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(xt.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:xt,_registerLoggers:HH},Fq([XH,[qH,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const GH=YH();function G1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const xb={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function KH(t){const e={};for(const[n,r]of Object.entries(t))e[n]=ZH(r);return e}function ZH(t){let e=Vk(t);if(e!=="object")return{value:t,...xb[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...xb[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Vk(t.value),{...t,...xb[e],type:e}):{type:"object",value:null};throw new Error("props")}function Vk(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const QH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,JH=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,eW={vertex:QH,fragment:JH},qk=/void\s+main\s*\([^)]*\)\s*\{\n?/,Hk=/}\n?[^{}]*$/,yb=[],If="__LUMA_INJECT_DECLARATIONS__";function tW(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=nW(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function nW(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Jf(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((u,d)=>u.order-d.order),yb.length=o.length;for(let u=0,d=o.length;u<d;++u)yb[u]=o[u].injection;const l=`${yb.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(If,l));break;case"vs:#main-start":i&&(t=t.replace(qk,u=>u+l));break;case"vs:#main-end":i&&(t=t.replace(Hk,u=>l+u));break;case"fs:#decl":i||(t=t.replace(If,l));break;case"fs:#main-start":i||(t=t.replace(qk,u=>u+l));break;case"fs:#main-end":i||(t=t.replace(Hk,u=>l+u));break;default:t=t.replace(s,u=>u+l)}}return t=t.replace(If,""),r&&(t=t.replace(/\}\s*$/,s=>s+eW[e])),t}function ed(t){t.map(e=>rW(e))}function rW(t){if(t.instance)return;ed(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:tW(r),parsedDeprecations:iW(n)};e&&(i.propValidators=KH(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const d=u==null?void 0:u.value;return d&&(o[l]=d),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function _P(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function iW(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function K1(t){ed(t);const e={},n={};vP({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return ed(r),r}function vP(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&vP({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function sW(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function aW(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Wk(t,oW),t;case"fragment":return t=Wk(t,lW),t;default:throw new Error(e)}}const xP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],oW=[...xP,[y0("attribute"),"in $1"],[y0("varying"),"out $1"]],lW=[...xP,[y0("varying"),"in $1"]];function Wk(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function y0(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function yP(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function bP(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function cW(t,e){return{name:uW(t,e),language:"glsl",version:fW(t)}}function uW(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function fW(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const wP=`

${If}
`,dW=`precision highp float;
`;function hW(t){const e=K1(t.modules||[]);return{source:mW(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:SP(e)}}function pW(t){const{vs:e,fs:n}=t,r=K1(t.modules||[]);return{vs:Xk(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Xk(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:SP(r)}}function mW(t,e){var S;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;G1(typeof n=="string","shader source must be a string");const u=n;let d="";const h=bP(s),g={},_={},x={};for(const b in o){const T=typeof o[b]=="string"?{injection:o[b],order:0}:o[b],A=/^(v|f)s:(#)?([\w-]+)$/.exec(b);if(A){const R=A[2],E=A[3];R?E==="decl"?_[b]=[T]:x[b]=[T]:g[b]=[T]}else x[b]=[T]}const w=i;for(const b of w){l&&_P(b,u,l);const T=TP(b,"wgsl");d+=T;const A=((S=b.injections)==null?void 0:S[r])||{};for(const R in A){const E=/^(v|f)s:#([\w-]+)$/.exec(R);if(E){const O=E[2]==="decl"?_:x;O[R]=O[R]||[],O[R].push(A[R])}else g[R]=g[R]||[],g[R].push(A[R])}}return d+=wP,d=Jf(d,r,_),d+=yP(h[r],g),d+=u,d=Jf(d,r,x),d}function Xk(t,e){var P;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:d={},prologue:h=!0,log:g}=e;G1(typeof r=="string","shader source must be a string");const _=s==="glsl"?cW(r).version:-1,x=t.shaderLanguageVersion,w=_===100?"#version 100":"#version 300 es",b=r.split(`
`).slice(1).join(`
`),T={};o.forEach(k=>{Object.assign(T,k.defines)}),Object.assign(T,l);let A="";switch(s){case"wgsl":break;case"glsl":A=h?`${w}

// ----- PROLOGUE -------------------------
${gW({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${sW(t)}
${i==="fragment"?dW:""}

// ----- APPLICATION DEFINES -------------------------

${_W(T)}

`:`${w}
`;break}const R=bP(u),E={},C={},O={};for(const k in d){const I=typeof d[k]=="string"?{injection:d[k],order:0}:d[k],N=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(N){const B=N[2],V=N[3];B?V==="decl"?C[k]=[I]:O[k]=[I]:E[k]=[I]}else O[k]=[I]}for(const k of o){g&&_P(k,b,g);const I=TP(k,i);A+=I;const N=((P=k.instance)==null?void 0:P.normalizedInjections[i])||{};for(const B in N){const V=/^(v|f)s:#([\w-]+)$/.exec(B);if(V){const j=V[2]==="decl"?C:O;j[B]=j[B]||[],j[B].push(N[B])}else E[B]=E[B]||[],E[B].push(N[B])}}return A+="// ----- MAIN SHADER SOURCE -------------------------",A+=wP,A=Jf(A,i,C),A+=yP(R[i],E),A+=b,A=Jf(A,i,O),s==="glsl"&&_!==x&&(A=aW(A,i)),A.trim()}function SP(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function gW(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function _W(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function TP(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:G1(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const vW=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,xW=/^\s*\#\s*endif\s*$/;function yW(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const l of n){const u=l.match(vW),d=l.match(xW);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):d?i=!0:i&&r.push(l)}return r.join(`
`)}const Bs=class Bs{constructor(){U(this,"_hookFunctions",[]);U(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Bs.defaultShaderAssembler=Bs.defaultShaderAssembler||new Bs,Bs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=hW({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?yW(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...pW({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;n[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(n[i++]=l,r[u]=!0)}return n.length=i,ed(n),n}};U(Bs,"defaultShaderAssembler");let td=Bs;const bW=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,wW=`#version 300 es
${bW}`;function SW(t){const{input:e,inputChannels:n,output:r}={};if(!e)return wW;if(!n)throw new Error("inputChannels");const i=TW(n),s=EW(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function TW(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function EW(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class AW{constructor(){U(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new mh({id:e})),this.stats.get(e)}}const EP=new AW,ye=new zc({id:"luma.gl"}),bb={};function _h(t="id"){bb[t]=bb[t]||1;const e=bb[t]++;return`${t}-${e}`}var e0;let ht=(e0=class{constructor(e,n,r){U(this,"id");U(this,"props");U(this,"userData",{});U(this,"_device");U(this,"destroyed",!1);U(this,"allocatedBytes",0);U(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=RW(n,r);const i=this.props.id!=="undefined"?this.props.id:_h(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},U(e0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),e0);function RW(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const hn=class hn extends ht{constructor(n,r){const i={...r};(r.usage||0)&hn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,hn.defaultProps);U(this,"usage");U(this,"indexType");U(this,"updateTimestamp");U(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,hn.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};U(hn,"defaultProps",{...ht.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),U(hn,"MAP_READ",1),U(hn,"MAP_WRITE",2),U(hn,"COPY_SRC",4),U(hn,"COPY_DST",8),U(hn,"INDEX",16),U(hn,"VERTEX",32),U(hn,"UNIFORM",64),U(hn,"STORAGE",128),U(hn,"INDIRECT",256),U(hn,"QUERY_RESOLVE",512),U(hn,"DEBUG_DATA_MAX_LENGTH",32);let Et=hn;function AP(t){const e=Yk[t],n=CW(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Yk[t],byteLength:n,integer:i,signed:s,normalized:r}}function CW(t){return NW[t]}const Yk={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},NW={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},yn="texture-compression-bc",dt="texture-compression-astc",$r="texture-compression-etc2",kW="texture-compression-etc1-webgl",df="texture-compression-pvrtc-webgl",wb="texture-compression-atc-webgl",hf="float32-renderable-webgl",Sb="float16-renderable-webgl",MW="rgb9e5ufloat-renderable-webgl",Tb="snorm8-renderable-webgl",ql="norm16-renderable-webgl",Eb="snorm16-renderable-webgl",pf="float32-filterable",Gk="float16-filterable-webgl";function RP(t){const e=IW[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const IW={r8unorm:{},r8snorm:{render:Tb},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Tb},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Sb,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:ql},"r16snorm-webgl":{f:Eb},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Tb},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Sb,filter:Gk},"rg16unorm-webgl":{render:ql},"rg16snorm-webgl":{render:Eb},r32uint:{},r32sint:{},r32float:{render:hf,filter:pf},rgb9e5ufloat:{channels:"rgb",packed:!0,render:MW},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:hf},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:ql},"rgb16snorm-webgl":{f:ql},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:pf},rgba16uint:{},rgba16sint:{},rgba16float:{render:Sb,filter:Gk},"rgba16unorm-webgl":{render:ql},"rgba16snorm-webgl":{render:Eb},"rgb32float-webgl":{render:hf,filter:pf},rgba32uint:{},rgba32sint:{},rgba32float:{render:hf,filter:pf},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:yn},"bc1-rgb-unorm-srgb-webgl":{f:yn},"bc1-rgba-unorm":{f:yn},"bc1-rgba-unorm-srgb":{f:yn},"bc2-rgba-unorm":{f:yn},"bc2-rgba-unorm-srgb":{f:yn},"bc3-rgba-unorm":{f:yn},"bc3-rgba-unorm-srgb":{f:yn},"bc4-r-unorm":{f:yn},"bc4-r-snorm":{f:yn},"bc5-rg-unorm":{f:yn},"bc5-rg-snorm":{f:yn},"bc6h-rgb-ufloat":{f:yn},"bc6h-rgb-float":{f:yn},"bc7-rgba-unorm":{f:yn},"bc7-rgba-unorm-srgb":{f:yn},"etc2-rgb8unorm":{f:$r},"etc2-rgb8unorm-srgb":{f:$r},"etc2-rgb8a1unorm":{f:$r},"etc2-rgb8a1unorm-srgb":{f:$r},"etc2-rgba8unorm":{f:$r},"etc2-rgba8unorm-srgb":{f:$r},"eac-r11unorm":{f:$r},"eac-r11snorm":{f:$r},"eac-rg11unorm":{f:$r},"eac-rg11snorm":{f:$r},"astc-4x4-unorm":{f:dt},"astc-4x4-unorm-srgb":{f:dt},"astc-5x4-unorm":{f:dt},"astc-5x4-unorm-srgb":{f:dt},"astc-5x5-unorm":{f:dt},"astc-5x5-unorm-srgb":{f:dt},"astc-6x5-unorm":{f:dt},"astc-6x5-unorm-srgb":{f:dt},"astc-6x6-unorm":{f:dt},"astc-6x6-unorm-srgb":{f:dt},"astc-8x5-unorm":{f:dt},"astc-8x5-unorm-srgb":{f:dt},"astc-8x6-unorm":{f:dt},"astc-8x6-unorm-srgb":{f:dt},"astc-8x8-unorm":{f:dt},"astc-8x8-unorm-srgb":{f:dt},"astc-10x5-unorm":{f:dt},"astc-10x5-unorm-srgb":{f:dt},"astc-10x6-unorm":{f:dt},"astc-10x6-unorm-srgb":{f:dt},"astc-10x8-unorm":{f:dt},"astc-10x8-unorm-srgb":{f:dt},"astc-10x10-unorm":{f:dt},"astc-10x10-unorm-srgb":{f:dt},"astc-12x10-unorm":{f:dt},"astc-12x10-unorm-srgb":{f:dt},"astc-12x12-unorm":{f:dt},"astc-12x12-unorm-srgb":{f:dt},"pvrtc-rgb4unorm-webgl":{f:df},"pvrtc-rgba4unorm-webgl":{f:df},"pvrtc-rbg2unorm-webgl":{f:df},"pvrtc-rgba2unorm-webgl":{f:df},"etc1-rbg-unorm-webgl":{f:kW},"atc-rgb-unorm-webgl":{f:wb},"atc-rgba-unorm-webgl":{f:wb},"atc-rgbai-unorm-webgl":{f:wb}},OW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],PW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function CP(t){return OW.some(e=>t.startsWith(e))}function Z1(t){let e=DW(t);if(CP(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=jW(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=PW.exec(t);if(n){const[,r,i,s,o,l]=n,u=`${s}${i}`,d=AP(u),h=d.byteLength*8,g=r.length,_=[h,g>=2?h:0,g>=3?h:0,g>=4?h:0];e={format:t,attachment:e.attachment,dataType:d.dataType,components:g,channels:r,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:_,bytesPerPixel:d.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function DW(t){var s;const e=RP(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function jW(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function LW(t){const e=RP(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=Z1(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!l),n}class BW{}class UW{constructor(e=[],n){U(this,"features");U(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const Nd=class Nd{constructor(e){U(this,"id");U(this,"props");U(this,"userData",{});U(this,"statsManager",EP);U(this,"timestamp",0);U(this,"_reused",!1);U(this,"_lumaData",{});this.props={...Nd.defaultProps,...e},this.id=this.props.id||_h(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=LW(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return CP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Et.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":ye.warn("indices buffer content must be of integer type")()),n}};U(Nd,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ye.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ye.get("debug")||void 0,debugShaders:ye.get("debug-shaders")||void 0,debugFramebuffers:!!ye.get("debug-framebuffers"),debugWebGL:!!ye.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let fs=Nd;const FW=fa()&&typeof document<"u",zW=()=>FW&&document.readyState==="complete",$W="set luma.log.level=1 (or higher) to trace rendering",Kk="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",ns=class ns{constructor(){U(this,"stats",EP);U(this,"log",ye);U(this,"VERSION","9.1.9");U(this,"spector");U(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ye.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ye.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ye.error("This version of luma.gl has already been initialized")()}ye.log(1,`${this.VERSION} - ${$W}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(ns.defaultProps,e)}async createDevice(e={}){var l;e={...ns.defaultProps,...e},e.waitForPageLoad&&await ns.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((l=s==null?void 0:s.create)==null?void 0:l.call(s,e));if(o)return o;throw new Error(Kk)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await ns.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(Kk)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||ye.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){ye.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};U(ns,"defaultProps",{...fs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),U(ns,"pageLoaded",VW().then(()=>{ye.probe(2,"DOM is loaded")()}));let b0=ns;const w0=new b0;function VW(){return zW()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class qW{}const kd=class kd{constructor(e){U(this,"id");U(this,"props");U(this,"canvas");U(this,"htmlCanvas");U(this,"offscreenCanvas");U(this,"type");U(this,"width",1);U(this,"height",1);U(this,"resizeObserver");U(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...kd.defaultProps,...e},e=this.props,!fa()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=WW(e.canvas):this.canvas=e.canvas;else{const n=XW(e),r=HW((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return YW(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(ye.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[h,g]=this.getDrawingBufferSize();(h!==l||g!==u)&&(o=Math.min(h/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),ye.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};U(kd,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let S0=kd;function HW(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function WW(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function XW(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=_h("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function YW(t,e,n,r,i){const s=t,o=Zk(s[0],e,n);let l=Qk(s[1],e,r,i),u=Zk(s[0]+1,e,n);const d=u===n-1?u:u-1;u=Qk(s[1]+1,e,r,i);let h;return i?(u=u===0?u:u+1,h=l,l=u):h=u===r-1?u:u-1,{x:o,y:l,width:Math.max(d-o+1,1),height:Math.max(h-l+1,1)}}function Zk(t,e,n){return Math.min(Math.round(t*e),n-1)}function Qk(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const pn=class pn extends ht{constructor(n,r){r=pn.normalizeProps(n,r);super(n,r,pn.defaultProps);U(this,"dimension");U(this,"format");U(this,"width");U(this,"height");U(this,"depth");U(this,"mipLevels");U(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=pn.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?pn.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return pn.getTextureDataSize(n[0]);if(pn.isExternalImage(n))return pn.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var u,d;const i={...r},s=((d=(u=n==null?void 0:n.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:o,height:l}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}};U(pn,"COPY_SRC",1),U(pn,"COPY_DST",2),U(pn,"TEXTURE",4),U(pn,"STORAGE",8),U(pn,"RENDER_ATTACHMENT",16),U(pn,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),U(pn,"defaultProps",{...ht.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),U(pn,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let jt=pn;const Md=class Md extends ht{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Md.defaultProps)}};U(Md,"defaultProps",{...ht.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let nd=Md;function GW(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=NP(i[l-1],l,n);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=Jk(u,i,u.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=Jk(l,i,l.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Jk(t,e,n,r){if(r!=null&&r.inlineSource){const s=KW(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function KW(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=NP(s,e,n))}return r}function NP(t,e,n){const r=n!=null&&n.html?QW(t):t;return`${ZW(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function ZW(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function QW(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Id=class Id extends ht{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:JW(r),...r},Id.defaultProps);U(this,"stage");U(this,"source");U(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=kP(this.source),i=`${this.stage} ${r}`;let s=GW(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};U(Id,"defaultProps",{...ht.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let rd=Id;function JW(t){return kP(t.source)||t.id||_h(`unnamed ${t.stage}-shader`)}function kP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const gc=class gc extends ht{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=gc.normalizeProps(e,n),super(e,n,gc.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};U(gc,"defaultProps",{...ht.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let id=gc;const Od=class Od extends ht{constructor(n,r={}){super(n,r,Od.defaultProps);U(this,"width");U(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(ye.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof jt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof jt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:jt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:jt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};U(Od,"defaultProps",{...ht.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let sd=Od;const Pd=class Pd extends ht{constructor(n,r){super(n,r,Pd.defaultProps);U(this,"shaderLayout");U(this,"bufferLayout");U(this,"linkStatus","pending");U(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};U(Pd,"defaultProps",{...ht.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Eo=Pd;const Cr=class Cr extends ht{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=Cr.normalizeProps(e,n),super(e,n,Cr.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};U(Cr,"defaultClearColor",[0,0,0,1]),U(Cr,"defaultClearDepth",1),U(Cr,"defaultClearStencil",0),U(Cr,"defaultProps",{...ht.defaultProps,framebuffer:null,parameters:void 0,clearColor:Cr.defaultClearColor,clearColors:void 0,clearDepth:Cr.defaultClearDepth,clearStencil:Cr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let T0=Cr;const Dd=class Dd extends ht{constructor(n,r){super(n,r,Dd.defaultProps);U(this,"hash","");U(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};U(Dd,"defaultProps",{...ht.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ad=Dd;const jd=class jd extends ht{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,jd.defaultProps)}};U(jd,"defaultProps",{...ht.defaultProps,measureExecutionTime:void 0});let E0=jd;const Ld=class Ld extends ht{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Ld.defaultProps)}};U(Ld,"defaultProps",{...ht.defaultProps});let A0=Ld;function eX(t){const[e,n]=nX[t],r=e==="i32"||e==="u32",i=e!=="u32",s=rX[e]*n,o=tX(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function tX(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const nX={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},rX={f32:4,f16:2,i32:4,u32:4};function MP(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=AP(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function IP(t,e){const n={};for(const r of t.attributes){const i=sX(t,e,r.name);i&&(n[r.name]=i)}return n}function iX(t,e,n=16){const r=IP(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function sX(t,e,n){const r=aX(t,n),i=oX(e,n);if(!r)return null;const s=eX(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,l=MP(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function aX(t,e){const n=t.attributes.find(r=>r.name===e);return n||ye.warn(`shader layout attribute "${e}" not present in shader`),n||null}function oX(t,e){lX(t);let n=cX(t,e);return n||(n=uX(t,e),n)?n:(ye.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function lX(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&ye.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function cX(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function uX(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const l=MP(o.format);i+=l.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const Bd=class Bd extends ht{constructor(n,r){super(n,r,Bd.defaultProps);U(this,"maxVertexAttributes");U(this,"attributeInfos");U(this,"indexBuffer",null);U(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=iX(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};U(Bd,"defaultProps",{...ht.defaultProps,renderPipeline:null});let R0=Bd;const Ud=class Ud extends ht{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Ud.defaultProps)}};U(Ud,"defaultProps",{...ht.defaultProps,layout:void 0,buffers:{}});let C0=Ud;const Fd=class Fd extends ht{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Fd.defaultProps)}};U(Fd,"defaultProps",{...ht.defaultProps,type:void 0,count:void 0});let N0=Fd;const fX={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function dX(t){return fX[t]}function hX(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let mf;function OP(t){return(!mf||mf.byteLength<t)&&(mf=new ArrayBuffer(t)),mf}function pX(t,e){const n=OP(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function mX(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function od(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":mX(t)}const e4=1024;class gX{constructor(e){U(this,"layout",{});U(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=dX(s),{type:l,components:u}=o;n=hX(n,u);const d=n;n+=u,this.layout[i]={type:l,size:u,offset:d}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,e4)}getData(e){const n=Math.max(this.byteLength,e4),r=OP(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){ye.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:h}=l,g=i[u];if(d===1){if(typeof o!="number"&&typeof o!="boolean"){ye.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[h]=Number(o)}else{if(!od(o)){ye.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function _X(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!od(r))return!1;if(od(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function vX(t){return od(t)?t.slice():t}class xX{constructor(e){U(this,"name");U(this,"uniforms",{});U(this,"modifiedUniforms",{});U(this,"modified",!0);U(this,"bindingLayout",{});U(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){_X(this.uniforms[e],n)||(this.uniforms[e]=vX(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class yX{constructor(e){U(this,"uniformBlocks",new Map);U(this,"uniformBufferLayouts",new Map);U(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new gX(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new xX({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Et.UNIFORM|Et.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Et.UNIFORM|Et.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&ye.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const l=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();ye.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return i}}function PP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function DP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function bX(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=PP(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class Ab{constructor(e){U(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&ye.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function wX(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(h=>h.attribute):[i.name],l=s.attributes?s.attributes.map(h=>h.attribute):[s.name],u=Math.min(...o.map(h=>n[h])),d=Math.min(...l.map(h=>n[h]));return u-d}),r}class hr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class t4{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class os extends hr{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ds extends hr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class k0 extends hr{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ks extends hr{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var es;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(es||(es={}));class gf{constructor(e,n,r,i,s,o,l){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class SX{constructor(e,n){this.name=e,this.type=n}}class TX{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class n4{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class EX{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class AX{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class RX{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class CX{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const jP=new Float32Array(1),NX=new Int32Array(jP.buffer),bn=new Uint16Array(1);function kX(t){jP[0]=t;const e=NX[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return bn[0]=n<<15|31744|(i!==0?512:0),bn[0];if(r===0){if(i===0)return bn[0]=n<<15,bn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),bn[0]=n<<15|r<<10|i>>13,bn[0]):(bn[0]=n<<15,bn[0])}return r=r-127+15,r>=31?(bn[0]=n<<15|31744,bn[0]):r<=0?r<-10?(bn[0]=n<<15,bn[0]):(i=(8388608|i)>>1-r,bn[0]=n<<15|i>>13,bn[0]):(i>>=13,bn[0]=n<<15|r<<10|i,bn[0])}const Q1=new Uint32Array(1),LP=new Float32Array(Q1.buffer,0,1);function r4(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return Q1[0]=e,LP[0]}function MX(t,e,n,r,i,s,o,l,u){const d=r*(o>>=i)*(s>>=i)+n*o+e*l;switch(u){case"r8unorm":return[Je(t,d,"8unorm",1)[0]];case"r8snorm":return[Je(t,d,"8snorm",1)[0]];case"r8uint":return[Je(t,d,"8uint",1)[0]];case"r8sint":return[Je(t,d,"8sint",1)[0]];case"rg8unorm":{const h=Je(t,d,"8unorm",2);return[h[0],h[1]]}case"rg8snorm":{const h=Je(t,d,"8snorm",2);return[h[0],h[1]]}case"rg8uint":{const h=Je(t,d,"8uint",2);return[h[0],h[1]]}case"rg8sint":{const h=Je(t,d,"8sint",2);return[h[0],h[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const h=Je(t,d,"8unorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8snorm":{const h=Je(t,d,"8snorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8uint":{const h=Je(t,d,"8uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba8sint":{const h=Je(t,d,"8sint",4);return[h[0],h[1],h[2],h[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const h=Je(t,d,"8unorm",4);return[h[2],h[1],h[0],h[3]]}case"r16uint":return[Je(t,d,"16uint",1)[0]];case"r16sint":return[Je(t,d,"16sint",1)[0]];case"r16float":return[Je(t,d,"16float",1)[0]];case"rg16uint":{const h=Je(t,d,"16uint",2);return[h[0],h[1]]}case"rg16sint":{const h=Je(t,d,"16sint",2);return[h[0],h[1]]}case"rg16float":{const h=Je(t,d,"16float",2);return[h[0],h[1]]}case"rgba16uint":{const h=Je(t,d,"16uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16sint":{const h=Je(t,d,"16sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16float":{const h=Je(t,d,"16float",4);return[h[0],h[1],h[2],h[3]]}case"r32uint":return[Je(t,d,"32uint",1)[0]];case"r32sint":return[Je(t,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Je(t,d,"32float",1)[0]];case"rg32uint":{const h=Je(t,d,"32uint",2);return[h[0],h[1]]}case"rg32sint":{const h=Je(t,d,"32sint",2);return[h[0],h[1]]}case"rg32float":{const h=Je(t,d,"32float",2);return[h[0],h[1]]}case"rgba32uint":{const h=Je(t,d,"32uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32sint":{const h=Je(t,d,"32sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32float":{const h=Je(t,d,"32float",4);return[h[0],h[1],h[2],h[3]]}case"rg11b10ufloat":{const h=new Uint32Array(t.buffer,d,1)[0],g=(4192256&h)>>11,_=(4290772992&h)>>22;return[r4(2047&h),r4(g),function(x){const w=112+(x>>5&31)<<23|(31&x)<<18;return Q1[0]=w,LP[0]}(_),1]}}return null}function Je(t,e,n,r){const i=[0,0,0,0];for(let d=0;d<r;++d)switch(n){case"8unorm":i[d]=t[e]/255,e++;break;case"8snorm":i[d]=t[e]/255*2-1,e++;break;case"8uint":i[d]=t[e],e++;break;case"8sint":i[d]=t[e]-127,e++;break;case"16uint":i[d]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[d]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(s=t[e]|t[e+1]<<8,o=void 0,l=void 0,u=void 0,o=(32768&s)>>15,u=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):l==31?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+u/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,o,l,u;return i}function it(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=kX(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const Rb={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class yr{constructor(){this.id=yr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(ld.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(cd.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}yr._id=0;class ld extends yr{}ld.instance=new ld;class cd extends yr{}cd.instance=new cd;const BP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Rt extends yr{constructor(){super()}}class Cc extends Rt{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class IX extends Rt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class UP extends Rt{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class M0 extends Rt{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class FP extends Rt{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class yi extends Rt{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class J1 extends Rt{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class cc extends Rt{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Of extends Rt{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var fo,ec,le,ne;(t=>{t.increment="++",t.decrement="--"})(fo||(fo={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(fo||(fo={}));class zP extends Rt{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ec||(ec={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(ec||(ec={}));class $P extends Rt{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class e2 extends Rt{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return BP.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class VP extends Rt{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class qP extends Rt{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class HP extends Rt{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class WP extends Rt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class OX extends Rt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class PX extends Rt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class XP extends Rt{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class t2 extends Rt{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class DX extends Rt{constructor(){super()}get astNodeType(){return"discard"}}class YP extends Rt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class GP extends Rt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _e extends Rt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=_e._priority.get(n.name);_e._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?_e.i32:n}getTypeName(){return this.name}}_e.x32=new _e("x32"),_e.f32=new _e("f32"),_e.i32=new _e("i32"),_e.u32=new _e("u32"),_e.f16=new _e("f16"),_e.bool=new _e("bool"),_e.void=new _e("void"),_e._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class i4 extends _e{constructor(e){super(e)}}class vi extends _e{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class ae extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ae.vec2f=new ae("vec2",_e.f32,null),ae.vec3f=new ae("vec3",_e.f32,null),ae.vec4f=new ae("vec4",_e.f32,null),ae.vec2i=new ae("vec2",_e.i32,null),ae.vec3i=new ae("vec3",_e.i32,null),ae.vec4i=new ae("vec4",_e.i32,null),ae.vec2u=new ae("vec2",_e.u32,null),ae.vec3u=new ae("vec3",_e.u32,null),ae.vec4u=new ae("vec4",_e.u32,null),ae.vec2h=new ae("vec2",_e.f16,null),ae.vec3h=new ae("vec3",_e.f16,null),ae.vec4h=new ae("vec4",_e.f16,null),ae.vec2b=new ae("vec2",_e.bool,null),ae.vec3b=new ae("vec3",_e.bool,null),ae.vec4b=new ae("vec4",_e.bool,null),ae.mat2x2f=new ae("mat2x2",_e.f32,null),ae.mat2x3f=new ae("mat2x3",_e.f32,null),ae.mat2x4f=new ae("mat2x4",_e.f32,null),ae.mat3x2f=new ae("mat3x2",_e.f32,null),ae.mat3x3f=new ae("mat3x3",_e.f32,null),ae.mat3x4f=new ae("mat3x4",_e.f32,null),ae.mat4x2f=new ae("mat4x2",_e.f32,null),ae.mat4x3f=new ae("mat4x3",_e.f32,null),ae.mat4x4f=new ae("mat4x4",_e.f32,null),ae.mat2x2h=new ae("mat2x2",_e.f16,null),ae.mat2x3h=new ae("mat2x3",_e.f16,null),ae.mat2x4h=new ae("mat2x4",_e.f16,null),ae.mat3x2h=new ae("mat3x2",_e.f16,null),ae.mat3x3h=new ae("mat3x3",_e.f16,null),ae.mat3x4h=new ae("mat3x4",_e.f16,null),ae.mat4x2h=new ae("mat4x2",_e.f16,null),ae.mat4x3h=new ae("mat4x3",_e.f16,null),ae.mat4x4h=new ae("mat4x4",_e.f16,null),ae.mat2x2i=new ae("mat2x2",_e.i32,null),ae.mat2x3i=new ae("mat2x3",_e.i32,null),ae.mat2x4i=new ae("mat2x4",_e.i32,null),ae.mat3x2i=new ae("mat3x2",_e.i32,null),ae.mat3x3i=new ae("mat3x3",_e.i32,null),ae.mat3x4i=new ae("mat3x4",_e.i32,null),ae.mat4x2i=new ae("mat4x2",_e.i32,null),ae.mat4x3i=new ae("mat4x3",_e.i32,null),ae.mat4x4i=new ae("mat4x4",_e.i32,null),ae.mat2x2u=new ae("mat2x2",_e.u32,null),ae.mat2x3u=new ae("mat2x3",_e.u32,null),ae.mat2x4u=new ae("mat2x4",_e.u32,null),ae.mat3x2u=new ae("mat3x2",_e.u32,null),ae.mat3x3u=new ae("mat3x3",_e.u32,null),ae.mat3x4u=new ae("mat3x4",_e.u32,null),ae.mat4x2u=new ae("mat4x2",_e.u32,null),ae.mat4x3u=new ae("mat4x3",_e.u32,null),ae.mat4x4u=new ae("mat4x4",_e.u32,null);class Pf extends _e{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class uc extends _e{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class tc extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class jr extends yr{constructor(){super(),this.postfix=null}}class Zs extends jr{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Wr extends jr{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class n2 extends jr{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return BP.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Kn extends jr{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class KP extends jr{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Jt extends jr{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof te}get isVector(){return this.value instanceof H||this.value instanceof je}get scalarValue(){return this.value instanceof te?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof H||this.value instanceof je?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class ZP extends jr{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Ao extends jr{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class QP extends jr{constructor(){super()}}class Xt extends QP{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Rr extends QP{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?_e.f32:e.name==="u32"||n.name==="u32"?_e.u32:_e.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class JP extends yr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Df extends jr{constructor(){super()}get astNodeType(){return"default"}}class eD extends JP{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class tD extends JP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class s4 extends yr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class jX extends yr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class a4 extends yr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class nD extends yr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class gr{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=gr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}gr._id=0;class I0 extends gr{constructor(){super(new hr("void",null),null)}toString(){return"void"}}I0.void=new I0;class so extends gr{constructor(e){super(new k0("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class te extends gr{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new te(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new te(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new te(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function LX(t,e,n){const r=e.length;return r===2?n==="f32"?new H(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new H(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new H(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new H(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new H(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new H(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new H(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new H(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new H(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new H(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new H(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new H(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class H extends gr{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new H(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new H(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new H(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Zs?console.error("TODO: Set vector postfix"):n instanceof H?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ks)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof Ao){const o=n.index;let l=-1;if(o instanceof Jt){if(!(o.value instanceof te))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof te))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Zs))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=LX(e,l,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class je extends gr{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new je(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Zs?console.error("TODO: Set matrix postfix"):n instanceof je?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ks)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof Ao){const s=n.index;let o=-1;if(s instanceof Jt){if(!(s.value instanceof te))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const d=e.evalExpression(s,r);if(!(d instanceof te))return console.error("GetDataValue: Unknown index type",s),null;o=d.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new H(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new H(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new H(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return n.postfix?u.getSubData(e,n.postfix,r):u}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Lt extends gr{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Lt(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof Ao)if(o instanceof ds){const l=r.index;if(l instanceof Jt){if(!(l.value instanceof te))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof te))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Zs))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof os){let u=!1;for(const d of o.members)if(d.name===l){s+=d.offset,o=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof hr){const u=o.getTypeName();let d=0;if(l==="x"||l==="r")d=0;else if(l==="y"||l==="g")d=1;else if(l==="z"||l==="b")d=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);d=3}if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);const h=n.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=h):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=h):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=h):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=h):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=h):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=h):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=h):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=h):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(n instanceof Lt){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,i,16);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11],l[12]=n.data[12],l[13]=n.data[13],l[14]=n.data[14],l[15]=n.data[15]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15])}else{const l=new Float32Array(this.buffer,i,12);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,8);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,12);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,9);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8])}else{const l=new Float32Array(this.buffer,i,6);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,8);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,6);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,4);n instanceof je?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Int32Array(this.buffer,i,4);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Int32Array(this.buffer,i,3);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Int32Array(this.buffer,i,2);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Float32Array(this.buffer,i,4);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Float32Array(this.buffer,i,3);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Float32Array(this.buffer,i,2);n instanceof H?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let l=this.offset,u=this.typeInfo;for(;n;){if(n instanceof Ao){const h=n.index,g=h instanceof jr?e.evalExpression(h,r):h;let _=0;if(g instanceof te?_=g.value:typeof g=="number"?_=g:console.error("GetDataValue: Invalid index type",h),u instanceof ds)l+=_*u.stride,u=u.format;else{const x=u.getTypeName();x==="mat4x4"||x==="mat4x4f"||x==="mat4x4h"?(l+=16*_,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(n instanceof Zs))return console.error("GetDataValue: Unknown postfix type",n),null;{const h=n.value;if(u instanceof os){let g=!1;for(const _ of u.members)if(_.name===h){l+=_.offset,u=_.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${h} not found`),null}else if(u instanceof hr){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(h.length>0&&h.length<5){let _="f";const x=[];for(let w=0;w<h.length;++w){const S=h[w].toLowerCase();let b=0;if(S==="x"||S==="r")b=0;else if(S==="y"||S==="g")b=1;else if(S==="z"||S==="b")b=2;else{if(S!=="w"&&S!=="a")return console.error(`Unknown member ${h}`),null;b=3}if(h.length===1){if(g.endsWith("f"))return this.buffer.byteLength<l+4*b+4?(console.log("Insufficient buffer data"),null):new te(new Float32Array(this.buffer,l+4*b,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new te(new Float32Array(this.buffer,l+4*b,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new te(new Int32Array(this.buffer,l+4*b,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new te(new Int32Array(this.buffer,l+4*b,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new te(new Uint32Array(this.buffer,l+4*b,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")x.push(new Float32Array(this.buffer,l,2)[b]);else if(g==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const T=new Float32Array(this.buffer,l,3);x.push(T[b])}else if(g==="vec4f")x.push(new Float32Array(this.buffer,l,4)[b]);else if(g==="vec2i")_="i",x.push(new Int32Array(this.buffer,l,2)[b]);else if(g==="vec3i")_="i",x.push(new Int32Array(this.buffer,l,3)[b]);else if(g==="vec4i")_="i",x.push(new Int32Array(this.buffer,l,4)[b]);else if(g==="vec2u"){_="u";const T=new Uint32Array(this.buffer,l,2);x.push(T[b])}else g==="vec3u"?(_="u",x.push(new Uint32Array(this.buffer,l,3)[b])):g==="vec4u"&&(_="u",x.push(new Uint32Array(this.buffer,l,4)[b]))}return x.length===2?u=e.getTypeInfo(`vec2${_}`):x.length===3?u=e.getTypeInfo(`vec3${_}`):x.length===4?u=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${x.length}`),new H(x,u,null)}return console.error(`GetDataValue: Unknown member ${h}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}n=n.postfix}const d=u.getTypeName();return d==="f32"?new te(new Float32Array(this.buffer,l,1),u,this):d==="i32"?new te(new Int32Array(this.buffer,l,1),u,this):d==="u32"?new te(new Uint32Array(this.buffer,l,1),u,this):d==="vec2f"?new H(new Float32Array(this.buffer,l,2),u,this):d==="vec3f"?new H(new Float32Array(this.buffer,l,3),u,this):d==="vec4f"?new H(new Float32Array(this.buffer,l,4),u,this):d==="vec2i"?new H(new Int32Array(this.buffer,l,2),u,this):d==="vec3i"?new H(new Int32Array(this.buffer,l,3),u,this):d==="vec4i"?new H(new Int32Array(this.buffer,l,4),u,this):d==="vec2u"?new H(new Uint32Array(this.buffer,l,2),u,this):d==="vec3u"?new H(new Uint32Array(this.buffer,l,3),u,this):d==="vec4u"?new H(new Uint32Array(this.buffer,l,4),u,this):u instanceof Ks&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new te(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new te(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Lt(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof ds)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof os?e+="{...}":e="[...]";return e}}class xi extends gr{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new xi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=Rb[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Rb[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Rb[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return MX(new Uint8Array(u),e,n,r,i,l,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,d=this.data[i];(function(h,g,_,x,w,S,b,T,A,R){const E=x*(b>>=w)*(S>>=w)+_*b+g*T;switch(A){case"r8unorm":return void it(h,E,"8unorm",1,R);case"r8snorm":return void it(h,E,"8snorm",1,R);case"r8uint":return void it(h,E,"8uint",1,R);case"r8sint":return void it(h,E,"8sint",1,R);case"rg8unorm":return void it(h,E,"8unorm",2,R);case"rg8snorm":return void it(h,E,"8snorm",2,R);case"rg8uint":return void it(h,E,"8uint",2,R);case"rg8sint":return void it(h,E,"8sint",2,R);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void it(h,E,"8unorm",4,R);case"rgba8snorm":return void it(h,E,"8snorm",4,R);case"rgba8uint":return void it(h,E,"8uint",4,R);case"rgba8sint":return void it(h,E,"8sint",4,R);case"r16uint":return void it(h,E,"16uint",1,R);case"r16sint":return void it(h,E,"16sint",1,R);case"r16float":return void it(h,E,"16float",1,R);case"rg16uint":return void it(h,E,"16uint",2,R);case"rg16sint":return void it(h,E,"16sint",2,R);case"rg16float":return void it(h,E,"16float",2,R);case"rgba16uint":return void it(h,E,"16uint",4,R);case"rgba16sint":return void it(h,E,"16sint",4,R);case"rgba16float":return void it(h,E,"16float",4,R);case"r32uint":return void it(h,E,"32uint",1,R);case"r32sint":return void it(h,E,"32sint",1,R);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void it(h,E,"32float",1,R);case"rg32uint":return void it(h,E,"32uint",2,R);case"rg32sint":return void it(h,E,"32sint",2,R);case"rg32float":return void it(h,E,"32float",2,R);case"rgba32uint":return void it(h,E,"32uint",4,R);case"rgba32sint":return void it(h,E,"32sint",4,R);case"rgba32float":return void it(h,E,"32float",4,R);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,n,r,i,u,l,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ne||(ne={}));class re{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class q{}le=q,q.none=new re("",ne.reserved,""),q.eof=new re("EOF",ne.token,""),q.reserved={asm:new re("asm",ne.reserved,"asm"),bf16:new re("bf16",ne.reserved,"bf16"),do:new re("do",ne.reserved,"do"),enum:new re("enum",ne.reserved,"enum"),f16:new re("f16",ne.reserved,"f16"),f64:new re("f64",ne.reserved,"f64"),handle:new re("handle",ne.reserved,"handle"),i8:new re("i8",ne.reserved,"i8"),i16:new re("i16",ne.reserved,"i16"),i64:new re("i64",ne.reserved,"i64"),mat:new re("mat",ne.reserved,"mat"),premerge:new re("premerge",ne.reserved,"premerge"),regardless:new re("regardless",ne.reserved,"regardless"),typedef:new re("typedef",ne.reserved,"typedef"),u8:new re("u8",ne.reserved,"u8"),u16:new re("u16",ne.reserved,"u16"),u64:new re("u64",ne.reserved,"u64"),unless:new re("unless",ne.reserved,"unless"),using:new re("using",ne.reserved,"using"),vec:new re("vec",ne.reserved,"vec"),void:new re("void",ne.reserved,"void")},q.keywords={array:new re("array",ne.keyword,"array"),atomic:new re("atomic",ne.keyword,"atomic"),bool:new re("bool",ne.keyword,"bool"),f32:new re("f32",ne.keyword,"f32"),i32:new re("i32",ne.keyword,"i32"),mat2x2:new re("mat2x2",ne.keyword,"mat2x2"),mat2x3:new re("mat2x3",ne.keyword,"mat2x3"),mat2x4:new re("mat2x4",ne.keyword,"mat2x4"),mat3x2:new re("mat3x2",ne.keyword,"mat3x2"),mat3x3:new re("mat3x3",ne.keyword,"mat3x3"),mat3x4:new re("mat3x4",ne.keyword,"mat3x4"),mat4x2:new re("mat4x2",ne.keyword,"mat4x2"),mat4x3:new re("mat4x3",ne.keyword,"mat4x3"),mat4x4:new re("mat4x4",ne.keyword,"mat4x4"),ptr:new re("ptr",ne.keyword,"ptr"),sampler:new re("sampler",ne.keyword,"sampler"),sampler_comparison:new re("sampler_comparison",ne.keyword,"sampler_comparison"),struct:new re("struct",ne.keyword,"struct"),texture_1d:new re("texture_1d",ne.keyword,"texture_1d"),texture_2d:new re("texture_2d",ne.keyword,"texture_2d"),texture_2d_array:new re("texture_2d_array",ne.keyword,"texture_2d_array"),texture_3d:new re("texture_3d",ne.keyword,"texture_3d"),texture_cube:new re("texture_cube",ne.keyword,"texture_cube"),texture_cube_array:new re("texture_cube_array",ne.keyword,"texture_cube_array"),texture_multisampled_2d:new re("texture_multisampled_2d",ne.keyword,"texture_multisampled_2d"),texture_storage_1d:new re("texture_storage_1d",ne.keyword,"texture_storage_1d"),texture_storage_2d:new re("texture_storage_2d",ne.keyword,"texture_storage_2d"),texture_storage_2d_array:new re("texture_storage_2d_array",ne.keyword,"texture_storage_2d_array"),texture_storage_3d:new re("texture_storage_3d",ne.keyword,"texture_storage_3d"),texture_depth_2d:new re("texture_depth_2d",ne.keyword,"texture_depth_2d"),texture_depth_2d_array:new re("texture_depth_2d_array",ne.keyword,"texture_depth_2d_array"),texture_depth_cube:new re("texture_depth_cube",ne.keyword,"texture_depth_cube"),texture_depth_cube_array:new re("texture_depth_cube_array",ne.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new re("texture_depth_multisampled_2d",ne.keyword,"texture_depth_multisampled_2d"),texture_external:new re("texture_external",ne.keyword,"texture_external"),u32:new re("u32",ne.keyword,"u32"),vec2:new re("vec2",ne.keyword,"vec2"),vec3:new re("vec3",ne.keyword,"vec3"),vec4:new re("vec4",ne.keyword,"vec4"),bitcast:new re("bitcast",ne.keyword,"bitcast"),block:new re("block",ne.keyword,"block"),break:new re("break",ne.keyword,"break"),case:new re("case",ne.keyword,"case"),continue:new re("continue",ne.keyword,"continue"),continuing:new re("continuing",ne.keyword,"continuing"),default:new re("default",ne.keyword,"default"),diagnostic:new re("diagnostic",ne.keyword,"diagnostic"),discard:new re("discard",ne.keyword,"discard"),else:new re("else",ne.keyword,"else"),enable:new re("enable",ne.keyword,"enable"),fallthrough:new re("fallthrough",ne.keyword,"fallthrough"),false:new re("false",ne.keyword,"false"),fn:new re("fn",ne.keyword,"fn"),for:new re("for",ne.keyword,"for"),function:new re("function",ne.keyword,"function"),if:new re("if",ne.keyword,"if"),let:new re("let",ne.keyword,"let"),const:new re("const",ne.keyword,"const"),loop:new re("loop",ne.keyword,"loop"),while:new re("while",ne.keyword,"while"),private:new re("private",ne.keyword,"private"),read:new re("read",ne.keyword,"read"),read_write:new re("read_write",ne.keyword,"read_write"),return:new re("return",ne.keyword,"return"),requires:new re("requires",ne.keyword,"requires"),storage:new re("storage",ne.keyword,"storage"),switch:new re("switch",ne.keyword,"switch"),true:new re("true",ne.keyword,"true"),alias:new re("alias",ne.keyword,"alias"),type:new re("type",ne.keyword,"type"),uniform:new re("uniform",ne.keyword,"uniform"),var:new re("var",ne.keyword,"var"),override:new re("override",ne.keyword,"override"),workgroup:new re("workgroup",ne.keyword,"workgroup"),write:new re("write",ne.keyword,"write"),r8unorm:new re("r8unorm",ne.keyword,"r8unorm"),r8snorm:new re("r8snorm",ne.keyword,"r8snorm"),r8uint:new re("r8uint",ne.keyword,"r8uint"),r8sint:new re("r8sint",ne.keyword,"r8sint"),r16uint:new re("r16uint",ne.keyword,"r16uint"),r16sint:new re("r16sint",ne.keyword,"r16sint"),r16float:new re("r16float",ne.keyword,"r16float"),rg8unorm:new re("rg8unorm",ne.keyword,"rg8unorm"),rg8snorm:new re("rg8snorm",ne.keyword,"rg8snorm"),rg8uint:new re("rg8uint",ne.keyword,"rg8uint"),rg8sint:new re("rg8sint",ne.keyword,"rg8sint"),r32uint:new re("r32uint",ne.keyword,"r32uint"),r32sint:new re("r32sint",ne.keyword,"r32sint"),r32float:new re("r32float",ne.keyword,"r32float"),rg16uint:new re("rg16uint",ne.keyword,"rg16uint"),rg16sint:new re("rg16sint",ne.keyword,"rg16sint"),rg16float:new re("rg16float",ne.keyword,"rg16float"),rgba8unorm:new re("rgba8unorm",ne.keyword,"rgba8unorm"),rgba8unorm_srgb:new re("rgba8unorm_srgb",ne.keyword,"rgba8unorm_srgb"),rgba8snorm:new re("rgba8snorm",ne.keyword,"rgba8snorm"),rgba8uint:new re("rgba8uint",ne.keyword,"rgba8uint"),rgba8sint:new re("rgba8sint",ne.keyword,"rgba8sint"),bgra8unorm:new re("bgra8unorm",ne.keyword,"bgra8unorm"),bgra8unorm_srgb:new re("bgra8unorm_srgb",ne.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new re("rgb10a2unorm",ne.keyword,"rgb10a2unorm"),rg11b10float:new re("rg11b10float",ne.keyword,"rg11b10float"),rg32uint:new re("rg32uint",ne.keyword,"rg32uint"),rg32sint:new re("rg32sint",ne.keyword,"rg32sint"),rg32float:new re("rg32float",ne.keyword,"rg32float"),rgba16uint:new re("rgba16uint",ne.keyword,"rgba16uint"),rgba16sint:new re("rgba16sint",ne.keyword,"rgba16sint"),rgba16float:new re("rgba16float",ne.keyword,"rgba16float"),rgba32uint:new re("rgba32uint",ne.keyword,"rgba32uint"),rgba32sint:new re("rgba32sint",ne.keyword,"rgba32sint"),rgba32float:new re("rgba32float",ne.keyword,"rgba32float"),static_assert:new re("static_assert",ne.keyword,"static_assert")},q.tokens={decimal_float_literal:new re("decimal_float_literal",ne.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new re("hex_float_literal",ne.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new re("int_literal",ne.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new re("uint_literal",ne.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new re("name",ne.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new re("ident",ne.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new re("and",ne.token,"&"),and_and:new re("and_and",ne.token,"&&"),arrow:new re("arrow ",ne.token,"->"),attr:new re("attr",ne.token,"@"),forward_slash:new re("forward_slash",ne.token,"/"),bang:new re("bang",ne.token,"!"),bracket_left:new re("bracket_left",ne.token,"["),bracket_right:new re("bracket_right",ne.token,"]"),brace_left:new re("brace_left",ne.token,"{"),brace_right:new re("brace_right",ne.token,"}"),colon:new re("colon",ne.token,":"),comma:new re("comma",ne.token,","),equal:new re("equal",ne.token,"="),equal_equal:new re("equal_equal",ne.token,"=="),not_equal:new re("not_equal",ne.token,"!="),greater_than:new re("greater_than",ne.token,">"),greater_than_equal:new re("greater_than_equal",ne.token,">="),shift_right:new re("shift_right",ne.token,">>"),less_than:new re("less_than",ne.token,"<"),less_than_equal:new re("less_than_equal",ne.token,"<="),shift_left:new re("shift_left",ne.token,"<<"),modulo:new re("modulo",ne.token,"%"),minus:new re("minus",ne.token,"-"),minus_minus:new re("minus_minus",ne.token,"--"),period:new re("period",ne.token,"."),plus:new re("plus",ne.token,"+"),plus_plus:new re("plus_plus",ne.token,"++"),or:new re("or",ne.token,"|"),or_or:new re("or_or",ne.token,"||"),paren_left:new re("paren_left",ne.token,"("),paren_right:new re("paren_right",ne.token,")"),semicolon:new re("semicolon",ne.token,";"),star:new re("star",ne.token,"*"),tilde:new re("tilde",ne.token,"~"),underscore:new re("underscore",ne.token,"_"),xor:new re("xor",ne.token,"^"),plus_equal:new re("plus_equal",ne.token,"+="),minus_equal:new re("minus_equal",ne.token,"-="),times_equal:new re("times_equal",ne.token,"*="),division_equal:new re("division_equal",ne.token,"/="),modulo_equal:new re("modulo_equal",ne.token,"%="),and_equal:new re("and_equal",ne.token,"&="),or_equal:new re("or_equal",ne.token,"|="),xor_equal:new re("xor_equal",ne.token,"^="),shift_right_equal:new re("shift_right_equal",ne.token,">>="),shift_left_equal:new re("shift_left_equal",ne.token,"<<=")},q.simpleTokens={"@":le.tokens.attr,"{":le.tokens.brace_left,"}":le.tokens.brace_right,":":le.tokens.colon,",":le.tokens.comma,"(":le.tokens.paren_left,")":le.tokens.paren_right,";":le.tokens.semicolon},q.literalTokens={"&":le.tokens.and,"&&":le.tokens.and_and,"->":le.tokens.arrow,"/":le.tokens.forward_slash,"!":le.tokens.bang,"[":le.tokens.bracket_left,"]":le.tokens.bracket_right,"=":le.tokens.equal,"==":le.tokens.equal_equal,"!=":le.tokens.not_equal,">":le.tokens.greater_than,">=":le.tokens.greater_than_equal,">>":le.tokens.shift_right,"<":le.tokens.less_than,"<=":le.tokens.less_than_equal,"<<":le.tokens.shift_left,"%":le.tokens.modulo,"-":le.tokens.minus,"--":le.tokens.minus_minus,".":le.tokens.period,"+":le.tokens.plus,"++":le.tokens.plus_plus,"|":le.tokens.or,"||":le.tokens.or_or,"*":le.tokens.star,"~":le.tokens.tilde,_:le.tokens.underscore,"^":le.tokens.xor,"+=":le.tokens.plus_equal,"-=":le.tokens.minus_equal,"*=":le.tokens.times_equal,"/=":le.tokens.division_equal,"%=":le.tokens.modulo_equal,"&=":le.tokens.and_equal,"|=":le.tokens.or_equal,"^=":le.tokens.xor_equal,">>=":le.tokens.shift_right_equal,"<<=":le.tokens.shift_left_equal},q.regexTokens={decimal_float_literal:le.tokens.decimal_float_literal,hex_float_literal:le.tokens.hex_float_literal,int_literal:le.tokens.int_literal,uint_literal:le.tokens.uint_literal,ident:le.tokens.ident},q.storage_class=[le.keywords.function,le.keywords.private,le.keywords.workgroup,le.keywords.uniform,le.keywords.storage],q.access_mode=[le.keywords.read,le.keywords.write,le.keywords.read_write],q.sampler_type=[le.keywords.sampler,le.keywords.sampler_comparison],q.sampled_texture_type=[le.keywords.texture_1d,le.keywords.texture_2d,le.keywords.texture_2d_array,le.keywords.texture_3d,le.keywords.texture_cube,le.keywords.texture_cube_array],q.multisampled_texture_type=[le.keywords.texture_multisampled_2d],q.storage_texture_type=[le.keywords.texture_storage_1d,le.keywords.texture_storage_2d,le.keywords.texture_storage_2d_array,le.keywords.texture_storage_3d],q.depth_texture_type=[le.keywords.texture_depth_2d,le.keywords.texture_depth_2d_array,le.keywords.texture_depth_cube,le.keywords.texture_depth_cube_array,le.keywords.texture_depth_multisampled_2d],q.texture_external_type=[le.keywords.texture_external],q.any_texture_type=[...le.sampled_texture_type,...le.multisampled_texture_type,...le.storage_texture_type,...le.depth_texture_type,...le.texture_external_type],q.texel_format=[le.keywords.r8unorm,le.keywords.r8snorm,le.keywords.r8uint,le.keywords.r8sint,le.keywords.r16uint,le.keywords.r16sint,le.keywords.r16float,le.keywords.rg8unorm,le.keywords.rg8snorm,le.keywords.rg8uint,le.keywords.rg8sint,le.keywords.r32uint,le.keywords.r32sint,le.keywords.r32float,le.keywords.rg16uint,le.keywords.rg16sint,le.keywords.rg16float,le.keywords.rgba8unorm,le.keywords.rgba8unorm_srgb,le.keywords.rgba8snorm,le.keywords.rgba8uint,le.keywords.rgba8sint,le.keywords.bgra8unorm,le.keywords.bgra8unorm_srgb,le.keywords.rgb10a2unorm,le.keywords.rg11b10float,le.keywords.rg32uint,le.keywords.rg32sint,le.keywords.rg32float,le.keywords.rgba16uint,le.keywords.rgba16sint,le.keywords.rgba16float,le.keywords.rgba32uint,le.keywords.rgba32sint,le.keywords.rgba32float],q.const_literal=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.keywords.true,le.keywords.false],q.literal_or_ident=[le.tokens.ident,le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.tokens.name],q.element_count_expression=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.ident],q.template_types=[le.keywords.vec2,le.keywords.vec3,le.keywords.vec4,le.keywords.mat2x2,le.keywords.mat2x3,le.keywords.mat2x4,le.keywords.mat3x2,le.keywords.mat3x3,le.keywords.mat3x4,le.keywords.mat4x2,le.keywords.mat4x3,le.keywords.mat4x4,le.keywords.atomic,le.keywords.bitcast,...le.any_texture_type],q.attribute_name=[le.tokens.ident,le.keywords.block,le.keywords.diagnostic],q.assignment_operators=[le.tokens.equal,le.tokens.plus_equal,le.tokens.minus_equal,le.tokens.times_equal,le.tokens.division_equal,le.tokens.modulo_equal,le.tokens.and_equal,le.tokens.or_equal,le.tokens.xor_equal,le.tokens.shift_right_equal,le.tokens.shift_left_equal],q.increment_operators=[le.tokens.plus_plus,le.tokens.minus_minus];class o4{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return q.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==q.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class BX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new o4(q.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=q.simpleTokens[e];if(n)return this._addToken(n),!0;let r=q.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=q.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(q.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(q.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(q.tokens.minus_minus),!0;const u=this._tokens.length-1;if((q.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==q.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,d=this._tokens.length-1;for(let h=0;h<5&&d>=0&&q.assignment_operators.indexOf(this._tokens[d].type)===-1;++h,--d)if(this._tokens[d].type===q.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===q.none){let u=e,d=0;const h=2;for(let g=0;g<h;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==q.none){d=g;break}if(o===q.none)return r!==q.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=d+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==q.none&&(this._addToken(r),!0)}_findType(e){for(const r in q.regexTokens){const i=q.regexTokens[r];if(this._match(e,i.rule))return i}return q.literalTokens[e]||q.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new o4(e,n,this._line,this._start,this._current))}}function Ee(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const ud=new Float32Array(1),UX=new Uint32Array(ud.buffer),FX=new Uint32Array(ud.buffer),fd=new Int32Array(1),zX=new Float32Array(fd.buffer),$X=new Uint32Array(fd.buffer),dd=new Uint32Array(1),VX=new Float32Array(dd.buffer),qX=new Int32Array(dd.buffer);function l4(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return ud[0]=t,UX[0];if(n==="u32")return ud[0]=t,FX[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return fd[0]=t,zX[0];if(n==="u32")return fd[0]=t,$X[0]}else if(e==="u32"){if(n==="f32")return dd[0]=t,VX[0];if(n==="i32"||n==="x32")return dd[0]=t,qX[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class HX{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class _f{constructor(e,n){this.align=e,this.size=n}}class Yr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new CX,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof Cc&&this._functions.set(n.name,new HX(n));for(const n of e)if(n instanceof vi){const r=this.getTypeInfo(n,null);r instanceof os&&this.structs.push(r)}for(const n of e)if(n instanceof t2)this.aliases.push(this._getAliasInfo(n));else if(n instanceof J1){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new EX(r.name,s,r.attributes,i))}else if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new gf(r.name,o,i,s,r.attributes,es.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new gf(r.name,o,i,s,r.attributes,l?es.StorageTexture:es.Storage,r.access);u.access||(u.access="read"),this.storage.push(u)}else if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new gf(r.name,o,i,s,r.attributes,l?es.StorageTexture:es.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new gf(r.name,o,i,s,r.attributes,es.Sampler,r.access);this.samplers.push(l)}for(const n of e)if(n instanceof Cc){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,l=new RX(n.name,o==null?void 0:o.name,n.attributes);l.attributes=n.attributes,l.startLine=n.startLine,l.endLine=n.endLine,this.functions.push(l),this._functions.get(n.name).info=l,o&&(this._functions.get(n.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(n,!!o),l.inputs=this._getInputs(n.args),l.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(l)),l.arguments=n.args.map(u=>new AX(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof nD){if(r.value)if(Ee(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=n.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=n.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Kn)for(const l of this.overrides)r.name===l.name&&((o=n.info)===null||o===void 0||o.overrides.push(l))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof ld)s.push({});else if(o instanceof cd)s.pop();else if(o instanceof yi){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Wr){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof cc){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Kn){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof n2){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}else if(o instanceof e2){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof vi)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof vi)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new n4(r.name,s,i.name,o);n.push(l)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new n4("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof vi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof vi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new TX(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new SX(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Pf){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new k0(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof uc){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new ds(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof vi){const i=e,s=new os(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new t4(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof tc){const i=e,s=i.format instanceof _e,o=i.format?s?this.getTypeInfo(i.format,null):new hr(i.format,null):null,l=new Ks(i.name,o,n,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof ae){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Ks(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new hr(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof ds&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof k0&&this._updateTypeInfo(e.format),e instanceof os&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const d=e.members[l],h=this._getTypeSize(d);if(!h)continue;(n=this._getAlias(d.type.name))!==null&&n!==void 0||d.type;const g=h.align,_=h.size;r=this._roundUp(g,r+i),i=_,s=r,o=Math.max(o,g),d.offset=r,d.size=_,this._updateTypeInfo(d.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof t4&&(e=e.type),e instanceof hr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Yr._typeInfo[e.name];if(o!==void 0){const l=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new _f(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Yr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new _f(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof ds){let o=e,l=8,u=8;const d=this._getTypeSize(o.format);return d!==null&&(u=d.size,l=d.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new _f(Math.max(s,l),Math.max(i,u))}if(e instanceof os){let o=0,l=0,u=0,d=0,h=0;for(const g of e.members){const _=this._getTypeSize(g.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+d),d=_.size,h=u)}return l=this._roundUp(o,h+d),new _f(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof yi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof yi&&e.storage=="storage"}_isTextureVar(e){return e instanceof yi&&e.type!==null&&Yr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof yi&&e.type!==null&&Yr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Yr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Yr._textureTypes=q.any_texture_type.map(t=>t.name),Yr._samplerTypes=q.sampler_type.map(t=>t.name);let r2=0;class i2{constructor(e,n,r){this.id=r2++,this.name=e,this.value=n,this.node=r}clone(){return new i2(this.name,this.value,this.node)}}class s2{constructor(e){this.id=r2++,this.name=e.name,this.node=e}clone(){return new s2(this.node)}}class a2{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=r2++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new i2(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new a2(this)}}class WX{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class XX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof H)return r.data.forEach(s=>{s||(i=!1)}),new te(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H){const i=r.data.some(s=>s);return new te(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof te))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Lt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new te(o,this.getTypeInfo("u32"))}return new te(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new te(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new te(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new te(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new te(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new te(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new te(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new te(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H)return new H(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new te(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof H&&i instanceof H&&s instanceof H)return new H(r.data.map((d,h)=>this._clamp(d,i.data[h],s.data[h])),r.typeInfo);const o=r,l=i,u=s;return new te(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new te(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new te(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new te(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new H([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof H?new H(r.data.map(s=>s*i),r.typeInfo):new te(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof je){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new te(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new te(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new te(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof H&&i instanceof H?new te(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new te(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new te(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof H)return new H(r.data.map(d=>d>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new te(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof H&&i instanceof H&&s instanceof H){const o=this._dot(i.data,s.data);return new H(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new te(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new te(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new te(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof H&&i instanceof H&&s instanceof H)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new H(r.data.map((d,h)=>d*i.data[h]+s.data[h]),r.typeInfo);const o=r,l=i,u=s;return new te(o.value*l.value+u.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new te(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,d=~u;if(r instanceof H&&i instanceof H)return new H(r.data.map((_,x)=>_&d|i.data[x]<<l&u),r.typeInfo);const h=r.value,g=i.value;return new te(h&d|g<<l&u,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new te(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H){let s=0;return r.data.forEach(o=>{s+=o*o}),new te(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new te(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new te(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new te(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H)return new H(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H)return new H(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof H&&i instanceof H&&s instanceof H)return new H(r.data.map((u,d)=>r.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),r.typeInfo);const o=i,l=s;return new te(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H)return new H(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new te(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H){const i=this.Length(e,n).value;return new H(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H)return new H(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof H?new H(r.data.map(i=>i),r.typeInfo):new te(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof H?new H(r.data.map(i=>i*Math.PI/180),r.typeInfo):new te(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof H&&i instanceof H){const s=this._dot(r.data,i.data);return new H(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof H&&i instanceof H&&s instanceof te){const o=this._dot(i.data,r.data);return new H(r.data.map((l,u)=>{const d=1-s.value*s.value*(1-o*o);if(d<0)return 0;const h=Math.sqrt(d);return s.value*l-(s.value*o+h)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new te(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new te(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new te(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new te(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new te(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof H&&r instanceof H&&i instanceof H)return new H(s.data.map((d,h)=>this._smoothstep(r.data[h],i.data[h],d)),s.typeInfo);const o=r,l=i,u=s;return new te(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new te(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof H&&r instanceof H)return new H(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new te(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new te(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new te(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof je))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new je([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new je([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new je([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new je([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new je([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new je([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new je([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new je([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new je([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof H)return new H(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new te(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof Kn){const s=r.name,o=n.getVariableValue(s);if(o instanceof xi){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new te(l[0],this.getTypeInfo("u32")):u==="3d"?new H(l,this.getTypeInfo("vec3u")):u==="2d"?new H(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof H)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Kn){const o=r.name,l=n.getVariableValue(o);if(l instanceof xi){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=l.width||d<0||d>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const h=l.getPixel(u,d,0,s);return h===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new H(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof Kn){const i=r.name,s=n.getVariableValue(i);return s instanceof xi?new te(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof Kn){const i=r.name,s=n.getVariableValue(i);return s instanceof xi?new te(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof Kn){const i=r.name,s=n.getVariableValue(i);return s instanceof xi?new te(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof H)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Kn){const l=r.name,u=n.getVariableValue(l);if(u instanceof xi){const d=u.getMipLevelSize(0),h=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return h<0||h>=d[0]||g<0||g>=d[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(h,g,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value+=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicSub(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value-=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMax(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.max(u.value,l.value)),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMin(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.min(u.value,l.value)),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicAnd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value&l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicOr(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value|l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicXor(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value^l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicExchange(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const Cb={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},En={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class wn extends WX{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Yr,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new a2,this.builtins=new XX(this),this.typeInfo={bool:this.getTypeInfo(_e.bool),i32:this.getTypeInfo(_e.i32),u32:this.getTypeInfo(_e.u32),f32:this.getTypeInfo(_e.f32),f16:this.getTypeInfo(_e.f16),vec2f:this.getTypeInfo(ae.vec2f),vec2u:this.getTypeInfo(ae.vec2u),vec2i:this.getTypeInfo(ae.vec2i),vec2h:this.getTypeInfo(ae.vec2h),vec3f:this.getTypeInfo(ae.vec3f),vec3u:this.getTypeInfo(ae.vec3u),vec3i:this.getTypeInfo(ae.vec3i),vec3h:this.getTypeInfo(ae.vec3h),vec4f:this.getTypeInfo(ae.vec4f),vec4u:this.getTypeInfo(ae.vec4u),vec4i:this.getTypeInfo(ae.vec4i),vec4h:this.getTypeInfo(ae.vec4h),mat2x2f:this.getTypeInfo(ae.mat2x2f),mat2x3f:this.getTypeInfo(ae.mat2x3f),mat2x4f:this.getTypeInfo(ae.mat2x4f),mat3x2f:this.getTypeInfo(ae.mat3x2f),mat3x3f:this.getTypeInfo(ae.mat3x3f),mat3x4f:this.getTypeInfo(ae.mat3x4f),mat4x2f:this.getTypeInfo(ae.mat4x2f),mat4x3f:this.getTypeInfo(ae.mat4x3f),mat4x4f:this.getTypeInfo(ae.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof te)return i.value;if(i instanceof H||i instanceof je)return Array.from(i.data);if(i instanceof Lt&&i.typeInfo instanceof ds){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const l=n[0],u=n[1],d=n[2],h=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new H(n,h));for(const g in r)for(const _ in r[g]){const x=r[g][_];s.variables.forEach(w=>{var S;const b=w.node;if(b!=null&&b.attributes){let T=null,A=null;for(const R of b.attributes)R.name==="binding"?T=R.value:R.name==="group"&&(A=R.value);if(_==T&&g==A)if(x.texture!==void 0&&x.descriptor!==void 0){const R=new xi(x.texture,this.getTypeInfo(b.type),x.descriptor,(S=x.texture.view)!==null&&S!==void 0?S:null);w.value=R}else x.uniform!==void 0?w.value=new Lt(x.uniform,this.getTypeInfo(b.type)):w.value=new Lt(x,this.getTypeInfo(b.type))}})}for(let g=0;g<d;++g)for(let _=0;_<u;++_)for(let x=0;x<l;++x)s.setVariable("@workgroup_id",new H([x,_,g],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[x,_,g],s)}execStatement(e,n){if(e instanceof WP)return this.evalExpression(e.value,n);if(e instanceof YP){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof te))throw new Error("Invalid break-if condition");if(!r.value)return null}return wn._breakObj}if(e instanceof GP)return wn._continueObj;if(e instanceof cc)this._let(e,n);else if(e instanceof yi)this._var(e,n);else if(e instanceof Of)this._const(e,n);else if(e instanceof Cc)this._function(e,n);else{if(e instanceof HP)return this._if(e,n);if(e instanceof qP)return this._switch(e,n);if(e instanceof FP)return this._for(e,n);if(e instanceof UP)return this._while(e,n);if(e instanceof VP)return this._loop(e,n);if(e instanceof M0){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof $P)this._assign(e,n);else if(e instanceof zP)this._increment(e,n);else{if(e instanceof vi)return null;if(e instanceof J1){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new te(0,this.getTypeInfo("u32")))}else if(e instanceof e2)this._call(e,n);else{if(e instanceof XP||e instanceof t2)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Rr?this._evalBinaryOp(e,n):e instanceof Jt?this._evalLiteral(e,n):e instanceof Kn?this._evalVariable(e,n):e instanceof n2?this._evalCall(e,n):e instanceof Wr?this._evalCreate(e,n):e instanceof KP?this._evalConst(e,n):e instanceof ZP?this._evalBitcast(e,n):e instanceof Xt?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof _e){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new te(i,s.type)):s.type.name==="bool"?n.setVariable(r,new te(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new H(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const g=r.getVariableValue(h.value[0]);i[0]=g instanceof te?g.value:parseInt(h.value[0])}if(h.value.length>1){const g=r.getVariableValue(h.value[1]);i[1]=g instanceof te?g.value:parseInt(h.value[1])}if(h.value.length>2){const g=r.getVariableValue(h.value[2]);i[2]=g instanceof te?g.value:parseInt(h.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new H(i,s));const l=i[0],u=i[1],d=i[2];for(let h=0,g=0;h<d;++h)for(let _=0;_<u;++_)for(let x=0;x<l;++x,++g){const w=[x,_,h],S=[x+n[0]*i[0],_+n[1]*i[1],h+n[2]*i[2]];r.setVariable("@local_invocation_id",new H(w,s)),r.setVariable("@global_invocation_id",new H(S,s)),r.setVariable("@local_invocation_index",new te(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Xt;)e=e.right;return e instanceof Kn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof te?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof te?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Kn){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Xt){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof so?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new so(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Xt){const u=this._getVariableData(e.variable,n),d=this.evalExpression(e.value,n),h=e.operator;if(h==="="){if(u instanceof te||u instanceof H||u instanceof je){if(d instanceof te||d instanceof H||d instanceof je&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Lt&&d instanceof Lt&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(h==="+=")return u instanceof te||u instanceof H||u instanceof je?d instanceof te||d instanceof H||d instanceof je?void u.data.set(d.data.map((g,_)=>u.data[_]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(h==="-=")return(u instanceof te||u instanceof H||u instanceof je)&&(d instanceof te||d instanceof H||d instanceof je)?void u.data.set(d.data.map((g,_)=>u.data[_]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Xt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const u=n.getVariable(i);if(!(u&&u.value instanceof so))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let d=e.variable.postfix;if(!d){let h=e.variable.right;for(;h instanceof Xt;){if(h.postfix){d=h.postfix;break}h=h.right}}d&&(r=r.getSubData(this,d,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const u=n.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof so&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),l=e.operator;if(l==="=")if(r instanceof Lt)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof H||r instanceof je))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof Ao){const u=this.evalExpression(s.index,n).value;if(r instanceof H){if(!(o instanceof te))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof je))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,n).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof H))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=r.typeInfo.getTypeName();if(h==="mat2x2"||h==="mat2x2f"||h==="mat2x2h"){if(!(d<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat2x3"||h==="mat2x3f"||h==="mat2x3h"){if(!(d<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat2x4"||h==="mat2x4f"||h==="mat2x4h"){if(!(d<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat3x2"||h==="mat3x2f"||h==="mat3x2h"){if(!(d<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat3x3"||h==="mat3x3f"||h==="mat3x3h"){if(!(d<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat3x4"||h==="mat3x4f"||h==="mat3x4h"){if(!(d<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat4x2"||h==="mat4x2f"||h==="mat4x2h"){if(!(d<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat4x3"||h==="mat4x3f"||h==="mat4x3h"){if(!(d<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else{if(h!=="mat4x4"&&h!=="mat4x4f"&&h!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}}}}}else if(s instanceof Zs){const u=s.value;if(!(r instanceof H))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof te){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof H))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const h=u[d];if(h==="x"||h==="r")r.data[0]=o.data[d];else if(h==="y"||h==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[d]}else if(h==="z"||h==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[d]}else{if(h!=="w"&&h!=="a")return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[d]}}}}}else r instanceof te&&o instanceof te?r.value=o.value:r instanceof H&&o instanceof H||r instanceof je&&o instanceof je?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const u=r.getSubData(this,s,n);if(u instanceof H&&o instanceof te){const d=u.data,h=o.value;if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h;else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h;else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h;else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h;else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h;else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h;else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h;else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h;else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h;else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof H&&o instanceof H){const d=u.data,h=o.data;if(d.length!==h.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h[g];else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h[g];else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h[g];else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h[g];else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h[g];else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h[g];else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h[g];else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h[g];else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h[g];else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h[g];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof te&&o instanceof te))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}r instanceof Lt&&r.setDataValue(this,u,s,n)}}_function(e,n){const r=new s2(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Wr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof uc||e.type instanceof vi||e.type instanceof ae){const s=new Wr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof eD)for(const o of s.selectors){if(o instanceof Df){i=s;continue}const l=this.evalExpression(o,n);if(!(l instanceof te))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,n)}else s instanceof tD&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof te?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r!==null&&r!==wn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r===wn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===wn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r!==wn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof te){const s=l4(r.value,r.typeInfo.name,i.name);return new te(s,this.getTypeInfo(i))}if(r instanceof H){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(h,g,_){if(g===_)return h;const x=new Array(h.length);for(let w=0;w<h.length;w++)x[w]=l4(h[w],g,_);return x}(Array.from(r.data),o,u);return new H(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof Wr){if(e.type===null)return I0.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof Wr?e.type.name:e.name,s=e instanceof Wr?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Lt(new ArrayBuffer(s.size),s,0);if(s instanceof os){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],d=e.args[l],h=this.evalExpression(d,n);o.setData(this,h,u.type,u.offset,n)}}else if(s instanceof ds){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],h=this.evalExpression(d,n);s.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=h.typeInfo),o.setData(this,h,s.format,l,n),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Wr?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new te(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=wn._priority.get(n.name);wn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new so(r);if(e.operator==="*")return r instanceof so?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof te?r.value:r instanceof H?Array.from(r.data):null;switch(e.operator){case"+":{if(Ee(i)){const l=i.map((u,d)=>+u);return new H(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(+s,o)}case"-":{if(Ee(i)){const l=i.map((u,d)=>-u);return new H(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(-s,o)}case"!":{if(Ee(i)){const l=i.map((u,d)=>u?0:1);return new H(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(s?0:1,o)}case"~":{if(Ee(i)){const l=i.map((u,d)=>~u);return new H(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof te?r.value:r instanceof H||r instanceof je?Array.from(r.data):null,o=i instanceof te?i.value:i instanceof H||i instanceof je?Array.from(i.data):null;switch(e.operator){case"+":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x+g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_+h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h+_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l+u,d)}case"-":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x-g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_-h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h-_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l-u,d)}case"*":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(r instanceof je&&i instanceof je){const _=function(b,T,A,R){if(En[T.name]===void 0||En[R.name]===void 0)return null;const E=En[T.name][0],C=En[T.name][1],O=En[R.name][0];if(E!==En[R.name][1])return null;const P=new Array(O*C);for(let k=0;k<C;k++)for(let I=0;I<O;I++){let N=0;for(let B=0;B<E;B++)N+=b[B*C+k]*A[I*E+B];P[k*O+I]=N}return P}(h,r.typeInfo,g,i.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const x=En[i.typeInfo.name][0],w=En[r.typeInfo.name][1],S=this.getTypeInfo(`mat${x}x${w}f`);return new je(_,S)}if(r instanceof je&&i instanceof H){const _=function(x,w,S,b){if(En[w.name]===void 0||Cb[b.name]===void 0)return null;const T=En[w.name][0],A=En[w.name][1];if(T!==S.length)return null;const R=new Array(A);for(let E=0;E<A;E++){let C=0;for(let O=0;O<T;O++)C+=x[O*A+E]*S[O];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new H(_,i.typeInfo)}if(r instanceof H&&i instanceof je){const _=function(x,w,S,b){if(Cb[w.name]===void 0||En[b.name]===void 0)return null;const T=En[b.name][0],A=En[b.name][1];if(A!==x.length)return null;const R=[];for(let E=0;E<T;E++){let C=0;for(let O=0;O<A;O++)C+=x[O]*S[O*T+E];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new H(_,r.typeInfo)}{if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x*g[w]);return new H(_,r.typeInfo)}}if(Ee(s)){const h=o,g=s.map((_,x)=>_*h);return r instanceof je?new je(g,r.typeInfo):new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h*_);return i instanceof je?new je(g,i.typeInfo):new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l*u,d)}case"%":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x%g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_%h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h%_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l%u,d)}case"/":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x/g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_/h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h/_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l/u,d)}case"&":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x&g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_&h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h&_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l&u,d)}case"|":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x|g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_|h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h|_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l|u,d)}case"^":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x^g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_^h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h^_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l^u,d)}case"<<":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x<<g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_<<h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h<<_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l<<u,d)}case">>":{if(Ee(s)&&Ee(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((x,w)=>x>>g[w]);return new H(_,r.typeInfo)}if(Ee(s)){const h=o,g=s.map((_,x)=>_>>h);return new H(g,r.typeInfo)}if(Ee(o)){const h=s,g=o.map((_,x)=>h>>_);return new H(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l>>u,d)}case">":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d>l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l>d?1:0);return new H(u,i.typeInfo)}return new te(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d<l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l<d?1:0);return new H(u,i.typeInfo)}return new te(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h===u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d==l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l==d?1:0);return new H(u,i.typeInfo)}return new te(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h!==u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d!==l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l!==d?1:0);return new H(u,i.typeInfo)}return new te(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>=u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d>=l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l>=d?1:0);return new H(u,i.typeInfo)}return new te(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<=u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d<=l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l<=d?1:0);return new H(u,i.typeInfo)}return new te(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h&&u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d&&l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l&&d?1:0);return new H(u,i.typeInfo)}return new te(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Ee(s)&&Ee(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h||u[g]?1:0);return new H(d,r.typeInfo)}if(Ee(s)){const l=o,u=s.map((d,h)=>d||l?1:0);return new H(u,r.typeInfo)}if(Ee(o)){const l=s,u=o.map((d,h)=>l||d?1:0);return new H(u,i.typeInfo)}return new te(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothStep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new te(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Cb[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Jt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);if(u instanceof H){const d=u.data;for(let h=0;h<d.length;++h){let g=d[h];o.push(g)}}else if(u instanceof te){let d=u.value;o.push(d)}}if(e.type instanceof ae&&e.type.format===null&&(e.type.format=ae.f32),o.length===0){const l=new Array(s).fill(0);return new H(l,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new H(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=En[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Jt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);u instanceof H?o.push(...u.data):u instanceof te?o.push(u.value):u instanceof je&&o.push(...u.data)}if(r instanceof Ks&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new je(l,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new je(o,r).getSubData(this,e.postfix,n)}}wn._breakObj=new gr(new hr("BREAK",null),null),wn._continueObj=new gr(new hr("CONTINUE",null),null),wn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class YX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class GX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new YX,this._exec=new wn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Kn){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof a4||i instanceof Pf?i.type=this._forwardType(i.type):i instanceof uc?i.format=this._forwardType(i.format):i instanceof yi||i instanceof cc||i instanceof Of?i.type=this._forwardType(i.type):i instanceof Cc?i.returnType=this._forwardType(i.returnType):i instanceof s4&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof i4){const n=this._getType(e.name);if(n)return n}else e instanceof Pf?e.type=this._forwardType(e.type):e instanceof uc&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new BX(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==q.eof}_match(e){if(e instanceof re)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===q.tokens.name&&(i=!0)}if(i){const s=q.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===q.tokens.name){const r=q.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(q.tokens.semicolon)&&!this._isAtEnd(););if(this._match(q.keywords.alias)){const n=this._type_alias();return this._consume(q.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(q.keywords.diagnostic)){const n=this._diagnostic();return this._consume(q.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(q.keywords.requires)){const n=this._requires_directive();return this._consume(q.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(q.keywords.enable)){const n=this._enable_directive();return this._consume(q.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(q.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(q.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(q.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(q.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(q.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(q.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(q.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(q.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(q.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(q.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(q.keywords.fn))return null;const e=this._currentLine,n=this._consume(q.tokens.ident,"Expected function name.").toString();this._consume(q.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(q.tokens.paren_right))do{if(this._check(q.tokens.paren_right))break;const l=this._attribute(),u=this._consume(q.tokens.name,"Expected argument name.").toString();this._consume(q.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=d,r.push(this._updateNode(new s4(u,h,l))))}while(this._match(q.tokens.comma));this._consume(q.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(q.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new Cc(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(q.tokens.brace_left,"Expected '{' for block.");!this._check(q.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(q.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(q.tokens.semicolon)&&!this._isAtEnd(););if(this._check(q.tokens.attr)&&this._attribute(),this._check(q.keywords.if))return this._if_statement();if(this._check(q.keywords.switch))return this._switch_statement();if(this._check(q.keywords.loop))return this._loop_statement();if(this._check(q.keywords.for))return this._for_statement();if(this._check(q.keywords.while))return this._while_statement();if(this._check(q.keywords.continuing))return this._continuing_statement();if(this._check(q.keywords.static_assert))return this._static_assert_statement();if(this._check(q.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(q.keywords.return))e=this._return_statement();else if(this._check([q.keywords.var,q.keywords.let,q.keywords.const]))e=this._variable_statement();else if(this._match(q.keywords.discard))e=this._updateNode(new DX);else if(this._match(q.keywords.break)){const n=this._updateNode(new YP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(q.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(q.keywords.continue)){const n=this._updateNode(new GP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(q.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(q.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new IX(n),e)}_while_statement(){if(!this._match(q.keywords.while))return null;const e=this._updateNode(new UP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(q.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(q.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new M0(r,e),n)}_for_statement(){if(!this._match(q.keywords.for))return null;this._consume(q.tokens.paren_left,"Expected '('.");const e=this._updateNode(new FP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(q.tokens.semicolon)?null:this._for_init(),this._consume(q.tokens.semicolon,"Expected ';'."),e.condition=this._check(q.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(q.tokens.semicolon,"Expected ';'."),e.increment=this._check(q.tokens.paren_right)?null:this._for_increment(),this._consume(q.tokens.paren_right,"Expected ')'."),this._check(q.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(q.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(q.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new yi(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(q.keywords.let)){const e=this._currentLine,n=this._consume(q.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(q.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(q.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new cc(n,r,null,null,i),e)}if(this._match(q.keywords.const)){const e=this._currentLine,n=this._consume(q.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(q.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(q.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Jt&&(r=i.type),this._updateNode(new Of(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(q.increment_operators))return this._current=e,null;const r=this._consume(q.increment_operators,"Expected increment operator");return this._updateNode(new zP(r.type===q.tokens.plus_plus?fo.increment:fo.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(q.tokens.brace_right))return null;let r=this._match(q.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(q.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new $P(ec.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(q.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(q.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new e2(r.lexeme,i),e)}_loop_statement(){if(!this._match(q.keywords.loop))return null;this._check(q.tokens.attr)&&this._attribute(),this._consume(q.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new VP([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof M0){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(q.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(q.keywords.switch))return null;const e=this._updateNode(new qP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(q.tokens.attr)&&this._attribute(),this._consume(q.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(q.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([q.keywords.default,q.keywords.case]);){if(this._match(q.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof Df){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(q.tokens.colon),this._check(q.tokens.attr)&&this._attribute(),this._consume(q.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(q.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new eD(r,i)))}if(this._match(q.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(q.tokens.colon),this._check(q.tokens.attr)&&this._attribute(),this._consume(q.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(q.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new tD(r)))}}return e}_case_selectors(){const e=[];for(this._match(q.keywords.default)?e.push(this._updateNode(new Df)):e.push(this._shift_expression());this._match(q.tokens.comma);)this._match(q.keywords.default)?e.push(this._updateNode(new Df)):e.push(this._shift_expression());return e}_case_body(){if(this._match(q.keywords.fallthrough))return this._consume(q.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(q.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(q.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(q.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(q.keywords.else)&&(this._check(q.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new HP(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===q.keywords.else&&this._tokens[this._current+1].type===q.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new jX(n,r))),this._match_elseif()&&(this._check(q.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(q.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new WP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(q.tokens.or_or);)e=this._updateNode(new Rr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(q.tokens.and_and);)e=this._updateNode(new Rr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(q.tokens.or);)e=this._updateNode(new Rr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(q.tokens.xor);)e=this._updateNode(new Rr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(q.tokens.and);)e=this._updateNode(new Rr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([q.tokens.equal_equal,q.tokens.not_equal])?this._updateNode(new Rr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([q.tokens.less_than,q.tokens.greater_than,q.tokens.less_than_equal,q.tokens.greater_than_equal]);)e=this._updateNode(new Rr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([q.tokens.shift_left,q.tokens.shift_right]);)e=this._updateNode(new Rr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([q.tokens.plus,q.tokens.minus]);)e=this._updateNode(new Rr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([q.tokens.star,q.tokens.forward_slash,q.tokens.modulo]);)e=this._updateNode(new Rr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([q.tokens.minus,q.tokens.bang,q.tokens.tilde,q.tokens.star,q.tokens.and])?this._updateNode(new Xt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(q.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(q.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new Ao(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(q.tokens.period)){const e=this._consume(q.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Zs(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return _e.void;case"bool":return _e.bool;case"i32":return _e.i32;case"u32":return _e.u32;case"f32":return _e.f32;case"f16":return _e.f16;case"vec2f":return ae.vec2f;case"vec3f":return ae.vec3f;case"vec4f":return ae.vec4f;case"vec2i":return ae.vec2i;case"vec3i":return ae.vec3i;case"vec4i":return ae.vec4i;case"vec2u":return ae.vec2u;case"vec3u":return ae.vec3u;case"vec4u":return ae.vec4u;case"vec2h":return ae.vec2h;case"vec3h":return ae.vec3h;case"vec4h":return ae.vec4h;case"mat2x2f":return ae.mat2x2f;case"mat2x3f":return ae.mat2x3f;case"mat2x4f":return ae.mat2x4f;case"mat3x2f":return ae.mat3x2f;case"mat3x3f":return ae.mat3x3f;case"mat3x4f":return ae.mat3x4f;case"mat4x2f":return ae.mat4x2f;case"mat4x3f":return ae.mat4x3f;case"mat4x4f":return ae.mat4x4f;case"mat2x2h":return ae.mat2x2h;case"mat2x3h":return ae.mat2x3h;case"mat2x4h":return ae.mat2x4h;case"mat3x2h":return ae.mat3x2h;case"mat3x3h":return ae.mat3x3h;case"mat3x4h":return ae.mat3x4h;case"mat4x2h":return ae.mat4x2h;case"mat4x3h":return ae.mat4x3h;case"mat4x4h":return ae.mat4x4h;case"mat2x2i":return ae.mat2x2i;case"mat2x3i":return ae.mat2x3i;case"mat2x4i":return ae.mat2x4i;case"mat3x2i":return ae.mat3x2i;case"mat3x3i":return ae.mat3x3i;case"mat3x4i":return ae.mat3x4i;case"mat4x2i":return ae.mat4x2i;case"mat4x3i":return ae.mat4x3i;case"mat4x4i":return ae.mat4x4i;case"mat2x2u":return ae.mat2x2u;case"mat2x3u":return ae.mat2x3u;case"mat2x4u":return ae.mat2x4u;case"mat3x2u":return ae.mat3x2u;case"mat3x3u":return ae.mat3x3u;case"mat3x4u":return ae.mat3x4u;case"mat4x2u":return ae.mat4x2u;case"mat4x3u":return ae.mat4x3u;case"mat4x4u":return ae.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(q.tokens.ident)){const r=this._previous().toString();if(this._check(q.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Wr(s,i)):this._updateNode(new n2(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new KP(r,i.value))}return this._updateNode(new Kn(r))}if(this._match(q.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?_e.i32:r.endsWith("u")||r.endsWith("U")?_e.u32:_e.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Jt(new te(s,this._exec.getTypeInfo(i)),i))}if(this._match(q.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_e.u32),this._updateNode(new Jt(new te(r,this._exec.getTypeInfo(_e.u32)),_e.u32))}if(this._match([q.tokens.decimal_float_literal,q.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?_e.f16:_e.f32);const o=i?_e.f16:_e.f32;return this._updateNode(new Jt(new te(s,this._exec.getTypeInfo(o)),o))}if(this._match([q.keywords.true,q.keywords.false])){let r=this._previous().toString()===q.keywords.true.rule;return this._updateNode(new Jt(new te(r?1:0,this._exec.getTypeInfo(_e.bool)),_e.bool))}if(this._check(q.tokens.paren_left))return this._paren_expression();if(this._match(q.keywords.bitcast)){this._consume(q.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(q.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new ZP(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new Wr(e,n))}_argument_expression_list(){if(!this._match(q.tokens.paren_left))return null;const e=[];do{if(this._check(q.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(q.tokens.comma));return this._consume(q.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(q.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(q.tokens.paren_right),e}_paren_expression(){this._consume(q.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(q.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(q.keywords.struct))return null;const e=this._currentLine,n=this._consume(q.tokens.ident,"Expected name for struct.").toString();this._consume(q.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(q.tokens.brace_right);){const o=this._attribute(),l=this._consume(q.tokens.name,"Expected variable name.").toString();this._consume(q.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(q.tokens.brace_right)?this._match(q.tokens.comma):this._consume(q.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new a4(l,d,o)))}this._consume(q.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new vi(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(q.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Jt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Jt&&(e.type=e.value.type.name==="x32"?_e.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(q.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(q.keywords.const))return null;const n=this._consume(q.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(q.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(q.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[_e.f32],d=o.constEvaluate(this._exec,u);d instanceof te&&this._validateTypeRange(d.value,u[0]),u[0]instanceof ae&&u[0].format===null&&d.typeInfo instanceof Ks&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=_e.f16:d.typeInfo.format.name==="f32"?u[0].format=_e.f32:d.typeInfo.format.name==="i32"?u[0].format=_e.i32:d.typeInfo.format.name==="u32"?u[0].format=_e.u32:d.typeInfo.format.name==="bool"?u[0].format=_e.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new Jt(d,u[0])),this._exec.context.setVariable(n.toString(),d)}catch{s=o}if(i!==null&&s instanceof Jt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Jt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:_e.f32,i===_e.x32&&(i=_e.i32));const l=this._updateNode(new Of(n.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(q.keywords.let))return null;const e=this._currentLine,n=this._consume(q.tokens.name,"Expected variable name");let r=null;if(this._match(q.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(q.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Jt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Jt&&(r=i.type.name==="x32"?_e.i32:i.type);return i instanceof Jt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new cc(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(q.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(q.tokens.less_than)&&(n=this._consume(q.storage_class,"Expected storage_class.").toString(),this._match(q.tokens.comma)&&(r=this._consume(q.access_mode,"Expected access_mode.").toString()),this._consume(q.tokens.greater_than,"Expected '>'."));const i=this._consume(q.tokens.name,"Expected variable name");let s=null;if(this._match(q.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new yi(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(q.keywords.override))return null;const e=this._consume(q.tokens.name,"Expected variable name");let n=null;if(this._match(q.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new J1(e.toString(),n,null))}_diagnostic(){this._consume(q.tokens.paren_left,"Expected '('");const e=this._consume(q.tokens.ident,"Expected severity control name.");this._consume(q.tokens.comma,"Expected ','");let n=this._consume(q.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(q.tokens.period)&&(n+=`.${this._consume(q.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(q.tokens.paren_right,"Expected ')'"),this._updateNode(new XP(e.toString(),n))}_enable_directive(){const e=this._consume(q.tokens.ident,"identity expected.");return this._updateNode(new OX(e.toString()))}_requires_directive(){const e=[this._consume(q.tokens.ident,"identity expected.").toString()];for(;this._match(q.tokens.comma);){const n=this._consume(q.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new PX(e))}_type_alias(){const e=this._consume(q.tokens.ident,"identity expected.");this._consume(q.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new t2(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([q.tokens.ident,...q.texel_format,q.keywords.bool,q.keywords.f32,q.keywords.i32,q.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new i4(r));return this._forwardTypeCount++,i}return this._updateNode(new _e(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(q.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(q.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(q.tokens.comma)&&(s=this._consume(q.access_mode,"Expected access_mode for pointer").toString()),this._consume(q.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ae(r,i,s))}if(this._match(q.keywords.ptr)){let r=this._previous().toString();this._consume(q.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(q.storage_class,"Expected storage_class for pointer");this._consume(q.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(q.tokens.comma)&&(o=this._consume(q.access_mode,"Expected access_mode for pointer").toString()),this._consume(q.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Pf(r,i.toString(),s,o))}const n=this._attribute();if(this._match(q.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(q.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(q.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(q.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new uc(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(q.sampler_type))return this._updateNode(new tc(this._previous().toString(),null,null));if(this._match(q.depth_texture_type))return this._updateNode(new tc(this._previous().toString(),null,null));if(this._match(q.sampled_texture_type)||this._match(q.multisampled_texture_type)){const e=this._previous();this._consume(q.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(q.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new tc(e.toString(),n,null))}if(this._match(q.storage_texture_type)){const e=this._previous();this._consume(q.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(q.texel_format,"Invalid texel format.").toString();this._consume(q.tokens.comma,"Expected ',' after texel format.");const r=this._consume(q.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(q.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new tc(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(q.tokens.attr);){const n=this._consume(q.attribute_name,"Expected attribute name"),r=this._updateNode(new nD(n.toString(),null));if(this._match(q.tokens.paren_left)){if(r.value=this._consume(q.literal_or_ident,"Expected attribute value").toString(),this._check(q.tokens.comma)){this._advance();do{const i=this._consume(q.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(q.tokens.comma))}this._consume(q.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class KX extends Yr{constructor(e){super(),e&&this.update(e)}update(e){const n=new GX().parse(e);this.updateAST(n)}}function ZX(t){var s;const e={attributes:[],bindings:[]};let n;try{n=QX(t)}catch(o){return ye.error(o.message)(),e}for(const o of n.uniforms){const l=[];for(const u of((s=o.type)==null?void 0:s.members)||[])l.push({name:u.name,type:c4(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const l=r.inputs[o];if(l.locationType==="location"){const u=c4(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function c4(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function QX(t){try{return new KX(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const JX={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...JX}};const pr=globalThis.mathgl.config;function eY(t,{precision:e=pr.precision}={}){return t=tY(t),`${parseFloat(t.toPrecision(e))}`}function Ro(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zn(t,e,n){return rY(t,r=>Math.max(e,Math.min(n,r)))}function hd(t,e,n){return Ro(t)?t.map((r,i)=>hd(r,e[i],n)):n*e+(1-n)*t}function Nc(t,e,n){const r=pr.EPSILON;try{if(t===e)return!0;if(Ro(t)&&Ro(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Nc(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=pr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{pr.EPSILON=r}}function tY(t){return Math.round(t/pr.EPSILON)*pr.EPSILON}function nY(t){return t.clone?t.clone():new Array(t.length)}function rY(t,e,n){if(Ro(t)){const r=t;n=n||nY(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class rD extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ro(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(pr)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+eY(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Nc(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(pr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function iY(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Gn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Nb(t,e,n=""){if(pr.debug&&!iY(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function u4(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class sY extends rD{get x(){return this[0]}set x(e){this[0]=Gn(e)}get y(){return this[1]}set y(e){this[1]=Gn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Gn(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Gn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return u4(e>=0&&e<this.ELEMENTS,"index is out of range"),Gn(this[e])}setComponent(e,n){return u4(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const jf=1e-6;let Co=typeof Float32Array<"u"?Float32Array:Array;function aY(){const t=new Co(2);return Co!=Float32Array&&(t[0]=0,t[1]=0),t}function f4(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function oY(t,e){return t[0]=-e[0],t[1]=-e[1],t}function iD(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function lY(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=aY();return function(e,n,r,i,s,o){let l,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],s(t,t,o),e[l]=t[0],e[l+1]=t[1];return e}})();function cY(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function sD(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function uY(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function fY(){const t=new Co(3);return Co!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dY(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function hY(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function pY(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mY(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],l=n[1],u=n[2];return t[0]=i*u-s*l,t[1]=s*o-r*u,t[2]=r*l-i*o,t}function aD(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function gY(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function _Y(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],l=e[0],u=e[1],d=e[2];let h=i*d-s*u,g=s*l-r*d,_=r*u-i*l,x=i*_-s*g,w=s*h-r*_,S=r*g-i*h;const b=o*2;return h*=b,g*=b,_*=b,x*=2,w*=2,S*=2,t[0]=l+h+x,t[1]=u+g+w,t[2]=d+_+S,t}function vY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function xY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function yY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function bY(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+l*l)),d=u&&pY(t,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const wY=dY;(function(){const t=fY();return function(e,n,r,i,s,o){let l,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const kb=[0,0,0];let vf;class Kr extends sY{static get ZERO(){return vf||(vf=new Kr(0,0,0),Object.freeze(vf)),vf}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Ro(e)?this.copy(e):(pr.debug&&(Gn(e),Gn(n),Gn(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return pr.debug&&(Gn(e.x),Gn(e.y),Gn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Gn(e)}angle(e){return bY(this,e)}cross(e){return mY(this,this,e),this.check()}rotateX({radians:e,origin:n=kb}){return vY(this,this,n,e),this.check()}rotateY({radians:e,origin:n=kb}){return xY(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=kb}){return yY(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return aD(this,this,e),this.check()}transformAsVector(e){return sD(this,this,e),this.check()}transformByMatrix3(e){return gY(this,this,e),this.check()}transformByMatrix2(e){return uY(this,this,e),this.check()}transformByQuaternion(e){return _Y(this,this,e),this.check()}}class SY extends rD{toString(){let e="[";if(pr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Gn(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function TY(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function EY(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function O0(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],d=e[7],h=e[8],g=e[9],_=e[10],x=e[11],w=e[12],S=e[13],b=e[14],T=e[15],A=n*l-r*o,R=n*u-i*o,E=n*d-s*o,C=r*u-i*l,O=r*d-s*l,P=i*d-s*u,k=h*S-g*w,I=h*b-_*w,N=h*T-x*w,B=g*b-_*S,V=g*T-x*S,Z=_*T-x*b;let j=A*Z-R*V+E*B+C*N-O*I+P*k;return j?(j=1/j,t[0]=(l*Z-u*V+d*B)*j,t[1]=(i*V-r*Z-s*B)*j,t[2]=(S*P-b*O+T*C)*j,t[3]=(_*O-g*P-x*C)*j,t[4]=(u*N-o*Z-d*I)*j,t[5]=(n*Z-i*N+s*I)*j,t[6]=(b*E-w*P-T*R)*j,t[7]=(h*P-_*E+x*R)*j,t[8]=(o*V-l*N+d*k)*j,t[9]=(r*N-n*V-s*k)*j,t[10]=(w*O-S*E+T*A)*j,t[11]=(g*E-h*O-x*A)*j,t[12]=(l*I-o*B-u*k)*j,t[13]=(n*B-r*I+i*k)*j,t[14]=(S*R-w*C-b*A)*j,t[15]=(h*C-g*R+_*A)*j,t):null}function AY(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=t[6],u=t[7],d=t[8],h=t[9],g=t[10],_=t[11],x=t[12],w=t[13],S=t[14],b=t[15],T=e*o-n*s,A=e*l-r*s,R=n*l-r*o,E=d*w-h*x,C=d*S-g*x,O=h*S-g*w,P=e*O-n*C+r*E,k=s*O-o*C+l*E,I=d*R-h*A+g*T,N=x*R-w*A+S*T;return u*P-i*k+b*I-_*N}function qs(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],d=e[6],h=e[7],g=e[8],_=e[9],x=e[10],w=e[11],S=e[12],b=e[13],T=e[14],A=e[15];let R=n[0],E=n[1],C=n[2],O=n[3];return t[0]=R*r+E*l+C*g+O*S,t[1]=R*i+E*u+C*_+O*b,t[2]=R*s+E*d+C*x+O*T,t[3]=R*o+E*h+C*w+O*A,R=n[4],E=n[5],C=n[6],O=n[7],t[4]=R*r+E*l+C*g+O*S,t[5]=R*i+E*u+C*_+O*b,t[6]=R*s+E*d+C*x+O*T,t[7]=R*o+E*h+C*w+O*A,R=n[8],E=n[9],C=n[10],O=n[11],t[8]=R*r+E*l+C*g+O*S,t[9]=R*i+E*u+C*_+O*b,t[10]=R*s+E*d+C*x+O*T,t[11]=R*o+E*h+C*w+O*A,R=n[12],E=n[13],C=n[14],O=n[15],t[12]=R*r+E*l+C*g+O*S,t[13]=R*i+E*u+C*_+O*b,t[14]=R*s+E*d+C*x+O*T,t[15]=R*o+E*h+C*w+O*A,t}function pd(t,e,n){const r=n[0],i=n[1],s=n[2];let o,l,u,d,h,g,_,x,w,S,b,T;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],d=e[3],h=e[4],g=e[5],_=e[6],x=e[7],w=e[8],S=e[9],b=e[10],T=e[11],t[0]=o,t[1]=l,t[2]=u,t[3]=d,t[4]=h,t[5]=g,t[6]=_,t[7]=x,t[8]=w,t[9]=S,t[10]=b,t[11]=T,t[12]=o*r+h*i+w*s+e[12],t[13]=l*r+g*i+S*s+e[13],t[14]=u*r+_*i+b*s+e[14],t[15]=d*r+x*i+T*s+e[15]),t}function o2(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function RY(t,e,n,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,d,h,g,_,x,w,S,b,T,A,R,E,C,O,P,k,I,N,B,V,Z,j,Y;return l<jf?null:(l=1/l,i*=l,s*=l,o*=l,d=Math.sin(n),u=Math.cos(n),h=1-u,g=e[0],_=e[1],x=e[2],w=e[3],S=e[4],b=e[5],T=e[6],A=e[7],R=e[8],E=e[9],C=e[10],O=e[11],P=i*i*h+u,k=s*i*h+o*d,I=o*i*h-s*d,N=i*s*h-o*d,B=s*s*h+u,V=o*s*h+i*d,Z=i*o*h+s*d,j=s*o*h-i*d,Y=o*o*h+u,t[0]=g*P+S*k+R*I,t[1]=_*P+b*k+E*I,t[2]=x*P+T*k+C*I,t[3]=w*P+A*k+O*I,t[4]=g*N+S*B+R*V,t[5]=_*N+b*B+E*V,t[6]=x*N+T*B+C*V,t[7]=w*N+A*B+O*V,t[8]=g*Z+S*j+R*Y,t[9]=_*Z+b*j+E*Y,t[10]=x*Z+T*j+C*Y,t[11]=w*Z+A*j+O*Y,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function oD(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],l=e[6],u=e[7],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+d*r,t[5]=o*i+h*r,t[6]=l*i+g*r,t[7]=u*i+_*r,t[8]=d*i-s*r,t[9]=h*i-o*r,t[10]=g*i-l*r,t[11]=_*i-u*r,t}function CY(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-d*r,t[1]=o*i-h*r,t[2]=l*i-g*r,t[3]=u*i-_*r,t[8]=s*r+d*i,t[9]=o*r+h*i,t[10]=l*r+g*i,t[11]=u*r+_*i,t}function lD(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[4],h=e[5],g=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+d*r,t[1]=o*i+h*r,t[2]=l*i+g*r,t[3]=u*i+_*r,t[4]=d*i-s*r,t[5]=h*i-o*r,t[6]=g*i-l*r,t[7]=_*i-u*r,t}function NY(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,l=r+r,u=i+i,d=n*o,h=r*o,g=r*l,_=i*o,x=i*l,w=i*u,S=s*o,b=s*l,T=s*u;return t[0]=1-g-w,t[1]=h+T,t[2]=_-b,t[3]=0,t[4]=h-T,t[5]=1-d-w,t[6]=x+S,t[7]=0,t[8]=_+b,t[9]=x-S,t[10]=1-d-g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kY(t,e,n,r,i,s,o){const l=1/(n-e),u=1/(i-r),d=1/(s-o);return t[0]=s*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(i+r)*u,t[10]=(o+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*d,t[15]=0,t}function MY(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const IY=MY;function OY(t,e,n,r,i,s,o){const l=1/(e-n),u=1/(r-i),d=1/(s-o);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*l,t[13]=(i+r)*u,t[14]=(o+s)*d,t[15]=1,t}const PY=OY;function DY(t,e,n,r){let i,s,o,l,u,d,h,g,_,x;const w=e[0],S=e[1],b=e[2],T=r[0],A=r[1],R=r[2],E=n[0],C=n[1],O=n[2];return Math.abs(w-E)<jf&&Math.abs(S-C)<jf&&Math.abs(b-O)<jf?TY(t):(g=w-E,_=S-C,x=b-O,i=1/Math.sqrt(g*g+_*_+x*x),g*=i,_*=i,x*=i,s=A*x-R*_,o=R*g-T*x,l=T*_-A*g,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=_*l-x*o,d=x*s-g*l,h=g*o-_*s,i=Math.sqrt(u*u+d*d+h*h),i?(i=1/i,u*=i,d*=i,h*=i):(u=0,d=0,h=0),t[0]=s,t[1]=u,t[2]=g,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=l,t[9]=h,t[10]=x,t[11]=0,t[12]=-(s*w+o*S+l*b),t[13]=-(u*w+d*S+h*b),t[14]=-(g*w+_*S+x*b),t[15]=1,t)}function jY(){const t=new Co(4);return Co!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function LY(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function qc(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=jY();return function(e,n,r,i,s,o){let l,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var P0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(P0||(P0={}));const BY=45*Math.PI/180,UY=1,Mb=.1,Ib=500,FY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Or extends SY{static get IDENTITY(){return $Y()}static get ZERO(){return zY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return P0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,l,u,d,h,g,_,x,w,S,b){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=d,this[9]=h,this[10]=g,this[11]=_,this[12]=x,this[13]=w,this[14]=S,this[15]=b,this.check()}setRowMajor(e,n,r,i,s,o,l,u,d,h,g,_,x,w,S,b){return this[0]=e,this[1]=s,this[2]=d,this[3]=x,this[4]=n,this[5]=o,this[6]=h,this[7]=w,this[8]=r,this[9]=l,this[10]=g,this[11]=S,this[12]=i,this[13]=u,this[14]=_,this[15]=b,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(FY)}fromObject(e){return this.check()}fromQuaternion(e){return NY(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Mb,far:l=Ib}=e;return l===1/0?VY(this,n,r,i,s,o):kY(this,n,r,i,s,o,l),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return DY(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Mb,far:l=Ib}=e;return PY(this,n,r,i,s,o,l),this.check()}orthographic(e){const{fovy:n=BY,aspect:r=UY,focalDistance:i=1,near:s=Mb,far:o=Ib}=e;d4(n);const l=n/2,u=i*Math.tan(l),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return d4(n),IY(this,n,r,i,s),this.check()}determinant(){return AY(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return EY(this,this),this.check()}invert(){return O0(this,this),this.check()}multiplyLeft(e){return qs(this,e,this),this.check()}multiplyRight(e){return qs(this,this,e),this.check()}rotateX(e){return oD(this,this,e),this.check()}rotateY(e){return CY(this,this,e),this.check()}rotateZ(e){return lD(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return RY(this,this,e,n),this.check()}scale(e){return o2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return pd(this,this,e),this.check()}transform(e,n){return e.length===4?(n=qc(n||[-0,-0,-0,-0],e,this),Nb(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=lY(n||[-0,-0],e,this);break;case 3:i=aD(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nb(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=cY(n||[-0,-0],e,this);break;case 3:r=sD(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nb(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let xf,yf;function zY(){return xf||(xf=new Or([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(xf)),xf}function $Y(){return yf||(yf=new Or,Object.freeze(yf)),yf}function d4(t){if(t>Math.PI*2)throw Error("expected radians")}function VY(t,e,n,r,i,s){const o=2*s/(n-e),l=2*s/(i-r),u=(n+e)/(n-e),d=(i+r)/(i-r),h=-1,g=-1,_=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=u,t[9]=d,t[10]=h,t[11]=g,t[12]=0,t[13]=0,t[14]=_,t[15]=0,t}function cD(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function qY(t){return t-Math.fround(t)}function HY(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;cD(t[r*4+n],e,i*2)}return e}const WY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,XY={name:"fp32",vs:WY},YY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,GY={ONE:1},KY={name:"fp64arithmetic",vs:YY,defaultUniforms:GY,uniformTypes:{ONE:"f32"},fp64ify:cD,fp64LowPart:qY,fp64ifyMatrix4:HY},ZY=[0,1,1,1],QY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,JY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,h4={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:ZY},vs:QY,fs:JY,getUniforms:eG};function eG(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const p4=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,tG={name:"layer",vs:p4,fs:p4,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},nG=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,uD="#define SMOOTH_EDGE_RADIUS 0.5",rG=`${uD}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,iG=`${uD}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,fD={name:"geometry",source:nG,vs:rG,fs:iG},sG=25;var Yt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Yt||(Yt={}));var en;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(en||(en={}));var Ue;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Ue||(Ue={}));const aG="compute",oG="auto",D0="manipulation",Lf="none",j0="pan-x",L0="pan-y";function lG(t){if(t.includes(Lf))return Lf;const e=t.includes(j0),n=t.includes(L0);return e&&n?Lf:e||n?e?j0:L0:t.includes(D0)?D0:oG}class cG{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===aG&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return lG(e.join(" "))}}function md(t){return t.trim().split(/\s+/g)}function Ob(t,e,n){if(t)for(const r of md(e))t.addEventListener(r,n,!1)}function Pb(t,e,n){if(t)for(const r of md(e))t.removeEventListener(r,n,!1)}function m4(t){return(t.ownerDocument||t).defaultView}function uG(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function dD(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function g4(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:dD(e),deltaX:t.deltaX,deltaY:t.deltaY}}function hD(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function _4(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function fG(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function v4(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function pD(t,e){return t===e?en.None:Math.abs(t)>=Math.abs(e)?t<0?en.Left:en.Right:e<0?en.Up:en.Down}function dG(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===Yt.Start||(s==null?void 0:s.eventType)===Yt.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function mD(t,e,n){return{x:e/t||0,y:n/t||0}}function hG(t,e){return _4(e[0],e[1])/_4(t[0],t[1])}function pG(t,e){return v4(e[1],e[0])-v4(t[1],t[0])}function mG(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,l;if(e.eventType!==Yt.Cancel&&(r>sG||n.velocity===void 0)){const u=e.deltaX-n.deltaX,d=e.deltaY-n.deltaY,h=mD(r,u,d);s=h.x,o=h.y,i=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,l=pD(u,d),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,l=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function gG(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=g4(e)),i>1&&!n.firstMultiple?n.firstMultiple=g4(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,l=o?o.center:s.center,u=e.center=dD(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=fG(l,u),e.distance=hD(l,u);const{deltaX:d,deltaY:h}=dG(n,e);e.deltaX=d,e.deltaY=h,e.offsetDirection=pD(e.deltaX,e.deltaY);const g=mD(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?hG(o.pointers,r):1,e.rotation=o?pG(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let _=t.element;return uG(e.srcEvent.target,_)&&(_=e.srcEvent.target),e.target=_,mG(n,e),e}function _G(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&Yt.Start&&r-i===0,o=e&(Yt.End|Yt.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const l=gG(t,n);t.emit("hammer.input",l),t.recognize(l),t.session.prevInput=l}let vG=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){_G(this.manager,e,n)}init(){Ob(this.element,this.evEl,this.domHandler),Ob(this.target,this.evTarget,this.domHandler),Ob(m4(this.element),this.evWin,this.domHandler)}destroy(){Pb(this.element,this.evEl,this.domHandler),Pb(this.target,this.evTarget,this.domHandler),Pb(m4(this.element),this.evWin,this.domHandler)}};const xG={pointerdown:Yt.Start,pointermove:Yt.Move,pointerup:Yt.End,pointercancel:Yt.Cancel,pointerout:Yt.Cancel},yG="pointerdown",bG="pointermove pointerup pointercancel";class wG extends vG{constructor(e){super(e),this.evEl=yG,this.evWin=bG,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=xG[e.type],s=e.pointerType,o=s==="touch";let l=n.findIndex(u=>u.pointerId===e.pointerId);i&Yt.Start&&(e.buttons||o)?l<0&&(n.push(e),l=n.length-1):i&(Yt.End|Yt.Cancel)&&(r=!0),!(l<0)&&(n[l]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(l,1))}}const SG=["","webkit","Moz","MS","ms","o"];function TG(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of SG){const i=r?r+n:e;if(i in t)return i}}const EG=1,x4=2,y4={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class AG{constructor(e,n){this.options={...y4,...n,cssProps:{...y4.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new wG(this),this.touchAction=new cG(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?x4:EG}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&Ue.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==x4&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(Ue.Began|Ue.Changed|Ue.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of md(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of md(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=TG(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let RG=1;function CG(){return RG++}function b4(t){return t&Ue.Cancelled?"cancel":t&Ue.Ended?"end":t&Ue.Changed?"move":t&Ue.Began?"start":""}class gD{constructor(e){this.options=e,this.id=CG(),this.state=Ue.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<Ue.Ended&&this.manager.emit(this.options.event+b4(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=Ue.Ended&&this.manager.emit(this.options.event+b4(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ue.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ue.Failed|Ue.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=Ue.Failed;return}this.state&(Ue.Recognized|Ue.Cancelled|Ue.Failed)&&(this.state=Ue.Possible),this.state=this.process(n),this.state&(Ue.Began|Ue.Changed|Ue.Ended|Ue.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class _D extends gD{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(Ue.Began|Ue.Changed),s=this.attrTest(e);return i&&(r&Yt.Cancel||!s)?n|Ue.Cancelled:i||s?r&Yt.End?n|Ue.Ended:n&Ue.Began?n|Ue.Changed:Ue.Began:Ue.Failed}}class w4 extends gD{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[D0]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&Yt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==Yt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,l=!this.pCenter||hD(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ue.Recognized,this.tryEmit(this._input)},n.interval),Ue.Began):Ue.Recognized}return Ue.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ue.Failed},this.options.interval),Ue.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ue.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const NG=["","start","move","end","cancel","up","down","left","right"];class S4 extends _D{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:en.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&en.Horizontal&&n.push(L0),e&en.Vertical&&n.push(j0),n}getEventNames(){return NG.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&n.direction||(n.direction&en.Horizontal?(s=o===0?en.None:o<0?en.Left:en.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?en.None:l<0?en.Up:en.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ue.Began)||!(this.state&Ue.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=en[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const kG=["","start","move","end","cancel","in","out"];class MG extends _D{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Lf]}getEventNames(){return kG.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ue.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class vh{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const IG=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",OG=IG.indexOf("firefox")!==-1,T4=4.000244140625,PG=40,DG=.25;class jG extends vh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(OG&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=PG)),s!==0&&s%T4===0&&(s=Math.floor(s/T4)),i.shiftKey&&s&&(s=s*DG),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const E4=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class LG extends vh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,E4.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){E4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const A4=["keydown","keyup"];class BG extends vh{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",A4.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){A4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class UG extends vh{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const R4=1,B0=2,C4=4,FG={pointerdown:R4,pointermove:B0,pointerup:C4,mousedown:R4,mousemove:B0,mouseup:C4},zG=0,$G=1,VG=2,qG=1,HG=2,WG=4;function XG(t){const e=FG[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===B0?(i=!!(n&qG),s=!!(n&WG),o=!!(n&HG)):(i=r===zG,s=r===$G,o=r===VG),{leftButton:i,middleButton:s,rightButton:o}}function YG(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const GG={srcElement:"root",priority:0};class KG{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...GG,...r};let d=l.get(u.srcElement);d||(d=[],l.set(u.srcElement,d));const h={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let g=d.length-1;for(;g>=0&&!(d[g].priority>=h.priority);)g--;d.splice(g+1,0,h)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:d,handler:h,once:g}=r[u];if(h({...e,type:d,stopPropagation:s,stopImmediatePropagation:o}),g&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:d,handler:h}=l[u];this.remove(d,h)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...XG(e),...YG(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function ZG(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class QG{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new AG(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=ZG(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new jG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new LG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new BG(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new UG(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,l,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(l=this.keyInput)==null||l.enableEventType(e,n),(u=this.contextmenuInput)==null||u.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[d,h]of Object.entries(e))this._addEventHandler(d,h,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new KG(this,d),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const tt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(tt,"IDENTITY",{get:()=>(xt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const dr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qs={common:0,meters:1,pixels:2},U0={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},N4={multipan:[S4,{threshold:10,direction:en.Vertical,pointers:2}],pinch:[MG,{},null,["multipan"]],pan:[S4,{threshold:1},["pinch"],["multipan"]],dblclick:[w4,{event:"dblclick",taps:2}],click:[w4,{event:"click"},null,["dblclick"]]};function JG(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Hc(t){let e={},n;return r=>{for(const i in r)if(!JG(r[i],e[i])){n=t(r),e=r;break}return n}}const k4=[0,0,0,0],eK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],vD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tK=[0,0,0],xD=[0,0,0],nK=Hc(sK);function yD(t,e,n=xD){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===tt.LNGLAT_OFFSETS||e===tt.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case dr.WEB_MERCATOR:(e===tt.LNGLAT||e===tt.CARTESIAN)&&(i=[0,0,0],s=!1);break;case dr.WEB_MERCATOR_AUTO_OFFSET:e===tt.LNGLAT?r=i:e===tt.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case dr.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case dr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function rK(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,l=k4,u=k4,d=t.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:g,offsetMode:_}=yD(t,e,n);return _&&(u=t.projectPosition(h||g),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,l=qc([],u,o),s=r||s,o=qs([],i,s),o=qs([],o,eK)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:g,geospatialOrigin:h}}function iK({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=tt.DEFAULT,coordinateOrigin:i=xD,autoWrapLongitude:s=!1}){r===tt.DEFAULT&&(r=t.isGeospatial?tt.LNGLAT:tt.CARTESIAN);const o=nK({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||vD,o}function sK({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:d}=rK(t,n,r),h=t.getDistanceScales(),g=[t.width*e,t.height*e],_=qc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,x={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:_,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:tK,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:vD,cameraPosition:l};if(d){const w=t.getDistanceScales(d);switch(n){case tt.METER_OFFSETS:x.commonUnitsPerWorldUnit=w.unitsPerMeter,x.commonUnitsPerWorldUnit2=w.unitsPerMeter2;break;case tt.LNGLAT:case tt.LNGLAT_OFFSETS:t._pseudoMeters||(x.commonUnitsPerMeter=w.unitsPerMeter),x.commonUnitsPerWorldUnit=w.unitsPerDegree,x.commonUnitsPerWorldUnit2=w.unitsPerDegree2;break;case tt.CARTESIAN:x.commonUnitsPerWorldUnit=[1,1,w.unitsPerMeter[2]],x.commonUnitsPerWorldUnit2=[0,0,w.unitsPerMeter2[2]];break}}return x}const aK=Object.keys(tt).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${tt[t]};`).join(""),oK=Object.keys(dr).map(t=>`const PROJECTION_MODE_${t}: i32 = ${dr[t]};`).join(""),lK=Object.keys(Qs).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Qs[t]};`).join(""),cK=`${aK}
${oK}
${lK}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,uK=`${cK}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,fK=Object.keys(tt).map(t=>`const int COORDINATE_SYSTEM_${t} = ${tt[t]};`).join(""),dK=Object.keys(dr).map(t=>`const int PROJECTION_MODE_${t} = ${dr[t]};`).join(""),hK=Object.keys(Qs).map(t=>`const int UNIT_${t.toUpperCase()} = ${Qs[t]};`).join(""),pK=`${fK}
${dK}
${hK}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,mK={};function gK(t=mK){return"viewport"in t?iK(t):{}}const l2={name:"project",dependencies:[XY,fD],source:uK,vs:pK,getUniforms:gK,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},_K=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vK=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,bD={name:"project32",dependencies:[l2],source:_K,vs:vK};function xK(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yo(t,e){const n=qc([],e,t);return LY(n,n,1/n[3]),n}function M4(t,e){const n=t%e;return n<0?e+n:n}function F0(t,e,n){return t<e?e:t>n?n:t}function yK(t){return Math.log(t)*Math.LOG2E}const c2=Math.log2||yK;function Si(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const kr=Math.PI,wD=kr/4,mr=kr/180,z0=180/kr,No=512,gd=4003e4,I4=85.051129,bK=1.5;function wK(t){return c2(t)}function _d(t){const[e,n]=t;Si(Number.isFinite(e)),Si(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*mr,i=n*mr,s=No*(r+kr)/(2*kr),o=No*(kr+Math.log(Math.tan(wD+i*.5)))/(2*kr);return[s,o]}function ko(t){const[e,n]=t,r=e/No*(2*kr)-kr,i=2*(Math.atan(Math.exp(n/No*(2*kr)-kr))-wD);return[r*z0,i*z0]}function SK(t){const{latitude:e}=t;Si(Number.isFinite(e));const n=Math.cos(e*mr);return wK(gd*n)-9}function Db(t){const e=Math.cos(t*mr);return No/gd/e}function $0(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;Si(Number.isFinite(e)&&Number.isFinite(n));const i=No,s=Math.cos(e*mr),o=i/360,l=o/s,u=i/gd/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const h=mr*Math.tan(e*mr)/s,g=o*h/2,_=i/gd*h,x=_/l*u;d.unitsPerDegree2=[0,g,_],d.unitsPerMeter2=[x,0,x]}return d}function SD(t,e){const[n,r,i]=t,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:d}=$0({longitude:n,latitude:r,highPrecision:!0}),h=_d(t);h[0]+=s*(u[0]+d[0]*o),h[1]+=o*(u[1]+d[1]*o);const g=ko(h),_=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[g[0],g[1],_]:g}function TK(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,l=xK();pd(l,l,[0,0,-i]),oD(l,l,-n*mr),lD(l,l,r*mr);const u=s/e;return o2(l,l,[u,u,u]),o&&pd(l,l,hY([],o)),l}function EK(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:d=1}=t;let{fovy:h=vd(bK)}=t;r!==void 0&&(h=vd(r));const g=h*mr,_=i*mr,x=u2(h);let w=x;o&&(w+=o[2]*l/Math.cos(_)/n);const S=g*(.5+(s?s[1]:0)/n),b=Math.sin(S)*w/Math.sin(F0(Math.PI/2-_-S,.01,Math.PI-.01)),T=Math.sin(_)*b+w,A=w*10,R=Math.min(T*d,A);return{fov:g,aspect:e/n,focalDistance:x,near:u,far:R}}function vd(t){return 2*Math.atan(.5/t)*z0}function u2(t){return .5/Math.tan(.5*t*mr)}function TD(t,e){const[n,r,i=0]=t;return Si(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),yo(e,[n,r,i,1])}function xh(t,e,n=0){const[r,i,s]=t;if(Si(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return yo(e,[r,i,s,1]);const o=yo(e,[r,i,0,1]),l=yo(e,[r,i,1,1]),u=o[2],d=l[2],h=u===d?0:((n||0)-u)/(d-u);return iD([],o,l,h)}function AK(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[l,u],[d,h]]=r,g=RK(t.padding),_=_d([l,F0(h,-85.051129,I4)]),x=_d([d,F0(u,-85.051129,I4)]),w=[Math.max(Math.abs(x[0]-_[0]),i),Math.max(Math.abs(x[1]-_[1]),i)],S=[e-g.left-g.right-Math.abs(o[0])*2,n-g.top-g.bottom-Math.abs(o[1])*2];Si(S[0]>0&&S[1]>0);const b=S[0]/w[0],T=S[1]/w[1],A=(g.right-g.left)/2/b,R=(g.top-g.bottom)/2/T,E=[(x[0]+_[0])/2+A,(x[1]+_[1])/2+R],C=ko(E),O=Math.min(s,c2(Math.abs(Math.min(b,T))));return Si(Number.isFinite(O)),{longitude:C[0],latitude:C[1],zoom:O}}function RK(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Si(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const O4=Math.PI/180;function CK(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),l=i([n,r],s);let u,d;const h=t.fovy?.5*t.fovy*O4:Math.atan(.5/t.altitude),g=(90-t.pitch)*O4;return h>g-.01?(u=P4(t,0,e),d=P4(t,n,e)):(u=i([0,0],s),d=i([n,0],s)),[o,l,d,u]}function P4(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=yo(r,[e,0,1,1]),s=yo(r,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=iD([],i,s,l),d=ko(u);return d.push(n),d}const D4=512;function NK(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=t;(i<-180||i>180)&&(i=M4(i+180,360)-180),(l<-180||l>180)&&(l=M4(l+180,360)-180);const u=c2(n/D4);if(o<=u)o=u,s=0;else{const d=n/2/Math.pow(2,o),h=ko([0,d])[1];if(s<h)s=h;else{const g=ko([0,D4-d])[1];s>g&&(s=g)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const ED=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,kK=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MK=`
${ED}
${kK}
`,IK=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,OK=`
${ED}
${IK}
`,PK=Hc(UK),DK=Hc(FK),jK=[0,0,0,1],LK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function BK(t,e){const[n,r,i]=t,s=xh([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function UK({viewport:t,center:e}){return new Or(t.viewProjectionMatrix).invert().transform(e)}function FK({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>BK(o,r));for(const o of e){const l=o.clone().translate(new Kr(t.center).negate()),u=s.map(h=>l.transform(h)),d=new Or().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});n.push(d.multiplyRight(o))}return n}function zK(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=l2.getUniforms(n),i=PK({viewport:n.viewport,center:r.center}),s=[],o=DK({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const d=o[u],h=d.clone().translate(new Kr(n.viewport.center).negate());r.coordinateSystem===tt.LNGLAT&&r.projectionMode===dr.WEB_MERCATOR?(o[u]=h,s[u]=i):(o[u]=d.clone().multiplyRight(LK),s[u]=h.transform(i))}const l={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||jK,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return l}const j4={name:"shadow",dependencies:[l2],vs:MK,fs:OK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:zK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},AD={...h4,defaultUniforms:{...h4.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},$K=[fD],VK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],qK=[];function HK(t){const e=td.getDefaultShaderAssembler();for(const r of $K)e.addDefaultModule(r);const n=t==="glsl"?VK:qK;for(const r of n)e.addShaderHook(r);return e}const WK=[255,255,255],XK=1;let YK=0;class GK{constructor(e={}){this.type="ambient";const{color:n=WK}=e,{intensity:r=XK}=e;this.id=e.id||`ambient-${YK++}`,this.color=n,this.intensity=r}}const KK=[255,255,255],ZK=1,QK=[0,0,-1];let JK=0;class L4{constructor(e={}){this.type="directional";const{color:n=KK}=e,{intensity:r=ZK}=e,{direction:i=QK}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${JK++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Kr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class eZ{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class f2 extends eZ{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,n,r]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(h,e)}finally{h.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=n;n.pass=n.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const h of s){const g=o&&o[h.id];l==null||l(h);const _=this._getDrawLayerParams(h,n),x=h.subViewports||[h];for(const w of x){const S=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:w,view:g,pass:n.pass,layers:n.layers},_);d.push(S)}}return d}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},d=!1){var w;const h=[],g=RD(this._lastRenderIndex+1),_={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},x={};for(let S=0;S<n.length;S++){const b=n[S],T=this._shouldDrawLayer(b,_,s,x),A={shouldDrawLayer:T};T&&!d&&(A.shouldDrawLayer=!0,A.layerRenderIndex=g(b,T),A.shaderModuleProps=this._getShaderModuleProps(b,l,r,u),A.layerParameters={...(w=b.context.deck)==null?void 0:w.props.parameters,...this.getLayerParameters(b,S,e)}),h[S]=A}return h}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const d=tZ(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const g=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const h={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let g=0;g<n.length;g++){const _=n[g],x=u[g],{shouldDrawLayer:w}=x;if(w&&_.props.pickable&&h.pickableCount++,_.isComposite&&h.compositeCount++,_.isDrawable&&x.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:b,layerParameters:T}=x;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),b.project&&(b.project.viewport=o),_.context.renderPass=e;try{_._drawLayer({renderPass:e,shaderModuleProps:b,uniforms:{layerIndex:S},parameters:T})}catch(A){_.raiseError(A,`drawing ${_} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const l=n.layer.id;if(l in i||(i[l]=r(n)),!i[l])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const h of n)B4(l,(d=h.getShaderModuleProps)==null?void 0:d.call(h,e,l));return B4(l,this.getShaderModuleProps(e,n,l),i)}}function RD(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in n){const h=n[u]=n[u]||RD(e[u],e);d=h(i,s),n[l]=h}else Number.isFinite(o)?(d=o+(e[u]||0),n[l]=null):d=t;return s&&d>=t&&(t=d+1),e[l]=d,d};return r}function tZ(t,{shaderModuleProps:e,target:n,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function B4(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class nZ extends f2{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:l,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const rZ={color:[255,255,255],intensity:1},U4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],iZ=[0,0,0,200/255];class CD{constructor(e={}){this.id="lighting-effect",this.shadowColor=iZ,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(j4),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(j4))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Or().lookAt({eye:new Kr(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new nZ(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new GK(rZ),this.directionalLights.push(new L4(U4[0]),new L4(U4[1])))}}class sZ{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,h=n*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,h)}let g=1/0;u&&(g=u*r+s);const _=this._allocate(d,h,l,g);return e&&o?_.set(e):l||_.fill(0,0,4),this._release(e),_}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(d=>d.byteLength>=l);if(u>=0){const d=new e(o.splice(u,1)[0],0,s);return r&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const kc=new sZ;function nc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aZ(t,e){const n=t%e;return n<0?e+n:n}function oZ(t){return[t[12],t[13],t[14]]}function lZ(t){return{left:ao(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ao(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ao(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ao(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ao(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ao(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const F4=new Kr;function ao(t,e,n,r){F4.set(t,e,n);const i=F4.len();return{distance:r/i,normal:new Kr(-t/i,-e/i,-n/i)}}function cZ(t){return t-Math.fround(t)}let Hl;function jb(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Hl=kc.allocate(Hl,s,{type:Float32Array,size:n*2});let o=r,l=0;for(;o<i;){for(let u=0;u<n;u++){const d=t[o++];Hl[l+u]=d,Hl[l+u+n]=cZ(d)}l+=n*2}return Hl.subarray(0,s*n*2)}function uZ(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const fZ=Math.PI/180,dZ=nc(),z4=[0,0,0],hZ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function pZ({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=t/e,d=n?new Or().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new Or().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:h=0,right:g=0,top:_=0,bottom:x=0}=s,w=Zn((h+t-g)/2,0,t)-t/2,S=Zn((_+e-x)/2,0,e)-e/2;d[8]-=w*2/t,d[9]+=S*2/e}return d}class zo{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||hZ,this.focalDistance=e.focalDistance||1,this.position=e.position||z4,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?dr.WEB_MERCATOR:dr.WEB_MERCATOR_AUTO_OFFSET:dr.IDENTITY}equals(e){return e instanceof zo?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Nc(e.projectionMatrix,this.projectionMatrix)&&Nc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=TD(r,this.pixelProjectionMatrix),[s,o]=i,l=n?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,l=n?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],d=xh([i,l,o],this.pixelUnprojectionMatrix,u),[h,g,_]=this.unprojectPosition(d);return Number.isFinite(o)?[h,g,_]:Number.isFinite(r)?[h,g,r]:[h,g]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=_d(e);return n[1]=Zn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ko(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?$0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,lZ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=SK({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||$0({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=z4;if(s&&(l=o?new Or(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new Kr(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=dZ,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:d=null,focalDistance:h=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Or().multiplyRight(n).translate(new Kr(this.center).negate()),this.projectionMatrix=r||pZ({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*fZ,focalDistance:h,padding:d,near:l,far:u});const g=nc();qs(g,g,this.projectionMatrix),qs(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=O0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=oZ(this.viewMatrixInverse);const _=nc(),x=nc();o2(_,_,[this.width/2,-this.height/2,1]),pd(_,_,[1,-1,0]),qs(x,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=O0(nc(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||xt.warn("Pixel project matrix not invertible")()}}zo.displayName="Viewport";class Mo extends zo{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:d,farZ:h,orthographic:g=!1,projectionMatrix:_,repeat:x=!1,worldOffset:w=0,position:S,padding:b,legacyMeterSizes:T=!1}=e;let{width:A,height:R,altitude:E=1.5}=e;const C=Math.pow(2,i);A=A||1,R=R||1;let O,P=null;if(_)E=_[5]/2,O=vd(E);else{e.fovy?(O=e.fovy,E=u2(O)):O=vd(E);let I;if(b){const{top:N=0,bottom:B=0}=b;I=[0,Zn((N+R-B)/2,0,R)-R/2]}P=EK({width:A,height:R,scale:C,center:S&&[0,0,S[2]*Db(n)],offset:I,pitch:s,fovy:O,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(d)&&(P.near=d),Number.isFinite(h)&&(P.far=h)}let k=TK({height:R,pitch:s,bearing:o,scale:C,altitude:E});w&&(k=new Or().translate([512*w,0,0]).multiplyLeft(k)),super({...e,width:A,height:R,viewMatrix:k,longitude:r,latitude:n,zoom:i,...P,fovy:O,focalDistance:E}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=O,this.orthographic=g,this._subViewports=x?[]:null,this._pseudoMeters=T,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Mo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Db(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Db(r);return[n,r,i]}addMetersToLngLat(e,n){return SD(e,n)}panByPosition(e,n){const r=xh(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=f4([],i,oY([],r)),o=f4([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const n=CK(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=AK({width:r,height:i,bounds:e,...n});return new Mo({width:r,height:i,longitude:s,latitude:o,zoom:l})}}Mo.displayName="WebMercatorViewport";const $4=[0,0,0];function Lb(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Mo){const[i,s,o=0]=t,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function mZ(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===tt.DEFAULT&&(i=e.isGeospatial?tt.LNGLAT:tt.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function ND(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=t;switch(n&&([o,l,u]=qc([],[o,l,u,1],n)),r){case tt.LNGLAT:return Lb([o,l,u],e,s);case tt.LNGLAT_OFFSETS:return Lb([o+i[0],l+i[1],u+(i[2]||0)],e,s);case tt.METER_OFFSETS:return Lb(SD(i,[o,l,u]),e,s);case tt.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function gZ(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=mZ(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=$4,shaderCoordinateOrigin:h=$4,offsetMode:g=!1}=u?yD(n,r,i):{},_=ND(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:g});if(g){const x=n.projectPosition(d||h);wY(_,_,x)}return _}let _Z=1,vZ=1;class kD{constructor(){U(this,"time",0);U(this,"channels",new Map);U(this,"animations",new Map);U(this,"playing",!1);U(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=_Z++,l={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=vZ++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function xZ(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function yZ(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let bZ=0;const wZ={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:w0.stats.get(`animation-loop-${bZ++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class SZ{constructor(e){U(this,"device",null);U(this,"canvas",null);U(this,"props");U(this,"animationProps",null);U(this,"timeline",null);U(this,"stats");U(this,"cpuTime");U(this,"gpuTime");U(this,"frameRate");U(this,"display");U(this,"needsRedraw","initialized");U(this,"_initialized",!1);U(this,"_running",!1);U(this,"_animationFrameId",null);U(this,"_nextFramePromise",null);U(this,"_resolveNextFrame",null);U(this,"_cpuStartTime",0);U(this,"_error",null);if(this.props={...wZ,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new mh({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=xZ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(yZ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,l,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Bb={};function yh(t="id"){Bb[t]=Bb[t]||1;const e=Bb[t]++;return`${t}-${e}`}class V4{constructor(e){U(this,"id");U(this,"userData",{});U(this,"topology");U(this,"bufferLayout",[]);U(this,"vertexCount");U(this,"indices");U(this,"attributes");if(this.id=e.id||yh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Et.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function TZ(t,e){if(e instanceof V4)return e;const n=EZ(t,e),{attributes:r,bufferLayout:i}=AZ(t,e);return new V4({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function EZ(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Et.INDEX,data:n})}function AZ(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:d,normalized:h}=o;n.push({name:l,format:bX(u,d,h)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const zd=class zd{constructor(e){U(this,"device");U(this,"destroyPolicy");U(this,"_hashCounter",0);U(this,"_hashes",{});U(this,"_renderPipelineCache",{});U(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new zd(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Eo.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...ad.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof ad?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};U(zd,"defaultProps",{...Eo.defaultProps});let V0=zd;const $d=class $d{constructor(e){U(this,"device");U(this,"destroyPolicy");U(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new $d(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};U($d,"defaultProps",{...rd.defaultProps});let q0=$d;function RZ(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let cn=null,Is=null;function CZ(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){cn||(cn=document.createElement("canvas"),cn.id=e,cn.title=e,cn.style.zIndex="100",cn.style.position="absolute",cn.style.top=i,cn.style.left=s,cn.style.border="blue 5px solid",cn.style.transform="scaleY(-1)",document.body.appendChild(cn),Is=cn.getContext("2d")),(cn.width!==t.width||cn.height!==t.height)&&(cn.width=t.width/2,cn.height=t.height/2,cn.style.width="400px",cn.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),u=Is==null?void 0:Is.createImageData(t.width,t.height);if(u){for(let h=0;h<l.length;h+=4)u.data[0+h+0]=l[h+0]*o,u.data[0+h+1]=l[h+1]*o,u.data[0+h+2]=l[h+2]*o,u.data[0+h+3]=r?255:l[h+3]*o;Is==null||Is.putImageData(u,0,0)}}function H0(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!H0(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!H0(t[s],e[s],n-1))return!1;return!0}return!1}function NZ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function kZ(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function MD(t){return NZ(t)||kZ(t)}function MZ(t){return MD(t)||typeof t=="number"||typeof t=="boolean"}function ID(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];MZ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class IZ{constructor(e,n){U(this,"options",{disableWarnings:!1});U(this,"modules");U(this,"moduleUniforms");U(this,"moduleBindings");Object.assign(this.options,n);const r=K1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;ye.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&ye.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||ye.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],d=((n=o.getUniforms)==null?void 0:n.call(o,s,l))||s,{uniforms:h,bindings:g}=ID(d);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...u,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let OZ="";async function PZ(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:OZ+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class Ub{constructor(e,n){U(this,"device");U(this,"id");U(this,"texture");U(this,"sampler");U(this,"view");U(this,"ready");U(this,"isReady",!1);U(this,"destroyed",!1);U(this,"resolveReady",()=>{});U(this,"rejectReady",()=>{});this.device=e,this.id=n.id||yh("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:PZ(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data;let r;try{r=await OD(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function OD(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(OD));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const Os=2,DZ=1e4,Vd=class Vd{constructor(e,n){U(this,"device");U(this,"id");U(this,"source");U(this,"vs");U(this,"fs");U(this,"pipelineFactory");U(this,"shaderFactory");U(this,"userData",{});U(this,"parameters");U(this,"topology");U(this,"bufferLayout");U(this,"isInstanced");U(this,"instanceCount",0);U(this,"vertexCount");U(this,"indexBuffer",null);U(this,"bufferAttributes",{});U(this,"constantAttributes",{});U(this,"bindings",{});U(this,"uniforms",{});U(this,"vertexArray");U(this,"transformFeedback",null);U(this,"pipeline");U(this,"shaderInputs");U(this,"_uniformStore");U(this,"_attributeInfos",{});U(this,"_gpuGeometry",null);U(this,"_getModuleUniforms");U(this,"props");U(this,"_pipelineNeedsUpdate","newly created");U(this,"_needsRedraw","initializing");U(this,"_destroyed",!1);U(this,"_lastDrawTimestamp",-1);U(this,"_lastLogTime",0);U(this,"_logOpen",!1);U(this,"_drawCount",0);var u,d,h,g;this.props={...Vd.defaultProps,...n},n=this.props,this.id=n.id||yh("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(_=>[_.name,_]))||[]),i=n.shaderInputs||new IZ(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=LZ(e),o=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(h=this.shaderInputs)==null?void 0:h.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:x}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=_,this._getModuleUniforms=x,(g=this.props).shaderLayout||(g.shaderLayout=ZX(this.source))}else{const{vs:_,fs:x,getUniforms:w}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=_,this.fs=x,this._getModuleUniforms=w}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||V0.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||q0.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return ye.info(Os,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),W0(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&TZ(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Ab(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Ab(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){H0(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new yX(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(jZ(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&ye.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=wX(this.pipeline.shaderLayout,this.bufferLayout);const i=new Ab(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||ye.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let d=!1;for(const h of u){const g=this._attributeInfos[h];if(g){const _=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(_,o),d=!0}}!d&&!r&&ye.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||ye.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){W0(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=ID(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Ub&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof Ub?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof nd?e=Math.max(e,n.texture.updateTimestamp):n instanceof Et||n instanceof jt?e=Math.max(e,n.updateTimestamp):n instanceof Ub?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof id||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(ye.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=IP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=ye.level>3?0:DZ;ye.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ye.group(Os,`>>> DRAWING MODEL ${this.id}`,{collapsed:ye.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=RZ(this.pipeline.shaderLayout,this.id);ye.table(Os,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};ye.table(Os,n)();const r=this._getAttributeDebugTable();ye.table(Os,this._attributeInfos)(),ye.table(Os,r)(),ye.groupEnd(Os)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&CZ(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=DP(n);return(e instanceof Et?new r(e.debugData):e).toString()}};U(Vd,"defaultProps",{...Eo.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:td.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Io=Vd;function jZ(t){return!!(t.uniformTypes&&!W0(t.uniformTypes))}function LZ(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function W0(t){for(const e in t)return!1;return!0}const _c=class _c{constructor(e,n=_c.defaultProps){U(this,"device");U(this,"model");U(this,"transformFeedback");if(!_c.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Io(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||SW(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof Et)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};U(_c,"defaultProps",{...Io.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Mc=_c;class PD{constructor(e){U(this,"id");U(this,"topology");U(this,"vertexCount");U(this,"indices");U(this,"attributes");U(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||yh("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const BZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class DD extends f2{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:d,height:h},cullRect:g,effects:_,pass:x="picking",pickZ:w,shaderModuleProps:S}){this.pickZ=w;const b=this._resetColorEncoder(w),T=[l,u,d,h],A=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:_==null?void 0:_.filter(E=>E.useInPicking),pass:x,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:T});return this._colorEncoderState=null,{decodePickingColor:b&&FZ.bind(null,b),stats:A}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,BZ),i.blend=!0,i.blendColor=UZ(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function UZ(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(xt.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function FZ(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const uo={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},xd=Symbol.for("component"),Hs=Symbol.for("propTypes"),Fb=Symbol.for("deprecatedProps"),bo=Symbol.for("asyncPropDefaults"),Js=Symbol.for("asyncPropOriginal"),ls=Symbol.for("asyncPropResolved");function jD(t,e=()=>!0){return Array.isArray(t)?LD(t,e,[]):e(t)?[t]:[]}function LD(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?LD(i,e,n):e(i)&&n.push(i)}return n}function zZ({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=n;o<i;o++)t[l++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class $Z{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=m0(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class VZ{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new $Z(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[n];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[n]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const qZ="layerManager.setLayers",HZ="layerManager.activateViewport";class WZ{constructor(e,n){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{An(HZ,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new VZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:HK(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[tG],renderPass:void 0,stats:i||new mh({id:"deck.gl"}),viewport:s||new zo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new kD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){An(qZ,this,n,e),this._lastRenderedLayers=e;const r=jD(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?xt.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&xt.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=uo.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=uo.MATCHED,n!==e&&(e.lifecycle=uo.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=uo.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=uo.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Mr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Mr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Mr(t[s],e[s],n-1))return!1;return!0}return!1}class XZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=jD(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Mr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):xt.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=n[s.id];const d=!!s.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const YZ=/([0-9]+\.?[0-9]*)(%|px)/;function Gi(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=YZ.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Ki(t,e){return t.relative?Math.round(t.position*e):t.position}class ea{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Gi(r),this._y=Gi(i),this._width=Gi(s),this._height=Gi(o),this._padding=l&&{left:Gi(l.left||0),right:Gi(l.right||0),top:Gi(l.top||0),bottom:Gi(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Mr(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Ki(this._x,e),y:Ki(this._y,n),width:Ki(this._width,e),height:Ki(this._height,n)};return this._padding&&(r.padding={left:Ki(this._padding.left,e),top:Ki(this._padding.top,n),right:Ki(this._padding.right,e),bottom:Ki(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class bh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const q4=()=>{},X0={BREAK:1,SNAP_TO_END:2,IGNORE:3},GZ=t=>t,KZ=X0.BREAK;class ZZ{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=n,d=u(r/l),h=i.interpolateProps(s,o,d);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new bh(e.timeline),this.onViewStateChange=e.onViewStateChange||q4,this.onStateChange=e.onStateChange||q4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===X0.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===X0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:n.transitionEasing||GZ,interpolator:s,interruption:n.transitionInterruption||KZ,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Sn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class QZ{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Nc(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Sn(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const JZ=["longitude","latitude","zoom","bearing","pitch"],eQ=["longitude","latitude","zoom"];class d2 extends QZ{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:JZ,required:eQ},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(n),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=hd(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,hd(e.around,n.around,r)))}return i}}const Zi={transitionDuration:0},tQ=300,bf=t=>1-(1-t)*(1-t),oo={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ps={};class BD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new ZZ({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?tQ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:d=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(oo.WHEEL,h&&r),this.toggleEvents(oo.PAN,h),this.toggleEvents(oo.PINCH,h&&(l||u)),this.toggleEvents(oo.MULTI_PAN,h&&u),this.toggleEvents(oo.DOUBLE_CLICK,h&&o),this.toggleEvents(oo.KEYBOARD,h&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Zi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Zi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:bf},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Zi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:bf},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Zi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Zi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:bf},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Ps._startPinchRotation=e.rotation,Ps._lastPinchEvent=e,this.updateViewport(r,Zi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Ps._startPinchRotation-r})}return this.updateViewport(n,Zi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ps._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Ps;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*n/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:bf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ps._startPinchRotation=null,Ps._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=n?l.zoomOut(r).zoomOut(r):l.zoomOut(r),d.isZooming=!0;break;case"Equal":u=n?l.zoomIn(r).zoomIn(r):l.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":n?(u=l.rotateLeft(s),d.isRotating=!0):(u=l.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":n?(u=l.rotateRight(s),d.isRotating=!0):(u=l.moveRight(i),d.isPanning=!0);break;case"ArrowUp":n?(u=l.rotateUp(o),d.isRotating=!0):(u=l.moveUp(i),d.isPanning=!0);break;case"ArrowDown":n?(u=l.rotateDown(o),d.isRotating=!0):(u=l.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Zi:e?{...n,transitionInterpolator:new d2({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class UD{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const H4=5,nQ=1.2;class rQ extends UD{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:d=1.5,position:h=[0,0,0],maxZoom:g=20,minZoom:_=0,maxPitch:x=60,minPitch:w=0,startPanLngLat:S,startZoomLngLat:b,startRotatePos:T,startBearing:A,startPitch:R,startZoom:E,normalize:C=!0}=e;Sn(Number.isFinite(s)),Sn(Number.isFinite(i)),Sn(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:d,maxZoom:g,minZoom:_,maxPitch:x,minPitch:w,normalize:C,position:h},{startPanLngLat:S,startZoomLngLat:b,startRotatePos:T,startBearing:A,startPitch:R,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+n,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Zn(u,l,o);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Zn(i,r,n);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Zn(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,NK(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],l=e[1],u=n[1],{width:d,height:h}=this.getViewportProps(),g=s/d;let _=0;o>0?Math.abs(h-u)>H4&&(_=o/(u-h)*nQ):o<0&&u>H4&&(_=1-l/u),_=Zn(_,-1,1);const{minPitch:x,maxPitch:w}=this.getViewportProps(),S=i+180*g;let b=r;return _>0?b=r+_*(w-r):_<0&&(b=r-_*(x-r)),{pitch:b,bearing:S}}}class iQ extends BD{constructor(){super(...arguments),this.ControllerState=rQ,this.transition={transitionDuration:300,transitionInterpolator:new d2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class FD extends ea{constructor(e={}){super(e)}getViewportType(){return Mo}get ControllerType(){return iQ}}FD.displayName="MapView";const sQ=new CD;function aQ(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class oQ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>aQ(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Mr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof CD)||this._resolvedEffects.push(sQ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class lQ extends f2{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const cQ="deckRenderer.renderLayers";class uQ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new lQ(e),this.pickLayersPass=new DD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,An(cQ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const fQ={pickedColor:null,pickedObjectIndex:-1};function dQ({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:d}=s;let h=i*i,g=-1,_=0;for(let x=0;x<d;x++){const w=x+l-r,S=w*w;if(S>h)_+=4*u;else for(let b=0;b<u;b++){if(t[_+3]-1>=0){const A=b+o-n,R=A*A+S;R<=h&&(h=R,g=_)}_+=4}}if(g>=0){const x=t.slice(g,g+4),w=e(x);if(w){const S=Math.floor(g/4/u),b=g/4-S*u;return{...w,pickedColor:x,pickedX:o+b,pickedY:l+S}}xt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return fQ}function hQ({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const l=e(s);l?n.set(o,{...l,color:s}):xt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function zD({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=mQ((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function pQ(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const g=n.index,_=n.layerId,x=o?o.props.id:null;if(x!==_||l!==g){if(x!==_){const w=i.find(S=>S.props.id===_);w&&u.unshift(w)}n.layerId=x,n.index=l,n.info=null}}const d=zD(t),h=new Map;return h.set(null,d),u.forEach(g=>{let _={...d};g===o&&(_.color=s,_.index=l,_.picked=!0),_=$D({layer:g,info:_,mode:r});const x=_.layer;g===o&&r==="hover"&&(n.info=_),h.set(x.id,_),r==="hover"&&x.updateAutoHighlight(_)}),h}function $D({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function mQ(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class gQ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new DD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(_=>_.id===o):null,d=l&&i.find(_=>_.id===l)||i[0],h=d&&d.unproject([e-d.x,n-d.y]);return{...s,...{x:e,y:n,viewport:d,coordinate:h,layer:u}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:d,onViewportActive:h,effects:g}){const _=this.device.canvasContext.cssToDeviceRatio(),x=this._getPickable(e);if(!x||r.length===0)return{result:[],emptyInfo:zD({viewports:r,x:i,y:s,pixelRatio:_})};this._resizeBuffer();const w=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=[w.x+Math.floor(w.width/2),w.y+Math.floor(w.height/2)],b=Math.round(o*_),{width:T,height:A}=this.pickingFBO,R=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:b,deviceWidth:T,deviceHeight:A}),E={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const O=[],P=new Set;for(let k=0;k<l;k++){let I;if(R){const B=this._drawAndSample({layers:x,views:n,viewports:r,onViewportActive:h,deviceRect:R,cullRect:E,effects:g,pass:`picking:${u}`});I=dQ({...B,deviceX:S[0],deviceY:S[1],deviceRadius:b,deviceRect:R})}else I={pickedColor:null,pickedObjectIndex:-1};let N;if(I.pickedLayer&&d&&this.depthFBO){const{pickedColors:B}=this._drawAndSample({layers:[I.pickedLayer],views:n,viewports:r,onViewportActive:h,deviceRect:{x:I.pickedX,y:I.pickedY,width:1,height:1},cullRect:E,effects:g,pass:`picking:${u}:z`},!0);B[3]&&(N=B[0])}I.pickedLayer&&k+1<l&&(P.add(I.pickedLayer),I.pickedLayer.disablePickingIndex(I.pickedObjectIndex)),C=pQ({pickInfo:I,lastPickedInfo:this.lastPickedInfo,mode:u,layers:x,viewports:r,x:i,y:s,z:N,pixelRatio:_});for(const B of C.values())B.layer&&O.push(B);if(!I.pickedColor)break}for(const k of P)k.restorePickingColors();return{result:O,emptyInfo:C.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:d=null,onViewportActive:h,effects:g}){const _=this._getPickable(e);if(!_||r.length===0)return[];this._resizeBuffer();const x=this.device.canvasContext.cssToDeviceRatio(),w=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=w.x,b=w.y+w.height,T=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),A=T.x+T.width,R=T.y,E={x:S,y:R,width:A-S,height:b-R},C=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:h,deviceRect:E,cullRect:{x:i,y:s,width:o,height:l},effects:g,pass:`picking:${u}`}),O=hQ(C),P=new Map,k=[],I=Number.isFinite(d);for(let N=0;N<O.length&&!(I&&k.length>=d);N++){const B=O[N];let V={color:B.pickedColor,layer:null,index:B.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:x};V=$D({layer:B.pickedLayer,info:V,mode:u});const Z=V.layer.id;P.has(Z)||P.set(Z,new Set);const j=P.get(Z),Y=V.object??V.index;j.has(Y)||(j.add(Y),k.push(V))}return k}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},d=!1){const h=d?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const A of l)A.useInPicking&&(g.preRenderStats[A.id]=A.preRender(g));const{decodePickingColor:_}=this.pickLayersPass.render(g),{x,y:w,width:S,height:b}=s,T=new(d?Float32Array:Uint8Array)(S*b*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:x,sourceY:w,sourceWidth:S,sourceHeight:b,target:T}),{pickedColors:T,decodePickingColor:_}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,n-r),u=Math.min(i,e+r+1)-o,d=Math.min(s,n+r+1)-l;return u<=0||d<=0?null:{x:o,y:l,width:u,height:d}}}const _Q={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},vQ="top-left",W4="__root";class xQ{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Mr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=vQ}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||W4;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,_Q[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===W4||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=r[l];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:n}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=U0[n.type];if(r)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}}const yQ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class bQ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,yQ),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var ho;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ho||(ho={}));const h2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},qt=(t,e,n)=>e?t.enable(n):t.disable(n),X4=(t,e,n)=>t.hint(n,e),Wn=(t,e,n)=>t.pixelStorei(n,e),Y4=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},Wl=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function zb(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const wQ={3042:qt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:qt,2885:(t,e)=>t.cullFace(e),2929:qt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:qt,35723:X4,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Y4,36010:Y4,34964:Wl,36662:Wl,36663:Wl,35053:Wl,35055:Wl,2886:(t,e)=>t.frontFace(e),33170:X4,2849:(t,e)=>t.lineWidth(e),32823:qt,32824:"polygonOffset",10752:"polygonOffset",35977:qt,32926:qt,32928:qt,32938:"sampleCoverage",32939:"sampleCoverage",3089:qt,3088:(t,e)=>t.scissor(...e),2960:qt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:qt,10754:qt,12288:qt,12289:qt,12290:qt,12291:qt,12292:qt,12293:qt,12294:qt,12295:qt,3333:Wn,3317:Wn,37440:Wn,37441:Wn,37443:Wn,3330:Wn,3332:Wn,3331:Wn,3314:Wn,32878:Wn,3316:Wn,3315:Wn,32877:Wn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=zb(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=zb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,l)},stencilOp:(t,e)=>{e=zb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,l)},viewport:(t,e)=>t.viewport(...e)};function Dt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const SQ={blendEquation:(t,e,n)=>t.blendEquationSeparate(Dt(32777,e,n),Dt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Dt(32969,e,n),Dt(32968,e,n),Dt(32971,e,n),Dt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Dt(32824,e,n),Dt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Dt(32938,e,n),Dt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Dt(2962,e,n),Dt(2967,e,n),Dt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Dt(34816,e,n),Dt(36003,e,n),Dt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Dt(2964,e,n),Dt(2965,e,n),Dt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Dt(34817,e,n),Dt(34818,e,n),Dt(34819,e,n))},G4={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Vr=(t,e)=>t.isEnabled(e),K4={3042:Vr,2884:Vr,2929:Vr,3024:Vr,32823:Vr,32926:Vr,32928:Vr,3089:Vr,2960:Vr,35977:Vr},TQ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function $o(t,e){if(AQ(e))return;const n={};for(const i in e){const s=Number(i),o=wQ[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=SQ[i];s(t,e,r)}}function VD(t,e=h2){if(typeof e=="number"){const i=e,s=K4[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=K4[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function EQ(t){$o(t,h2)}function AQ(t){for(const e in t)return!1;return!0}function RQ(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Ws{constructor(e,n){U(this,"gl");U(this,"program",null);U(this,"stateStack",[]);U(this,"enable",!0);U(this,"cache",null);U(this,"log");U(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];$o(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?VD(e):Object.assign({},h2),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,NQ(e);for(const r in G4){const i=G4[r];CQ(e,r,i)}Z4(e,"getParameter"),Z4(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];RQ(o,l)||(n=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function Z4(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||TQ.has(i))return n(i);const s=Ws.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function CQ(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=Ws.get(t),{valueChanged:l,oldValue:u}=n(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function NQ(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=Ws.get(t);i.program!==r&&(e(r),i.program=r)}}function kQ(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return t.addEventListener("webglcontextlost",u=>o(u),!1),t.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||(s.luma={}),s}function Oo(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function MQ(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Oo(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||n,u=o||r,d=t.getParameter(7938),h=qD(l,u),g=IQ(l,u),_=OQ(l,u);return{type:"webgl",gpu:h,gpuType:_,gpuBackend:g,vendor:l,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function qD(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function IQ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function OQ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(qD(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function HD(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const rc="WEBGL_compressed_texture_s3tc",ic="WEBGL_compressed_texture_s3tc_srgb",po="EXT_texture_compression_rgtc",mo="EXT_texture_compression_bptc",PQ="WEBGL_compressed_texture_etc",DQ="WEBGL_compressed_texture_astc",jQ="WEBGL_compressed_texture_etc1",LQ="WEBGL_compressed_texture_pvrtc",BQ="WEBGL_compressed_texture_atc",Q4="EXT_texture_norm16",J4="EXT_render_snorm",UQ="EXT_color_buffer_float",p2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[J4],"norm16-renderable-webgl":[Q4],"snorm16-renderable-webgl":[Q4,J4],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[rc,ic,po,mo],"texture-compression-bc5-webgl":[po],"texture-compression-bc7-webgl":[mo],"texture-compression-etc2":[PQ],"texture-compression-astc":[DQ],"texture-compression-etc1-webgl":[jQ],"texture-compression-pvrtc-webgl":[LQ],"texture-compression-atc-webgl":[BQ]};function FQ(t){return t in p2}function zQ(t,e,n){return(p2[e]||[]).every(i=>Oo(t,i,n))}const m2={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:UQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:rc},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ic},"bc1-rgba-unorm":{gl:33777,x:rc},"bc1-rgba-unorm-srgb":{gl:35916,x:ic},"bc2-rgba-unorm":{gl:33778,x:rc},"bc2-rgba-unorm-srgb":{gl:35918,x:ic},"bc3-rgba-unorm":{gl:33779,x:rc},"bc3-rgba-unorm-srgb":{gl:35919,x:ic},"bc4-r-unorm":{gl:36283,x:po},"bc4-r-snorm":{gl:36284,x:po},"bc5-rg-unorm":{gl:36285,x:po},"bc5-rg-snorm":{gl:36286,x:po},"bc6h-rgb-ufloat":{gl:36495,x:mo},"bc6h-rgb-float":{gl:36494,x:mo},"bc7-rgba-unorm":{gl:36492,x:mo},"bc7-rgba-unorm-srgb":{gl:36493,x:mo},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function $Q(t,e,n){let r=e.create;const i=m2[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!Oo(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function WD(t){var i;const e=m2[t],n=HQ(t),r=Z1(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||qQ(r.channels,r.integer,r.normalized,n),type:r.dataType?HD(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function VQ(t){switch(Z1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function qQ(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function HQ(t){const e=m2[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const eM={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class WQ extends UW{constructor(n,r,i){super([],i);U(this,"gl");U(this,"extensions");U(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Oo(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),FQ(n)&&zQ(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(eM),...Object.keys(p2)]}getWebGLFeature(n){const r=eM[n];return typeof r=="string"?!!Oo(this.gl,r,this.extensions):!!r}}class XQ extends BW{constructor(n){super();U(this,"gl");U(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class fc extends sd{constructor(n,r){super(n,r);U(this,"device");U(this,"gl");U(this,"handle");U(this,"colorAttachments",[]);U(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=VQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${GQ(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,l);break;case 34067:const u=YQ(l);i.framebufferTexture2D(36160,n,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function YQ(t){return t<34069?t+34069:t}function GQ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class KQ extends S0{constructor(n,r){super(r);U(this,"device");U(this,"format","rgba8unorm");U(this,"depthStencilFormat","depth24plus");U(this,"presentationSize");U(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new fc(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function XD(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const ZQ=1;let gt=null,tM=!1;const g2={debugSpectorJS:ye.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function QQ(t){if(!globalThis.SPECTOR)try{await XD(t.debugSpectorJSUrl||g2.debugSpectorJSUrl)}catch(e){ye.warn(String(e))}}function JQ(t){var e;if(t={...g2,...t},!t.debugSpectorJS)return null;if(!gt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ye.probe(ZQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;gt=new n,globalThis.luma&&(globalThis.luma.spector=gt)}if(!gt)return null;if(tM||(tM=!0,gt.spyCanvases(),gt==null||gt.onCaptureStarted.add(n=>ye.info("Spector capture started:",n)()),gt==null||gt.onCapture.add(n=>{ye.info("Spector capture complete:",n)(),gt==null||gt.getResultUI(),gt==null||gt.resultView.display(),gt==null||gt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;gt==null||gt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{ye.info("Spector capture stopped after 2 seconds")(),gt==null||gt.stopCapture()})}return gt}const eJ="https://unpkg.com/webgl-debug@2.0.1/index.js";function YD(t){return t.luma=t.luma||{},t.luma}async function tJ(){fa()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await XD(eJ))}function nJ(t,e={}){return e.debugWebGL||e.traceWebGL?iJ(t,e):rJ(t)}function rJ(t){const e=YD(t);return e.realContext?e.realContext:t}function iJ(t,e){if(!globalThis.WebGLDebugUtils)return ye.warn("webgl-debug not loaded")(),t;const n=YD(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...ho,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,sJ.bind(null,e),aJ.bind(null,e));for(const o in ho)!(o in r)&&typeof ho[o]=="number"&&(r[o]=ho[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function nM(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function sJ(t,e,n,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;ye.error(o)();debugger}function aJ(t,e,n){let r="";ye.level>=1&&(r=nM(e,n),t.traceWebGL&&ye.log(1,r)());for(const i of n)if(i===void 0){r=r||nM(e,n);debugger}}const $b={};function oJ(t="id"){$b[t]=$b[t]||1;const e=$b[t]++;return`${t}-${e}`}class dc extends Et{constructor(n,r={}){super(n,r);U(this,"device");U(this,"gl");U(this,"handle");U(this,"glTarget");U(this,"glUsage");U(this,"glIndexType",5123);U(this,"byteLength");U(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=lJ(this.props.usage),this.glUsage=cJ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function lJ(t){return t&Et.INDEX?34963:t&Et.VERTEX?34962:t&Et.UNIFORM?35345:34962}function cJ(t){return t&Et.INDEX||t&Et.VERTEX?35044:t&Et.UNIFORM?35048:35044}function uJ(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,_]=i;n.push({message:_.trim(),type:rM(g),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let d=parseInt(l,10);isNaN(d)&&(d=0);let h=parseInt(o,10);isNaN(h)&&(h=0),n.push({message:u.join(":").trim(),type:rM(s),lineNum:d,linePos:h})}return n}function rM(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class fJ extends rd{constructor(n,r){super(n,r);U(this,"device");U(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?uJ(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ye.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ye.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function dJ(t,e,n,r){if(gJ(e))return r(t);const i=t;i.pushState();try{return hJ(t,e),$o(i.gl,n),r(t)}finally{i.popState()}}function hJ(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Xs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Xs("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Xs("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(mJ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Y0("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&ye.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Y0("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Vb("stencilPassOperation",e.stencilPassOperation),s=Vb("stencilFailOperation",e.stencilFailOperation),o=Vb("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=iM("blendColorOperation",e.blendColorOperation||"add"),s=iM("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=wf("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=wf("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=wf("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=wf("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,d)}}function Y0(t,e){return Xs(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Vb(t,e){return Xs(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function iM(t,e){return Xs(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function wf(t,e){return Xs(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function pJ(t,e){return`Illegal parameter ${e} for ${t}`}function Xs(t,e,n){if(!(e in n))throw new Error(pJ(t,e));return n[e]}function mJ(t,e){return e}function gJ(t){let e=!0;for(const n in t){e=!1;break}return e}function GD(t){const e={};return t.addressModeU&&(e[10242]=qb(t.addressModeU)),t.addressModeV&&(e[10243]=qb(t.addressModeV)),t.addressModeW&&(e[32882]=qb(t.addressModeW)),t.magFilter&&(e[10240]=G0(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=_J(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Y0("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function qb(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function G0(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function _J(t,e="none"){if(!e)return G0(t);switch(e){case"none":return G0(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class K0 extends id{constructor(n,r){super(n,r);U(this,"device");U(this,"handle");U(this,"parameters");this.device=n,this.parameters=GD(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class go extends nd{constructor(n,r){super(n,{...jt.defaultProps,...r});U(this,"device");U(this,"gl");U(this,"handle");U(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const vJ="Failed to deduce GL constant from typed array";function xJ(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(vJ)}}function yJ(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function KD(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function bJ(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function yd(t,e,n){if(wJ(e))return n(t);const{nocatch:r=!0}=e,i=Ws.get(t);i.push(),$o(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function wJ(t){for(const e in t)return!1;return!0}function SJ(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:l}=n,u=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,l,i,s,o);break;default:t.texStorage2D(u,e,l,i,s)}}function sM(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:d=0,y:h=0,z:g=0}=r,{glFormat:_,glType:x}=r,w=ZD(r.glTarget,o,l),S=r.flipY?{37440:!0}:{};yd(t,S,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(w,e),t.texSubImage3D(w,u,d,h,g,i,s,l,_,x,n),t.bindTexture(w,null);break;case"2d":case"cube":t.bindTexture(w,e),t.texSubImage2D(w,u,d,h,i,s,_,x,n),t.bindTexture(w,null);break;default:throw new Error(o)}})}function aM(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=n,{x:d=0,y:h=0,z:g=0}=n,{glFormat:_,glType:x,compressed:w}=n,S=ZD(n.glTarget,r,o);switch(r){case"2d-array":case"3d":w?t.compressedTexSubImage3D(S,l,d,h,g,i,s,o,_,e,u):t.texSubImage3D(S,l,d,h,g,i,s,o,_,x,e,u);break;case"2d":case"cube":w?t.compressedTexSubImage2D(S,l,d,h,i,s,_,e,u):t.texSubImage2D(S,l,d,h,i,s,_,x,e,u);break;default:throw new Error(r)}}function TJ(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function ZD(t,e,n){return e==="cube"?34069+n:t}function EJ(t,e){var T;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:d,sourceType:h}=e||{};const{framebuffer:g,deleteFramebuffer:_}=QD(t),{gl:x,handle:w}=g;o||(o=g.width),l||(l=g.height);const S=(T=g.colorAttachments[i])==null?void 0:T.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${i}`);u=(S==null?void 0:S.depth)||1,d||(d=(S==null?void 0:S.glFormat)||6408),h||(h=(S==null?void 0:S.glType)||5121),s=CJ(s,h,d,o,l),h=h||xJ(s);const b=x.bindFramebuffer(36160,w);return x.readBuffer(36064+i),x.readPixels(n,r,o,l,d,h,s),x.readBuffer(36064),x.bindFramebuffer(36160,b||null),_&&g.destroy(),s}function AJ(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:h,deleteFramebuffer:g}=QD(t);l=l||h.width,u=u||h.height;const _=h;d=d||5121;let x=n;if(!x){const S=KD(s),b=bJ(d),T=o+l*u*S*b;x=_.device.createBuffer({byteLength:T})}const w=t.device.createCommandEncoder();return w.copyTextureToBuffer({sourceTexture:t,width:l,height:u,origin:[r,i],destinationBuffer:x,byteOffset:o}),w.destroy(),g&&h.destroy(),x}function QD(t){return t instanceof sd?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:RJ(t),deleteFramebuffer:!0}}function RJ(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function CJ(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=yJ(e,{clamped:!1}),l=KD(n);return new o(r*i*l)}class hc extends jt{constructor(n,r){super(n,r);U(this,"device");U(this,"gl");U(this,"handle");U(this,"sampler");U(this,"view");U(this,"mipmaps");U(this,"compressed");U(this,"glTarget");U(this,"glFormat");U(this,"glType");U(this,"glInternalFormat");U(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=TJ(this.props.dimension);const s=WD(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=jt.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new go(this.device,{...this.props,texture:this}),this.bind(),SJ(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new go(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof K0?(this.sampler=n,r=n.props):(this.sampler=new K0(this.device,n),r=n);const i=GD(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ye.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ye.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=jt.getExternalImageSize(n.image),i={...jt.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:l,x:u,y:d,z:h,flipY:g}=i;let{width:_,height:x}=i;const{dimension:w,glTarget:S,glFormat:b,glInternalFormat:T,glType:A}=this;if(_=Math.min(_,this.width-u),x=Math.min(x,this.height-d),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return sM(this.device.gl,this.handle,s,{dimension:w,mipLevel:l,x:u,y:d,z:h,width:_,height:x,depth:o,glFormat:b,glType:A,glTarget:S,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=jt.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&ye.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),aM(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of jt.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&ye.warn(`${this.id} has mipmap and multiple LODs.`)();const s=jt.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:l,format:u=6408,type:d=5121}=n,{gl:h}=this,g=o||l;this.bind(),g instanceof Promise?g.then(_=>this.setImageDataForFace(Object.assign({},n,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,u,i,s,0,u,d,g):h.texImage2D(r,0,u,u,d,g)}_getImageDataMap(n){for(let r=0;r<jt.CubeFaces.length;++r){const i=jt.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){ye.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(jt.isExternalImage(i)){sM(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(jt.isTextureLevelData(i)){aM(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const NJ=[1,2,4,8];class kJ extends T0{constructor(n,r){var o;super(n,r);U(this,"device");U(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:l,height:u}=r.framebuffer;i=[0,0,l,u]}else{const[l,u]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,l,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=NJ.map(i=>!!(i&n.colorMask))),this.glParameters=r,$o(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&yd(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){yd(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function MJ(t){return IJ.includes(t)}const IJ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],JD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function ej(t){const e=JD[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function OJ(t){const e=JD[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function PJ(t,e){const n={attributes:[],bindings:[]};n.attributes=DJ(t,e);const r=BJ(t,e);for(const l of r){const u=l.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));n.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=LJ(t,e);let s=0;for(const l of i)if(MJ(l.type)){const{viewDimension:u,sampleType:d}=FJ(l.type);n.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:d}),l.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=jJ(t,e);return o!=null&&o.length&&(n.varyings=o),n}function DJ(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=t.getAttribLocation(e,o);if(u>=0){const{attributeType:d}=OJ(l),h=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:u,stepMode:h,type:d})}}return n.sort((i,s)=>i.location-s.location),n}function jJ(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:d,components:h}=ej(l),g={location:i,name:o,type:d,size:u*h};n.push(g)}return n.sort((i,s)=>i.location-s.location),n}function LJ(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:d,isArray:h}=zJ(o);let g=t.getUniformLocation(e,d);const _={location:g,name:d,size:l,type:u,isArray:h};if(n.push(_),_.size>1)for(let x=0;x<_.size;x++){const w=`${d}[${x}]`;g=t.getUniformLocation(e,w);const S={..._,name:w,location:g};n.push(S)}}return n}function BJ(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},l=n(s,35395)||[],u=t.getActiveUniforms(e,l,35383),d=t.getActiveUniforms(e,l,35384),h=t.getActiveUniforms(e,l,35387),g=t.getActiveUniforms(e,l,35388);for(let _=0;_<o.uniformCount;++_){const x=t.getActiveUniform(e,l[_]);if(!x)throw new Error("activeInfo");o.uniforms.push({name:x.name,format:ej(u[_]).format,type:u[_],arrayLength:d[_],byteOffset:h[_],byteStride:g[_]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const UJ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function FJ(t){const e=UJ[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function zJ(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function $J(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function VJ(t){return MD(t)!==null||typeof t=="number"||typeof t=="boolean"}function qJ(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];VJ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function HJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function WJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const oM=4;class XJ extends Eo{constructor(n,r){super(n,r);U(this,"device");U(this,"handle");U(this,"vs");U(this,"fs");U(this,"introspectedLayout");U(this,"uniforms",{});U(this,"bindings",{});U(this,"varyings",null);U(this,"_uniformCount",0);U(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),ye.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=PJ(this.device.gl,this.handle),ye.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=YJ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||ye.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||ye.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof dc)&&!(s.buffer instanceof dc))throw new Error("buffer value");break;case"texture":if(!(s instanceof go||s instanceof hc||s instanceof fc))throw new Error("texture value");break;case"sampler":ye.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var b;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:d=!1,firstVertex:h=0,transformFeedback:g}=n,_=HJ(s),x=!!o.indexBuffer,w=(b=o.indexBuffer)==null?void 0:b.glIndexType;if(this.linkStatus!=="success")return ye.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ye.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=r;return dJ(this.device,i,S.glParameters,()=>{x&&d?this.device.gl.drawElementsInstanced(_,l||0,w,h,u||0):x?this.device.gl.drawElements(_,l||0,w,h):d?this.device.gl.drawArraysInstanced(_,h,l||0,u||0):this.device.gl.drawArrays(_,h,l||0),g&&g.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=qJ(n);Object.keys(r).forEach(i=>{ye.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),ye.time(oM,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),ye.timeEnd(oM,`linkProgram for ${this.id}`)(),ye.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}ye.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ye.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(ye.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=n.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);n.uniformBlockBinding(this.handle,i,u),o instanceof dc?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof go||o instanceof hc||o instanceof fc))throw new Error("texture");let d;if(o instanceof go)d=o.texture;else if(o instanceof hc)d=o;else if(o instanceof fc&&o.colorAttachments[0]instanceof go)ye.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,l=this.uniforms[r]??o;l!==void 0&&$J(this.device.gl,i,s,l)}}}function YJ(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):ye.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class GJ extends A0{constructor(n){super(n,{});U(this,"device");U(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":KJ(this.device,r.options);break;case"copy-buffer-to-texture":ZJ(this.device,r.options);break;case"copy-texture-to-buffer":QJ(this.device,r.options);break;case"copy-texture-to-texture":JJ(this.device,r.options);break;default:throw new Error(r.name)}}}function KJ(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function ZJ(t,e){throw new Error("Not implemented")}function QJ(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:d,byteOffset:h=0,bytesPerRow:g,rowsPerImage:_}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||g||_)throw new Error("not implemented");const{framebuffer:x,destroyFramebuffer:w}=tj(n);let S;try{const b=d,T=s||x.width,A=o||x.height,R=WD(x.colorAttachments[0].texture.props.format),E=R.format,C=R.type;t.gl.bindBuffer(35051,b.handle),S=t.gl.bindFramebuffer(36160,x.handle),t.gl.readPixels(u[0],u[1],T,A,E,C,h)}finally{t.gl.bindBuffer(35051,null),S!==void 0&&t.gl.bindFramebuffer(36160,S),w&&x.destroy()}}function JJ(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:h}=tj(n),[g,_]=i,[x,w,S]=s,b=t.gl.bindFramebuffer(36160,d.handle);let T=null,A;if(o instanceof hc)T=o,l=Number.isFinite(l)?l:T.width,u=Number.isFinite(u)?u:T.height,T.bind(0),A=T.glTarget;else throw new Error("invalid destination");switch(A){case 3553:case 34067:t.gl.copyTexSubImage2D(A,r,x,w,g,_,l,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(A,r,x,w,S,g,_,l,u);break}T&&T.unbind(),t.gl.bindFramebuffer(36160,b),h&&d.destroy()}function tj(t){if(t instanceof jt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class eee extends E0{constructor(n,r){super(n,r);U(this,"device");U(this,"commandBuffer");this.device=n,this.commandBuffer=new GJ(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function tee(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=n[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return t.target}class _2 extends R0{constructor(n,r){super(n,r);U(this,"device");U(this,"handle");U(this,"buffer",null);U(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return CV()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:d,integer:h,divisor:g}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(n,s,o,l,u):this.device.gl.vertexAttribPointer(n,s,o,d,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,g||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=HD(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=_2.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=nee(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!ree(i,this.bufferValue),l){const u=pX(r.constructor,o);tee({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function nee(t){return Array.isArray(t)?new Float32Array(t):t}function ree(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class iee extends C0{constructor(n,r){super(n,r);U(this,"device");U(this,"gl");U(this,"handle");U(this,"layout");U(this,"buffers",{});U(this,"unusedBuffers",{});U(this,"bindOnUse",!0);U(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(WJ(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,ye.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(n){if(lM(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof dc)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(lM(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function lM(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class see extends N0{constructor(n,r){super(n,r);U(this,"device");U(this,"handle");U(this,"target",null);U(this,"_queryPending",!1);U(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class _o extends fs{constructor(n){var g,_;super({...n,id:n.id||oJ("webgl-device")});U(this,"type","webgl");U(this,"handle");U(this,"features");U(this,"limits");U(this,"info");U(this,"canvasContext");U(this,"lost");U(this,"_resolveContextLost");U(this,"gl");U(this,"debug",!1);U(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});U(this,"_extensions",{});U(this,"_polyfilled",!1);U(this,"spectorJS");U(this,"renderPass",null);U(this,"_constants");const r=fs._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(_=(g=r.canvas)==null?void 0:g.gl)==null?void 0:_.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new KQ(this,r),this.lost=new Promise(x=>{this._resolveContextLost=x});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const l=this.props._handle||kQ(this.canvasContext.canvas,{onContextLost:x=>{var w;return(w=this._resolveContextLost)==null?void 0:w.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:x=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(n._reuseDevices)return ye.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=JQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=MQ(this.gl,this._extensions),this.limits=new XQ(this.gl),this.features=new WQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Ws(this.gl,{log:(...x)=>ye.log(1,...x)()}).trackState(this.gl,{copyState:!1});const d=n.debugWebGL||n.debug,h=n.debugWebGL;d&&(this.gl=nJ(this.gl,{debugWebGL:d,traceWebGL:h}),ye.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(ye.level=Math.max(ye.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new dc(this,r)}createTexture(n){return new hc(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new K0(this,n)}createShader(n){return new fJ(this,n)}createFramebuffer(n){return new fc(this,n)}createVertexArray(n){return new _2(this,n)}createTransformFeedback(n){return new iee(this,n)}createQuerySet(n){return new see(this,n)}createRenderPipeline(n){return new XJ(this,n)}beginRenderPass(n){return new kJ(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new eee(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return EJ(n,r)}readPixelsToBufferWebGL(n,r){return AJ(n,r)}setParametersWebGL(n){$o(this.gl,n)}getParametersWebGL(n){return VD(this.gl,n)}withParametersWebGL(n,r){return yd(this.gl,n,r)}resetWebGL(){ye.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),EQ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return $Q(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Ws.get(this.gl).push()}popState(){Ws.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&cee(s,r)&&ye.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:aee(this,n,r);break;case Int32Array:oee(this,n,r);break;case Uint32Array:lee(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return Oo(this.gl,n,this._extensions),this._extensions}}function aee(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function oee(t,e,n){t.gl.vertexAttribI4iv(e,n)}function lee(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function cee(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const uee={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},fee=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),dee=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),hee=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function pee(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&mee(i),i}return this.originalGetContext(n,r)}}function mee(t){t.getExtension("EXT_color_buffer_float");const e={...uee,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:fee(t),OES_vertex_array_object:dee(t),ANGLE_instanced_arrays:hee(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const Sf=1;class gee extends qW{constructor(){super();U(this,"type","webgl");fs.defaultProps={...fs.defaultProps,...g2},_o.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){pee(n)}async attach(n){if(n instanceof _o)return n;if((n==null?void 0:n.device)instanceof fs)return n.device;if(!_ee(n))throw new Error("Invalid WebGL2RenderingContext");return new _o({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){ye.groupCollapsed(Sf,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(tJ()),n.debugSpectorJS&&r.push(QQ(n));const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&ye.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new _o(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return ye.probe(Sf,o)(),ye.table(Sf,s.info)(),ye.groupEnd(Sf)(),s}}function _ee(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const cM=new gee;function Qi(){}const vee=({isDragging:t})=>t?"grabbing":"grab",nj={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Qi,onWebGLInitialized:Qi,onResize:Qi,onViewStateChange:Qi,onInteractionStateChange:Qi,onBeforeRender:Qi,onAfterRender:Qi,onLoad:Qi,onError:t=>xt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:vee,getTooltip:null,debug:!1,drawPickingColors:!1};class v2{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new mh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=U0[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,d=u&&(u[i]||u.props[i]),h=this.props[i];let g=!1;d&&(g=d.call(u,l,r)),g||(h==null||h(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...nj,...e},e=this.props,e.viewState&&e.initialViewState&&xt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&xt.error("WebGL1 context not supported.")(),n=cM.attach(e.gl)),n||(n=w0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[cM],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&kc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,l,u,d,h;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&xt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&xt.removed("onLayerClick","onClick")(),e.initialViewState&&!Mr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Sn(this.viewManager),this.viewManager.views}getViewports(e){return Sn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Sn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Sn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new SZ({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new FD({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=l,d=!1;for(const h of o)u=h,d=((r=h.layer)==null?void 0:r.onHover(h,e.event))||d;d||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new kD;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new QG(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(N4).map(o=>{var x;const[l,u,d,h]=N4[o],g=(x=this.props.eventRecognizerOptions)==null?void 0:x[o],_={...u,...g,event:o};return{recognizer:new l(_),recognizeWith:d,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in U0)this.eventManager.on(o,this._onEvent);this.viewManager=new XZ({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new WZ(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new oQ({deck:this,device:this.device}),this.deckRenderer=new uQ(this.device),this.deckPicker=new gQ(this.device),this.widgetManager=new xQ({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new bQ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),xt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=w0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}v2.defaultProps=nj;v2.VERSION=GH;function xee(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return DP(t)}}const yee=PP;function Tf(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function Fs(t){return t.stride||t.size*t.bytesPerElement}function bee(t,e){return t.type===e.type&&t.size===e.size&&Fs(t)===Fs(e)&&(t.offset||0)===(e.offset||0)}function Z0(t,e){e.offset&&xt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Fs(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function wee(t,e){const n=Z0(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class See{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&n.isIndexed?l="uint32":l=i||"float32";let u=xee(i||l);this.doublePrecision=s,s&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Fs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),kc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Z0(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:Fs(r),attributes:i};if(this.doublePrecision){const o=wee(r,n||{});i.push(Tf(e,{...r,...o.high},this.device.type),Tf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=Z0(r,n);i.push(Tf(e,{...r,...o},this.device.type))}else i.push(Tf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const h=n[u++];h<o[d]&&(o[d]=h),h>l[d]&&(l[d]=h)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Et?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=yee(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=Fs(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const l=Fs(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=jb(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const d=s.byteLength+u+l*2;(!o||o.byteLength<d)&&(o=this._createBuffer(d)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?jb(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=kc.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),n&&i&&l.write(i instanceof Float64Array?jb(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&xt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?Et.INDEX:Et.VERTEX)|Et.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const uM=[],fM=[];function Tee(t,e=0,n=1/0){let r=uM;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(fM.length=t.length,r=fM):r=uM,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function rj(t){return t&&t[Symbol.asyncIterator]}function Eee(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,l=t.BYTES_PER_ELEMENT,u=r?r/l:n,d=i?i/l:0,h=Math.floor((t.length-d)/u);return(g,{index:_,target:x})=>{if(!s){const T=_*u+d;for(let A=0;A<n;A++)x[A]=t[T+A];return x}const w=s[_],S=s[_+1]||h;let b;if(o){b=new Array(S-w);for(let T=w;T<S;T++){const A=T*u+d;x=new Array(n);for(let R=0;R<n;R++)x[R]=t[A+R];b[T-w]=x}}else if(u===n)b=t.subarray(w*n+d,S*n+d);else{b=new t.constructor((S-w)*n);let T=0;for(let A=w;A<S;A++){const R=A*u+d;for(let E=0;E<n;E++)b[T++]=t[R+E]}}return b}}const Aee=[],Bf=[[0,1/0]];function Ree(t,e){if(t===Bf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const Cee={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function ij(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Cee[n],...e,...t,type:n}}class sj extends See{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Bf}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!bee(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return ij(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=Ree(this.state.updateRanges,[r,i])}else this.state.updateRanges=Bf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Aee}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Bf),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[d,h]of s)o.call(i,this,{data:n,startRow:d,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,h]of s){const g=Number.isFinite(d)?this.getVertexOffset(d):0,_=Number.isFinite(h)?this.getVertexOffset(h):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Sn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=Eee(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:d,size:h,startIndices:g}=e,{accessor:_,transform:x}=l;let w=u.binaryAccessor||(typeof _=="function"?_:s[_]);typeof w!="function"&&(w=()=>w),Sn(typeof w=="function",`accessor "${_}" is not a function`);let S=e.getVertexOffset(r);const{iterable:b,objectInfo:T}=Tee(n,r,i);for(const A of b){T.index++;let R=w(A,T);if(x&&(R=x.call(this,R)),g){const E=(T.index<g.length-1?g[T.index+1]:o)-g[T.index];if(R&&Array.isArray(R[0])){let C=S;for(const O of R)e._normalizeValue(O,d,C),C+=h}else R&&R.length>h?d.set(R,S):(e._normalizeValue(R,T.target,0),zZ({target:d,source:T.target,start:S,count:E}));S+=E*h}else e._normalizeValue(R,d,S),S+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Hb(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,l=e.length,u=o-r;if(l>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!s)return;let d=l;for(;d<u;){const h=s(d,e);for(let g=0;g<i;g++)n[r+d]=h[g]||0,d++}}function Nee({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Hb({source:t,target:e,size:n,getData:r}),e;let o=0,l=0;const u=r&&((h,g)=>r(h+l,g)),d=Math.min(i.length,s.length);for(let h=1;h<d;h++){const g=i[h]*n,_=s[h]*n;Hb({source:t.subarray(o,g),target:e,start:l,end:_,size:n,getData:u}),o=g,l=_}return l<e.length&&Hb({source:[],target:e,start:l,size:n,getData:u}),e}function kee(t){const{device:e,settings:n,value:r}=t,i=new sj(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function aj(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function oj(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function lj(t){t.push(t.shift())}function Mee(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=t.settings;if(u)for(const d of Object.values(u))l=Math.max(l,d.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function cj({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function uj({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*l,d=n.byteOffset,h=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,g=n.startIndices,_=s&&g,x=n.isConstant;if(!_&&e&&r>=i)return e;const w=n.value instanceof Float64Array?Float32Array:n.value.constructor,S=x?n.value:new w(n.getBuffer().readSyncWebGL(d,i*w.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!x){const R=o;o=(E,C)=>n.normalizeConstant(R(E,C))}const b=x?(R,E)=>o(S,E):(R,E)=>o(S.subarray(R+d,R+d+u),E),T=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),A=new Float32Array(i);return Nee({source:T,target:A,sourceStartIndices:s,targetStartIndices:g,size:u,getData:b}),(!e||e.byteLength<A.byteLength+h)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:A.byteLength+h,usage:35050})),e.write(A,h),e}class fj{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new bh(r),this.attribute=n,this.attributeInTransition=kee(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Mee(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Iee extends fj{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=jee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;lj(s),s[0]=uj({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=cj({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let d=Math.floor(this.currentLength/o.size);dj(o)&&(d/=2),u.setVertexCount(d),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Oee=`uniform interpolationUniforms {
  float time;
} interpolation;
`,dM={name:"interpolation",vs:Oee,uniformTypes:{time:"f32"}},Pee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Dee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function dj(t){return t.doublePrecision&&t.value instanceof Float64Array}function jee(t,e){const n=e.size,r=aj(n),i=oj(n),s=e.getBufferLayout();return dj(e)?new Mc(t,{vs:Dee,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[KY,dM],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Mc(t,{vs:Pee,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[dM],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class Lee extends fj{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=Vee(e),this.framebuffer=qee(e,this.texture),this.transform=$ee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=uj({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=cj({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),lj(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Bee=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Uee={name:"spring",vs:Bee,uniformTypes:{damping:"f32",stiffness:"f32"}},Fee=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,zee=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function $ee(t,e){const n=aj(e.size),r=oj(e.size);return new Mc(t,{vs:Fee,fs:zee,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Uee],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Vee(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function qee(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Hee={interpolation:Iee,spring:Lee};class Wee{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=Hee[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(xt.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const hM="attributeManager.invalidate",Xee="attributeManager.updateStart",Yee="attributeManager.updateEnd",Gee="attribute.updateStart",Kee="attribute.allocate",Zee="attribute.updateEnd";class Qee{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Hc(uZ),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new Wee(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);An(hM,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);An(hM,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;An(Xee,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const h=this.attributes[d],g=h.settings.accessor;h.startIndices=r,h.numInstances=n,s[d]&&xt.removed(`props.${d}`,`data.attributes.${d}`)(),h.setExternalBuffer(o[d])||h.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&h.setConstantValue(s[g])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:n,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&An(Yee,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new sj(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(An(Gee,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&An(Kee,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,An(Zee,n,r))}}class Jee extends bh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=hd(n,r,o)}}const pM=1e-5;function mM(t,e,n,r,i){const s=e-t,l=(n-e)*i,u=-s*r;return l+u+s+e}function ete(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=mM(t[o],e[o],n[o],r,i);return s}return mM(t,e,n,r,i)}function gM(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class tte extends bh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=ete(s,o,n,r,i);const u=gM(l,n),d=gM(l,o);u<pM&&d<pM&&(l=n,this.end()),this._prevValue=o,this._currValue=l}}const nte={interpolation:Jee,spring:tte};class rte{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;n=d,this.remove(e)}if(i=ij(i),!i)return;const o=nte[i.type];if(!o){xt.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:n,toValue:r}),s.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ite(t){const e=t[Hs];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function ste(t,e){const n=hj({newProps:t,oldProps:e,propTypes:t[Hs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=ote(t,e);let i=!1;return r||(i=lte(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:cte(t,e),transitionsChanged:ate(t,e)}}function ate(t,e){if(!t.transitions)return!1;const n={},r=t[Hs];let i=!1;for(const s in t.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&Q0(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function hj({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Q0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Q0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Q0(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function ote(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function lte(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&_M(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&_M(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function cte(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function _M(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},hj({oldProps:i,newProps:r,triggerName:n})}const ute="count(): argument not an object",fte="count(): argument not a container";function dte(t){if(!pte(t))throw new Error(ute);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(hte(t))return Object.keys(t).length;throw new Error(fte)}function hte(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function pte(t){return t!==null&&typeof t=="object"}function vM(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const mte={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},J0={};function gte(t,e,n,r){if(n instanceof jt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...mte,...i,...r},mipmaps:!0});return J0[s.id]=t,s}function _te(t,e){!e||!(e instanceof jt)||J0[e.id]===t&&(e.delete(),delete J0[e.id])}const vte={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||e1(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Mr(t,e,1)}},accessor:{validate(t,e){const n=bd(t);return n==="function"||n===bd(e.value)},equal(t,e,n){return typeof e=="function"?!0:Mr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||e1(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:gte(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{_te(n.id,t)}}};function xte(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=yte(i,s);e[i]=l,n[i]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function yte(t,e){switch(bd(e)){case"object":return Xl(t,e);case"array":return Xl(t,{type:"array",value:e,compare:!1});case"boolean":return Xl(t,{type:"boolean",value:e});case"number":return Xl(t,{type:"number",value:e});case"function":return Xl(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Xl(t,e){return"type"in e?{name:t,...vte[e.type],...e}:"value"in e?{name:t,type:bd(e.value),...e}:{name:t,type:"object",value:e}}function e1(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function bd(t){return e1(t)?"array":t===null?"null":typeof t}function bte(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=t1(t.constructor,n),i=Object.create(r);i[xd]=t,i[Js]={},i[ls]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const wte="_mergedDefaultProps";function t1(t,e){if(!(t instanceof wh.constructor))return{};let n=wte;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=pj(t,n);return r||(t[n]=Ste(t,e||[]))}function Ste(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=t1(r),s=pj(t,"defaultProps")||{},o=xte(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[Hs],o.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[Fb],o.deprecatedProps);for(const h of e){const g=t1(h.constructor);g&&(Object.assign(l,g),Object.assign(u,g[Hs]),Object.assign(d,g[Fb]))}return Tte(l,t),Ate(l,u),Ete(l,d),l[Hs]=u,l[Fb]=d,e.length===0&&!x2(t,"_propTypes")&&(t._propTypes=u),l}function Tte(t,e){const n=Cte(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function Ete(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])x2(this,s)||(this[s]=r);xt.deprecated(i,e[n].join("/"))()}})}function Ate(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(n[o]=l,r[o]=Rte(o))}t[bo]=n,t[Js]={},Object.defineProperties(t,r)}function Rte(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||rj(e)?this[Js][t]=e:this[ls][t]=e},get(){if(this[ls]){if(t in this[ls])return this[ls][t]||this[bo][t];if(t in this[Js]){const e=this[xd]&&this[xd].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[bo][t]}}return this[bo][t]}}}function x2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pj(t,e){return x2(t,e)&&t[e]}function Cte(t){const e=t.componentName;return e||xt.warn(`${t.name}.componentName not specified`)(),e||t.name}let Nte=0;class wh{constructor(...e){this.props=bte(this,e),this.id=this.props.id,this.count=Nte++}clone(e){const{props:n}=this,r={};for(const i in n[bo])i in n[ls]?r[i]=n[ls][i]:i in n[Js]&&(r[i]=n[Js][i]);return new this.constructor({...n,...r,...e})}}wh.componentName="Component";wh.defaultProps={};const kte=Object.freeze({});class Mte{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||kte}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[xd]||this.component;const n=e[ls]||{},r=e[Js]||e,i=e[bo]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(rj(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Hs];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class Ite extends Mte{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const Ote="layer.changeFlag",Pte="layer.initialize",Dte="layer.update",jte="layer.finalize",Lte="layer.matched",xM=2**24-1,Bte=Object.freeze([]),Ute=Hc(({oldViewport:t,viewport:e})=>t.equals(e));let Ar=new Uint8ClampedArray(0);const Fte={data:{type:"data",value:Bte,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:m0(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:u=>{var d;return(d=n.internalState)==null?void 0:d.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):m0(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:tt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Wc extends wh{constructor(){super(...arguments),this.internalState=null,this.lifecycle=uo.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Sn(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=ND(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=TD(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Sn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Sn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return gZ(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===tt.DEFAULT||e===tt.LNGLAT||e===tt.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Sn(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:dte(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=vM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=vM(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=n.attributes,d=l||u;d&&(o&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!o&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!Ute({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Ar.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>xM&&xt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ar=kc.allocate(Ar,n,{size:4,copy:!0,maxCount:Math.max(n,xM)});const i=Math.floor(Ar.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Ar[o*4+0]=s[0],Ar[o*4+1]=s[1],Ar[o*4+2]=s[2],Ar[o*4+3]=0}e.value=Ar.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var l;if(!Object.keys(n).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),n=u.getAttributes()}const i=((l=e.userData)==null?void 0:l.excludeAttributes)||{},s={},o={};for(const u in n){if(i[u])continue;const d=n[u].getValue();for(const h in d){const g=d[h];g instanceof Et?n[u].settings.isIndexed?e.setIndexBuffer(g):s[h]=g:g&&(o[h]=g)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const h=s.getVertexOffset(d);l[h]===u[0]&&l[h+1]===u[1]&&l[h+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ar.buffer&&(r.value=Ar.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Sn(!this.internalState),Sn(Number.isFinite(this.props.coordinateSystem)),An(Pte,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Ite({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(xt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new rte(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){An(Lte,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(An(Dte,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const h of this.props.extensions)h.updateState.call(this,l,h);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(l,d)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){An(jte,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof _o&&o.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(o.device instanceof _o)o.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=n[i];o&&Array.isArray(l)&&(n.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&An(Ote,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=ste(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){ite(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Qee(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(n||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Wc.defaultProps=Fte;Wc.layerName="Layer";const Wb=Math.PI/180;function zte({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],l=n==="Z"?[0,-e,0]:[0,0,e],u=new Or().lookAt({eye:l,up:o});u.rotateX(r*Wb),n==="Z"?u.rotateZ(i*Wb):u.rotateY(i*Wb);const d=Math.pow(2,s)/t;return u.scale(d),u}class $te extends zo{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:l=0,rotationOrbit:u=0,zoom:d=0}=e,h=r?r[5]/2:u2(i);super({...e,longitude:void 0,viewMatrix:zte({height:n||1,focalDistance:h,orbitAxis:s,rotationX:l,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:h,position:o,zoom:d}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[l,u,d]=xh([r,o,s],this.pixelUnprojectionMatrix);return[l,u,d]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class Vte extends UD{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:l=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:h=-1/0,maxZoom:g=1/0,startPanPosition:_,startRotatePos:x,startRotationX:w,startRotationOrbit:S,startZoomPosition:b,startZoom:T}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:l,minRotationX:u,maxRotationX:d,minZoom:h,maxZoom:g},{startPanPosition:_,startRotatePos:x,startRotationX:w,startRotationOrbit:S,startZoomPosition:b,startZoom:T}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:l,height:u}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let d;if(e){let h=(e[0]-i[0])/l;const g=(e[1]-i[1])/u;(s<-90||s>90)&&(h*=-1),d={rotationX:s+g*180,rotationOrbit:o+h*180}}else d={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return Zn(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:l}=e;return e.zoom=Array.isArray(i)?[Zn(i[0],r,n),Zn(i[1],r,n)]:Zn(i,r,n),e.rotationX=Zn(e.rotationX,o,s),(l<-180||l>180)&&(e.rotationOrbit=aZ(l+180,360)-180),e}}class qte extends BD{constructor(){super(...arguments),this.ControllerState=Vte,this.transition={transitionDuration:300,transitionInterpolator:new d2({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class y2 extends ea{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return $te}get ControllerType(){return qte}}y2.displayName="OrbitView";const Hte=typeof window<"u"?D.useLayoutEffect:D.useEffect;function wd(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const Wte={position:"absolute",zIndex:-1};function mj(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>mj(n,e));if(Sh(t)){if(Xte(t))return e.style=Wte,D.cloneElement(t,e);if(Yte(t))return D.cloneElement(t,e)}return t}function Sh(t){return t&&typeof t=="object"&&"type"in t||!1}function Xte(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function Yte(t){const e=t.type;return e&&e.deckGLViewProps}function n1(t){if(typeof t=="function")return D.createElement(ea,{},t);if(Array.isArray(t))return t.map(n1);if(Sh(t)){if(t.type===D.Fragment)return n1(t.props.children);if(wd(t.type,ea))return t}return t}function Gte({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return D.Children.forEach(n1(t),o=>{if(Sh(o)){const l=o.type;if(wd(l,Wc)){const u=Kte(l,o.props);i.push(u)}else r.push(o);if(wd(l,ea)&&l!==ea&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function Kte(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const Zte=D.createContext();function Qte({children:t,deck:e,ContextProvider:n=Zte.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let l=s,u=o;Sh(o)&&wd(o.type,ea)&&(l=o.props.id||s,u=o.props.children);const d=r.getViewport(l),h=r.getViewState(l);if(d){h.padding=d.padding;const{x:g,y:_,width:x,height:w}=d;u=mj(u,{x:g,y:_,width:x,height:w,viewport:d,viewState:h}),i[l]||(i[l]={viewport:d,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:d,y:h,width:g,height:_}=l,x={position:"absolute",left:d,top:h,width:g,height:_},w=`view-${o}`,S=D.createElement("div",{key:w,id:w,style:x},...u),b={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:A=>{A.viewId=o,e._onViewStateChange(A)},widgets:[]},T=`view-${o}-context`;return D.createElement(n,{key:T,value:b},S)})}const Jte={mixBlendMode:null};function ene({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in Jte?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function tne(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function gj(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function nne(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:l=>{t.redrawReason=l;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():gj(t)}});return r}function rne(t,e){const[n,r]=D.useState(0),s=D.useRef({control:null,version:n,forceUpdate:()=>r(C=>C+1)}).current,o=D.useRef(null),l=D.useRef(null),u=D.useMemo(()=>Gte(t),[t.layers,t.views,t.children]);let d=!0;const h=C=>{var O;return d&&t.viewState?(s.viewStateUpdateRequested=C,null):(s.viewStateUpdateRequested=null,(O=t.onViewStateChange)==null?void 0:O.call(t,C))},g=C=>{var O;d?s.interactionStateUpdateRequested=C:(s.interactionStateUpdateRequested=null,(O=t.onInteractionStateChange)==null||O.call(t,C))},_=D.useMemo(()=>{const C={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:g};return delete C._customRender,s.deck&&s.deck.setProps(C),C},[t]);D.useEffect(()=>{const C=t.Deck||v2;return s.deck=nne(s,C,{..._,parent:o.current,canvas:l.current}),()=>{var O;return(O=s.deck)==null?void 0:O.finalize()}},[]),Hte(()=>{gj(s);const{viewStateUpdateRequested:C,interactionStateUpdateRequested:O}=s;C&&h(C),O&&g(O)}),D.useImperativeHandle(e,()=>tne(s),[]);const x=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:w,width:S="100%",height:b="100%",id:T,style:A}=t,{containerStyle:R,canvasStyle:E}=D.useMemo(()=>ene({width:S,height:b,style:A}),[S,b,A]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===x||s.version!==n){s.lastRenderedViewports=x,s.version=n;const C=Qte({children:u.children,deck:s.deck,ContextProvider:w}),O=D.createElement("canvas",{key:"canvas",id:T||"deckgl-overlay",ref:l,style:E});s.control=D.createElement("div",{id:`${T||"deckgl"}-wrapper`,ref:o,style:R},[O,C])}return d=!1,s.control}const _j=D.forwardRef(rne),ine=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,yM=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,sne={name:"line",source:ine,vs:yM,fs:yM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},ane=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,one=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,lne=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cne=[0,0,0,255],une={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:cne},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Ys extends Wc{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:one,fs:lne,source:ane,modules:[bD,AD,sne]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,u={widthUnits:Qs[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:u}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...u,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Io(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new PD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Ys.layerName="LineLayer";Ys.defaultProps=une;const bM=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,fne={name:"scatterplot",vs:bM,fs:bM,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},dne=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hne=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pne=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,wM=[0,0,0,255],mne={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:wM},getLineColor:{type:"accessor",value:wM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Th extends Wc{getShaders(){return super.getShaders({vs:dne,fs:hne,source:pne,modules:[bD,AD,fne]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:d,lineWidthUnits:h,lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:x}=this.props,w={stroked:o,filled:l,billboard:u,antialiasing:d,radiusUnits:Qs[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Qs[h],lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:x},S=this.state.model;S.shaderInputs.setProps({scatterplot:w}),S.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Io(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new PD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Th.defaultProps=mne;Th.layerName="ScatterplotLayer";function b2(t,e=160){const n=[];if(!t||!t.coordinates)return n;const r=t.bounds||vj(t),[i,s,o,l]=r,u=(i+o)/2,d=(s+l)/2,h=Math.max(o-i,l-s)||1,g=(x,w)=>{const S=(x-u)/h*e,b=(w-d)/h*e;return[S,b]},_=x=>{for(let w=0;w<x.length-1;w++){const[S,b]=g(x[w][0],x[w][1]),[T,A]=g(x[w+1][0],x[w+1][1]);n.push([S,b,T,A])}};switch(t.type){case"Polygon":const x=t.coordinates;if(x.length>0){_(x[0]);for(let b=1;b<x.length;b++)_(x[b])}break;case"MultiPolygon":const w=t.coordinates;for(const b of w)if(b.length>0){_(b[0]);for(let T=1;T<b.length;T++)_(b[T])}break;case"LineString":Array.isArray(t.coordinates)&&t.coordinates.length>0&&_(t.coordinates);break;case"MultiLineString":const S=t.coordinates;for(const b of S)_(b);break;case"GeometryCollection":if("geometries"in t){const b=t.geometries;for(const T of b)T.type==="LineString"&&T.coordinates&&_(T.coordinates)}break;default:console.warn(`Unsupported geometry type: ${t.type}`)}return n}function Sd(t,e,n,r){return t.map(([i,s,o,l])=>({source:[i,s,e],target:[o,l,e],color:n,width:r}))}function vj(t){let e=1/0,n=1/0,r=-1/0,i=-1/0;const s=o=>{if(typeof o[0]=="number"){const[l,u]=o;e=Math.min(e,l),n=Math.min(n,u),r=Math.max(r,l),i=Math.max(i,u)}else for(const l of o)s(l)};if(t.coordinates&&s(t.coordinates),"geometries"in t){const o=t.geometries;for(const l of o)l.coordinates&&s(l.coordinates)}return[e,n,r,i]}function ta(t=10,e=160){const n=[];for(let r=0;r<=t;r++)n.push([[0,r],[t,r]]);for(let r=0;r<=t;r++)n.push([[r,0],[r,t]]);return{type:"GeometryCollection",name:"Unit Grid",bounds:[0,0,t,t],coordinates:n.flat(),geometries:n.map(r=>({type:"LineString",coordinates:r}))}}const SM=Object.freeze(Object.defineProperty({__proto__:null,calculateShapeBounds:vj,convertShapeToLines:b2,createShapeLines:Sd,createUnitGridShape:ta},Symbol.toStringTag,{value:"Module"}));function gne(t,e,n){if(!t.location||!e.location||t.location.x!==e.location.x||t.location.y!==e.location.y)return!1;const r=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===t.id||d===t.id}),i=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===e.id||d===e.id});if(r.length!==i.length)return!1;const s=new Set,o=new Set;if(r.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==t.id&&s.add(u),d!==t.id&&s.add(d)}),i.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==e.id&&o.add(u),d!==e.id&&o.add(d)}),s.size!==o.size)return!1;for(const l of s)if(!o.has(l))return!1;return!0}function xj(t,e){const n=new Set,r=[],i=[],s=new Map;for(let l=0;l<t.length;l++){if(n.has(t[l].id))continue;const u=t[l],d=[u];if(u.is_sample){r.push(u),s.set(u.id,u.id),n.add(u.id);continue}for(let h=l+1;h<t.length;h++){const g=t[h];n.has(g.id)||g.is_sample||u.time===g.time&&u.is_sample===g.is_sample&&gne(u,g,e)&&(d.push(g),n.add(g.id))}if(d.length>1){const h={...u,id:u.id,is_combined:!0,combined_nodes:d.map(g=>g.id)};r.push(h),d.forEach(g=>s.set(g.id,h.id))}else r.push(u),s.set(u.id,u.id);n.add(u.id)}const o=new Set;return e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id,h=s.get(u),g=s.get(d);if(h!==void 0&&g!==void 0&&h!==g){const _=`${Math.min(h,g)}-${Math.max(h,g)}`;o.has(_)||(o.add(_),i.push({...l,source:h,target:g}))}}),{nodes:r,edges:i}}const Jr=(t,e,n)=>{const r=n.some(s=>(typeof s.target=="number"?s.target:s.target.id)===t.id),i=n.some(s=>(typeof s.source=="number"?s.source:s.source.id)===t.id);return!r&&i},_ne=(t,e,n)=>n?`Lat: ${e.toFixed(3)}, Lon: ${t.toFixed(3)}`:`(${t.toFixed(2)}, ${e.toFixed(2)})`,Tt={AUTO_FIT_ZOOM:1.8,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,BASE_ELEVATION:.1,SELECTED_NODE_SCALE:1.5,TEMPORAL_FADE_OPACITY:.5,EDGE_FADE_OPACITY:.2,EDGE_PARTIAL_FADE_OPACITY:.5,REDUCED_OPACITY_MULTIPLIER:.3,GRID_EXTENSION:2,UNIT_GRID_SIZE:10},sc={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},rs={GEOGRAPHIC_NORMAL:3,TIME_SLICE_NORMAL:1.5,NODE_OUTLINE_SELECTED:2,NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4},vne=t=>t*Tt.JITTER_SCALE%Tt.JITTER_RANGE-Tt.JITTER_OFFSET,xne=(t,e,n)=>t.is_sample?sc.SAMPLE:t.is_combined?sc.COMBINED:Jr(t,e,n)?sc.ROOT:sc.DEFAULT,yne=(t,e,n,r)=>{if(n!=="planes"||!e)return r;const[i,s]=e;return t>=i&&t<=s?r:r*Tt.TEMPORAL_FADE_OPACITY},bne=(t,e,n,r,i)=>{if(r!=="planes"||!n)return i;const[s,o]=n,l=t.time>=s&&t.time<=o,u=e.time>=s&&e.time<=o;return!l&&!u?i*Tt.EDGE_FADE_OPACITY:!l||!u?i*Tt.EDGE_PARTIAL_FADE_OPACITY:i},wne=(t,e,n)=>t||(e==="unit_grid"?ta(Tt.UNIT_GRID_SIZE,n):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):ta(Tt.UNIT_GRID_SIZE,n)),Sne=(t,e,n)=>{const{nodes:r}=xj(t,[]),i=r.filter(S=>{var b,T;return((b=S.location)==null?void 0:b.x)!==void 0&&((T=S.location)==null?void 0:T.y)!==void 0});if(i.length===0)return null;const s=i.map(S=>S.location.x),o=i.map(S=>S.location.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let g,_,x;if((e==="eastern_hemisphere"||e==="custom")&&(n==null?void 0:n.bounds)){const S=n.bounds,[b,T,A,R]=S;g=(b+A)/2,_=(T+R)/2,x=Math.max(A-b,R-T)||1}else g=(l+u)/2,_=(d+h)/2,x=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:g,centerY:_,maxScale:x,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}},Tne=t=>{const e=Array.from(new Set(t.map(n=>n.time))).sort((n,r)=>n-r);return new Map(e.map((n,r)=>[n,r]))};function yj(t,e,n,r){if(e.length<=1)return 0;switch(r){case"equal":let i=0;for(let T=0;T<e.length&&!(e[T]>t);T++)i=T;if(i===e.length-1||e[i]===t)return i*n;const s=e[i],o=e[i+1],l=(t-s)/(o-s);return(i+l)*n;case"log":const u=Math.max(1e-4,e[0]),d=e[e.length-1],h=Math.log(u),g=Math.log(d);return(Math.log(Math.max(1e-4,t))-h)/(g-h)*(e.length-1)*n;case"linear":const w=e[0],S=e[e.length-1];return(t-w)/(S-w)*(e.length-1)*n}}const Ene=(t,e,n,r,i,s,o,l,u)=>{const{centerX:d,centerY:h,maxScale:g}=e,_=Tne(t);return t.map(x=>{const w=(x.location.x-d)/g*r,S=(x.location.y-h)/g*r;_.get(x.time);const b=vne(x.id),T=yj(x.time,l,n,u)+Tt.BASE_ELEVATION+b,A=xne(x,s,o);let R;return x.is_sample?R=i.nodeSample:x.is_combined?R=i.nodeCombined:Jr(x,s,o)?R=i.nodeRoot:R=i.nodeDefault,{...x,position:[w,S,T],color:R,size:A}})},Ane=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=bne(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),Rne=(t,e,n,r,i)=>{if(e&&t.id===e.id)return i.nodeSelected;const o=yne(t.time,n,r,t.color[3]);return[t.color[0],t.color[1],t.color[2],o]},Cne=(t,e,n,r,i,s)=>{const o=e&&t.id===e.id,l=Jr(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]);let u=1;if(i==="planes"&&r){const[d,h]=r;t.time>=d&&t.time<=h||(u=Tt.REDUCED_OPACITY_MULTIPLIER)}if(o)return s.nodeSelected;if(l)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*u];if(t.is_sample){const d=s.background==="#ffffff"?0:255;return[d,d,d,255*u]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},Nne=(t,e,n)=>{const r=e&&t.id===e.id,i=Jr(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]),o=(r?t.size*Tt.SELECTED_NODE_SCALE:t.size)/sc.DEFAULT;return r?Math.max(1,rs.NODE_OUTLINE_SELECTED*o):i?Math.max(.8,rs.NODE_OUTLINE_ROOT*o):t.is_sample?Math.max(.5,rs.NODE_OUTLINE_SAMPLE*o):0},kne=(t,e,n,r)=>{var s;let i="";return t.is_sample?i="Sample Node":t.is_combined?i=`Combined Node (contains: ${(s=t.combined_nodes)==null?void 0:s.join(", ")})`:Jr(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?i="Root Node":i="Internal Node",{html:`
      <div style="background: ${r.tooltipBackground}; color: ${r.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${i}<br/>
        ${t.location?`Location: ${_ne(t.location.x,t.location.y,n==="eastern_hemisphere")}`:""}
      </div>
    `,style:{backgroundColor:"transparent",color:r.tooltipText}}},bj=vc.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,selectedNode:s,temporalRange:o,showTemporalPlanes:l=!1,temporalFilterMode:u=null,temporalSpacing:d=12,spatialSpacing:h=160,geographicShape:g=null,geographicMode:_="unit_grid",temporalGridOpacity:x=30,geographicShapeOpacity:w=70,maxNodeRadius:S=25,onViewStateChange:b,externalViewState:T,temporalSpacingMode:A="equal"},R)=>{const E=D.useRef(null),{colors:C}=bt(),[O,P]=D.useState({target:[0,0,0],zoom:Tt.AUTO_FIT_ZOOM,minZoom:Tt.MIN_ZOOM,maxZoom:Tt.MAX_ZOOM,rotationX:30,rotationOrbit:0,orbitAxis:"Y"});vc.useEffect(()=>{T&&P(j=>({...j,...T}))},[T]);const k=D.useMemo(()=>!t||!t.nodes.length?null:Sne(t.nodes,_,g),[t,_,g==null?void 0:g.bounds]),{nodes3D:I,edges3D:N,bounds:B}=D.useMemo(()=>{if(!k)return{nodes3D:[],edges3D:[],bounds:null};const{nodes:j,edges:Y}=xj(t.nodes,t.edges),$=Array.from(new Set(j.map(W=>W.time))).sort((W,fe)=>W-fe),Q=Ene(k.spatialNodes,k,d,h,C,j,Y,$,A),oe=new Map;Q.forEach(W=>oe.set(W.id,W));const K=Ane(Y,oe,o||null,u||null,C),L={minX:Math.min(...Q.map(W=>W.position[0])),maxX:Math.max(...Q.map(W=>W.position[0])),minY:Math.min(...Q.map(W=>W.position[1])),maxY:Math.max(...Q.map(W=>W.position[1])),minZ:Math.min(...Q.map(W=>W.position[2])),maxZ:Math.max(...Q.map(W=>W.position[2]))};return{nodes3D:Q,edges3D:K,bounds:L}},[k,d,h,A,u,o,C]),V=D.useMemo(()=>{var se,z;if(!B||!I.length)return[];const j=wne(g,_,h);if(!j)return[];const Y=b2(j,h),$=l&&u==="planes";console.log("Temporal Filter State:",{showTemporalPlanes:l,temporalFilterMode:u,isTemporalPlanesActive:$,temporalRange:o,temporalSpacing:d,temporalSpacingMode:A});const Q=w??70,oe=Q>0?$?Math.max(Q*.15,8):Q:0,K=[C.geographicGrid[0],C.geographicGrid[1],C.geographicGrid[2],oe],L=Sd(Y,0,K,rs.GEOGRAPHIC_NORMAL);let W=[];if($&&o){const X=Array.from(new Set(I.map(Ne=>Ne.time))).sort((Ne,be)=>Ne-be),J=(o[0]+o[1])/2,pe=yj(J,X,d,A);console.log("Elevated Shape Position:",{centerTime:J,allUniqueTimes:X,z:pe,temporalRange:o,temporalSpacing:d});const xe=Q*2.5,Ae=[C.geographicGrid[0],C.geographicGrid[1],C.geographicGrid[2],xe];W=Sd(Y,pe,Ae,rs.GEOGRAPHIC_NORMAL*1.5),console.log("Created Elevated Shape:",{numLines:W.length,firstLine:W[0],opacity:xe,color:Ae})}const fe=[...L,...W];if(console.log("Final Lines:",{totalLines:fe.length,groundLines:L.length,elevatedLines:W.length,sampleGroundZ:(se=L[0])==null?void 0:se.source[2],sampleElevatedZ:(z=W[0])==null?void 0:z.source[2]}),x>0){const X=Array.from(new Set(I.map(Ne=>Ne.time))).sort((Ne,be)=>Ne-be),J=new Map(X.map((Ne,be)=>[Ne,be])),pe=x,xe=$?Math.min(pe*.3,8):pe,Ae=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2],xe];X.forEach(Ne=>{const we=(J.get(Ne)||0)*d;we!==0&&(fe.push({source:[B.minX-Tt.GRID_EXTENSION,0,we],target:[B.maxX+Tt.GRID_EXTENSION,0,we],color:Ae,width:rs.TIME_SLICE_NORMAL}),fe.push({source:[0,B.minY-Tt.GRID_EXTENSION,we],target:[0,B.maxY+Tt.GRID_EXTENSION,we],color:Ae,width:rs.TIME_SLICE_NORMAL}))})}return fe},[B,C.geographicGrid,C.temporalGrid,I,d,A,h,l,u,x,w,g,_,o]),Z=[new Ys({id:"geographic-lines",data:V,pickable:!1,getSourcePosition:j=>j.source,getTargetPosition:j=>j.target,getColor:j=>j.color,getWidth:j=>j.width||.5}),new Ys({id:"edges",data:N,pickable:!1,getSourcePosition:j=>j.source,getTargetPosition:j=>j.target,getColor:j=>j.color,getWidth:Tt.EDGE_WIDTH}),new Th({id:"nodes",data:I,pickable:!0,opacity:Tt.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:Tt.NODE_RADIUS_SCALE,radiusMinPixels:Tt.MIN_NODE_RADIUS,radiusMaxPixels:S,lineWidthMinPixels:Tt.MIN_NODE_RADIUS,lineWidthMaxPixels:rs.MAX_NODE_OUTLINE,getPosition:j=>j.position,getRadius:j=>s&&j.id===s.id?j.size*Tt.SELECTED_NODE_SCALE:j.size,getFillColor:j=>Rne(j,s||null,o||null,u||null,C),getLineColor:j=>Cne(j,s||null,t,o||null,u||null,C),getLineWidth:j=>Nne(j,s||null,t),onClick:(j,Y)=>{Y.srcEvent.preventDefault(),j.object&&r&&r(j.object)},onHover:j=>{j.rightButton&&j.object&&i&&i(j.object)}})];return!t||I.length===0?p.jsx("div",{className:"flex items-center justify-center border rounded bg-sp-very-dark-blue text-sp-white border-sp-dark-blue",style:{width:e,height:n},children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-lg mb-2",children:"No spatial data available"}),p.jsx("p",{className:"text-sm text-sp-white/75",children:"This ARG does not contain 2D spatial information required for 3D visualization."})]})}):p.jsx("div",{style:{width:e,height:n},className:"relative bg-sp-very-dark-blue","data-3d-visualization":"true",ref:j=>{j&&typeof R=="function"?R(j):j&&R&&"current"in R&&(R.current=j),j&&(j.getExportData=()=>({nodes:I,edges:N,bounds:B,currentViewState:O}),j.setViewState=Y=>{P($=>({...$,...Y}))})},onContextMenu:j=>{j.preventDefault();const Y=j.currentTarget.getBoundingClientRect(),$=j.clientX-Y.left,Q=j.clientY-Y.top;if(E.current){const oe=E.current.pickObject({x:$,y:Q,radius:10});oe!=null&&oe.object&&i&&i(oe.object)}},children:p.jsx(_j,{ref:E,width:e,height:n,views:new y2,viewState:O,onViewStateChange:({viewState:j})=>{P(j),b==null||b(j)},controller:{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0},layers:Z,getCursor:()=>"crosshair",style:{backgroundColor:C.background},getTooltip:({object:j})=>j?kne(j,t,_,C):null})})});bj.displayName="SpatialArg3DVisualization";const Eh=({initialPosition:t={x:0,y:0},onPositionChange:e,dragHandleRef:n}={})=>{const[r,i]=D.useState({position:t,isDragging:!1,dragOffset:{x:0,y:0},hasMoved:!1,startTime:0}),s=D.useRef(null),o=D.useCallback(h=>{var w;if(n!=null&&n.current&&!n.current.contains(h.target))return;const g=(w=s.current)==null?void 0:w.getBoundingClientRect();if(!g)return;const _=r.position.x===0&&r.position.y===0?{x:g.left,y:g.top}:r.position,x={x:h.clientX-g.left,y:h.clientY-g.top};i(S=>({...S,position:_,isDragging:!0,dragOffset:x,hasMoved:!1,startTime:Date.now()})),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"},[n,r.position]),l=D.useCallback(h=>{var T;if(!r.isDragging)return;const g={x:h.clientX-r.dragOffset.x,y:h.clientY-r.dragOffset.y},_=window.innerWidth,x=window.innerHeight,w=(T=s.current)==null?void 0:T.getBoundingClientRect();w&&(g.x=Math.max(0,Math.min(_-w.width,g.x)),g.y=Math.max(0,Math.min(x-w.height,g.y)));const S=Date.now()-r.startTime>150,b=Math.abs(g.x-r.position.x)>3||Math.abs(g.y-r.position.y)>3;i(A=>({...A,position:g,hasMoved:A.hasMoved||S||b})),e==null||e(g)},[r.isDragging,r.dragOffset,r.startTime,r.position,e]),u=D.useCallback(()=>{i(h=>({...h,isDragging:!1})),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);D.useEffect(()=>{if(r.isDragging)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}},[r.isDragging,l,u]);const d=r.position.x!==0||r.position.y!==0;return{position:r.position,isDragging:r.isDragging,hasMoved:r.hasMoved,isRepositioned:d,elementRef:s,dragProps:{onMouseDown:o,style:d?{position:"fixed",left:r.position.x,top:r.position.y,cursor:r.isDragging?"grabbing":"grab",zIndex:r.isDragging?9999:void 0}:{cursor:"grab"}},setPosition:h=>{i(g=>({...g,position:h})),e==null||e(h)}}},Mne=({temporalSpacing:t,onTemporalSpacingChange:e,temporalSpacingMode:n,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:g,geographicMode:_,onGeographicModeChange:x,customShapeFile:w,onCustomShapeFileChange:S,isLoadingGeographic:b,currentShape:T,showCrsWarning:A,crsDetection:R,onDismissCrsWarning:E})=>{const{colors:C}=bt(),[O,P]=D.useState(!0),k=D.useRef(null),{elementRef:I,dragProps:N,hasMoved:B,isRepositioned:V}=Eh({initialPosition:{x:0,y:0},dragHandleRef:k}),Z=Y=>{x(Y)},j=Y=>{var Q;const $=(Q=Y.target.files)==null?void 0:Q[0];$&&S($)};return p.jsxs("div",{ref:I,className:`border rounded-lg shadow-lg z-30 ${V?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${C.background}F0`,borderColor:C.border,color:C.text,...N.style},onMouseDown:N.onMouseDown,children:[p.jsxs("div",{ref:k,onClick:()=>!B&&P(!O),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:O?"transparent":`${C.containerBackground}80`},onMouseEnter:Y=>{O||(Y.currentTarget.style.backgroundColor=`${C.border}40`)},onMouseLeave:Y=>{O||(Y.currentTarget.style.backgroundColor=`${C.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:C.text},children:[p.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"3D Visualization Controls"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${O?"rotate-180":""}`,style:{color:C.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),O&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Geographic Settings"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Geographic Mode"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[p.jsx("button",{onClick:()=>Z("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="unit_grid"?C.accentPrimary:C.containerBackground,color:_==="unit_grid"?C.background:C.text},children:"Unit Grid"}),p.jsx("button",{onClick:()=>Z("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="eastern_hemisphere"?C.accentPrimary:C.containerBackground,color:_==="eastern_hemisphere"?C.background:C.text},children:"Eastern Hemisphere"}),p.jsx("button",{onClick:()=>Z("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="custom"?C.accentPrimary:C.containerBackground,color:_==="custom"?C.background:C.text},children:"Custom"})]})]}),_==="custom"&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Upload Shapefile (.zip)"}),p.jsx("input",{type:"file",accept:".zip",onChange:j,className:"w-full text-xs border rounded px-2 py-1 transition-colors",style:{color:C.text,backgroundColor:C.containerBackground,borderColor:`${C.accentPrimary}33`},onMouseEnter:Y=>{Y.currentTarget.style.borderColor=`${C.accentPrimary}66`},onMouseLeave:Y=>{Y.currentTarget.style.borderColor=`${C.accentPrimary}33`}}),w&&p.jsxs("p",{className:"text-xs",style:{color:C.accentPrimary},children:["Selected: ",w.name]})]}),b&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:C.accentPrimary}}),p.jsx("span",{className:"text-xs",style:{color:C.text},children:"Loading geographic data..."})]}),T&&p.jsxs("div",{className:"text-xs",style:{color:`${C.text}B3`},children:[p.jsxs("div",{children:["Shape: ",T.name]}),T.bounds&&p.jsx("div",{children:"Shape loaded successfully"})]}),A&&R&&p.jsxs("div",{className:"border rounded p-3 space-y-2",style:{backgroundColor:`${C.background}33`,borderColor:`${C.accentPrimary}4D`},children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("h5",{className:"text-xs font-bold",style:{color:C.accentPrimary},children:"Coordinate System Detected"}),p.jsx("button",{onClick:E,className:"text-xs",style:{color:`${C.accentPrimary}B3`},onMouseEnter:Y=>{Y.currentTarget.style.color=C.accentPrimary},onMouseLeave:Y=>{Y.currentTarget.style.color=`${C.accentPrimary}B3`},children:""})]}),p.jsxs("div",{className:"text-xs space-y-1",style:{color:`${C.accentPrimary}E6`},children:[p.jsxs("div",{children:["CRS: ",R.crs]}),p.jsxs("div",{children:["Confidence: ",(R.confidence*100).toFixed(1),"%"]}),p.jsxs("div",{children:["Land coverage: ",(R.landPercentage*100).toFixed(1),"%"]}),p.jsx("div",{className:"italic",children:R.description})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Temporal Spacing"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("label",{className:"text-xs font-medium",style:{color:C.text},children:"Spacing Mode"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[p.jsx("button",{onClick:()=>r("equal"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="equal"?C.accentPrimary:C.containerBackground,color:n==="equal"?C.background:C.text},children:"Equal"}),p.jsx("button",{onClick:()=>r("log"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="log"?C.accentPrimary:C.containerBackground,color:n==="log"?C.background:C.text},children:"Log"}),p.jsx("button",{onClick:()=>r("linear"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="linear"?C.accentPrimary:C.containerBackground,color:n==="linear"?C.background:C.text},children:"Linear"})]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("label",{className:"text-xs font-medium",style:{color:C.text},children:["Spacing: ",t]})}),p.jsx("input",{type:"range",min:5,max:50,step:1,value:t,onChange:Y=>e(Number(Y.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(t-5)/45*100}%, ${C.border} ${(t-5)/45*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),p.jsxs("div",{className:"text-xs",style:{color:`${C.text}CC`},children:[n==="equal"&&p.jsx("div",{children:" Time points are spaced equally"}),n==="log"&&p.jsx("div",{children:" Time points are spaced logarithmically based on their actual values"}),n==="linear"&&p.jsx("div",{children:" Time points are spaced according to their actual time values"})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Spacing"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Spatial Spacing: ",i]}),p.jsx("input",{type:"range",min:50,max:500,step:10,value:i,onChange:Y=>s(Number(Y.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(i-50)/450*100}%, ${C.border} ${(i-50)/450*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Opacity"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Temporal Grid: ",o,"%"]}),p.jsx("input",{type:"range",min:0,max:100,step:5,value:o,onChange:Y=>l(Number(Y.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${o}%, ${C.border} ${o}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Geographic Shape: ",u,"%"]}),p.jsx("input",{type:"range",min:0,max:100,step:5,value:u,onChange:Y=>d(Number(Y.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${u}%, ${C.border} ${u}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Node Settings"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Max Node Radius: ",h,"px"]}),p.jsx("input",{type:"range",min:10,max:50,step:1,value:h,onChange:Y=>g(Number(Y.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(h-10)/40*100}%, ${C.border} ${(h-10)/40*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]})]})]})},Ine=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,crsDetection:o})=>{const{colors:l}=bt(),[u,d]=D.useState(!0),h=D.useRef(null),{elementRef:g,dragProps:_,hasMoved:x,isRepositioned:w}=Eh({initialPosition:{x:0,y:0},dragHandleRef:h}),S=t&&n?(n/t*100).toFixed(1):null,b=e&&r?(r/e*100).toFixed(1):null;return t||n||i||o?p.jsxs("div",{ref:g,className:`border rounded-lg shadow-lg z-10 ${w?"":"absolute top-4 right-4"}`,style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text,maxWidth:"280px",..._.style},onMouseDown:_.onMouseDown,children:[p.jsxs("div",{ref:h,onClick:()=>!x&&d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:A=>{u||(A.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:A=>{u||(A.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[p.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[(t||n||i)&&p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Statistics"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Original ARG:"}),p.jsxs("span",{style:{color:l.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"SubARG:"}),p.jsxs("span",{style:{color:l.text},children:[n.toLocaleString()," nodes (",S,"%), ",r.toLocaleString()," edges (",b,"%)"]})]}),i&&s&&(i!==n||s!==r)&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Displayed:"}),p.jsxs("span",{style:{color:l.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Reduction:"}),p.jsxs("span",{style:{color:l.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),o&&p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Coordinate System"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Detected CRS:"}),p.jsx("span",{style:{color:l.text},children:o.crs})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Confidence:"}),p.jsxs("span",{style:{color:l.text},children:[(o.confidence*100).toFixed(1),"%"]})]}),p.jsxs("div",{className:"flex justify-between",children:[p.jsx("span",{style:{color:l.accentPrimary},children:"Land Coverage:"}),p.jsxs("span",{style:{color:l.text},children:[(o.landPercentage*100).toFixed(1),"%"]})]}),o.description&&p.jsxs("div",{className:"mt-2",children:[p.jsx("div",{className:"mb-1",style:{color:l.accentPrimary},children:"Description:"}),p.jsx("div",{className:"text-xs italic",style:{color:`${l.text}CC`},children:o.description})]})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"View Controls"}),p.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[p.jsx("div",{children:" Drag: Rotate view"}),p.jsx("div",{children:" Shift+drag: Pan view"}),p.jsx("div",{children:" Scroll: Zoom in/out"}),p.jsx("div",{children:" Left click: Select node"}),p.jsx("div",{children:" Right click: Show ancestors"})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Types"}),p.jsxs("div",{className:"space-y-2 text-xs",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${l.nodeSample[0]}, ${l.nodeSample[1]}, ${l.nodeSample[2]})`,borderColor:l.background,borderWidth:"0.5px"}}),p.jsx("span",{style:{color:l.text},children:"Sample Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeDefault[0]}, ${l.nodeDefault[1]}, ${l.nodeDefault[2]})`}}),p.jsx("span",{style:{color:l.text},children:"Internal Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeCombined[0]}, ${l.nodeCombined[1]}, ${l.nodeCombined[2]})`}}),p.jsx("span",{style:{color:l.text},children:"Combined Nodes"})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${l.nodeRoot[0]}, ${l.nodeRoot[1]}, ${l.nodeRoot[2]})`,borderColor:`rgb(${l.nodeSelected[0]}, ${l.nodeSelected[1]}, ${l.nodeSelected[2]})`}}),p.jsx("span",{style:{color:l.text},children:"Root Nodes"})]})]})]})]})]}):null},Xb={FIT:1.8,MEDIUM:1.2,FAR:.8},One=({currentViewState:t,bounds:e,onViewStateChange:n})=>{const{colors:r}=bt(),[i,s]=D.useState(!0),o=D.useRef(null),{elementRef:l,dragProps:u,hasMoved:d,isRepositioned:h}=Eh({initialPosition:{x:0,y:0},dragHandleRef:o}),g=()=>e?[(e.minX+e.maxX)/2,(e.minY+e.maxY)/2,(e.minZ+e.maxZ)/2]:[0,0,0],_=(T,A,R)=>{const E=g();n({target:E,rotationOrbit:T,rotationX:A,zoom:R})},x=()=>{const T=g();n({target:T})},w=[{value:Xb.FIT,label:"Fit All",icon:""},{value:Xb.MEDIUM,label:"Medium",icon:""},{value:Xb.FAR,label:"Far",icon:""}],S=T=>{const A=T%360;_(A,t.rotationX,t.zoom)},b=T=>{const A=Math.max(0,Math.min(90,T));_(t.rotationOrbit,A,t.zoom)};return p.jsxs("div",{ref:l,className:`border rounded-lg shadow-lg z-20 ${h?"":"absolute"}`,style:{backgroundColor:`${r.background}F0`,borderColor:r.border,color:r.text,...h?{}:{top:16,right:300},...u.style},onMouseDown:u.onMouseDown,children:[p.jsxs("div",{ref:o,onClick:()=>!d&&s(!i),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:i?"transparent":`${r.containerBackground}80`},onMouseEnter:T=>{i||(T.currentTarget.style.backgroundColor=`${r.border}40`)},onMouseLeave:T=>{i||(T.currentTarget.style.backgroundColor=`${r.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:r.text},children:[p.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Preset Views"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,style:{color:r.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[p.jsx("div",{className:"space-y-2",children:p.jsxs("button",{onClick:x,className:"w-full px-2 py-1.5 text-xs font-medium rounded transition-colors flex items-center justify-center gap-1",style:{backgroundColor:r.accentPrimary,color:r.background,border:`1px solid ${r.accentPrimary}`},onMouseEnter:T=>{T.currentTarget.style.opacity="0.8"},onMouseLeave:T=>{T.currentTarget.style.opacity="1"},children:[p.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v18m0 0l-4-4m4 4l4-4"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12h18m0 0l-4-4m4 4l-4 4"})]}),"Center ARG"]})}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Rotation"}),p.jsx("div",{className:"space-y-2",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationOrbit),""]}),p.jsx("input",{type:"range",min:0,max:360,step:1,value:t.rotationOrbit,onChange:T=>S(Number(T.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationOrbit/360*100}%, ${r.border} ${t.rotationOrbit/360*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),p.jsx("input",{type:"number",min:0,max:360,value:Math.round(t.rotationOrbit),onChange:T=>S(Number(T.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"View Angle"}),p.jsx("div",{className:"space-y-2",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationX),""]}),p.jsx("input",{type:"range",min:0,max:90,step:1,value:t.rotationX,onChange:T=>b(Number(T.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationX/90*100}%, ${r.border} ${t.rotationX/90*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),p.jsx("input",{type:"number",min:0,max:90,value:Math.round(t.rotationX),onChange:T=>b(Number(T.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Zoom Level"}),p.jsx("div",{className:"space-y-2",children:w.map(T=>p.jsxs("button",{onClick:()=>_(t.rotationOrbit,t.rotationX,T.value),className:"w-full px-3 py-2 text-xs font-medium rounded transition-colors flex items-center gap-2",style:{backgroundColor:Math.abs(t.zoom-T.value)<.1?r.accentPrimary:r.containerBackground,color:Math.abs(t.zoom-T.value)<.1?r.background:r.text,border:`1px solid ${r.border}`},title:`Set zoom to ${T.label}`,onMouseEnter:A=>{Math.abs(t.zoom-T.value)>=.1&&(A.currentTarget.style.backgroundColor=r.border)},onMouseLeave:A=>{Math.abs(t.zoom-T.value)>=.1&&(A.currentTarget.style.backgroundColor=r.containerBackground)},children:[p.jsx("span",{children:T.icon}),p.jsx("span",{children:T.label})]},T.value))})]}),p.jsxs("div",{className:"space-y-2 pt-2 border-t",style:{borderTopColor:r.border},children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Current View"}),p.jsxs("div",{className:"text-xs space-y-1",style:{color:r.textSecondary},children:[p.jsxs("div",{children:["Rotation: ",Math.round(t.rotationOrbit),""]}),p.jsxs("div",{children:["Pan: ",Math.round(Math.abs(t.rotationX))," ",t.rotationX<0?"above":t.rotationX>0?"below":"level"]}),p.jsxs("div",{children:["Zoom: ",t.zoom.toFixed(2),"x"]})]})]})]})]})},Pne=({min:t,max:e,step:n=.001,value:r,onChange:i,formatValue:s=u=>u.toFixed(3),className:o="",height:l=400})=>{const{colors:u}=bt(),[d,h]=D.useState(null),[g,_]=D.useState({y:0,startValue:[0,0]}),[x,w]=D.useState(!1),[S,b]=D.useState(null),T=D.useRef(null);D.useEffect(()=>{const I=B=>{if(B.key==="Shift"){if(w(!0),S===null){const V=Math.abs(r[1]-r[0]);b(Math.max(V,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},N=B=>{B.key==="Shift"&&(w(!1),b(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",I),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",I),document.removeEventListener("keyup",N),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,S,n]);const A=D.useCallback(I=>{if(!T.current)return e;const N=T.current.getBoundingClientRect(),B=Math.max(0,Math.min(1,(N.bottom-I)/N.height)),V=t+B*(e-t);return Math.round(V/n)*n},[t,e,n]),R=D.useCallback(I=>(e-I)/(e-t)*100,[t,e]),E=D.useCallback((I,N)=>{I.preventDefault(),I.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",h(N),_({y:I.clientY,startValue:r})},[r]),C=D.useCallback(I=>{if(!d||!T.current)return;const N=A(I.clientY),[B,V]=r;if(d==="top"){const Z=Math.max(t,Math.min(e,N));Z<B?i([Z,B]):i([B,Z])}else if(d==="bottom"){const Z=Math.max(t,Math.min(e,N));Z>V?i([V,Z]):i([Z,V])}else if(d==="range"){const Z=I.clientY-g.y,j=T.current.getBoundingClientRect(),Y=-(Z/j.height)*(e-t),[$,Q]=g.startValue;let oe=Math.abs(Q-$);x&&S!==null&&(oe=S);const L=($+Q)/2+Y;let W,fe;x&&S!==null?(W=L-oe/2,fe=L+oe/2):(W=$+Y,fe=Q+Y),W<t&&(W=t,fe=t+oe),fe>e&&(fe=e,W=e-oe),i([Math.round(W/n)*n,Math.round(fe/n)*n])}},[d,r,i,A,t,e,n,g,x,S]),O=D.useCallback(()=>{h(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);D.useEffect(()=>{if(d)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",O),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",O)}},[d,C,O]);const P=R(r[1]),k=R(r[0]);return p.jsxs("div",{className:`flex items-center gap-3 ${o}`,style:{height:l,userSelect:"none"},children:[p.jsxs("div",{className:"flex flex-col justify-between text-xs",style:{color:u.text,height:l},children:[p.jsx("span",{children:s(e)}),p.jsx("span",{children:s(r[1])}),p.jsx("span",{className:"flex-1"}),p.jsx("span",{children:s(r[0])}),p.jsx("span",{children:s(t)})]}),p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsxs("div",{ref:T,className:"relative w-4 rounded-full cursor-pointer",style:{height:l-40,backgroundColor:u.containerBackground},onMouseDown:I=>{const N=A(I.clientY),[B,V]=r,Z=Math.abs(N-B),j=Math.abs(N-V);x||Math.abs(V-B)<n*2?E(I,"range"):Z<j?E(I,"bottom"):E(I,"top")},children:[p.jsx("div",{className:`absolute w-full rounded-full transition-opacity ${x?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{top:`${P}%`,height:`${k-P}%`,backgroundColor:x?u.text:u.textSecondary,opacity:x?.8:1,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"range")}}),p.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${P}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"top")}}),p.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${k}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"bottom")}})]}),p.jsxs("div",{className:"mt-2 text-xs text-center",style:{color:u.text},children:[p.jsx("div",{children:"Temporal"}),p.jsx("div",{children:"Filter"}),p.jsx("div",{className:"mt-1 h-4 flex items-center justify-center",children:x?p.jsx("div",{className:"px-1 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:u.textSecondary,color:u.background,fontSize:"10px"},children:"Fixed"}):null})]})]})]})},Yn={DEFAULT_DIMENSIONS:{width:800,height:600},DEBOUNCE_DELAY:500,GENOMIC_STEP_DIVISOR:1e3,PERCENTAGE_PRECISION:1,TIME_PRECISION:3,TEMPORAL_STEP_DIVISOR:1e3,TEMPORAL_SLIDER_HEIGHT:350,UNIT_GRID_SIZE:10},Dne={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,isFilterSectionCollapsed:!0,temporalSpacingMode:"equal"},Td=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),TM=(t,e)=>(t/e*100).toFixed(Yn.PERCENTAGE_PRECISION),jne=t=>t.map(([e,n,r])=>({index:e,left:n,right:r})),wj=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;if(n==="descendants"?u===o&&!i.has(d):d===o&&!i.has(u)){const g=n==="descendants"?d:u;r.add(g),s.push(g)}}))}return r},Lne=(t,e)=>wj(t,e,"descendants"),Bne=(t,e)=>wj(t,e,"ancestors"),EM=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,Une=t=>{if(!(t!=null&&t.length))return{minTime:0,maxTime:1,range:[0,1]};const e=t.map(i=>i.time),n=Math.min(...e),r=Math.max(...e);return{minTime:n,maxTime:r,range:[n,n]}},Fne=(t,e,n)=>{const r={maxSamples:n};return t.mode==="genomic"&&(t.genomicRange[0]!==0||t.genomicRange[1]!==e.sequenceLength)?(r.genomicStart=t.genomicRange[0],r.genomicEnd=t.genomicRange[1]):t.mode==="tree"&&(t.treeRange[0]!==0||t.treeRange[1]!==e.treeIntervals.length-1)&&(r.treeStartIdx=t.treeRange[0],r.treeEndIdx=t.treeRange[1]),r},zne=(t,e,n)=>{if(!n)return t;const r=i=>{const s=t.nodes.filter(l=>i.has(l.id)),o=t.edges.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return i.has(u)&&i.has(d)});return{...t,nodes:s,edges:o,metadata:{...t.metadata,is_subset:!0}}};switch(e){case"subgraph":{const i=Lne(n,t.edges);return i.add(n.id),r(i)}case"ancestors":{const i=Bne(n,t.edges);return i.add(n.id),r(i)}default:return t}},$ne=(t,e)=>{if(!e.isActive||e.mode!=="hide")return t;const[n,r]=e.range;if(n===e.minTime&&r===e.maxTime)return t;const s=t.nodes.filter(u=>u.time>=n&&u.time<=r),o=new Set(s.map(u=>u.id)),l=t.edges.filter(u=>{const d=typeof u.source=="number"?u.source:u.source.id,h=typeof u.target=="number"?u.target:u.target.id;return o.has(d)&&o.has(h)});return{...t,nodes:s,edges:l,metadata:{...t.metadata,is_subset:!0}}},Vne=(t,e,n,r)=>!t||!e||!n||!r?null:{originalNodes:e.metadata.original_num_nodes||r.num_nodes,originalEdges:e.metadata.original_num_edges||r.num_edges,subArgNodes:t.nodes.length,subArgEdges:t.edges.length,displayedNodes:n.nodes.length,displayedEdges:n.edges.length},qne=(t,e,n,r)=>{let i="";switch(t){case"subgraph":i=`3D SubARG at Root ${e==null?void 0:e.id}`;break;case"ancestors":i=`3D Parent ARG of Node ${e==null?void 0:e.id}`;break;default:i="3D Full ARG"}return n.isActive&&(r==null?void 0:r.metadata.genomic_start)!==void 0&&(r==null?void 0:r.metadata.genomic_end)!==void 0&&(i+=` (${Td(r.metadata.genomic_start)} - ${Td(r.metadata.genomic_end)})`),i},Hne=({data:t,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,temporalSpacingMode:u,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:x,maxNodeRadius:w,onViewStateChange:S,viewState:b})=>{const T=D.useRef(null),[A,R]=D.useState(Yn.DEFAULT_DIMENSIONS);return D.useEffect(()=>{const E=()=>{if(T.current){const{clientWidth:O,clientHeight:P}=T.current;R({width:O||Yn.DEFAULT_DIMENSIONS.width,height:P||Yn.DEFAULT_DIMENSIONS.height})}};E(),window.addEventListener("resize",E);let C=null;return window.ResizeObserver&&T.current&&(C=new ResizeObserver(E),C.observe(T.current)),()=>{window.removeEventListener("resize",E),C&&C.disconnect()}},[]),p.jsx("div",{ref:T,className:"w-full h-full",children:p.jsx(bj,{data:t,width:A.width,height:A.height,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:x,maxNodeRadius:w,onViewStateChange:S,externalViewState:b,temporalSpacingMode:u})})},Wne=({filename:t,max_samples:e})=>{const{colors:n}=bt(),{treeSequence:r}=ia(),[i,s]=D.useState(null),[o,l]=D.useState(null),[u,d]=D.useState(!0),[h,g]=D.useState(null),[_,x]=D.useState("full"),[w,S]=D.useState(null),[b,T]=D.useState({isActive:!1,mode:"genomic",genomicRange:[0,0],treeRange:[0,0]}),[A,R]=D.useState({isActive:!1,mode:"planes",range:[0,1],minTime:0,maxTime:1}),[E,C]=D.useState({sequenceLength:0,treeIntervals:[]}),[O,P]=D.useState(Dne),[k,I]=D.useState({target:[0,0,0],zoom:1.8,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[N,B]=D.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1}),V=D.useCallback(async()=>{try{if(B(z=>({...z,isLoading:!0})),N.mode==="unit_grid"){const{createUnitGridShape:z}=await bk(async()=>{const{createUnitGridShape:J}=await Promise.resolve().then(()=>SM);return{createUnitGridShape:J}},void 0),X=z(Yn.UNIT_GRID_SIZE);B(J=>({...J,currentShape:X}))}else if(N.mode==="custom"&&N.customShapeFile){const z=await et.uploadShapefile(N.customShapeFile);console.log("Custom shapefile uploaded:",z.data)}else try{const z=await et.getShapeData(N.mode);B(X=>({...X,currentShape:z.data}))}catch{console.warn(`Failed to load ${N.mode}, using fallback`);const{createUnitGridShape:X}=await bk(async()=>{const{createUnitGridShape:pe}=await Promise.resolve().then(()=>SM);return{createUnitGridShape:pe}},void 0),J=X(Yn.UNIT_GRID_SIZE);B(pe=>({...pe,currentShape:J}))}}catch(z){console.error("Error loading geographic data:",z)}finally{B(z=>({...z,isLoading:!1}))}},[N.mode,N.customShapeFile]);D.useEffect(()=>{V()},[V]),D.useEffect(()=>{(async()=>{var X,J;try{d(!0);const xe=(await et.getGraphData(t,{maxSamples:e})).data;if(xe.metadata.sequence_length&&(C(Ae=>({...Ae,sequenceLength:xe.metadata.sequence_length})),T(Ae=>({...Ae,genomicRange:[0,xe.metadata.sequence_length]}))),(X=xe.metadata.tree_intervals)!=null&&X.length){const Ae=jne(xe.metadata.tree_intervals);C(Ne=>({...Ne,treeIntervals:Ae})),T(Ne=>({...Ne,treeRange:[0,Ae.length-1]}))}if((J=xe.nodes)!=null&&J.length){const Ae=Une(xe.nodes);R(Ne=>({...Ne,...Ae}))}if(!EM(xe))g("No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.");else if(s(xe),l(xe),W(xe),xe.metadata.suggested_geographic_mode){const Ae=xe.metadata.suggested_geographic_mode;B(Ne=>({...Ne,mode:Ae}))}}catch(pe){console.error("Error fetching 3D graph data:",pe),g(pe instanceof Error?pe.message:"Unknown error occurred")}finally{d(!1)}})()},[t,e]);const Z=D.useRef(null);D.useEffect(()=>{if(!(!b.isActive||u))return Z.current&&clearTimeout(Z.current),Z.current=setTimeout(async()=>{try{d(!0);const z=Fne(b,E,e),J=(await et.getGraphData(t,z)).data;EM(J)?(s(J),g(null),W(J)):g("No spatial data found in this range.")}catch(z){console.error("Error fetching filtered data:",z),g(z instanceof Error?z.message:"An error occurred while fetching graph data")}finally{d(!1)}},Yn.DEBOUNCE_DELAY),()=>{Z.current&&clearTimeout(Z.current)}},[b,t,e,E.sequenceLength,E.treeIntervals.length]),D.useEffect(()=>{P(z=>({...z,isFilterSectionCollapsed:!b.isActive&&!A.isActive}))},[b.isActive,A.isActive]);const j=()=>{if(!i)return i;const z=$ne(i,A);return zne(z,_,w)},Y=z=>{_==="full"?(S(z),x("subgraph")):(w==null?void 0:w.id)===z.id?(x("full"),S(null)):(S(z),x("subgraph"))},$=z=>{S(z),x("ancestors")},Q=()=>{x("full"),S(null)},oe=z=>{I(X=>({...X,...z}))},K=z=>{I(X=>({...X,...z}))},L=z=>{if(!z||!z.nodes.length)return null;const X=z.nodes.filter(Ge=>{var Se,Me;return((Se=Ge.location)==null?void 0:Se.x)!==void 0&&((Me=Ge.location)==null?void 0:Me.y)!==void 0});if(X.length===0)return null;const J=X.map(Ge=>Ge.location.x),pe=X.map(Ge=>Ge.location.y),xe=X.map(Ge=>Ge.time),Ae=Math.min(...J),Ne=Math.max(...J),be=Math.min(...pe),we=Math.max(...pe),ke=(Ae+Ne)/2,Xe=(be+we)/2,Le=Math.max(Ne-Ae,we-be)||1,Kt=(Ae-ke)/Le*O.spatialSpacing,Ie=(Ne-ke)/Le*O.spatialSpacing,nn=(be-Xe)/Le*O.spatialSpacing,ot=(we-Xe)/Le*O.spatialSpacing,pt=Array.from(new Set(xe)).sort((Ge,Se)=>Ge-Se),Mt=0,rn=(pt.length-1)*O.temporalSpacing;return{minX:Kt,maxX:Ie,minY:nn,maxY:ot,minZ:Mt,maxZ:rn}},W=z=>{const X=L(z);if(X){const J=[(X.minX+X.maxX)/2,(X.minY+X.maxY)/2,(X.minZ+X.maxZ)/2];I(pe=>({...pe,target:J}))}};if(u)return p.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:n.accentPrimary}}),p.jsx("p",{style:{color:n.text},children:"Loading 3D spatial ARG visualization..."})]})});if(h)return p.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:p.jsxs("div",{className:"text-center",style:{color:n.text},children:[p.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),p.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:h})]})});const fe=j(),se=Vne(o,i,fe,r);return p.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:n.background},children:[p.jsx("div",{className:"flex-shrink-0 border-b px-4 py-2",style:{backgroundColor:n.background,borderBottomColor:n.border},children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx("div",{className:"flex flex-col gap-2",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("h2",{className:"text-lg font-semibold",style:{color:n.headerText},children:qne(_,w,b,i)}),(E.sequenceLength>0||E.treeIntervals.length>0)&&p.jsxs("div",{className:"flex items-center gap-4",children:[E.sequenceLength>0&&p.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[p.jsx("input",{type:"checkbox",checked:b.isActive,onChange:()=>T(z=>({...z,isActive:!z.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Genomic Range"]}),p.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[p.jsx("input",{type:"checkbox",checked:A.isActive,onChange:()=>R(z=>({...z,isActive:!z.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Temporal Range"]})]}),_!=="full"&&p.jsx("button",{onClick:Q,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:z=>{z.currentTarget.style.borderColor=`${n.accentPrimary}66`,z.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:z=>{z.currentTarget.style.borderColor=`${n.accentPrimary}33`,z.currentTarget.style.backgroundColor=n.containerBackground},children:"Return to Full ARG"})]})}),p.jsxs("div",{className:"flex items-center gap-6",children:[(b.isActive||A.isActive)&&p.jsxs("button",{onClick:()=>P(z=>({...z,isFilterSectionCollapsed:!z.isFilterSectionCollapsed})),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:n.accentPrimary,color:n.background},onMouseEnter:z=>{z.currentTarget.style.opacity="0.8"},onMouseLeave:z=>{z.currentTarget.style.opacity="1"},children:[p.jsx("span",{children:O.isFilterSectionCollapsed?"Show Controls":"Hide Controls"}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${O.isFilterSectionCollapsed?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:n.headerText},children:[p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${n.nodeSample[0]}, ${n.nodeSample[1]}, ${n.nodeSample[2]})`,borderColor:n.background,borderWidth:"0.5px"}}),p.jsx("span",{children:"Sample"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeDefault[0]}, ${n.nodeDefault[1]}, ${n.nodeDefault[2]})`}}),p.jsx("span",{children:"Internal"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeCombined[0]}, ${n.nodeCombined[1]}, ${n.nodeCombined[2]})`}}),p.jsx("span",{children:"Combined"})]}),p.jsxs("div",{className:"flex items-center gap-1",children:[p.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${n.nodeRoot[0]}, ${n.nodeRoot[1]}, ${n.nodeRoot[2]})`,borderColor:`rgb(${n.nodeSelected[0]}, ${n.nodeSelected[1]}, ${n.nodeSelected[2]})`}}),p.jsx("span",{children:"Root"})]})]}),p.jsx("div",{className:"text-xs border-l pl-4",style:{color:n.headerText,borderLeftColor:n.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})}),(b.isActive||A.isActive)&&p.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:n.background,borderBottomColor:n.border},children:!O.isFilterSectionCollapsed&&p.jsxs("div",{className:"px-4 py-3",children:[p.jsxs("div",{className:"flex items-start justify-between gap-6",children:[p.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:[b.isActive&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Genomic Mode:"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[p.jsx("button",{onClick:()=>T(z=>({...z,mode:"genomic"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:b.mode==="genomic"?n.accentPrimary:n.containerBackground,color:b.mode==="genomic"?n.background:n.text},children:"Genomic"}),E.treeIntervals.length>0&&p.jsx("button",{onClick:()=>T(z=>({...z,mode:"tree"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:b.mode==="tree"?n.accentPrimary:n.containerBackground,color:b.mode==="tree"?n.background:n.text},children:"Tree Index"})]})]}),A.isActive&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Temporal Mode:"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[p.jsx("button",{onClick:()=>R(z=>({...z,mode:"hide"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="hide"?n.accentPrimary:n.containerBackground,color:A.mode==="hide"?n.background:n.text},children:"Hide Others"}),p.jsx("button",{onClick:()=>R(z=>({...z,mode:"planes"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="planes"?n.accentPrimary:n.containerBackground,color:A.mode==="planes"?n.background:n.text},children:"Dim Others"})]})]})]}),b.isActive&&p.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[p.jsx("div",{className:"flex-1 max-w-md min-w-0",children:b.mode==="genomic"&&E.sequenceLength>0?p.jsx(qO,{min:0,max:E.sequenceLength,step:Math.max(1,Math.floor(E.sequenceLength/Yn.GENOMIC_STEP_DIVISOR)),value:b.genomicRange,onChange:z=>T(X=>({...X,genomicRange:z})),formatValue:Td,className:"w-full"}):b.mode==="tree"&&E.treeIntervals.length>0?p.jsx(HO,{treeIntervals:E.treeIntervals,value:b.treeRange,onChange:z=>T(X=>({...X,treeRange:z})),className:"w-full"}):null}),p.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:n.text},children:[b.mode==="genomic"?p.jsxs("span",{children:[Td(b.genomicRange[1]-b.genomicRange[0])," bp (",TM(b.genomicRange[1]-b.genomicRange[0],E.sequenceLength),"%)",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&p.jsxs(p.Fragment,{children:["  ",i.metadata.num_local_trees," trees"]})]}):b.mode==="tree"&&E.treeIntervals.length>0?p.jsxs("span",{children:["Trees ",b.treeRange[0],"-",b.treeRange[1]," (",b.treeRange[1]-b.treeRange[0]+1," of ",E.treeIntervals.length,")",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&p.jsxs(p.Fragment,{children:["  ",i.metadata.expected_tree_count??i.metadata.num_local_trees," displayed"]}),(i==null?void 0:i.metadata.tree_count_mismatch)&&p.jsxs(p.Fragment,{children:["  (actual: ",i.metadata.num_local_trees,")"]})]}):null,u&&p.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})]})]}),A.isActive&&p.jsx("div",{className:"text-xs mt-3",style:{color:n.text},children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("span",{children:["Temporal Range: ",A.range[0].toFixed(Yn.TIME_PRECISION)," - ",A.range[1].toFixed(Yn.TIME_PRECISION)," ","(",TM(A.range[1]-A.range[0],A.maxTime-A.minTime),"% of time range)  Hold Shift + drag to maintain window size"]}),u&&p.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})})]})}),p.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[A.isActive&&!O.isFilterSectionCollapsed&&p.jsx("div",{className:"flex-shrink-0 border-r px-3 py-4 flex items-center justify-center",style:{backgroundColor:n.background,borderRightColor:n.border},children:p.jsx(Pne,{min:A.minTime,max:A.maxTime,step:(A.maxTime-A.minTime)/Yn.TEMPORAL_STEP_DIVISOR,value:A.range,onChange:z=>R(X=>({...X,range:z})),formatValue:z=>z.toFixed(Yn.TIME_PRECISION),height:Yn.TEMPORAL_SLIDER_HEIGHT})}),p.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[p.jsx(Hne,{data:fe,onNodeClick:Y,onNodeRightClick:$,selectedNode:w,temporalRange:A.isActive?A.range:null,showTemporalPlanes:A.isActive&&A.mode==="planes",temporalFilterMode:A.isActive?A.mode:null,temporalSpacing:O.temporalSpacing,temporalSpacingMode:O.temporalSpacingMode,spatialSpacing:O.spatialSpacing,geographicShape:N.currentShape,geographicMode:N.mode,temporalGridOpacity:O.temporalGridOpacity,geographicShapeOpacity:O.geographicShapeOpacity,maxNodeRadius:O.maxNodeRadius,onViewStateChange:oe,viewState:k}),p.jsx(One,{currentViewState:k,bounds:L(fe),onViewStateChange:K}),p.jsx(Mne,{temporalSpacing:O.temporalSpacing,onTemporalSpacingChange:z=>P(X=>({...X,temporalSpacing:z})),temporalSpacingMode:O.temporalSpacingMode,onTemporalSpacingModeChange:z=>P(X=>({...X,temporalSpacingMode:z})),spatialSpacing:O.spatialSpacing,onSpatialSpacingChange:z=>P(X=>({...X,spatialSpacing:z})),temporalGridOpacity:O.temporalGridOpacity,onTemporalGridOpacityChange:z=>P(X=>({...X,temporalGridOpacity:z})),geographicShapeOpacity:O.geographicShapeOpacity,onGeographicShapeOpacityChange:z=>P(X=>({...X,geographicShapeOpacity:z})),maxNodeRadius:O.maxNodeRadius,onMaxNodeRadiusChange:z=>P(X=>({...X,maxNodeRadius:z})),geographicMode:N.mode,onGeographicModeChange:z=>B(X=>({...X,mode:z})),customShapeFile:N.customShapeFile,onCustomShapeFileChange:z=>B(X=>({...X,customShapeFile:z})),isLoadingGeographic:N.isLoading,currentShape:N.currentShape,showCrsWarning:N.showCrsWarning,crsDetection:i==null?void 0:i.metadata.coordinate_system_detection,onDismissCrsWarning:()=>B(z=>({...z,showCrsWarning:!1}))}),p.jsx(Ine,{originalNodeCount:se==null?void 0:se.originalNodes,originalEdgeCount:se==null?void 0:se.originalEdges,subargNodeCount:se==null?void 0:se.subArgNodes,subargEdgeCount:se==null?void 0:se.subArgEdges,displayedNodeCount:se==null?void 0:se.displayedNodes,displayedEdgeCount:se==null?void 0:se.displayedEdges,crsDetection:i!=null&&i.metadata.coordinate_system_detection?{crs:i.metadata.coordinate_system_detection.likely_crs,confidence:i.metadata.coordinate_system_detection.confidence,landPercentage:i.metadata.coordinate_system_detection.land_percentage,description:i.metadata.coordinate_system_detection.reasoning}:void 0,isTemporalSliderVisible:A.isActive})]})]})]})};function Xne(){const{filename:t}=f1(),e=_r(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=ia(),{colors:s,setCurrentVisualizationType:o}=bt(),l=D.useRef(null),[u,d]=D.useState(!1);if(D.useEffect(()=>{o("spatial-3d")},[o]),!t)return p.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 font-sans",style:{backgroundColor:s.background,color:s.text},children:[p.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),p.jsx("button",{className:"font-bold py-2 px-6 rounded-lg mt-4 transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:x=>{x.currentTarget.style.backgroundColor=s.accentPrimary,x.currentTarget.style.color=s.background},onMouseLeave:x=>{x.currentTarget.style.backgroundColor=s.containerBackground,x.currentTarget.style.color=s.text},onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=x=>{Re.user.action("switch-tree-sequence-spatial",{treeSequence:x},"SpatialArg3DVisualizationPage"),i(x),d(!1),e(`/visualize-spatial/${encodeURIComponent(x.filename)}`)},_=async()=>{if(l.current)try{const x=`${h.replace(/\.(trees|tsz)$/,"")}_3d_spatial_arg.png`,w={text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"},S=l.current.querySelector("[data-3d-visualization]");if(S!=null&&S.getExportData){const T=S.getExportData(),A=l.current.querySelector('[data-deck="true"]'),R=A?{current:A}:null;try{await WO(T,R,{filename:x,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:2,watermark:w}),console.log("High-resolution 3D spatial ARG image exported successfully");return}catch(E){console.warn("High-quality export failed, falling back to canvas capture:",E)}}const b=l.current.querySelector("canvas");if(!b)throw new Error("No canvas found for export");await XO(b,{filename:x,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:s.exportBackground,scale:2,watermark:w}),console.log("3D spatial ARG image captured from canvas")}catch(x){console.error("Error downloading 3D spatial ARG image:",x)}};return p.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[p.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[p.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:x=>{x.currentTarget.style.opacity="0.8"},onMouseLeave:x=>{x.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),p.jsx(sa,{size:"medium"})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[p.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"3D Spatial ARG"}),p.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),p.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[p.jsx(z1,{}),p.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:x=>{x.currentTarget.style.borderColor=`${s.accentPrimary}66`,x.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:x=>{x.currentTarget.style.borderColor=`${s.accentPrimary}33`,x.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),p.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:x=>{x.currentTarget.style.backgroundColor=s.accentPrimary,x.currentTarget.style.color=s.background},onMouseLeave:x=>{x.currentTarget.style.backgroundColor=s.containerBackground,x.currentTarget.style.color=s.text},onClick:_,title:"Download 3D visualization as PNG",children:"Download Image"}),r&&p.jsx(bc,{filename:r.filename})]})]})]})}),p.jsx(wc,{isOpen:u,onClose:()=>d(!1),onSelect:g}),p.jsx("main",{className:"flex-1 overflow-hidden",children:p.jsx("div",{ref:l,className:"w-full h-full",children:D.useMemo(()=>p.jsx(Wne,{filename:h,max_samples:n}),[h,n])})})]})}const Wt={DEFAULT_ZOOM:2.5,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,BASE_ELEVATION:.1,UNIT_GRID_SIZE:10,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,GEOGRAPHIC_OPACITY_SCALE:2.5,GRID_EXTENSION:2},ac={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},pc={NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4,GEOGRAPHIC_NORMAL:1,TIME_SLICE_NORMAL:1},Yne=(t,e,n)=>t.is_sample?ac.SAMPLE:t.is_combined?ac.COMBINED:Jr(t,e,n)?ac.ROOT:ac.DEFAULT,Gne=(t,e,n,r,i)=>i,Kne=(t,e,n,r)=>{const i=t.filter(S=>{var b,T;return((b=S.location)==null?void 0:b.x)!==void 0&&((T=S.location)==null?void 0:T.y)!==void 0});if(i.length===0)return null;const s=[...i.map(S=>S.location.x),...e.map(S=>S.location.x)],o=[...i.map(S=>S.location.y),...e.map(S=>S.location.y)],l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let g,_,x;if((n==="eastern_hemisphere"||n==="custom")&&(r==null?void 0:r.bounds)){const S=r.bounds,[b,T,A,R]=S;g=(b+A)/2,_=(T+R)/2,x=Math.max(A-b,R-T)||1}else g=(l+u)/2,_=(d+h)/2,x=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:g,centerY:_,maxScale:x,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}};function Zne(t,e,n,r){if(e.length<=1)return 0;switch(r){case"equal":return e.indexOf(t)*n;case"log":const s=Math.max(1e-4,e[0]),o=e[e.length-1],l=Math.log(s),u=Math.log(o);return(Math.log(Math.max(1e-4,t))-l)/(u-l)*(e.length-1)*n;case"linear":const g=e[0],_=e[e.length-1];return(t-g)/(_-g)*(e.length-1)*n;default:return t*n}}const Qne=t=>t*Wt.JITTER_SCALE%Wt.JITTER_RANGE-Wt.JITTER_OFFSET,Jne=(t,e,n,r,i,s,o,l,u,d)=>{const{centerX:h,centerY:g,maxScale:_}=n,x=new Map(e.map(T=>[T.id,T])),w=Array.from(new Set([...t.map(T=>T.time),...e.map(T=>T.time)])).sort((T,A)=>T-A),S=[];return{nodes:t.map(T=>{const A=x.get(T.id);if(!A||!T.location||!A.location)throw new Error(`Missing location data for node ${T.id}`);const R=(T.location.x-h)/_*s,E=(T.location.y-g)/_*s,C=(A.location.x-h)/_*s,O=(A.location.y-g)/_*s,P=T.is_sample,k=P?R:(R+C)/2,I=P?E:(E+O)/2,N=Qne(T.id),B=Zne(T.time,w,r,i)+Wt.BASE_ELEVATION+N,V=C-R,Z=O-E,j=P?0:Math.sqrt(V*V+Z*Z),Y=Yne(T,l,u);let $;return P?$=o.nodeSample:T.is_combined?$=o.nodeCombined:Jr(T,l,u)?$=o.nodeRoot:$=o.nodeDefault,P||(S.push({source:[R,E,B],target:[k,I,B],color:[255,0,0,180],width:d}),S.push({source:[k,I,B],target:[C,O,B],color:[255,0,0,180],width:d})),{...T,position:[k,I,B],firstPosition:[R,E,B],secondPosition:[C,O,B],color:$,size:Y,distance:j}}),diffEdges:S}},ere=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=Gne(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),tre=(t,e,n,r,i,s)=>{const o=Jr(t,[],[]);let l=1;if(o)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*l];if(t.is_sample){const u=s.background==="#ffffff"?0:255;return[u,u,u,255*l]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},nre=(t,e,n)=>{const r=Jr(t,[],[]),s=t.size/ac.DEFAULT;return r?Math.max(.8,pc.NODE_OUTLINE_ROOT*s):t.is_sample?Math.max(.5,pc.NODE_OUTLINE_SAMPLE*s):0},rre=(t,e,n,r,i)=>{var h;let s="";t.is_sample?s="Sample Node":t.is_combined?s=`Combined Node (contains: ${(h=t.combined_nodes)==null?void 0:h.join(", ")})`:Jr(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?s="Root Node":s="Internal Node";const o=t.firstPosition[0],l=t.firstPosition[1],u=t.secondPosition[0],d=t.secondPosition[1];return{html:`
      <div style="background: ${i.tooltipBackground}; color: ${i.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${s}<br/>
        ${t.is_sample?"Sample Node (Fixed Position)":`
        First Position: (${o.toFixed(3)}, ${l.toFixed(3)})<br/>
        Second Position: (${u.toFixed(3)}, ${d.toFixed(3)})<br/>
        Movement Distance: ${t.distance.toFixed(3)}`}
      </div>
    `,style:{backgroundColor:"transparent",color:i.tooltipText}}},ire=(t,e,n)=>t||(e==="unit_grid"?ta(Wt.UNIT_GRID_SIZE):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):ta(Wt.UNIT_GRID_SIZE)),Ds={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,diffEdgeWidth:3,temporalSpacingMode:"equal"},sre=({firstData:t,secondData:e,temporalSpacing:n=Ds.temporalSpacing,temporalSpacingMode:r=Ds.temporalSpacingMode,spatialSpacing:i=Ds.spatialSpacing,temporalGridOpacity:s=Ds.temporalGridOpacity,geographicShapeOpacity:o=Ds.geographicShapeOpacity,maxNodeRadius:l=Ds.maxNodeRadius,diffEdgeWidth:u=Ds.diffEdgeWidth,geographicMode:d="unit_grid",geographicShape:h=null})=>{const{colors:g}=bt(),{nodes3D:_,diffEdges:x}=D.useMemo(()=>{const R=Kne(t.nodes,e.nodes,d,h);if(!R)return{nodes3D:[],diffEdges:[]};const E=Jne(t.nodes,e.nodes,R,n,r,i,g,t.nodes,t.edges,u);return{nodes3D:E.nodes,diffEdges:E.diffEdges}},[t,e,n,r,i,g,d,h,u]),w=D.useMemo(()=>{const R=new Map(_.map(C=>[C.id,C]));return ere(t.edges,R,null,null,g).map(C=>({...C,width:Wt.EDGE_WIDTH}))},[t.edges,_,g]),S=D.useMemo(()=>ire(h,d),[h,d,i]),b=D.useMemo(()=>{if(!S&&!_.length)return[];const R=o??70,E=R>0?R*Wt.GEOGRAPHIC_OPACITY_SCALE:0,C=pc.GEOGRAPHIC_NORMAL,O=[g.geographicGrid[0],g.geographicGrid[1],g.geographicGrid[2],E],P=[];if(S){const Y=b2(S,i);P.push(...Sd(Y,0,O,C))}const k={minX:Math.min(..._.map(Y=>Y.position[0])),maxX:Math.max(..._.map(Y=>Y.position[0])),minY:Math.min(..._.map(Y=>Y.position[1])),maxY:Math.max(..._.map(Y=>Y.position[1])),minZ:Math.min(..._.map(Y=>Y.position[2])),maxZ:Math.max(..._.map(Y=>Y.position[2]))},I=Array.from(new Set(_.map(Y=>Y.time))).sort((Y,$)=>Y-$),N=new Map(I.map((Y,$)=>[Y,$])),V=s??30,Z=pc.TIME_SLICE_NORMAL,j=[g.temporalGrid[0],g.temporalGrid[1],g.temporalGrid[2],V];return V>0&&I.forEach(Y=>{const Q=(N.get(Y)||0)*n;Q!==0&&(P.push({source:[k.minX-Wt.GRID_EXTENSION,0,Q],target:[k.maxX+Wt.GRID_EXTENSION,0,Q],color:j,width:Z}),P.push({source:[0,k.minY-Wt.GRID_EXTENSION,Q],target:[0,k.maxY+Wt.GRID_EXTENSION,Q],color:j,width:Z}))}),P},[S,i,o,s,g.geographicGrid,g.temporalGrid,_,n]),T=D.useMemo(()=>{const R=[];return b.length>0&&R.push(new Ys({id:"geographic-shape",data:b,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>E.width,pickable:!1})),R.push(new Ys({id:"edges",data:w,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>Wt.EDGE_WIDTH,pickable:!1})),R.push(new Ys({id:"diff-edges",data:x,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>E.width,pickable:!1})),R.push(new Th({id:"nodes",data:_,pickable:!0,opacity:Wt.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:Wt.NODE_RADIUS_SCALE,radiusMinPixels:Wt.MIN_NODE_RADIUS,radiusMaxPixels:l,lineWidthMinPixels:Wt.MIN_NODE_RADIUS,lineWidthMaxPixels:pc.MAX_NODE_OUTLINE,getPosition:E=>E.position,getRadius:E=>E.size,getFillColor:E=>E.color,getLineColor:E=>tre(E,null,null,null,null,g),getLineWidth:E=>nre(E),onClick:(E,C)=>{C.srcEvent.preventDefault()},onHover:E=>{}})),R},[b,w,x,_,l,g]),A=D.useMemo(()=>({target:[0,0,0],rotationX:0,rotationOrbit:0,zoom:Wt.DEFAULT_ZOOM,minZoom:Wt.MIN_ZOOM,maxZoom:Wt.MAX_ZOOM}),[]);return!t||!e||_.length===0?null:p.jsx(_j,{layers:T,views:new y2,initialViewState:A,controller:!0,parameters:{blend:!0},getTooltip:({object:R})=>R?rre(R,t,null,i,g):null})},are=()=>{const[t,e]=D.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1,isManuallySet:!1});return D.useEffect(()=>{(async()=>{try{e(u=>({...u,isLoading:!0}));const l=await et.getShapeData("unit_grid");e(u=>({...u,currentShape:l.data,isLoading:!1}))}catch(l){console.error("Error loading initial geographic data:",l),e(u=>({...u,isLoading:!1}))}})()},[]),D.useEffect(()=>{(async()=>{if(!(t.mode==="custom"&&!t.customShapeFile))try{if(e(l=>({...l,isLoading:!0})),t.mode==="custom"&&t.customShapeFile){const l=await et.uploadShapefile(t.customShapeFile);console.log("Custom shapefile uploaded:",l.data)}else if(t.mode==="unit_grid"){const l=ta(10);e(u=>({...u,currentShape:l,isLoading:!1}))}else try{const l=await et.getShapeData(t.mode);e(u=>({...u,currentShape:l.data,isLoading:!1}))}catch{console.warn(`Failed to load ${t.mode} from API, creating fallback`);const u=ta(10);e(d=>({...d,currentShape:u,isLoading:!1}))}}catch(l){console.error("Error loading shape for mode:",t.mode,l),e(u=>({...u,isLoading:!1}))}})()},[t.mode,t.customShapeFile]),{...t,setMode:o=>{e(l=>({...l,mode:o,isManuallySet:!0,currentShape:null}))},setCustomShapeFile:o=>{e(l=>({...l,customShapeFile:o}))},dismissCrsWarning:()=>{e(o=>({...o,showCrsWarning:!1}))},updateFromCrsDetection:(o,l,u)=>{if(!o||!l||!u||t.isManuallySet)return;const d=o.confidence>.7,h=l.confidence>.7,g=o.likely_crs===l.likely_crs;d&&h&&g&&u!==t.mode?(e(_=>({..._,showCrsWarning:!0,mode:u})),console.log(`Setting geographic mode to: ${u} based on matching CRS detections`)):e(_=>({..._,showCrsWarning:!1}))}}},ore=({temporalSpacing:t,onTemporalSpacingChange:e,temporalSpacingMode:n,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:g,diffEdgeWidth:_,onDiffEdgeWidthChange:x,geographicMode:w,onGeographicModeChange:S,customShapeFile:b,onCustomShapeFileChange:T,isLoadingGeographic:A,currentShape:R,showCrsWarning:E,firstCrsDetection:C,secondCrsDetection:O,onDismissCrsWarning:P})=>{const{colors:k}=bt(),[I,N]=D.useState(!0),B=D.useRef(null),{elementRef:V,dragProps:Z,hasMoved:j,isRepositioned:Y}=Eh({initialPosition:{x:0,y:0},dragHandleRef:B}),$=oe=>{S(oe)},Q=oe=>{var L;const K=(L=oe.target.files)==null?void 0:L[0];K&&T(K)};return p.jsxs("div",{ref:V,className:`border rounded-lg shadow-lg z-30 ${Y?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${k.background}F0`,borderColor:k.border,color:k.text,...Z.style},onMouseDown:Z.onMouseDown,children:[p.jsxs("div",{ref:B,onClick:()=>!j&&N(!I),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:I?"transparent":`${k.containerBackground}80`},onMouseEnter:oe=>{I||(oe.currentTarget.style.backgroundColor=`${k.border}40`)},onMouseLeave:oe=>{I||(oe.currentTarget.style.backgroundColor=`${k.containerBackground}80`)},children:[p.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:k.text},children:[p.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"Diff Visualization Controls"]}),p.jsx("svg",{className:`w-4 h-4 transition-transform ${I?"rotate-180":""}`,style:{color:k.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&p.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Geographic Settings"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Geographic Mode"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:k.containerBackground},children:[p.jsx("button",{onClick:()=>$("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:w==="unit_grid"?k.accentPrimary:k.containerBackground,color:w==="unit_grid"?k.background:k.text},children:"Unit Grid"}),p.jsx("button",{onClick:()=>$("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:w==="eastern_hemisphere"?k.accentPrimary:k.containerBackground,color:w==="eastern_hemisphere"?k.background:k.text},children:"Eastern Hemisphere"}),p.jsx("button",{onClick:()=>$("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:w==="custom"?k.accentPrimary:k.containerBackground,color:w==="custom"?k.background:k.text},children:"Custom"})]})]}),w==="custom"&&p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Custom Shape File"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("input",{type:"file",accept:".geojson,.json",onChange:Q,className:"hidden",id:"shapefileUpload"}),p.jsx("label",{htmlFor:"shapefileUpload",className:"px-3 py-1.5 text-xs font-medium rounded cursor-pointer transition-colors",style:{backgroundColor:k.accentPrimary,color:k.background},children:"Upload GeoJSON"}),b&&p.jsx("span",{className:"text-xs",style:{color:k.text},children:b.name})]})]}),A&&p.jsx("div",{className:"text-xs",style:{color:k.text},children:"Loading geographic shape..."}),R&&p.jsxs("div",{className:"text-xs space-y-1",style:{color:k.text},children:[p.jsxs("div",{children:["Shape: ",R.name]}),R.bounds&&p.jsx("div",{children:"Shape loaded successfully"})]}),E&&p.jsx("div",{className:"mt-4 p-3 rounded",style:{backgroundColor:`${k.accentPrimary}20`},children:p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",style:{color:k.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),p.jsx("h5",{className:"text-sm font-medium",style:{color:k.accentPrimary},children:"Coordinate System Detection"})]}),P&&p.jsx("button",{onClick:P,className:"text-xs opacity-50 hover:opacity-100 transition-opacity",style:{color:k.accentPrimary},children:"Dismiss"})]}),C&&p.jsxs("div",{className:"text-xs space-y-1",children:[p.jsx("div",{style:{color:k.text},children:"First Tree Sequence:"}),p.jsxs("div",{style:{color:`${k.text}B3`},children:["Likely CRS: ",C.likely_crs,p.jsx("br",{}),"Confidence: ",(C.confidence*100).toFixed(1),"%",p.jsx("br",{}),"Land Coverage: ",(C.land_percentage*100).toFixed(1),"%"]})]}),O&&p.jsxs("div",{className:"text-xs space-y-1",children:[p.jsx("div",{style:{color:k.text},children:"Second Tree Sequence:"}),p.jsxs("div",{style:{color:`${k.text}B3`},children:["Likely CRS: ",O.likely_crs,p.jsx("br",{}),"Confidence: ",(O.confidence*100).toFixed(1),"%",p.jsx("br",{}),"Land Coverage: ",(O.land_percentage*100).toFixed(1),"%"]})]})]})}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Geographic Shape Opacity: ",u,"%"]}),p.jsx("input",{type:"range",min:"0",max:"100",value:u,onChange:oe=>d(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${u}%, ${k.border} ${u}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Temporal Settings"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Temporal Spacing Mode"}),p.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:k.containerBackground},children:[p.jsx("button",{onClick:()=>r("equal"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="equal"?k.accentPrimary:k.containerBackground,color:n==="equal"?k.background:k.text},children:"Equal"}),p.jsx("button",{onClick:()=>r("log"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="log"?k.accentPrimary:k.containerBackground,color:n==="log"?k.background:k.text},children:"Log"}),p.jsx("button",{onClick:()=>r("linear"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="linear"?k.accentPrimary:k.containerBackground,color:n==="linear"?k.background:k.text},children:"Linear"})]}),p.jsxs("div",{className:"text-xs",style:{color:`${k.text}CC`},children:[n==="equal"&&p.jsx("div",{children:" Time points are spaced equally"}),n==="log"&&p.jsx("div",{children:" Time points are spaced logarithmically based on their actual values"}),n==="linear"&&p.jsx("div",{children:" Time points are spaced according to their actual time values"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Temporal Spacing: ",t]}),p.jsx("input",{type:"range",min:"1",max:"50",value:t,onChange:oe=>e(Number(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${t/50*100}%, ${k.border} ${t/50*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Temporal Grid Opacity: ",o,"%"]}),p.jsx("input",{type:"range",min:"0",max:"100",value:o,onChange:oe=>l(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${o}%, ${k.border} ${o}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Visual Settings"}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Spatial Spacing: ",i]}),p.jsx("input",{type:"range",min:"50",max:"500",value:i,onChange:oe=>s(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(i-50)/450*100}%, ${k.border} ${(i-50)/450*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Maximum Node Size: ",h]}),p.jsx("input",{type:"range",min:"5",max:"50",value:h,onChange:oe=>g(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(h-5)/45*100}%, ${k.border} ${(h-5)/45*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Diff Edge Width: ",_]}),p.jsx("input",{type:"range",min:"1",max:"10",value:_,onChange:oe=>x(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(_-1)/9*100}%, ${k.border} ${(_-1)/9*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]})]})]})},AM=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,js={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,diffEdgeWidth:3,temporalSpacingMode:"equal"},lre=({firstFilename:t,secondFilename:e})=>{const{colors:n}=bt(),r=_r(),[i,s]=D.useState(js.temporalSpacing),[o,l]=D.useState(js.spatialSpacing),[u,d]=D.useState(js.temporalGridOpacity),[h,g]=D.useState(js.geographicShapeOpacity),[_,x]=D.useState(js.maxNodeRadius),[w,S]=D.useState(js.diffEdgeWidth),[b,T]=D.useState(js.temporalSpacingMode),[A,R]=D.useState(null),[E,C]=D.useState({target:[0,0,0],zoom:2.5,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[O,P]=D.useState(!0),[k,I]=D.useState(null),[N,B]=D.useState(null),[V,Z]=D.useState(null),{mode:j,setMode:Y,currentShape:$,isLoading:Q,customShapeFile:oe,setCustomShapeFile:K,showCrsWarning:L,dismissCrsWarning:W,updateFromCrsDetection:fe}=are();return D.useEffect(()=>{(async()=>{var z,X;if(!t||!e){I("Both tree sequences must be provided"),P(!1);return}try{P(!0),I(null);const[J,pe]=await Promise.all([et.getGraphData(t),et.getGraphData(e)]),xe=J.data,Ae=pe.data;if(!AM(xe)||!AM(Ae)){I("Both tree sequences must have spatial data"),P(!1);return}B(xe),Z(Ae);const Ne=(z=xe.metadata)==null?void 0:z.coordinate_system_detection,be=(X=Ae.metadata)==null?void 0:X.coordinate_system_detection;let we="unit_grid";Ne&&be&&Ne.likely_crs==="EPSG:4326"&&be.likely_crs==="EPSG:4326"&&(we="eastern_hemisphere"),fe(Ne,be,we),P(!1)}catch{I("Failed to load tree sequences"),P(!1)}})()},[t,e]),O?p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:n.accentPrimary}})}):k?p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-lg mb-4",style:{color:`${n.text}`,opacity:.8,textShadow:"0 0 10px rgba(255, 0, 0, 0.5)"},children:k}),p.jsx("button",{onClick:()=>r("/"),className:"px-4 py-2 rounded",style:{backgroundColor:n.accentPrimary,color:n.background},children:"Return Home"})]})}):!N||!V?p.jsx("div",{className:"flex items-center justify-center h-full",children:p.jsxs("div",{className:"text-center",children:[p.jsx("p",{className:"text-lg mb-4",style:{color:`${n.text}`,opacity:.8,textShadow:"0 0 10px rgba(255, 0, 0, 0.5)"},children:"No data available"}),p.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:"Both tree sequences must contain spatial information for all nodes."})]})}):p.jsxs("div",{className:"relative w-full h-full",children:[p.jsx(sre,{firstData:N,secondData:V,temporalSpacing:i,temporalSpacingMode:b,spatialSpacing:o,temporalGridOpacity:u,geographicShapeOpacity:h,maxNodeRadius:_,diffEdgeWidth:w,geographicMode:j,geographicShape:$}),p.jsx(ore,{temporalSpacing:i,onTemporalSpacingChange:s,temporalSpacingMode:b,onTemporalSpacingModeChange:T,spatialSpacing:o,onSpatialSpacingChange:l,temporalGridOpacity:u,onTemporalGridOpacityChange:d,geographicShapeOpacity:h,onGeographicShapeOpacityChange:g,maxNodeRadius:_,onMaxNodeRadiusChange:x,diffEdgeWidth:w,onDiffEdgeWidthChange:S,geographicMode:j,onGeographicModeChange:Y,customShapeFile:oe,onCustomShapeFileChange:K,isLoadingGeographic:Q,currentShape:$,showCrsWarning:L,onDismissCrsWarning:W})]})};function cre(){const{filename:t}=f1(),e=_r(),{colors:n,setCurrentVisualizationType:r}=bt(),i=D.useRef(null),[s,o]=D.useState(!1),[l,u]=D.useState(null),d=decodeURIComponent(t||""),[h]=c5(),g=h.get("second")||"";D.useEffect(()=>{r("spatial-diff")},[r]);const _=w=>{l==="first"?e(`/visualize-spatial-diff/${w.filename}?second=${d}`):l==="second"&&e(`/visualize-spatial-diff/${d}?second=${w.filename}`),o(!1),u(null)},x=async()=>{if(i.current)try{const w=`${d.replace(/\.(trees|tsz)$/,"")}_spatial_diff.png`,S={text:"ARGscape",subtext:d,position:"bottom-center",color:n.accentPrimary,backgroundColor:n.background+"CC"},b=i.current.querySelector("[data-3d-visualization]");if(b!=null&&b.getExportData){const A=b.getExportData(),R=i.current.querySelector('[data-deck="true"]'),E=R?{current:R}:null;try{await WO(A,E,{filename:w,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:n.exportBackground,scale:2,watermark:S}),console.log("High-resolution spatial diff image exported successfully");return}catch(C){console.warn("High-quality export failed, falling back to canvas capture:",C)}}const T=i.current.querySelector("canvas");if(!T)throw new Error("No canvas found for export");await XO(T,{filename:w,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:n.exportBackground,scale:2,watermark:S}),console.log("Spatial diff image captured from canvas")}catch(w){console.error("Error downloading spatial diff image:",w)}};return p.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:n.background,color:n.text},children:[p.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:n.background,borderBottomColor:n.border},children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[p.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:n.accentPrimary},onMouseEnter:w=>{w.currentTarget.style.opacity="0.8"},onMouseLeave:w=>{w.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),p.jsx(sa,{size:"medium"})]}),p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[p.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${n.text}B3`},children:"Spatial ARG Diff"}),p.jsxs("div",{className:"flex flex-col gap-2",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:n.accentPrimary},children:d}),p.jsx("button",{onClick:()=>{u("first"),o(!0)},className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:w=>{w.currentTarget.style.borderColor=`${n.accentPrimary}66`,w.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:w=>{w.currentTarget.style.borderColor=`${n.accentPrimary}33`,w.currentTarget.style.backgroundColor=n.containerBackground},children:"Change"}),p.jsx(bc,{filename:d})]}),g&&p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:n.accentPrimary},children:g}),p.jsx("button",{onClick:()=>{u("second"),o(!0)},className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:w=>{w.currentTarget.style.borderColor=`${n.accentPrimary}66`,w.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:w=>{w.currentTarget.style.borderColor=`${n.accentPrimary}33`,w.currentTarget.style.backgroundColor=n.containerBackground},children:"Change"}),p.jsx(bc,{filename:g})]})]})]}),p.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[p.jsx(z1,{}),p.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:n.containerBackground,color:n.text},onMouseEnter:w=>{w.currentTarget.style.backgroundColor=n.accentPrimary,w.currentTarget.style.color=n.background},onMouseLeave:w=>{w.currentTarget.style.backgroundColor=n.containerBackground,w.currentTarget.style.color=n.text},onClick:x,title:"Download spatial diff visualization as PNG",children:"Download Image"})]})]})]})}),p.jsx("main",{className:"flex-1 overflow-hidden",children:p.jsx("div",{ref:i,className:"w-full h-full",children:p.jsx(lre,{firstFilename:d,secondFilename:g})})}),p.jsx(wc,{isOpen:s,onClose:()=>{o(!1),u(null)},onSelect:_})]})}function ure(){return p.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 overflow-hidden pointer-events-none",children:p.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 1200 400",children:[p.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.3s_both]",children:[p.jsx("line",{x1:"200",y1:"30",x2:"200",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.4s_both]"}),p.jsx("line",{x1:"200",y1:"90",x2:"140",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.5s_both]"}),p.jsx("line",{x1:"200",y1:"90",x2:"260",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.55s_both]"}),p.jsx("line",{x1:"140",y1:"150",x2:"100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.6s_both]"}),p.jsx("line",{x1:"140",y1:"150",x2:"180",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.65s_both]"}),p.jsx("line",{x1:"260",y1:"150",x2:"220",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.7s_both]"}),p.jsx("line",{x1:"260",y1:"150",x2:"300",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.75s_both]"}),p.jsx("circle",{cx:"200",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_0.8s_both]"}),p.jsx("circle",{cx:"140",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.85s_both]"}),p.jsx("circle",{cx:"260",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.9s_both]"})]}),p.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.7s_both]",children:[p.jsx("line",{x1:"600",y1:"30",x2:"600",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.8s_both]"}),p.jsx("line",{x1:"600",y1:"90",x2:"540",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.9s_both]"}),p.jsx("line",{x1:"600",y1:"90",x2:"660",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.95s_both]"}),p.jsx("line",{x1:"540",y1:"150",x2:"500",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1s_both]"}),p.jsx("line",{x1:"540",y1:"150",x2:"580",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.05s_both]"}),p.jsx("line",{x1:"660",y1:"150",x2:"620",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.1s_both]"}),p.jsx("line",{x1:"660",y1:"150",x2:"700",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.15s_both]"}),p.jsx("circle",{cx:"600",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.2s_both]"}),p.jsx("circle",{cx:"540",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.25s_both]"}),p.jsx("circle",{cx:"660",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.3s_both]"})]}),p.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_1.1s_both]",children:[p.jsx("line",{x1:"1000",y1:"30",x2:"1000",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_1.2s_both]"}),p.jsx("line",{x1:"1000",y1:"90",x2:"940",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.3s_both]"}),p.jsx("line",{x1:"1000",y1:"90",x2:"1060",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.35s_both]"}),p.jsx("line",{x1:"940",y1:"150",x2:"900",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.4s_both]"}),p.jsx("line",{x1:"940",y1:"150",x2:"980",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.45s_both]"}),p.jsx("line",{x1:"1060",y1:"150",x2:"1020",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.5s_both]"}),p.jsx("line",{x1:"1060",y1:"150",x2:"1100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.55s_both]"}),p.jsx("circle",{cx:"1000",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.6s_both]"}),p.jsx("circle",{cx:"940",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.65s_both]"}),p.jsx("circle",{cx:"1060",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.7s_both]"})]}),p.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_1.5s_both]",children:[p.jsx("circle",{cx:"100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.7s_both]"}),p.jsx("circle",{cx:"180",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.75s_both]"}),p.jsx("circle",{cx:"220",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.8s_both]"}),p.jsx("circle",{cx:"300",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.85s_both]"}),p.jsx("circle",{cx:"500",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.9s_both]"}),p.jsx("circle",{cx:"580",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.95s_both]"}),p.jsx("circle",{cx:"620",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2s_both]"}),p.jsx("circle",{cx:"700",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.05s_both]"}),p.jsx("circle",{cx:"900",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.1s_both]"}),p.jsx("circle",{cx:"980",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.15s_both]"}),p.jsx("circle",{cx:"1020",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.2s_both]"}),p.jsx("circle",{cx:"1100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.25s_both]"})]}),p.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_2.3s_both]",children:[p.jsx("line",{x1:"400",y1:"20",x2:"400",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"}),p.jsx("line",{x1:"800",y1:"20",x2:"800",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"})]})]})})}function RM({onComplete:t,isTransitioning:e=!1}){const[n,r]=D.useState(!1),[i,s]=D.useState(!1);return D.useEffect(()=>{if(e){r(!0),s(!0);return}r(!0);const o=setTimeout(()=>{s(!0)},2300),l=setTimeout(()=>{t()},2600);return()=>{clearTimeout(o),clearTimeout(l)}},[t,e]),p.jsxs(p.Fragment,{children:[p.jsx("style",{children:`
        @keyframes drawLine {
          from { stroke-dasharray: 1000; stroke-dashoffset: 1000; }
          to { stroke-dasharray: 1000; stroke-dashoffset: 0; }
        }
        @keyframes drawPath {
          from { stroke-dasharray: 200; stroke-dashoffset: 200; }
          to { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInScale {
          from { opacity: 0; transform: scale(0); }
          to { opacity: 1; transform: scale(1); }
        }
      `}),p.jsxs("div",{className:`
        ${e?"absolute":"fixed"} inset-0 bg-sp-very-dark-blue flex items-center justify-center z-50
        transition-all duration-2000 ease-in-out
        ${i?"opacity-0":"opacity-100"}
      `,children:[p.jsx("div",{className:`
          transition-opacity duration-1000 ease-in-out
          ${e?"opacity-0":"opacity-100"}
        `,children:p.jsx(ure,{})}),p.jsxs("div",{className:`
          transform transition-all duration-2000 ease-in-out relative z-10
          ${e?"scale-50 -translate-y-32":n?"scale-100 opacity-100":"scale-75 opacity-0"}
        `,children:[p.jsxs("h1",{className:"text-[6rem] md:text-[8rem] lg:text-[10rem] font-extrabold tracking-tight text-center select-none",style:{letterSpacing:"-0.04em"},children:[p.jsx("span",{className:"text-white",children:"ARG"}),p.jsx("span",{className:"text-sp-pale-green",children:"scape"})]}),p.jsx("div",{className:`
            mt-8 text-center transition-opacity duration-1000 ease-in-out
            ${e?"opacity-0":"opacity-100"}
          `,children:p.jsx("div",{className:"text-sp-pale-green text-2xl md:text-3xl lg:text-4xl font-bold",children:"Explore ancestry through space, time, and the genome."})})]})]})]})}function CM({onOptionSelect:t,isTransitioning:e=!1}){const n=_r(),[r,i]=D.useState([]),[s,o]=D.useState(!0),[l,u]=D.useState(!e);D.useEffect(()=>{(async()=>{try{Re.data.processing("fetch-available-tree-sequences","LandingPage");const _=(await et.getUploadedFiles()).data;i(_.uploaded_tree_sequences||[])}catch(g){Re.error("Failed to fetch available tree sequences",{component:"LandingPage",error:g instanceof Error?g:new Error(String(g))}),i([])}finally{o(!1)}})()},[]),D.useEffect(()=>{if(e){const h=setTimeout(()=>{u(!0)},100);return()=>clearTimeout(h)}else u(!0)},[e]);const d=h=>{h==="load"&&r.length===0||t(h)};return p.jsxs("div",{className:`
      text-sp-white min-h-screen flex flex-col bg-sp-very-dark-blue
      ${e?"absolute inset-0 z-40":""}
    `,children:[p.jsx(aa,{}),p.jsx("div",{className:"flex-grow flex items-center justify-center px-4 pt-16",children:p.jsxs("div",{className:"text-center",children:[p.jsxs("div",{className:`
            mb-8 transition-all duration-2000 ease-in-out
            ${e&&!l?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
          `,children:[p.jsx(sa,{size:"large",className:"mb-4"}),p.jsx("p",{className:"text-lg md:text-xl text-sp-white/70 mb-6",children:"Explore ancestry through space, time, and the genome."}),p.jsxs("button",{onClick:()=>n("/tutorials"),className:"inline-flex items-center gap-2 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg group mb-12",children:[p.jsx("span",{children:"New to ARGs? Start here!"}),p.jsx("svg",{className:"w-5 h-5 transition-transform duration-200 group-hover:translate-x-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})]}),p.jsxs("div",{className:`
            w-full max-w-2xl mx-auto space-y-4 transition-all duration-2000 ease-in-out delay-500
            ${e&&!l?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
          `,children:[p.jsx("button",{onClick:()=>d("upload"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:p.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Upload a tree sequence"}),p.jsx("p",{className:"text-sp-white/60 text-sm",children:"Upload your own .trees or .tsz file to visualize"})]})]})}),p.jsx("button",{onClick:()=>d("simulate"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:p.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Simulate a tree sequence"}),p.jsx("p",{className:"text-sp-white/60 text-sm",children:"Generate new data using msprime simulation"})]})]})}),p.jsx("button",{onClick:()=>d("load"),disabled:r.length===0,className:`w-full border rounded-xl p-6 text-left transition-all duration-200 group ${r.length===0?"bg-sp-dark-blue/50 border-sp-pale-green/10 cursor-not-allowed opacity-50":"bg-sp-dark-blue hover:bg-sp-dark-blue/80 border-sp-pale-green/20 hover:border-sp-pale-green/40"}`,children:p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors duration-200 ${r.length===0?"bg-sp-pale-green/5":"bg-sp-pale-green/10 group-hover:bg-sp-pale-green/20"}`,children:p.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Load a tree sequence"}),p.jsxs("p",{className:"text-sp-white/60 text-sm",children:["Choose from existing uploaded sequences",s?p.jsx("span",{className:"ml-2",children:p.jsx("span",{className:"animate-pulse",children:"Loading..."})}):p.jsxs("span",{className:`ml-2 font-medium ${r.length===0?"text-red-400":"text-sp-pale-green"}`,children:["(",r.length," available)"]})]})]})]})})]}),p.jsx("div",{className:`
            bg-amber-900/15 border border-amber-700/25 rounded-lg p-3 mt-12 max-w-2xl mx-auto
            transition-all duration-2000 ease-in-out delay-1000
            ${e&&!l?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
          `,children:p.jsxs("p",{className:"text-amber-200 text-xs md:text-sm text-center leading-relaxed",children:[p.jsx("span",{className:"font-semibold",children:" Beta Notice:"})," Tree sequences are stored on a secure server for up to 24 hours. This is a beta application and data may be wiped during updates. Please download your results and respect our limited resources."]})}),p.jsx("div",{className:`
            mt-8 text-center
            transition-all duration-2000 ease-in-out delay-1200
            ${e&&!l?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
          `})]})})]})}var Yb={exports:{}},Gb,NM;function fre(){if(NM)return Gb;NM=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Gb=t,Gb}var Kb,kM;function dre(){if(kM)return Kb;kM=1;var t=fre();function e(){}function n(){}return n.resetWarningCache=e,Kb=function(){function r(o,l,u,d,h,g){if(g!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:e};return s.PropTypes=s,s},Kb}var MM;function hre(){return MM||(MM=1,Yb.exports=dre()()),Yb.exports}var pre=hre();const _t=l1(pre);function pa(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(h){try{d(r.next(h))}catch(g){o(g)}}function u(h){try{d(r.throw(h))}catch(g){o(g)}}function d(h){h.done?s(h.value):i(h.value).then(l,u)}d((r=r.apply(t,e||[])).next())})}const mre=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Po(t,e,n){const r=gre(t),{webkitRelativePath:i}=t,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${t.name}`;return typeof r.path!="string"&&IM(r,"path",s),IM(r,"relativePath",s),r}function gre(t){const{name:e}=t;if(e&&e.lastIndexOf(".")!==-1&&!t.type){const r=e.split(".").pop().toLowerCase(),i=mre.get(r);i&&Object.defineProperty(t,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return t}function IM(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!0})}const _re=[".DS_Store","Thumbs.db"];function vre(t){return pa(this,void 0,void 0,function*(){return Ed(t)&&xre(t.dataTransfer)?Sre(t.dataTransfer,t.type):yre(t)?bre(t):Array.isArray(t)&&t.every(e=>"getFile"in e&&typeof e.getFile=="function")?wre(t):[]})}function xre(t){return Ed(t)}function yre(t){return Ed(t)&&Ed(t.target)}function Ed(t){return typeof t=="object"&&t!==null}function bre(t){return r1(t.target.files).map(e=>Po(e))}function wre(t){return pa(this,void 0,void 0,function*(){return(yield Promise.all(t.map(n=>n.getFile()))).map(n=>Po(n))})}function Sre(t,e){return pa(this,void 0,void 0,function*(){if(t.items){const n=r1(t.items).filter(i=>i.kind==="file");if(e!=="drop")return n;const r=yield Promise.all(n.map(Tre));return OM(Sj(r))}return OM(r1(t.files).map(n=>Po(n)))})}function OM(t){return t.filter(e=>_re.indexOf(e.name)===-1)}function r1(t){if(t===null)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];e.push(r)}return e}function Tre(t){if(typeof t.webkitGetAsEntry!="function")return PM(t);const e=t.webkitGetAsEntry();return e&&e.isDirectory?Tj(e):PM(t,e)}function Sj(t){return t.reduce((e,n)=>[...e,...Array.isArray(n)?Sj(n):[n]],[])}function PM(t,e){return pa(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof t.getAsFileSystemHandle=="function"){const s=yield t.getAsFileSystemHandle();if(s===null)throw new Error(`${t} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,Po(o)}}const r=t.getAsFile();if(!r)throw new Error(`${t} is not a File`);return Po(r,(n=e==null?void 0:e.fullPath)!==null&&n!==void 0?n:void 0)})}function Ere(t){return pa(this,void 0,void 0,function*(){return t.isDirectory?Tj(t):Are(t)})}function Tj(t){const e=t.createReader();return new Promise((n,r)=>{const i=[];function s(){e.readEntries(o=>pa(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(Ere));i.push(l),s()}else try{const l=yield Promise.all(i);n(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function Are(t){return pa(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.file(r=>{const i=Po(r,t.fullPath);e(i)},r=>{n(r)})})})}var Ef={},DM;function Rre(){return DM||(DM=1,Ef.__esModule=!0,Ef.default=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(",");if(n.length===0)return!0;var r=t.name||"",i=(t.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return n.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0}),Ef}var Cre=Rre();const Zb=l1(Cre);function jM(t){return Mre(t)||kre(t)||Aj(t)||Nre()}function Nre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Mre(t){if(Array.isArray(t))return i1(t)}function LM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function BM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?LM(Object(n),!0).forEach(function(r){Ej(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ej(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ic(t,e){return Pre(t)||Ore(t,e)||Aj(t,e)||Ire()}function Ire(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Aj(t,e){if(t){if(typeof t=="string")return i1(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i1(t,e)}}function i1(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ore(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function Pre(t){if(Array.isArray(t))return t}var Dre=typeof Zb=="function"?Zb:Zb.default,jre="file-invalid-type",Lre="file-too-large",Bre="file-too-small",Ure="too-many-files",Fre=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=e.split(","),r=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:jre,message:"File type must be ".concat(r)}},UM=function(e){return{code:Lre,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},FM=function(e){return{code:Bre,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},zre={code:Ure,message:"Too many files"};function Rj(t,e){var n=t.type==="application/x-moz-file"||Dre(t,e);return[n,n?null:Fre(e)]}function Cj(t,e,n){if(Ls(t.size))if(Ls(e)&&Ls(n)){if(t.size>n)return[!1,UM(n)];if(t.size<e)return[!1,FM(e)]}else{if(Ls(e)&&t.size<e)return[!1,FM(e)];if(Ls(n)&&t.size>n)return[!1,UM(n)]}return[!0,null]}function Ls(t){return t!=null}function $re(t){var e=t.files,n=t.accept,r=t.minSize,i=t.maxSize,s=t.multiple,o=t.maxFiles,l=t.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(u){var d=Rj(u,n),h=Ic(d,1),g=h[0],_=Cj(u,r,i),x=Ic(_,1),w=x[0],S=l?l(u):null;return g&&w&&!S})}function Ad(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function Af(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function zM(t){t.preventDefault()}function Vre(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function qre(t){return t.indexOf("Edge/")!==-1}function Hre(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Vre(t)||qre(t)}function qr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!Ad(r)&&l&&l.apply(void 0,[r].concat(s)),Ad(r)})}}function Wre(){return"showOpenFilePicker"in window}function Xre(t){if(Ls(t)){var e=Object.entries(t).filter(function(n){var r=Ic(n,2),i=r[0],s=r[1],o=!0;return Nj(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(kj))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(n,r){var i=Ic(r,2),s=i[0],o=i[1];return BM(BM({},n),{},Ej({},s,o))},{});return[{description:"Files",accept:e}]}return t}function Yre(t){if(Ls(t))return Object.entries(t).reduce(function(e,n){var r=Ic(n,2),i=r[0],s=r[1];return[].concat(jM(e),[i],jM(s))},[]).filter(function(e){return Nj(e)||kj(e)}).join(",")}function Gre(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function Kre(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}function Nj(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||t==="application/*"||/\w+\/[-+.\w]+/g.test(t)}function kj(t){return/^.*\.[\w]+$/.test(t)}var Zre=["children"],Qre=["open"],Jre=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],eie=["refKey","onChange","onClick"];function tie(t){return iie(t)||rie(t)||Mj(t)||nie()}function nie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rie(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function iie(t){if(Array.isArray(t))return s1(t)}function Qb(t,e){return oie(t)||aie(t,e)||Mj(t,e)||sie()}function sie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mj(t,e){if(t){if(typeof t=="string")return s1(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s1(t,e)}}function s1(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function aie(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function oie(t){if(Array.isArray(t))return t}function $M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$M(Object(n),!0).forEach(function(r){a1(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$M(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function a1(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Rd(t,e){if(t==null)return{};var n=lie(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function lie(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var w2=D.forwardRef(function(t,e){var n=t.children,r=Rd(t,Zre),i=Uf(r),s=i.open,o=Rd(i,Qre);return D.useImperativeHandle(e,function(){return{open:s}},[s]),vc.createElement(D.Fragment,null,n(kt(kt({},o),{},{open:s})))});w2.displayName="Dropzone";var Ij={disabled:!1,getFilesFromEvent:vre,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};w2.defaultProps=Ij;w2.propTypes={children:_t.func,accept:_t.objectOf(_t.arrayOf(_t.string)),multiple:_t.bool,preventDropOnDocument:_t.bool,noClick:_t.bool,noKeyboard:_t.bool,noDrag:_t.bool,noDragEventsBubbling:_t.bool,minSize:_t.number,maxSize:_t.number,maxFiles:_t.number,disabled:_t.bool,getFilesFromEvent:_t.func,onFileDialogCancel:_t.func,onFileDialogOpen:_t.func,useFsAccessApi:_t.bool,autoFocus:_t.bool,onDragEnter:_t.func,onDragLeave:_t.func,onDragOver:_t.func,onDrop:_t.func,onDropAccepted:_t.func,onDropRejected:_t.func,onError:_t.func,validator:_t.func};var o1={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Uf(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=kt(kt({},Ij),t),n=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,u=e.maxFiles,d=e.onDragEnter,h=e.onDragLeave,g=e.onDragOver,_=e.onDrop,x=e.onDropAccepted,w=e.onDropRejected,S=e.onFileDialogCancel,b=e.onFileDialogOpen,T=e.useFsAccessApi,A=e.autoFocus,R=e.preventDropOnDocument,E=e.noClick,C=e.noKeyboard,O=e.noDrag,P=e.noDragEventsBubbling,k=e.onError,I=e.validator,N=D.useMemo(function(){return Yre(n)},[n]),B=D.useMemo(function(){return Xre(n)},[n]),V=D.useMemo(function(){return typeof b=="function"?b:VM},[b]),Z=D.useMemo(function(){return typeof S=="function"?S:VM},[S]),j=D.useRef(null),Y=D.useRef(null),$=D.useReducer(cie,o1),Q=Qb($,2),oe=Q[0],K=Q[1],L=oe.isFocused,W=oe.isFileDialogActive,fe=D.useRef(typeof window<"u"&&window.isSecureContext&&T&&Wre()),se=function(){!fe.current&&W&&setTimeout(function(){if(Y.current){var Me=Y.current.files;Me.length||(K({type:"closeDialog"}),Z())}},300)};D.useEffect(function(){return window.addEventListener("focus",se,!1),function(){window.removeEventListener("focus",se,!1)}},[Y,W,Z,fe]);var z=D.useRef([]),X=function(Me){j.current&&j.current.contains(Me.target)||(Me.preventDefault(),z.current=[])};D.useEffect(function(){return R&&(document.addEventListener("dragover",zM,!1),document.addEventListener("drop",X,!1)),function(){R&&(document.removeEventListener("dragover",zM),document.removeEventListener("drop",X))}},[j,R]),D.useEffect(function(){return!r&&A&&j.current&&j.current.focus(),function(){}},[j,A,r]);var J=D.useCallback(function(Se){k?k(Se):console.error(Se)},[k]),pe=D.useCallback(function(Se){Se.preventDefault(),Se.persist(),pt(Se),z.current=[].concat(tie(z.current),[Se.target]),Af(Se)&&Promise.resolve(i(Se)).then(function(Me){if(!(Ad(Se)&&!P)){var nt=Me.length,qe=nt>0&&$re({files:Me,accept:N,minSize:o,maxSize:s,multiple:l,maxFiles:u,validator:I}),Ze=nt>0&&!qe;K({isDragAccept:qe,isDragReject:Ze,isDragActive:!0,type:"setDraggedFiles"}),d&&d(Se)}}).catch(function(Me){return J(Me)})},[i,d,J,P,N,o,s,l,u,I]),xe=D.useCallback(function(Se){Se.preventDefault(),Se.persist(),pt(Se);var Me=Af(Se);if(Me&&Se.dataTransfer)try{Se.dataTransfer.dropEffect="copy"}catch{}return Me&&g&&g(Se),!1},[g,P]),Ae=D.useCallback(function(Se){Se.preventDefault(),Se.persist(),pt(Se);var Me=z.current.filter(function(qe){return j.current&&j.current.contains(qe)}),nt=Me.indexOf(Se.target);nt!==-1&&Me.splice(nt,1),z.current=Me,!(Me.length>0)&&(K({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Af(Se)&&h&&h(Se))},[j,h,P]),Ne=D.useCallback(function(Se,Me){var nt=[],qe=[];Se.forEach(function(Ze){var yt=Rj(Ze,N),mn=Qb(yt,2),ei=mn[0],br=mn[1],Ft=Cj(Ze,o,s),zt=Qb(Ft,2),kn=zt[0],wr=zt[1],Jn=I?I(Ze):null;if(ei&&kn&&!Jn)nt.push(Ze);else{var Te=[br,wr];Jn&&(Te=Te.concat(Jn)),qe.push({file:Ze,errors:Te.filter(function(lt){return lt})})}}),(!l&&nt.length>1||l&&u>=1&&nt.length>u)&&(nt.forEach(function(Ze){qe.push({file:Ze,errors:[zre]})}),nt.splice(0)),K({acceptedFiles:nt,fileRejections:qe,isDragReject:qe.length>0,type:"setFiles"}),_&&_(nt,qe,Me),qe.length>0&&w&&w(qe,Me),nt.length>0&&x&&x(nt,Me)},[K,l,N,o,s,u,_,x,w,I]),be=D.useCallback(function(Se){Se.preventDefault(),Se.persist(),pt(Se),z.current=[],Af(Se)&&Promise.resolve(i(Se)).then(function(Me){Ad(Se)&&!P||Ne(Me,Se)}).catch(function(Me){return J(Me)}),K({type:"reset"})},[i,Ne,J,P]),we=D.useCallback(function(){if(fe.current){K({type:"openDialog"}),V();var Se={multiple:l,types:B};window.showOpenFilePicker(Se).then(function(Me){return i(Me)}).then(function(Me){Ne(Me,null),K({type:"closeDialog"})}).catch(function(Me){Gre(Me)?(Z(Me),K({type:"closeDialog"})):Kre(Me)?(fe.current=!1,Y.current?(Y.current.value=null,Y.current.click()):J(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):J(Me)});return}Y.current&&(K({type:"openDialog"}),V(),Y.current.value=null,Y.current.click())},[K,V,Z,T,Ne,J,B,l]),ke=D.useCallback(function(Se){!j.current||!j.current.isEqualNode(Se.target)||(Se.key===" "||Se.key==="Enter"||Se.keyCode===32||Se.keyCode===13)&&(Se.preventDefault(),we())},[j,we]),Xe=D.useCallback(function(){K({type:"focus"})},[]),Le=D.useCallback(function(){K({type:"blur"})},[]),Kt=D.useCallback(function(){E||(Hre()?setTimeout(we,0):we())},[E,we]),Ie=function(Me){return r?null:Me},nn=function(Me){return C?null:Ie(Me)},ot=function(Me){return O?null:Ie(Me)},pt=function(Me){P&&Me.stopPropagation()},Mt=D.useMemo(function(){return function(){var Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Me=Se.refKey,nt=Me===void 0?"ref":Me,qe=Se.role,Ze=Se.onKeyDown,yt=Se.onFocus,mn=Se.onBlur,ei=Se.onClick,br=Se.onDragEnter,Ft=Se.onDragOver,zt=Se.onDragLeave,kn=Se.onDrop,wr=Rd(Se,Jre);return kt(kt(a1({onKeyDown:nn(qr(Ze,ke)),onFocus:nn(qr(yt,Xe)),onBlur:nn(qr(mn,Le)),onClick:Ie(qr(ei,Kt)),onDragEnter:ot(qr(br,pe)),onDragOver:ot(qr(Ft,xe)),onDragLeave:ot(qr(zt,Ae)),onDrop:ot(qr(kn,be)),role:typeof qe=="string"&&qe!==""?qe:"presentation"},nt,j),!r&&!C?{tabIndex:0}:{}),wr)}},[j,ke,Xe,Le,Kt,pe,xe,Ae,be,C,O,r]),rn=D.useCallback(function(Se){Se.stopPropagation()},[]),Ge=D.useMemo(function(){return function(){var Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Me=Se.refKey,nt=Me===void 0?"ref":Me,qe=Se.onChange,Ze=Se.onClick,yt=Rd(Se,eie),mn=a1({accept:N,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Ie(qr(qe,be)),onClick:Ie(qr(Ze,rn)),tabIndex:-1},nt,Y);return kt(kt({},mn),yt)}},[Y,n,l,be,r]);return kt(kt({},oe),{},{isFocused:L&&!r,getRootProps:Mt,getInputProps:Ge,rootRef:j,inputRef:Y,open:Ie(we)})}function cie(t,e){switch(e.type){case"focus":return kt(kt({},t),{},{isFocused:!0});case"blur":return kt(kt({},t),{},{isFocused:!1});case"openDialog":return kt(kt({},o1),{},{isFileDialogActive:!0});case"closeDialog":return kt(kt({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":return kt(kt({},t),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return kt(kt({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return kt({},o1);default:return t}}function VM(){}function uie({onUploadComplete:t,setLoading:e}){const[n,r]=D.useState(null),[i,s]=D.useState("none"),[o,l]=D.useState({sampleLocations:null,nodeLocations:null}),[u,d]=D.useState({}),h=D.useCallback(P=>{P.length>0&&(r(P[0]),s("none"),l({sampleLocations:null,nodeLocations:null}),d({}))},[]),{getRootProps:g,getInputProps:_,isDragActive:x}=Uf({onDrop:h,multiple:!1,accept:Vm.ACCEPTED_FORMATS}),w=D.useCallback(P=>{P.length>0&&l(k=>({...k,sampleLocations:P[0]}))},[]),S=Uf({onDrop:w,multiple:!1,accept:Vm.CSV_FORMATS}),b=D.useCallback(P=>{P.length>0&&l(k=>({...k,nodeLocations:P[0]}))},[]),T=Uf({onDrop:b,multiple:!1,accept:Vm.CSV_FORMATS}),A=async()=>{if(n){e(!0);try{Re.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone");const P=await et.uploadTreeSequence(n);Re.info("File upload completed successfully",{component:"Dropzone",data:{filename:n.name,result:P}}),t&&t(P.data)}catch(P){Re.error("File upload failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.name}}),alert(`Upload failed: ${P instanceof Error?P.message:"Unknown error"}`)}finally{e(!1)}}},R=()=>{s("add-locations")},E=async(P,k)=>{try{const I=await et.uploadLocationCSV(P,k);return d(N=>({...N,[k]:I.data.filename})),I.data.filename}catch(I){throw Re.error("CSV upload failed",{component:"Dropzone",error:I instanceof Error?I:new Error(String(I)),data:{filename:P.name,csvType:k}}),I}},C=async()=>{if(!(!n||!o.sampleLocations||!o.nodeLocations)){e(!0);try{Re.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone"),await et.uploadTreeSequence(n);let P=u.sample_locations,k=u.node_locations;if(!P&&o.sampleLocations&&(P=await E(o.sampleLocations,"sample_locations")),!k&&o.nodeLocations&&(k=await E(o.nodeLocations,"node_locations")),!P||!k)throw new Error("Failed to upload CSV files");console.log("Starting tree sequence update...");const I=await et.updateTreeSequenceLocations({tree_sequence_filename:n.name,sample_locations_filename:P,node_locations_filename:k});console.log("Tree sequence update completed:",I),Re.info("Tree sequence updated with custom locations",{component:"Dropzone",data:{originalFilename:n.name,newFilename:I.data.new_filename}}),t&&(console.log("Calling onUploadComplete with:",I.data),t(I.data))}catch(P){Re.error("Tree sequence update failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.name}}),alert(`Update failed: ${P instanceof Error?P.message:"Unknown error"}`)}finally{e(!1)}}},O=n&&o.sampleLocations&&o.nodeLocations;return p.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[p.jsxs("div",{...g(),className:`w-full h-48 border-2 border-dashed rounded-xl flex items-center justify-center text-xl transition-colors cursor-pointer select-none
          ${x?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[p.jsx("input",{..._()}),n?p.jsx("span",{className:"truncate max-w-full px-2",children:n.name}):x?p.jsx("span",{children:"Drop the file here"}):p.jsxs("span",{className:"text-center",children:["Drag and drop to select a file",p.jsx("br",{}),p.jsx("span",{className:"text-base text-sp-pale-green",children:"or click to browse"}),p.jsx("br",{}),p.jsx("span",{className:"text-sm text-sp-very-pale-green mt-1",children:"Supported formats: .trees, .tsz"})]})]}),n&&i==="none"&&p.jsxs("div",{className:"w-full flex flex-col gap-3",children:[p.jsxs("button",{type:"button",onClick:A,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Load as-is"]}),p.jsxs("button",{type:"button",onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[p.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Add locations"]})]}),i==="add-locations"&&p.jsxs("div",{className:"w-full space-y-4",children:[p.jsx("div",{className:"text-center text-sp-white/70 text-sm mb-4",children:"Upload CSV files with node locations (required columns: node_id, x, y, z)"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Sample Locations"}),p.jsxs("div",{...S.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${S.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[p.jsx("input",{...S.getInputProps()}),o.sampleLocations?p.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.sampleLocations.name}):S.isDragActive?p.jsx("span",{children:"Drop CSV here"}):p.jsx("span",{children:"Click or drag CSV with sample locations"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Node Locations"}),p.jsxs("div",{...T.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${T.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[p.jsx("input",{...T.getInputProps()}),o.nodeLocations?p.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.nodeLocations.name}):T.isDragActive?p.jsx("span",{children:"Drop CSV here"}):p.jsx("span",{children:"Click or drag CSV with node locations"})]})]}),p.jsxs("button",{type:"button",onClick:C,disabled:!O,className:`w-full font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 ${O?"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue transform hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Update Tree Sequence"]}),p.jsxs("button",{type:"button",onClick:()=>{s("none"),l({sampleLocations:null,nodeLocations:null}),d({})},className:"w-full bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}const Ht={num_samples:25,sequence_length:1e6,max_time:100,model:"dtwf",filename_prefix:"simulated",crs:"EPSG:4326",ploidy:2,mutation_rate:1e-8,recombination_rate:1e-8},Oj=t=>{switch(t){case"dtwf":return"dtwf";case"hudson":return"hud";case"smc":return"smc";case"smc_prime":return"smcp";default:return t.slice(0,4)}},Pj=t=>{switch(t){case"EPSG:4326":return"4326";case"unit_grid":return"ug";case"EPSG:3857":return"3857";default:return t.replace(/[^a-zA-Z0-9]/g,"").slice(0,4)}},fie=t=>{const e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),r=String(t.getFullYear()).slice(-2),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}${n}${r}${i}${s}`},Jb=(t,e,n=!1)=>{const r=Oj(t.model||"dtwf"),i=Pj(t.crs||"EPSG:4326"),o=`r${e??Math.floor(Math.random()*1e3)}`;let l=`s${t.num_samples}_m${r}_t${t.sequence_length}_p${t.ploidy}_c${i}_${o}`;if(n){const d=fie(new Date);l+=`_d${d}`}return l},lo=t=>t.toExponential(8),co=t=>t>=1e6?`${(t/1e6).toFixed(1)}Mb`:t>=1e3?`${(t/1e3).toFixed(1)}kb`:`${t}bp`,qM=t=>{const e=t.toLowerCase().trim();return e.endsWith("mb")?Math.round(parseFloat(e.slice(0,-2))*1e6):e.endsWith("kb")?Math.round(parseFloat(e.slice(0,-2))*1e3):e.endsWith("bp")?Math.round(parseFloat(e.slice(0,-2))):Math.round(parseFloat(e))};function die({onSimulationComplete:t,setLoading:e}){var C,O,P,k,I;const[n,r]=D.useState({...Ht,filename_prefix:Jb(Ht)}),[i,s]=D.useState(!1),[o,l]=D.useState(!0),[u,d]=D.useState(!1),[h,g]=D.useState({num_samples:Ht.num_samples.toString(),sequence_length:co(Ht.sequence_length),max_time:Ht.max_time.toString(),ploidy:((C=Ht.ploidy)==null?void 0:C.toString())||"2",random_seed:((O=Ht.random_seed)==null?void 0:O.toString())||"42",population_size:((P=Ht.population_size)==null?void 0:P.toString())||"",mutation_rate:((k=Ht.mutation_rate)==null?void 0:k.toString())||lo(Ht.mutation_rate),recombination_rate:((I=Ht.recombination_rate)==null?void 0:I.toString())||lo(Ht.recombination_rate)}),_=(N,B)=>{r(V=>({...V,[N]:B}))},x=(N,B)=>{g(V=>({...V,[N]:B}))},w=(N,B,V,Z,j)=>{if(x(N,B),B==="")return;const Y=parseInt(B);isNaN(Y)||_(N,Y)},S=(N,B,V,Z,j)=>{const Y=parseInt(B);let $=j;isNaN(Y)||($=Math.max(V,Math.min(Z,Y))),_(N,$),x(N,$.toString())},b=N=>{N.key==="Enter"&&(N.preventDefault(),E())},T=N=>{g(B=>({...B,sequence_length:N}));try{const B=qM(N);!isNaN(B)&&B>0&&r(V=>({...V,sequence_length:B}))}catch{}},A=N=>{try{const B=qM(N);isNaN(B)||B<=0?(g(V=>({...V,sequence_length:co(Ht.sequence_length)})),r(V=>({...V,sequence_length:Ht.sequence_length}))):(g(V=>({...V,sequence_length:co(B)})),r(V=>({...V,sequence_length:B})))}catch{g(V=>({...V,sequence_length:co(Ht.sequence_length)})),r(V=>({...V,sequence_length:Ht.sequence_length}))}},R=()=>o?Jb(n,i?n.random_seed:void 0):n.filename_prefix,E=async()=>{e(!0);try{Re.user.action("simulate-start",{params:n},"TreeSequenceSimulator");const N={...n,population_size:n.num_samples*(n.ploidy??2),random_seed:i?n.random_seed:void 0,filename_prefix:o?Jb(n,i?n.random_seed:void 0,!0):n.filename_prefix},B=await et.simulateTreeSequence(N),Z={...(await et.getTreeSequenceMetadata(B.data.filename)).data,num_mutations:B.data.num_mutations,crs:B.data.crs};Re.info("Tree sequence simulation completed successfully",{component:"TreeSequenceSimulator",data:{params:N,result:B,metadata:Z}}),t&&t(Z)}catch(N){Re.error("Tree sequence simulation failed",{component:"TreeSequenceSimulator",error:N instanceof Error?N:new Error(String(N)),data:{params:n}}),alert(`Simulation failed: ${N instanceof Error?N.message:"Unknown error"}`)}finally{e(!1)}};return p.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[p.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:p.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Simulation Parameters"}),p.jsx("p",{className:"text-sp-white/60 text-xs",children:"Configure the tree sequence simulation settings"})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sample individuals"}),p.jsx("input",{type:"number",min:"2",max:"500",value:h.num_samples,onChange:N=>w("num_samples",N.target.value),onBlur:N=>S("num_samples",N.target.value,2,500,2),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),p.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Range: 2-500"})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Ploidy"}),p.jsx("input",{type:"number",min:"1",max:"10",value:h.ploidy,onChange:N=>w("ploidy",N.target.value),onBlur:N=>S("ploidy",N.target.value,1,10,2),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),p.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-10 (2=diploid)"})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sequence Length (e.g., 1Mb, 100kb, 1000bp)"}),p.jsx("input",{type:"text",value:h.sequence_length,onChange:N=>T(N.target.value),onBlur:N=>A(N.target.value),className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),p.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:co(n.sequence_length)})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Max generations"}),p.jsx("input",{type:"number",min:"1",max:"1000",value:h.max_time,onChange:N=>w("max_time",N.target.value),onBlur:N=>S("max_time",N.target.value,1,1e3,1),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),p.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Model"}),p.jsxs("select",{value:n.model||"dtwf",onChange:N=>_("model",N.target.value),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[p.jsx("option",{value:"dtwf",children:"Discrete Wright-Fisher"}),p.jsx("option",{value:"hudson",children:"Hudson"}),p.jsx("option",{value:"smc",children:"SMC"}),p.jsx("option",{value:"smc_prime",children:"SMC'"})]})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Coordinate System"}),p.jsxs("select",{value:n.crs||"EPSG:4326",onChange:N=>_("crs",N.target.value),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[p.jsx("option",{value:"EPSG:4326",children:"WGS84 Geographic"}),p.jsx("option",{value:"unit_grid",children:"Unit Grid (0-1)"}),p.jsx("option",{value:"EPSG:3857",children:"Web Mercator"})]}),p.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Spatial coordinate system"})]})]})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[p.jsxs("div",{className:"bg-sp-pale-green/10 border border-sp-pale-green/30 rounded-lg p-3",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/20 rounded flex items-center justify-center",children:p.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),p.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Population Summary"})]}),p.jsxs("div",{className:"text-sm text-sp-white",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{children:"Total haplotypes:"}),p.jsx("span",{className:"font-bold text-sp-pale-green",children:n.num_samples*(n.ploidy??2)})]}),p.jsxs("div",{className:"text-xs text-sp-white/60",children:[n.num_samples," individuals  ",n.ploidy??2," ploidy"]})]})]}),p.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[p.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:p.jsx("svg",{className:"w-3 h-3 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),p.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Output Filename"})]}),p.jsxs("div",{className:"text-sm text-sp-white",children:[p.jsx("div",{className:"font-mono text-sp-pale-green break-all text-xs",children:R()}),p.jsx("div",{className:"text-xs text-sp-white/60",children:o?p.jsx("button",{onClick:()=>d(!0),className:"underline hover:text-sp-pale-green transition-colors cursor-pointer",children:"Auto-generated from parameters"}):"Custom filename"})]})]})]}),p.jsx("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl overflow-hidden",children:p.jsxs("details",{className:"group",children:[p.jsx("summary",{className:"px-5 py-3 cursor-pointer hover:bg-sp-pale-green/5 transition-colors duration-200 border-b border-sp-pale-green/10 group-open:border-b-0 list-none",children:p.jsx("div",{className:"flex items-center justify-between",children:p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:p.jsx("svg",{className:"w-3 h-3 text-sp-pale-green transition-transform duration-200 group-open:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),p.jsx("span",{className:"font-medium text-sp-white text-sm",children:"Advanced Options"})]})})}),p.jsxs("div",{className:"px-5 py-3 space-y-3 bg-sp-very-dark-blue/50",children:[p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"useAutoFilename",checked:o,onChange:N=>l(N.target.checked),onKeyDown:b,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),p.jsx("label",{htmlFor:"useAutoFilename",className:"text-sm font-medium text-sp-white",children:"Auto-generate filename"})]}),!o&&p.jsxs("div",{className:"ml-6",children:[p.jsx("label",{className:"text-sm font-medium text-sp-white mb-1 block",children:"Custom filename prefix"}),p.jsx("input",{type:"text",value:n.filename_prefix,onChange:N=>_("filename_prefix",N.target.value),onKeyDown:b,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"simulated"})]})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("input",{type:"checkbox",id:"useCustomSeed",checked:i,onChange:N=>s(N.target.checked),onKeyDown:b,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),p.jsx("label",{htmlFor:"useCustomSeed",className:"text-sm font-medium text-sp-white",children:"Use custom random seed"})]}),i?p.jsx("div",{className:"ml-6",children:p.jsx("input",{type:"number",value:h.random_seed,onChange:N=>{const B=N.target.value;if(x("random_seed",B),B!==""){const V=parseInt(B);isNaN(V)||_("random_seed",V)}},onBlur:N=>{const B=parseInt(N.target.value),V=isNaN(B)?42:B;_("random_seed",V),x("random_seed",V.toString())},onKeyDown:b,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"42"})}):p.jsx("div",{className:"ml-6 text-xs text-sp-white/60",children:"Random seed will be generated automatically"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"population-size",className:"block text-sm font-medium text-sp-white/80",children:"Population Size (optional)"}),p.jsx("input",{type:"number",id:"population-size",value:h.population_size,onChange:N=>w("population_size",N.target.value),onBlur:N=>S("population_size",N.target.value,1,1e6,1e3),className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green",placeholder:"1000"}),p.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1000 (effective population size)"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80",children:"Mutation Rate (per base pair per generation)"}),p.jsx("input",{type:"text",id:"mutation-rate",value:h.mutation_rate,onChange:N=>{g(V=>({...V,mutation_rate:N.target.value}));const B=parseFloat(N.target.value);!isNaN(B)&&B>0&&r(V=>({...V,mutation_rate:B}))},onBlur:N=>{const B=parseFloat(N.target.value);isNaN(B)||B<=0?(g(V=>({...V,mutation_rate:lo(Ht.mutation_rate)})),r(V=>({...V,mutation_rate:Ht.mutation_rate}))):(g(V=>({...V,mutation_rate:lo(B)})),r(V=>({...V,mutation_rate:B})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),p.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("label",{htmlFor:"recombination-rate",className:"block text-sm font-medium text-sp-white/80",children:"Recombination Rate (per base pair per generation)"}),p.jsx("input",{type:"text",id:"recombination-rate",value:h.recombination_rate,onChange:N=>{g(V=>({...V,recombination_rate:N.target.value}));const B=parseFloat(N.target.value);!isNaN(B)&&B>0&&r(V=>({...V,recombination_rate:B}))},onBlur:N=>{const B=parseFloat(N.target.value);isNaN(B)||B<=0?(g(V=>({...V,recombination_rate:lo(Ht.recombination_rate)})),r(V=>({...V,recombination_rate:Ht.recombination_rate}))):(g(V=>({...V,recombination_rate:lo(B)})),r(V=>({...V,recombination_rate:B})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),p.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]})]})]})}),p.jsx("div",{className:"flex justify-center pt-2",children:p.jsxs("button",{type:"button",onClick:E,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Simulate Tree Sequence"]})}),u&&p.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:p.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/30 rounded-xl p-5 max-w-lg w-full shadow-2xl",children:[p.jsxs("div",{className:"flex justify-between items-start mb-3",children:[p.jsx("h3",{className:"text-lg font-bold text-sp-white",children:"Filename Format Explained"}),p.jsx("button",{onClick:()=>d(!1),className:"text-sp-white/60 hover:text-sp-white transition-colors text-2xl leading-none",children:""})]}),p.jsxs("div",{className:"space-y-3 text-sm text-sp-white",children:[p.jsx("div",{className:"font-mono text-sm text-sp-pale-green bg-sp-dark-blue rounded-lg p-3 break-all",children:R()}),p.jsxs("div",{className:"space-y-1.5",children:[p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["s",n.num_samples]})," - Sample individuals (2-500)"]}),p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["m",Oj(n.model||"dtwf")]})," - Model (dtwf, hud, smc, smcp)"]}),p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["t",n.sequence_length]})," - Sequence Length (",co(n.sequence_length),")"]}),p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["g",n.max_time]})," - Max generations (1-1000)"]}),p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["p",n.ploidy??2]})," - Ploidy (1-4)"]}),p.jsxs("div",{children:[p.jsxs("span",{className:"font-bold text-sp-pale-green",children:["c",Pj(n.crs||"EPSG:4326")]})," - Coordinate system"]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-bold text-sp-pale-green",children:"r###"})," - Random seed (0-999)"]}),p.jsxs("div",{children:[p.jsx("span",{className:"font-bold text-sp-pale-green",children:"d##########"})," - Timestamp (MMDDYYHHMM)"]})]})]}),p.jsx("button",{onClick:()=>d(!1),className:"w-full mt-4 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white font-medium py-2.5 rounded-lg transition-colors duration-200",children:"Close"})]})})]})}function Ff({selectedOption:t,onBack:e}){const n=_r(),[r,i]=D.useState(!1),[s,o]=D.useState(0),{setTreeSequence:l}=ia();D.useEffect(()=>{if(r){const w=setInterval(()=>{o(S=>(S+1)%4)},f5.LOADING_DOTS_INTERVAL);return()=>clearInterval(w)}else o(0)},[r]);const u=w=>{l(w),n("/result",{state:{fromIntermediate:t}})},d=w=>{l(w),n("/result",{state:{fromIntermediate:t}})},h=w=>{l(w),n("/result",{state:{fromIntermediate:t}})},g=()=>{switch(t){case"upload":return"Upload a Tree Sequence";case"simulate":return"Simulate a Tree Sequence";case"load":return"Load a Tree Sequence";default:return""}},_=()=>{switch(t){case"upload":return"Upload your own .trees file to visualize";case"simulate":return"Generate new data using msprime simulation";case"load":return"Choose from existing uploaded sequences";default:return""}},x=()=>{if(r)return p.jsxs("div",{className:"flex flex-col items-center text-xl text-sp-white space-y-4",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sp-pale-green"}),p.jsxs("span",{children:["Processing",Array(s+1).join(".")]})]});switch(t){case"upload":return p.jsx(uie,{onUploadComplete:u,setLoading:i});case"simulate":return p.jsx(die,{onSimulationComplete:h,setLoading:i});case"load":return p.jsx(gI,{onSelect:d});default:return null}};return p.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen flex flex-col",children:[p.jsx(aa,{}),p.jsxs("div",{className:"flex-grow px-4 pt-24 pb-20",children:[p.jsx("div",{className:"max-w-7xl mx-auto",children:p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:g()}),p.jsx("p",{className:"text-sp-white/70 text-lg",children:_()})]})}),p.jsx("div",{className:"max-w-7xl mx-auto",children:p.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:p.jsx("div",{className:"p-8 min-h-[600px] flex items-start justify-center",children:x()})})})]})]})}const S2="argscape_tutorial_progress";function mc(){const t=sessionStorage.getItem(S2);return t?JSON.parse(t):Bj()}function Dj(t){sessionStorage.setItem(S2,JSON.stringify(t))}function jj(t,e,n){const r=mc(),i=r.find(s=>s.id===t);if(i){const s=i.lessons.find(o=>o.id===e);s&&(Object.assign(s,n),i.completed=i.lessons.every(o=>o.completed),Dj(r))}}function Lj(t,e){const r=mc().find(i=>i.id===t);return r&&r.lessons.find(i=>i.id===e)||null}function hie(){return sessionStorage.removeItem(S2),Bj()}function Bj(){const t=[{id:"module-1",completed:!1,lessons:[{id:"lesson-1-1",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-1-2",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-1-3",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-1-4",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-1-5",completed:!1,lastVisitedSection:0,completedSections:[]}]},{id:"module-2",completed:!1,lessons:[{id:"lesson-2-1",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-2-2",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-2-3",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-2-4",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-2-5",completed:!1,lastVisitedSection:0,completedSections:[]}]},{id:"module-3",completed:!1,lessons:[{id:"lesson-3-1",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-3-2",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-3-3",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-3-4",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-3-5",completed:!1,lastVisitedSection:0,completedSections:[]}]},{id:"module-4",completed:!1,lessons:[{id:"lesson-4-1",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-4-2",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-4-3",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-4-4",completed:!1,lastVisitedSection:0,completedSections:[]}]},{id:"module-5",completed:!1,lessons:[{id:"lesson-5-1",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-5-2",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-5-3",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-5-4",completed:!1,lastVisitedSection:0,completedSections:[]},{id:"lesson-5-5",completed:!1,lastVisitedSection:0,completedSections:[]}]},{id:"module-6",completed:!1,lessons:[{id:"lesson-6-1",completed:!1,lastVisitedSection:0,completedSections:[]}]}];return Dj(t),t}function pie({isOpen:t,onClose:e,onConfirm:n}){return t?p.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[p.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),p.jsxs("div",{className:"relative bg-sp-dark-blue rounded-2xl p-8 max-w-lg w-full mx-4 border border-sp-pale-green/10",children:[p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),p.jsx("h3",{className:"text-2xl font-bold text-sp-white mb-2",children:"Clear Progress?"}),p.jsx("p",{className:"text-sp-white/70",children:"This will reset all your tutorial progress. This action cannot be undone."})]}),p.jsxs("div",{className:"flex flex-col gap-3",children:[p.jsx("button",{onClick:n,className:"w-full px-6 py-3 rounded-lg bg-red-500 text-white font-semibold hover:bg-red-600 transition-colors",children:"Clear All Progress"}),p.jsx("button",{onClick:e,className:"w-full px-6 py-3 rounded-lg bg-sp-dark-blue hover:bg-sp-dark-blue/80 text-sp-white/70 transition-colors",children:"Cancel"})]})]})]}):null}function mie(){const t=_r(),[e,n]=D.useState(null),[r,i]=D.useState(mc()),[s,o]=D.useState(!1);D.useEffect(()=>{i(mc());const g=setInterval(()=>{i(mc())},1e3);return()=>clearInterval(g)},[]);const l=[{id:"module-1",title:"Genetic Foundations & Evolutionary Processes",description:"Start your journey by understanding the fundamental concepts of genetics and evolution that form the basis of ancestral recombination graphs.",lessons:[{id:"lesson-1-1",title:"Life's Code: DNA, Genes, Alleles, and Variation",description:"Discover the basics of DNA, genes, and how genetic variation shapes diversity within populations.",duration:"20 min",status:"coming-soon"},{id:"lesson-1-2",title:"Passing the Torch: Inheritance, Meiosis, and Generations",description:"Learn about Mendelian inheritance, meiosis, and how genetic information flows through generations.",duration:"25 min",status:"coming-soon"},{id:"lesson-1-3",title:"The Origins of Novelty & Diversity: Mutation and Recombination",description:"Explore how mutations create new alleles and recombination shuffles existing variation.",duration:"25 min",status:"coming-soon"},{id:"lesson-1-4",title:"Populations, Gene Pools, and Allele Frequencies",description:"Understand populations, shared gene pools, and how to describe variation using allele frequencies.",duration:"20 min",status:"coming-soon"},{id:"lesson-1-5",title:"Forces Shaping Populations: Drift, Selection, and Gene Flow",description:"Learn about key evolutionary mechanisms: genetic drift, natural selection, and gene flow.",duration:"30 min",status:"coming-soon"}]},{id:"module-2",title:"Thinking Backwards  The Coalescent Framework",description:"Learn about coalescent theory and how it helps us understand ancestral relationships in populations.",lessons:[{id:"lesson-2-1",title:"A Retrospective View: Introduction to Coalescent Theory",description:"Understand the concept of tracing ancestry backward in time and how lineages merge in common ancestors.",duration:"25 min",status:"coming-soon"},{id:"lesson-2-2",title:"The Coalescent Process: Probability and Timing",description:"Learn about coalescence probabilities and timing in relation to population size.",duration:"30 min",status:"coming-soon"},{id:"lesson-2-3",title:"The Wright-Fisher Model and Effective Population Size",description:"Explore the Wright-Fisher model and understand the crucial concept of effective population size.",duration:"30 min",status:"coming-soon"},{id:"lesson-2-4",title:"Impact of Recombination on Coalescent Histories",description:"Discover how recombination affects the coalescent process and creates independent histories.",duration:"25 min",status:"coming-soon"},{id:"lesson-2-5",title:"Genealogies Along the Chromosome: Marginal Trees and Tree Sequences",description:"Learn about marginal trees and how tree sequences efficiently store genealogical information.",duration:"25 min",status:"coming-soon"}]},{id:"module-3",title:"Simulating Evolutionary Histories",description:"Master the tools in the tskit ecosystem for simulating and analyzing evolutionary histories.",lessons:[{id:"lesson-3-1",title:"Simulating Coalescent Histories with msprime",description:"Deep dive into msprime for generating tree sequences through coalescent simulation.",duration:"35 min",status:"coming-soon"},{id:"lesson-3-2",title:"Simulating Forward with SLiM",description:"Learn about forward-time simulation with SLiM for modeling selection and complex ecology.",duration:"35 min",status:"coming-soon"},{id:"lesson-3-3",title:"Bridging Simulators: The Power of pyslim and Recapitation",description:"Understand how to combine SLiM and msprime simulations using pyslim.",duration:"30 min",status:"coming-soon"},{id:"lesson-3-4",title:"Adding Mutations to Simulated Genealogies",description:"Learn how mutations are added to tree sequences in different simulation frameworks.",duration:"25 min",status:"coming-soon"},{id:"lesson-3-5",title:"Understanding Tree Sequence Data: Nodes, Edges, and Tables",description:"Explore the internal structure of tree sequences in tskit.",duration:"30 min",status:"coming-soon"}]},{id:"module-4",title:"The Ancestral Recombination Graph (ARG) and tskit Interaction",description:"Understand ARGs in depth and how they are represented and analyzed using tskit.",lessons:[{id:"lesson-4-1",title:"Defining the Ancestral Recombination Graph",description:"Learn what an ARG is and how it relates to marginal trees and recombination events.",duration:"25 min",status:"coming-soon"},{id:"lesson-4-2",title:"Visualizing ARGs: Challenges and ARGscape's Approaches",description:"Explore different approaches to visualizing complex ARG structures.",duration:"30 min",status:"coming-soon"},{id:"lesson-4-3",title:"Extracting Information: Querying Tree Sequences with tskit",description:"Learn how to extract useful information from tree sequences using ARGscape.",duration:"30 min",status:"coming-soon"},{id:"lesson-4-4",title:"Inferring ARGs from Real Data: tsinfer and Its Output",description:"Understand how ARGs are inferred from real sequence data using tsinfer.",duration:"35 min",status:"coming-soon"}]},{id:"module-5",title:"Temporal and Spatial Dimensions of Ancestry",description:"Add temporal and spatial context to ancestral relationships using advanced inference methods.",lessons:[{id:"lesson-5-1",title:"Dating the Past: Temporal Inference with tsdate",description:"Learn how to estimate node ages in tree sequences using tsdate.",duration:"30 min",status:"coming-soon"},{id:"lesson-5-2",title:"Placing Ancestry in Space: Introduction to Spatial Population Genetics",description:"Understand the importance of geography in evolutionary history.",duration:"25 min",status:"coming-soon"},{id:"lesson-5-3",title:"Methods for Inferring Ancestral Locations",description:"Explore different algorithms for inferring ancestral geographic locations.",duration:"35 min",status:"coming-soon"},{id:"lesson-5-4",title:"Hands-on Spatial Inference and Visualization in ARGscape",description:"Practice using spatial inference and visualization tools in ARGscape.",duration:"40 min",status:"coming-soon"},{id:"lesson-5-5",title:"Comparing Spatial Inferences and Exploring Discrete Spaces",description:"Learn to compare different spatial inference methods and work with discrete spaces.",duration:"35 min",status:"coming-soon"}]},{id:"module-6",title:"Extending Skills and the tskit Horizon",description:"Learn how to extend your analysis beyond ARGscape using the broader tskit ecosystem.",lessons:[{id:"lesson-6-1",title:"The tskit Ecosystem and Your Journey Forward",description:"Explore the tskit ecosystem and learn how to extend your analysis programmatically.",duration:"40 min",status:"coming-soon"}]}],u=g=>{n(e===g?null:g)},d=()=>{const g=hie();i(g),o(!1)},h=(g,_)=>{const x=r.find(w=>w.id===g);if(x){const w=x.lessons.find(S=>S.id===_);return(w==null?void 0:w.completed)||!1}return!1};return p.jsxs("div",{className:"min-h-screen bg-sp-very-dark-blue text-sp-white flex flex-col",children:[p.jsx(aa,{}),p.jsx("div",{className:"flex-grow px-4 pt-24 pb-20",children:p.jsxs("div",{className:"max-w-7xl mx-auto",children:[p.jsxs("div",{className:"text-center mb-12",children:[p.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Learn ARGscape"}),p.jsx("p",{className:"text-sp-white/70 text-lg max-w-2xl mx-auto",children:"Master the concepts of ancestral recombination graphs through our carefully crafted tutorials, starting with fundamental principles and progressing to advanced applications."}),p.jsx("button",{onClick:()=>o(!0),className:"mt-6 px-4 py-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-500 transition-colors text-sm",children:"Clear Progress"})]}),p.jsx("div",{className:"space-y-8",children:l.map(g=>p.jsxs("div",{className:"bg-sp-dark-blue/30 rounded-2xl border border-sp-pale-green/10 overflow-hidden cursor-pointer transition-all duration-300 hover:border-sp-pale-green/30",onClick:()=>u(g.id),children:[p.jsx("div",{className:"p-6 border-b border-sp-pale-green/10",children:p.jsxs("div",{className:"flex items-start justify-between",children:[p.jsxs("div",{children:[p.jsx("h2",{className:"text-2xl font-bold mb-2",children:g.title}),p.jsx("p",{className:"text-sp-white/70",children:g.description})]}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsxs("div",{className:"text-sm text-sp-white/50",children:[g.lessons.filter(_=>h(g.id,_.id)).length," / ",g.lessons.length," completed"]}),p.jsx("button",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-sp-pale-green/10 hover:bg-sp-pale-green/20 transition-colors flex items-center justify-center",children:p.jsx("svg",{className:`w-6 h-6 text-sp-pale-green transition-transform duration-200 ${e===g.id?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})}),p.jsx("div",{className:`transition-all duration-300 ${e===g.id?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`,children:p.jsx("div",{className:"p-6 space-y-4",children:g.lessons.map((_,x)=>p.jsxs("div",{className:`group relative rounded-xl p-6 transition-all duration-200 ${_.status==="available"?"bg-sp-dark-blue hover:bg-sp-dark-blue/80 cursor-pointer":"bg-sp-dark-blue/50 cursor-not-allowed"}`,onClick:w=>{w.stopPropagation(),_.status==="available"&&t(`/tutorials/${_.id}`)},children:[p.jsxs("div",{className:"flex items-start gap-4",children:[p.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${h(g.id,_.id)?"bg-green-500 text-white":_.status==="available"?"bg-sp-pale-green text-sp-very-dark-blue":"bg-sp-pale-green/20 text-sp-pale-green/50"}`,children:h(g.id,_.id)?p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):x+1}),p.jsxs("div",{className:"flex-grow",children:[p.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[p.jsx("h3",{className:`font-semibold ${_.status==="available"?"text-sp-white":"text-sp-white/50"}`,children:_.title}),_.status==="coming-soon"&&p.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-sp-pale-green/10 text-sp-pale-green",children:"Coming Soon"}),h(g.id,_.id)&&p.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-500/10 text-green-500",children:"Completed"})]}),p.jsx("p",{className:`text-sm ${_.status==="available"?"text-sp-white/70":"text-sp-white/30"}`,children:_.description})]}),p.jsxs("div",{className:`flex items-center gap-2 text-sm ${_.status==="available"?"text-sp-white/50":"text-sp-white/30"}`,children:[p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),_.duration]})]}),_.status==="available"&&!h(g.id,_.id)&&p.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-sp-pale-green/20 rounded-b-xl overflow-hidden",children:p.jsx("div",{className:"w-0 group-hover:w-full h-full bg-sp-pale-green transition-all duration-500 ease-out"})})]},_.id))})})]},g.id))})]})}),p.jsx(pie,{isOpen:s,onClose:()=>o(!1),onConfirm:d})]})}function gie(){return p.jsxs("div",{className:"min-h-screen bg-sp-very-dark-blue text-sp-white flex flex-col",children:[p.jsx(aa,{}),p.jsx("div",{className:"flex-grow px-4 pt-24 pb-20",children:p.jsx("div",{className:"max-w-7xl mx-auto",children:p.jsxs("div",{className:"text-center",children:[p.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Documentation"}),p.jsx("p",{className:"text-sp-white/70 text-lg mb-8",children:"Comprehensive documentation for ARGscape's features and capabilities."}),p.jsxs("div",{className:"bg-sp-dark-blue/30 rounded-lg p-8 text-center",children:[p.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),p.jsx("p",{className:"text-xl font-semibold mb-2",children:"Coming Soon"}),p.jsx("p",{className:"text-sp-white/70",children:"Our documentation is currently under development. Check back soon!"})]})]})})})]})}const Uj="argscape_first_visit",_ie=()=>{try{return!sessionStorage.getItem(Uj)}catch{return!0}},vie=()=>{try{sessionStorage.setItem(Uj,"true")}catch{console.warn("Session storage not available")}};function cs({title:t,subtitle:e,children:n,className:r=""}){return p.jsxs("div",{className:`space-y-6 ${r}`,children:[p.jsxs("div",{className:"space-y-2",children:[p.jsx("h2",{className:"text-2xl font-bold text-sp-pale-green",children:t}),e&&p.jsx("p",{className:"text-lg text-sp-white/70",children:e})]}),p.jsx("div",{className:"space-y-6",children:n})]})}function us({icon:t,children:e}){return p.jsxs("li",{className:"flex items-start gap-3",children:[p.jsx("div",{className:"flex-shrink-0 w-6 h-6 text-sp-pale-green",children:t}),p.jsx("span",{className:"text-sp-white/70",children:e})]})}function ur({term:t,children:e}){return p.jsxs("div",{className:"bg-sp-dark-blue rounded-lg p-4",children:[p.jsx("h4",{className:"font-semibold text-sp-pale-green mb-1",children:t}),p.jsx("p",{className:"text-sm text-sp-white/70",children:e})]})}function Cd({title:t,children:e,className:n=""}){return p.jsxs("div",{className:`bg-sp-dark-blue/30 rounded-xl p-6 border border-sp-pale-green/10 ${n}`,children:[t&&p.jsx("h3",{className:"text-xl font-semibold mb-4 text-sp-pale-green",children:t}),p.jsx("div",{className:"space-y-4",children:e})]})}function Fj({question:t,hint:e}){return p.jsxs("div",{className:"bg-sp-pale-green/10 rounded-lg p-4 border border-sp-pale-green/20",children:[p.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[p.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),p.jsx("span",{className:"font-semibold text-sp-pale-green",children:"Think About It"})]}),p.jsx("p",{className:"text-sp-white/80 mb-2",children:t}),e&&p.jsxs("p",{className:"text-sm text-sp-white/60 italic",children:["Hint: ",e]})]})}function zj({children:t,caption:e,className:n=""}){return p.jsxs("div",{className:`rounded-xl overflow-hidden ${n}`,children:[p.jsx("div",{className:"bg-sp-dark-blue/50 p-4",children:t}),e&&p.jsx("p",{className:"text-sm text-sp-white/60 text-center mt-2",children:e})]})}function $j({isOpen:t,onClose:e,nextLessonId:n,lessonTitle:r}){const i=_r();if(!t)return null;const s=()=>{i(n?`/tutorials/${n}`:"/tutorials"),e()};return p.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[p.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),p.jsxs("div",{className:"relative bg-sp-dark-blue rounded-2xl p-8 max-w-lg w-full mx-4 border border-sp-pale-green/10",children:[p.jsxs("div",{className:"text-center mb-8",children:[p.jsx("div",{className:"w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:p.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),p.jsx("h3",{className:"text-2xl font-bold text-sp-white mb-2",children:"Lesson Completed!"}),p.jsxs("p",{className:"text-sp-white/70",children:[`Congratulations! You've completed "`,r,'".']})]}),p.jsxs("div",{className:"flex flex-col gap-3",children:[p.jsx("button",{onClick:s,className:"w-full px-6 py-3 rounded-lg bg-sp-pale-green text-sp-very-dark-blue font-semibold hover:bg-sp-pale-green/90 transition-colors",children:n?"Continue to Next Lesson":"Return to Tutorials"}),p.jsx("button",{onClick:e,className:"w-full px-6 py-3 rounded-lg bg-sp-dark-blue hover:bg-sp-dark-blue/80 text-sp-white/70 transition-colors",children:"Review This Lesson"})]})]})]})}const HM="module-1",WM="lesson-1-1";function xie(){const[t,e]=D.useState(0),[n,r]=D.useState(!1);D.useEffect(()=>{const l=Lj(HM,WM);l&&e(l.lastVisitedSection)},[]),D.useEffect(()=>{jj(HM,WM,{lastVisitedSection:t})},[t]);const i=[{id:"title",title:"Title",content:p.jsxs(cs,{title:"Life's Code: DNA, Genes, Alleles, and Variation",subtitle:"Understanding the Basic Units of Inheritance",children:[p.jsx("div",{className:"flex justify-center mb-8",children:p.jsx(sa,{size:"small",className:"opacity-50"})}),p.jsx(zj,{className:"max-w-2xl mx-auto",children:p.jsx("div",{className:"h-64 bg-gradient-to-br from-sp-pale-green/20 to-sp-dark-blue flex items-center justify-center",children:p.jsx("div",{className:"w-32 h-32 animate-spin-slow"})})})]})},{id:"objectives",title:"Learning Objectives",content:p.jsx(cs,{title:"What You'll Learn in This Lesson",children:p.jsx(Cd,{children:p.jsxs("ul",{className:"space-y-4",children:[p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Understand DNA structure and its role as the carrier of genetic information"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Define genes as functional units and their relationship to traits"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Explore alleles as variants of genes"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Recognize the importance of genetic variation in populations"})]})})})},{id:"key-terms",title:"Key Terms",content:p.jsx(cs,{title:"Key Terms We'll Cover",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsx(ur,{term:"DNA",children:"The molecule that carries genetic instructions for development and functioning"}),p.jsx(ur,{term:"Gene",children:"A segment of DNA that codes for a specific protein or trait"}),p.jsx(ur,{term:"Allele",children:"Different versions or variants of the same gene"}),p.jsx(ur,{term:"Genetic Variation",children:"Differences in DNA sequences between individuals"}),p.jsx(ur,{term:"Nucleotide",children:"The building blocks of DNA (A, T, C, G)"}),p.jsx(ur,{term:"Genome",children:"The complete set of genetic material in an organism"})]})})},{id:"introduction",title:"Introduction",content:p.jsxs(cs,{title:"The Building Blocks of Life",children:[p.jsx(Cd,{children:p.jsx("p",{className:"text-sp-white/80 text-lg",children:"Before we can understand how populations evolve and how we trace their histories, we need to understand the basic units of inheritance. DNA is the molecule that carries genetic information, passed down through generations and shaped by evolutionary forces. This information is what tskit tracks as it reconstructs ancestral relationships."})}),p.jsx(Fj,{question:"Why do you think it's important to understand DNA and genes before studying their history?",hint:"Consider how understanding the parts of a car helps you understand its maintenance history."})]})}],s=()=>{t<i.length-1?e(t+1):r(!0)},o=()=>{t>0&&e(t-1)};return p.jsxs("div",{className:"min-h-screen bg-sp-very-dark-blue text-sp-white flex flex-col",children:[p.jsx(aa,{}),p.jsxs("div",{className:"flex-grow flex flex-col",children:[i[t].content,p.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-sp-very-dark-blue/80 backdrop-blur-sm border-t border-sp-pale-green/10 p-4",children:p.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[p.jsx("button",{onClick:o,className:`px-4 py-2 rounded-lg transition-colors ${t>0?"bg-sp-pale-green/10 hover:bg-sp-pale-green/20 text-sp-pale-green":"bg-sp-pale-green/5 text-sp-pale-green/30 cursor-not-allowed"}`,disabled:t===0,children:"Previous"}),p.jsxs("div",{className:"text-sp-white/50 text-sm",children:[t+1," / ",i.length]}),p.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-sp-pale-green/10 hover:bg-sp-pale-green/20 text-sp-pale-green transition-colors",children:t===i.length-1?"Complete":"Next"})]})})]}),p.jsx($j,{isOpen:n,onClose:()=>r(!1),nextLessonId:"lesson-1-2",lessonTitle:"Life's Code: DNA, Genes, Alleles, and Variation"})]})}const XM="module-1",YM="lesson-1-2";function yie(){const[t,e]=D.useState(0),[n,r]=D.useState(!1);D.useEffect(()=>{const l=Lj(XM,YM);l&&e(l.lastVisitedSection)},[]),D.useEffect(()=>{jj(XM,YM,{lastVisitedSection:t})},[t]);const i=[{id:"title",title:"Title",content:p.jsxs(cs,{title:"Passing the Torch: Inheritance, Meiosis, and Generations",subtitle:"Understanding How Genetic Information Flows Through Time",children:[p.jsx("div",{className:"flex justify-center mb-8",children:p.jsx(sa,{size:"small",className:"opacity-50"})}),p.jsx(zj,{className:"max-w-2xl mx-auto",children:p.jsx("div",{className:"h-64 bg-gradient-to-br from-sp-pale-green/20 to-sp-dark-blue flex items-center justify-center"})})]})},{id:"objectives",title:"Learning Objectives",content:p.jsx(cs,{title:"What You'll Learn in This Lesson",children:p.jsx(Cd,{children:p.jsxs("ul",{className:"space-y-4",children:[p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Understand the basic principles of Mendelian inheritance"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Learn how meiosis creates gametes and shuffles genetic material"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Define generations as discrete time steps in evolution"}),p.jsx(us,{icon:p.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:"Connect inheritance patterns to tskit's modeling of transmission events"})]})})})},{id:"key-terms",title:"Key Terms",content:p.jsx(cs,{title:"Key Terms We'll Cover",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsx(ur,{term:"Inheritance",children:"The passing of genetic material from parents to offspring"}),p.jsx(ur,{term:"Meiosis",children:"Cell division that produces gametes with half the normal chromosome number"}),p.jsx(ur,{term:"Generation",children:"A group of individuals of the same age in a population's lineage"}),p.jsx(ur,{term:"Gamete",children:"Reproductive cells (sperm or egg) containing half the genetic material"}),p.jsx(ur,{term:"Dominant",children:"An allele that masks the effect of its recessive partner"}),p.jsx(ur,{term:"Recessive",children:"An allele whose effect is masked by a dominant allele"})]})})},{id:"introduction",title:"Introduction",content:p.jsxs(cs,{title:"The Flow of Genetic Information",children:[p.jsx(Cd,{children:p.jsx("p",{className:"text-sp-white/80 text-lg",children:"Understanding how genetic information passes from one generation to the next is crucial for tracing ancestry. This transmission process, governed by the rules of inheritance and shaped by meiosis, creates the patterns that tskit uses to reconstruct evolutionary histories. Each generation represents a discrete time step in this journey through evolutionary time."})}),p.jsx(Fj,{question:"How is passing genetic information through generations similar to passing down family heirlooms?",hint:"Consider how both carry information about the past and can be traced back through time."})]})}],s=()=>{t<i.length-1?e(t+1):r(!0)},o=()=>{t>0&&e(t-1)};return p.jsxs("div",{className:"min-h-screen bg-sp-very-dark-blue text-sp-white flex flex-col",children:[p.jsx(aa,{}),p.jsxs("div",{className:"flex-grow flex flex-col",children:[i[t].content,p.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-sp-very-dark-blue/80 backdrop-blur-sm border-t border-sp-pale-green/10 p-4",children:p.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[p.jsx("button",{onClick:o,className:`px-4 py-2 rounded-lg transition-colors ${t>0?"bg-sp-pale-green/10 hover:bg-sp-pale-green/20 text-sp-pale-green":"bg-sp-pale-green/5 text-sp-pale-green/30 cursor-not-allowed"}`,disabled:t===0,children:"Previous"}),p.jsxs("div",{className:"text-sp-white/50 text-sm",children:[t+1," / ",i.length]}),p.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-sp-pale-green/10 hover:bg-sp-pale-green/20 text-sp-pale-green transition-colors",children:t===i.length-1?"Complete":"Next"})]})})]}),p.jsx($j,{isOpen:n,onClose:()=>r(!1),nextLessonId:"lesson-1-3",lessonTitle:"Passing the Torch: Inheritance, Meiosis, and Generations"})]})}function Hr({children:t}){return p.jsxs(p.Fragment,{children:[p.jsx("main",{children:t}),p.jsx(TV,{})]})}function bie(){const t=ra(),[e,n]=D.useState("intro"),[r,i]=D.useState(null),[s,o]=D.useState(!1),[l,u]=D.useState([]),[d,h]=D.useState(!1),[g,_]=D.useState(!1),[x,w]=D.useState(!1);D.useEffect(()=>{d||(async()=>{var R;try{Re.data.processing("fetch-available-tree-sequences","Home");const C=(await et.getUploadedFiles()).data;u(C.uploaded_tree_sequences||[]),Re.info(`Found ${((R=C.uploaded_tree_sequences)==null?void 0:R.length)||0} available tree sequences for animation logic`,{component:"Home"})}catch(E){Re.error("Failed to fetch available tree sequences",{component:"Home",error:E instanceof Error?E:new Error(String(E))}),u([])}finally{h(!0)}})()},[d]),D.useEffect(()=>{var P,k,I,N;if(!d)return;const A=(P=t.state)==null?void 0:P.fromInternal,R=(k=t.state)==null?void 0:k.fromResult,E=(I=t.state)==null?void 0:I.selectedOption,C=(N=t.state)==null?void 0:N.forceIntro;R&&E?(i(E),n("intermediate"),o(!1)):(l.length>0||R&&E||A?!1:(C||_ie(),!0))?(o(!0),n("intro"),i(null),vie()):(n("landing"),o(!1),i(null))},[t.state,d,l.length]);const S=()=>{w(!0),n("transitioning"),setTimeout(()=>{n("landing"),o(!1),w(!1)},2e3)},b=A=>{i(A),n("intermediate")},T=()=>{i(null),n("landing")};return p.jsxs("div",{className:"bg-sp-very-dark-blue min-h-screen",children:[s&&e==="intro"&&p.jsx(RM,{onComplete:S}),e==="transitioning"&&p.jsxs("div",{className:"relative min-h-screen",children:[p.jsx(RM,{onComplete:S,isTransitioning:!0}),p.jsx(CM,{onOptionSelect:b,isTransitioning:!0})]}),e==="landing"&&p.jsx(CM,{onOptionSelect:b}),e==="intermediate"&&r&&p.jsx(Ff,{selectedOption:r,onBack:T})]})}function wie(){return p.jsx(m5,{children:p.jsx(d5,{children:p.jsx(l5,{children:p.jsxs(i5,{children:[p.jsx(Xn,{path:"/",element:p.jsx(Hr,{children:p.jsx(bie,{})})}),p.jsx(Xn,{path:"/result",element:p.jsx(Hr,{children:p.jsx(y5,{})})}),p.jsx(Xn,{path:"/visualize/:filename",element:p.jsx(Hr,{children:p.jsx(SV,{})})}),p.jsx(Xn,{path:"/visualize-spatial/:filename",element:p.jsx(Hr,{children:p.jsx(Xne,{})})}),p.jsx(Xn,{path:"/visualize-spatial-diff/:filename",element:p.jsx(Hr,{children:p.jsx(cre,{})})}),p.jsx(Xn,{path:"/tutorials",element:p.jsx(Hr,{children:p.jsx(mie,{})})}),p.jsx(Xn,{path:"/docs",element:p.jsx(Hr,{children:p.jsx(gie,{})})}),p.jsx(Xn,{path:"/upload",element:p.jsx(Hr,{children:p.jsx(Ff,{selectedOption:"upload",onBack:()=>{}})})}),p.jsx(Xn,{path:"/simulate",element:p.jsx(Hr,{children:p.jsx(Ff,{selectedOption:"simulate",onBack:()=>{}})})}),p.jsx(Xn,{path:"/load",element:p.jsx(Hr,{children:p.jsx(Ff,{selectedOption:"load",onBack:()=>{}})})}),p.jsx(Xn,{path:"/tutorials/lesson-1-1",element:p.jsx(xie,{})}),p.jsx(Xn,{path:"/tutorials/lesson-1-2",element:p.jsx(yie,{})})]})})})})}fB.createRoot(document.getElementById("root")).render(p.jsx(wie,{}));
