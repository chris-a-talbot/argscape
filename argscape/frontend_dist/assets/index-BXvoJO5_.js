var jL=Object.defineProperty;var LL=(t,e,n)=>e in t?jL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>LL(t,typeof e!="symbol"?e+"":e,n);function BL(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ng={exports:{}},Ol={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t3;function UL(){if(t3)return Ol;t3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return Ol.Fragment=e,Ol.jsx=n,Ol.jsxs=n,Ol}var n3;function FL(){return n3||(n3=1,Ng.exports=UL()),Ng.exports}var g=FL(),kg={exports:{}},Pl={},Mg={exports:{}},Ig={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r3;function zL(){return r3||(r3=1,function(t){function e(z,Q){var oe=z.length;z.push(Q);e:for(;0<oe;){var G=oe-1>>>1,D=z[G];if(0<i(D,Q))z[G]=Q,z[oe]=D,oe=G;else break e}}function n(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var Q=z[0],oe=z.pop();if(oe!==Q){z[0]=oe;e:for(var G=0,D=z.length,Y=D>>>1;G<Y;){var le=2*(G+1)-1,ie=z[le],F=le+1,X=z[F];if(0>i(ie,oe))F<D&&0>i(X,ie)?(z[G]=X,z[F]=oe,G=F):(z[G]=ie,z[le]=oe,G=le);else if(F<D&&0>i(X,oe))z[G]=X,z[F]=oe,G=F;else break e}}return Q}function i(z,Q){var oe=z.sortIndex-Q.sortIndex;return oe!==0?oe:z.id-Q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var u=[],d=[],h=1,m=null,_=3,y=!1,T=!1,w=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E(z){for(var Q=n(d);Q!==null;){if(Q.callback===null)r(d);else if(Q.startTime<=z)r(d),Q.sortIndex=Q.expirationTime,e(u,Q);else break;Q=n(d)}}function C(z){if(w=!1,E(z),!T)if(n(u)!==null)T=!0,O||(O=!0,$());else{var Q=n(d);Q!==null&&q(C,Q.startTime-z)}}var O=!1,P=-1,k=5,I=-1;function N(){return b?!0:!(t.unstable_now()-I<k)}function L(){if(b=!1,O){var z=t.unstable_now();I=z;var Q=!0;try{e:{T=!1,w&&(w=!1,A(P),P=-1),y=!0;var oe=_;try{t:{for(E(z),m=n(u);m!==null&&!(m.expirationTime>z&&N());){var G=m.callback;if(typeof G=="function"){m.callback=null,_=m.priorityLevel;var D=G(m.expirationTime<=z);if(z=t.unstable_now(),typeof D=="function"){m.callback=D,E(z),Q=!0;break t}m===n(u)&&r(u),E(z)}else r(u);m=n(u)}if(m!==null)Q=!0;else{var Y=n(d);Y!==null&&q(C,Y.startTime-z),Q=!1}}break e}finally{m=null,_=oe,y=!1}Q=void 0}}finally{Q?$():O=!1}}}var $;if(typeof R=="function")$=function(){R(L)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,V=Z.port2;Z.port1.onmessage=L,$=function(){V.postMessage(null)}}else $=function(){S(L,0)};function q(z,Q){P=S(function(){z(t.unstable_now())},Q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(z){switch(_){case 1:case 2:case 3:var Q=3;break;default:Q=_}var oe=_;_=Q;try{return z()}finally{_=oe}},t.unstable_requestPaint=function(){b=!0},t.unstable_runWithPriority=function(z,Q){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var oe=_;_=z;try{return Q()}finally{_=oe}},t.unstable_scheduleCallback=function(z,Q,oe){var G=t.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?G+oe:G):oe=G,z){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=oe+D,z={id:h++,callback:Q,priorityLevel:z,startTime:oe,expirationTime:D,sortIndex:-1},oe>G?(z.sortIndex=oe,e(d,z),n(u)===null&&z===n(d)&&(w?(A(P),P=-1):w=!0,q(C,oe-G))):(z.sortIndex=D,e(u,z),T||y||(T=!0,O||(O=!0,$()))),z},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(z){var Q=_;return function(){var oe=_;_=Q;try{return z.apply(this,arguments)}finally{_=oe}}}}(Ig)),Ig}var i3;function $L(){return i3||(i3=1,Mg.exports=zL()),Mg.exports}var Og={exports:{}},ze={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s3;function qL(){if(s3)return ze;s3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function _(D){return D===null||typeof D!="object"?null:(D=m&&D[m]||D["@@iterator"],typeof D=="function"?D:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function b(D,Y,le){this.props=D,this.context=Y,this.refs=w,this.updater=le||y}b.prototype.isReactComponent={},b.prototype.setState=function(D,Y){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,Y,"setState")},b.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function S(){}S.prototype=b.prototype;function A(D,Y,le){this.props=D,this.context=Y,this.refs=w,this.updater=le||y}var R=A.prototype=new S;R.constructor=A,T(R,b.prototype),R.isPureReactComponent=!0;var E=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function P(D,Y,le,ie,F,X){return le=X.ref,{$$typeof:t,type:D,key:Y,ref:le!==void 0?le:null,props:X}}function k(D,Y){return P(D.type,Y,void 0,void 0,void 0,D.props)}function I(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function N(D){var Y={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(le){return Y[le]})}var L=/\/+/g;function $(D,Y){return typeof D=="object"&&D!==null&&D.key!=null?N(""+D.key):Y.toString(36)}function Z(){}function V(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(Z,Z):(D.status="pending",D.then(function(Y){D.status==="pending"&&(D.status="fulfilled",D.value=Y)},function(Y){D.status==="pending"&&(D.status="rejected",D.reason=Y)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function q(D,Y,le,ie,F){var X=typeof D;(X==="undefined"||X==="boolean")&&(D=null);var J=!1;if(D===null)J=!0;else switch(X){case"bigint":case"string":case"number":J=!0;break;case"object":switch(D.$$typeof){case t:case e:J=!0;break;case h:return J=D._init,q(J(D._payload),Y,le,ie,F)}}if(J)return F=F(D),J=ie===""?"."+$(D,0):ie,E(F)?(le="",J!=null&&(le=J.replace(L,"$&/")+"/"),q(F,Y,le,"",function(Ae){return Ae})):F!=null&&(I(F)&&(F=k(F,le+(F.key==null||D&&D.key===F.key?"":(""+F.key).replace(L,"$&/")+"/")+J)),Y.push(F)),1;J=0;var pe=ie===""?".":ie+":";if(E(D))for(var ye=0;ye<D.length;ye++)ie=D[ye],X=pe+$(ie,ye),J+=q(ie,Y,le,X,F);else if(ye=_(D),typeof ye=="function")for(D=ye.call(D),ye=0;!(ie=D.next()).done;)ie=ie.value,X=pe+$(ie,ye++),J+=q(ie,Y,le,X,F);else if(X==="object"){if(typeof D.then=="function")return q(V(D),Y,le,ie,F);throw Y=String(D),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return J}function z(D,Y,le){if(D==null)return D;var ie=[],F=0;return q(D,ie,"","",function(X){return Y.call(le,X,F++)}),ie}function Q(D){if(D._status===-1){var Y=D._result;Y=Y(),Y.then(function(le){(D._status===0||D._status===-1)&&(D._status=1,D._result=le)},function(le){(D._status===0||D._status===-1)&&(D._status=2,D._result=le)}),D._status===-1&&(D._status=0,D._result=Y)}if(D._status===1)return D._result.default;throw D._result}var oe=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function G(){}return ze.Children={map:z,forEach:function(D,Y,le){z(D,function(){Y.apply(this,arguments)},le)},count:function(D){var Y=0;return z(D,function(){Y++}),Y},toArray:function(D){return z(D,function(Y){return Y})||[]},only:function(D){if(!I(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},ze.Component=b,ze.Fragment=n,ze.Profiler=i,ze.PureComponent=A,ze.StrictMode=r,ze.Suspense=u,ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,ze.__COMPILER_RUNTIME={__proto__:null,c:function(D){return C.H.useMemoCache(D)}},ze.cache=function(D){return function(){return D.apply(null,arguments)}},ze.cloneElement=function(D,Y,le){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var ie=T({},D.props),F=D.key,X=void 0;if(Y!=null)for(J in Y.ref!==void 0&&(X=void 0),Y.key!==void 0&&(F=""+Y.key),Y)!O.call(Y,J)||J==="key"||J==="__self"||J==="__source"||J==="ref"&&Y.ref===void 0||(ie[J]=Y[J]);var J=arguments.length-2;if(J===1)ie.children=le;else if(1<J){for(var pe=Array(J),ye=0;ye<J;ye++)pe[ye]=arguments[ye+2];ie.children=pe}return P(D.type,F,void 0,void 0,X,ie)},ze.createContext=function(D){return D={$$typeof:o,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:s,_context:D},D},ze.createElement=function(D,Y,le){var ie,F={},X=null;if(Y!=null)for(ie in Y.key!==void 0&&(X=""+Y.key),Y)O.call(Y,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(F[ie]=Y[ie]);var J=arguments.length-2;if(J===1)F.children=le;else if(1<J){for(var pe=Array(J),ye=0;ye<J;ye++)pe[ye]=arguments[ye+2];F.children=pe}if(D&&D.defaultProps)for(ie in J=D.defaultProps,J)F[ie]===void 0&&(F[ie]=J[ie]);return P(D,X,void 0,void 0,null,F)},ze.createRef=function(){return{current:null}},ze.forwardRef=function(D){return{$$typeof:l,render:D}},ze.isValidElement=I,ze.lazy=function(D){return{$$typeof:h,_payload:{_status:-1,_result:D},_init:Q}},ze.memo=function(D,Y){return{$$typeof:d,type:D,compare:Y===void 0?null:Y}},ze.startTransition=function(D){var Y=C.T,le={};C.T=le;try{var ie=D(),F=C.S;F!==null&&F(le,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(G,oe)}catch(X){oe(X)}finally{C.T=Y}},ze.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},ze.use=function(D){return C.H.use(D)},ze.useActionState=function(D,Y,le){return C.H.useActionState(D,Y,le)},ze.useCallback=function(D,Y){return C.H.useCallback(D,Y)},ze.useContext=function(D){return C.H.useContext(D)},ze.useDebugValue=function(){},ze.useDeferredValue=function(D,Y){return C.H.useDeferredValue(D,Y)},ze.useEffect=function(D,Y,le){var ie=C.H;if(typeof le=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(D,Y)},ze.useId=function(){return C.H.useId()},ze.useImperativeHandle=function(D,Y,le){return C.H.useImperativeHandle(D,Y,le)},ze.useInsertionEffect=function(D,Y){return C.H.useInsertionEffect(D,Y)},ze.useLayoutEffect=function(D,Y){return C.H.useLayoutEffect(D,Y)},ze.useMemo=function(D,Y){return C.H.useMemo(D,Y)},ze.useOptimistic=function(D,Y){return C.H.useOptimistic(D,Y)},ze.useReducer=function(D,Y,le){return C.H.useReducer(D,Y,le)},ze.useRef=function(D){return C.H.useRef(D)},ze.useState=function(D){return C.H.useState(D)},ze.useSyncExternalStore=function(D,Y,le){return C.H.useSyncExternalStore(D,Y,le)},ze.useTransition=function(){return C.H.useTransition()},ze.version="19.1.0",ze}var a3;function n1(){return a3||(a3=1,Og.exports=qL()),Og.exports}var Pg={exports:{}},vn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o3;function VL(){if(o3)return vn;o3=1;var t=n1();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:m==null?null:""+m,children:u,containerInfo:d,implementation:h}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return vn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,vn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},vn.flushSync=function(u){var d=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=d,r.p=h,r.d.f()}},vn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},vn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},vn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,m=l(h,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:_,fetchPriority:y}):h==="script"&&r.d.X(u,{crossOrigin:m,integrity:_,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},vn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},vn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,m=l(h,d.crossOrigin);r.d.L(u,h,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},vn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},vn.requestFormReset=function(u){r.d.r(u)},vn.unstable_batchedUpdates=function(u,d){return u(d)},vn.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},vn.useFormStatus=function(){return o.H.useHostTransitionStatus()},vn.version="19.1.0",vn}var l3;function B4(){if(l3)return Pg.exports;l3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Pg.exports=VL(),Pg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c3;function HL(){if(c3)return Pl;c3=1;var t=$L(),e=n1(),n=B4();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,p=c;;){var v=f.return;if(v===null)break;var x=v.alternate;if(x===null){if(p=v.return,p!==null){f=p;continue}break}if(v.child===x.child){for(x=v.child;x;){if(x===f)return l(v),a;if(x===p)return l(v),c;x=x.sibling}throw Error(r(188))}if(f.return!==p.return)f=v,p=x;else{for(var M=!1,U=v.child;U;){if(U===f){M=!0,f=v,p=x;break}if(U===p){M=!0,p=v,f=x;break}U=U.sibling}if(!M){for(U=x.child;U;){if(U===f){M=!0,f=x,p=v;break}if(U===p){M=!0,p=x,f=v;break}U=U.sibling}if(!M)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function d(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=d(a),c!==null)return c;a=a.sibling}return null}var h=Object.assign,m=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function $(a){return a===null||typeof a!="object"?null:(a=L&&a[L]||a["@@iterator"],typeof a=="function"?a:null)}var Z=Symbol.for("react.client.reference");function V(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case b:return"Profiler";case w:return"StrictMode";case C:return"Suspense";case O:return"SuspenseList";case I:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case R:return(a.displayName||"Context")+".Provider";case A:return(a._context.displayName||"Context")+".Consumer";case E:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case P:return c=a.displayName||null,c!==null?c:V(a.type)||"Memo";case k:c=a._payload,a=a._init;try{return V(a(c))}catch{}}return null}var q=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},G=[],D=-1;function Y(a){return{current:a}}function le(a){0>D||(a.current=G[D],G[D]=null,D--)}function ie(a,c){D++,G[D]=a.current,a.current=c}var F=Y(null),X=Y(null),J=Y(null),pe=Y(null);function ye(a,c){switch(ie(J,c),ie(X,a),ie(F,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?NS(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=NS(c),a=kS(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}le(F),ie(F,a)}function Ae(){le(F),le(X),le(J)}function Oe(a){a.memoizedState!==null&&ie(pe,a);var c=F.current,f=kS(c,a.type);c!==f&&(ie(X,a),ie(F,f))}function Ue(a){X.current===a&&(le(F),le(X)),pe.current===a&&(le(pe),Cl._currentValue=oe)}var Ee=Object.prototype.hasOwnProperty,Te=t.unstable_scheduleCallback,Ne=t.unstable_cancelCallback,Pe=t.unstable_shouldYield,Kt=t.unstable_requestPaint,Me=t.unstable_now,nn=t.unstable_getCurrentPriorityLevel,Mt=t.unstable_ImmediatePriority,Rt=t.unstable_UserBlockingPriority,Ke=t.unstable_NormalPriority,rn=t.unstable_LowPriority,Ye=t.unstable_IdlePriority,be=t.log,ke=t.unstable_setDisableYieldValue,rt=null,He=null;function Qe(a){if(typeof be=="function"&&ke(a),He&&typeof He.setStrictMode=="function")try{He.setStrictMode(rt,a)}catch{}}var xt=Math.clz32?Math.clz32:vr,gn=Math.log,Kr=Math.LN2;function vr(a){return a>>>=0,a===0?32:31-(gn(a)/Kr|0)|0}var Ft=256,zt=4194304;function kn(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function yr(a,c,f){var p=a.pendingLanes;if(p===0)return 0;var v=0,x=a.suspendedLanes,M=a.pingedLanes;a=a.warmLanes;var U=p&134217727;return U!==0?(p=U&~x,p!==0?v=kn(p):(M&=U,M!==0?v=kn(M):f||(f=U&~a,f!==0&&(v=kn(f))))):(U=p&~x,U!==0?v=kn(U):M!==0?v=kn(M):f||(f=p&~a,f!==0&&(v=kn(f)))),v===0?0:c!==0&&c!==v&&(c&x)===0&&(x=v&-v,f=c&-c,x>=f||x===32&&(f&4194048)!==0)?c:v}function Qn(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function we(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lt(){var a=Ft;return Ft<<=1,(Ft&4194048)===0&&(Ft=256),a}function Ct(){var a=zt;return zt<<=1,(zt&62914560)===0&&(zt=4194304),a}function it(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function bt(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function oa(a,c,f,p,v,x){var M=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var U=a.entanglements,K=a.expirationTimes,fe=a.hiddenUpdates;for(f=M&~f;0<f;){var ge=31-xt(f),ve=1<<ge;U[ge]=0,K[ge]=-1;var de=fe[ge];if(de!==null)for(fe[ge]=null,ge=0;ge<de.length;ge++){var he=de[ge];he!==null&&(he.lane&=-536870913)}f&=~ve}p!==0&&Bo(a,p,0),x!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=x&~(M&~c))}function Bo(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-xt(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|f&4194090}function g2(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var p=31-xt(f),v=1<<p;v&c|a[p]&c&&(a[p]|=c),f&=~v}}function yh(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function xh(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function m2(){var a=Q.p;return a!==0?a:(a=window.event,a===void 0?32:GS(a.type))}function Ej(a,c){var f=Q.p;try{return Q.p=a,c()}finally{Q.p=f}}var wi=Math.random().toString(36).slice(2),mn="__reactFiber$"+wi,Mn="__reactProps$"+wi,la="__reactContainer$"+wi,bh="__reactEvents$"+wi,Aj="__reactListeners$"+wi,Rj="__reactHandles$"+wi,_2="__reactResources$"+wi,Uo="__reactMarker$"+wi;function wh(a){delete a[mn],delete a[Mn],delete a[bh],delete a[Aj],delete a[Rj]}function ca(a){var c=a[mn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[la]||f[mn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=PS(a);a!==null;){if(f=a[mn])return f;a=PS(a)}return c}a=f,f=a.parentNode}return null}function ua(a){if(a=a[mn]||a[la]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function Fo(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function fa(a){var c=a[_2];return c||(c=a[_2]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function sn(a){a[Uo]=!0}var v2=new Set,y2={};function fs(a,c){da(a,c),da(a+"Capture",c)}function da(a,c){for(y2[a]=c,a=0;a<c.length;a++)v2.add(c[a])}var Cj=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),x2={},b2={};function Nj(a){return Ee.call(b2,a)?!0:Ee.call(x2,a)?!1:Cj.test(a)?b2[a]=!0:(x2[a]=!0,!1)}function $c(a,c,f){if(Nj(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function qc(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function Zr(a,c,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+p)}}var Th,w2;function ha(a){if(Th===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);Th=c&&c[1]||"",w2=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Th+a+w2}var Sh=!1;function Eh(a,c){if(!a||Sh)return"";Sh=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(he){var de=he}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(he){de=he}a.call(ve.prototype)}}else{try{throw Error()}catch(he){de=he}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(he){if(he&&de&&typeof he.stack=="string")return[he.stack,de.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=p.DetermineComponentFrameRoot(),M=x[0],U=x[1];if(M&&U){var K=M.split(`
`),fe=U.split(`
`);for(v=p=0;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;for(;v<fe.length&&!fe[v].includes("DetermineComponentFrameRoot");)v++;if(p===K.length||v===fe.length)for(p=K.length-1,v=fe.length-1;1<=p&&0<=v&&K[p]!==fe[v];)v--;for(;1<=p&&0<=v;p--,v--)if(K[p]!==fe[v]){if(p!==1||v!==1)do if(p--,v--,0>v||K[p]!==fe[v]){var ge=`
`+K[p].replace(" at new "," at ");return a.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",a.displayName)),ge}while(1<=p&&0<=v);break}}}finally{Sh=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?ha(f):""}function kj(a){switch(a.tag){case 26:case 27:case 5:return ha(a.type);case 16:return ha("Lazy");case 13:return ha("Suspense");case 19:return ha("SuspenseList");case 0:case 15:return Eh(a.type,!1);case 11:return Eh(a.type.render,!1);case 1:return Eh(a.type,!0);case 31:return ha("Activity");default:return""}}function T2(a){try{var c="";do c+=kj(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Jn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function S2(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Mj(a){var c=S2(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),p=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,x=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(M){p=""+M,x.call(this,M)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(M){p=""+M},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Vc(a){a._valueTracker||(a._valueTracker=Mj(a))}function E2(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return a&&(p=S2(a)?a.checked?"true":"false":a.value),a=p,a!==f?(c.setValue(a),!0):!1}function Hc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ij=/[\n"\\]/g;function er(a){return a.replace(Ij,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Ah(a,c,f,p,v,x,M,U){a.name="",M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?a.type=M:a.removeAttribute("type"),c!=null?M==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Jn(c)):a.value!==""+Jn(c)&&(a.value=""+Jn(c)):M!=="submit"&&M!=="reset"||a.removeAttribute("value"),c!=null?Rh(a,M,Jn(c)):f!=null?Rh(a,M,Jn(f)):p!=null&&a.removeAttribute("value"),v==null&&x!=null&&(a.defaultChecked=!!x),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?a.name=""+Jn(U):a.removeAttribute("name")}function A2(a,c,f,p,v,x,M,U){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(a.type=x),c!=null||f!=null){if(!(x!=="submit"&&x!=="reset"||c!=null))return;f=f!=null?""+Jn(f):"",c=c!=null?""+Jn(c):f,U||c===a.value||(a.value=c),a.defaultValue=c}p=p??v,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=U?a.checked:!!p,a.defaultChecked=!!p,M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.name=M)}function Rh(a,c,f){c==="number"&&Hc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function pa(a,c,f,p){if(a=a.options,c){c={};for(var v=0;v<f.length;v++)c["$"+f[v]]=!0;for(f=0;f<a.length;f++)v=c.hasOwnProperty("$"+a[f].value),a[f].selected!==v&&(a[f].selected=v),v&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Jn(f),c=null,v=0;v<a.length;v++){if(a[v].value===f){a[v].selected=!0,p&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function R2(a,c,f){if(c!=null&&(c=""+Jn(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Jn(f):""}function C2(a,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(q(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Jn(c),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p)}function ga(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var Oj=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function N2(a,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,f):typeof f!="number"||f===0||Oj.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function k2(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var v in c)p=c[v],c.hasOwnProperty(v)&&f[v]!==p&&N2(a,v,p)}else for(var x in c)c.hasOwnProperty(x)&&N2(a,x,c[x])}function Ch(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pj=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Dj=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wc(a){return Dj.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Nh=null;function kh(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ma=null,_a=null;function M2(a){var c=ua(a);if(c&&(a=c.stateNode)){var f=a[Mn]||null;e:switch(a=c.stateNode,c.type){case"input":if(Ah(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+er(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==a&&p.form===a.form){var v=p[Mn]||null;if(!v)throw Error(r(90));Ah(p,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===a.form&&E2(p)}break e;case"textarea":R2(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&pa(a,!!f.multiple,c,!1)}}}var Mh=!1;function I2(a,c,f){if(Mh)return a(c,f);Mh=!0;try{var p=a(c);return p}finally{if(Mh=!1,(ma!==null||_a!==null)&&(Mu(),ma&&(c=ma,a=_a,_a=ma=null,M2(c),a)))for(c=0;c<a.length;c++)M2(a[c])}}function zo(a,c){var f=a.stateNode;if(f===null)return null;var p=f[Mn]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var Qr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ih=!1;if(Qr)try{var $o={};Object.defineProperty($o,"passive",{get:function(){Ih=!0}}),window.addEventListener("test",$o,$o),window.removeEventListener("test",$o,$o)}catch{Ih=!1}var Ti=null,Oh=null,Xc=null;function O2(){if(Xc)return Xc;var a,c=Oh,f=c.length,p,v="value"in Ti?Ti.value:Ti.textContent,x=v.length;for(a=0;a<f&&c[a]===v[a];a++);var M=f-a;for(p=1;p<=M&&c[f-p]===v[x-p];p++);return Xc=v.slice(a,1<p?1-p:void 0)}function Yc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Gc(){return!0}function P2(){return!1}function In(a){function c(f,p,v,x,M){this._reactName=f,this._targetInst=v,this.type=p,this.nativeEvent=x,this.target=M,this.currentTarget=null;for(var U in a)a.hasOwnProperty(U)&&(f=a[U],this[U]=f?f(x):x[U]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Gc:P2,this.isPropagationStopped=P2,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Gc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Gc)},persist:function(){},isPersistent:Gc}),c}var ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kc=In(ds),qo=h({},ds,{view:0,detail:0}),jj=In(qo),Ph,Dh,Vo,Zc=h({},qo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Vo&&(Vo&&a.type==="mousemove"?(Ph=a.screenX-Vo.screenX,Dh=a.screenY-Vo.screenY):Dh=Ph=0,Vo=a),Ph)},movementY:function(a){return"movementY"in a?a.movementY:Dh}}),D2=In(Zc),Lj=h({},Zc,{dataTransfer:0}),Bj=In(Lj),Uj=h({},qo,{relatedTarget:0}),jh=In(Uj),Fj=h({},ds,{animationName:0,elapsedTime:0,pseudoElement:0}),zj=In(Fj),$j=h({},ds,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),qj=In($j),Vj=h({},ds,{data:0}),j2=In(Vj),Hj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yj(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Xj[a])?!!c[a]:!1}function Lh(){return Yj}var Gj=h({},qo,{key:function(a){if(a.key){var c=Hj[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Yc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Wj[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lh,charCode:function(a){return a.type==="keypress"?Yc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Yc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Kj=In(Gj),Zj=h({},Zc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),L2=In(Zj),Qj=h({},qo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lh}),Jj=In(Qj),e6=h({},ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),t6=In(e6),n6=h({},Zc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),r6=In(n6),i6=h({},ds,{newState:0,oldState:0}),s6=In(i6),a6=[9,13,27,32],Bh=Qr&&"CompositionEvent"in window,Ho=null;Qr&&"documentMode"in document&&(Ho=document.documentMode);var o6=Qr&&"TextEvent"in window&&!Ho,B2=Qr&&(!Bh||Ho&&8<Ho&&11>=Ho),U2=" ",F2=!1;function z2(a,c){switch(a){case"keyup":return a6.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $2(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var va=!1;function l6(a,c){switch(a){case"compositionend":return $2(c);case"keypress":return c.which!==32?null:(F2=!0,U2);case"textInput":return a=c.data,a===U2&&F2?null:a;default:return null}}function c6(a,c){if(va)return a==="compositionend"||!Bh&&z2(a,c)?(a=O2(),Xc=Oh=Ti=null,va=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return B2&&c.locale!=="ko"?null:c.data;default:return null}}var u6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q2(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!u6[a.type]:c==="textarea"}function V2(a,c,f,p){ma?_a?_a.push(p):_a=[p]:ma=p,c=Lu(c,"onChange"),0<c.length&&(f=new Kc("onChange","change",null,f,p),a.push({event:f,listeners:c}))}var Wo=null,Xo=null;function f6(a){SS(a,0)}function Qc(a){var c=Fo(a);if(E2(c))return a}function H2(a,c){if(a==="change")return c}var W2=!1;if(Qr){var Uh;if(Qr){var Fh="oninput"in document;if(!Fh){var X2=document.createElement("div");X2.setAttribute("oninput","return;"),Fh=typeof X2.oninput=="function"}Uh=Fh}else Uh=!1;W2=Uh&&(!document.documentMode||9<document.documentMode)}function Y2(){Wo&&(Wo.detachEvent("onpropertychange",G2),Xo=Wo=null)}function G2(a){if(a.propertyName==="value"&&Qc(Xo)){var c=[];V2(c,Xo,a,kh(a)),I2(f6,c)}}function d6(a,c,f){a==="focusin"?(Y2(),Wo=c,Xo=f,Wo.attachEvent("onpropertychange",G2)):a==="focusout"&&Y2()}function h6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Qc(Xo)}function p6(a,c){if(a==="click")return Qc(c)}function g6(a,c){if(a==="input"||a==="change")return Qc(c)}function m6(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Bn=typeof Object.is=="function"?Object.is:m6;function Yo(a,c){if(Bn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var v=f[p];if(!Ee.call(c,v)||!Bn(a[v],c[v]))return!1}return!0}function K2(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Z2(a,c){var f=K2(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=c&&p>=c)return{node:f,offset:c-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=K2(f)}}function Q2(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?Q2(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function J2(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Hc(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=Hc(a.document)}return c}function zh(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var _6=Qr&&"documentMode"in document&&11>=document.documentMode,ya=null,$h=null,Go=null,qh=!1;function ew(a,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;qh||ya==null||ya!==Hc(p)||(p=ya,"selectionStart"in p&&zh(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Go&&Yo(Go,p)||(Go=p,p=Lu($h,"onSelect"),0<p.length&&(c=new Kc("onSelect","select",null,c,f),a.push({event:c,listeners:p}),c.target=ya)))}function hs(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var xa={animationend:hs("Animation","AnimationEnd"),animationiteration:hs("Animation","AnimationIteration"),animationstart:hs("Animation","AnimationStart"),transitionrun:hs("Transition","TransitionRun"),transitionstart:hs("Transition","TransitionStart"),transitioncancel:hs("Transition","TransitionCancel"),transitionend:hs("Transition","TransitionEnd")},Vh={},tw={};Qr&&(tw=document.createElement("div").style,"AnimationEvent"in window||(delete xa.animationend.animation,delete xa.animationiteration.animation,delete xa.animationstart.animation),"TransitionEvent"in window||delete xa.transitionend.transition);function ps(a){if(Vh[a])return Vh[a];if(!xa[a])return a;var c=xa[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in tw)return Vh[a]=c[f];return a}var nw=ps("animationend"),rw=ps("animationiteration"),iw=ps("animationstart"),v6=ps("transitionrun"),y6=ps("transitionstart"),x6=ps("transitioncancel"),sw=ps("transitionend"),aw=new Map,Hh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Hh.push("scrollEnd");function xr(a,c){aw.set(a,c),fs(c,[a])}var ow=new WeakMap;function tr(a,c){if(typeof a=="object"&&a!==null){var f=ow.get(a);return f!==void 0?f:(c={value:a,source:c,stack:T2(c)},ow.set(a,c),c)}return{value:a,source:c,stack:T2(c)}}var nr=[],ba=0,Wh=0;function Jc(){for(var a=ba,c=Wh=ba=0;c<a;){var f=nr[c];nr[c++]=null;var p=nr[c];nr[c++]=null;var v=nr[c];nr[c++]=null;var x=nr[c];if(nr[c++]=null,p!==null&&v!==null){var M=p.pending;M===null?v.next=v:(v.next=M.next,M.next=v),p.pending=v}x!==0&&lw(f,v,x)}}function eu(a,c,f,p){nr[ba++]=a,nr[ba++]=c,nr[ba++]=f,nr[ba++]=p,Wh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function Xh(a,c,f,p){return eu(a,c,f,p),tu(a)}function wa(a,c){return eu(a,null,null,c),tu(a)}function lw(a,c,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var v=!1,x=a.return;x!==null;)x.childLanes|=f,p=x.alternate,p!==null&&(p.childLanes|=f),x.tag===22&&(a=x.stateNode,a===null||a._visibility&1||(v=!0)),a=x,x=x.return;return a.tag===3?(x=a.stateNode,v&&c!==null&&(v=31-xt(f),a=x.hiddenUpdates,p=a[v],p===null?a[v]=[c]:p.push(c),c.lane=f|536870912),x):null}function tu(a){if(50<xl)throw xl=0,Jp=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var Ta={};function b6(a,c,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Un(a,c,f,p){return new b6(a,c,f,p)}function Yh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Jr(a,c){var f=a.alternate;return f===null?(f=Un(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function cw(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function nu(a,c,f,p,v,x){var M=0;if(p=a,typeof a=="function")Yh(a)&&(M=1);else if(typeof a=="string")M=TL(a,f,F.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case I:return a=Un(31,f,c,v),a.elementType=I,a.lanes=x,a;case T:return gs(f.children,v,x,c);case w:M=8,v|=24;break;case b:return a=Un(12,f,c,v|2),a.elementType=b,a.lanes=x,a;case C:return a=Un(13,f,c,v),a.elementType=C,a.lanes=x,a;case O:return a=Un(19,f,c,v),a.elementType=O,a.lanes=x,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case S:case R:M=10;break e;case A:M=9;break e;case E:M=11;break e;case P:M=14;break e;case k:M=16,p=null;break e}M=29,f=Error(r(130,a===null?"null":typeof a,"")),p=null}return c=Un(M,f,c,v),c.elementType=a,c.type=p,c.lanes=x,c}function gs(a,c,f,p){return a=Un(7,a,p,c),a.lanes=f,a}function Gh(a,c,f){return a=Un(6,a,null,c),a.lanes=f,a}function Kh(a,c,f){return c=Un(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Sa=[],Ea=0,ru=null,iu=0,rr=[],ir=0,ms=null,ei=1,ti="";function _s(a,c){Sa[Ea++]=iu,Sa[Ea++]=ru,ru=a,iu=c}function uw(a,c,f){rr[ir++]=ei,rr[ir++]=ti,rr[ir++]=ms,ms=a;var p=ei;a=ti;var v=32-xt(p)-1;p&=~(1<<v),f+=1;var x=32-xt(c)+v;if(30<x){var M=v-v%5;x=(p&(1<<M)-1).toString(32),p>>=M,v-=M,ei=1<<32-xt(c)+v|f<<v|p,ti=x+a}else ei=1<<x|f<<v|p,ti=a}function Zh(a){a.return!==null&&(_s(a,1),uw(a,1,0))}function Qh(a){for(;a===ru;)ru=Sa[--Ea],Sa[Ea]=null,iu=Sa[--Ea],Sa[Ea]=null;for(;a===ms;)ms=rr[--ir],rr[ir]=null,ti=rr[--ir],rr[ir]=null,ei=rr[--ir],rr[ir]=null}var Sn=null,It=null,Je=!1,vs=null,Pr=!1,Jh=Error(r(519));function ys(a){var c=Error(r(418,""));throw Qo(tr(c,a)),Jh}function fw(a){var c=a.stateNode,f=a.type,p=a.memoizedProps;switch(c[mn]=a,c[Mn]=p,f){case"dialog":Xe("cancel",c),Xe("close",c);break;case"iframe":case"object":case"embed":Xe("load",c);break;case"video":case"audio":for(f=0;f<wl.length;f++)Xe(wl[f],c);break;case"source":Xe("error",c);break;case"img":case"image":case"link":Xe("error",c),Xe("load",c);break;case"details":Xe("toggle",c);break;case"input":Xe("invalid",c),A2(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Vc(c);break;case"select":Xe("invalid",c);break;case"textarea":Xe("invalid",c),C2(c,p.value,p.defaultValue,p.children),Vc(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||CS(c.textContent,f)?(p.popover!=null&&(Xe("beforetoggle",c),Xe("toggle",c)),p.onScroll!=null&&Xe("scroll",c),p.onScrollEnd!=null&&Xe("scrollend",c),p.onClick!=null&&(c.onclick=Bu),c=!0):c=!1,c||ys(a)}function dw(a){for(Sn=a.return;Sn;)switch(Sn.tag){case 5:case 13:Pr=!1;return;case 27:case 3:Pr=!0;return;default:Sn=Sn.return}}function Ko(a){if(a!==Sn)return!1;if(!Je)return dw(a),Je=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||gg(a.type,a.memoizedProps)),f=!f),f&&It&&ys(a),dw(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){It=wr(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}It=null}}else c===27?(c=It,Ui(a.type)?(a=yg,yg=null,It=a):It=c):It=Sn?wr(a.stateNode.nextSibling):null;return!0}function Zo(){It=Sn=null,Je=!1}function hw(){var a=vs;return a!==null&&(Dn===null?Dn=a:Dn.push.apply(Dn,a),vs=null),a}function Qo(a){vs===null?vs=[a]:vs.push(a)}var ep=Y(null),xs=null,ni=null;function Si(a,c,f){ie(ep,c._currentValue),c._currentValue=f}function ri(a){a._currentValue=ep.current,le(ep)}function tp(a,c,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===f)break;a=a.return}}function np(a,c,f,p){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var x=v.dependencies;if(x!==null){var M=v.child;x=x.firstContext;e:for(;x!==null;){var U=x;x=v;for(var K=0;K<c.length;K++)if(U.context===c[K]){x.lanes|=f,U=x.alternate,U!==null&&(U.lanes|=f),tp(x.return,f,a),p||(M=null);break e}x=U.next}}else if(v.tag===18){if(M=v.return,M===null)throw Error(r(341));M.lanes|=f,x=M.alternate,x!==null&&(x.lanes|=f),tp(M,f,a),M=null}else M=v.child;if(M!==null)M.return=v;else for(M=v;M!==null;){if(M===a){M=null;break}if(v=M.sibling,v!==null){v.return=M.return,M=v;break}M=M.return}v=M}}function Jo(a,c,f,p){a=null;for(var v=c,x=!1;v!==null;){if(!x){if((v.flags&524288)!==0)x=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var M=v.alternate;if(M===null)throw Error(r(387));if(M=M.memoizedProps,M!==null){var U=v.type;Bn(v.pendingProps.value,M.value)||(a!==null?a.push(U):a=[U])}}else if(v===pe.current){if(M=v.alternate,M===null)throw Error(r(387));M.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(Cl):a=[Cl])}v=v.return}a!==null&&np(c,a,f,p),c.flags|=262144}function su(a){for(a=a.firstContext;a!==null;){if(!Bn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function bs(a){xs=a,ni=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function _n(a){return pw(xs,a)}function au(a,c){return xs===null&&bs(a),pw(a,c)}function pw(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},ni===null){if(a===null)throw Error(r(308));ni=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else ni=ni.next=c;return f}var w6=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},T6=t.unstable_scheduleCallback,S6=t.unstable_NormalPriority,Zt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rp(){return{controller:new w6,data:new Map,refCount:0}}function el(a){a.refCount--,a.refCount===0&&T6(S6,function(){a.controller.abort()})}var tl=null,ip=0,Aa=0,Ra=null;function E6(a,c){if(tl===null){var f=tl=[];ip=0,Aa=ag(),Ra={status:"pending",value:void 0,then:function(p){f.push(p)}}}return ip++,c.then(gw,gw),c}function gw(){if(--ip===0&&tl!==null){Ra!==null&&(Ra.status="fulfilled");var a=tl;tl=null,Aa=0,Ra=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function A6(a,c){var f=[],p={status:"pending",value:null,reason:null,then:function(v){f.push(v)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var v=0;v<f.length;v++)(0,f[v])(c)},function(v){for(p.status="rejected",p.reason=v,v=0;v<f.length;v++)(0,f[v])(void 0)}),p}var mw=z.S;z.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&E6(a,c),mw!==null&&mw(a,c)};var ws=Y(null);function sp(){var a=ws.current;return a!==null?a:vt.pooledCache}function ou(a,c){c===null?ie(ws,ws.current):ie(ws,c.pool)}function _w(){var a=sp();return a===null?null:{parent:Zt._currentValue,pool:a}}var nl=Error(r(460)),vw=Error(r(474)),lu=Error(r(542)),ap={then:function(){}};function yw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function cu(){}function xw(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(cu,cu),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,ww(a),a;default:if(typeof c.status=="string")c.then(cu,cu);else{if(a=vt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=p}},function(p){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,ww(a),a}throw rl=c,nl}}var rl=null;function bw(){if(rl===null)throw Error(r(459));var a=rl;return rl=null,a}function ww(a){if(a===nl||a===lu)throw Error(r(483))}var Ei=!1;function op(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function lp(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ai(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ri(a,c,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(at&2)!==0){var v=p.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),p.pending=c,c=tu(a),lw(a,null,f),c}return eu(a,p,c,f),tu(a)}function il(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,g2(a,f)}}function cp(a,c){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var v=null,x=null;if(f=f.firstBaseUpdate,f!==null){do{var M={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};x===null?v=x=M:x=x.next=M,f=f.next}while(f!==null);x===null?v=x=c:x=x.next=c}else v=x=c;f={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:x,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var up=!1;function sl(){if(up){var a=Ra;if(a!==null)throw a}}function al(a,c,f,p){up=!1;var v=a.updateQueue;Ei=!1;var x=v.firstBaseUpdate,M=v.lastBaseUpdate,U=v.shared.pending;if(U!==null){v.shared.pending=null;var K=U,fe=K.next;K.next=null,M===null?x=fe:M.next=fe,M=K;var ge=a.alternate;ge!==null&&(ge=ge.updateQueue,U=ge.lastBaseUpdate,U!==M&&(U===null?ge.firstBaseUpdate=fe:U.next=fe,ge.lastBaseUpdate=K))}if(x!==null){var ve=v.baseState;M=0,ge=fe=K=null,U=x;do{var de=U.lane&-536870913,he=de!==U.lane;if(he?(Ge&de)===de:(p&de)===de){de!==0&&de===Aa&&(up=!0),ge!==null&&(ge=ge.next={lane:0,tag:U.tag,payload:U.payload,callback:null,next:null});e:{var Be=a,De=U;de=c;var ft=f;switch(De.tag){case 1:if(Be=De.payload,typeof Be=="function"){ve=Be.call(ft,ve,de);break e}ve=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=De.payload,de=typeof Be=="function"?Be.call(ft,ve,de):Be,de==null)break e;ve=h({},ve,de);break e;case 2:Ei=!0}}de=U.callback,de!==null&&(a.flags|=64,he&&(a.flags|=8192),he=v.callbacks,he===null?v.callbacks=[de]:he.push(de))}else he={lane:de,tag:U.tag,payload:U.payload,callback:U.callback,next:null},ge===null?(fe=ge=he,K=ve):ge=ge.next=he,M|=de;if(U=U.next,U===null){if(U=v.shared.pending,U===null)break;he=U,U=he.next,he.next=null,v.lastBaseUpdate=he,v.shared.pending=null}}while(!0);ge===null&&(K=ve),v.baseState=K,v.firstBaseUpdate=fe,v.lastBaseUpdate=ge,x===null&&(v.shared.lanes=0),Di|=M,a.lanes=M,a.memoizedState=ve}}function Tw(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function Sw(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)Tw(f[a],c)}var Ca=Y(null),uu=Y(0);function Ew(a,c){a=ui,ie(uu,a),ie(Ca,c),ui=a|c.baseLanes}function fp(){ie(uu,ui),ie(Ca,Ca.current)}function dp(){ui=uu.current,le(Ca),le(uu)}var Ci=0,qe=null,ct=null,$t=null,fu=!1,Na=!1,Ts=!1,du=0,ol=0,ka=null,R6=0;function Bt(){throw Error(r(321))}function hp(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!Bn(a[f],c[f]))return!1;return!0}function pp(a,c,f,p,v,x){return Ci=x,qe=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,z.H=a===null||a.memoizedState===null?lT:cT,Ts=!1,x=f(p,v),Ts=!1,Na&&(x=Rw(c,f,p,v)),Aw(a),x}function Aw(a){z.H=vu;var c=ct!==null&&ct.next!==null;if(Ci=0,$t=ct=qe=null,fu=!1,ol=0,ka=null,c)throw Error(r(300));a===null||an||(a=a.dependencies,a!==null&&su(a)&&(an=!0))}function Rw(a,c,f,p){qe=a;var v=0;do{if(Na&&(ka=null),ol=0,Na=!1,25<=v)throw Error(r(301));if(v+=1,$t=ct=null,a.updateQueue!=null){var x=a.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}z.H=P6,x=c(f,p)}while(Na);return x}function C6(){var a=z.H,c=a.useState()[0];return c=typeof c.then=="function"?ll(c):c,a=a.useState()[0],(ct!==null?ct.memoizedState:null)!==a&&(qe.flags|=1024),c}function gp(){var a=du!==0;return du=0,a}function mp(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function _p(a){if(fu){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}fu=!1}Ci=0,$t=ct=qe=null,Na=!1,ol=du=0,ka=null}function On(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?qe.memoizedState=$t=a:$t=$t.next=a,$t}function qt(){if(ct===null){var a=qe.alternate;a=a!==null?a.memoizedState:null}else a=ct.next;var c=$t===null?qe.memoizedState:$t.next;if(c!==null)$t=c,ct=a;else{if(a===null)throw qe.alternate===null?Error(r(467)):Error(r(310));ct=a,a={memoizedState:ct.memoizedState,baseState:ct.baseState,baseQueue:ct.baseQueue,queue:ct.queue,next:null},$t===null?qe.memoizedState=$t=a:$t=$t.next=a}return $t}function vp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ll(a){var c=ol;return ol+=1,ka===null&&(ka=[]),a=xw(ka,a,c),c=qe,($t===null?c.memoizedState:$t.next)===null&&(c=c.alternate,z.H=c===null||c.memoizedState===null?lT:cT),a}function hu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return ll(a);if(a.$$typeof===R)return _n(a)}throw Error(r(438,String(a)))}function yp(a){var c=null,f=qe.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=qe.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=vp(),qe.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),p=0;p<a;p++)f[p]=N;return c.index++,f}function ii(a,c){return typeof c=="function"?c(a):c}function pu(a){var c=qt();return xp(c,ct,a)}function xp(a,c,f){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var v=a.baseQueue,x=p.pending;if(x!==null){if(v!==null){var M=v.next;v.next=x.next,x.next=M}c.baseQueue=v=x,p.pending=null}if(x=a.baseState,v===null)a.memoizedState=x;else{c=v.next;var U=M=null,K=null,fe=c,ge=!1;do{var ve=fe.lane&-536870913;if(ve!==fe.lane?(Ge&ve)===ve:(Ci&ve)===ve){var de=fe.revertLane;if(de===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),ve===Aa&&(ge=!0);else if((Ci&de)===de){fe=fe.next,de===Aa&&(ge=!0);continue}else ve={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(U=K=ve,M=x):K=K.next=ve,qe.lanes|=de,Di|=de;ve=fe.action,Ts&&f(x,ve),x=fe.hasEagerState?fe.eagerState:f(x,ve)}else de={lane:ve,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(U=K=de,M=x):K=K.next=de,qe.lanes|=ve,Di|=ve;fe=fe.next}while(fe!==null&&fe!==c);if(K===null?M=x:K.next=U,!Bn(x,a.memoizedState)&&(an=!0,ge&&(f=Ra,f!==null)))throw f;a.memoizedState=x,a.baseState=M,a.baseQueue=K,p.lastRenderedState=x}return v===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function bp(a){var c=qt(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var p=f.dispatch,v=f.pending,x=c.memoizedState;if(v!==null){f.pending=null;var M=v=v.next;do x=a(x,M.action),M=M.next;while(M!==v);Bn(x,c.memoizedState)||(an=!0),c.memoizedState=x,c.baseQueue===null&&(c.baseState=x),f.lastRenderedState=x}return[x,p]}function Cw(a,c,f){var p=qe,v=qt(),x=Je;if(x){if(f===void 0)throw Error(r(407));f=f()}else f=c();var M=!Bn((ct||v).memoizedState,f);M&&(v.memoizedState=f,an=!0),v=v.queue;var U=Mw.bind(null,p,v,a);if(cl(2048,8,U,[a]),v.getSnapshot!==c||M||$t!==null&&$t.memoizedState.tag&1){if(p.flags|=2048,Ma(9,gu(),kw.bind(null,p,v,f,c),null),vt===null)throw Error(r(349));x||(Ci&124)!==0||Nw(p,c,f)}return f}function Nw(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=qe.updateQueue,c===null?(c=vp(),qe.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function kw(a,c,f,p){c.value=f,c.getSnapshot=p,Iw(c)&&Ow(a)}function Mw(a,c,f){return f(function(){Iw(c)&&Ow(a)})}function Iw(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!Bn(a,f)}catch{return!0}}function Ow(a){var c=wa(a,2);c!==null&&Vn(c,a,2)}function wp(a){var c=On();if(typeof a=="function"){var f=a;if(a=f(),Ts){Qe(!0);try{f()}finally{Qe(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:a},c}function Pw(a,c,f,p){return a.baseState=f,xp(a,ct,typeof p=="function"?p:ii)}function N6(a,c,f,p,v){if(_u(a))throw Error(r(485));if(a=c.action,a!==null){var x={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(M){x.listeners.push(M)}};z.T!==null?f(!0):x.isTransition=!1,p(x),f=c.pending,f===null?(x.next=c.pending=x,Dw(c,x)):(x.next=f.next,c.pending=f.next=x)}}function Dw(a,c){var f=c.action,p=c.payload,v=a.state;if(c.isTransition){var x=z.T,M={};z.T=M;try{var U=f(v,p),K=z.S;K!==null&&K(M,U),jw(a,c,U)}catch(fe){Tp(a,c,fe)}finally{z.T=x}}else try{x=f(v,p),jw(a,c,x)}catch(fe){Tp(a,c,fe)}}function jw(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){Lw(a,c,p)},function(p){return Tp(a,c,p)}):Lw(a,c,f)}function Lw(a,c,f){c.status="fulfilled",c.value=f,Bw(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,Dw(a,f)))}function Tp(a,c,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,Bw(c),c=c.next;while(c!==p)}a.action=null}function Bw(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function Uw(a,c){return c}function Fw(a,c){if(Je){var f=vt.formState;if(f!==null){e:{var p=qe;if(Je){if(It){t:{for(var v=It,x=Pr;v.nodeType!==8;){if(!x){v=null;break t}if(v=wr(v.nextSibling),v===null){v=null;break t}}x=v.data,v=x==="F!"||x==="F"?v:null}if(v){It=wr(v.nextSibling),p=v.data==="F!";break e}}ys(p)}p=!1}p&&(c=f[0])}}return f=On(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Uw,lastRenderedState:c},f.queue=p,f=sT.bind(null,qe,p),p.dispatch=f,p=wp(!1),x=Cp.bind(null,qe,!1,p.queue),p=On(),v={state:c,dispatch:null,action:a,pending:null},p.queue=v,f=N6.bind(null,qe,v,x,f),v.dispatch=f,p.memoizedState=a,[c,f,!1]}function zw(a){var c=qt();return $w(c,ct,a)}function $w(a,c,f){if(c=xp(a,c,Uw)[0],a=pu(ii)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=ll(c)}catch(M){throw M===nl?lu:M}else p=c;c=qt();var v=c.queue,x=v.dispatch;return f!==c.memoizedState&&(qe.flags|=2048,Ma(9,gu(),k6.bind(null,v,f),null)),[p,x,a]}function k6(a,c){a.action=c}function qw(a){var c=qt(),f=ct;if(f!==null)return $w(c,f,a);qt(),c=c.memoizedState,f=qt();var p=f.queue.dispatch;return f.memoizedState=a,[c,p,!1]}function Ma(a,c,f,p){return a={tag:a,create:f,deps:p,inst:c,next:null},c=qe.updateQueue,c===null&&(c=vp(),qe.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,c.lastEffect=a),a}function gu(){return{destroy:void 0,resource:void 0}}function Vw(){return qt().memoizedState}function mu(a,c,f,p){var v=On();p=p===void 0?null:p,qe.flags|=a,v.memoizedState=Ma(1|c,gu(),f,p)}function cl(a,c,f,p){var v=qt();p=p===void 0?null:p;var x=v.memoizedState.inst;ct!==null&&p!==null&&hp(p,ct.memoizedState.deps)?v.memoizedState=Ma(c,x,f,p):(qe.flags|=a,v.memoizedState=Ma(1|c,x,f,p))}function Hw(a,c){mu(8390656,8,a,c)}function Ww(a,c){cl(2048,8,a,c)}function Xw(a,c){return cl(4,2,a,c)}function Yw(a,c){return cl(4,4,a,c)}function Gw(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Kw(a,c,f){f=f!=null?f.concat([a]):null,cl(4,4,Gw.bind(null,c,a),f)}function Sp(){}function Zw(a,c){var f=qt();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&hp(c,p[1])?p[0]:(f.memoizedState=[a,c],a)}function Qw(a,c){var f=qt();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&hp(c,p[1]))return p[0];if(p=a(),Ts){Qe(!0);try{a()}finally{Qe(!1)}}return f.memoizedState=[p,c],p}function Ep(a,c,f){return f===void 0||(Ci&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=tS(),qe.lanes|=a,Di|=a,f)}function Jw(a,c,f,p){return Bn(f,c)?f:Ca.current!==null?(a=Ep(a,f,p),Bn(a,c)||(an=!0),a):(Ci&42)===0?(an=!0,a.memoizedState=f):(a=tS(),qe.lanes|=a,Di|=a,c)}function eT(a,c,f,p,v){var x=Q.p;Q.p=x!==0&&8>x?x:8;var M=z.T,U={};z.T=U,Cp(a,!1,c,f);try{var K=v(),fe=z.S;if(fe!==null&&fe(U,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var ge=A6(K,p);ul(a,c,ge,qn(a))}else ul(a,c,p,qn(a))}catch(ve){ul(a,c,{then:function(){},status:"rejected",reason:ve},qn())}finally{Q.p=x,z.T=M}}function M6(){}function Ap(a,c,f,p){if(a.tag!==5)throw Error(r(476));var v=tT(a).queue;eT(a,v,c,oe,f===null?M6:function(){return nT(a),f(p)})}function tT(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:oe},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ii,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function nT(a){var c=tT(a).next.queue;ul(a,c,{},qn())}function Rp(){return _n(Cl)}function rT(){return qt().memoizedState}function iT(){return qt().memoizedState}function I6(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=qn();a=Ai(f);var p=Ri(c,a,f);p!==null&&(Vn(p,c,f),il(p,c,f)),c={cache:rp()},a.payload=c;return}c=c.return}}function O6(a,c,f){var p=qn();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},_u(a)?aT(c,f):(f=Xh(a,c,f,p),f!==null&&(Vn(f,a,p),oT(f,c,p)))}function sT(a,c,f){var p=qn();ul(a,c,f,p)}function ul(a,c,f,p){var v={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(_u(a))aT(c,v);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=c.lastRenderedReducer,x!==null))try{var M=c.lastRenderedState,U=x(M,f);if(v.hasEagerState=!0,v.eagerState=U,Bn(U,M))return eu(a,c,v,0),vt===null&&Jc(),!1}catch{}finally{}if(f=Xh(a,c,v,p),f!==null)return Vn(f,a,p),oT(f,c,p),!0}return!1}function Cp(a,c,f,p){if(p={lane:2,revertLane:ag(),action:p,hasEagerState:!1,eagerState:null,next:null},_u(a)){if(c)throw Error(r(479))}else c=Xh(a,f,p,2),c!==null&&Vn(c,a,2)}function _u(a){var c=a.alternate;return a===qe||c!==null&&c===qe}function aT(a,c){Na=fu=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function oT(a,c,f){if((f&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,g2(a,f)}}var vu={readContext:_n,use:hu,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useLayoutEffect:Bt,useInsertionEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useSyncExternalStore:Bt,useId:Bt,useHostTransitionStatus:Bt,useFormState:Bt,useActionState:Bt,useOptimistic:Bt,useMemoCache:Bt,useCacheRefresh:Bt},lT={readContext:_n,use:hu,useCallback:function(a,c){return On().memoizedState=[a,c===void 0?null:c],a},useContext:_n,useEffect:Hw,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,mu(4194308,4,Gw.bind(null,c,a),f)},useLayoutEffect:function(a,c){return mu(4194308,4,a,c)},useInsertionEffect:function(a,c){mu(4,2,a,c)},useMemo:function(a,c){var f=On();c=c===void 0?null:c;var p=a();if(Ts){Qe(!0);try{a()}finally{Qe(!1)}}return f.memoizedState=[p,c],p},useReducer:function(a,c,f){var p=On();if(f!==void 0){var v=f(c);if(Ts){Qe(!0);try{f(c)}finally{Qe(!1)}}}else v=c;return p.memoizedState=p.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},p.queue=a,a=a.dispatch=O6.bind(null,qe,a),[p.memoizedState,a]},useRef:function(a){var c=On();return a={current:a},c.memoizedState=a},useState:function(a){a=wp(a);var c=a.queue,f=sT.bind(null,qe,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:Sp,useDeferredValue:function(a,c){var f=On();return Ep(f,a,c)},useTransition:function(){var a=wp(!1);return a=eT.bind(null,qe,a.queue,!0,!1),On().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var p=qe,v=On();if(Je){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),vt===null)throw Error(r(349));(Ge&124)!==0||Nw(p,c,f)}v.memoizedState=f;var x={value:f,getSnapshot:c};return v.queue=x,Hw(Mw.bind(null,p,x,a),[a]),p.flags|=2048,Ma(9,gu(),kw.bind(null,p,x,f,c),null),f},useId:function(){var a=On(),c=vt.identifierPrefix;if(Je){var f=ti,p=ei;f=(p&~(1<<32-xt(p)-1)).toString(32)+f,c="«"+c+"R"+f,f=du++,0<f&&(c+="H"+f.toString(32)),c+="»"}else f=R6++,c="«"+c+"r"+f.toString(32)+"»";return a.memoizedState=c},useHostTransitionStatus:Rp,useFormState:Fw,useActionState:Fw,useOptimistic:function(a){var c=On();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=Cp.bind(null,qe,!0,f),f.dispatch=c,[a,c]},useMemoCache:yp,useCacheRefresh:function(){return On().memoizedState=I6.bind(null,qe)}},cT={readContext:_n,use:hu,useCallback:Zw,useContext:_n,useEffect:Ww,useImperativeHandle:Kw,useInsertionEffect:Xw,useLayoutEffect:Yw,useMemo:Qw,useReducer:pu,useRef:Vw,useState:function(){return pu(ii)},useDebugValue:Sp,useDeferredValue:function(a,c){var f=qt();return Jw(f,ct.memoizedState,a,c)},useTransition:function(){var a=pu(ii)[0],c=qt().memoizedState;return[typeof a=="boolean"?a:ll(a),c]},useSyncExternalStore:Cw,useId:rT,useHostTransitionStatus:Rp,useFormState:zw,useActionState:zw,useOptimistic:function(a,c){var f=qt();return Pw(f,ct,a,c)},useMemoCache:yp,useCacheRefresh:iT},P6={readContext:_n,use:hu,useCallback:Zw,useContext:_n,useEffect:Ww,useImperativeHandle:Kw,useInsertionEffect:Xw,useLayoutEffect:Yw,useMemo:Qw,useReducer:bp,useRef:Vw,useState:function(){return bp(ii)},useDebugValue:Sp,useDeferredValue:function(a,c){var f=qt();return ct===null?Ep(f,a,c):Jw(f,ct.memoizedState,a,c)},useTransition:function(){var a=bp(ii)[0],c=qt().memoizedState;return[typeof a=="boolean"?a:ll(a),c]},useSyncExternalStore:Cw,useId:rT,useHostTransitionStatus:Rp,useFormState:qw,useActionState:qw,useOptimistic:function(a,c){var f=qt();return ct!==null?Pw(f,ct,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:yp,useCacheRefresh:iT},Ia=null,fl=0;function yu(a){var c=fl;return fl+=1,Ia===null&&(Ia=[]),xw(Ia,a,c)}function dl(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function xu(a,c){throw c.$$typeof===m?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function uT(a){var c=a._init;return c(a._payload)}function fT(a){function c(se,ee){if(a){var ue=se.deletions;ue===null?(se.deletions=[ee],se.flags|=16):ue.push(ee)}}function f(se,ee){if(!a)return null;for(;ee!==null;)c(se,ee),ee=ee.sibling;return null}function p(se){for(var ee=new Map;se!==null;)se.key!==null?ee.set(se.key,se):ee.set(se.index,se),se=se.sibling;return ee}function v(se,ee){return se=Jr(se,ee),se.index=0,se.sibling=null,se}function x(se,ee,ue){return se.index=ue,a?(ue=se.alternate,ue!==null?(ue=ue.index,ue<ee?(se.flags|=67108866,ee):ue):(se.flags|=67108866,ee)):(se.flags|=1048576,ee)}function M(se){return a&&se.alternate===null&&(se.flags|=67108866),se}function U(se,ee,ue,me){return ee===null||ee.tag!==6?(ee=Gh(ue,se.mode,me),ee.return=se,ee):(ee=v(ee,ue),ee.return=se,ee)}function K(se,ee,ue,me){var Ce=ue.type;return Ce===T?ge(se,ee,ue.props.children,me,ue.key):ee!==null&&(ee.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===k&&uT(Ce)===ee.type)?(ee=v(ee,ue.props),dl(ee,ue),ee.return=se,ee):(ee=nu(ue.type,ue.key,ue.props,null,se.mode,me),dl(ee,ue),ee.return=se,ee)}function fe(se,ee,ue,me){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ue.containerInfo||ee.stateNode.implementation!==ue.implementation?(ee=Kh(ue,se.mode,me),ee.return=se,ee):(ee=v(ee,ue.children||[]),ee.return=se,ee)}function ge(se,ee,ue,me,Ce){return ee===null||ee.tag!==7?(ee=gs(ue,se.mode,me,Ce),ee.return=se,ee):(ee=v(ee,ue),ee.return=se,ee)}function ve(se,ee,ue){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=Gh(""+ee,se.mode,ue),ee.return=se,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case _:return ue=nu(ee.type,ee.key,ee.props,null,se.mode,ue),dl(ue,ee),ue.return=se,ue;case y:return ee=Kh(ee,se.mode,ue),ee.return=se,ee;case k:var me=ee._init;return ee=me(ee._payload),ve(se,ee,ue)}if(q(ee)||$(ee))return ee=gs(ee,se.mode,ue,null),ee.return=se,ee;if(typeof ee.then=="function")return ve(se,yu(ee),ue);if(ee.$$typeof===R)return ve(se,au(se,ee),ue);xu(se,ee)}return null}function de(se,ee,ue,me){var Ce=ee!==null?ee.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return Ce!==null?null:U(se,ee,""+ue,me);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case _:return ue.key===Ce?K(se,ee,ue,me):null;case y:return ue.key===Ce?fe(se,ee,ue,me):null;case k:return Ce=ue._init,ue=Ce(ue._payload),de(se,ee,ue,me)}if(q(ue)||$(ue))return Ce!==null?null:ge(se,ee,ue,me,null);if(typeof ue.then=="function")return de(se,ee,yu(ue),me);if(ue.$$typeof===R)return de(se,ee,au(se,ue),me);xu(se,ue)}return null}function he(se,ee,ue,me,Ce){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return se=se.get(ue)||null,U(ee,se,""+me,Ce);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return se=se.get(me.key===null?ue:me.key)||null,K(ee,se,me,Ce);case y:return se=se.get(me.key===null?ue:me.key)||null,fe(ee,se,me,Ce);case k:var Ve=me._init;return me=Ve(me._payload),he(se,ee,ue,me,Ce)}if(q(me)||$(me))return se=se.get(ue)||null,ge(ee,se,me,Ce,null);if(typeof me.then=="function")return he(se,ee,ue,yu(me),Ce);if(me.$$typeof===R)return he(se,ee,ue,au(ee,me),Ce);xu(ee,me)}return null}function Be(se,ee,ue,me){for(var Ce=null,Ve=null,Ie=ee,je=ee=0,ln=null;Ie!==null&&je<ue.length;je++){Ie.index>je?(ln=Ie,Ie=null):ln=Ie.sibling;var Ze=de(se,Ie,ue[je],me);if(Ze===null){Ie===null&&(Ie=ln);break}a&&Ie&&Ze.alternate===null&&c(se,Ie),ee=x(Ze,ee,je),Ve===null?Ce=Ze:Ve.sibling=Ze,Ve=Ze,Ie=ln}if(je===ue.length)return f(se,Ie),Je&&_s(se,je),Ce;if(Ie===null){for(;je<ue.length;je++)Ie=ve(se,ue[je],me),Ie!==null&&(ee=x(Ie,ee,je),Ve===null?Ce=Ie:Ve.sibling=Ie,Ve=Ie);return Je&&_s(se,je),Ce}for(Ie=p(Ie);je<ue.length;je++)ln=he(Ie,se,je,ue[je],me),ln!==null&&(a&&ln.alternate!==null&&Ie.delete(ln.key===null?je:ln.key),ee=x(ln,ee,je),Ve===null?Ce=ln:Ve.sibling=ln,Ve=ln);return a&&Ie.forEach(function(Vi){return c(se,Vi)}),Je&&_s(se,je),Ce}function De(se,ee,ue,me){if(ue==null)throw Error(r(151));for(var Ce=null,Ve=null,Ie=ee,je=ee=0,ln=null,Ze=ue.next();Ie!==null&&!Ze.done;je++,Ze=ue.next()){Ie.index>je?(ln=Ie,Ie=null):ln=Ie.sibling;var Vi=de(se,Ie,Ze.value,me);if(Vi===null){Ie===null&&(Ie=ln);break}a&&Ie&&Vi.alternate===null&&c(se,Ie),ee=x(Vi,ee,je),Ve===null?Ce=Vi:Ve.sibling=Vi,Ve=Vi,Ie=ln}if(Ze.done)return f(se,Ie),Je&&_s(se,je),Ce;if(Ie===null){for(;!Ze.done;je++,Ze=ue.next())Ze=ve(se,Ze.value,me),Ze!==null&&(ee=x(Ze,ee,je),Ve===null?Ce=Ze:Ve.sibling=Ze,Ve=Ze);return Je&&_s(se,je),Ce}for(Ie=p(Ie);!Ze.done;je++,Ze=ue.next())Ze=he(Ie,se,je,Ze.value,me),Ze!==null&&(a&&Ze.alternate!==null&&Ie.delete(Ze.key===null?je:Ze.key),ee=x(Ze,ee,je),Ve===null?Ce=Ze:Ve.sibling=Ze,Ve=Ze);return a&&Ie.forEach(function(DL){return c(se,DL)}),Je&&_s(se,je),Ce}function ft(se,ee,ue,me){if(typeof ue=="object"&&ue!==null&&ue.type===T&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case _:e:{for(var Ce=ue.key;ee!==null;){if(ee.key===Ce){if(Ce=ue.type,Ce===T){if(ee.tag===7){f(se,ee.sibling),me=v(ee,ue.props.children),me.return=se,se=me;break e}}else if(ee.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===k&&uT(Ce)===ee.type){f(se,ee.sibling),me=v(ee,ue.props),dl(me,ue),me.return=se,se=me;break e}f(se,ee);break}else c(se,ee);ee=ee.sibling}ue.type===T?(me=gs(ue.props.children,se.mode,me,ue.key),me.return=se,se=me):(me=nu(ue.type,ue.key,ue.props,null,se.mode,me),dl(me,ue),me.return=se,se=me)}return M(se);case y:e:{for(Ce=ue.key;ee!==null;){if(ee.key===Ce)if(ee.tag===4&&ee.stateNode.containerInfo===ue.containerInfo&&ee.stateNode.implementation===ue.implementation){f(se,ee.sibling),me=v(ee,ue.children||[]),me.return=se,se=me;break e}else{f(se,ee);break}else c(se,ee);ee=ee.sibling}me=Kh(ue,se.mode,me),me.return=se,se=me}return M(se);case k:return Ce=ue._init,ue=Ce(ue._payload),ft(se,ee,ue,me)}if(q(ue))return Be(se,ee,ue,me);if($(ue)){if(Ce=$(ue),typeof Ce!="function")throw Error(r(150));return ue=Ce.call(ue),De(se,ee,ue,me)}if(typeof ue.then=="function")return ft(se,ee,yu(ue),me);if(ue.$$typeof===R)return ft(se,ee,au(se,ue),me);xu(se,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,ee!==null&&ee.tag===6?(f(se,ee.sibling),me=v(ee,ue),me.return=se,se=me):(f(se,ee),me=Gh(ue,se.mode,me),me.return=se,se=me),M(se)):f(se,ee)}return function(se,ee,ue,me){try{fl=0;var Ce=ft(se,ee,ue,me);return Ia=null,Ce}catch(Ie){if(Ie===nl||Ie===lu)throw Ie;var Ve=Un(29,Ie,null,se.mode);return Ve.lanes=me,Ve.return=se,Ve}finally{}}}var Oa=fT(!0),dT=fT(!1),sr=Y(null),Dr=null;function Ni(a){var c=a.alternate;ie(Qt,Qt.current&1),ie(sr,a),Dr===null&&(c===null||Ca.current!==null||c.memoizedState!==null)&&(Dr=a)}function hT(a){if(a.tag===22){if(ie(Qt,Qt.current),ie(sr,a),Dr===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Dr=a)}}else ki()}function ki(){ie(Qt,Qt.current),ie(sr,sr.current)}function si(a){le(sr),Dr===a&&(Dr=null),le(Qt)}var Qt=Y(0);function bu(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||vg(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Np(a,c,f,p){c=a.memoizedState,f=f(p,c),f=f==null?c:h({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var kp={enqueueSetState:function(a,c,f){a=a._reactInternals;var p=qn(),v=Ai(p);v.payload=c,f!=null&&(v.callback=f),c=Ri(a,v,p),c!==null&&(Vn(c,a,p),il(c,a,p))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var p=qn(),v=Ai(p);v.tag=1,v.payload=c,f!=null&&(v.callback=f),c=Ri(a,v,p),c!==null&&(Vn(c,a,p),il(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=qn(),p=Ai(f);p.tag=2,c!=null&&(p.callback=c),c=Ri(a,p,f),c!==null&&(Vn(c,a,f),il(c,a,f))}};function pT(a,c,f,p,v,x,M){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,x,M):c.prototype&&c.prototype.isPureReactComponent?!Yo(f,p)||!Yo(v,x):!0}function gT(a,c,f,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==a&&kp.enqueueReplaceState(c,c.state,null)}function Ss(a,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(a=a.defaultProps){f===c&&(f=h({},f));for(var v in a)f[v]===void 0&&(f[v]=a[v])}return f}var wu=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function mT(a){wu(a)}function _T(a){console.error(a)}function vT(a){wu(a)}function Tu(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function yT(a,c,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Mp(a,c,f){return f=Ai(f),f.tag=3,f.payload={element:null},f.callback=function(){Tu(a,c)},f}function xT(a){return a=Ai(a),a.tag=3,a}function bT(a,c,f,p){var v=f.type.getDerivedStateFromError;if(typeof v=="function"){var x=p.value;a.payload=function(){return v(x)},a.callback=function(){yT(c,f,p)}}var M=f.stateNode;M!==null&&typeof M.componentDidCatch=="function"&&(a.callback=function(){yT(c,f,p),typeof v!="function"&&(ji===null?ji=new Set([this]):ji.add(this));var U=p.stack;this.componentDidCatch(p.value,{componentStack:U!==null?U:""})})}function D6(a,c,f,p,v){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&Jo(c,f,v,!0),f=sr.current,f!==null){switch(f.tag){case 13:return Dr===null?tg():f.alternate===null&&Ot===0&&(Ot=3),f.flags&=-257,f.flags|=65536,f.lanes=v,p===ap?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),rg(a,p,v)),!1;case 22:return f.flags|=65536,p===ap?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),rg(a,p,v)),!1}throw Error(r(435,f.tag))}return rg(a,p,v),tg(),!1}if(Je)return c=sr.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,p!==Jh&&(a=Error(r(422),{cause:p}),Qo(tr(a,f)))):(p!==Jh&&(c=Error(r(423),{cause:p}),Qo(tr(c,f))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,p=tr(p,f),v=Mp(a.stateNode,p,v),cp(a,v),Ot!==4&&(Ot=2)),!1;var x=Error(r(520),{cause:p});if(x=tr(x,f),yl===null?yl=[x]:yl.push(x),Ot!==4&&(Ot=2),c===null)return!0;p=tr(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=v&-v,f.lanes|=a,a=Mp(f.stateNode,p,a),cp(f,a),!1;case 1:if(c=f.type,x=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ji===null||!ji.has(x))))return f.flags|=65536,v&=-v,f.lanes|=v,v=xT(v),bT(v,a,f,p),cp(f,v),!1}f=f.return}while(f!==null);return!1}var wT=Error(r(461)),an=!1;function un(a,c,f,p){c.child=a===null?dT(c,null,f,p):Oa(c,a.child,f,p)}function TT(a,c,f,p,v){f=f.render;var x=c.ref;if("ref"in p){var M={};for(var U in p)U!=="ref"&&(M[U]=p[U])}else M=p;return bs(c),p=pp(a,c,f,M,x,v),U=gp(),a!==null&&!an?(mp(a,c,v),ai(a,c,v)):(Je&&U&&Zh(c),c.flags|=1,un(a,c,p,v),c.child)}function ST(a,c,f,p,v){if(a===null){var x=f.type;return typeof x=="function"&&!Yh(x)&&x.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=x,ET(a,c,x,p,v)):(a=nu(f.type,null,p,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(x=a.child,!Up(a,v)){var M=x.memoizedProps;if(f=f.compare,f=f!==null?f:Yo,f(M,p)&&a.ref===c.ref)return ai(a,c,v)}return c.flags|=1,a=Jr(x,p),a.ref=c.ref,a.return=c,c.child=a}function ET(a,c,f,p,v){if(a!==null){var x=a.memoizedProps;if(Yo(x,p)&&a.ref===c.ref)if(an=!1,c.pendingProps=p=x,Up(a,v))(a.flags&131072)!==0&&(an=!0);else return c.lanes=a.lanes,ai(a,c,v)}return Ip(a,c,f,p,v)}function AT(a,c,f){var p=c.pendingProps,v=p.children,x=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=x!==null?x.baseLanes|f:f,a!==null){for(v=c.child=a.child,x=0;v!==null;)x=x|v.lanes|v.childLanes,v=v.sibling;c.childLanes=x&~p}else c.childLanes=0,c.child=null;return RT(a,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&ou(c,x!==null?x.cachePool:null),x!==null?Ew(c,x):fp(),hT(c);else return c.lanes=c.childLanes=536870912,RT(a,c,x!==null?x.baseLanes|f:f,f)}else x!==null?(ou(c,x.cachePool),Ew(c,x),ki(),c.memoizedState=null):(a!==null&&ou(c,null),fp(),ki());return un(a,c,v,f),c.child}function RT(a,c,f,p){var v=sp();return v=v===null?null:{parent:Zt._currentValue,pool:v},c.memoizedState={baseLanes:f,cachePool:v},a!==null&&ou(c,null),fp(),hT(c),a!==null&&Jo(a,c,p,!0),null}function Su(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function Ip(a,c,f,p,v){return bs(c),f=pp(a,c,f,p,void 0,v),p=gp(),a!==null&&!an?(mp(a,c,v),ai(a,c,v)):(Je&&p&&Zh(c),c.flags|=1,un(a,c,f,v),c.child)}function CT(a,c,f,p,v,x){return bs(c),c.updateQueue=null,f=Rw(c,p,f,v),Aw(a),p=gp(),a!==null&&!an?(mp(a,c,x),ai(a,c,x)):(Je&&p&&Zh(c),c.flags|=1,un(a,c,f,x),c.child)}function NT(a,c,f,p,v){if(bs(c),c.stateNode===null){var x=Ta,M=f.contextType;typeof M=="object"&&M!==null&&(x=_n(M)),x=new f(p,x),c.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=kp,c.stateNode=x,x._reactInternals=c,x=c.stateNode,x.props=p,x.state=c.memoizedState,x.refs={},op(c),M=f.contextType,x.context=typeof M=="object"&&M!==null?_n(M):Ta,x.state=c.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&(Np(c,f,M,p),x.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(M=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),M!==x.state&&kp.enqueueReplaceState(x,x.state,null),al(c,p,x,v),sl(),x.state=c.memoizedState),typeof x.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){x=c.stateNode;var U=c.memoizedProps,K=Ss(f,U);x.props=K;var fe=x.context,ge=f.contextType;M=Ta,typeof ge=="object"&&ge!==null&&(M=_n(ge));var ve=f.getDerivedStateFromProps;ge=typeof ve=="function"||typeof x.getSnapshotBeforeUpdate=="function",U=c.pendingProps!==U,ge||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(U||fe!==M)&&gT(c,x,p,M),Ei=!1;var de=c.memoizedState;x.state=de,al(c,p,x,v),sl(),fe=c.memoizedState,U||de!==fe||Ei?(typeof ve=="function"&&(Np(c,f,ve,p),fe=c.memoizedState),(K=Ei||pT(c,f,K,p,de,fe,M))?(ge||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(c.flags|=4194308)):(typeof x.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=fe),x.props=p,x.state=fe,x.context=M,p=K):(typeof x.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{x=c.stateNode,lp(a,c),M=c.memoizedProps,ge=Ss(f,M),x.props=ge,ve=c.pendingProps,de=x.context,fe=f.contextType,K=Ta,typeof fe=="object"&&fe!==null&&(K=_n(fe)),U=f.getDerivedStateFromProps,(fe=typeof U=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(M!==ve||de!==K)&&gT(c,x,p,K),Ei=!1,de=c.memoizedState,x.state=de,al(c,p,x,v),sl();var he=c.memoizedState;M!==ve||de!==he||Ei||a!==null&&a.dependencies!==null&&su(a.dependencies)?(typeof U=="function"&&(Np(c,f,U,p),he=c.memoizedState),(ge=Ei||pT(c,f,ge,p,de,he,K)||a!==null&&a.dependencies!==null&&su(a.dependencies))?(fe||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(p,he,K),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(p,he,K)),typeof x.componentDidUpdate=="function"&&(c.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof x.componentDidUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=he),x.props=p,x.state=he,x.context=K,p=ge):(typeof x.componentDidUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||M===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),p=!1)}return x=p,Su(a,c),p=(c.flags&128)!==0,x||p?(x=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:x.render(),c.flags|=1,a!==null&&p?(c.child=Oa(c,a.child,null,v),c.child=Oa(c,null,f,v)):un(a,c,f,v),c.memoizedState=x.state,a=c.child):a=ai(a,c,v),a}function kT(a,c,f,p){return Zo(),c.flags|=256,un(a,c,f,p),c.child}var Op={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Pp(a){return{baseLanes:a,cachePool:_w()}}function Dp(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=ar),a}function MT(a,c,f){var p=c.pendingProps,v=!1,x=(c.flags&128)!==0,M;if((M=x)||(M=a!==null&&a.memoizedState===null?!1:(Qt.current&2)!==0),M&&(v=!0,c.flags&=-129),M=(c.flags&32)!==0,c.flags&=-33,a===null){if(Je){if(v?Ni(c):ki(),Je){var U=It,K;if(K=U){e:{for(K=U,U=Pr;K.nodeType!==8;){if(!U){U=null;break e}if(K=wr(K.nextSibling),K===null){U=null;break e}}U=K}U!==null?(c.memoizedState={dehydrated:U,treeContext:ms!==null?{id:ei,overflow:ti}:null,retryLane:536870912,hydrationErrors:null},K=Un(18,null,null,0),K.stateNode=U,K.return=c,c.child=K,Sn=c,It=null,K=!0):K=!1}K||ys(c)}if(U=c.memoizedState,U!==null&&(U=U.dehydrated,U!==null))return vg(U)?c.lanes=32:c.lanes=536870912,null;si(c)}return U=p.children,p=p.fallback,v?(ki(),v=c.mode,U=Eu({mode:"hidden",children:U},v),p=gs(p,v,f,null),U.return=c,p.return=c,U.sibling=p,c.child=U,v=c.child,v.memoizedState=Pp(f),v.childLanes=Dp(a,M,f),c.memoizedState=Op,p):(Ni(c),jp(c,U))}if(K=a.memoizedState,K!==null&&(U=K.dehydrated,U!==null)){if(x)c.flags&256?(Ni(c),c.flags&=-257,c=Lp(a,c,f)):c.memoizedState!==null?(ki(),c.child=a.child,c.flags|=128,c=null):(ki(),v=p.fallback,U=c.mode,p=Eu({mode:"visible",children:p.children},U),v=gs(v,U,f,null),v.flags|=2,p.return=c,v.return=c,p.sibling=v,c.child=p,Oa(c,a.child,null,f),p=c.child,p.memoizedState=Pp(f),p.childLanes=Dp(a,M,f),c.memoizedState=Op,c=v);else if(Ni(c),vg(U)){if(M=U.nextSibling&&U.nextSibling.dataset,M)var fe=M.dgst;M=fe,p=Error(r(419)),p.stack="",p.digest=M,Qo({value:p,source:null,stack:null}),c=Lp(a,c,f)}else if(an||Jo(a,c,f,!1),M=(f&a.childLanes)!==0,an||M){if(M=vt,M!==null&&(p=f&-f,p=(p&42)!==0?1:yh(p),p=(p&(M.suspendedLanes|f))!==0?0:p,p!==0&&p!==K.retryLane))throw K.retryLane=p,wa(a,p),Vn(M,a,p),wT;U.data==="$?"||tg(),c=Lp(a,c,f)}else U.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=K.treeContext,It=wr(U.nextSibling),Sn=c,Je=!0,vs=null,Pr=!1,a!==null&&(rr[ir++]=ei,rr[ir++]=ti,rr[ir++]=ms,ei=a.id,ti=a.overflow,ms=c),c=jp(c,p.children),c.flags|=4096);return c}return v?(ki(),v=p.fallback,U=c.mode,K=a.child,fe=K.sibling,p=Jr(K,{mode:"hidden",children:p.children}),p.subtreeFlags=K.subtreeFlags&65011712,fe!==null?v=Jr(fe,v):(v=gs(v,U,f,null),v.flags|=2),v.return=c,p.return=c,p.sibling=v,c.child=p,p=v,v=c.child,U=a.child.memoizedState,U===null?U=Pp(f):(K=U.cachePool,K!==null?(fe=Zt._currentValue,K=K.parent!==fe?{parent:fe,pool:fe}:K):K=_w(),U={baseLanes:U.baseLanes|f,cachePool:K}),v.memoizedState=U,v.childLanes=Dp(a,M,f),c.memoizedState=Op,p):(Ni(c),f=a.child,a=f.sibling,f=Jr(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,a!==null&&(M=c.deletions,M===null?(c.deletions=[a],c.flags|=16):M.push(a)),c.child=f,c.memoizedState=null,f)}function jp(a,c){return c=Eu({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function Eu(a,c){return a=Un(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Lp(a,c,f){return Oa(c,a.child,null,f),a=jp(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function IT(a,c,f){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),tp(a.return,c,f)}function Bp(a,c,f,p,v){var x=a.memoizedState;x===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:v}:(x.isBackwards=c,x.rendering=null,x.renderingStartTime=0,x.last=p,x.tail=f,x.tailMode=v)}function OT(a,c,f){var p=c.pendingProps,v=p.revealOrder,x=p.tail;if(un(a,c,p.children,f),p=Qt.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&IT(a,f,c);else if(a.tag===19)IT(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(ie(Qt,p),v){case"forwards":for(f=c.child,v=null;f!==null;)a=f.alternate,a!==null&&bu(a)===null&&(v=f),f=f.sibling;f=v,f===null?(v=c.child,c.child=null):(v=f.sibling,f.sibling=null),Bp(c,!1,v,f,x);break;case"backwards":for(f=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&bu(a)===null){c.child=v;break}a=v.sibling,v.sibling=f,f=v,v=a}Bp(c,!0,f,null,x);break;case"together":Bp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ai(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Di|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(Jo(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=Jr(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=Jr(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Up(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&su(a)))}function j6(a,c,f){switch(c.tag){case 3:ye(c,c.stateNode.containerInfo),Si(c,Zt,a.memoizedState.cache),Zo();break;case 27:case 5:Oe(c);break;case 4:ye(c,c.stateNode.containerInfo);break;case 10:Si(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(Ni(c),c.flags|=128,null):(f&c.child.childLanes)!==0?MT(a,c,f):(Ni(c),a=ai(a,c,f),a!==null?a.sibling:null);Ni(c);break;case 19:var v=(a.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(Jo(a,c,f,!1),p=(f&c.childLanes)!==0),v){if(p)return OT(a,c,f);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ie(Qt,Qt.current),p)break;return null;case 22:case 23:return c.lanes=0,AT(a,c,f);case 24:Si(c,Zt,a.memoizedState.cache)}return ai(a,c,f)}function PT(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)an=!0;else{if(!Up(a,f)&&(c.flags&128)===0)return an=!1,j6(a,c,f);an=(a.flags&131072)!==0}else an=!1,Je&&(c.flags&1048576)!==0&&uw(c,iu,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var p=c.elementType,v=p._init;if(p=v(p._payload),c.type=p,typeof p=="function")Yh(p)?(a=Ss(p,a),c.tag=1,c=NT(null,c,p,a,f)):(c.tag=0,c=Ip(null,c,p,a,f));else{if(p!=null){if(v=p.$$typeof,v===E){c.tag=11,c=TT(null,c,p,a,f);break e}else if(v===P){c.tag=14,c=ST(null,c,p,a,f);break e}}throw c=V(p)||p,Error(r(306,c,""))}}return c;case 0:return Ip(a,c,c.type,c.pendingProps,f);case 1:return p=c.type,v=Ss(p,c.pendingProps),NT(a,c,p,v,f);case 3:e:{if(ye(c,c.stateNode.containerInfo),a===null)throw Error(r(387));p=c.pendingProps;var x=c.memoizedState;v=x.element,lp(a,c),al(c,p,null,f);var M=c.memoizedState;if(p=M.cache,Si(c,Zt,p),p!==x.cache&&np(c,[Zt],f,!0),sl(),p=M.element,x.isDehydrated)if(x={element:p,isDehydrated:!1,cache:M.cache},c.updateQueue.baseState=x,c.memoizedState=x,c.flags&256){c=kT(a,c,p,f);break e}else if(p!==v){v=tr(Error(r(424)),c),Qo(v),c=kT(a,c,p,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(It=wr(a.firstChild),Sn=c,Je=!0,vs=null,Pr=!0,f=dT(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(Zo(),p===v){c=ai(a,c,f);break e}un(a,c,p,f)}c=c.child}return c;case 26:return Su(a,c),a===null?(f=BS(c.type,null,c.pendingProps,null))?c.memoizedState=f:Je||(f=c.type,a=c.pendingProps,p=Uu(J.current).createElement(f),p[mn]=c,p[Mn]=a,dn(p,f,a),sn(p),c.stateNode=p):c.memoizedState=BS(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Oe(c),a===null&&Je&&(p=c.stateNode=DS(c.type,c.pendingProps,J.current),Sn=c,Pr=!0,v=It,Ui(c.type)?(yg=v,It=wr(p.firstChild)):It=v),un(a,c,c.pendingProps.children,f),Su(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Je&&((v=p=It)&&(p=uL(p,c.type,c.pendingProps,Pr),p!==null?(c.stateNode=p,Sn=c,It=wr(p.firstChild),Pr=!1,v=!0):v=!1),v||ys(c)),Oe(c),v=c.type,x=c.pendingProps,M=a!==null?a.memoizedProps:null,p=x.children,gg(v,x)?p=null:M!==null&&gg(v,M)&&(c.flags|=32),c.memoizedState!==null&&(v=pp(a,c,C6,null,null,f),Cl._currentValue=v),Su(a,c),un(a,c,p,f),c.child;case 6:return a===null&&Je&&((a=f=It)&&(f=fL(f,c.pendingProps,Pr),f!==null?(c.stateNode=f,Sn=c,It=null,a=!0):a=!1),a||ys(c)),null;case 13:return MT(a,c,f);case 4:return ye(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=Oa(c,null,p,f):un(a,c,p,f),c.child;case 11:return TT(a,c,c.type,c.pendingProps,f);case 7:return un(a,c,c.pendingProps,f),c.child;case 8:return un(a,c,c.pendingProps.children,f),c.child;case 12:return un(a,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,Si(c,c.type,p.value),un(a,c,p.children,f),c.child;case 9:return v=c.type._context,p=c.pendingProps.children,bs(c),v=_n(v),p=p(v),c.flags|=1,un(a,c,p,f),c.child;case 14:return ST(a,c,c.type,c.pendingProps,f);case 15:return ET(a,c,c.type,c.pendingProps,f);case 19:return OT(a,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},a===null?(f=Eu(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Jr(a.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return AT(a,c,f);case 24:return bs(c),p=_n(Zt),a===null?(v=sp(),v===null&&(v=vt,x=rp(),v.pooledCache=x,x.refCount++,x!==null&&(v.pooledCacheLanes|=f),v=x),c.memoizedState={parent:p,cache:v},op(c),Si(c,Zt,v)):((a.lanes&f)!==0&&(lp(a,c),al(c,null,null,f),sl()),v=a.memoizedState,x=c.memoizedState,v.parent!==p?(v={parent:p,cache:p},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),Si(c,Zt,p)):(p=x.cache,Si(c,Zt,p),p!==v.cache&&np(c,[Zt],f,!0))),un(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function oi(a){a.flags|=4}function DT(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!qS(c)){if(c=sr.current,c!==null&&((Ge&4194048)===Ge?Dr!==null:(Ge&62914560)!==Ge&&(Ge&536870912)===0||c!==Dr))throw rl=ap,vw;a.flags|=8192}}function Au(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Ct():536870912,a.lanes|=c,La|=c)}function hl(a,c){if(!Je)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Nt(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(c)for(var v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags&65011712,p|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=p,a.childLanes=f,c}function L6(a,c,f){var p=c.pendingProps;switch(Qh(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nt(c),null;case 1:return Nt(c),null;case 3:return f=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),ri(Zt),Ae(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Ko(c)?oi(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,hw())),Nt(c),null;case 26:return f=c.memoizedState,a===null?(oi(c),f!==null?(Nt(c),DT(c,f)):(Nt(c),c.flags&=-16777217)):f?f!==a.memoizedState?(oi(c),Nt(c),DT(c,f)):(Nt(c),c.flags&=-16777217):(a.memoizedProps!==p&&oi(c),Nt(c),c.flags&=-16777217),null;case 27:Ue(c),f=J.current;var v=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==p&&oi(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Nt(c),null}a=F.current,Ko(c)?fw(c):(a=DS(v,p,f),c.stateNode=a,oi(c))}return Nt(c),null;case 5:if(Ue(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&oi(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Nt(c),null}if(a=F.current,Ko(c))fw(c);else{switch(v=Uu(J.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?v.createElement("select",{is:p.is}):v.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?v.createElement(f,{is:p.is}):v.createElement(f)}}a[mn]=c,a[Mn]=p;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=a;e:switch(dn(a,f,p),f){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&oi(c)}}return Nt(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&oi(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(a=J.current,Ko(c)){if(a=c.stateNode,f=c.memoizedProps,p=null,v=Sn,v!==null)switch(v.tag){case 27:case 5:p=v.memoizedProps}a[mn]=c,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||CS(a.nodeValue,f)),a||ys(c)}else a=Uu(a).createTextNode(p),a[mn]=c,c.stateNode=a}return Nt(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=Ko(c),p!==null&&p.dehydrated!==null){if(a===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[mn]=c}else Zo(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Nt(c),v=!1}else v=hw(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(si(c),c):(si(c),null)}if(si(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,a=a!==null&&a.memoizedState!==null,f){p=c.child,v=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(v=p.alternate.memoizedState.cachePool.pool);var x=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(x=p.memoizedState.cachePool.pool),x!==v&&(p.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),Au(c,c.updateQueue),Nt(c),null;case 4:return Ae(),a===null&&ug(c.stateNode.containerInfo),Nt(c),null;case 10:return ri(c.type),Nt(c),null;case 19:if(le(Qt),v=c.memoizedState,v===null)return Nt(c),null;if(p=(c.flags&128)!==0,x=v.rendering,x===null)if(p)hl(v,!1);else{if(Ot!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(x=bu(a),x!==null){for(c.flags|=128,hl(v,!1),a=x.updateQueue,c.updateQueue=a,Au(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)cw(f,a),f=f.sibling;return ie(Qt,Qt.current&1|2),c.child}a=a.sibling}v.tail!==null&&Me()>Nu&&(c.flags|=128,p=!0,hl(v,!1),c.lanes=4194304)}else{if(!p)if(a=bu(x),a!==null){if(c.flags|=128,p=!0,a=a.updateQueue,c.updateQueue=a,Au(c,a),hl(v,!0),v.tail===null&&v.tailMode==="hidden"&&!x.alternate&&!Je)return Nt(c),null}else 2*Me()-v.renderingStartTime>Nu&&f!==536870912&&(c.flags|=128,p=!0,hl(v,!1),c.lanes=4194304);v.isBackwards?(x.sibling=c.child,c.child=x):(a=v.last,a!==null?a.sibling=x:c.child=x,v.last=x)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Me(),c.sibling=null,a=Qt.current,ie(Qt,p?a&1|2:a&1),c):(Nt(c),null);case 22:case 23:return si(c),dp(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Nt(c),c.subtreeFlags&6&&(c.flags|=8192)):Nt(c),f=c.updateQueue,f!==null&&Au(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),a!==null&&le(ws),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),ri(Zt),Nt(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function B6(a,c){switch(Qh(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return ri(Zt),Ae(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Ue(c),null;case 13:if(si(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));Zo()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return le(Qt),null;case 4:return Ae(),null;case 10:return ri(c.type),null;case 22:case 23:return si(c),dp(),a!==null&&le(ws),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return ri(Zt),null;case 25:return null;default:return null}}function jT(a,c){switch(Qh(c),c.tag){case 3:ri(Zt),Ae();break;case 26:case 27:case 5:Ue(c);break;case 4:Ae();break;case 13:si(c);break;case 19:le(Qt);break;case 10:ri(c.type);break;case 22:case 23:si(c),dp(),a!==null&&le(ws);break;case 24:ri(Zt)}}function pl(a,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var v=p.next;f=v;do{if((f.tag&a)===a){p=void 0;var x=f.create,M=f.inst;p=x(),M.destroy=p}f=f.next}while(f!==v)}}catch(U){pt(c,c.return,U)}}function Mi(a,c,f){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var x=v.next;p=x;do{if((p.tag&a)===a){var M=p.inst,U=M.destroy;if(U!==void 0){M.destroy=void 0,v=c;var K=f,fe=U;try{fe()}catch(ge){pt(v,K,ge)}}}p=p.next}while(p!==x)}}catch(ge){pt(c,c.return,ge)}}function LT(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{Sw(c,f)}catch(p){pt(a,a.return,p)}}}function BT(a,c,f){f.props=Ss(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){pt(a,c,p)}}function gl(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(v){pt(a,c,v)}}function jr(a,c){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(v){pt(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(v){pt(a,c,v)}else f.current=null}function UT(a){var c=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(v){pt(a,a.return,v)}}function Fp(a,c,f){try{var p=a.stateNode;sL(p,a.type,f,c),p[Mn]=c}catch(v){pt(a,a.return,v)}}function FT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ui(a.type)||a.tag===4}function zp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||FT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ui(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function $p(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Bu));else if(p!==4&&(p===27&&Ui(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for($p(a,c,f),a=a.sibling;a!==null;)$p(a,c,f),a=a.sibling}function Ru(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(p!==4&&(p===27&&Ui(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(Ru(a,c,f),a=a.sibling;a!==null;)Ru(a,c,f),a=a.sibling}function zT(a){var c=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);dn(c,p,f),c[mn]=a,c[Mn]=f}catch(x){pt(a,a.return,x)}}var li=!1,Ut=!1,qp=!1,$T=typeof WeakSet=="function"?WeakSet:Set,on=null;function U6(a,c){if(a=a.containerInfo,hg=Hu,a=J2(a),zh(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var v=p.anchorOffset,x=p.focusNode;p=p.focusOffset;try{f.nodeType,x.nodeType}catch{f=null;break e}var M=0,U=-1,K=-1,fe=0,ge=0,ve=a,de=null;t:for(;;){for(var he;ve!==f||v!==0&&ve.nodeType!==3||(U=M+v),ve!==x||p!==0&&ve.nodeType!==3||(K=M+p),ve.nodeType===3&&(M+=ve.nodeValue.length),(he=ve.firstChild)!==null;)de=ve,ve=he;for(;;){if(ve===a)break t;if(de===f&&++fe===v&&(U=M),de===x&&++ge===p&&(K=M),(he=ve.nextSibling)!==null)break;ve=de,de=ve.parentNode}ve=he}f=U===-1||K===-1?null:{start:U,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(pg={focusedElem:a,selectionRange:f},Hu=!1,on=c;on!==null;)if(c=on,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,on=a;else for(;on!==null;){switch(c=on,x=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&x!==null){a=void 0,f=c,v=x.memoizedProps,x=x.memoizedState,p=f.stateNode;try{var Be=Ss(f.type,v,f.elementType===f.type);a=p.getSnapshotBeforeUpdate(Be,x),p.__reactInternalSnapshotBeforeUpdate=a}catch(De){pt(f,f.return,De)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)_g(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":_g(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,on=a;break}on=c.return}}function qT(a,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Ii(a,f),p&4&&pl(5,f);break;case 1:if(Ii(a,f),p&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(M){pt(f,f.return,M)}else{var v=Ss(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(M){pt(f,f.return,M)}}p&64&&LT(f),p&512&&gl(f,f.return);break;case 3:if(Ii(a,f),p&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{Sw(a,c)}catch(M){pt(f,f.return,M)}}break;case 27:c===null&&p&4&&zT(f);case 26:case 5:Ii(a,f),c===null&&p&4&&UT(f),p&512&&gl(f,f.return);break;case 12:Ii(a,f);break;case 13:Ii(a,f),p&4&&WT(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=Y6.bind(null,f),dL(a,f))));break;case 22:if(p=f.memoizedState!==null||li,!p){c=c!==null&&c.memoizedState!==null||Ut,v=li;var x=Ut;li=p,(Ut=c)&&!x?Oi(a,f,(f.subtreeFlags&8772)!==0):Ii(a,f),li=v,Ut=x}break;case 30:break;default:Ii(a,f)}}function VT(a){var c=a.alternate;c!==null&&(a.alternate=null,VT(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&wh(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var wt=null,Pn=!1;function ci(a,c,f){for(f=f.child;f!==null;)HT(a,c,f),f=f.sibling}function HT(a,c,f){if(He&&typeof He.onCommitFiberUnmount=="function")try{He.onCommitFiberUnmount(rt,f)}catch{}switch(f.tag){case 26:Ut||jr(f,c),ci(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Ut||jr(f,c);var p=wt,v=Pn;Ui(f.type)&&(wt=f.stateNode,Pn=!1),ci(a,c,f),Sl(f.stateNode),wt=p,Pn=v;break;case 5:Ut||jr(f,c);case 6:if(p=wt,v=Pn,wt=null,ci(a,c,f),wt=p,Pn=v,wt!==null)if(Pn)try{(wt.nodeType===9?wt.body:wt.nodeName==="HTML"?wt.ownerDocument.body:wt).removeChild(f.stateNode)}catch(x){pt(f,c,x)}else try{wt.removeChild(f.stateNode)}catch(x){pt(f,c,x)}break;case 18:wt!==null&&(Pn?(a=wt,OS(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),Il(a)):OS(wt,f.stateNode));break;case 4:p=wt,v=Pn,wt=f.stateNode.containerInfo,Pn=!0,ci(a,c,f),wt=p,Pn=v;break;case 0:case 11:case 14:case 15:Ut||Mi(2,f,c),Ut||Mi(4,f,c),ci(a,c,f);break;case 1:Ut||(jr(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&BT(f,c,p)),ci(a,c,f);break;case 21:ci(a,c,f);break;case 22:Ut=(p=Ut)||f.memoizedState!==null,ci(a,c,f),Ut=p;break;default:ci(a,c,f)}}function WT(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Il(a)}catch(f){pt(c,c.return,f)}}function F6(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new $T),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new $T),c;default:throw Error(r(435,a.tag))}}function Vp(a,c){var f=F6(a);c.forEach(function(p){var v=G6.bind(null,a,p);f.has(p)||(f.add(p),p.then(v,v))})}function Fn(a,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var v=f[p],x=a,M=c,U=M;e:for(;U!==null;){switch(U.tag){case 27:if(Ui(U.type)){wt=U.stateNode,Pn=!1;break e}break;case 5:wt=U.stateNode,Pn=!1;break e;case 3:case 4:wt=U.stateNode.containerInfo,Pn=!0;break e}U=U.return}if(wt===null)throw Error(r(160));HT(x,M,v),wt=null,Pn=!1,x=v.alternate,x!==null&&(x.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)XT(c,a),c=c.sibling}var br=null;function XT(a,c){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Fn(c,a),zn(a),p&4&&(Mi(3,a,a.return),pl(3,a),Mi(5,a,a.return));break;case 1:Fn(c,a),zn(a),p&512&&(Ut||f===null||jr(f,f.return)),p&64&&li&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var v=br;if(Fn(c,a),zn(a),p&512&&(Ut||f===null||jr(f,f.return)),p&4){var x=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,v=v.ownerDocument||v;t:switch(p){case"title":x=v.getElementsByTagName("title")[0],(!x||x[Uo]||x[mn]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=v.createElement(p),v.head.insertBefore(x,v.querySelector("head > title"))),dn(x,p,f),x[mn]=a,sn(x),p=x;break e;case"link":var M=zS("link","href",v).get(p+(f.href||""));if(M){for(var U=0;U<M.length;U++)if(x=M[U],x.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&x.getAttribute("rel")===(f.rel==null?null:f.rel)&&x.getAttribute("title")===(f.title==null?null:f.title)&&x.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){M.splice(U,1);break t}}x=v.createElement(p),dn(x,p,f),v.head.appendChild(x);break;case"meta":if(M=zS("meta","content",v).get(p+(f.content||""))){for(U=0;U<M.length;U++)if(x=M[U],x.getAttribute("content")===(f.content==null?null:""+f.content)&&x.getAttribute("name")===(f.name==null?null:f.name)&&x.getAttribute("property")===(f.property==null?null:f.property)&&x.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&x.getAttribute("charset")===(f.charSet==null?null:f.charSet)){M.splice(U,1);break t}}x=v.createElement(p),dn(x,p,f),v.head.appendChild(x);break;default:throw Error(r(468,p))}x[mn]=a,sn(x),p=x}a.stateNode=p}else $S(v,a.type,a.stateNode);else a.stateNode=FS(v,p,a.memoizedProps);else x!==p?(x===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):x.count--,p===null?$S(v,a.type,a.stateNode):FS(v,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Fp(a,a.memoizedProps,f.memoizedProps)}break;case 27:Fn(c,a),zn(a),p&512&&(Ut||f===null||jr(f,f.return)),f!==null&&p&4&&Fp(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Fn(c,a),zn(a),p&512&&(Ut||f===null||jr(f,f.return)),a.flags&32){v=a.stateNode;try{ga(v,"")}catch(he){pt(a,a.return,he)}}p&4&&a.stateNode!=null&&(v=a.memoizedProps,Fp(a,v,f!==null?f.memoizedProps:v)),p&1024&&(qp=!0);break;case 6:if(Fn(c,a),zn(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(he){pt(a,a.return,he)}}break;case 3:if($u=null,v=br,br=Fu(c.containerInfo),Fn(c,a),br=v,zn(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{Il(c.containerInfo)}catch(he){pt(a,a.return,he)}qp&&(qp=!1,YT(a));break;case 4:p=br,br=Fu(a.stateNode.containerInfo),Fn(c,a),zn(a),br=p;break;case 12:Fn(c,a),zn(a);break;case 13:Fn(c,a),zn(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Kp=Me()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Vp(a,p)));break;case 22:v=a.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,fe=li,ge=Ut;if(li=fe||v,Ut=ge||K,Fn(c,a),Ut=ge,li=fe,zn(a),p&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(f===null||K||li||Ut||Es(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){K=f=c;try{if(x=K.stateNode,v)M=x.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none";else{U=K.stateNode;var ve=K.memoizedProps.style,de=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;U.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(he){pt(K,K.return,he)}}}else if(c.tag===6){if(f===null){K=c;try{K.stateNode.nodeValue=v?"":K.memoizedProps}catch(he){pt(K,K.return,he)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,Vp(a,f))));break;case 19:Fn(c,a),zn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Vp(a,p)));break;case 30:break;case 21:break;default:Fn(c,a),zn(a)}}function zn(a){var c=a.flags;if(c&2){try{for(var f,p=a.return;p!==null;){if(FT(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var v=f.stateNode,x=zp(a);Ru(a,x,v);break;case 5:var M=f.stateNode;f.flags&32&&(ga(M,""),f.flags&=-33);var U=zp(a);Ru(a,U,M);break;case 3:case 4:var K=f.stateNode.containerInfo,fe=zp(a);$p(a,fe,K);break;default:throw Error(r(161))}}catch(ge){pt(a,a.return,ge)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function YT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;YT(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Ii(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)qT(a,c.alternate,c),c=c.sibling}function Es(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Mi(4,c,c.return),Es(c);break;case 1:jr(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&BT(c,c.return,f),Es(c);break;case 27:Sl(c.stateNode);case 26:case 5:jr(c,c.return),Es(c);break;case 22:c.memoizedState===null&&Es(c);break;case 30:Es(c);break;default:Es(c)}a=a.sibling}}function Oi(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,v=a,x=c,M=x.flags;switch(x.tag){case 0:case 11:case 15:Oi(v,x,f),pl(4,x);break;case 1:if(Oi(v,x,f),p=x,v=p.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(fe){pt(p,p.return,fe)}if(p=x,v=p.updateQueue,v!==null){var U=p.stateNode;try{var K=v.shared.hiddenCallbacks;if(K!==null)for(v.shared.hiddenCallbacks=null,v=0;v<K.length;v++)Tw(K[v],U)}catch(fe){pt(p,p.return,fe)}}f&&M&64&&LT(x),gl(x,x.return);break;case 27:zT(x);case 26:case 5:Oi(v,x,f),f&&p===null&&M&4&&UT(x),gl(x,x.return);break;case 12:Oi(v,x,f);break;case 13:Oi(v,x,f),f&&M&4&&WT(v,x);break;case 22:x.memoizedState===null&&Oi(v,x,f),gl(x,x.return);break;case 30:break;default:Oi(v,x,f)}c=c.sibling}}function Hp(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&el(f))}function Wp(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&el(a))}function Lr(a,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)GT(a,c,f,p),c=c.sibling}function GT(a,c,f,p){var v=c.flags;switch(c.tag){case 0:case 11:case 15:Lr(a,c,f,p),v&2048&&pl(9,c);break;case 1:Lr(a,c,f,p);break;case 3:Lr(a,c,f,p),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&el(a)));break;case 12:if(v&2048){Lr(a,c,f,p),a=c.stateNode;try{var x=c.memoizedProps,M=x.id,U=x.onPostCommit;typeof U=="function"&&U(M,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(K){pt(c,c.return,K)}}else Lr(a,c,f,p);break;case 13:Lr(a,c,f,p);break;case 23:break;case 22:x=c.stateNode,M=c.alternate,c.memoizedState!==null?x._visibility&2?Lr(a,c,f,p):ml(a,c):x._visibility&2?Lr(a,c,f,p):(x._visibility|=2,Pa(a,c,f,p,(c.subtreeFlags&10256)!==0)),v&2048&&Hp(M,c);break;case 24:Lr(a,c,f,p),v&2048&&Wp(c.alternate,c);break;default:Lr(a,c,f,p)}}function Pa(a,c,f,p,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var x=a,M=c,U=f,K=p,fe=M.flags;switch(M.tag){case 0:case 11:case 15:Pa(x,M,U,K,v),pl(8,M);break;case 23:break;case 22:var ge=M.stateNode;M.memoizedState!==null?ge._visibility&2?Pa(x,M,U,K,v):ml(x,M):(ge._visibility|=2,Pa(x,M,U,K,v)),v&&fe&2048&&Hp(M.alternate,M);break;case 24:Pa(x,M,U,K,v),v&&fe&2048&&Wp(M.alternate,M);break;default:Pa(x,M,U,K,v)}c=c.sibling}}function ml(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,p=c,v=p.flags;switch(p.tag){case 22:ml(f,p),v&2048&&Hp(p.alternate,p);break;case 24:ml(f,p),v&2048&&Wp(p.alternate,p);break;default:ml(f,p)}c=c.sibling}}var _l=8192;function Da(a){if(a.subtreeFlags&_l)for(a=a.child;a!==null;)KT(a),a=a.sibling}function KT(a){switch(a.tag){case 26:Da(a),a.flags&_l&&a.memoizedState!==null&&EL(br,a.memoizedState,a.memoizedProps);break;case 5:Da(a);break;case 3:case 4:var c=br;br=Fu(a.stateNode.containerInfo),Da(a),br=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=_l,_l=16777216,Da(a),_l=c):Da(a));break;default:Da(a)}}function ZT(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function vl(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];on=p,JT(p,a)}ZT(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)QT(a),a=a.sibling}function QT(a){switch(a.tag){case 0:case 11:case 15:vl(a),a.flags&2048&&Mi(9,a,a.return);break;case 3:vl(a);break;case 12:vl(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,Cu(a)):vl(a);break;default:vl(a)}}function Cu(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];on=p,JT(p,a)}ZT(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Mi(8,c,c.return),Cu(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,Cu(c));break;default:Cu(c)}a=a.sibling}}function JT(a,c){for(;on!==null;){var f=on;switch(f.tag){case 0:case 11:case 15:Mi(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:el(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,on=p;else e:for(f=a;on!==null;){p=on;var v=p.sibling,x=p.return;if(VT(p),p===f){on=null;break e}if(v!==null){v.return=x,on=v;break e}on=x}}}var z6={getCacheForType:function(a){var c=_n(Zt),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},$6=typeof WeakMap=="function"?WeakMap:Map,at=0,vt=null,We=null,Ge=0,ot=0,$n=null,Pi=!1,ja=!1,Xp=!1,ui=0,Ot=0,Di=0,As=0,Yp=0,ar=0,La=0,yl=null,Dn=null,Gp=!1,Kp=0,Nu=1/0,ku=null,ji=null,fn=0,Li=null,Ba=null,Ua=0,Zp=0,Qp=null,eS=null,xl=0,Jp=null;function qn(){if((at&2)!==0&&Ge!==0)return Ge&-Ge;if(z.T!==null){var a=Aa;return a!==0?a:ag()}return m2()}function tS(){ar===0&&(ar=(Ge&536870912)===0||Je?lt():536870912);var a=sr.current;return a!==null&&(a.flags|=32),ar}function Vn(a,c,f){(a===vt&&(ot===2||ot===9)||a.cancelPendingCommit!==null)&&(Fa(a,0),Bi(a,Ge,ar,!1)),bt(a,f),((at&2)===0||a!==vt)&&(a===vt&&((at&2)===0&&(As|=f),Ot===4&&Bi(a,Ge,ar,!1)),Br(a))}function nS(a,c,f){if((at&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&a.expiredLanes)===0||Qn(a,c),v=p?H6(a,c):ng(a,c,!0),x=p;do{if(v===0){ja&&!p&&Bi(a,c,0,!1);break}else{if(f=a.current.alternate,x&&!q6(f)){v=ng(a,c,!1),x=!1;continue}if(v===2){if(x=c,a.errorRecoveryDisabledLanes&x)var M=0;else M=a.pendingLanes&-536870913,M=M!==0?M:M&536870912?536870912:0;if(M!==0){c=M;e:{var U=a;v=yl;var K=U.current.memoizedState.isDehydrated;if(K&&(Fa(U,M).flags|=256),M=ng(U,M,!1),M!==2){if(Xp&&!K){U.errorRecoveryDisabledLanes|=x,As|=x,v=4;break e}x=Dn,Dn=v,x!==null&&(Dn===null?Dn=x:Dn.push.apply(Dn,x))}v=M}if(x=!1,v!==2)continue}}if(v===1){Fa(a,0),Bi(a,c,0,!0);break}e:{switch(p=a,x=v,x){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:Bi(p,c,ar,!Pi);break e;case 2:Dn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(v=Kp+300-Me(),10<v)){if(Bi(p,c,ar,!Pi),yr(p,0,!0)!==0)break e;p.timeoutHandle=MS(rS.bind(null,p,f,Dn,ku,Gp,c,ar,As,La,Pi,x,2,-0,0),v);break e}rS(p,f,Dn,ku,Gp,c,ar,As,La,Pi,x,0,-0,0)}}break}while(!0);Br(a)}function rS(a,c,f,p,v,x,M,U,K,fe,ge,ve,de,he){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(Rl={stylesheets:null,count:0,unsuspend:SL},KT(c),ve=AL(),ve!==null)){a.cancelPendingCommit=ve(uS.bind(null,a,c,x,f,p,v,M,U,K,ge,1,de,he)),Bi(a,x,M,!fe);return}uS(a,c,x,f,p,v,M,U,K)}function q6(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var v=f[p],x=v.getSnapshot;v=v.value;try{if(!Bn(x(),v))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Bi(a,c,f,p){c&=~Yp,c&=~As,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var v=c;0<v;){var x=31-xt(v),M=1<<x;p[x]=-1,v&=~M}f!==0&&Bo(a,f,c)}function Mu(){return(at&6)===0?(bl(0),!1):!0}function eg(){if(We!==null){if(ot===0)var a=We.return;else a=We,ni=xs=null,_p(a),Ia=null,fl=0,a=We;for(;a!==null;)jT(a.alternate,a),a=a.return;We=null}}function Fa(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,oL(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),eg(),vt=a,We=f=Jr(a.current,null),Ge=c,ot=0,$n=null,Pi=!1,ja=Qn(a,c),Xp=!1,La=ar=Yp=As=Di=Ot=0,Dn=yl=null,Gp=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var v=31-xt(p),x=1<<v;c|=a[v],p&=~x}return ui=c,Jc(),f}function iS(a,c){qe=null,z.H=vu,c===nl||c===lu?(c=bw(),ot=3):c===vw?(c=bw(),ot=4):ot=c===wT?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,$n=c,We===null&&(Ot=1,Tu(a,tr(c,a.current)))}function sS(){var a=z.H;return z.H=vu,a===null?vu:a}function aS(){var a=z.A;return z.A=z6,a}function tg(){Ot=4,Pi||(Ge&4194048)!==Ge&&sr.current!==null||(ja=!0),(Di&134217727)===0&&(As&134217727)===0||vt===null||Bi(vt,Ge,ar,!1)}function ng(a,c,f){var p=at;at|=2;var v=sS(),x=aS();(vt!==a||Ge!==c)&&(ku=null,Fa(a,c)),c=!1;var M=Ot;e:do try{if(ot!==0&&We!==null){var U=We,K=$n;switch(ot){case 8:eg(),M=6;break e;case 3:case 2:case 9:case 6:sr.current===null&&(c=!0);var fe=ot;if(ot=0,$n=null,za(a,U,K,fe),f&&ja){M=0;break e}break;default:fe=ot,ot=0,$n=null,za(a,U,K,fe)}}V6(),M=Ot;break}catch(ge){iS(a,ge)}while(!0);return c&&a.shellSuspendCounter++,ni=xs=null,at=p,z.H=v,z.A=x,We===null&&(vt=null,Ge=0,Jc()),M}function V6(){for(;We!==null;)oS(We)}function H6(a,c){var f=at;at|=2;var p=sS(),v=aS();vt!==a||Ge!==c?(ku=null,Nu=Me()+500,Fa(a,c)):ja=Qn(a,c);e:do try{if(ot!==0&&We!==null){c=We;var x=$n;t:switch(ot){case 1:ot=0,$n=null,za(a,c,x,1);break;case 2:case 9:if(yw(x)){ot=0,$n=null,lS(c);break}c=function(){ot!==2&&ot!==9||vt!==a||(ot=7),Br(a)},x.then(c,c);break e;case 3:ot=7;break e;case 4:ot=5;break e;case 7:yw(x)?(ot=0,$n=null,lS(c)):(ot=0,$n=null,za(a,c,x,7));break;case 5:var M=null;switch(We.tag){case 26:M=We.memoizedState;case 5:case 27:var U=We;if(!M||qS(M)){ot=0,$n=null;var K=U.sibling;if(K!==null)We=K;else{var fe=U.return;fe!==null?(We=fe,Iu(fe)):We=null}break t}}ot=0,$n=null,za(a,c,x,5);break;case 6:ot=0,$n=null,za(a,c,x,6);break;case 8:eg(),Ot=6;break e;default:throw Error(r(462))}}W6();break}catch(ge){iS(a,ge)}while(!0);return ni=xs=null,z.H=p,z.A=v,at=f,We!==null?0:(vt=null,Ge=0,Jc(),Ot)}function W6(){for(;We!==null&&!Pe();)oS(We)}function oS(a){var c=PT(a.alternate,a,ui);a.memoizedProps=a.pendingProps,c===null?Iu(a):We=c}function lS(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=CT(f,c,c.pendingProps,c.type,void 0,Ge);break;case 11:c=CT(f,c,c.pendingProps,c.type.render,c.ref,Ge);break;case 5:_p(c);default:jT(f,c),c=We=cw(c,ui),c=PT(f,c,ui)}a.memoizedProps=a.pendingProps,c===null?Iu(a):We=c}function za(a,c,f,p){ni=xs=null,_p(c),Ia=null,fl=0;var v=c.return;try{if(D6(a,v,c,f,Ge)){Ot=1,Tu(a,tr(f,a.current)),We=null;return}}catch(x){if(v!==null)throw We=v,x;Ot=1,Tu(a,tr(f,a.current)),We=null;return}c.flags&32768?(Je||p===1?a=!0:ja||(Ge&536870912)!==0?a=!1:(Pi=a=!0,(p===2||p===9||p===3||p===6)&&(p=sr.current,p!==null&&p.tag===13&&(p.flags|=16384))),cS(c,a)):Iu(c)}function Iu(a){var c=a;do{if((c.flags&32768)!==0){cS(c,Pi);return}a=c.return;var f=L6(c.alternate,c,ui);if(f!==null){We=f;return}if(c=c.sibling,c!==null){We=c;return}We=c=a}while(c!==null);Ot===0&&(Ot=5)}function cS(a,c){do{var f=B6(a.alternate,a);if(f!==null){f.flags&=32767,We=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){We=a;return}We=a=f}while(a!==null);Ot=6,We=null}function uS(a,c,f,p,v,x,M,U,K){a.cancelPendingCommit=null;do Ou();while(fn!==0);if((at&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(x=c.lanes|c.childLanes,x|=Wh,oa(a,f,x,M,U,K),a===vt&&(We=vt=null,Ge=0),Ba=c,Li=a,Ua=f,Zp=x,Qp=v,eS=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,K6(Ke,function(){return gS(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=z.T,z.T=null,v=Q.p,Q.p=2,M=at,at|=4;try{U6(a,c,f)}finally{at=M,Q.p=v,z.T=p}}fn=1,fS(),dS(),hS()}}function fS(){if(fn===1){fn=0;var a=Li,c=Ba,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=z.T,z.T=null;var p=Q.p;Q.p=2;var v=at;at|=4;try{XT(c,a);var x=pg,M=J2(a.containerInfo),U=x.focusedElem,K=x.selectionRange;if(M!==U&&U&&U.ownerDocument&&Q2(U.ownerDocument.documentElement,U)){if(K!==null&&zh(U)){var fe=K.start,ge=K.end;if(ge===void 0&&(ge=fe),"selectionStart"in U)U.selectionStart=fe,U.selectionEnd=Math.min(ge,U.value.length);else{var ve=U.ownerDocument||document,de=ve&&ve.defaultView||window;if(de.getSelection){var he=de.getSelection(),Be=U.textContent.length,De=Math.min(K.start,Be),ft=K.end===void 0?De:Math.min(K.end,Be);!he.extend&&De>ft&&(M=ft,ft=De,De=M);var se=Z2(U,De),ee=Z2(U,ft);if(se&&ee&&(he.rangeCount!==1||he.anchorNode!==se.node||he.anchorOffset!==se.offset||he.focusNode!==ee.node||he.focusOffset!==ee.offset)){var ue=ve.createRange();ue.setStart(se.node,se.offset),he.removeAllRanges(),De>ft?(he.addRange(ue),he.extend(ee.node,ee.offset)):(ue.setEnd(ee.node,ee.offset),he.addRange(ue))}}}}for(ve=[],he=U;he=he.parentNode;)he.nodeType===1&&ve.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof U.focus=="function"&&U.focus(),U=0;U<ve.length;U++){var me=ve[U];me.element.scrollLeft=me.left,me.element.scrollTop=me.top}}Hu=!!hg,pg=hg=null}finally{at=v,Q.p=p,z.T=f}}a.current=c,fn=2}}function dS(){if(fn===2){fn=0;var a=Li,c=Ba,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=z.T,z.T=null;var p=Q.p;Q.p=2;var v=at;at|=4;try{qT(a,c.alternate,c)}finally{at=v,Q.p=p,z.T=f}}fn=3}}function hS(){if(fn===4||fn===3){fn=0,Kt();var a=Li,c=Ba,f=Ua,p=eS;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?fn=5:(fn=0,Ba=Li=null,pS(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(ji=null),xh(f),c=c.stateNode,He&&typeof He.onCommitFiberRoot=="function")try{He.onCommitFiberRoot(rt,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=z.T,v=Q.p,Q.p=2,z.T=null;try{for(var x=a.onRecoverableError,M=0;M<p.length;M++){var U=p[M];x(U.value,{componentStack:U.stack})}}finally{z.T=c,Q.p=v}}(Ua&3)!==0&&Ou(),Br(a),v=a.pendingLanes,(f&4194090)!==0&&(v&42)!==0?a===Jp?xl++:(xl=0,Jp=a):xl=0,bl(0)}}function pS(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,el(c)))}function Ou(a){return fS(),dS(),hS(),gS()}function gS(){if(fn!==5)return!1;var a=Li,c=Zp;Zp=0;var f=xh(Ua),p=z.T,v=Q.p;try{Q.p=32>f?32:f,z.T=null,f=Qp,Qp=null;var x=Li,M=Ua;if(fn=0,Ba=Li=null,Ua=0,(at&6)!==0)throw Error(r(331));var U=at;if(at|=4,QT(x.current),GT(x,x.current,M,f),at=U,bl(0,!1),He&&typeof He.onPostCommitFiberRoot=="function")try{He.onPostCommitFiberRoot(rt,x)}catch{}return!0}finally{Q.p=v,z.T=p,pS(a,c)}}function mS(a,c,f){c=tr(f,c),c=Mp(a.stateNode,c,2),a=Ri(a,c,2),a!==null&&(bt(a,2),Br(a))}function pt(a,c,f){if(a.tag===3)mS(a,a,f);else for(;c!==null;){if(c.tag===3){mS(c,a,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ji===null||!ji.has(p))){a=tr(f,a),f=xT(2),p=Ri(c,f,2),p!==null&&(bT(f,p,c,a),bt(p,2),Br(p));break}}c=c.return}}function rg(a,c,f){var p=a.pingCache;if(p===null){p=a.pingCache=new $6;var v=new Set;p.set(c,v)}else v=p.get(c),v===void 0&&(v=new Set,p.set(c,v));v.has(f)||(Xp=!0,v.add(f),a=X6.bind(null,a,c,f),c.then(a,a))}function X6(a,c,f){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,vt===a&&(Ge&f)===f&&(Ot===4||Ot===3&&(Ge&62914560)===Ge&&300>Me()-Kp?(at&2)===0&&Fa(a,0):Yp|=f,La===Ge&&(La=0)),Br(a)}function _S(a,c){c===0&&(c=Ct()),a=wa(a,c),a!==null&&(bt(a,c),Br(a))}function Y6(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),_S(a,f)}function G6(a,c){var f=0;switch(a.tag){case 13:var p=a.stateNode,v=a.memoizedState;v!==null&&(f=v.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),_S(a,f)}function K6(a,c){return Te(a,c)}var Pu=null,$a=null,ig=!1,Du=!1,sg=!1,Rs=0;function Br(a){a!==$a&&a.next===null&&($a===null?Pu=$a=a:$a=$a.next=a),Du=!0,ig||(ig=!0,Q6())}function bl(a,c){if(!sg&&Du){sg=!0;do for(var f=!1,p=Pu;p!==null;){if(a!==0){var v=p.pendingLanes;if(v===0)var x=0;else{var M=p.suspendedLanes,U=p.pingedLanes;x=(1<<31-xt(42|a)+1)-1,x&=v&~(M&~U),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(f=!0,bS(p,x))}else x=Ge,x=yr(p,p===vt?x:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(x&3)===0||Qn(p,x)||(f=!0,bS(p,x));p=p.next}while(f);sg=!1}}function Z6(){vS()}function vS(){Du=ig=!1;var a=0;Rs!==0&&(aL()&&(a=Rs),Rs=0);for(var c=Me(),f=null,p=Pu;p!==null;){var v=p.next,x=yS(p,c);x===0?(p.next=null,f===null?Pu=v:f.next=v,v===null&&($a=f)):(f=p,(a!==0||(x&3)!==0)&&(Du=!0)),p=v}bl(a)}function yS(a,c){for(var f=a.suspendedLanes,p=a.pingedLanes,v=a.expirationTimes,x=a.pendingLanes&-62914561;0<x;){var M=31-xt(x),U=1<<M,K=v[M];K===-1?((U&f)===0||(U&p)!==0)&&(v[M]=we(U,c)):K<=c&&(a.expiredLanes|=U),x&=~U}if(c=vt,f=Ge,f=yr(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===c&&(ot===2||ot===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&Ne(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Qn(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(p!==null&&Ne(p),xh(f)){case 2:case 8:f=Rt;break;case 32:f=Ke;break;case 268435456:f=Ye;break;default:f=Ke}return p=xS.bind(null,a),f=Te(f,p),a.callbackPriority=c,a.callbackNode=f,c}return p!==null&&p!==null&&Ne(p),a.callbackPriority=2,a.callbackNode=null,2}function xS(a,c){if(fn!==0&&fn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Ou()&&a.callbackNode!==f)return null;var p=Ge;return p=yr(a,a===vt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(nS(a,p,c),yS(a,Me()),a.callbackNode!=null&&a.callbackNode===f?xS.bind(null,a):null)}function bS(a,c){if(Ou())return null;nS(a,c,!0)}function Q6(){lL(function(){(at&6)!==0?Te(Mt,Z6):vS()})}function ag(){return Rs===0&&(Rs=lt()),Rs}function wS(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Wc(""+a)}function TS(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function J6(a,c,f,p,v){if(c==="submit"&&f&&f.stateNode===v){var x=wS((v[Mn]||null).action),M=p.submitter;M&&(c=(c=M[Mn]||null)?wS(c.formAction):M.getAttribute("formAction"),c!==null&&(x=c,M=null));var U=new Kc("action","action",null,p,v);a.push({event:U,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Rs!==0){var K=M?TS(v,M):new FormData(v);Ap(f,{pending:!0,data:K,method:v.method,action:x},null,K)}}else typeof x=="function"&&(U.preventDefault(),K=M?TS(v,M):new FormData(v),Ap(f,{pending:!0,data:K,method:v.method,action:x},x,K))},currentTarget:v}]})}}for(var og=0;og<Hh.length;og++){var lg=Hh[og],eL=lg.toLowerCase(),tL=lg[0].toUpperCase()+lg.slice(1);xr(eL,"on"+tL)}xr(nw,"onAnimationEnd"),xr(rw,"onAnimationIteration"),xr(iw,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(v6,"onTransitionRun"),xr(y6,"onTransitionStart"),xr(x6,"onTransitionCancel"),xr(sw,"onTransitionEnd"),da("onMouseEnter",["mouseout","mouseover"]),da("onMouseLeave",["mouseout","mouseover"]),da("onPointerEnter",["pointerout","pointerover"]),da("onPointerLeave",["pointerout","pointerover"]),fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fs("onBeforeInput",["compositionend","keypress","textInput","paste"]),fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nL=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(wl));function SS(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],v=p.event;p=p.listeners;e:{var x=void 0;if(c)for(var M=p.length-1;0<=M;M--){var U=p[M],K=U.instance,fe=U.currentTarget;if(U=U.listener,K!==x&&v.isPropagationStopped())break e;x=U,v.currentTarget=fe;try{x(v)}catch(ge){wu(ge)}v.currentTarget=null,x=K}else for(M=0;M<p.length;M++){if(U=p[M],K=U.instance,fe=U.currentTarget,U=U.listener,K!==x&&v.isPropagationStopped())break e;x=U,v.currentTarget=fe;try{x(v)}catch(ge){wu(ge)}v.currentTarget=null,x=K}}}}function Xe(a,c){var f=c[bh];f===void 0&&(f=c[bh]=new Set);var p=a+"__bubble";f.has(p)||(ES(c,a,2,!1),f.add(p))}function cg(a,c,f){var p=0;c&&(p|=4),ES(f,a,p,c)}var ju="_reactListening"+Math.random().toString(36).slice(2);function ug(a){if(!a[ju]){a[ju]=!0,v2.forEach(function(f){f!=="selectionchange"&&(nL.has(f)||cg(f,!1,a),cg(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[ju]||(c[ju]=!0,cg("selectionchange",!1,c))}}function ES(a,c,f,p){switch(GS(c)){case 2:var v=NL;break;case 8:v=kL;break;default:v=Sg}f=v.bind(null,c,f,a),v=void 0,!Ih||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),p?v!==void 0?a.addEventListener(c,f,{capture:!0,passive:v}):a.addEventListener(c,f,!0):v!==void 0?a.addEventListener(c,f,{passive:v}):a.addEventListener(c,f,!1)}function fg(a,c,f,p,v){var x=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var M=p.tag;if(M===3||M===4){var U=p.stateNode.containerInfo;if(U===v)break;if(M===4)for(M=p.return;M!==null;){var K=M.tag;if((K===3||K===4)&&M.stateNode.containerInfo===v)return;M=M.return}for(;U!==null;){if(M=ca(U),M===null)return;if(K=M.tag,K===5||K===6||K===26||K===27){p=x=M;continue e}U=U.parentNode}}p=p.return}I2(function(){var fe=x,ge=kh(f),ve=[];e:{var de=aw.get(a);if(de!==void 0){var he=Kc,Be=a;switch(a){case"keypress":if(Yc(f)===0)break e;case"keydown":case"keyup":he=Kj;break;case"focusin":Be="focus",he=jh;break;case"focusout":Be="blur",he=jh;break;case"beforeblur":case"afterblur":he=jh;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=D2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=Bj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=Jj;break;case nw:case rw:case iw:he=zj;break;case sw:he=t6;break;case"scroll":case"scrollend":he=jj;break;case"wheel":he=r6;break;case"copy":case"cut":case"paste":he=qj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=L2;break;case"toggle":case"beforetoggle":he=s6}var De=(c&4)!==0,ft=!De&&(a==="scroll"||a==="scrollend"),se=De?de!==null?de+"Capture":null:de;De=[];for(var ee=fe,ue;ee!==null;){var me=ee;if(ue=me.stateNode,me=me.tag,me!==5&&me!==26&&me!==27||ue===null||se===null||(me=zo(ee,se),me!=null&&De.push(Tl(ee,me,ue))),ft)break;ee=ee.return}0<De.length&&(de=new he(de,Be,null,f,ge),ve.push({event:de,listeners:De}))}}if((c&7)===0){e:{if(de=a==="mouseover"||a==="pointerover",he=a==="mouseout"||a==="pointerout",de&&f!==Nh&&(Be=f.relatedTarget||f.fromElement)&&(ca(Be)||Be[la]))break e;if((he||de)&&(de=ge.window===ge?ge:(de=ge.ownerDocument)?de.defaultView||de.parentWindow:window,he?(Be=f.relatedTarget||f.toElement,he=fe,Be=Be?ca(Be):null,Be!==null&&(ft=s(Be),De=Be.tag,Be!==ft||De!==5&&De!==27&&De!==6)&&(Be=null)):(he=null,Be=fe),he!==Be)){if(De=D2,me="onMouseLeave",se="onMouseEnter",ee="mouse",(a==="pointerout"||a==="pointerover")&&(De=L2,me="onPointerLeave",se="onPointerEnter",ee="pointer"),ft=he==null?de:Fo(he),ue=Be==null?de:Fo(Be),de=new De(me,ee+"leave",he,f,ge),de.target=ft,de.relatedTarget=ue,me=null,ca(ge)===fe&&(De=new De(se,ee+"enter",Be,f,ge),De.target=ue,De.relatedTarget=ft,me=De),ft=me,he&&Be)t:{for(De=he,se=Be,ee=0,ue=De;ue;ue=qa(ue))ee++;for(ue=0,me=se;me;me=qa(me))ue++;for(;0<ee-ue;)De=qa(De),ee--;for(;0<ue-ee;)se=qa(se),ue--;for(;ee--;){if(De===se||se!==null&&De===se.alternate)break t;De=qa(De),se=qa(se)}De=null}else De=null;he!==null&&AS(ve,de,he,De,!1),Be!==null&&ft!==null&&AS(ve,ft,Be,De,!0)}}e:{if(de=fe?Fo(fe):window,he=de.nodeName&&de.nodeName.toLowerCase(),he==="select"||he==="input"&&de.type==="file")var Ce=H2;else if(q2(de))if(W2)Ce=g6;else{Ce=h6;var Ve=d6}else he=de.nodeName,!he||he.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?fe&&Ch(fe.elementType)&&(Ce=H2):Ce=p6;if(Ce&&(Ce=Ce(a,fe))){V2(ve,Ce,f,ge);break e}Ve&&Ve(a,de,fe),a==="focusout"&&fe&&de.type==="number"&&fe.memoizedProps.value!=null&&Rh(de,"number",de.value)}switch(Ve=fe?Fo(fe):window,a){case"focusin":(q2(Ve)||Ve.contentEditable==="true")&&(ya=Ve,$h=fe,Go=null);break;case"focusout":Go=$h=ya=null;break;case"mousedown":qh=!0;break;case"contextmenu":case"mouseup":case"dragend":qh=!1,ew(ve,f,ge);break;case"selectionchange":if(_6)break;case"keydown":case"keyup":ew(ve,f,ge)}var Ie;if(Bh)e:{switch(a){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else va?z2(a,f)&&(je="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(je="onCompositionStart");je&&(B2&&f.locale!=="ko"&&(va||je!=="onCompositionStart"?je==="onCompositionEnd"&&va&&(Ie=O2()):(Ti=ge,Oh="value"in Ti?Ti.value:Ti.textContent,va=!0)),Ve=Lu(fe,je),0<Ve.length&&(je=new j2(je,a,null,f,ge),ve.push({event:je,listeners:Ve}),Ie?je.data=Ie:(Ie=$2(f),Ie!==null&&(je.data=Ie)))),(Ie=o6?l6(a,f):c6(a,f))&&(je=Lu(fe,"onBeforeInput"),0<je.length&&(Ve=new j2("onBeforeInput","beforeinput",null,f,ge),ve.push({event:Ve,listeners:je}),Ve.data=Ie)),J6(ve,a,fe,f,ge)}SS(ve,c)})}function Tl(a,c,f){return{instance:a,listener:c,currentTarget:f}}function Lu(a,c){for(var f=c+"Capture",p=[];a!==null;){var v=a,x=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||x===null||(v=zo(a,f),v!=null&&p.unshift(Tl(a,v,x)),v=zo(a,c),v!=null&&p.push(Tl(a,v,x))),a.tag===3)return p;a=a.return}return[]}function qa(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function AS(a,c,f,p,v){for(var x=c._reactName,M=[];f!==null&&f!==p;){var U=f,K=U.alternate,fe=U.stateNode;if(U=U.tag,K!==null&&K===p)break;U!==5&&U!==26&&U!==27||fe===null||(K=fe,v?(fe=zo(f,x),fe!=null&&M.unshift(Tl(f,fe,K))):v||(fe=zo(f,x),fe!=null&&M.push(Tl(f,fe,K)))),f=f.return}M.length!==0&&a.push({event:c,listeners:M})}var rL=/\r\n?/g,iL=/\u0000|\uFFFD/g;function RS(a){return(typeof a=="string"?a:""+a).replace(rL,`
`).replace(iL,"")}function CS(a,c){return c=RS(c),RS(a)===c}function Bu(){}function ut(a,c,f,p,v,x){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||ga(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&ga(a,""+p);break;case"className":qc(a,"class",p);break;case"tabIndex":qc(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":qc(a,f,p);break;case"style":k2(a,p,x);break;case"data":if(c!=="object"){qc(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Wc(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(f==="formAction"?(c!=="input"&&ut(a,c,"name",v.name,v,null),ut(a,c,"formEncType",v.formEncType,v,null),ut(a,c,"formMethod",v.formMethod,v,null),ut(a,c,"formTarget",v.formTarget,v,null)):(ut(a,c,"encType",v.encType,v,null),ut(a,c,"method",v.method,v,null),ut(a,c,"target",v.target,v,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Wc(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=Bu);break;case"onScroll":p!=null&&Xe("scroll",a);break;case"onScrollEnd":p!=null&&Xe("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Wc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":Xe("beforetoggle",a),Xe("toggle",a),$c(a,"popover",p);break;case"xlinkActuate":Zr(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Zr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Zr(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Zr(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Zr(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Zr(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Zr(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Zr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Zr(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":$c(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Pj.get(f)||f,$c(a,f,p))}}function dg(a,c,f,p,v,x){switch(f){case"style":k2(a,p,x);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof p=="string"?ga(a,p):(typeof p=="number"||typeof p=="bigint")&&ga(a,""+p);break;case"onScroll":p!=null&&Xe("scroll",a);break;case"onScrollEnd":p!=null&&Xe("scrollend",a);break;case"onClick":p!=null&&(a.onclick=Bu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!y2.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(v=f.endsWith("Capture"),c=f.slice(2,v?f.length-7:void 0),x=a[Mn]||null,x=x!=null?x[f]:null,typeof x=="function"&&a.removeEventListener(c,x,v),typeof p=="function")){typeof x!="function"&&x!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,p,v);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):$c(a,f,p)}}}function dn(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xe("error",a),Xe("load",a);var p=!1,v=!1,x;for(x in f)if(f.hasOwnProperty(x)){var M=f[x];if(M!=null)switch(x){case"src":p=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ut(a,c,x,M,f,null)}}v&&ut(a,c,"srcSet",f.srcSet,f,null),p&&ut(a,c,"src",f.src,f,null);return;case"input":Xe("invalid",a);var U=x=M=v=null,K=null,fe=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":v=ge;break;case"type":M=ge;break;case"checked":K=ge;break;case"defaultChecked":fe=ge;break;case"value":x=ge;break;case"defaultValue":U=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,c));break;default:ut(a,c,p,ge,f,null)}}A2(a,x,U,K,fe,M,v,!1),Vc(a);return;case"select":Xe("invalid",a),p=M=x=null;for(v in f)if(f.hasOwnProperty(v)&&(U=f[v],U!=null))switch(v){case"value":x=U;break;case"defaultValue":M=U;break;case"multiple":p=U;default:ut(a,c,v,U,f,null)}c=x,f=M,a.multiple=!!p,c!=null?pa(a,!!p,c,!1):f!=null&&pa(a,!!p,f,!0);return;case"textarea":Xe("invalid",a),x=v=p=null;for(M in f)if(f.hasOwnProperty(M)&&(U=f[M],U!=null))switch(M){case"value":p=U;break;case"defaultValue":v=U;break;case"children":x=U;break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(r(91));break;default:ut(a,c,M,U,f,null)}C2(a,p,v,x),Vc(a);return;case"option":for(K in f)if(f.hasOwnProperty(K)&&(p=f[K],p!=null))switch(K){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:ut(a,c,K,p,f,null)}return;case"dialog":Xe("beforetoggle",a),Xe("toggle",a),Xe("cancel",a),Xe("close",a);break;case"iframe":case"object":Xe("load",a);break;case"video":case"audio":for(p=0;p<wl.length;p++)Xe(wl[p],a);break;case"image":Xe("error",a),Xe("load",a);break;case"details":Xe("toggle",a);break;case"embed":case"source":case"link":Xe("error",a),Xe("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in f)if(f.hasOwnProperty(fe)&&(p=f[fe],p!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ut(a,c,fe,p,f,null)}return;default:if(Ch(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&dg(a,c,ge,p,f,void 0));return}}for(U in f)f.hasOwnProperty(U)&&(p=f[U],p!=null&&ut(a,c,U,p,f,null))}function sL(a,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,x=null,M=null,U=null,K=null,fe=null,ge=null;for(he in f){var ve=f[he];if(f.hasOwnProperty(he)&&ve!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":K=ve;default:p.hasOwnProperty(he)||ut(a,c,he,null,p,ve)}}for(var de in p){var he=p[de];if(ve=f[de],p.hasOwnProperty(de)&&(he!=null||ve!=null))switch(de){case"type":x=he;break;case"name":v=he;break;case"checked":fe=he;break;case"defaultChecked":ge=he;break;case"value":M=he;break;case"defaultValue":U=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:he!==ve&&ut(a,c,de,he,p,ve)}}Ah(a,M,U,K,fe,ge,x,v);return;case"select":he=M=U=de=null;for(x in f)if(K=f[x],f.hasOwnProperty(x)&&K!=null)switch(x){case"value":break;case"multiple":he=K;default:p.hasOwnProperty(x)||ut(a,c,x,null,p,K)}for(v in p)if(x=p[v],K=f[v],p.hasOwnProperty(v)&&(x!=null||K!=null))switch(v){case"value":de=x;break;case"defaultValue":U=x;break;case"multiple":M=x;default:x!==K&&ut(a,c,v,x,p,K)}c=U,f=M,p=he,de!=null?pa(a,!!f,de,!1):!!p!=!!f&&(c!=null?pa(a,!!f,c,!0):pa(a,!!f,f?[]:"",!1));return;case"textarea":he=de=null;for(U in f)if(v=f[U],f.hasOwnProperty(U)&&v!=null&&!p.hasOwnProperty(U))switch(U){case"value":break;case"children":break;default:ut(a,c,U,null,p,v)}for(M in p)if(v=p[M],x=f[M],p.hasOwnProperty(M)&&(v!=null||x!=null))switch(M){case"value":de=v;break;case"defaultValue":he=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==x&&ut(a,c,M,v,p,x)}R2(a,de,he);return;case"option":for(var Be in f)if(de=f[Be],f.hasOwnProperty(Be)&&de!=null&&!p.hasOwnProperty(Be))switch(Be){case"selected":a.selected=!1;break;default:ut(a,c,Be,null,p,de)}for(K in p)if(de=p[K],he=f[K],p.hasOwnProperty(K)&&de!==he&&(de!=null||he!=null))switch(K){case"selected":a.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:ut(a,c,K,de,p,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var De in f)de=f[De],f.hasOwnProperty(De)&&de!=null&&!p.hasOwnProperty(De)&&ut(a,c,De,null,p,de);for(fe in p)if(de=p[fe],he=f[fe],p.hasOwnProperty(fe)&&de!==he&&(de!=null||he!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,c));break;default:ut(a,c,fe,de,p,he)}return;default:if(Ch(c)){for(var ft in f)de=f[ft],f.hasOwnProperty(ft)&&de!==void 0&&!p.hasOwnProperty(ft)&&dg(a,c,ft,void 0,p,de);for(ge in p)de=p[ge],he=f[ge],!p.hasOwnProperty(ge)||de===he||de===void 0&&he===void 0||dg(a,c,ge,de,p,he);return}}for(var se in f)de=f[se],f.hasOwnProperty(se)&&de!=null&&!p.hasOwnProperty(se)&&ut(a,c,se,null,p,de);for(ve in p)de=p[ve],he=f[ve],!p.hasOwnProperty(ve)||de===he||de==null&&he==null||ut(a,c,ve,de,p,he)}var hg=null,pg=null;function Uu(a){return a.nodeType===9?a:a.ownerDocument}function NS(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function kS(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function gg(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var mg=null;function aL(){var a=window.event;return a&&a.type==="popstate"?a===mg?!1:(mg=a,!0):(mg=null,!1)}var MS=typeof setTimeout=="function"?setTimeout:void 0,oL=typeof clearTimeout=="function"?clearTimeout:void 0,IS=typeof Promise=="function"?Promise:void 0,lL=typeof queueMicrotask=="function"?queueMicrotask:typeof IS<"u"?function(a){return IS.resolve(null).then(a).catch(cL)}:MS;function cL(a){setTimeout(function(){throw a})}function Ui(a){return a==="head"}function OS(a,c){var f=c,p=0,v=0;do{var x=f.nextSibling;if(a.removeChild(f),x&&x.nodeType===8)if(f=x.data,f==="/$"){if(0<p&&8>p){f=p;var M=a.ownerDocument;if(f&1&&Sl(M.documentElement),f&2&&Sl(M.body),f&4)for(f=M.head,Sl(f),M=f.firstChild;M;){var U=M.nextSibling,K=M.nodeName;M[Uo]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&M.rel.toLowerCase()==="stylesheet"||f.removeChild(M),M=U}}if(v===0){a.removeChild(x),Il(c);return}v--}else f==="$"||f==="$?"||f==="$!"?v++:p=f.charCodeAt(0)-48;else p=0;f=x}while(f);Il(c)}function _g(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":_g(f),wh(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function uL(a,c,f,p){for(;a.nodeType===1;){var v=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Uo])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(x=a.getAttribute("rel"),x==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(x!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(x=a.getAttribute("src"),(x!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&x&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var x=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===x)return a}else return a;if(a=wr(a.nextSibling),a===null)break}return null}function fL(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=wr(a.nextSibling),a===null))return null;return a}function vg(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function dL(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function wr(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var yg=null;function PS(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function DS(a,c,f){switch(c=Uu(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Sl(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);wh(a)}var or=new Map,jS=new Set;function Fu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var fi=Q.d;Q.d={f:hL,r:pL,D:gL,C:mL,L:_L,m:vL,X:xL,S:yL,M:bL};function hL(){var a=fi.f(),c=Mu();return a||c}function pL(a){var c=ua(a);c!==null&&c.tag===5&&c.type==="form"?nT(c):fi.r(a)}var Va=typeof document>"u"?null:document;function LS(a,c,f){var p=Va;if(p&&typeof c=="string"&&c){var v=er(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof f=="string"&&(v+='[crossorigin="'+f+'"]'),jS.has(v)||(jS.add(v),a={rel:a,crossOrigin:f,href:c},p.querySelector(v)===null&&(c=p.createElement("link"),dn(c,"link",a),sn(c),p.head.appendChild(c)))}}function gL(a){fi.D(a),LS("dns-prefetch",a,null)}function mL(a,c){fi.C(a,c),LS("preconnect",a,c)}function _L(a,c,f){fi.L(a,c,f);var p=Va;if(p&&a&&c){var v='link[rel="preload"][as="'+er(c)+'"]';c==="image"&&f&&f.imageSrcSet?(v+='[imagesrcset="'+er(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(v+='[imagesizes="'+er(f.imageSizes)+'"]')):v+='[href="'+er(a)+'"]';var x=v;switch(c){case"style":x=Ha(a);break;case"script":x=Wa(a)}or.has(x)||(a=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),or.set(x,a),p.querySelector(v)!==null||c==="style"&&p.querySelector(El(x))||c==="script"&&p.querySelector(Al(x))||(c=p.createElement("link"),dn(c,"link",a),sn(c),p.head.appendChild(c)))}}function vL(a,c){fi.m(a,c);var f=Va;if(f&&a){var p=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+er(p)+'"][href="'+er(a)+'"]',x=v;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=Wa(a)}if(!or.has(x)&&(a=h({rel:"modulepreload",href:a},c),or.set(x,a),f.querySelector(v)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(Al(x)))return}p=f.createElement("link"),dn(p,"link",a),sn(p),f.head.appendChild(p)}}}function yL(a,c,f){fi.S(a,c,f);var p=Va;if(p&&a){var v=fa(p).hoistableStyles,x=Ha(a);c=c||"default";var M=v.get(x);if(!M){var U={loading:0,preload:null};if(M=p.querySelector(El(x)))U.loading=5;else{a=h({rel:"stylesheet",href:a,"data-precedence":c},f),(f=or.get(x))&&xg(a,f);var K=M=p.createElement("link");sn(K),dn(K,"link",a),K._p=new Promise(function(fe,ge){K.onload=fe,K.onerror=ge}),K.addEventListener("load",function(){U.loading|=1}),K.addEventListener("error",function(){U.loading|=2}),U.loading|=4,zu(M,c,p)}M={type:"stylesheet",instance:M,count:1,state:U},v.set(x,M)}}}function xL(a,c){fi.X(a,c);var f=Va;if(f&&a){var p=fa(f).hoistableScripts,v=Wa(a),x=p.get(v);x||(x=f.querySelector(Al(v)),x||(a=h({src:a,async:!0},c),(c=or.get(v))&&bg(a,c),x=f.createElement("script"),sn(x),dn(x,"link",a),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(v,x))}}function bL(a,c){fi.M(a,c);var f=Va;if(f&&a){var p=fa(f).hoistableScripts,v=Wa(a),x=p.get(v);x||(x=f.querySelector(Al(v)),x||(a=h({src:a,async:!0,type:"module"},c),(c=or.get(v))&&bg(a,c),x=f.createElement("script"),sn(x),dn(x,"link",a),f.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},p.set(v,x))}}function BS(a,c,f,p){var v=(v=J.current)?Fu(v):null;if(!v)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ha(f.href),f=fa(v).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ha(f.href);var x=fa(v).hoistableStyles,M=x.get(a);if(M||(v=v.ownerDocument||v,M={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(a,M),(x=v.querySelector(El(a)))&&!x._p&&(M.instance=x,M.state.loading=5),or.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},or.set(a,f),x||wL(v,a,f,M.state))),c&&p===null)throw Error(r(528,""));return M}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Wa(f),f=fa(v).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Ha(a){return'href="'+er(a)+'"'}function El(a){return'link[rel="stylesheet"]['+a+"]"}function US(a){return h({},a,{"data-precedence":a.precedence,precedence:null})}function wL(a,c,f,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),dn(c,"link",f),sn(c),a.head.appendChild(c))}function Wa(a){return'[src="'+er(a)+'"]'}function Al(a){return"script[async]"+a}function FS(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+er(f.href)+'"]');if(p)return c.instance=p,sn(p),p;var v=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),sn(p),dn(p,"style",v),zu(p,f.precedence,a),c.instance=p;case"stylesheet":v=Ha(f.href);var x=a.querySelector(El(v));if(x)return c.state.loading|=4,c.instance=x,sn(x),x;p=US(f),(v=or.get(v))&&xg(p,v),x=(a.ownerDocument||a).createElement("link"),sn(x);var M=x;return M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),dn(x,"link",p),c.state.loading|=4,zu(x,f.precedence,a),c.instance=x;case"script":return x=Wa(f.src),(v=a.querySelector(Al(x)))?(c.instance=v,sn(v),v):(p=f,(v=or.get(x))&&(p=h({},f),bg(p,v)),a=a.ownerDocument||a,v=a.createElement("script"),sn(v),dn(v,"link",p),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,zu(p,f.precedence,a));return c.instance}function zu(a,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=p.length?p[p.length-1]:null,x=v,M=0;M<p.length;M++){var U=p[M];if(U.dataset.precedence===c)x=U;else if(x!==v)break}x?x.parentNode.insertBefore(a,x.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function xg(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function bg(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var $u=null;function zS(a,c,f){if($u===null){var p=new Map,v=$u=new Map;v.set(f,p)}else v=$u,p=v.get(f),p||(p=new Map,v.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),v=0;v<f.length;v++){var x=f[v];if(!(x[Uo]||x[mn]||a==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var M=x.getAttribute(c)||"";M=a+M;var U=p.get(M);U?U.push(x):p.set(M,[x])}}return p}function $S(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function TL(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function qS(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Rl=null;function SL(){}function EL(a,c,f){if(Rl===null)throw Error(r(475));var p=Rl;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Ha(f.href),x=a.querySelector(El(v));if(x){a=x._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=qu.bind(p),a.then(p,p)),c.state.loading|=4,c.instance=x,sn(x);return}x=a.ownerDocument||a,f=US(f),(v=or.get(v))&&xg(f,v),x=x.createElement("link"),sn(x);var M=x;M._p=new Promise(function(U,K){M.onload=U,M.onerror=K}),dn(x,"link",f),c.instance=x}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=qu.bind(p),a.addEventListener("load",c),a.addEventListener("error",c))}}function AL(){if(Rl===null)throw Error(r(475));var a=Rl;return a.stylesheets&&a.count===0&&wg(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&wg(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function qu(){if(this.count--,this.count===0){if(this.stylesheets)wg(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Vu=null;function wg(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Vu=new Map,c.forEach(RL,a),Vu=null,qu.call(a))}function RL(a,c){if(!(c.state.loading&4)){var f=Vu.get(a);if(f)var p=f.get(null);else{f=new Map,Vu.set(a,f);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<v.length;x++){var M=v[x];(M.nodeName==="LINK"||M.getAttribute("media")!=="not all")&&(f.set(M.dataset.precedence,M),p=M)}p&&f.set(null,p)}v=c.instance,M=v.getAttribute("data-precedence"),x=f.get(M)||p,x===p&&f.set(null,v),f.set(M,v),this.count++,p=qu.bind(this),v.addEventListener("load",p),v.addEventListener("error",p),x?x.parentNode.insertBefore(v,x.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var Cl={$$typeof:R,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function CL(a,c,f,p,v,x,M,U){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=it(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=it(0),this.hiddenUpdates=it(null),this.identifierPrefix=p,this.onUncaughtError=v,this.onCaughtError=x,this.onRecoverableError=M,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function VS(a,c,f,p,v,x,M,U,K,fe,ge,ve){return a=new CL(a,c,f,M,U,K,fe,ve),c=1,x===!0&&(c|=24),x=Un(3,null,null,c),a.current=x,x.stateNode=a,c=rp(),c.refCount++,a.pooledCache=c,c.refCount++,x.memoizedState={element:p,isDehydrated:f,cache:c},op(x),a}function HS(a){return a?(a=Ta,a):Ta}function WS(a,c,f,p,v,x){v=HS(v),p.context===null?p.context=v:p.pendingContext=v,p=Ai(c),p.payload={element:f},x=x===void 0?null:x,x!==null&&(p.callback=x),f=Ri(a,p,c),f!==null&&(Vn(f,a,c),il(f,a,c))}function XS(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function Tg(a,c){XS(a,c),(a=a.alternate)&&XS(a,c)}function YS(a){if(a.tag===13){var c=wa(a,67108864);c!==null&&Vn(c,a,67108864),Tg(a,67108864)}}var Hu=!0;function NL(a,c,f,p){var v=z.T;z.T=null;var x=Q.p;try{Q.p=2,Sg(a,c,f,p)}finally{Q.p=x,z.T=v}}function kL(a,c,f,p){var v=z.T;z.T=null;var x=Q.p;try{Q.p=8,Sg(a,c,f,p)}finally{Q.p=x,z.T=v}}function Sg(a,c,f,p){if(Hu){var v=Eg(p);if(v===null)fg(a,c,p,Wu,f),KS(a,p);else if(IL(v,a,c,f,p))p.stopPropagation();else if(KS(a,p),c&4&&-1<ML.indexOf(a)){for(;v!==null;){var x=ua(v);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var M=kn(x.pendingLanes);if(M!==0){var U=x;for(U.pendingLanes|=2,U.entangledLanes|=2;M;){var K=1<<31-xt(M);U.entanglements[1]|=K,M&=~K}Br(x),(at&6)===0&&(Nu=Me()+500,bl(0))}}break;case 13:U=wa(x,2),U!==null&&Vn(U,x,2),Mu(),Tg(x,2)}if(x=Eg(p),x===null&&fg(a,c,p,Wu,f),x===v)break;v=x}v!==null&&p.stopPropagation()}else fg(a,c,p,null,f)}}function Eg(a){return a=kh(a),Ag(a)}var Wu=null;function Ag(a){if(Wu=null,a=ca(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Wu=a,null}function GS(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nn()){case Mt:return 2;case Rt:return 8;case Ke:case rn:return 32;case Ye:return 268435456;default:return 32}default:return 32}}var Rg=!1,Fi=null,zi=null,$i=null,Nl=new Map,kl=new Map,qi=[],ML="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function KS(a,c){switch(a){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":zi=null;break;case"mouseover":case"mouseout":$i=null;break;case"pointerover":case"pointerout":Nl.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":kl.delete(c.pointerId)}}function Ml(a,c,f,p,v,x){return a===null||a.nativeEvent!==x?(a={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:x,targetContainers:[v]},c!==null&&(c=ua(c),c!==null&&YS(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function IL(a,c,f,p,v){switch(c){case"focusin":return Fi=Ml(Fi,a,c,f,p,v),!0;case"dragenter":return zi=Ml(zi,a,c,f,p,v),!0;case"mouseover":return $i=Ml($i,a,c,f,p,v),!0;case"pointerover":var x=v.pointerId;return Nl.set(x,Ml(Nl.get(x)||null,a,c,f,p,v)),!0;case"gotpointercapture":return x=v.pointerId,kl.set(x,Ml(kl.get(x)||null,a,c,f,p,v)),!0}return!1}function ZS(a){var c=ca(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,Ej(a.priority,function(){if(f.tag===13){var p=qn();p=yh(p);var v=wa(f,p);v!==null&&Vn(v,f,p),Tg(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xu(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=Eg(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);Nh=p,f.target.dispatchEvent(p),Nh=null}else return c=ua(f),c!==null&&YS(c),a.blockedOn=f,!1;c.shift()}return!0}function QS(a,c,f){Xu(a)&&f.delete(c)}function OL(){Rg=!1,Fi!==null&&Xu(Fi)&&(Fi=null),zi!==null&&Xu(zi)&&(zi=null),$i!==null&&Xu($i)&&($i=null),Nl.forEach(QS),kl.forEach(QS)}function Yu(a,c){a.blockedOn===c&&(a.blockedOn=null,Rg||(Rg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,OL)))}var Gu=null;function JS(a){Gu!==a&&(Gu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Gu===a&&(Gu=null);for(var c=0;c<a.length;c+=3){var f=a[c],p=a[c+1],v=a[c+2];if(typeof p!="function"){if(Ag(p||f)===null)continue;break}var x=ua(f);x!==null&&(a.splice(c,3),c-=3,Ap(x,{pending:!0,data:v,method:f.method,action:p},p,v))}}))}function Il(a){function c(K){return Yu(K,a)}Fi!==null&&Yu(Fi,a),zi!==null&&Yu(zi,a),$i!==null&&Yu($i,a),Nl.forEach(c),kl.forEach(c);for(var f=0;f<qi.length;f++){var p=qi[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<qi.length&&(f=qi[0],f.blockedOn===null);)ZS(f),f.blockedOn===null&&qi.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var v=f[p],x=f[p+1],M=v[Mn]||null;if(typeof x=="function")M||JS(f);else if(M){var U=null;if(x&&x.hasAttribute("formAction")){if(v=x,M=x[Mn]||null)U=M.formAction;else if(Ag(v)!==null)continue}else U=M.action;typeof U=="function"?f[p+1]=U:(f.splice(p,3),p-=3),JS(f)}}}function Cg(a){this._internalRoot=a}Ku.prototype.render=Cg.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=qn();WS(f,p,a,c,null,null)},Ku.prototype.unmount=Cg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;WS(a.current,2,null,a,null,null),Mu(),c[la]=null}};function Ku(a){this._internalRoot=a}Ku.prototype.unstable_scheduleHydration=function(a){if(a){var c=m2();a={blockedOn:null,target:a,priority:c};for(var f=0;f<qi.length&&c!==0&&c<qi[f].priority;f++);qi.splice(f,0,a),f===0&&ZS(a)}};var e3=e.version;if(e3!=="19.1.0")throw Error(r(527,e3,"19.1.0"));Q.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var PL={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zu.isDisabled&&Zu.supportsFiber)try{rt=Zu.inject(PL),He=Zu}catch{}}return Pl.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,p="",v=mT,x=_T,M=vT,U=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(x=c.onCaughtError),c.onRecoverableError!==void 0&&(M=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(U=c.unstable_transitionCallbacks)),c=VS(a,1,!1,null,null,f,p,v,x,M,U,null),a[la]=c.current,ug(a),new Cg(c)},Pl.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var p=!1,v="",x=mT,M=_T,U=vT,K=null,fe=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(x=f.onUncaughtError),f.onCaughtError!==void 0&&(M=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(K=f.unstable_transitionCallbacks),f.formState!==void 0&&(fe=f.formState)),c=VS(a,1,!0,c,f??null,p,v,x,M,U,K,fe),c.context=HS(null),f=c.current,p=qn(),p=yh(p),v=Ai(p),v.callback=null,Ri(f,v,p),f=p,c.current.lanes=f,bt(c,f),Br(c),a[la]=c.current,ug(a),new Ku(c)},Pl.version="19.1.0",Pl}var u3;function WL(){if(u3)return kg.exports;u3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),kg.exports=HL(),kg.exports}var XL=WL(),j=n1();const hc=t1(j),YL=BL({__proto__:null,default:hc},[j]);B4();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pc(){return pc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pc.apply(this,arguments)}var es;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(es||(es={}));const f3="popstate";function GL(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return Yb("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:F4(i)}return ZL(e,n,null,t)}function tn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function U4(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function KL(){return Math.random().toString(36).substr(2,8)}function d3(t,e){return{usr:t.state,key:t.key,idx:e}}function Yb(t,e,n,r){return n===void 0&&(n=null),pc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Co(e):e,{state:n,key:e&&e.key||r||KL()})}function F4(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Co(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function ZL(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l=es.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(pc({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function m(){l=es.Pop;let b=h(),S=b==null?null:b-d;d=b,u&&u({action:l,location:w.location,delta:S})}function _(b,S){l=es.Push;let A=Yb(w.location,b,S);d=h()+1;let R=d3(A,d),E=w.createHref(A);try{o.pushState(R,"",E)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(E)}s&&u&&u({action:l,location:w.location,delta:1})}function y(b,S){l=es.Replace;let A=Yb(w.location,b,S);d=h();let R=d3(A,d),E=w.createHref(A);o.replaceState(R,"",E),s&&u&&u({action:l,location:w.location,delta:0})}function T(b){let S=i.location.origin!=="null"?i.location.origin:i.location.href,A=typeof b=="string"?b:F4(b);return A=A.replace(/ $/,"%20"),tn(S,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,S)}let w={get action(){return l},get location(){return t(i,o)},listen(b){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(f3,m),u=b,()=>{i.removeEventListener(f3,m),u=null}},createHref(b){return e(i,b)},createURL:T,encodeLocation(b){let S=T(b);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:_,replace:y,go(b){return o.go(b)}};return w}var h3;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(h3||(h3={}));function QL(t,e,n){return n===void 0&&(n="/"),JL(t,e,n)}function JL(t,e,n,r){let i=typeof e=="string"?Co(e):e,s=q4(i.pathname||"/",n);if(s==null)return null;let o=z4(t);eB(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=dB(s);l=cB(o[u],d)}return l}function z4(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,o,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(tn(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=Ls([r,u.relativePath]),h=n.concat(u);s.children&&s.children.length>0&&(tn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),z4(s.children,e,h,d)),!(s.path==null&&!s.index)&&e.push({path:d,score:oB(d,s.index),routesMeta:h})};return t.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,o);else for(let u of $4(s.path))i(s,o,u)}),e}function $4(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=$4(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function eB(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:lB(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const tB=/^:[\w-]+$/,nB=3,rB=2,iB=1,sB=10,aB=-2,p3=t=>t==="*";function oB(t,e){let n=t.split("/"),r=n.length;return n.some(p3)&&(r+=aB),e&&(r+=rB),n.filter(i=>!p3(i)).reduce((i,s)=>i+(tB.test(s)?nB:s===""?iB:sB),r)}function lB(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function cB(t,e,n){let{routesMeta:r}=t,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",m=uB({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),_=u.route;if(!m)return null;Object.assign(i,m.params),o.push({params:i,pathname:Ls([s,m.pathname]),pathnameBase:vB(Ls([s,m.pathnameBase])),route:_}),m.pathnameBase!=="/"&&(s=Ls([s,m.pathnameBase]))}return o}function uB(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=fB(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,h,m)=>{let{paramName:_,isOptional:y}=h;if(_==="*"){let w=l[m]||"";o=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const T=l[m];return y&&!T?d[_]=void 0:d[_]=(T||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:t}}function fB(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),U4(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function dB(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return U4(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function q4(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function hB(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Co(t):t;return{pathname:n?n.startsWith("/")?n:pB(n,e):e,search:yB(r),hash:xB(i)}}function pB(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Dg(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function gB(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function mB(t,e){let n=gB(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function _B(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=Co(t):(i=pc({},t),tn(!i.pathname||!i.pathname.includes("?"),Dg("?","pathname","search",i)),tn(!i.pathname||!i.pathname.includes("#"),Dg("#","pathname","hash",i)),tn(!i.search||!i.search.includes("#"),Dg("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=n;else{let m=e.length-1;if(!r&&o.startsWith("..")){let _=o.split("/");for(;_[0]==="..";)_.shift(),m-=1;i.pathname=_.join("/")}l=m>=0?e[m]:"/"}let u=hB(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const Ls=t=>t.join("/").replace(/\/\/+/g,"/"),vB=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),yB=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,xB=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function bB(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const V4=["post","put","patch","delete"];new Set(V4);const wB=["get",...V4];new Set(wB);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gc(){return gc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},gc.apply(this,arguments)}const r1=j.createContext(null),TB=j.createContext(null),jd=j.createContext(null),Ld=j.createContext(null),Zs=j.createContext({outlet:null,matches:[],isDataRoute:!1}),H4=j.createContext(null);function Bd(){return j.useContext(Ld)!=null}function No(){return Bd()||tn(!1),j.useContext(Ld).location}function W4(t){j.useContext(jd).static||j.useLayoutEffect(t)}function cs(){let{isDataRoute:t}=j.useContext(Zs);return t?jB():SB()}function SB(){Bd()||tn(!1);let t=j.useContext(r1),{basename:e,future:n,navigator:r}=j.useContext(jd),{matches:i}=j.useContext(Zs),{pathname:s}=No(),o=JSON.stringify(mB(i,n.v7_relativeSplatPath)),l=j.useRef(!1);return W4(()=>{l.current=!0}),j.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let m=_B(d,JSON.parse(o),s,h.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Ls([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,o,s,t])}function i1(){let{matches:t}=j.useContext(Zs),e=t[t.length-1];return e?e.params:{}}function EB(t,e){return AB(t,e)}function AB(t,e,n,r){Bd()||tn(!1);let{navigator:i}=j.useContext(jd),{matches:s}=j.useContext(Zs),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=No(),h;if(e){var m;let b=typeof e=="string"?Co(e):e;u==="/"||(m=b.pathname)!=null&&m.startsWith(u)||tn(!1),h=b}else h=d;let _=h.pathname||"/",y=_;if(u!=="/"){let b=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(b.length).join("/")}let T=QL(t,{pathname:y}),w=MB(T&&T.map(b=>Object.assign({},b,{params:Object.assign({},l,b.params),pathname:Ls([u,i.encodeLocation?i.encodeLocation(b.pathname).pathname:b.pathname]),pathnameBase:b.pathnameBase==="/"?u:Ls([u,i.encodeLocation?i.encodeLocation(b.pathnameBase).pathname:b.pathnameBase])})),s,n,r);return e&&w?j.createElement(Ld.Provider,{value:{location:gc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:es.Pop}},w):w}function RB(){let t=DB(),e=bB(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},e),n?j.createElement("pre",{style:i},n):null,null)}const CB=j.createElement(RB,null);class NB extends j.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?j.createElement(Zs.Provider,{value:this.props.routeContext},j.createElement(H4.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function kB(t){let{routeContext:e,match:n,children:r}=t,i=j.useContext(r1);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),j.createElement(Zs.Provider,{value:e},r)}function MB(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(i=n)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);h>=0||tn(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let m=o[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:_,errors:y}=n,T=m.route.loader&&_[m.route.id]===void 0&&(!y||y[m.route.id]===void 0);if(m.route.lazy||T){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,m,_)=>{let y,T=!1,w=null,b=null;n&&(y=l&&m.route.id?l[m.route.id]:void 0,w=m.route.errorElement||CB,u&&(d<0&&_===0?(LB("route-fallback"),T=!0,b=null):d===_&&(T=!0,b=m.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,_+1)),A=()=>{let R;return y?R=w:T?R=b:m.route.Component?R=j.createElement(m.route.Component,null):m.route.element?R=m.route.element:R=h,j.createElement(kB,{match:m,routeContext:{outlet:h,matches:S,isDataRoute:n!=null},children:R})};return n&&(m.route.ErrorBoundary||m.route.errorElement||_===0)?j.createElement(NB,{location:n.location,revalidation:n.revalidation,component:w,error:y,children:A(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):A()},null)}var X4=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(X4||{}),Y4=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Y4||{});function IB(t){let e=j.useContext(r1);return e||tn(!1),e}function OB(t){let e=j.useContext(TB);return e||tn(!1),e}function PB(t){let e=j.useContext(Zs);return e||tn(!1),e}function G4(t){let e=PB(),n=e.matches[e.matches.length-1];return n.route.id||tn(!1),n.route.id}function DB(){var t;let e=j.useContext(H4),n=OB(),r=G4();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function jB(){let{router:t}=IB(X4.UseNavigateStable),e=G4(Y4.UseNavigateStable),n=j.useRef(!1);return W4(()=>{n.current=!0}),j.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,gc({fromRouteId:e},s)))},[t,e])}const g3={};function LB(t,e,n){g3[t]||(g3[t]=!0)}function BB(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function no(t){tn(!1)}function UB(t){let{basename:e="/",children:n=null,location:r,navigationType:i=es.Pop,navigator:s,static:o=!1,future:l}=t;Bd()&&tn(!1);let u=e.replace(/^\/*/,"/"),d=j.useMemo(()=>({basename:u,navigator:s,static:o,future:gc({v7_relativeSplatPath:!1},l)}),[u,l,s,o]);typeof r=="string"&&(r=Co(r));let{pathname:h="/",search:m="",hash:_="",state:y=null,key:T="default"}=r,w=j.useMemo(()=>{let b=q4(h,u);return b==null?null:{location:{pathname:b,search:m,hash:_,state:y,key:T},navigationType:i}},[u,h,m,_,y,T,i]);return w==null?null:j.createElement(jd.Provider,{value:d},j.createElement(Ld.Provider,{children:n,value:w}))}function FB(t){let{children:e,location:n}=t;return EB(Gb(e),n)}new Promise(()=>{});function Gb(t,e){e===void 0&&(e=[]);let n=[];return j.Children.forEach(t,(r,i)=>{if(!j.isValidElement(r))return;let s=[...e,i];if(r.type===j.Fragment){n.push.apply(n,Gb(r.props.children,s));return}r.type!==no&&tn(!1),!r.props.index||!r.props.children||tn(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Gb(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kb(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function zB(t,e){let n=Kb(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(s=>{n.append(i,s)})}),n}const $B="6";try{window.__reactRouterVersion=$B}catch{}const qB="startTransition",m3=YL[qB];function VB(t){let{basename:e,children:n,future:r,window:i}=t,s=j.useRef();s.current==null&&(s.current=GL({window:i,v5Compat:!0}));let o=s.current,[l,u]=j.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=j.useCallback(m=>{d&&m3?m3(()=>u(m)):u(m)},[u,d]);return j.useLayoutEffect(()=>o.listen(h),[o,h]),j.useEffect(()=>BB(r),[r]),j.createElement(UB,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}var _3;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(_3||(_3={}));var v3;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(v3||(v3={}));function HB(t){let e=j.useRef(Kb(t)),n=j.useRef(!1),r=No(),i=j.useMemo(()=>zB(r.search,n.current?null:e.current),[r.search]),s=cs(),o=j.useCallback((l,u)=>{const d=Kb(typeof l=="function"?l(i):l);n.current=!0,s("?"+d,u)},[s,i]);return[i,o]}const WB=()=>(console.log("Using default API base: /api"),"/api"),yn={BASE_URL:WB(),ENDPOINTS:{CREATE_SESSION:"/create-session",GET_SESSION:"/session",UPLOAD:"/upload-tree-sequence",UPLOADED_FILES:"/uploaded-files/",TREE_SEQUENCE_METADATA:"/tree-sequence-metadata",DELETE_TREE_SEQUENCE:"/tree-sequence",DOWNLOAD_TREE_SEQUENCE:"/download-tree-sequence",GRAPH_DATA:"/graph-data",INFER_LOCATIONS_FAST:"/infer-locations-fast",INFER_LOCATIONS_GAIA_QUADRATIC:"/infer-locations-gaia-quadratic",INFER_LOCATIONS_MIDPOINT:"/infer-locations-midpoint",INFER_LOCATIONS_SPARG:"/infer-locations-sparg",INFER_TIMES_TSDATE:"/infer-times-tsdate",SIMULATE_TREE_SEQUENCE:"/simulate-tree-sequence/"}},XB={LOADING_DOTS_INTERVAL:420},ts={DEFAULT_MAX_SAMPLES:25,MIN_SAMPLES:2,WARNING_THRESHOLD:25},jg={ACCEPTED_FORMATS:{"application/octet-stream":[".trees",".tsz"],"application/x-trees":[".trees"],"application/x-tsz":[".tsz"]},CSV_FORMATS:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]}},Dl={UPLOAD_FAILED:"Upload failed",DOWNLOAD_FAILED:"Download failed",FETCH_FAILED:"Failed to fetch data",NO_SPATIAL_DATA:"No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.",NO_SPATIAL_RANGE:"No spatial data found in this genomic range.",UNKNOWN_ERROR:"Unknown error occurred"},K4=j.createContext(void 0);function YB({children:t}){const[e,n]=j.useState(null),[r,i]=j.useState(ts.DEFAULT_MAX_SAMPLES),s=l=>{if(n(l),l!=null&&l.num_samples){const u=Math.min(ts.DEFAULT_MAX_SAMPLES,l.num_samples);i(u)}},o=l=>{if(e!=null&&e.num_samples){const u=Math.max(ts.MIN_SAMPLES,Math.min(l,e.num_samples));i(u)}else i(Math.min(l,ts.DEFAULT_MAX_SAMPLES))};return g.jsx(K4.Provider,{value:{treeSequence:e,setTreeSequence:s,maxSamples:r,setMaxSamples:o},children:t})}function Qs(){const t=j.useContext(K4);if(t===void 0)throw new Error("useTreeSequence must be used within a TreeSequenceProvider");return t}var Z4=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t))(Z4||{});class GB{constructor(){B(this,"logLevel");B(this,"isDevelopment");this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:2}shouldLog(e){return e>=this.logLevel}formatMessage(e,n,r){const i=new Date().toISOString(),s=r!=null&&r.component?`[${r.component}]`:"",o=r!=null&&r.action?`(${r.action})`:"";return`[${i}] ${e} ${s}${o} ${n}`}logToConsole(e,n,r,i){const s=Z4[e],o=this.formatMessage(s,n,r);switch(e){case 0:console.debug(o,r==null?void 0:r.data);break;case 1:console.info(o,r==null?void 0:r.data);break;case 2:console.warn(o,r==null?void 0:r.data);break;case 3:console.error(o,i||(r==null?void 0:r.error),r==null?void 0:r.data);break}}debug(e,n){this.shouldLog(0)&&this.logToConsole(0,e,n)}info(e,n){this.shouldLog(1)&&this.logToConsole(1,e,n)}warn(e,n){this.shouldLog(2)&&this.logToConsole(2,e,n)}error(e,n){this.shouldLog(3)&&this.logToConsole(3,e,n,n==null?void 0:n.error)}apiCall(e,n="GET",r){this.debug(`API ${n} ${e}`,{action:"api-call",data:{endpoint:e,method:n,payload:r}})}apiSuccess(e,n="GET",r){this.info(`API ${n} ${e} succeeded`,{action:"api-success",data:{endpoint:e,method:n,response:r}})}apiError(e,n,r="GET"){this.error(`API ${r} ${e} failed`,{action:"api-error",error:n,data:{endpoint:e,method:r}})}componentMount(e,n){this.debug(`${e} mounted`,{component:e,action:"mount",data:n})}componentUnmount(e){this.debug(`${e} unmounted`,{component:e,action:"unmount"})}userAction(e,n,r){this.info(`User action: ${e}`,{component:r,action:"user-action",data:n})}dataProcessing(e,n,r,i){this.debug(`Data processing: ${e}`,{component:n,action:"data-processing",data:{operation:e,inputSize:r,outputSize:i}})}navigation(e,n){this.info(`Navigation: ${e} → ${n}`,{action:"navigation",data:{from:e,to:n}})}performance(e,n,r){this.info(`Performance: ${e} took ${n}ms`,{component:r,action:"performance",data:{operation:e,duration:n}})}}const Hn=new GB,Re={debug:(t,e)=>Hn.debug(t,e),info:(t,e)=>Hn.info(t,e),warn:(t,e)=>Hn.warn(t,e),error:(t,e)=>Hn.error(t,e),api:{call:(t,e,n)=>Hn.apiCall(t,e,n),success:(t,e,n)=>Hn.apiSuccess(t,e,n),error:(t,e,n)=>Hn.apiError(t,e,n)},component:{mount:(t,e)=>Hn.componentMount(t,e),unmount:t=>Hn.componentUnmount(t)},user:{action:(t,e,n)=>Hn.userAction(t,e,n)},data:{processing:(t,e,n,r)=>Hn.dataProcessing(t,e,n,r)},nav:(t,e)=>Hn.navigation(t,e),perf:(t,e,n)=>Hn.performance(t,e,n)};class KB{constructor(){B(this,"baseURL");this.baseURL=yn.BASE_URL}async request(e,n={}){const r=`${this.baseURL}${e}`,i=n.method||"GET";Re.api.call(e,i,n.body);try{const s=new AbortController,o=setTimeout(()=>s.abort(),6e4),l=await fetch(r,{...n,headers:{"Content-Type":"application/json",...n.headers},signal:s.signal});if(clearTimeout(o),!l.ok){const d=await l.json().catch(()=>null),h={message:`HTTP error! status: ${l.status}`,status:l.status,details:(d==null?void 0:d.detail)||"No details available"};throw Re.api.error(e,new Error(h.message),i),h}const u=await l.json();return Re.api.success(e,i,u),{data:u,status:l.status}}catch(s){if(s instanceof Error){if(s.name==="AbortError"){const l=new Error("Request timed out after 60 seconds");throw Re.api.error(e,l,i),l}throw Re.api.error(e,s,i),s}const o={message:Dl.UNKNOWN_ERROR,details:String(s)};throw Re.api.error(e,new Error(o.message),i),o}}async uploadFile(e,n){const r=`${this.baseURL}${e}`,i=new FormData;i.append("file",n),Re.api.call(e,"POST",{filename:n.name,size:n.size});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok)throw new Error(Dl.UPLOAD_FAILED);const o=await s.json();return Re.api.success(e,"POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:Dl.UPLOAD_FAILED;throw Re.api.error(e,new Error(o),"POST"),s}}async getCurrentSession(){return this.request(yn.ENDPOINTS.GET_SESSION)}async uploadTreeSequence(e){return this.uploadFile(yn.ENDPOINTS.UPLOAD,e)}async getUploadedFiles(){return this.request(yn.ENDPOINTS.UPLOADED_FILES)}async getTreeSequenceMetadata(e){return this.request(`${yn.ENDPOINTS.TREE_SEQUENCE_METADATA}/${encodeURIComponent(e)}`)}async deleteTreeSequence(e){return this.request(`${yn.ENDPOINTS.DELETE_TREE_SEQUENCE}/${encodeURIComponent(e)}`,{method:"DELETE"})}async downloadTreeSequence(e,n="trees"){const r=`${this.baseURL}${yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE}/${encodeURIComponent(e)}?format=${n}`;Re.api.call(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{filename:e,format:n});try{const i=await fetch(r);if(!i.ok)throw new Error(Dl.DOWNLOAD_FAILED);const s=await i.blob();return Re.api.success(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{size:s.size,format:n}),s}catch(i){const s=i instanceof Error?i.message:Dl.DOWNLOAD_FAILED;throw Re.api.error(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,new Error(s),"GET"),i}}async getGraphData(e,n={}){const r=new URLSearchParams;n.maxSamples&&r.append("max_samples",n.maxSamples.toString()),n.genomicStart!==void 0&&r.append("genomic_start",n.genomicStart.toString()),n.genomicEnd!==void 0&&r.append("genomic_end",n.genomicEnd.toString()),n.treeStartIdx!==void 0&&r.append("tree_start_idx",n.treeStartIdx.toString()),n.treeEndIdx!==void 0&&r.append("tree_end_idx",n.treeEndIdx.toString()),n.sampleOrder&&r.append("sample_order",n.sampleOrder);const i=`${yn.ENDPOINTS.GRAPH_DATA}/${encodeURIComponent(e)}?${r}`;return this.request(i)}async inferLocationsFast(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_FAST,{method:"POST",body:JSON.stringify(e)})}async inferLocationsSparg(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_SPARG,{method:"POST",body:JSON.stringify(e)})}async inferLocationsGaiaQuadratic(e){return this.request("/infer-locations-gaia-quadratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsGaiaLinear(e){return this.request("/infer-locations-gaia-linear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsMidpoint(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_MIDPOINT,{method:"POST",body:JSON.stringify(e)})}async simulateTreeSequence(e){return this.request(yn.ENDPOINTS.SIMULATE_TREE_SEQUENCE,{method:"POST",body:JSON.stringify(e)})}async uploadLocationCSV(e,n){const r=`${this.baseURL}/upload-location-csv?csv_type=${n}`,i=new FormData;i.append("file",e),Re.api.call("/upload-location-csv","POST",{filename:e.name,csvType:n});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok){const l=await s.json().catch(()=>null);throw new Error((l==null?void 0:l.detail)||"Failed to upload CSV")}const o=await s.json();return Re.api.success("/upload-location-csv","POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:"Failed to upload CSV";throw Re.api.error("/upload-location-csv",new Error(o),"POST"),s}}async updateTreeSequenceLocations(e){return this.request("/update-tree-sequence-locations",{method:"POST",body:JSON.stringify(e)})}async getAvailableCRS(){return this.request("/geographic/crs")}async getAvailableShapes(){return this.request("/geographic/shapes")}async uploadShapefile(e){return this.uploadFile("/geographic/upload-shapefile",e)}async getShapeData(e){return this.request(`/geographic/shape/${encodeURIComponent(e)}`)}async transformCoordinates(e){return this.request("/geographic/transform-coordinates",{method:"POST",body:JSON.stringify(e)})}async validateSpatialData(e){return this.request("/geographic/validate-spatial",{method:"POST",body:JSON.stringify(e)})}async inferTimesTsdate(e){return this.request(yn.ENDPOINTS.INFER_TIMES_TSDATE,{method:"POST",body:JSON.stringify(e)})}}const Pt=new KB,tt={getCurrentSession:()=>Pt.getCurrentSession(),uploadTreeSequence:t=>Pt.uploadTreeSequence(t),getUploadedFiles:()=>Pt.getUploadedFiles(),getTreeSequenceMetadata:t=>Pt.getTreeSequenceMetadata(t),deleteTreeSequence:t=>Pt.deleteTreeSequence(t),downloadTreeSequence:(t,e="trees")=>Pt.downloadTreeSequence(t,e),getGraphData:(t,e)=>Pt.getGraphData(t,e),inferLocationsFast:t=>Pt.inferLocationsFast(t),inferLocationsSparg:t=>Pt.inferLocationsSparg(t),inferLocationsGaiaQuadratic:t=>Pt.inferLocationsGaiaQuadratic(t),inferLocationsGaiaLinear:t=>Pt.inferLocationsGaiaLinear(t),inferLocationsMidpoint:t=>Pt.inferLocationsMidpoint(t),simulateTreeSequence:t=>Pt.simulateTreeSequence(t),uploadLocationCSV:(t,e)=>Pt.uploadLocationCSV(t,e),updateTreeSequenceLocations:t=>Pt.updateTreeSequenceLocations(t),getAvailableCRS:()=>Pt.getAvailableCRS(),getAvailableShapes:()=>Pt.getAvailableShapes(),uploadShapefile:t=>Pt.uploadShapefile(t),getShapeData:t=>Pt.getShapeData(t),transformCoordinates:t=>Pt.transformCoordinates(t),validateSpatialData:t=>Pt.validateSpatialData(t),inferTimesTsdate:t=>Pt.inferTimesTsdate(t)},y3={tskit:{background:"#03303E",containerBackground:"#0f1419",nodeDefault:[96,160,183,255],nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:[80,160,175,255],nodeSelected:[255,255,255,255],edgeDefault:[153,153,153,102],edgeHighlight:[255,255,255,200],text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"},grayscale:{background:"#ffffff",containerBackground:"#f8f9fa",nodeDefault:[100,100,100,255],nodeRoot:[50,50,50,255],nodeSample:[70,70,70,255],nodeCombined:[120,120,120,255],nodeSelected:[0,0,0,255],edgeDefault:[140,140,140,128],edgeHighlight:[40,40,40,200],text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",exportBackground:"#ffffff",accentPrimary:"#085167",accentSecondary:"#085167",geographicGrid:[140,140,140,102],temporalGrid:[140,140,140,77],tooltipBackground:"rgba(0, 0, 0, 0.9)",tooltipText:"#ffffff",headerText:"#212529",controlPanelText:"#212529",buttonText:"#212529"}},Q4=j.createContext(void 0),Ju="argscape_custom_themes",Lg="argscape_selected_theme",jl="argscape_selected_custom_theme",ZB=({children:t})=>{const[e,n]=j.useState("tskit"),[r,i]=j.useState([]),[s,o]=j.useState(null),[l,u]=j.useState("any");j.useEffect(()=>{try{const b=localStorage.getItem(Ju);b&&i(JSON.parse(b));const S=localStorage.getItem(Lg);S&&(S==="tskit"||S==="grayscale"||S==="custom")&&n(S);const A=localStorage.getItem(jl);A&&o(A)}catch(b){console.warn("Failed to load saved color themes:",b)}},[]);const d=j.useCallback(b=>{n(b),localStorage.setItem(Lg,b)},[]),h=j.useCallback(b=>{o(b),b?localStorage.setItem(jl,b):localStorage.removeItem(jl)},[]),m=j.useCallback((b,S)=>{const A=`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={id:A,name:b,colors:S};return i(E=>{const C=[...E,R];return localStorage.setItem(Ju,JSON.stringify(C)),C}),n("custom"),o(A),localStorage.setItem(Lg,"custom"),localStorage.setItem(jl,A),A},[]),_=j.useCallback(b=>{i(S=>{const A=S.filter(R=>R.id!==b);return localStorage.setItem(Ju,JSON.stringify(A)),A}),s===b&&(o(null),localStorage.removeItem(jl))},[s]),y=j.useCallback((b,S,A)=>{i(R=>{const E=R.map(C=>C.id===b?{...C,name:S,colors:A}:C);return localStorage.setItem(Ju,JSON.stringify(E)),E})},[]),T=hc.useMemo(()=>{if(e==="custom"&&s){const b=r.find(S=>S.id===s);if(b)return b.colors}return y3[e]||y3.tskit},[e,s,r]),w={theme:e,setTheme:d,colors:T,customThemes:r,selectedCustomTheme:s,setSelectedCustomTheme:h,saveCustomTheme:m,deleteCustomTheme:_,updateCustomTheme:y,currentVisualizationType:l,setCurrentVisualizationType:u};return g.jsx(Q4.Provider,{value:w,children:t})},St=()=>{const t=j.useContext(Q4);if(t===void 0)throw new Error("useColorTheme must be used within a ColorThemeProvider");return t},J4=t=>{if(t.startsWith("#")){const n=t.slice(1),r=parseInt(n.substr(0,2),16),i=parseInt(n.substr(2,2),16),s=parseInt(n.substr(4,2),16);return[r,i,s,255]}const e=t.match(/rgba?\(([^)]+)\)/);if(e){const n=e[1].split(",").map(r=>parseFloat(r.trim()));return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round((n[3]??1)*255)]}return[128,128,128,255]},eI=t=>{const e=["background","nodeSample","nodeRoot","nodeDefault","edgeDefault"];switch(t){case"force-directed":return e;case"spatial-3d":return[...e,"geographicGrid","temporalGrid"];case"spatial-diff":return[...e,"geographicGrid","temporalGrid"];case"any":default:return[...e,"geographicGrid","temporalGrid"]}},QB=t=>{const e=["background","containerBackground","nodeDefault","nodeRoot","nodeSample","nodeCombined","nodeSelected","edgeDefault","edgeHighlight","text","textSecondary","border","exportBackground","accentPrimary","accentSecondary","geographicGrid","temporalGrid","tooltipBackground","tooltipText","headerText","controlPanelText","buttonText"],n=eI(t);return e.filter(r=>!n.includes(r))},tI=t=>`#${t[0].toString(16).padStart(2,"0")}${t[1].toString(16).padStart(2,"0")}${t[2].toString(16).padStart(2,"0")}`;function ko({className:t="",style:e={},size:n="medium",showSubtext:r=!1}){const i=cs(),{colors:s}=St(),o=()=>{i("/",{state:{forceIntro:!0}})},l=()=>{switch(n){case"small":return"text-xl md:text-2xl";case"medium":return"text-2xl md:text-3xl";case"large":return"text-[3rem] md:text-[4rem]";default:return"text-2xl md:text-3xl"}};return g.jsxs("div",{className:"cursor-pointer select-none",onClick:o,children:[g.jsxs("h1",{className:`${l()} font-extrabold tracking-tight ${t}`,style:{letterSpacing:"-0.04em",...e},children:["ARG",g.jsx("span",{style:{color:s.accentPrimary},children:"scape"})]}),r&&g.jsx("div",{className:"mt-2 text-center",children:g.jsx("div",{className:"text-sm font-medium",style:{color:s.accentPrimary},children:"Visualizing Ancestral Recombination Graphs"})})]})}function nI({isOpen:t,title:e,message:n,buttonText:r="OK",onClose:i,type:s="info"}){if(j.useEffect(()=>{const h=m=>{m.key==="Escape"&&i()};return t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[t,i]),!t)return null;const o=()=>{switch(s){case"success":return{icon:g.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-green-500/10",buttonColor:"bg-green-600 hover:bg-green-500 text-white"};case"error":return{icon:g.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-red-500/10",buttonColor:"bg-red-600 hover:bg-red-500 text-white"};default:return{icon:g.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-sp-pale-green/10",buttonColor:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}}},{icon:l,bgColor:u,buttonColor:d}=o();return g.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:i}),g.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:g.jsxs("div",{className:"p-6",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u}`,children:l}),g.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),g.jsx("div",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),g.jsx("div",{className:"flex justify-end",children:g.jsx("button",{onClick:i,className:`font-bold py-3 px-6 rounded-xl transition-all duration-200 ${d}`,children:r})})]})})]})}function mc({filename:t,onError:e}){const[n,r]=j.useState(!1),i=async s=>{try{const o=await tt.downloadTreeSequence(t,s),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const d=`${t.replace(/\.(trees|tsz)$/,"")}.${s}`;u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),Re.user.action("download-tree-sequence",{filename:t,format:s},"DownloadDropdown"),r(!1)}catch(o){Re.error("Download failed",{component:"DownloadDropdown",error:o instanceof Error?o:new Error(String(o)),data:{filename:t}}),e&&o instanceof Error&&e(o)}};return g.jsxs("div",{className:"relative",children:[g.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>r(!n),children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download",g.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&g.jsx("div",{className:"absolute z-50 w-48 mt-2 right-0 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:g.jsxs("div",{className:"py-2",children:[g.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("trees"),children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download .trees"]}),g.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("tsz"),children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Download .tsz"]})]})})]})}function rI({isOpen:t,title:e,message:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:s,onCancel:o,type:l="default"}){if(j.useEffect(()=>{const d=h=>{h.key==="Escape"&&o()};return t&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}},[t,o]),!t)return null;const u=l==="danger";return g.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),g.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:g.jsxs("div",{className:"p-6",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u?"bg-red-500/10":"bg-sp-pale-green/10"}`,children:u?g.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):g.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),g.jsx("p",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),g.jsxs("div",{className:"flex gap-3",children:[g.jsx("button",{onClick:o,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:i}),g.jsx("button",{onClick:s,className:`flex-1 font-bold py-3 px-4 rounded-xl transition-all duration-200 ${u?"bg-red-600 hover:bg-red-500 text-white":"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}`,children:r})]})]})})]})}function iI({onSelect:t,className:e=""}){const[n,r]=j.useState([]),[i,s]=j.useState({}),[o,l]=j.useState(!1),[u,d]=j.useState(""),[h,m]=j.useState(new Set),[_,y]=j.useState(-1),{treeSequence:T}=Qs(),[w,b]=j.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default"}),[S,A]=j.useState({isOpen:!1,title:"",message:"",type:"info"}),R=async()=>{var N;l(!0);try{Re.data.processing("fetch-available-tree-sequences","TreeSequenceSelector");const $=(await tt.getUploadedFiles()).data;r($.uploaded_tree_sequences||[]),Re.info(`Loaded ${((N=$.uploaded_tree_sequences)==null?void 0:N.length)||0} tree sequences`,{component:"TreeSequenceSelector",action:"fetch-available"})}catch(L){Re.error("Failed to fetch available tree sequences",{component:"TreeSequenceSelector",error:L instanceof Error?L:new Error(String(L))}),r([])}finally{l(!1)}},E=async N=>{try{Re.data.processing("fetch-metadata","TreeSequenceSelector",void 0,void 0);const $=(await tt.getTreeSequenceMetadata(N)).data;return Re.debug(`Retrieved metadata for ${N}`,{component:"TreeSequenceSelector",data:{filename:N,num_samples:$.num_samples,num_nodes:$.num_nodes,num_mutations:$.num_mutations}}),{filename:$.filename,num_samples:$.num_samples,num_nodes:$.num_nodes,num_edges:$.num_edges,num_trees:$.num_trees,num_mutations:$.num_mutations,has_temporal:$.has_temporal,has_sample_spatial:$.has_sample_spatial,has_all_spatial:$.has_all_spatial,spatial_status:$.spatial_status}}catch(L){return Re.error(`Failed to get metadata for ${N}`,{component:"TreeSequenceSelector",error:L instanceof Error?L:new Error(String(L)),data:{filename:N}}),null}};j.useEffect(()=>{R()},[]),j.useEffect(()=>{const N=async()=>{const L={};for(const $ of n){const Z=await E($);Z&&(L[$]=Z)}s(L)};n.length>0&&N()},[n]);const C=()=>{u&&i[u]&&t(i[u])},O=(N,L,$)=>{if(($.shiftKey||$.ctrlKey||$.metaKey)&&$.preventDefault(),$.shiftKey&&_!==-1){const Z=Math.min(_,L),V=Math.max(_,L),q=new Set;for(let z=Z;z<=V;z++)q.add(n[z]);m(q)}else if($.ctrlKey||$.metaKey){const Z=new Set(h);Z.has(N)?Z.delete(N):Z.add(N),m(Z),y(L)}else d(N),m(new Set([N])),y(L)},P=async(N,L)=>{L.stopPropagation(),b({isOpen:!0,title:"Delete Tree Sequence",message:`Are you sure you want to delete "${N}"?`,type:"danger",onConfirm:async()=>{b({...w,isOpen:!1});try{Re.user.action("delete-tree-sequence",{filename:N},"TreeSequenceSelector");const $=await tt.deleteTreeSequence(N);Re.info(`Successfully deleted tree sequence: ${N}`,{component:"TreeSequenceSelector",data:{filename:N}}),r(Z=>Z.filter(V=>V!==N)),s(Z=>{const V={...Z};return delete V[N],V}),u===N&&d(""),m(Z=>{const V=new Set(Z);return V.delete(N),V})}catch($){Re.error("Failed to delete tree sequence",{component:"TreeSequenceSelector",error:$ instanceof Error?$:new Error(String($)),data:{filename:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequence: ${$ instanceof Error?$.message:"Unknown error"}`,type:"error"})}}})},k=async()=>{if(h.size===0)return;const N=Array.from(h),L=N.length===1?`Are you sure you want to delete "${N[0]}"?`:`Are you sure you want to delete ${N.length} tree sequences?`;b({isOpen:!0,title:"Delete Tree Sequences",message:L,type:"danger",onConfirm:async()=>{b({...w,isOpen:!1});try{const $=N.map(Z=>tt.deleteTreeSequence(Z));await Promise.all($),Re.info(`Successfully deleted ${N.length} tree sequences`,{component:"TreeSequenceSelector",data:{filenames:N}}),r(Z=>Z.filter(V=>!N.includes(V))),s(Z=>{const V={...Z};return N.forEach(q=>delete V[q]),V}),m(new Set),N.includes(u)&&d("")}catch($){Re.error("Failed to delete selected tree sequences",{component:"TreeSequenceSelector",error:$ instanceof Error?$:new Error(String($)),data:{filenames:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequences: ${$ instanceof Error?$.message:"Unknown error"}`,type:"error"})}}})},I=async()=>{n.length!==0&&b({isOpen:!0,title:"Clear All Tree Sequences",message:`Are you sure you want to delete ALL ${n.length} tree sequences? This action cannot be undone.`,type:"danger",onConfirm:async()=>{b({...w,isOpen:!1});try{const N=n.map(L=>tt.deleteTreeSequence(L));await Promise.all(N),Re.info(`Successfully cleared all ${n.length} tree sequences`,{component:"TreeSequenceSelector",data:{count:n.length}}),r([]),s({}),m(new Set),d("")}catch(N){Re.error("Failed to clear all tree sequences",{component:"TreeSequenceSelector",error:N instanceof Error?N:new Error(String(N))}),A({isOpen:!0,title:"Clear Failed",message:`Failed to clear all tree sequences: ${N instanceof Error?N.message:"Unknown error"}`,type:"error"}),R()}}})};return o?g.jsx("div",{className:`flex items-center justify-center p-8 ${e}`,children:g.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sp-pale-green"})}):n.length===0?g.jsx("div",{className:e,children:g.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-8 text-center",children:[g.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[g.jsx("div",{className:"w-10 h-10 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:g.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),g.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"No Existing Tree Sequences"})]}),g.jsx("p",{className:"text-sp-white/60 text-sm mb-6",children:"No previously uploaded sequences found. Upload or simulate a tree sequence first."}),g.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2 mx-auto",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}):g.jsxs("div",{className:e,children:[g.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5 mb-4",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),g.jsxs("div",{className:"flex-1",children:[g.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Select Existing Tree Sequence"}),g.jsx("p",{className:"text-sp-white/60 text-xs",children:"Choose from previously uploaded sequences"})]}),h.size>0&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("span",{className:"text-sm text-sp-white/70",children:[h.size," selected"]}),g.jsxs("button",{onClick:k,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-1",title:`Delete ${h.size} selected tree sequence${h.size>1?"s":""}`,children:[g.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete"]})]})]}),g.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto select-none",children:n.map((N,L)=>{const $=i[N],Z=(T==null?void 0:T.filename)===N,V=u===N,q=h.has(N);return g.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${V?"border-sp-pale-green bg-sp-very-dark-blue shadow-lg":q?"border-blue-400 bg-sp-very-dark-blue shadow-md":"border-sp-pale-green/20 bg-sp-very-dark-blue hover:border-sp-pale-green/50 hover:shadow-md"} ${Z?"ring-2 ring-sp-pale-green ring-offset-2 ring-offset-sp-dark-blue":""}`,onClick:z=>O(N,L,z),children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[g.jsx("div",{className:"flex-shrink-0",children:g.jsx("input",{type:"checkbox",checked:q,onChange:()=>{},className:"w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"})}),g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("span",{className:"font-mono text-sp-pale-green text-sm font-medium truncate",title:N,children:N}),Z&&g.jsx("span",{className:"text-xs bg-sp-pale-green text-sp-very-dark-blue px-2 py-1 rounded-full font-medium",children:"Current"})]}),$?g.jsxs("div",{className:"text-xs text-sp-white/70 space-y-0.5",children:[g.jsxs("div",{className:"flex gap-4",children:[g.jsxs("span",{children:[$.num_samples," samples"]}),g.jsxs("span",{children:[$.num_nodes," nodes"]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsxs("span",{children:[$.num_edges," edges"]}),g.jsxs("span",{children:[$.num_trees," trees"]})]})]}):g.jsx("div",{className:"text-xs text-sp-white/50",children:"Loading info..."})]})]}),g.jsx("button",{onClick:z=>P(N,z),className:"ml-3 text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-400/10 transition-all duration-200",title:"Delete tree sequence",children:g.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},N)})}),g.jsx("div",{className:"mt-3 text-xs text-sp-white/60 text-center",children:"Click to select for loading • Ctrl+click to multi-select • Shift+click to select range"})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsxs("button",{onClick:C,disabled:!u||!i[u],className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Load Selected"]}),g.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),g.jsxs("button",{onClick:I,disabled:n.length===0,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2",title:"Delete all tree sequences",children:[g.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Clear All"]})]}),g.jsx(rI,{isOpen:w.isOpen,title:w.title,message:w.message,type:w.type,confirmText:"Delete",cancelText:"Cancel",onConfirm:w.onConfirm,onCancel:()=>b({...w,isOpen:!1})}),g.jsx(nI,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>A({...S,isOpen:!1})})]})}function _c({isOpen:t,onClose:e,onSelect:n}){const{colors:r}=St();return t?g.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[g.jsx("div",{className:"fixed inset-0 transition-opacity",style:{backgroundColor:`${r.background}CC`},onClick:e}),g.jsx("div",{className:"flex items-start justify-center min-h-screen pt-16 px-4",children:g.jsxs("div",{className:"relative rounded-xl shadow-xl max-w-3xl w-full p-6 border",style:{backgroundColor:r.background,borderColor:r.border},children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h2",{className:"text-lg font-medium",style:{color:r.text},children:"Switch Tree Sequence"}),g.jsx("button",{className:"rounded-lg p-2 transition-colors",style:{color:r.text},onClick:e,onMouseEnter:i=>{i.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent"},children:g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),g.jsx(iI,{onSelect:n})]})})]}):null}const JB=[{id:"sparg",name:"sparg",description:"Spatial inference using Brownian motion on the full ancestral recombination graph. Modified to include node ID tracking. Best for small ARGs.",reference:"https://www.biorxiv.org/content/10.1101/2024.04.10.588900v2",github:"https://github.com/osmond-lab/sparg",github2:"",speed:1,enabled:!0},{id:"spacetrees",name:"spacetrees",description:"Spatial inference using genome-wide genealogies. Coming Soon!",reference:"https://elifesciences.org/articles/72177",github:"https://github.com/osmond-lab/spacetrees",github2:"",speed:2,enabled:!1},{id:"gaia_quadratic",name:"gaia quadratic",description:"High-accuracy spatial inference using quadratic parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"gaia_linear",name:"gaia linear",description:"High-accuracy spatial inference using linear parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"fastgaia",name:"fastgaia",description:"Fast spatial inference using a greedy algorithm. Best for large ARGs where GAIA is too slow.",reference:"",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/blueraleigh/gaia",speed:4,enabled:!0},{id:"midpoint",name:"Wohns midpoint",description:"Weighted midpoint-based spatial inference. Simple and fast for ARGs of all sizes.",reference:"https://doi.org/10.1126/science.abi8264",github:"https://github.com/awohns/unified_genealogy_paper/",github2:"",speed:5,enabled:!0}];function eU({selectedMethod:t,onMethodSelect:e,disabled:n,isInferring:r,data:i}){const[s,o]=j.useState(!1),[l,u]=j.useState(null),d=JB.map(_=>({..._,isReInference:(i==null?void 0:i.spatial_status)==="all"})),h=d.find(_=>_.enabled),m=d.find(_=>_.id===t)||h||d[0];return g.jsxs("div",{className:"relative",children:[g.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 w-full ${n&&"opacity-50 cursor-not-allowed hover:transform-none"} ${r&&"opacity-75 cursor-not-allowed hover:transform-none"}`,onClick:()=>!n&&!r&&o(!s),disabled:n||r,children:[r&&g.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),g.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),g.jsx("span",{children:r?"Inferring...":`${m.isReInference?"Re-infer":"Infer"} locations (${m.name})`}),g.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&g.jsx("div",{className:"absolute z-50 w-full mt-2 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:g.jsx("div",{className:"py-2",children:d.map(_=>g.jsxs("div",{className:"relative group",onMouseEnter:()=>u(_),onMouseLeave:y=>{const T=document.querySelector(`[data-tooltip-id="${_.id}"]`);T&&!T.contains(y.relatedTarget)&&u(null)},children:[g.jsx("button",{className:`w-full px-4 py-2 text-left transition-colors duration-200 ${_.enabled?t===_.id?"bg-sp-pale-green/10 hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"text-sp-white/50 cursor-not-allowed"}`,onClick:()=>{_.enabled&&(e(_),o(!1))},disabled:r||!_.enabled,children:g.jsxs("div",{className:"font-medium flex items-center justify-between",children:[g.jsx("span",{children:_.name}),!_.enabled&&g.jsx("span",{className:"text-xs text-sp-pale-green/50",children:"Coming Soon"})]})}),(l==null?void 0:l.id)===_.id&&g.jsxs("div",{"data-tooltip-id":_.id,className:"fixed z-50 w-72 p-4 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",style:{left:"var(--tooltip-x, 0)",top:"var(--tooltip-y, 0)"},ref:y=>{var T;if(y){const w=(T=y.parentElement)==null?void 0:T.getBoundingClientRect();if(w){const b=window.innerHeight-w.bottom,S=w.top,A=y.offsetHeight,R=w.left-y.offsetWidth-8;let E;b>=A?E=w.top:S>=A?E=w.bottom-A:E=Math.max(8,Math.min(window.innerHeight-A-8,w.top-(A-w.height)/2)),y.style.setProperty("--tooltip-x",`${R}px`),y.style.setProperty("--tooltip-y",`${E}px`)}}},onMouseEnter:()=>u(_),onMouseLeave:()=>u(null),children:[g.jsx("h4",{className:"font-bold text-sp-pale-green mb-2",children:l.name}),g.jsx("p",{className:"text-sm text-sp-white/80 mb-2",children:l.description}),g.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[g.jsx("span",{className:"text-xs text-sp-white/80",children:"Speed:"}),g.jsx("div",{className:"flex items-center gap-[2px]",children:[...Array(5)].map((y,T)=>g.jsx("div",{className:`w-3 h-5 rounded-sm transition-all ${T<l.speed?T===0?"bg-yellow-400":T===1?"bg-yellow-500":T===2?"bg-lime-500":T===3?"bg-green-400":"bg-green-500":"bg-gray-700"}`},T))})]}),g.jsxs("div",{className:"flex flex-col gap-1",children:[l.reference&&g.jsx("a",{href:l.reference,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View reference"}),l.id==="gaia_quadratic"||l.id==="gaia_linear"?g.jsxs(g.Fragment,{children:[g.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"}),g.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaiapy on GitHub"})]}):l.id==="fastgaia"?g.jsxs(g.Fragment,{children:[g.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View fastgaia on GitHub"}),g.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"})]}):l.github&&g.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View on GitHub"})]})]})]},_.id))})}),g.jsxs("div",{className:"absolute -right-8 top-1/2 transform -translate-y-1/2 group",children:[g.jsx("div",{className:"p-1 cursor-help",children:g.jsx("svg",{className:"w-4 h-4 text-sp-pale-green/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),g.jsx("div",{className:"hidden group-hover:block absolute right-full mr-2 w-64 p-3 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg shadow-xl",children:g.jsx("p",{className:"text-xs text-sp-white/80",children:"Choose from different methods to infer ancestral locations in your ARG. Each method has its own strengths and is optimized for different scenarios."})})]})]})}const Bg=t=>t.toExponential(8);function tU({isOpen:t,onClose:e,onConfirm:n,defaultRate:r=1e-8}){const[i,s]=j.useState(Bg(r)),[o,l]=j.useState(!0),[u,d]=j.useState(!1),[h,m]=j.useState("1000000"),[_,y]=j.useState(!0),[T,w]=j.useState(!1),[b,S]=j.useState(!1),[A,R]=j.useState(!1),E=C=>{C.preventDefault();const O=parseFloat(i),P=h?parseFloat(h):void 0;!isNaN(O)&&O>0&&n(O,o,u,P,_,T,b,A)};return t?g.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl p-6 w-full max-w-md",children:[g.jsx("h3",{className:"text-xl font-bold text-sp-white mb-4",children:"Set Mutation Rate"}),g.jsxs("form",{onSubmit:E,className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80 mb-2",children:"Mutation Rate (per base pair per generation)"}),g.jsx("input",{type:"text",id:"mutation-rate",value:i,onChange:C=>{const O=C.target.value;s(O)},onBlur:C=>{const O=C.target.value,P=parseFloat(O);isNaN(P)||P<=0?s(Bg(r)):s(Bg(P))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),g.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"preprocess",checked:o,onChange:C=>l(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"preprocess",className:"ml-2 block text-sm text-sp-white/80",children:"Preprocess tree sequence"})]}),o&&g.jsxs("div",{className:"ml-6 space-y-3 border-l-2 border-sp-pale-green/20 pl-4",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"remove-telomeres",checked:u,onChange:C=>d(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"remove-telomeres",className:"ml-2 block text-sm text-sp-white/80",children:"Remove telomeres (flanking regions)"})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"minimum-gap",className:"block text-sm text-sp-white/80 mb-1",children:"Minimum gap between sites (bp)"}),g.jsx("input",{type:"text",id:"minimum-gap",value:h,onChange:C=>m(C.target.value),onBlur:C=>{const O=C.target.value,P=parseFloat(O);(isNaN(P)||P<0)&&m("1000000")},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1000000"}),g.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1,000,000 bp"})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"split-disjoint",checked:_,onChange:C=>y(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"split-disjoint",className:"ml-2 block text-sm text-sp-white/80",children:"Split disjoint nodes"})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"filter-populations",checked:T,onChange:C=>w(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"filter-populations",className:"ml-2 block text-sm text-sp-white/80",children:"Filter populations"})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"filter-individuals",checked:b,onChange:C=>S(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"filter-individuals",className:"ml-2 block text-sm text-sp-white/80",children:"Filter individuals"})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"filter-sites",checked:A,onChange:C=>R(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),g.jsx("label",{htmlFor:"filter-sites",className:"ml-2 block text-sm text-sp-white/80",children:"Filter sites"})]}),g.jsx("p",{className:"text-xs text-sp-white/60",children:"Preprocessing simplifies the tree sequence by removing unary nodes and splitting disjoint nodes. Telomeres are flanking regions that may contain missing data."})]})]}),g.jsxs("div",{className:"flex justify-end gap-3",children:[g.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sp-white/80 hover:text-sp-white transition-colors",children:"Cancel"}),g.jsx("button",{type:"submit",className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold px-4 py-2 rounded-lg transition-colors",children:"Run tsdate"})]})]})]})}):null}function nU(){const t=cs(),e=No(),{treeSequence:n,maxSamples:r,setMaxSamples:i,setTreeSequence:s}=Qs(),[o,l]=j.useState(null),[u,d]=j.useState(!1),[h,m]=j.useState(!1),[_,y]=j.useState(!1),[T,w]=j.useState(!1),[b,S]=j.useState(!1),[A,R]=j.useState(!1),[E,C]=j.useState(r.toString()),[O,P]=j.useState("gaia_quadratic"),[k,I]=j.useState(!1),[N,L]=j.useState(!1),[$,Z]=j.useState(!1),[V,q]=j.useState(null),[z,Q]=j.useState({isOpen:!1,title:"",message:"",type:"info"});j.useEffect(()=>{n!=null&&n.num_samples&&l(n.num_samples)},[n]),j.useEffect(()=>{C(r.toString())},[r]),n!=null&&n.has_temporal;const oe=(n==null?void 0:n.spatial_status)==="sample_only"||(n==null?void 0:n.spatial_status)==="all",G=!!(n!=null&&n.has_temporal&&(n!=null&&n.has_all_spatial)),D=G,Y=(n==null?void 0:n.num_mutations)!==void 0&&n.num_mutations>0,le=async()=>{if(!(!(n!=null&&n.filename)||u)){d(!0);try{Re.user.action("fast-location-inference-start",{filename:n.filename},"ResultPage");const Ee=await tt.inferLocationsFast({filename:n.filename,weight_span:!0,weight_branch_length:!0});Re.info("Fast location inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Ee.data}});const Te=Ee.data,Ne={...n,filename:Te.new_filename,has_sample_spatial:Te.has_sample_spatial,has_all_spatial:Te.has_all_spatial,spatial_status:Te.spatial_status};s(Ne),Q({isOpen:!0,title:"Success!",message:`Fast location inference completed successfully!
Inferred locations for ${Te.num_inferred_locations} nodes.
New file: ${Te.new_filename}`,type:"success"})}catch(Ee){Re.error("Fast location inference failed",{component:"ResultPage",error:Ee instanceof Error?Ee:new Error(String(Ee)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Fast location inference failed: ${Ee instanceof Error?Ee.message:"Unknown error"}`,type:"error"})}finally{d(!1)}}},ie=async()=>{if(!(!(n!=null&&n.filename)||h)){m(!0);try{Re.user.action("gaia-quadratic-inference-start",{filename:n.filename},"ResultPage");const Ee=await tt.inferLocationsGaiaQuadratic({filename:n.filename});Re.info("GAIA quadratic inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Ee.data}});const Te=Ee.data,Ne={...n,filename:Te.new_filename,has_sample_spatial:Te.has_sample_spatial,has_all_spatial:Te.has_all_spatial,spatial_status:Te.spatial_status};s(Ne),Q({isOpen:!0,title:"Success!",message:`GAIA quadratic inference completed successfully!
Inferred locations for ${Te.num_inferred_locations} nodes.
New file: ${Te.new_filename}`,type:"success"})}catch(Ee){Re.error("GAIA quadratic inference failed",{component:"ResultPage",error:Ee instanceof Error?Ee:new Error(String(Ee)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA quadratic inference failed: ${Ee instanceof Error?Ee.message:"Unknown error"}`,type:"error"})}finally{m(!1)}}},F=Ee=>{Re.user.action("switch-tree-sequence",{treeSequence:Ee},"ResultPage"),s(Ee),R(!1)},X=()=>{var Te;const Ee=(Te=e.state)==null?void 0:Te.fromIntermediate;Ee?Ee==="load"?(Re.nav("result","landing"),t("/",{state:{fromInternal:!0}})):(Re.nav("result","intermediate"),t("/",{state:{fromResult:!0,selectedOption:Ee}})):(Re.nav("result","landing"),t("/",{state:{fromInternal:!0}}))},J=()=>{var Te;const Ee=(Te=e.state)==null?void 0:Te.fromIntermediate;if(Ee)switch(Ee){case"upload":return"Back to Upload";case"simulate":return"Back to Simulate";case"load":return"Back to options";default:return"Back"}return"Back"},pe=async Ee=>{if(n!=null&&n.filename)switch(Ee.id){case"fastgaia":await le();break;case"gaia_quadratic":await ie();break;case"gaia_linear":if(_)return;y(!0);try{Re.user.action("gaia-linear-inference-start",{filename:n.filename},"ResultPage");const Te=await tt.inferLocationsGaiaLinear({filename:n.filename});Re.info("GAIA linear inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Te.data}});const Ne=Te.data,Pe={...n,filename:Ne.new_filename,has_sample_spatial:Ne.has_sample_spatial,has_all_spatial:Ne.has_all_spatial,spatial_status:Ne.spatial_status};s(Pe),Q({isOpen:!0,title:"Success!",message:`GAIA linear inference completed successfully!
Inferred locations for ${Ne.num_inferred_locations} nodes.
New file: ${Ne.new_filename}`,type:"success"})}catch(Te){Re.error("GAIA linear inference failed",{component:"ResultPage",error:Te instanceof Error?Te:new Error(String(Te)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA linear inference failed: ${Te instanceof Error?Te.message:"Unknown error"}`,type:"error"})}finally{y(!1)}break;case"sparg":if(b)return;S(!0);try{Re.user.action("sparg-inference-start",{filename:n.filename},"ResultPage");const Te=await tt.inferLocationsSparg({filename:n.filename});Re.info("sparg inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Te.data}});const Ne=Te.data,Pe={...n,filename:Ne.new_filename,has_sample_spatial:Ne.has_sample_spatial,has_all_spatial:Ne.has_all_spatial,spatial_status:Ne.spatial_status};s(Pe),Q({isOpen:!0,title:"Success!",message:`sparg inference completed successfully!
Inferred locations for ${Ne.num_inferred_locations} nodes.
New file: ${Ne.new_filename}`,type:"success"})}catch(Te){Re.error("sparg inference failed",{component:"ResultPage",error:Te instanceof Error?Te:new Error(String(Te)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`sparg inference failed: ${Te instanceof Error?Te.message:"Unknown error"}`,type:"error"})}finally{S(!1)}break;case"midpoint":if(T)return;w(!0);try{Re.user.action("midpoint-inference-start",{filename:n.filename},"ResultPage");const Te=await tt.inferLocationsMidpoint({filename:n.filename});Re.info("Midpoint inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Te.data}});const Ne=Te.data,Pe={...n,filename:Ne.new_filename,has_sample_spatial:Ne.has_sample_spatial,has_all_spatial:Ne.has_all_spatial,spatial_status:Ne.spatial_status};s(Pe),Q({isOpen:!0,title:"Success!",message:`Midpoint inference completed successfully!
Inferred locations for ${Ne.num_inferred_locations} nodes.
New file: ${Ne.new_filename}`,type:"success"})}catch(Te){Re.error("Midpoint inference failed",{component:"ResultPage",error:Te instanceof Error?Te:new Error(String(Te)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Midpoint inference failed: ${Te instanceof Error?Te.message:"Unknown error"}`,type:"error"})}finally{w(!1)}break;default:Q({isOpen:!0,title:"Not Implemented",message:`The ${Ee.name} inference method is not yet implemented.`,type:"info"})}},ye=u||h||_||T||b,Ae=async(Ee,Te,Ne,Pe,Kt,Me,nn,Mt)=>{if(!(!(n!=null&&n.filename)||N)){L(!0),I(!1);try{Re.user.action("tsdate-inference-start",{filename:n.filename,mutationRate:Ee,preprocess:Te,removeTelomeres:Ne,minimumGap:Pe,splitDisjoint:Kt,filterPopulations:Me,filterIndividuals:nn,filterSites:Mt},"ResultPage");const Rt=await tt.inferTimesTsdate({filename:n.filename,mutation_rate:Ee,preprocess:Te,remove_telomeres:Ne,minimum_gap:Pe,split_disjoint:Kt,filter_populations:Me,filter_individuals:nn,filter_sites:Mt});Re.info("tsdate inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Rt.data}});const Ke=Rt.data,rn={...n,filename:Ke.new_filename,has_temporal:Ke.has_temporal};s(rn);const Ye=Ke.preprocessing.preprocessed?`
Preprocessing: ${[Ke.preprocessing.remove_telomeres?"with telomere removal":"without telomere removal",Ke.preprocessing.minimum_gap?`minimum gap ${Ke.preprocessing.minimum_gap}bp`:null,Ke.preprocessing.split_disjoint?"split disjoint nodes":null,Ke.preprocessing.filter_populations?"filtered populations":null,Ke.preprocessing.filter_individuals?"filtered individuals":null,Ke.preprocessing.filter_sites?"filtered sites":null].filter(Boolean).join(", ")}`:`
No preprocessing applied`;Q({isOpen:!0,title:"Success!",message:`tsdate inference completed successfully!${Ye}
Inferred times for ${Ke.num_inferred_times} nodes.
New file: ${Ke.new_filename}`,type:"success"})}catch(Rt){Re.error("tsdate inference failed",{component:"ResultPage",error:Rt instanceof Error?Rt:new Error(String(Rt)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`tsdate inference failed: ${Rt instanceof Error?Rt.message:"Unknown error"}`,type:"error"})}finally{L(!1)}}},Oe=()=>{D&&Z(!0)},Ue=Ee=>{if(n){if(!Ee.has_temporal||!Ee.has_all_spatial||Ee.filename===n.filename){Q({isOpen:!0,title:"Invalid Selection",message:"The selected tree sequence must have temporal and spatial data, and must be different from the current tree sequence.",type:"error"});return}q(Ee),Z(!1),t(`/visualize-spatial-diff/${encodeURIComponent(n.filename)}?second=${encodeURIComponent(Ee.filename)}`)}};return n?g.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[g.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[g.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[g.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",onClick:X,children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),J()]}),g.jsx(ko,{size:"medium"})]}),g.jsxs("div",{className:"text-center mb-8",children:[g.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Tree Sequence Analysis"}),g.jsx("p",{className:"text-sp-white/70 text-lg font-mono break-all",children:n.filename})]})]}),g.jsx("div",{className:"max-w-7xl mx-auto",children:g.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:g.jsxs("div",{className:"p-8 space-y-6",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsxs("div",{className:"flex flex-wrap gap-3",children:[g.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_temporal?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[g.jsx("span",{className:`inline-block ${n.has_temporal?"text-sp-white":"text-red-400"}`,children:n.has_temporal?"✔️":"✖️"}),"Temporal"]}),g.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_sample_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[g.jsx("span",{className:`inline-block ${n.has_sample_spatial?"text-sp-white":"text-red-400"}`,children:n.has_sample_spatial?"✔️":"✖️"}),"Sample Coords"]}),g.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_all_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[g.jsx("span",{className:`inline-block ${n.has_all_spatial?"text-sp-white":"text-red-400"}`,children:n.has_all_spatial?"✔️":"✖️"}),"All Coords"]}),g.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${Y?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[g.jsx("span",{className:`inline-block ${Y?"text-sp-white":"text-red-400"}`,children:Y?"✔️":"✖️"}),"Mutations"]})]}),g.jsxs("div",{className:"flex gap-2",children:[g.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>R(!A),children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),A?"Cancel":"Switch Tree Sequence"]}),g.jsx(mc,{filename:n.filename,onError:Ee=>{Q({isOpen:!0,title:"Download Failed",message:`Failed to download tree sequence: ${Ee.message}`,type:"error"})}})]})]}),g.jsx(_c,{isOpen:A,onClose:()=>R(!1),onSelect:F}),g.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[g.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_samples}),g.jsx("div",{className:"text-xs text-sp-white/70",children:"Samples"})]}),g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[g.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_nodes}),g.jsx("div",{className:"text-xs text-sp-white/70",children:"Nodes"})]}),g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[g.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_edges}),g.jsx("div",{className:"text-xs text-sp-white/70",children:"Edges"})]}),g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[g.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_trees}),g.jsx("div",{className:"text-xs text-sp-white/70",children:"Local Trees"})]}),g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[g.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_mutations??0}),g.jsx("div",{className:"text-xs text-sp-white/70",children:"Mutations"})]})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[g.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 ${!Y&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!Y||N,onClick:()=>I(!0),children:[N&&g.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsx("span",{children:N?"Inferring...":"Infer ages (tsdate)"})]}),g.jsx(eU,{selectedMethod:O,onMethodSelect:Ee=>{P(Ee.id),pe(Ee)},disabled:!oe,isInferring:ye,data:n})]}),g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-4",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[g.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:g.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),g.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Visualization Sample Count"})]}),g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("input",{type:"range",id:"sample-slider",min:"2",max:o||ts.DEFAULT_MAX_SAMPLES,value:Math.max(r,2),onChange:Ee=>i(parseInt(Ee.target.value)),className:"flex-1 h-2 bg-sp-dark-blue rounded-lg appearance-none cursor-pointer accent-sp-pale-green"}),g.jsxs("div",{className:"flex items-center gap-2 min-w-[8rem]",children:[g.jsx("input",{type:"number",value:E,onChange:Ee=>{const Te=Ee.target.value;if(C(Te),Te!==""){const Ne=parseInt(Te);isNaN(Ne)||i(Ne)}},onBlur:Ee=>{const Te=parseInt(Ee.target.value);let Ne=2;isNaN(Te)||(Ne=Math.max(2,Math.min(Te,o||ts.DEFAULT_MAX_SAMPLES))),i(Ne),C(Ne.toString())},min:"2",max:o||ts.DEFAULT_MAX_SAMPLES,className:"w-20 bg-sp-dark-blue border border-sp-pale-green/20 rounded px-2 py-1 text-sm text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green"}),g.jsxs("span",{className:"text-sm font-mono text-sp-white/70",children:["/ ",o||"?"]})]})]}),g.jsxs("div",{className:"mt-2",children:[g.jsx("p",{className:"text-xs text-sp-white/60",children:"Adjust before visualizing to control the number of samples shown (minimum: 2)"}),o&&o>ts.WARNING_THRESHOLD&&g.jsx("p",{className:"text-xs text-sp-white/60 mt-1",children:"Note: Large sample numbers may affect visualization performance"})]})]}),g.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[g.jsxs("button",{className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 false",disabled:!1,onClick:()=>t(`/visualize/${encodeURIComponent(n.filename)}`),children:[g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),g.jsxs("div",{className:"text-center",children:[g.jsx("span",{className:"text-base font-bold",children:"Visualize ARG"}),g.jsx("span",{className:"text-sm opacity-80 block",children:"Interactive D3"})]})]}),g.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!G&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!G,onClick:()=>t(`/visualize-spatial/${encodeURIComponent(n.filename)}`),children:[g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),g.jsxs("div",{className:"text-center",children:[g.jsx("span",{className:"text-base font-bold",children:"Spatial ARG"}),g.jsx("span",{className:"text-sm opacity-80 block",children:"3D coordinates"})]})]}),g.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!D&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!D,onClick:Oe,children:[g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),g.jsxs("div",{className:"text-center",children:[g.jsx("span",{className:"text-base font-bold",children:"Spatial Diff"}),g.jsx("span",{className:"text-sm opacity-80 block",children:"Compare locations"})]})]}),g.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Pretty ARG visualization coming soon",children:[g.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})}),g.jsxs("div",{className:"text-center",children:[g.jsx("span",{className:"text-base font-bold",children:"Pretty ARG"}),g.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]})]})]})})}),g.jsx(tU,{isOpen:k,onClose:()=>I(!1),onConfirm:Ae}),$&&n&&g.jsx(_c,{isOpen:$,onClose:()=>Z(!1),onSelect:Ue}),g.jsx(nI,{isOpen:z.isOpen,title:z.title,message:z.message,type:z.type,onClose:()=>Q({...z,isOpen:!1})})]}):g.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-sp-very-dark-blue text-sp-white",children:[g.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No data loaded"}),g.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4",onClick:X,children:"Back to Home"})]})}var rU={value:()=>{}};function Cc(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new wf(n)}function wf(t){this._=t}function iU(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}wf.prototype=Cc.prototype={constructor:wf,on:function(t,e){var n=this._,r=iU(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=sU(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=x3(n[i],t.name,e);else if(e==null)for(i in n)n[i]=x3(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new wf(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function sU(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function x3(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=rU,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Zb="http://www.w3.org/1999/xhtml";const b3={svg:"http://www.w3.org/2000/svg",xhtml:Zb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ud(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),b3.hasOwnProperty(e)?{space:b3[e],local:t}:t}function aU(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Zb&&e.documentElement.namespaceURI===Zb?e.createElement(t):e.createElementNS(n,t)}}function oU(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function sI(t){var e=Ud(t);return(e.local?oU:aU)(e)}function lU(){}function s1(t){return t==null?lU:function(){return this.querySelector(t)}}function cU(t){typeof t!="function"&&(t=s1(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=new Array(o),u,d,h=0;h<o;++h)(u=s[h])&&(d=t.call(u,u.__data__,h,s))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new Zn(r,this._parents)}function uU(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function fU(){return[]}function aI(t){return t==null?fU:function(){return this.querySelectorAll(t)}}function dU(t){return function(){return uU(t.apply(this,arguments))}}function hU(t){typeof t=="function"?t=dU(t):t=aI(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(t.call(u,u.__data__,d,o)),i.push(u));return new Zn(r,i)}function oI(t){return function(){return this.matches(t)}}function lI(t){return function(e){return e.matches(t)}}var pU=Array.prototype.find;function gU(t){return function(){return pU.call(this.children,t)}}function mU(){return this.firstElementChild}function _U(t){return this.select(t==null?mU:gU(typeof t=="function"?t:lI(t)))}var vU=Array.prototype.filter;function yU(){return Array.from(this.children)}function xU(t){return function(){return vU.call(this.children,t)}}function bU(t){return this.selectAll(t==null?yU:xU(typeof t=="function"?t:lI(t)))}function wU(t){typeof t!="function"&&(t=oI(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new Zn(r,this._parents)}function cI(t){return new Array(t.length)}function TU(){return new Zn(this._enter||this._groups.map(cI),this._parents)}function Df(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Df.prototype={constructor:Df,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function SU(t){return function(){return t}}function EU(t,e,n,r,i,s){for(var o=0,l,u=e.length,d=s.length;o<d;++o)(l=e[o])?(l.__data__=s[o],r[o]=l):n[o]=new Df(t,s[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function AU(t,e,n,r,i,s,o){var l,u,d=new Map,h=e.length,m=s.length,_=new Array(h),y;for(l=0;l<h;++l)(u=e[l])&&(_[l]=y=o.call(u,u.__data__,l,e)+"",d.has(y)?i[l]=u:d.set(y,u));for(l=0;l<m;++l)y=o.call(t,s[l],l,s)+"",(u=d.get(y))?(r[l]=u,u.__data__=s[l],d.delete(y)):n[l]=new Df(t,s[l]);for(l=0;l<h;++l)(u=e[l])&&d.get(_[l])===u&&(i[l]=u)}function RU(t){return t.__data__}function CU(t,e){if(!arguments.length)return Array.from(this,RU);var n=e?AU:EU,r=this._parents,i=this._groups;typeof t!="function"&&(t=SU(t));for(var s=i.length,o=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var h=r[d],m=i[d],_=m.length,y=NU(t.call(h,h&&h.__data__,d,r)),T=y.length,w=l[d]=new Array(T),b=o[d]=new Array(T),S=u[d]=new Array(_);n(h,m,w,b,S,y,e);for(var A=0,R=0,E,C;A<T;++A)if(E=w[A]){for(A>=R&&(R=A+1);!(C=b[R])&&++R<T;);E._next=C||null}}return o=new Zn(o,r),o._enter=l,o._exit=u,o}function NU(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function kU(){return new Zn(this._exit||this._groups.map(cI),this._parents)}function MU(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function IU(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),l=new Array(i),u=0;u<o;++u)for(var d=n[u],h=r[u],m=d.length,_=l[u]=new Array(m),y,T=0;T<m;++T)(y=d[T]||h[T])&&(_[T]=y);for(;u<i;++u)l[u]=n[u];return new Zn(l,this._parents)}function OU(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function PU(t){t||(t=DU);function e(m,_){return m&&_?t(m.__data__,_.__data__):!m-!_}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],l=o.length,u=i[s]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(e)}return new Zn(i,this._parents).order()}function DU(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function jU(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function LU(){return Array.from(this)}function BU(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function UU(){let t=0;for(const e of this)++t;return t}function FU(){return!this.node()}function zU(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,l;s<o;++s)(l=i[s])&&t.call(l,l.__data__,s,i);return this}function $U(t){return function(){this.removeAttribute(t)}}function qU(t){return function(){this.removeAttributeNS(t.space,t.local)}}function VU(t,e){return function(){this.setAttribute(t,e)}}function HU(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function WU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function XU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function YU(t,e){var n=Ud(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?qU:$U:typeof e=="function"?n.local?XU:WU:n.local?HU:VU)(n,e))}function uI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function GU(t){return function(){this.style.removeProperty(t)}}function KU(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ZU(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function QU(t,e,n){return arguments.length>1?this.each((e==null?GU:typeof e=="function"?ZU:KU)(t,e,n??"")):go(this.node(),t)}function go(t,e){return t.style.getPropertyValue(e)||uI(t).getComputedStyle(t,null).getPropertyValue(e)}function JU(t){return function(){delete this[t]}}function eF(t,e){return function(){this[t]=e}}function tF(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function nF(t,e){return arguments.length>1?this.each((e==null?JU:typeof e=="function"?tF:eF)(t,e)):this.node()[t]}function fI(t){return t.trim().split(/^|\s+/)}function a1(t){return t.classList||new dI(t)}function dI(t){this._node=t,this._names=fI(t.getAttribute("class")||"")}dI.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function hI(t,e){for(var n=a1(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function pI(t,e){for(var n=a1(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function rF(t){return function(){hI(this,t)}}function iF(t){return function(){pI(this,t)}}function sF(t,e){return function(){(e.apply(this,arguments)?hI:pI)(this,t)}}function aF(t,e){var n=fI(t+"");if(arguments.length<2){for(var r=a1(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?sF:e?rF:iF)(n,e))}function oF(){this.textContent=""}function lF(t){return function(){this.textContent=t}}function cF(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function uF(t){return arguments.length?this.each(t==null?oF:(typeof t=="function"?cF:lF)(t)):this.node().textContent}function fF(){this.innerHTML=""}function dF(t){return function(){this.innerHTML=t}}function hF(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function pF(t){return arguments.length?this.each(t==null?fF:(typeof t=="function"?hF:dF)(t)):this.node().innerHTML}function gF(){this.nextSibling&&this.parentNode.appendChild(this)}function mF(){return this.each(gF)}function _F(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vF(){return this.each(_F)}function yF(t){var e=typeof t=="function"?t:sI(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function xF(){return null}function bF(t,e){var n=typeof t=="function"?t:sI(t),r=e==null?xF:typeof e=="function"?e:s1(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function wF(){var t=this.parentNode;t&&t.removeChild(this)}function TF(){return this.each(wF)}function SF(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function EF(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function AF(t){return this.select(t?EF:SF)}function RF(t){return arguments.length?this.property("__data__",t):this.node().__data__}function CF(t){return function(e){t.call(this,e,this.__data__)}}function NF(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function kF(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function MF(t,e,n){return function(){var r=this.__on,i,s=CF(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function IF(t,e,n){var r=NF(t+""),i,s=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(i=0,h=l[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(l=e?MF:kF,i=0;i<s;++i)this.each(l(r[i],e,n));return this}function gI(t,e,n){var r=uI(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function OF(t,e){return function(){return gI(this,t,e)}}function PF(t,e){return function(){return gI(this,t,e.apply(this,arguments))}}function DF(t,e){return this.each((typeof e=="function"?PF:OF)(t,e))}function*jF(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var mI=[null];function Zn(t,e){this._groups=t,this._parents=e}function Nc(){return new Zn([[document.documentElement]],mI)}function LF(){return this}Zn.prototype=Nc.prototype={constructor:Zn,select:cU,selectAll:hU,selectChild:_U,selectChildren:bU,filter:wU,data:CU,enter:TU,exit:kU,join:MU,merge:IU,selection:LF,order:OU,sort:PU,call:jU,nodes:LU,node:BU,size:UU,empty:FU,each:zU,attr:YU,style:QU,property:nF,classed:aF,text:uF,html:pF,raise:mF,lower:vF,append:yF,insert:bF,remove:TF,clone:AF,datum:RF,on:IF,dispatch:DF,[Symbol.iterator]:jF};function cr(t){return typeof t=="string"?new Zn([[document.querySelector(t)]],[document.documentElement]):new Zn([[t]],mI)}function BF(t){let e;for(;e=t.sourceEvent;)t=e;return t}function hi(t,e){if(t=BF(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const UF={passive:!1},vc={capture:!0,passive:!1};function Ug(t){t.stopImmediatePropagation()}function uo(t){t.preventDefault(),t.stopImmediatePropagation()}function _I(t){var e=t.document.documentElement,n=cr(t).on("dragstart.drag",uo,vc);"onselectstart"in e?n.on("selectstart.drag",uo,vc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function vI(t,e){var n=t.document.documentElement,r=cr(t).on("dragstart.drag",null);e&&(r.on("click.drag",uo,vc),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const ef=t=>()=>t;function Qb(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}Qb.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function FF(t){return!t.ctrlKey&&!t.button}function zF(){return this.parentNode}function $F(t,e){return e??{x:t.x,y:t.y}}function qF(){return navigator.maxTouchPoints||"ontouchstart"in this}function VF(){var t=FF,e=zF,n=$F,r=qF,i={},s=Cc("start","drag","end"),o=0,l,u,d,h,m=0;function _(E){E.on("mousedown.drag",y).filter(r).on("touchstart.drag",b).on("touchmove.drag",S,UF).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(E,C){if(!(h||!t.call(this,E,C))){var O=R(this,e.call(this,E,C),E,C,"mouse");O&&(cr(E.view).on("mousemove.drag",T,vc).on("mouseup.drag",w,vc),_I(E.view),Ug(E),d=!1,l=E.clientX,u=E.clientY,O("start",E))}}function T(E){if(uo(E),!d){var C=E.clientX-l,O=E.clientY-u;d=C*C+O*O>m}i.mouse("drag",E)}function w(E){cr(E.view).on("mousemove.drag mouseup.drag",null),vI(E.view,d),uo(E),i.mouse("end",E)}function b(E,C){if(t.call(this,E,C)){var O=E.changedTouches,P=e.call(this,E,C),k=O.length,I,N;for(I=0;I<k;++I)(N=R(this,P,E,C,O[I].identifier,O[I]))&&(Ug(E),N("start",E,O[I]))}}function S(E){var C=E.changedTouches,O=C.length,P,k;for(P=0;P<O;++P)(k=i[C[P].identifier])&&(uo(E),k("drag",E,C[P]))}function A(E){var C=E.changedTouches,O=C.length,P,k;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),P=0;P<O;++P)(k=i[C[P].identifier])&&(Ug(E),k("end",E,C[P]))}function R(E,C,O,P,k,I){var N=s.copy(),L=hi(I||O,C),$,Z,V;if((V=n.call(E,new Qb("beforestart",{sourceEvent:O,target:_,identifier:k,active:o,x:L[0],y:L[1],dx:0,dy:0,dispatch:N}),P))!=null)return $=V.x-L[0]||0,Z=V.y-L[1]||0,function q(z,Q,oe){var G=L,D;switch(z){case"start":i[k]=q,D=o++;break;case"end":delete i[k],--o;case"drag":L=hi(oe||Q,C),D=o;break}N.call(z,E,new Qb(z,{sourceEvent:Q,subject:V,target:_,identifier:k,active:D,x:L[0]+$,y:L[1]+Z,dx:L[0]-G[0],dy:L[1]-G[1],dispatch:N}),P)}}return _.filter=function(E){return arguments.length?(t=typeof E=="function"?E:ef(!!E),_):t},_.container=function(E){return arguments.length?(e=typeof E=="function"?E:ef(E),_):e},_.subject=function(E){return arguments.length?(n=typeof E=="function"?E:ef(E),_):n},_.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:ef(!!E),_):r},_.on=function(){var E=s.on.apply(s,arguments);return E===s?_:E},_.clickDistance=function(E){return arguments.length?(m=(E=+E)*E,_):Math.sqrt(m)},_}function o1(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function yI(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function kc(){}var yc=.7,jf=1/yc,fo="\\s*([+-]?\\d+)\\s*",xc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",HF=/^#([0-9a-f]{3,8})$/,WF=new RegExp(`^rgb\\(${fo},${fo},${fo}\\)$`),XF=new RegExp(`^rgb\\(${Hr},${Hr},${Hr}\\)$`),YF=new RegExp(`^rgba\\(${fo},${fo},${fo},${xc}\\)$`),GF=new RegExp(`^rgba\\(${Hr},${Hr},${Hr},${xc}\\)$`),KF=new RegExp(`^hsl\\(${xc},${Hr},${Hr}\\)$`),ZF=new RegExp(`^hsla\\(${xc},${Hr},${Hr},${xc}\\)$`),w3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};o1(kc,bc,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:T3,formatHex:T3,formatHex8:QF,formatHsl:JF,formatRgb:S3,toString:S3});function T3(){return this.rgb().formatHex()}function QF(){return this.rgb().formatHex8()}function JF(){return xI(this).formatHsl()}function S3(){return this.rgb().formatRgb()}function bc(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=HF.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?E3(e):n===3?new jn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?tf(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?tf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=WF.exec(t))?new jn(e[1],e[2],e[3],1):(e=XF.exec(t))?new jn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=YF.exec(t))?tf(e[1],e[2],e[3],e[4]):(e=GF.exec(t))?tf(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=KF.exec(t))?C3(e[1],e[2]/100,e[3]/100,1):(e=ZF.exec(t))?C3(e[1],e[2]/100,e[3]/100,e[4]):w3.hasOwnProperty(t)?E3(w3[t]):t==="transparent"?new jn(NaN,NaN,NaN,0):null}function E3(t){return new jn(t>>16&255,t>>8&255,t&255,1)}function tf(t,e,n,r){return r<=0&&(t=e=n=NaN),new jn(t,e,n,r)}function e8(t){return t instanceof kc||(t=bc(t)),t?(t=t.rgb(),new jn(t.r,t.g,t.b,t.opacity)):new jn}function Jb(t,e,n,r){return arguments.length===1?e8(t):new jn(t,e,n,r??1)}function jn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}o1(jn,Jb,yI(kc,{brighter(t){return t=t==null?jf:Math.pow(jf,t),new jn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?yc:Math.pow(yc,t),new jn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new jn(Bs(this.r),Bs(this.g),Bs(this.b),Lf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:A3,formatHex:A3,formatHex8:t8,formatRgb:R3,toString:R3}));function A3(){return`#${Ds(this.r)}${Ds(this.g)}${Ds(this.b)}`}function t8(){return`#${Ds(this.r)}${Ds(this.g)}${Ds(this.b)}${Ds((isNaN(this.opacity)?1:this.opacity)*255)}`}function R3(){const t=Lf(this.opacity);return`${t===1?"rgb(":"rgba("}${Bs(this.r)}, ${Bs(this.g)}, ${Bs(this.b)}${t===1?")":`, ${t})`}`}function Lf(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Bs(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ds(t){return t=Bs(t),(t<16?"0":"")+t.toString(16)}function C3(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ar(t,e,n,r)}function xI(t){if(t instanceof Ar)return new Ar(t.h,t.s,t.l,t.opacity);if(t instanceof kc||(t=bc(t)),!t)return new Ar;if(t instanceof Ar)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,l=s-i,u=(s+i)/2;return l?(e===s?o=(n-r)/l+(n<r)*6:n===s?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?s+i:2-s-i,o*=60):l=u>0&&u<1?0:o,new Ar(o,l,u,t.opacity)}function n8(t,e,n,r){return arguments.length===1?xI(t):new Ar(t,e,n,r??1)}function Ar(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}o1(Ar,n8,yI(kc,{brighter(t){return t=t==null?jf:Math.pow(jf,t),new Ar(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?yc:Math.pow(yc,t),new Ar(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new jn(Fg(t>=240?t-240:t+120,i,r),Fg(t,i,r),Fg(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Ar(N3(this.h),nf(this.s),nf(this.l),Lf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Lf(this.opacity);return`${t===1?"hsl(":"hsla("}${N3(this.h)}, ${nf(this.s)*100}%, ${nf(this.l)*100}%${t===1?")":`, ${t})`}`}}));function N3(t){return t=(t||0)%360,t<0?t+360:t}function nf(t){return Math.max(0,Math.min(1,t||0))}function Fg(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const bI=t=>()=>t;function r8(t,e){return function(n){return t+n*e}}function i8(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function s8(t){return(t=+t)==1?wI:function(e,n){return n-e?i8(e,n,t):bI(isNaN(e)?n:e)}}function wI(t,e){var n=e-t;return n?r8(t,n):bI(isNaN(t)?e:t)}const k3=function t(e){var n=s8(e);function r(i,s){var o=n((i=Jb(i)).r,(s=Jb(s)).r),l=n(i.g,s.g),u=n(i.b,s.b),d=wI(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=l(h),i.b=u(h),i.opacity=d(h),i+""}}return r.gamma=t,r}(1);function Gi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var e0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zg=new RegExp(e0.source,"g");function a8(t){return function(){return t}}function o8(t){return function(e){return t(e)+""}}function l8(t,e){var n=e0.lastIndex=zg.lastIndex=0,r,i,s,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=e0.exec(t))&&(i=zg.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:Gi(r,i)})),n=zg.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?u[0]?o8(u[0].x):a8(e):(e=u.length,function(d){for(var h=0,m;h<e;++h)l[(m=u[h]).i]=m.x(d);return l.join("")})}var M3=180/Math.PI,t0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function TI(t,e,n,r,i,s){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*M3,skewX:Math.atan(u)*M3,scaleX:o,scaleY:l}}var rf;function c8(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?t0:TI(e.a,e.b,e.c,e.d,e.e,e.f)}function u8(t){return t==null||(rf||(rf=document.createElementNS("http://www.w3.org/2000/svg","g")),rf.setAttribute("transform",t),!(t=rf.transform.baseVal.consolidate()))?t0:(t=t.matrix,TI(t.a,t.b,t.c,t.d,t.e,t.f))}function SI(t,e,n,r){function i(d){return d.length?d.pop()+" ":""}function s(d,h,m,_,y,T){if(d!==m||h!==_){var w=y.push("translate(",null,e,null,n);T.push({i:w-4,x:Gi(d,m)},{i:w-2,x:Gi(h,_)})}else(m||_)&&y.push("translate("+m+e+_+n)}function o(d,h,m,_){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),_.push({i:m.push(i(m)+"rotate(",null,r)-2,x:Gi(d,h)})):h&&m.push(i(m)+"rotate("+h+r)}function l(d,h,m,_){d!==h?_.push({i:m.push(i(m)+"skewX(",null,r)-2,x:Gi(d,h)}):h&&m.push(i(m)+"skewX("+h+r)}function u(d,h,m,_,y,T){if(d!==m||h!==_){var w=y.push(i(y)+"scale(",null,",",null,")");T.push({i:w-4,x:Gi(d,m)},{i:w-2,x:Gi(h,_)})}else(m!==1||_!==1)&&y.push(i(y)+"scale("+m+","+_+")")}return function(d,h){var m=[],_=[];return d=t(d),h=t(h),s(d.translateX,d.translateY,h.translateX,h.translateY,m,_),o(d.rotate,h.rotate,m,_),l(d.skewX,h.skewX,m,_),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,m,_),d=h=null,function(y){for(var T=-1,w=_.length,b;++T<w;)m[(b=_[T]).i]=b.x(y);return m.join("")}}}var f8=SI(c8,"px, ","px)","deg)"),d8=SI(u8,", ",")",")"),h8=1e-12;function I3(t){return((t=Math.exp(t))+1/t)/2}function p8(t){return((t=Math.exp(t))-1/t)/2}function g8(t){return((t=Math.exp(2*t))-1)/(t+1)}const m8=function t(e,n,r){function i(s,o){var l=s[0],u=s[1],d=s[2],h=o[0],m=o[1],_=o[2],y=h-l,T=m-u,w=y*y+T*T,b,S;if(w<h8)S=Math.log(_/d)/e,b=function(P){return[l+P*y,u+P*T,d*Math.exp(e*P*S)]};else{var A=Math.sqrt(w),R=(_*_-d*d+r*w)/(2*d*n*A),E=(_*_-d*d-r*w)/(2*_*n*A),C=Math.log(Math.sqrt(R*R+1)-R),O=Math.log(Math.sqrt(E*E+1)-E);S=(O-C)/e,b=function(P){var k=P*S,I=I3(C),N=d/(n*A)*(I*g8(e*k+C)-p8(C));return[l+N*y,u+N*T,d*I/I3(e*k+C)]}}return b.duration=S*1e3*e/Math.SQRT2,b}return i.rho=function(s){var o=Math.max(.001,+s),l=o*o,u=l*l;return t(o,l,u)},i}(Math.SQRT2,2,4);var mo=0,Vl=0,Ll=0,EI=1e3,Bf,Hl,Uf=0,Vs=0,Fd=0,wc=typeof performance=="object"&&performance.now?performance:Date,AI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function l1(){return Vs||(AI(_8),Vs=wc.now()+Fd)}function _8(){Vs=0}function Ff(){this._call=this._time=this._next=null}Ff.prototype=c1.prototype={constructor:Ff,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?l1():+n)+(e==null?0:+e),!this._next&&Hl!==this&&(Hl?Hl._next=this:Bf=this,Hl=this),this._call=t,this._time=n,n0()},stop:function(){this._call&&(this._call=null,this._time=1/0,n0())}};function c1(t,e,n){var r=new Ff;return r.restart(t,e,n),r}function v8(){l1(),++mo;for(var t=Bf,e;t;)(e=Vs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--mo}function O3(){Vs=(Uf=wc.now())+Fd,mo=Vl=0;try{v8()}finally{mo=0,x8(),Vs=0}}function y8(){var t=wc.now(),e=t-Uf;e>EI&&(Fd-=e,Uf=t)}function x8(){for(var t,e=Bf,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Bf=n);Hl=t,n0(r)}function n0(t){if(!mo){Vl&&(Vl=clearTimeout(Vl));var e=t-Vs;e>24?(t<1/0&&(Vl=setTimeout(O3,t-wc.now()-Fd)),Ll&&(Ll=clearInterval(Ll))):(Ll||(Uf=wc.now(),Ll=setInterval(y8,EI)),mo=1,AI(O3))}}function P3(t,e,n){var r=new Ff;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var b8=Cc("start","end","cancel","interrupt"),w8=[],RI=0,D3=1,r0=2,Tf=3,j3=4,i0=5,Sf=6;function zd(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;T8(t,n,{name:e,index:r,group:i,on:b8,tween:w8,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:RI})}function u1(t,e){var n=Mr(t,e);if(n.state>RI)throw new Error("too late; already scheduled");return n}function Xr(t,e){var n=Mr(t,e);if(n.state>Tf)throw new Error("too late; already running");return n}function Mr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function T8(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=c1(s,0,n.time);function s(d){n.state=D3,n.timer.restart(o,n.delay,n.time),n.delay<=d&&o(d-n.delay)}function o(d){var h,m,_,y;if(n.state!==D3)return u();for(h in r)if(y=r[h],y.name===n.name){if(y.state===Tf)return P3(o);y.state===j3?(y.state=Sf,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete r[h]):+h<e&&(y.state=Sf,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete r[h])}if(P3(function(){n.state===Tf&&(n.state=j3,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=r0,n.on.call("start",t,t.__data__,n.index,n.group),n.state===r0){for(n.state=Tf,i=new Array(_=n.tween.length),h=0,m=-1;h<_;++h)(y=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++m]=y);i.length=m+1}}function l(d){for(var h=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=i0,1),m=-1,_=i.length;++m<_;)i[m].call(t,h);n.state===i0&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Sf,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function Ef(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>r0&&r.state<i0,r.state=Sf,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function S8(t){return this.each(function(){Ef(this,t)})}function E8(t,e){var n,r;return function(){var i=Xr(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function A8(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Xr(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}s.tween=i}}function R8(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Mr(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?E8:A8)(n,t,e))}function f1(t,e,n){var r=t._id;return t.each(function(){var i=Xr(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Mr(i,r).value[e]}}function CI(t,e){var n;return(typeof e=="number"?Gi:e instanceof bc?k3:(n=bc(e))?(e=n,k3):l8)(t,e)}function C8(t){return function(){this.removeAttribute(t)}}function N8(t){return function(){this.removeAttributeNS(t.space,t.local)}}function k8(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function M8(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function I8(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function O8(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function P8(t,e){var n=Ud(t),r=n==="transform"?d8:CI;return this.attrTween(t,typeof e=="function"?(n.local?O8:I8)(n,r,f1(this,"attr."+t,e)):e==null?(n.local?N8:C8)(n):(n.local?M8:k8)(n,r,e))}function D8(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function j8(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function L8(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&j8(t,s)),n}return i._value=e,i}function B8(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&D8(t,s)),n}return i._value=e,i}function U8(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ud(t);return this.tween(n,(r.local?L8:B8)(r,e))}function F8(t,e){return function(){u1(this,t).delay=+e.apply(this,arguments)}}function z8(t,e){return e=+e,function(){u1(this,t).delay=e}}function $8(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?F8:z8)(e,t)):Mr(this.node(),e).delay}function q8(t,e){return function(){Xr(this,t).duration=+e.apply(this,arguments)}}function V8(t,e){return e=+e,function(){Xr(this,t).duration=e}}function H8(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?q8:V8)(e,t)):Mr(this.node(),e).duration}function W8(t,e){if(typeof e!="function")throw new Error;return function(){Xr(this,t).ease=e}}function X8(t){var e=this._id;return arguments.length?this.each(W8(e,t)):Mr(this.node(),e).ease}function Y8(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Xr(this,t).ease=n}}function G8(t){if(typeof t!="function")throw new Error;return this.each(Y8(this._id,t))}function K8(t){typeof t!="function"&&(t=oI(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new vi(r,this._parents,this._name,this._id)}function Z8(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),l=0;l<s;++l)for(var u=e[l],d=n[l],h=u.length,m=o[l]=new Array(h),_,y=0;y<h;++y)(_=u[y]||d[y])&&(m[y]=_);for(;l<r;++l)o[l]=e[l];return new vi(o,this._parents,this._name,this._id)}function Q8(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function J8(t,e,n){var r,i,s=Q8(e)?u1:Xr;return function(){var o=s(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function e5(t,e){var n=this._id;return arguments.length<2?Mr(this.node(),n).on.on(t):this.each(J8(n,t,e))}function t5(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function n5(){return this.on("end.remove",t5(this._id))}function r5(t){var e=this._name,n=this._id;typeof t!="function"&&(t=s1(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=s[o]=new Array(u),h,m,_=0;_<u;++_)(h=l[_])&&(m=t.call(h,h.__data__,_,l))&&("__data__"in h&&(m.__data__=h.__data__),d[_]=m,zd(d[_],e,n,_,d,Mr(h,n)));return new vi(s,this._parents,e,n)}function i5(t){var e=this._name,n=this._id;typeof t!="function"&&(t=aI(t));for(var r=this._groups,i=r.length,s=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,h,m=0;m<d;++m)if(h=u[m]){for(var _=t.call(h,h.__data__,m,u),y,T=Mr(h,n),w=0,b=_.length;w<b;++w)(y=_[w])&&zd(y,e,n,w,_,T);s.push(_),o.push(h)}return new vi(s,o,e,n)}var s5=Nc.prototype.constructor;function a5(){return new s5(this._groups,this._parents)}function o5(t,e){var n,r,i;return function(){var s=go(this,t),o=(this.style.removeProperty(t),go(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function NI(t){return function(){this.style.removeProperty(t)}}function l5(t,e,n){var r,i=n+"",s;return function(){var o=go(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function c5(t,e,n){var r,i,s;return function(){var o=go(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),go(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l))}}function u5(t,e){var n,r,i,s="style."+e,o="end."+s,l;return function(){var u=Xr(this,t),d=u.on,h=u.value[s]==null?l||(l=NI(e)):void 0;(d!==n||i!==h)&&(r=(n=d).copy()).on(o,i=h),u.on=r}}function f5(t,e,n){var r=(t+="")=="transform"?f8:CI;return e==null?this.styleTween(t,o5(t,r)).on("end.style."+t,NI(t)):typeof e=="function"?this.styleTween(t,c5(t,r,f1(this,"style."+t,e))).each(u5(this._id,t)):this.styleTween(t,l5(t,r,e),n).on("end.style."+t,null)}function d5(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function h5(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&d5(t,o,n)),r}return s._value=e,s}function p5(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,h5(t,e,n??""))}function g5(t){return function(){this.textContent=t}}function m5(t){return function(){var e=t(this);this.textContent=e??""}}function _5(t){return this.tween("text",typeof t=="function"?m5(f1(this,"text",t)):g5(t==null?"":t+""))}function v5(t){return function(e){this.textContent=t.call(this,e)}}function y5(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&v5(i)),e}return r._value=t,r}function x5(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,y5(t))}function b5(){for(var t=this._name,e=this._id,n=kI(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=Mr(u,e);zd(u,t,n,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new vi(r,this._parents,t,n)}function w5(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var l={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var d=Xr(this,r),h=d.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&s()})}var T5=0;function vi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function kI(){return++T5}var di=Nc.prototype;vi.prototype={constructor:vi,select:r5,selectAll:i5,selectChild:di.selectChild,selectChildren:di.selectChildren,filter:K8,merge:Z8,selection:a5,transition:b5,call:di.call,nodes:di.nodes,node:di.node,size:di.size,empty:di.empty,each:di.each,on:e5,attr:P8,attrTween:U8,style:f5,styleTween:p5,text:_5,textTween:x5,remove:n5,tween:R8,delay:$8,duration:H8,ease:X8,easeVarying:G8,end:w5,[Symbol.iterator]:di[Symbol.iterator]};function S5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var E5={time:null,delay:0,duration:250,ease:S5};function A5(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function R5(t){var e,n;t instanceof vi?(e=t._id,t=t._name):(e=kI(),(n=E5).time=l1(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&zd(u,t,e,d,o,n||A5(u,e));return new vi(r,this._parents,t,e)}Nc.prototype.interrupt=S8;Nc.prototype.transition=R5;function C5(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return MI(this.cover(e,n),e,n,t)}function MI(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},l=t._x0,u=t._y0,d=t._x1,h=t._y1,m,_,y,T,w,b,S,A;if(!s)return t._root=o,t;for(;s.length;)if((w=e>=(m=(l+d)/2))?l=m:d=m,(b=n>=(_=(u+h)/2))?u=_:h=_,i=s,!(s=s[S=b<<1|w]))return i[S]=o,t;if(y=+t._x.call(null,s.data),T=+t._y.call(null,s.data),e===y&&n===T)return o.next=s,i?i[S]=o:t._root=o,t;do i=i?i[S]=new Array(4):t._root=new Array(4),(w=e>=(m=(l+d)/2))?l=m:d=m,(b=n>=(_=(u+h)/2))?u=_:h=_;while((S=b<<1|w)===(A=(T>=_)<<1|y>=m));return i[A]=s,i[S]=o,t}function N5(t){var e,n,r=t.length,i,s,o=new Array(r),l=new Array(r),u=1/0,d=1/0,h=-1/0,m=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,l[n]=s,i<u&&(u=i),i>h&&(h=i),s<d&&(d=s),s>m&&(m=s));if(u>h||d>m)return this;for(this.cover(u,d).cover(h,m),n=0;n<r;++n)MI(this,o[n],l[n],t[n]);return this}function k5(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,l=this._root,u,d;n>t||t>=i||r>e||e>=s;)switch(d=(e<r)<<1|t<n,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function M5(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function I5(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Rn(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function O5(t,e,n){var r,i=this._x0,s=this._y0,o,l,u,d,h=this._x1,m=this._y1,_=[],y=this._root,T,w;for(y&&_.push(new Rn(y,i,s,h,m)),n==null?n=1/0:(i=t-n,s=e-n,h=t+n,m=e+n,n*=n);T=_.pop();)if(!(!(y=T.node)||(o=T.x0)>h||(l=T.y0)>m||(u=T.x1)<i||(d=T.y1)<s))if(y.length){var b=(o+u)/2,S=(l+d)/2;_.push(new Rn(y[3],b,S,u,d),new Rn(y[2],o,S,b,d),new Rn(y[1],b,l,u,S),new Rn(y[0],o,l,b,S)),(w=(e>=S)<<1|t>=b)&&(T=_[_.length-1],_[_.length-1]=_[_.length-1-w],_[_.length-1-w]=T)}else{var A=t-+this._x.call(null,y.data),R=e-+this._y.call(null,y.data),E=A*A+R*R;if(E<n){var C=Math.sqrt(n=E);i=t-C,s=e-C,h=t+C,m=e+C,r=y.data}}return r}function P5(t){if(isNaN(h=+this._x.call(null,t))||isNaN(m=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,m,_,y,T,w,b,S;if(!n)return this;if(n.length)for(;;){if((T=h>=(_=(o+u)/2))?o=_:u=_,(w=m>=(y=(l+d)/2))?l=y:d=y,e=n,!(n=n[b=w<<1|T]))return this;if(!n.length)break;(e[b+1&3]||e[b+2&3]||e[b+3&3])&&(r=e,S=b)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[b]=s:delete e[b],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[S]=n:this._root=n),this):(this._root=s,this)}function D5(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function j5(){return this._root}function L5(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function B5(t){var e=[],n,r=this._root,i,s,o,l,u;for(r&&e.push(new Rn(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,l=n.x1,u=n.y1)&&r.length){var d=(s+l)/2,h=(o+u)/2;(i=r[3])&&e.push(new Rn(i,d,h,l,u)),(i=r[2])&&e.push(new Rn(i,s,h,d,u)),(i=r[1])&&e.push(new Rn(i,d,o,l,h)),(i=r[0])&&e.push(new Rn(i,s,o,d,h))}return this}function U5(t){var e=[],n=[],r;for(this._root&&e.push(new Rn(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,l=r.y0,u=r.x1,d=r.y1,h=(o+u)/2,m=(l+d)/2;(s=i[0])&&e.push(new Rn(s,o,l,h,m)),(s=i[1])&&e.push(new Rn(s,h,l,u,m)),(s=i[2])&&e.push(new Rn(s,o,m,h,d)),(s=i[3])&&e.push(new Rn(s,h,m,u,d))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function F5(t){return t[0]}function z5(t){return arguments.length?(this._x=t,this):this._x}function $5(t){return t[1]}function q5(t){return arguments.length?(this._y=t,this):this._y}function d1(t,e,n){var r=new h1(e??F5,n??$5,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function h1(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function L3(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Nn=d1.prototype=h1.prototype;Nn.copy=function(){var t=new h1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=L3(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=L3(r));return t};Nn.add=C5;Nn.addAll=N5;Nn.cover=k5;Nn.data=M5;Nn.extent=I5;Nn.find=O5;Nn.remove=P5;Nn.removeAll=D5;Nn.root=j5;Nn.size=L5;Nn.visit=B5;Nn.visitAfter=U5;Nn.x=z5;Nn.y=q5;function Cn(t){return function(){return t}}function ns(t){return(t()-.5)*1e-6}function V5(t){return t.x+t.vx}function H5(t){return t.y+t.vy}function W5(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Cn(t==null?1:+t));function o(){for(var d,h=e.length,m,_,y,T,w,b,S=0;S<s;++S)for(m=d1(e,V5,H5).visitAfter(l),d=0;d<h;++d)_=e[d],w=n[_.index],b=w*w,y=_.x+_.vx,T=_.y+_.vy,m.visit(A);function A(R,E,C,O,P){var k=R.data,I=R.r,N=w+I;if(k){if(k.index>_.index){var L=y-k.x-k.vx,$=T-k.y-k.vy,Z=L*L+$*$;Z<N*N&&(L===0&&(L=ns(r),Z+=L*L),$===0&&($=ns(r),Z+=$*$),Z=(N-(Z=Math.sqrt(Z)))/Z*i,_.vx+=(L*=Z)*(N=(I*=I)/(b+I)),_.vy+=($*=Z)*N,k.vx-=L*(N=1-N),k.vy-=$*N)}return}return E>y+N||O<y-N||C>T+N||P<T-N}}function l(d){if(d.data)return d.r=n[d.data.index];for(var h=d.r=0;h<4;++h)d[h]&&d[h].r>d.r&&(d.r=d[h].r)}function u(){if(e){var d,h=e.length,m;for(n=new Array(h),d=0;d<h;++d)m=e[d],n[m.index]=+t(m,d,e)}}return o.initialize=function(d,h){e=d,r=h,u()},o.iterations=function(d){return arguments.length?(s=+d,o):s},o.strength=function(d){return arguments.length?(i=+d,o):i},o.radius=function(d){return arguments.length?(t=typeof d=="function"?d:Cn(+d),u(),o):t},o}function X5(t){return t.index}function B3(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function Y5(t){var e=X5,n=m,r,i=Cn(30),s,o,l,u,d,h=1;t==null&&(t=[]);function m(b){return 1/Math.min(l[b.source.index],l[b.target.index])}function _(b){for(var S=0,A=t.length;S<h;++S)for(var R=0,E,C,O,P,k,I,N;R<A;++R)E=t[R],C=E.source,O=E.target,P=O.x+O.vx-C.x-C.vx||ns(d),k=O.y+O.vy-C.y-C.vy||ns(d),I=Math.sqrt(P*P+k*k),I=(I-s[R])/I*b*r[R],P*=I,k*=I,O.vx-=P*(N=u[R]),O.vy-=k*N,C.vx+=P*(N=1-N),C.vy+=k*N}function y(){if(o){var b,S=o.length,A=t.length,R=new Map(o.map((C,O)=>[e(C,O,o),C])),E;for(b=0,l=new Array(S);b<A;++b)E=t[b],E.index=b,typeof E.source!="object"&&(E.source=B3(R,E.source)),typeof E.target!="object"&&(E.target=B3(R,E.target)),l[E.source.index]=(l[E.source.index]||0)+1,l[E.target.index]=(l[E.target.index]||0)+1;for(b=0,u=new Array(A);b<A;++b)E=t[b],u[b]=l[E.source.index]/(l[E.source.index]+l[E.target.index]);r=new Array(A),T(),s=new Array(A),w()}}function T(){if(o)for(var b=0,S=t.length;b<S;++b)r[b]=+n(t[b],b,t)}function w(){if(o)for(var b=0,S=t.length;b<S;++b)s[b]=+i(t[b],b,t)}return _.initialize=function(b,S){o=b,d=S,y()},_.links=function(b){return arguments.length?(t=b,y(),_):t},_.id=function(b){return arguments.length?(e=b,_):e},_.iterations=function(b){return arguments.length?(h=+b,_):h},_.strength=function(b){return arguments.length?(n=typeof b=="function"?b:Cn(+b),T(),_):n},_.distance=function(b){return arguments.length?(i=typeof b=="function"?b:Cn(+b),w(),_):i},_}const G5=1664525,K5=1013904223,U3=4294967296;function Z5(){let t=1;return()=>(t=(G5*t+K5)%U3)/U3}function Q5(t){return t.x}function J5(t){return t.y}var ez=10,tz=Math.PI*(3-Math.sqrt(5));function nz(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,l=new Map,u=c1(m),d=Cc("tick","end"),h=Z5();t==null&&(t=[]);function m(){_(),d.call("tick",e),n<r&&(u.stop(),d.call("end",e))}function _(w){var b,S=t.length,A;w===void 0&&(w=1);for(var R=0;R<w;++R)for(n+=(s-n)*i,l.forEach(function(E){E(n)}),b=0;b<S;++b)A=t[b],A.fx==null?A.x+=A.vx*=o:(A.x=A.fx,A.vx=0),A.fy==null?A.y+=A.vy*=o:(A.y=A.fy,A.vy=0);return e}function y(){for(var w=0,b=t.length,S;w<b;++w){if(S=t[w],S.index=w,S.fx!=null&&(S.x=S.fx),S.fy!=null&&(S.y=S.fy),isNaN(S.x)||isNaN(S.y)){var A=ez*Math.sqrt(.5+w),R=w*tz;S.x=A*Math.cos(R),S.y=A*Math.sin(R)}(isNaN(S.vx)||isNaN(S.vy))&&(S.vx=S.vy=0)}}function T(w){return w.initialize&&w.initialize(t,h),w}return y(),e={tick:_,restart:function(){return u.restart(m),e},stop:function(){return u.stop(),e},nodes:function(w){return arguments.length?(t=w,y(),l.forEach(T),e):t},alpha:function(w){return arguments.length?(n=+w,e):n},alphaMin:function(w){return arguments.length?(r=+w,e):r},alphaDecay:function(w){return arguments.length?(i=+w,e):+i},alphaTarget:function(w){return arguments.length?(s=+w,e):s},velocityDecay:function(w){return arguments.length?(o=1-w,e):1-o},randomSource:function(w){return arguments.length?(h=w,l.forEach(T),e):h},force:function(w,b){return arguments.length>1?(b==null?l.delete(w):l.set(w,T(b)),e):l.get(w)},find:function(w,b,S){var A=0,R=t.length,E,C,O,P,k;for(S==null?S=1/0:S*=S,A=0;A<R;++A)P=t[A],E=w-P.x,C=b-P.y,O=E*E+C*C,O<S&&(k=P,S=O);return k},on:function(w,b){return arguments.length>1?(d.on(w,b),e):d.on(w)}}}function rz(){var t,e,n,r,i=Cn(-30),s,o=1,l=1/0,u=.81;function d(y){var T,w=t.length,b=d1(t,Q5,J5).visitAfter(m);for(r=y,T=0;T<w;++T)e=t[T],b.visit(_)}function h(){if(t){var y,T=t.length,w;for(s=new Array(T),y=0;y<T;++y)w=t[y],s[w.index]=+i(w,y,t)}}function m(y){var T=0,w,b,S=0,A,R,E;if(y.length){for(A=R=E=0;E<4;++E)(w=y[E])&&(b=Math.abs(w.value))&&(T+=w.value,S+=b,A+=b*w.x,R+=b*w.y);y.x=A/S,y.y=R/S}else{w=y,w.x=w.data.x,w.y=w.data.y;do T+=s[w.data.index];while(w=w.next)}y.value=T}function _(y,T,w,b){if(!y.value)return!0;var S=y.x-e.x,A=y.y-e.y,R=b-T,E=S*S+A*A;if(R*R/u<E)return E<l&&(S===0&&(S=ns(n),E+=S*S),A===0&&(A=ns(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)),e.vx+=S*y.value*r/E,e.vy+=A*y.value*r/E),!0;if(y.length||E>=l)return;(y.data!==e||y.next)&&(S===0&&(S=ns(n),E+=S*S),A===0&&(A=ns(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)));do y.data!==e&&(R=s[y.data.index]*r/E,e.vx+=S*R,e.vy+=A*R);while(y=y.next)}return d.initialize=function(y,T){t=y,n=T,h()},d.strength=function(y){return arguments.length?(i=typeof y=="function"?y:Cn(+y),h(),d):i},d.distanceMin=function(y){return arguments.length?(o=y*y,d):Math.sqrt(o)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(u=y*y,d):Math.sqrt(u)},d}function iz(t){var e=Cn(.1),n,r,i;typeof t!="function"&&(t=Cn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vx+=(i[u]-h.x)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Cn(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Cn(+l),o(),s):t},s}function sz(t){var e=Cn(.1),n,r,i;typeof t!="function"&&(t=Cn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vy+=(i[u]-h.y)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Cn(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Cn(+l),o(),s):t},s}const sf=t=>()=>t;function az(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function _i(t,e,n){this.k=t,this.x=e,this.y=n}_i.prototype={constructor:_i,scale:function(t){return t===1?this:new _i(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new _i(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var $d=new _i(1,0,0);_i.prototype;function $g(t){t.stopImmediatePropagation()}function Bl(t){t.preventDefault(),t.stopImmediatePropagation()}function oz(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function lz(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function F3(){return this.__zoom||$d}function cz(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function uz(){return navigator.maxTouchPoints||"ontouchstart"in this}function fz(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function dz(){var t=oz,e=lz,n=fz,r=cz,i=uz,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=m8,d=Cc("start","zoom","end"),h,m,_,y=500,T=150,w=0,b=10;function S(V){V.property("__zoom",F3).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",N).filter(i).on("touchstart.zoom",L).on("touchmove.zoom",$).on("touchend.zoom touchcancel.zoom",Z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}S.transform=function(V,q,z,Q){var oe=V.selection?V.selection():V;oe.property("__zoom",F3),V!==oe?C(V,q,z,Q):oe.interrupt().each(function(){O(this,arguments).event(Q).start().zoom(null,typeof q=="function"?q.apply(this,arguments):q).end()})},S.scaleBy=function(V,q,z,Q){S.scaleTo(V,function(){var oe=this.__zoom.k,G=typeof q=="function"?q.apply(this,arguments):q;return oe*G},z,Q)},S.scaleTo=function(V,q,z,Q){S.transform(V,function(){var oe=e.apply(this,arguments),G=this.__zoom,D=z==null?E(oe):typeof z=="function"?z.apply(this,arguments):z,Y=G.invert(D),le=typeof q=="function"?q.apply(this,arguments):q;return n(R(A(G,le),D,Y),oe,o)},z,Q)},S.translateBy=function(V,q,z,Q){S.transform(V,function(){return n(this.__zoom.translate(typeof q=="function"?q.apply(this,arguments):q,typeof z=="function"?z.apply(this,arguments):z),e.apply(this,arguments),o)},null,Q)},S.translateTo=function(V,q,z,Q,oe){S.transform(V,function(){var G=e.apply(this,arguments),D=this.__zoom,Y=Q==null?E(G):typeof Q=="function"?Q.apply(this,arguments):Q;return n($d.translate(Y[0],Y[1]).scale(D.k).translate(typeof q=="function"?-q.apply(this,arguments):-q,typeof z=="function"?-z.apply(this,arguments):-z),G,o)},Q,oe)};function A(V,q){return q=Math.max(s[0],Math.min(s[1],q)),q===V.k?V:new _i(q,V.x,V.y)}function R(V,q,z){var Q=q[0]-z[0]*V.k,oe=q[1]-z[1]*V.k;return Q===V.x&&oe===V.y?V:new _i(V.k,Q,oe)}function E(V){return[(+V[0][0]+ +V[1][0])/2,(+V[0][1]+ +V[1][1])/2]}function C(V,q,z,Q){V.on("start.zoom",function(){O(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(Q).end()}).tween("zoom",function(){var oe=this,G=arguments,D=O(oe,G).event(Q),Y=e.apply(oe,G),le=z==null?E(Y):typeof z=="function"?z.apply(oe,G):z,ie=Math.max(Y[1][0]-Y[0][0],Y[1][1]-Y[0][1]),F=oe.__zoom,X=typeof q=="function"?q.apply(oe,G):q,J=u(F.invert(le).concat(ie/F.k),X.invert(le).concat(ie/X.k));return function(pe){if(pe===1)pe=X;else{var ye=J(pe),Ae=ie/ye[2];pe=new _i(Ae,le[0]-ye[0]*Ae,le[1]-ye[1]*Ae)}D.zoom(null,pe)}})}function O(V,q,z){return!z&&V.__zooming||new P(V,q)}function P(V,q){this.that=V,this.args=q,this.active=0,this.sourceEvent=null,this.extent=e.apply(V,q),this.taps=0}P.prototype={event:function(V){return V&&(this.sourceEvent=V),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(V,q){return this.mouse&&V!=="mouse"&&(this.mouse[1]=q.invert(this.mouse[0])),this.touch0&&V!=="touch"&&(this.touch0[1]=q.invert(this.touch0[0])),this.touch1&&V!=="touch"&&(this.touch1[1]=q.invert(this.touch1[0])),this.that.__zoom=q,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(V){var q=cr(this.that).datum();d.call(V,this.that,new az(V,{sourceEvent:this.sourceEvent,target:S,transform:this.that.__zoom,dispatch:d}),q)}};function k(V,...q){if(!t.apply(this,arguments))return;var z=O(this,q).event(V),Q=this.__zoom,oe=Math.max(s[0],Math.min(s[1],Q.k*Math.pow(2,r.apply(this,arguments)))),G=hi(V);if(z.wheel)(z.mouse[0][0]!==G[0]||z.mouse[0][1]!==G[1])&&(z.mouse[1]=Q.invert(z.mouse[0]=G)),clearTimeout(z.wheel);else{if(Q.k===oe)return;z.mouse=[G,Q.invert(G)],Ef(this),z.start()}Bl(V),z.wheel=setTimeout(D,T),z.zoom("mouse",n(R(A(Q,oe),z.mouse[0],z.mouse[1]),z.extent,o));function D(){z.wheel=null,z.end()}}function I(V,...q){if(_||!t.apply(this,arguments))return;var z=V.currentTarget,Q=O(this,q,!0).event(V),oe=cr(V.view).on("mousemove.zoom",le,!0).on("mouseup.zoom",ie,!0),G=hi(V,z),D=V.clientX,Y=V.clientY;_I(V.view),$g(V),Q.mouse=[G,this.__zoom.invert(G)],Ef(this),Q.start();function le(F){if(Bl(F),!Q.moved){var X=F.clientX-D,J=F.clientY-Y;Q.moved=X*X+J*J>w}Q.event(F).zoom("mouse",n(R(Q.that.__zoom,Q.mouse[0]=hi(F,z),Q.mouse[1]),Q.extent,o))}function ie(F){oe.on("mousemove.zoom mouseup.zoom",null),vI(F.view,Q.moved),Bl(F),Q.event(F).end()}}function N(V,...q){if(t.apply(this,arguments)){var z=this.__zoom,Q=hi(V.changedTouches?V.changedTouches[0]:V,this),oe=z.invert(Q),G=z.k*(V.shiftKey?.5:2),D=n(R(A(z,G),Q,oe),e.apply(this,q),o);Bl(V),l>0?cr(this).transition().duration(l).call(C,D,Q,V):cr(this).call(S.transform,D,Q,V)}}function L(V,...q){if(t.apply(this,arguments)){var z=V.touches,Q=z.length,oe=O(this,q,V.changedTouches.length===Q).event(V),G,D,Y,le;for($g(V),D=0;D<Q;++D)Y=z[D],le=hi(Y,this),le=[le,this.__zoom.invert(le),Y.identifier],oe.touch0?!oe.touch1&&oe.touch0[2]!==le[2]&&(oe.touch1=le,oe.taps=0):(oe.touch0=le,G=!0,oe.taps=1+!!h);h&&(h=clearTimeout(h)),G&&(oe.taps<2&&(m=le[0],h=setTimeout(function(){h=null},y)),Ef(this),oe.start())}}function $(V,...q){if(this.__zooming){var z=O(this,q).event(V),Q=V.changedTouches,oe=Q.length,G,D,Y,le;for(Bl(V),G=0;G<oe;++G)D=Q[G],Y=hi(D,this),z.touch0&&z.touch0[2]===D.identifier?z.touch0[0]=Y:z.touch1&&z.touch1[2]===D.identifier&&(z.touch1[0]=Y);if(D=z.that.__zoom,z.touch1){var ie=z.touch0[0],F=z.touch0[1],X=z.touch1[0],J=z.touch1[1],pe=(pe=X[0]-ie[0])*pe+(pe=X[1]-ie[1])*pe,ye=(ye=J[0]-F[0])*ye+(ye=J[1]-F[1])*ye;D=A(D,Math.sqrt(pe/ye)),Y=[(ie[0]+X[0])/2,(ie[1]+X[1])/2],le=[(F[0]+J[0])/2,(F[1]+J[1])/2]}else if(z.touch0)Y=z.touch0[0],le=z.touch0[1];else return;z.zoom("touch",n(R(D,Y,le),z.extent,o))}}function Z(V,...q){if(this.__zooming){var z=O(this,q).event(V),Q=V.changedTouches,oe=Q.length,G,D;for($g(V),_&&clearTimeout(_),_=setTimeout(function(){_=null},y),G=0;G<oe;++G)D=Q[G],z.touch0&&z.touch0[2]===D.identifier?delete z.touch0:z.touch1&&z.touch1[2]===D.identifier&&delete z.touch1;if(z.touch1&&!z.touch0&&(z.touch0=z.touch1,delete z.touch1),z.touch0)z.touch0[1]=this.__zoom.invert(z.touch0[0]);else if(z.end(),z.taps===2&&(D=hi(D,this),Math.hypot(m[0]-D[0],m[1]-D[1])<b)){var Y=cr(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return S.wheelDelta=function(V){return arguments.length?(r=typeof V=="function"?V:sf(+V),S):r},S.filter=function(V){return arguments.length?(t=typeof V=="function"?V:sf(!!V),S):t},S.touchable=function(V){return arguments.length?(i=typeof V=="function"?V:sf(!!V),S):i},S.extent=function(V){return arguments.length?(e=typeof V=="function"?V:sf([[+V[0][0],+V[0][1]],[+V[1][0],+V[1][1]]]),S):e},S.scaleExtent=function(V){return arguments.length?(s[0]=+V[0],s[1]=+V[1],S):[s[0],s[1]]},S.translateExtent=function(V){return arguments.length?(o[0][0]=+V[0][0],o[1][0]=+V[1][0],o[0][1]=+V[0][1],o[1][1]=+V[1][1],S):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},S.constrain=function(V){return arguments.length?(n=V,S):n},S.duration=function(V){return arguments.length?(l=+V,S):l},S.interpolate=function(V){return arguments.length?(u=V,S):u},S.on=function(){var V=d.on.apply(d,arguments);return V===d?S:V},S.clickDistance=function(V){return arguments.length?(w=(V=+V)*V,S):Math.sqrt(w)},S.tapDistance=function(V){return arguments.length?(b=+V,S):b},S}function p1(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qg,z3;function hz(){if(z3)return qg;z3=1;function t(){this.__data__=[],this.size=0}return qg=t,qg}var Vg,$3;function Mo(){if($3)return Vg;$3=1;function t(e,n){return e===n||e!==e&&n!==n}return Vg=t,Vg}var Hg,q3;function qd(){if(q3)return Hg;q3=1;var t=Mo();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return Hg=e,Hg}var Wg,V3;function pz(){if(V3)return Wg;V3=1;var t=qd(),e=Array.prototype,n=e.splice;function r(i){var s=this.__data__,o=t(s,i);if(o<0)return!1;var l=s.length-1;return o==l?s.pop():n.call(s,o,1),--this.size,!0}return Wg=r,Wg}var Xg,H3;function gz(){if(H3)return Xg;H3=1;var t=qd();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return Xg=e,Xg}var Yg,W3;function mz(){if(W3)return Yg;W3=1;var t=qd();function e(n){return t(this.__data__,n)>-1}return Yg=e,Yg}var Gg,X3;function _z(){if(X3)return Gg;X3=1;var t=qd();function e(n,r){var i=this.__data__,s=t(i,n);return s<0?(++this.size,i.push([n,r])):i[s][1]=r,this}return Gg=e,Gg}var Kg,Y3;function Vd(){if(Y3)return Kg;Y3=1;var t=hz(),e=pz(),n=gz(),r=mz(),i=_z();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,Kg=s,Kg}var Zg,G3;function vz(){if(G3)return Zg;G3=1;var t=Vd();function e(){this.__data__=new t,this.size=0}return Zg=e,Zg}var Qg,K3;function yz(){if(K3)return Qg;K3=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return Qg=t,Qg}var Jg,Z3;function xz(){if(Z3)return Jg;Z3=1;function t(e){return this.__data__.get(e)}return Jg=t,Jg}var em,Q3;function bz(){if(Q3)return em;Q3=1;function t(e){return this.__data__.has(e)}return em=t,em}var tm,J3;function II(){if(J3)return tm;J3=1;var t=typeof Qu=="object"&&Qu&&Qu.Object===Object&&Qu;return tm=t,tm}var nm,eE;function Ir(){if(eE)return nm;eE=1;var t=II(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return nm=n,nm}var rm,tE;function Io(){if(tE)return rm;tE=1;var t=Ir(),e=t.Symbol;return rm=e,rm}var im,nE;function wz(){if(nE)return im;nE=1;var t=Io(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function s(o){var l=n.call(o,i),u=o[i];try{o[i]=void 0;var d=!0}catch{}var h=r.call(o);return d&&(l?o[i]=u:delete o[i]),h}return im=s,im}var sm,rE;function Tz(){if(rE)return sm;rE=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return sm=n,sm}var am,iE;function Js(){if(iE)return am;iE=1;var t=Io(),e=wz(),n=Tz(),r="[object Null]",i="[object Undefined]",s=t?t.toStringTag:void 0;function o(l){return l==null?l===void 0?i:r:s&&s in Object(l)?e(l):n(l)}return am=o,am}var om,sE;function gr(){if(sE)return om;sE=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return om=t,om}var lm,aE;function Mc(){if(aE)return lm;aE=1;var t=Js(),e=gr(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function o(l){if(!e(l))return!1;var u=t(l);return u==r||u==i||u==n||u==s}return lm=o,lm}var cm,oE;function Sz(){if(oE)return cm;oE=1;var t=Ir(),e=t["__core-js_shared__"];return cm=e,cm}var um,lE;function Ez(){if(lE)return um;lE=1;var t=Sz(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return um=n,um}var fm,cE;function OI(){if(cE)return fm;cE=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return fm=n,fm}var dm,uE;function Az(){if(uE)return dm;uE=1;var t=Mc(),e=Ez(),n=gr(),r=OI(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,u=o.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function m(_){if(!n(_)||e(_))return!1;var y=t(_)?h:s;return y.test(r(_))}return dm=m,dm}var hm,fE;function Rz(){if(fE)return hm;fE=1;function t(e,n){return e==null?void 0:e[n]}return hm=t,hm}var pm,dE;function ea(){if(dE)return pm;dE=1;var t=Az(),e=Rz();function n(r,i){var s=e(r,i);return t(s)?s:void 0}return pm=n,pm}var gm,hE;function g1(){if(hE)return gm;hE=1;var t=ea(),e=Ir(),n=t(e,"Map");return gm=n,gm}var mm,pE;function Hd(){if(pE)return mm;pE=1;var t=ea(),e=t(Object,"create");return mm=e,mm}var _m,gE;function Cz(){if(gE)return _m;gE=1;var t=Hd();function e(){this.__data__=t?t(null):{},this.size=0}return _m=e,_m}var vm,mE;function Nz(){if(mE)return vm;mE=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return vm=t,vm}var ym,_E;function kz(){if(_E)return ym;_E=1;var t=Hd(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(s){var o=this.__data__;if(t){var l=o[s];return l===e?void 0:l}return r.call(o,s)?o[s]:void 0}return ym=i,ym}var xm,vE;function Mz(){if(vE)return xm;vE=1;var t=Hd(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var s=this.__data__;return t?s[i]!==void 0:n.call(s,i)}return xm=r,xm}var bm,yE;function Iz(){if(yE)return bm;yE=1;var t=Hd(),e="__lodash_hash_undefined__";function n(r,i){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=t&&i===void 0?e:i,this}return bm=n,bm}var wm,xE;function Oz(){if(xE)return wm;xE=1;var t=Cz(),e=Nz(),n=kz(),r=Mz(),i=Iz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,wm=s,wm}var Tm,bE;function Pz(){if(bE)return Tm;bE=1;var t=Oz(),e=Vd(),n=g1();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return Tm=r,Tm}var Sm,wE;function Dz(){if(wE)return Sm;wE=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return Sm=t,Sm}var Em,TE;function Wd(){if(TE)return Em;TE=1;var t=Dz();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return Em=e,Em}var Am,SE;function jz(){if(SE)return Am;SE=1;var t=Wd();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return Am=e,Am}var Rm,EE;function Lz(){if(EE)return Rm;EE=1;var t=Wd();function e(n){return t(this,n).get(n)}return Rm=e,Rm}var Cm,AE;function Bz(){if(AE)return Cm;AE=1;var t=Wd();function e(n){return t(this,n).has(n)}return Cm=e,Cm}var Nm,RE;function Uz(){if(RE)return Nm;RE=1;var t=Wd();function e(n,r){var i=t(this,n),s=i.size;return i.set(n,r),this.size+=i.size==s?0:1,this}return Nm=e,Nm}var km,CE;function m1(){if(CE)return km;CE=1;var t=Pz(),e=jz(),n=Lz(),r=Bz(),i=Uz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,km=s,km}var Mm,NE;function Fz(){if(NE)return Mm;NE=1;var t=Vd(),e=g1(),n=m1(),r=200;function i(s,o){var l=this.__data__;if(l instanceof t){var u=l.__data__;if(!e||u.length<r-1)return u.push([s,o]),this.size=++l.size,this;l=this.__data__=new n(u)}return l.set(s,o),this.size=l.size,this}return Mm=i,Mm}var Im,kE;function Xd(){if(kE)return Im;kE=1;var t=Vd(),e=vz(),n=yz(),r=xz(),i=bz(),s=Fz();function o(l){var u=this.__data__=new t(l);this.size=u.size}return o.prototype.clear=e,o.prototype.delete=n,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,Im=o,Im}var Om,ME;function _1(){if(ME)return Om;ME=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return Om=t,Om}var Pm,IE;function PI(){if(IE)return Pm;IE=1;var t=ea(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return Pm=e,Pm}var Dm,OE;function Yd(){if(OE)return Dm;OE=1;var t=PI();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return Dm=e,Dm}var jm,PE;function Gd(){if(PE)return jm;PE=1;var t=Yd(),e=Mo(),n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l){var u=s[o];(!(r.call(s,o)&&e(u,l))||l===void 0&&!(o in s))&&t(s,o,l)}return jm=i,jm}var Lm,DE;function Ic(){if(DE)return Lm;DE=1;var t=Gd(),e=Yd();function n(r,i,s,o){var l=!s;s||(s={});for(var u=-1,d=i.length;++u<d;){var h=i[u],m=o?o(s[h],r[h],h,s,r):void 0;m===void 0&&(m=r[h]),l?e(s,h,m):t(s,h,m)}return s}return Lm=n,Lm}var Bm,jE;function zz(){if(jE)return Bm;jE=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return Bm=t,Bm}var Um,LE;function Yr(){if(LE)return Um;LE=1;function t(e){return e!=null&&typeof e=="object"}return Um=t,Um}var Fm,BE;function $z(){if(BE)return Fm;BE=1;var t=Js(),e=Yr(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return Fm=r,Fm}var zm,UE;function Oc(){if(UE)return zm;UE=1;var t=$z(),e=Yr(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,s=t(function(){return arguments}())?t:function(o){return e(o)&&r.call(o,"callee")&&!i.call(o,"callee")};return zm=s,zm}var $m,FE;function Gt(){if(FE)return $m;FE=1;var t=Array.isArray;return $m=t,$m}var Wl={exports:{}},qm,zE;function qz(){if(zE)return qm;zE=1;function t(){return!1}return qm=t,qm}Wl.exports;var $E;function Oo(){return $E||($E=1,function(t,e){var n=Ir(),r=qz(),i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,o=s&&s.exports===i,l=o?n.Buffer:void 0,u=l?l.isBuffer:void 0,d=u||r;t.exports=d}(Wl,Wl.exports)),Wl.exports}var Vm,qE;function Kd(){if(qE)return Vm;qE=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var s=typeof r;return i=i??t,!!i&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return Vm=n,Vm}var Hm,VE;function v1(){if(VE)return Hm;VE=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Hm=e,Hm}var Wm,HE;function Vz(){if(HE)return Wm;HE=1;var t=Js(),e=v1(),n=Yr(),r="[object Arguments]",i="[object Array]",s="[object Boolean]",o="[object Date]",l="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",m="[object Object]",_="[object RegExp]",y="[object Set]",T="[object String]",w="[object WeakMap]",b="[object ArrayBuffer]",S="[object DataView]",A="[object Float32Array]",R="[object Float64Array]",E="[object Int8Array]",C="[object Int16Array]",O="[object Int32Array]",P="[object Uint8Array]",k="[object Uint8ClampedArray]",I="[object Uint16Array]",N="[object Uint32Array]",L={};L[A]=L[R]=L[E]=L[C]=L[O]=L[P]=L[k]=L[I]=L[N]=!0,L[r]=L[i]=L[b]=L[s]=L[S]=L[o]=L[l]=L[u]=L[d]=L[h]=L[m]=L[_]=L[y]=L[T]=L[w]=!1;function $(Z){return n(Z)&&e(Z.length)&&!!L[t(Z)]}return Wm=$,Wm}var Xm,WE;function Zd(){if(WE)return Xm;WE=1;function t(e){return function(n){return e(n)}}return Xm=t,Xm}var Xl={exports:{}};Xl.exports;var XE;function y1(){return XE||(XE=1,function(t,e){var n=II(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s&&n.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();t.exports=l}(Xl,Xl.exports)),Xl.exports}var Ym,YE;function Pc(){if(YE)return Ym;YE=1;var t=Vz(),e=Zd(),n=y1(),r=n&&n.isTypedArray,i=r?e(r):t;return Ym=i,Ym}var Gm,GE;function DI(){if(GE)return Gm;GE=1;var t=zz(),e=Oc(),n=Gt(),r=Oo(),i=Kd(),s=Pc(),o=Object.prototype,l=o.hasOwnProperty;function u(d,h){var m=n(d),_=!m&&e(d),y=!m&&!_&&r(d),T=!m&&!_&&!y&&s(d),w=m||_||y||T,b=w?t(d.length,String):[],S=b.length;for(var A in d)(h||l.call(d,A))&&!(w&&(A=="length"||y&&(A=="offset"||A=="parent")||T&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||i(A,S)))&&b.push(A);return b}return Gm=u,Gm}var Km,KE;function Qd(){if(KE)return Km;KE=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return Km=e,Km}var Zm,ZE;function jI(){if(ZE)return Zm;ZE=1;function t(e,n){return function(r){return e(n(r))}}return Zm=t,Zm}var Qm,QE;function Hz(){if(QE)return Qm;QE=1;var t=jI(),e=t(Object.keys,Object);return Qm=e,Qm}var Jm,JE;function x1(){if(JE)return Jm;JE=1;var t=Qd(),e=Hz(),n=Object.prototype,r=n.hasOwnProperty;function i(s){if(!t(s))return e(s);var o=[];for(var l in Object(s))r.call(s,l)&&l!="constructor"&&o.push(l);return o}return Jm=i,Jm}var e_,eA;function xi(){if(eA)return e_;eA=1;var t=Mc(),e=v1();function n(r){return r!=null&&e(r.length)&&!t(r)}return e_=n,e_}var t_,tA;function us(){if(tA)return t_;tA=1;var t=DI(),e=x1(),n=xi();function r(i){return n(i)?t(i):e(i)}return t_=r,t_}var n_,nA;function Wz(){if(nA)return n_;nA=1;var t=Ic(),e=us();function n(r,i){return r&&t(i,e(i),r)}return n_=n,n_}var r_,rA;function Xz(){if(rA)return r_;rA=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return r_=t,r_}var i_,iA;function Yz(){if(iA)return i_;iA=1;var t=gr(),e=Qd(),n=Xz(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!t(o))return n(o);var l=e(o),u=[];for(var d in o)d=="constructor"&&(l||!i.call(o,d))||u.push(d);return u}return i_=s,i_}var s_,sA;function ta(){if(sA)return s_;sA=1;var t=DI(),e=Yz(),n=xi();function r(i){return n(i)?t(i,!0):e(i)}return s_=r,s_}var a_,aA;function Gz(){if(aA)return a_;aA=1;var t=Ic(),e=ta();function n(r,i){return r&&t(i,e(i),r)}return a_=n,a_}var Yl={exports:{}};Yl.exports;var oA;function LI(){return oA||(oA=1,function(t,e){var n=Ir(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s?n.Buffer:void 0,l=o?o.allocUnsafe:void 0;function u(d,h){if(h)return d.slice();var m=d.length,_=l?l(m):new d.constructor(m);return d.copy(_),_}t.exports=u}(Yl,Yl.exports)),Yl.exports}var o_,lA;function BI(){if(lA)return o_;lA=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return o_=t,o_}var l_,cA;function UI(){if(cA)return l_;cA=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=0,o=[];++r<i;){var l=e[r];n(l,r,e)&&(o[s++]=l)}return o}return l_=t,l_}var c_,uA;function FI(){if(uA)return c_;uA=1;function t(){return[]}return c_=t,c_}var u_,fA;function b1(){if(fA)return u_;fA=1;var t=UI(),e=FI(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(o){return o==null?[]:(o=Object(o),t(i(o),function(l){return r.call(o,l)}))}:e;return u_=s,u_}var f_,dA;function Kz(){if(dA)return f_;dA=1;var t=Ic(),e=b1();function n(r,i){return t(r,e(r),i)}return f_=n,f_}var d_,hA;function w1(){if(hA)return d_;hA=1;function t(e,n){for(var r=-1,i=n.length,s=e.length;++r<i;)e[s+r]=n[r];return e}return d_=t,d_}var h_,pA;function Jd(){if(pA)return h_;pA=1;var t=jI(),e=t(Object.getPrototypeOf,Object);return h_=e,h_}var p_,gA;function zI(){if(gA)return p_;gA=1;var t=w1(),e=Jd(),n=b1(),r=FI(),i=Object.getOwnPropertySymbols,s=i?function(o){for(var l=[];o;)t(l,n(o)),o=e(o);return l}:r;return p_=s,p_}var g_,mA;function Zz(){if(mA)return g_;mA=1;var t=Ic(),e=zI();function n(r,i){return t(r,e(r),i)}return g_=n,g_}var m_,_A;function $I(){if(_A)return m_;_A=1;var t=w1(),e=Gt();function n(r,i,s){var o=i(r);return e(r)?o:t(o,s(r))}return m_=n,m_}var __,vA;function qI(){if(vA)return __;vA=1;var t=$I(),e=b1(),n=us();function r(i){return t(i,n,e)}return __=r,__}var v_,yA;function Qz(){if(yA)return v_;yA=1;var t=$I(),e=zI(),n=ta();function r(i){return t(i,n,e)}return v_=r,v_}var y_,xA;function Jz(){if(xA)return y_;xA=1;var t=ea(),e=Ir(),n=t(e,"DataView");return y_=n,y_}var x_,bA;function e9(){if(bA)return x_;bA=1;var t=ea(),e=Ir(),n=t(e,"Promise");return x_=n,x_}var b_,wA;function VI(){if(wA)return b_;wA=1;var t=ea(),e=Ir(),n=t(e,"Set");return b_=n,b_}var w_,TA;function t9(){if(TA)return w_;TA=1;var t=ea(),e=Ir(),n=t(e,"WeakMap");return w_=n,w_}var T_,SA;function Po(){if(SA)return T_;SA=1;var t=Jz(),e=g1(),n=e9(),r=VI(),i=t9(),s=Js(),o=OI(),l="[object Map]",u="[object Object]",d="[object Promise]",h="[object Set]",m="[object WeakMap]",_="[object DataView]",y=o(t),T=o(e),w=o(n),b=o(r),S=o(i),A=s;return(t&&A(new t(new ArrayBuffer(1)))!=_||e&&A(new e)!=l||n&&A(n.resolve())!=d||r&&A(new r)!=h||i&&A(new i)!=m)&&(A=function(R){var E=s(R),C=E==u?R.constructor:void 0,O=C?o(C):"";if(O)switch(O){case y:return _;case T:return l;case w:return d;case b:return h;case S:return m}return E}),T_=A,T_}var S_,EA;function n9(){if(EA)return S_;EA=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}return S_=n,S_}var E_,AA;function HI(){if(AA)return E_;AA=1;var t=Ir(),e=t.Uint8Array;return E_=e,E_}var A_,RA;function T1(){if(RA)return A_;RA=1;var t=HI();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return A_=e,A_}var R_,CA;function r9(){if(CA)return R_;CA=1;var t=T1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return R_=e,R_}var C_,NA;function i9(){if(NA)return C_;NA=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return C_=e,C_}var N_,kA;function s9(){if(kA)return N_;kA=1;var t=Io(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return N_=r,N_}var k_,MA;function WI(){if(MA)return k_;MA=1;var t=T1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return k_=e,k_}var M_,IA;function a9(){if(IA)return M_;IA=1;var t=T1(),e=r9(),n=i9(),r=s9(),i=WI(),s="[object Boolean]",o="[object Date]",l="[object Map]",u="[object Number]",d="[object RegExp]",h="[object Set]",m="[object String]",_="[object Symbol]",y="[object ArrayBuffer]",T="[object DataView]",w="[object Float32Array]",b="[object Float64Array]",S="[object Int8Array]",A="[object Int16Array]",R="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",O="[object Uint16Array]",P="[object Uint32Array]";function k(I,N,L){var $=I.constructor;switch(N){case y:return t(I);case s:case o:return new $(+I);case T:return e(I,L);case w:case b:case S:case A:case R:case E:case C:case O:case P:return i(I,L);case l:return new $;case u:case m:return new $(I);case d:return n(I);case h:return new $;case _:return r(I)}}return M_=k,M_}var I_,OA;function XI(){if(OA)return I_;OA=1;var t=gr(),e=Object.create,n=function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var s=new r;return r.prototype=void 0,s}}();return I_=n,I_}var O_,PA;function YI(){if(PA)return O_;PA=1;var t=XI(),e=Jd(),n=Qd();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return O_=r,O_}var P_,DA;function o9(){if(DA)return P_;DA=1;var t=Po(),e=Yr(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return P_=r,P_}var D_,jA;function l9(){if(jA)return D_;jA=1;var t=o9(),e=Zd(),n=y1(),r=n&&n.isMap,i=r?e(r):t;return D_=i,D_}var j_,LA;function c9(){if(LA)return j_;LA=1;var t=Po(),e=Yr(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return j_=r,j_}var L_,BA;function u9(){if(BA)return L_;BA=1;var t=c9(),e=Zd(),n=y1(),r=n&&n.isSet,i=r?e(r):t;return L_=i,L_}var B_,UA;function GI(){if(UA)return B_;UA=1;var t=Xd(),e=_1(),n=Gd(),r=Wz(),i=Gz(),s=LI(),o=BI(),l=Kz(),u=Zz(),d=qI(),h=Qz(),m=Po(),_=n9(),y=a9(),T=YI(),w=Gt(),b=Oo(),S=l9(),A=gr(),R=u9(),E=us(),C=ta(),O=1,P=2,k=4,I="[object Arguments]",N="[object Array]",L="[object Boolean]",$="[object Date]",Z="[object Error]",V="[object Function]",q="[object GeneratorFunction]",z="[object Map]",Q="[object Number]",oe="[object Object]",G="[object RegExp]",D="[object Set]",Y="[object String]",le="[object Symbol]",ie="[object WeakMap]",F="[object ArrayBuffer]",X="[object DataView]",J="[object Float32Array]",pe="[object Float64Array]",ye="[object Int8Array]",Ae="[object Int16Array]",Oe="[object Int32Array]",Ue="[object Uint8Array]",Ee="[object Uint8ClampedArray]",Te="[object Uint16Array]",Ne="[object Uint32Array]",Pe={};Pe[I]=Pe[N]=Pe[F]=Pe[X]=Pe[L]=Pe[$]=Pe[J]=Pe[pe]=Pe[ye]=Pe[Ae]=Pe[Oe]=Pe[z]=Pe[Q]=Pe[oe]=Pe[G]=Pe[D]=Pe[Y]=Pe[le]=Pe[Ue]=Pe[Ee]=Pe[Te]=Pe[Ne]=!0,Pe[Z]=Pe[V]=Pe[ie]=!1;function Kt(Me,nn,Mt,Rt,Ke,rn){var Ye,be=nn&O,ke=nn&P,rt=nn&k;if(Mt&&(Ye=Ke?Mt(Me,Rt,Ke,rn):Mt(Me)),Ye!==void 0)return Ye;if(!A(Me))return Me;var He=w(Me);if(He){if(Ye=_(Me),!be)return o(Me,Ye)}else{var Qe=m(Me),xt=Qe==V||Qe==q;if(b(Me))return s(Me,be);if(Qe==oe||Qe==I||xt&&!Ke){if(Ye=ke||xt?{}:T(Me),!be)return ke?u(Me,i(Ye,Me)):l(Me,r(Ye,Me))}else{if(!Pe[Qe])return Ke?Me:{};Ye=y(Me,Qe,be)}}rn||(rn=new t);var gn=rn.get(Me);if(gn)return gn;rn.set(Me,Ye),R(Me)?Me.forEach(function(Ft){Ye.add(Kt(Ft,nn,Mt,Ft,Me,rn))}):S(Me)&&Me.forEach(function(Ft,zt){Ye.set(zt,Kt(Ft,nn,Mt,zt,Me,rn))});var Kr=rt?ke?h:d:ke?C:E,vr=He?void 0:Kr(Me);return e(vr||Me,function(Ft,zt){vr&&(zt=Ft,Ft=Me[zt]),n(Ye,zt,Kt(Ft,nn,Mt,zt,Me,rn))}),Ye}return B_=Kt,B_}var U_,FA;function f9(){if(FA)return U_;FA=1;var t=GI(),e=4;function n(r){return t(r,e)}return U_=n,U_}var F_,zA;function S1(){if(zA)return F_;zA=1;function t(e){return function(){return e}}return F_=t,F_}var z_,$A;function d9(){if($A)return z_;$A=1;function t(e){return function(n,r,i){for(var s=-1,o=Object(n),l=i(n),u=l.length;u--;){var d=l[e?u:++s];if(r(o[d],d,o)===!1)break}return n}}return z_=t,z_}var $_,qA;function E1(){if(qA)return $_;qA=1;var t=d9(),e=t();return $_=e,$_}var q_,VA;function A1(){if(VA)return q_;VA=1;var t=E1(),e=us();function n(r,i){return r&&t(r,i,e)}return q_=n,q_}var V_,HA;function h9(){if(HA)return V_;HA=1;var t=xi();function e(n,r){return function(i,s){if(i==null)return i;if(!t(i))return n(i,s);for(var o=i.length,l=r?o:-1,u=Object(i);(r?l--:++l<o)&&s(u[l],l,u)!==!1;);return i}}return V_=e,V_}var H_,WA;function eh(){if(WA)return H_;WA=1;var t=A1(),e=h9(),n=e(t);return H_=n,H_}var W_,XA;function na(){if(XA)return W_;XA=1;function t(e){return e}return W_=t,W_}var X_,YA;function KI(){if(YA)return X_;YA=1;var t=na();function e(n){return typeof n=="function"?n:t}return X_=e,X_}var Y_,GA;function ZI(){if(GA)return Y_;GA=1;var t=_1(),e=eh(),n=KI(),r=Gt();function i(s,o){var l=r(s)?t:e;return l(s,n(o))}return Y_=i,Y_}var G_,KA;function QI(){return KA||(KA=1,G_=ZI()),G_}var K_,ZA;function p9(){if(ZA)return K_;ZA=1;var t=eh();function e(n,r){var i=[];return t(n,function(s,o,l){r(s,o,l)&&i.push(s)}),i}return K_=e,K_}var Z_,QA;function g9(){if(QA)return Z_;QA=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return Z_=e,Z_}var Q_,JA;function m9(){if(JA)return Q_;JA=1;function t(e){return this.__data__.has(e)}return Q_=t,Q_}var J_,eR;function JI(){if(eR)return J_;eR=1;var t=m1(),e=g9(),n=m9();function r(i){var s=-1,o=i==null?0:i.length;for(this.__data__=new t;++s<o;)this.add(i[s])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,J_=r,J_}var ev,tR;function _9(){if(tR)return ev;tR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return ev=t,ev}var tv,nR;function eO(){if(nR)return tv;nR=1;function t(e,n){return e.has(n)}return tv=t,tv}var nv,rR;function tO(){if(rR)return nv;rR=1;var t=JI(),e=_9(),n=eO(),r=1,i=2;function s(o,l,u,d,h,m){var _=u&r,y=o.length,T=l.length;if(y!=T&&!(_&&T>y))return!1;var w=m.get(o),b=m.get(l);if(w&&b)return w==l&&b==o;var S=-1,A=!0,R=u&i?new t:void 0;for(m.set(o,l),m.set(l,o);++S<y;){var E=o[S],C=l[S];if(d)var O=_?d(C,E,S,l,o,m):d(E,C,S,o,l,m);if(O!==void 0){if(O)continue;A=!1;break}if(R){if(!e(l,function(P,k){if(!n(R,k)&&(E===P||h(E,P,u,d,m)))return R.push(k)})){A=!1;break}}else if(!(E===C||h(E,C,u,d,m))){A=!1;break}}return m.delete(o),m.delete(l),A}return nv=s,nv}var rv,iR;function v9(){if(iR)return rv;iR=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,s){r[++n]=[s,i]}),r}return rv=t,rv}var iv,sR;function R1(){if(sR)return iv;sR=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return iv=t,iv}var sv,aR;function y9(){if(aR)return sv;aR=1;var t=Io(),e=HI(),n=Mo(),r=tO(),i=v9(),s=R1(),o=1,l=2,u="[object Boolean]",d="[object Date]",h="[object Error]",m="[object Map]",_="[object Number]",y="[object RegExp]",T="[object Set]",w="[object String]",b="[object Symbol]",S="[object ArrayBuffer]",A="[object DataView]",R=t?t.prototype:void 0,E=R?R.valueOf:void 0;function C(O,P,k,I,N,L,$){switch(k){case A:if(O.byteLength!=P.byteLength||O.byteOffset!=P.byteOffset)return!1;O=O.buffer,P=P.buffer;case S:return!(O.byteLength!=P.byteLength||!L(new e(O),new e(P)));case u:case d:case _:return n(+O,+P);case h:return O.name==P.name&&O.message==P.message;case y:case w:return O==P+"";case m:var Z=i;case T:var V=I&o;if(Z||(Z=s),O.size!=P.size&&!V)return!1;var q=$.get(O);if(q)return q==P;I|=l,$.set(O,P);var z=r(Z(O),Z(P),I,N,L,$);return $.delete(O),z;case b:if(E)return E.call(O)==E.call(P)}return!1}return sv=C,sv}var av,oR;function x9(){if(oR)return av;oR=1;var t=qI(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l,u,d,h){var m=l&e,_=t(s),y=_.length,T=t(o),w=T.length;if(y!=w&&!m)return!1;for(var b=y;b--;){var S=_[b];if(!(m?S in o:r.call(o,S)))return!1}var A=h.get(s),R=h.get(o);if(A&&R)return A==o&&R==s;var E=!0;h.set(s,o),h.set(o,s);for(var C=m;++b<y;){S=_[b];var O=s[S],P=o[S];if(u)var k=m?u(P,O,S,o,s,h):u(O,P,S,s,o,h);if(!(k===void 0?O===P||d(O,P,l,u,h):k)){E=!1;break}C||(C=S=="constructor")}if(E&&!C){var I=s.constructor,N=o.constructor;I!=N&&"constructor"in s&&"constructor"in o&&!(typeof I=="function"&&I instanceof I&&typeof N=="function"&&N instanceof N)&&(E=!1)}return h.delete(s),h.delete(o),E}return av=i,av}var ov,lR;function b9(){if(lR)return ov;lR=1;var t=Xd(),e=tO(),n=y9(),r=x9(),i=Po(),s=Gt(),o=Oo(),l=Pc(),u=1,d="[object Arguments]",h="[object Array]",m="[object Object]",_=Object.prototype,y=_.hasOwnProperty;function T(w,b,S,A,R,E){var C=s(w),O=s(b),P=C?h:i(w),k=O?h:i(b);P=P==d?m:P,k=k==d?m:k;var I=P==m,N=k==m,L=P==k;if(L&&o(w)){if(!o(b))return!1;C=!0,I=!1}if(L&&!I)return E||(E=new t),C||l(w)?e(w,b,S,A,R,E):n(w,b,P,S,A,R,E);if(!(S&u)){var $=I&&y.call(w,"__wrapped__"),Z=N&&y.call(b,"__wrapped__");if($||Z){var V=$?w.value():w,q=Z?b.value():b;return E||(E=new t),R(V,q,S,A,E)}}return L?(E||(E=new t),r(w,b,S,A,R,E)):!1}return ov=T,ov}var lv,cR;function nO(){if(cR)return lv;cR=1;var t=b9(),e=Yr();function n(r,i,s,o,l){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,s,o,n,l)}return lv=n,lv}var cv,uR;function w9(){if(uR)return cv;uR=1;var t=Xd(),e=nO(),n=1,r=2;function i(s,o,l,u){var d=l.length,h=d,m=!u;if(s==null)return!h;for(s=Object(s);d--;){var _=l[d];if(m&&_[2]?_[1]!==s[_[0]]:!(_[0]in s))return!1}for(;++d<h;){_=l[d];var y=_[0],T=s[y],w=_[1];if(m&&_[2]){if(T===void 0&&!(y in s))return!1}else{var b=new t;if(u)var S=u(T,w,y,s,o,b);if(!(S===void 0?e(w,T,n|r,u,b):S))return!1}}return!0}return cv=i,cv}var uv,fR;function rO(){if(fR)return uv;fR=1;var t=gr();function e(n){return n===n&&!t(n)}return uv=e,uv}var fv,dR;function T9(){if(dR)return fv;dR=1;var t=rO(),e=us();function n(r){for(var i=e(r),s=i.length;s--;){var o=i[s],l=r[o];i[s]=[o,l,t(l)]}return i}return fv=n,fv}var dv,hR;function iO(){if(hR)return dv;hR=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return dv=t,dv}var hv,pR;function S9(){if(pR)return hv;pR=1;var t=w9(),e=T9(),n=iO();function r(i){var s=e(i);return s.length==1&&s[0][2]?n(s[0][0],s[0][1]):function(o){return o===i||t(o,i,s)}}return hv=r,hv}var pv,gR;function Do(){if(gR)return pv;gR=1;var t=Js(),e=Yr(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return pv=r,pv}var gv,mR;function C1(){if(mR)return gv;mR=1;var t=Gt(),e=Do(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){if(t(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||e(s)?!0:r.test(s)||!n.test(s)||o!=null&&s in Object(o)}return gv=i,gv}var mv,_R;function E9(){if(_R)return mv;_R=1;var t=m1(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var s=function(){var o=arguments,l=i?i.apply(this,o):o[0],u=s.cache;if(u.has(l))return u.get(l);var d=r.apply(this,o);return s.cache=u.set(l,d)||u,d};return s.cache=new(n.Cache||t),s}return n.Cache=t,mv=n,mv}var _v,vR;function A9(){if(vR)return _v;vR=1;var t=E9(),e=500;function n(r){var i=t(r,function(o){return s.size===e&&s.clear(),o}),s=i.cache;return i}return _v=n,_v}var vv,yR;function R9(){if(yR)return vv;yR=1;var t=A9(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(e,function(o,l,u,d){s.push(u?d.replace(n,"$1"):l||o)}),s});return vv=r,vv}var yv,xR;function th(){if(xR)return yv;xR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=Array(i);++r<i;)s[r]=n(e[r],r,e);return s}return yv=t,yv}var xv,bR;function C9(){if(bR)return xv;bR=1;var t=Io(),e=th(),n=Gt(),r=Do(),i=t?t.prototype:void 0,s=i?i.toString:void 0;function o(l){if(typeof l=="string")return l;if(n(l))return e(l,o)+"";if(r(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}return xv=o,xv}var bv,wR;function sO(){if(wR)return bv;wR=1;var t=C9();function e(n){return n==null?"":t(n)}return bv=e,bv}var wv,TR;function nh(){if(TR)return wv;TR=1;var t=Gt(),e=C1(),n=R9(),r=sO();function i(s,o){return t(s)?s:e(s,o)?[s]:n(r(s))}return wv=i,wv}var Tv,SR;function Dc(){if(SR)return Tv;SR=1;var t=Do();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return Tv=e,Tv}var Sv,ER;function rh(){if(ER)return Sv;ER=1;var t=nh(),e=Dc();function n(r,i){i=t(i,r);for(var s=0,o=i.length;r!=null&&s<o;)r=r[e(i[s++])];return s&&s==o?r:void 0}return Sv=n,Sv}var Ev,AR;function N9(){if(AR)return Ev;AR=1;var t=rh();function e(n,r,i){var s=n==null?void 0:t(n,r);return s===void 0?i:s}return Ev=e,Ev}var Av,RR;function k9(){if(RR)return Av;RR=1;function t(e,n){return e!=null&&n in Object(e)}return Av=t,Av}var Rv,CR;function aO(){if(CR)return Rv;CR=1;var t=nh(),e=Oc(),n=Gt(),r=Kd(),i=v1(),s=Dc();function o(l,u,d){u=t(u,l);for(var h=-1,m=u.length,_=!1;++h<m;){var y=s(u[h]);if(!(_=l!=null&&d(l,y)))break;l=l[y]}return _||++h!=m?_:(m=l==null?0:l.length,!!m&&i(m)&&r(y,m)&&(n(l)||e(l)))}return Rv=o,Rv}var Cv,NR;function oO(){if(NR)return Cv;NR=1;var t=k9(),e=aO();function n(r,i){return r!=null&&e(r,i,t)}return Cv=n,Cv}var Nv,kR;function M9(){if(kR)return Nv;kR=1;var t=nO(),e=N9(),n=oO(),r=C1(),i=rO(),s=iO(),o=Dc(),l=1,u=2;function d(h,m){return r(h)&&i(m)?s(o(h),m):function(_){var y=e(_,h);return y===void 0&&y===m?n(_,h):t(m,y,l|u)}}return Nv=d,Nv}var kv,MR;function lO(){if(MR)return kv;MR=1;function t(e){return function(n){return n==null?void 0:n[e]}}return kv=t,kv}var Mv,IR;function I9(){if(IR)return Mv;IR=1;var t=rh();function e(n){return function(r){return t(r,n)}}return Mv=e,Mv}var Iv,OR;function O9(){if(OR)return Iv;OR=1;var t=lO(),e=I9(),n=C1(),r=Dc();function i(s){return n(s)?t(r(s)):e(s)}return Iv=i,Iv}var Ov,PR;function bi(){if(PR)return Ov;PR=1;var t=S9(),e=M9(),n=na(),r=Gt(),i=O9();function s(o){return typeof o=="function"?o:o==null?n:typeof o=="object"?r(o)?e(o[0],o[1]):t(o):i(o)}return Ov=s,Ov}var Pv,DR;function cO(){if(DR)return Pv;DR=1;var t=UI(),e=p9(),n=bi(),r=Gt();function i(s,o){var l=r(s)?t:e;return l(s,n(o,3))}return Pv=i,Pv}var Dv,jR;function P9(){if(jR)return Dv;jR=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,i){return r!=null&&e.call(r,i)}return Dv=n,Dv}var jv,LR;function uO(){if(LR)return jv;LR=1;var t=P9(),e=aO();function n(r,i){return r!=null&&e(r,i,t)}return jv=n,jv}var Lv,BR;function D9(){if(BR)return Lv;BR=1;var t=x1(),e=Po(),n=Oc(),r=Gt(),i=xi(),s=Oo(),o=Qd(),l=Pc(),u="[object Map]",d="[object Set]",h=Object.prototype,m=h.hasOwnProperty;function _(y){if(y==null)return!0;if(i(y)&&(r(y)||typeof y=="string"||typeof y.splice=="function"||s(y)||l(y)||n(y)))return!y.length;var T=e(y);if(T==u||T==d)return!y.size;if(o(y))return!t(y).length;for(var w in y)if(m.call(y,w))return!1;return!0}return Lv=_,Lv}var Bv,UR;function fO(){if(UR)return Bv;UR=1;function t(e){return e===void 0}return Bv=t,Bv}var Uv,FR;function dO(){if(FR)return Uv;FR=1;var t=eh(),e=xi();function n(r,i){var s=-1,o=e(r)?Array(r.length):[];return t(r,function(l,u,d){o[++s]=i(l,u,d)}),o}return Uv=n,Uv}var Fv,zR;function hO(){if(zR)return Fv;zR=1;var t=th(),e=bi(),n=dO(),r=Gt();function i(s,o){var l=r(s)?t:n;return l(s,e(o,3))}return Fv=i,Fv}var zv,$R;function j9(){if($R)return zv;$R=1;function t(e,n,r,i){var s=-1,o=e==null?0:e.length;for(i&&o&&(r=e[++s]);++s<o;)r=n(r,e[s],s,e);return r}return zv=t,zv}var $v,qR;function L9(){if(qR)return $v;qR=1;function t(e,n,r,i,s){return s(e,function(o,l,u){r=i?(i=!1,o):n(r,o,l,u)}),r}return $v=t,$v}var qv,VR;function pO(){if(VR)return qv;VR=1;var t=j9(),e=eh(),n=bi(),r=L9(),i=Gt();function s(o,l,u){var d=i(o)?t:r,h=arguments.length<3;return d(o,n(l,4),u,h,e)}return qv=s,qv}var Vv,HR;function B9(){if(HR)return Vv;HR=1;var t=Js(),e=Gt(),n=Yr(),r="[object String]";function i(s){return typeof s=="string"||!e(s)&&n(s)&&t(s)==r}return Vv=i,Vv}var Hv,WR;function U9(){if(WR)return Hv;WR=1;var t=lO(),e=t("length");return Hv=e,Hv}var Wv,XR;function F9(){if(XR)return Wv;XR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="\\u200d",l=RegExp("["+o+t+i+s+"]");function u(d){return l.test(d)}return Wv=u,Wv}var Xv,YR;function z9(){if(YR)return Xv;YR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="["+t+"]",l="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+u+")",h="[^"+t+"]",m="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",y="\\u200d",T=d+"?",w="["+s+"]?",b="(?:"+y+"(?:"+[h,m,_].join("|")+")"+w+T+")*",S=w+T+b,A="(?:"+[h+l+"?",l,m,_,o].join("|")+")",R=RegExp(u+"(?="+u+")|"+A+S,"g");function E(C){for(var O=R.lastIndex=0;R.test(C);)++O;return O}return Xv=E,Xv}var Yv,GR;function $9(){if(GR)return Yv;GR=1;var t=U9(),e=F9(),n=z9();function r(i){return e(i)?n(i):t(i)}return Yv=r,Yv}var Gv,KR;function q9(){if(KR)return Gv;KR=1;var t=x1(),e=Po(),n=xi(),r=B9(),i=$9(),s="[object Map]",o="[object Set]";function l(u){if(u==null)return 0;if(n(u))return r(u)?i(u):u.length;var d=e(u);return d==s||d==o?u.size:t(u).length}return Gv=l,Gv}var Kv,ZR;function V9(){if(ZR)return Kv;ZR=1;var t=_1(),e=XI(),n=A1(),r=bi(),i=Jd(),s=Gt(),o=Oo(),l=Mc(),u=gr(),d=Pc();function h(m,_,y){var T=s(m),w=T||o(m)||d(m);if(_=r(_,4),y==null){var b=m&&m.constructor;w?y=T?new b:[]:u(m)?y=l(b)?e(i(m)):{}:y={}}return(w?t:n)(m,function(S,A,R){return _(y,S,A,R)}),y}return Kv=h,Kv}var Zv,QR;function H9(){if(QR)return Zv;QR=1;var t=Io(),e=Oc(),n=Gt(),r=t?t.isConcatSpreadable:void 0;function i(s){return n(s)||e(s)||!!(r&&s&&s[r])}return Zv=i,Zv}var Qv,JR;function N1(){if(JR)return Qv;JR=1;var t=w1(),e=H9();function n(r,i,s,o,l){var u=-1,d=r.length;for(s||(s=e),l||(l=[]);++u<d;){var h=r[u];i>0&&s(h)?i>1?n(h,i-1,s,o,l):t(l,h):o||(l[l.length]=h)}return l}return Qv=n,Qv}var Jv,eC;function W9(){if(eC)return Jv;eC=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return Jv=t,Jv}var ey,tC;function gO(){if(tC)return ey;tC=1;var t=W9(),e=Math.max;function n(r,i,s){return i=e(i===void 0?r.length-1:i,0),function(){for(var o=arguments,l=-1,u=e(o.length-i,0),d=Array(u);++l<u;)d[l]=o[i+l];l=-1;for(var h=Array(i+1);++l<i;)h[l]=o[l];return h[i]=s(d),t(r,this,h)}}return ey=n,ey}var ty,nC;function X9(){if(nC)return ty;nC=1;var t=S1(),e=PI(),n=na(),r=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(s),writable:!0})}:n;return ty=r,ty}var ny,rC;function Y9(){if(rC)return ny;rC=1;var t=800,e=16,n=Date.now;function r(i){var s=0,o=0;return function(){var l=n(),u=e-(l-o);if(o=l,u>0){if(++s>=t)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return ny=r,ny}var ry,iC;function mO(){if(iC)return ry;iC=1;var t=X9(),e=Y9(),n=e(t);return ry=n,ry}var iy,sC;function ih(){if(sC)return iy;sC=1;var t=na(),e=gO(),n=mO();function r(i,s){return n(e(i,s,t),i+"")}return iy=r,iy}var sy,aC;function _O(){if(aC)return sy;aC=1;function t(e,n,r,i){for(var s=e.length,o=r+(i?1:-1);i?o--:++o<s;)if(n(e[o],o,e))return o;return-1}return sy=t,sy}var ay,oC;function G9(){if(oC)return ay;oC=1;function t(e){return e!==e}return ay=t,ay}var oy,lC;function K9(){if(lC)return oy;lC=1;function t(e,n,r){for(var i=r-1,s=e.length;++i<s;)if(e[i]===n)return i;return-1}return oy=t,oy}var ly,cC;function Z9(){if(cC)return ly;cC=1;var t=_O(),e=G9(),n=K9();function r(i,s,o){return s===s?n(i,s,o):t(i,e,o)}return ly=r,ly}var cy,uC;function Q9(){if(uC)return cy;uC=1;var t=Z9();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return cy=e,cy}var uy,fC;function J9(){if(fC)return uy;fC=1;function t(e,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(n,e[i]))return!0;return!1}return uy=t,uy}var fy,dC;function e7(){if(dC)return fy;dC=1;function t(){}return fy=t,fy}var dy,hC;function t7(){if(hC)return dy;hC=1;var t=VI(),e=e7(),n=R1(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(s){return new t(s)}:e;return dy=i,dy}var hy,pC;function n7(){if(pC)return hy;pC=1;var t=JI(),e=Q9(),n=J9(),r=eO(),i=t7(),s=R1(),o=200;function l(u,d,h){var m=-1,_=e,y=u.length,T=!0,w=[],b=w;if(h)T=!1,_=n;else if(y>=o){var S=d?null:i(u);if(S)return s(S);T=!1,_=r,b=new t}else b=d?[]:w;e:for(;++m<y;){var A=u[m],R=d?d(A):A;if(A=h||A!==0?A:0,T&&R===R){for(var E=b.length;E--;)if(b[E]===R)continue e;d&&b.push(R),w.push(A)}else _(b,R,h)||(b!==w&&b.push(R),w.push(A))}return w}return hy=l,hy}var py,gC;function vO(){if(gC)return py;gC=1;var t=xi(),e=Yr();function n(r){return e(r)&&t(r)}return py=n,py}var gy,mC;function r7(){if(mC)return gy;mC=1;var t=N1(),e=ih(),n=n7(),r=vO(),i=e(function(s){return n(t(s,1,r,!0))});return gy=i,gy}var my,_C;function i7(){if(_C)return my;_C=1;var t=th();function e(n,r){return t(r,function(i){return n[i]})}return my=e,my}var _y,vC;function yO(){if(vC)return _y;vC=1;var t=i7(),e=us();function n(r){return r==null?[]:t(r,e(r))}return _y=n,_y}var vy,yC;function mr(){if(yC)return vy;yC=1;var t;if(typeof p1=="function")try{t={clone:f9(),constant:S1(),each:QI(),filter:cO(),has:uO(),isArray:Gt(),isEmpty:D9(),isFunction:Mc(),isUndefined:fO(),keys:us(),map:hO(),reduce:pO(),size:q9(),transform:V9(),union:r7(),values:yO()}}catch{}return t||(t=window._),vy=t,vy}var yy,xC;function k1(){if(xC)return yy;xC=1;var t=mr();yy=i;var e="\0",n="\0",r="";function i(h){this._isDirected=t.has(h,"directed")?h.directed:!0,this._isMultigraph=t.has(h,"multigraph")?h.multigraph:!1,this._isCompound=t.has(h,"compound")?h.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(h){return this._label=h,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultNodeLabelFn=h,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var h=this;return t.filter(this.nodes(),function(m){return t.isEmpty(h._in[m])})},i.prototype.sinks=function(){var h=this;return t.filter(this.nodes(),function(m){return t.isEmpty(h._out[m])})},i.prototype.setNodes=function(h,m){var _=arguments,y=this;return t.each(h,function(T){_.length>1?y.setNode(T,m):y.setNode(T)}),this},i.prototype.setNode=function(h,m){return t.has(this._nodes,h)?(arguments.length>1&&(this._nodes[h]=m),this):(this._nodes[h]=arguments.length>1?m:this._defaultNodeLabelFn(h),this._isCompound&&(this._parent[h]=n,this._children[h]={},this._children[n][h]=!0),this._in[h]={},this._preds[h]={},this._out[h]={},this._sucs[h]={},++this._nodeCount,this)},i.prototype.node=function(h){return this._nodes[h]},i.prototype.hasNode=function(h){return t.has(this._nodes,h)},i.prototype.removeNode=function(h){var m=this;if(t.has(this._nodes,h)){var _=function(y){m.removeEdge(m._edgeObjs[y])};delete this._nodes[h],this._isCompound&&(this._removeFromParentsChildList(h),delete this._parent[h],t.each(this.children(h),function(y){m.setParent(y)}),delete this._children[h]),t.each(t.keys(this._in[h]),_),delete this._in[h],delete this._preds[h],t.each(t.keys(this._out[h]),_),delete this._out[h],delete this._sucs[h],--this._nodeCount}return this},i.prototype.setParent=function(h,m){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(m))m=n;else{m+="";for(var _=m;!t.isUndefined(_);_=this.parent(_))if(_===h)throw new Error("Setting "+m+" as parent of "+h+" would create a cycle");this.setNode(m)}return this.setNode(h),this._removeFromParentsChildList(h),this._parent[h]=m,this._children[m][h]=!0,this},i.prototype._removeFromParentsChildList=function(h){delete this._children[this._parent[h]][h]},i.prototype.parent=function(h){if(this._isCompound){var m=this._parent[h];if(m!==n)return m}},i.prototype.children=function(h){if(t.isUndefined(h)&&(h=n),this._isCompound){var m=this._children[h];if(m)return t.keys(m)}else{if(h===n)return this.nodes();if(this.hasNode(h))return[]}},i.prototype.predecessors=function(h){var m=this._preds[h];if(m)return t.keys(m)},i.prototype.successors=function(h){var m=this._sucs[h];if(m)return t.keys(m)},i.prototype.neighbors=function(h){var m=this.predecessors(h);if(m)return t.union(m,this.successors(h))},i.prototype.isLeaf=function(h){var m;return this.isDirected()?m=this.successors(h):m=this.neighbors(h),m.length===0},i.prototype.filterNodes=function(h){var m=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});m.setGraph(this.graph());var _=this;t.each(this._nodes,function(w,b){h(b)&&m.setNode(b,w)}),t.each(this._edgeObjs,function(w){m.hasNode(w.v)&&m.hasNode(w.w)&&m.setEdge(w,_.edge(w))});var y={};function T(w){var b=_.parent(w);return b===void 0||m.hasNode(b)?(y[w]=b,b):b in y?y[b]:T(b)}return this._isCompound&&t.each(m.nodes(),function(w){m.setParent(w,T(w))}),m},i.prototype.setDefaultEdgeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultEdgeLabelFn=h,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(h,m){var _=this,y=arguments;return t.reduce(h,function(T,w){return y.length>1?_.setEdge(T,w,m):_.setEdge(T,w),w}),this},i.prototype.setEdge=function(){var h,m,_,y,T=!1,w=arguments[0];typeof w=="object"&&w!==null&&"v"in w?(h=w.v,m=w.w,_=w.name,arguments.length===2&&(y=arguments[1],T=!0)):(h=w,m=arguments[1],_=arguments[3],arguments.length>2&&(y=arguments[2],T=!0)),h=""+h,m=""+m,t.isUndefined(_)||(_=""+_);var b=l(this._isDirected,h,m,_);if(t.has(this._edgeLabels,b))return T&&(this._edgeLabels[b]=y),this;if(!t.isUndefined(_)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(h),this.setNode(m),this._edgeLabels[b]=T?y:this._defaultEdgeLabelFn(h,m,_);var S=u(this._isDirected,h,m,_);return h=S.v,m=S.w,Object.freeze(S),this._edgeObjs[b]=S,s(this._preds[m],h),s(this._sucs[h],m),this._in[m][b]=S,this._out[h][b]=S,this._edgeCount++,this},i.prototype.edge=function(h,m,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,m,_);return this._edgeLabels[y]},i.prototype.hasEdge=function(h,m,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,m,_);return t.has(this._edgeLabels,y)},i.prototype.removeEdge=function(h,m,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,m,_),T=this._edgeObjs[y];return T&&(h=T.v,m=T.w,delete this._edgeLabels[y],delete this._edgeObjs[y],o(this._preds[m],h),o(this._sucs[h],m),delete this._in[m][y],delete this._out[h][y],this._edgeCount--),this},i.prototype.inEdges=function(h,m){var _=this._in[h];if(_){var y=t.values(_);return m?t.filter(y,function(T){return T.v===m}):y}},i.prototype.outEdges=function(h,m){var _=this._out[h];if(_){var y=t.values(_);return m?t.filter(y,function(T){return T.w===m}):y}},i.prototype.nodeEdges=function(h,m){var _=this.inEdges(h,m);if(_)return _.concat(this.outEdges(h,m))};function s(h,m){h[m]?h[m]++:h[m]=1}function o(h,m){--h[m]||delete h[m]}function l(h,m,_,y){var T=""+m,w=""+_;if(!h&&T>w){var b=T;T=w,w=b}return T+r+w+r+(t.isUndefined(y)?e:y)}function u(h,m,_,y){var T=""+m,w=""+_;if(!h&&T>w){var b=T;T=w,w=b}var S={v:T,w};return y&&(S.name=y),S}function d(h,m){return l(h,m.v,m.w,m.name)}return yy}var xy,bC;function s7(){return bC||(bC=1,xy="2.1.8"),xy}var by,wC;function a7(){return wC||(wC=1,by={Graph:k1(),version:s7()}),by}var wy,TC;function o7(){if(TC)return wy;TC=1;var t=mr(),e=k1();wy={write:n,read:s};function n(o){var l={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:i(o)};return t.isUndefined(o.graph())||(l.value=t.clone(o.graph())),l}function r(o){return t.map(o.nodes(),function(l){var u=o.node(l),d=o.parent(l),h={v:l};return t.isUndefined(u)||(h.value=u),t.isUndefined(d)||(h.parent=d),h})}function i(o){return t.map(o.edges(),function(l){var u=o.edge(l),d={v:l.v,w:l.w};return t.isUndefined(l.name)||(d.name=l.name),t.isUndefined(u)||(d.value=u),d})}function s(o){var l=new e(o.options).setGraph(o.value);return t.each(o.nodes,function(u){l.setNode(u.v,u.value),u.parent&&l.setParent(u.v,u.parent)}),t.each(o.edges,function(u){l.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),l}return wy}var Ty,SC;function l7(){if(SC)return Ty;SC=1;var t=mr();Ty=e;function e(n){var r={},i=[],s;function o(l){t.has(r,l)||(r[l]=!0,s.push(l),t.each(n.successors(l),o),t.each(n.predecessors(l),o))}return t.each(n.nodes(),function(l){s=[],o(l),s.length&&i.push(s)}),i}return Ty}var Sy,EC;function xO(){if(EC)return Sy;EC=1;var t=mr();Sy=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var i=this._keyIndices;if(n=String(n),!t.has(i,n)){var s=this._arr,o=s.length;return i[n]=o,s.push({key:n,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var i=this._keyIndices[n];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(n){var r=this._arr,i=2*n,s=i+1,o=n;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==n&&(this._swap(n,o),this._heapify(o)))},e.prototype._decrease=function(n){for(var r=this._arr,i=r[n].priority,s;n!==0&&(s=n>>1,!(r[s].priority<i));)this._swap(n,s),n=s},e.prototype._swap=function(n,r){var i=this._arr,s=this._keyIndices,o=i[n],l=i[r];i[n]=l,i[r]=o,s[l.key]=n,s[o.key]=r},Sy}var Ey,AC;function bO(){if(AC)return Ey;AC=1;var t=mr(),e=xO();Ey=r;var n=t.constant(1);function r(s,o,l,u){return i(s,String(o),l||n,u||function(d){return s.outEdges(d)})}function i(s,o,l,u){var d={},h=new e,m,_,y=function(T){var w=T.v!==m?T.v:T.w,b=d[w],S=l(T),A=_.distance+S;if(S<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+T+" Weight: "+S);A<b.distance&&(b.distance=A,b.predecessor=m,h.decrease(w,A))};for(s.nodes().forEach(function(T){var w=T===o?0:Number.POSITIVE_INFINITY;d[T]={distance:w},h.add(T,w)});h.size()>0&&(m=h.removeMin(),_=d[m],_.distance!==Number.POSITIVE_INFINITY);)u(m).forEach(y);return d}return Ey}var Ay,RC;function c7(){if(RC)return Ay;RC=1;var t=bO(),e=mr();Ay=n;function n(r,i,s){return e.transform(r.nodes(),function(o,l){o[l]=t(r,l,i,s)},{})}return Ay}var Ry,CC;function wO(){if(CC)return Ry;CC=1;var t=mr();Ry=e;function e(n){var r=0,i=[],s={},o=[];function l(u){var d=s[u]={onStack:!0,lowlink:r,index:r++};if(i.push(u),n.successors(u).forEach(function(_){t.has(s,_)?s[_].onStack&&(d.lowlink=Math.min(d.lowlink,s[_].index)):(l(_),d.lowlink=Math.min(d.lowlink,s[_].lowlink))}),d.lowlink===d.index){var h=[],m;do m=i.pop(),s[m].onStack=!1,h.push(m);while(u!==m);o.push(h)}}return n.nodes().forEach(function(u){t.has(s,u)||l(u)}),o}return Ry}var Cy,NC;function u7(){if(NC)return Cy;NC=1;var t=mr(),e=wO();Cy=n;function n(r){return t.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return Cy}var Ny,kC;function f7(){if(kC)return Ny;kC=1;var t=mr();Ny=n;var e=t.constant(1);function n(i,s,o){return r(i,s||e,o||function(l){return i.outEdges(l)})}function r(i,s,o){var l={},u=i.nodes();return u.forEach(function(d){l[d]={},l[d][d]={distance:0},u.forEach(function(h){d!==h&&(l[d][h]={distance:Number.POSITIVE_INFINITY})}),o(d).forEach(function(h){var m=h.v===d?h.w:h.v,_=s(h);l[d][m]={distance:_,predecessor:d}})}),u.forEach(function(d){var h=l[d];u.forEach(function(m){var _=l[m];u.forEach(function(y){var T=_[d],w=h[y],b=_[y],S=T.distance+w.distance;S<b.distance&&(b.distance=S,b.predecessor=w.predecessor)})})}),l}return Ny}var ky,MC;function TO(){if(MC)return ky;MC=1;var t=mr();ky=e,e.CycleException=n;function e(r){var i={},s={},o=[];function l(u){if(t.has(s,u))throw new n;t.has(i,u)||(s[u]=!0,i[u]=!0,t.each(r.predecessors(u),l),delete s[u],o.push(u))}if(t.each(r.sinks(),l),t.size(i)!==r.nodeCount())throw new n;return o}function n(){}return n.prototype=new Error,ky}var My,IC;function d7(){if(IC)return My;IC=1;var t=TO();My=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return My}var Iy,OC;function SO(){if(OC)return Iy;OC=1;var t=mr();Iy=e;function e(r,i,s){t.isArray(i)||(i=[i]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),l=[],u={};return t.each(i,function(d){if(!r.hasNode(d))throw new Error("Graph does not have node: "+d);n(r,d,s==="post",u,o,l)}),l}function n(r,i,s,o,l,u){t.has(o,i)||(o[i]=!0,s||u.push(i),t.each(l(i),function(d){n(r,d,s,o,l,u)}),s&&u.push(i))}return Iy}var Oy,PC;function h7(){if(PC)return Oy;PC=1;var t=SO();Oy=e;function e(n,r){return t(n,r,"post")}return Oy}var Py,DC;function p7(){if(DC)return Py;DC=1;var t=SO();Py=e;function e(n,r){return t(n,r,"pre")}return Py}var Dy,jC;function g7(){if(jC)return Dy;jC=1;var t=mr(),e=k1(),n=xO();Dy=r;function r(i,s){var o=new e,l={},u=new n,d;function h(_){var y=_.v===d?_.w:_.v,T=u.priority(y);if(T!==void 0){var w=s(_);w<T&&(l[y]=d,u.decrease(y,w))}}if(i.nodeCount()===0)return o;t.each(i.nodes(),function(_){u.add(_,Number.POSITIVE_INFINITY),o.setNode(_)}),u.decrease(i.nodes()[0],0);for(var m=!1;u.size()>0;){if(d=u.removeMin(),t.has(l,d))o.setEdge(d,l[d]);else{if(m)throw new Error("Input graph is not connected: "+i);m=!0}i.nodeEdges(d).forEach(h)}return o}return Dy}var jy,LC;function m7(){return LC||(LC=1,jy={components:l7(),dijkstra:bO(),dijkstraAll:c7(),findCycles:u7(),floydWarshall:f7(),isAcyclic:d7(),postorder:h7(),preorder:p7(),prim:g7(),tarjan:wO(),topsort:TO()}),jy}var Ly,BC;function _7(){if(BC)return Ly;BC=1;var t=a7();return Ly={Graph:t.Graph,json:o7(),alg:m7(),version:t.version},Ly}var By,UC;function Nr(){if(UC)return By;UC=1;var t;if(typeof p1=="function")try{t=_7()}catch{}return t||(t=window.graphlib),By=t,By}var Uy,FC;function v7(){if(FC)return Uy;FC=1;var t=GI(),e=1,n=4;function r(i){return t(i,e|n)}return Uy=r,Uy}var Fy,zC;function sh(){if(zC)return Fy;zC=1;var t=Mo(),e=xi(),n=Kd(),r=gr();function i(s,o,l){if(!r(l))return!1;var u=typeof o;return(u=="number"?e(l)&&n(o,l.length):u=="string"&&o in l)?t(l[o],s):!1}return Fy=i,Fy}var zy,$C;function y7(){if($C)return zy;$C=1;var t=ih(),e=Mo(),n=sh(),r=ta(),i=Object.prototype,s=i.hasOwnProperty,o=t(function(l,u){l=Object(l);var d=-1,h=u.length,m=h>2?u[2]:void 0;for(m&&n(u[0],u[1],m)&&(h=1);++d<h;)for(var _=u[d],y=r(_),T=-1,w=y.length;++T<w;){var b=y[T],S=l[b];(S===void 0||e(S,i[b])&&!s.call(l,b))&&(l[b]=_[b])}return l});return zy=o,zy}var $y,qC;function x7(){if(qC)return $y;qC=1;var t=bi(),e=xi(),n=us();function r(i){return function(s,o,l){var u=Object(s);if(!e(s)){var d=t(o,3);s=n(s),o=function(m){return d(u[m],m,u)}}var h=i(s,o,l);return h>-1?u[d?s[h]:h]:void 0}}return $y=r,$y}var qy,VC;function b7(){if(VC)return qy;VC=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return qy=e,qy}var Vy,HC;function w7(){if(HC)return Vy;HC=1;var t=b7(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return Vy=n,Vy}var Hy,WC;function T7(){if(WC)return Hy;WC=1;var t=w7(),e=gr(),n=Do(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(n(d))return r;if(e(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=e(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=t(d);var m=s.test(d);return m||o.test(d)?l(d.slice(2),m?2:8):i.test(d)?r:+d}return Hy=u,Hy}var Wy,XC;function EO(){if(XC)return Wy;XC=1;var t=T7(),e=1/0,n=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-1/0){var s=i<0?-1:1;return s*n}return i===i?i:0}return Wy=r,Wy}var Xy,YC;function S7(){if(YC)return Xy;YC=1;var t=EO();function e(n){var r=t(n),i=r%1;return r===r?i?r-i:r:0}return Xy=e,Xy}var Yy,GC;function E7(){if(GC)return Yy;GC=1;var t=_O(),e=bi(),n=S7(),r=Math.max;function i(s,o,l){var u=s==null?0:s.length;if(!u)return-1;var d=l==null?0:n(l);return d<0&&(d=r(u+d,0)),t(s,e(o,3),d)}return Yy=i,Yy}var Gy,KC;function A7(){if(KC)return Gy;KC=1;var t=x7(),e=E7(),n=t(e);return Gy=n,Gy}var Ky,ZC;function AO(){if(ZC)return Ky;ZC=1;var t=N1();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return Ky=e,Ky}var Zy,QC;function R7(){if(QC)return Zy;QC=1;var t=E1(),e=KI(),n=ta();function r(i,s){return i==null?i:t(i,e(s),n)}return Zy=r,Zy}var Qy,JC;function C7(){if(JC)return Qy;JC=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return Qy=t,Qy}var Jy,eN;function N7(){if(eN)return Jy;eN=1;var t=Yd(),e=A1(),n=bi();function r(i,s){var o={};return s=n(s,3),e(i,function(l,u,d){t(o,u,s(l,u,d))}),o}return Jy=r,Jy}var ex,tN;function M1(){if(tN)return ex;tN=1;var t=Do();function e(n,r,i){for(var s=-1,o=n.length;++s<o;){var l=n[s],u=r(l);if(u!=null&&(d===void 0?u===u&&!t(u):i(u,d)))var d=u,h=l}return h}return ex=e,ex}var tx,nN;function k7(){if(nN)return tx;nN=1;function t(e,n){return e>n}return tx=t,tx}var nx,rN;function M7(){if(rN)return nx;rN=1;var t=M1(),e=k7(),n=na();function r(i){return i&&i.length?t(i,n,e):void 0}return nx=r,nx}var rx,iN;function RO(){if(iN)return rx;iN=1;var t=Yd(),e=Mo();function n(r,i,s){(s!==void 0&&!e(r[i],s)||s===void 0&&!(i in r))&&t(r,i,s)}return rx=n,rx}var ix,sN;function I7(){if(sN)return ix;sN=1;var t=Js(),e=Jd(),n=Yr(),r="[object Object]",i=Function.prototype,s=Object.prototype,o=i.toString,l=s.hasOwnProperty,u=o.call(Object);function d(h){if(!n(h)||t(h)!=r)return!1;var m=e(h);if(m===null)return!0;var _=l.call(m,"constructor")&&m.constructor;return typeof _=="function"&&_ instanceof _&&o.call(_)==u}return ix=d,ix}var sx,aN;function CO(){if(aN)return sx;aN=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return sx=t,sx}var ax,oN;function O7(){if(oN)return ax;oN=1;var t=Ic(),e=ta();function n(r){return t(r,e(r))}return ax=n,ax}var ox,lN;function P7(){if(lN)return ox;lN=1;var t=RO(),e=LI(),n=WI(),r=BI(),i=YI(),s=Oc(),o=Gt(),l=vO(),u=Oo(),d=Mc(),h=gr(),m=I7(),_=Pc(),y=CO(),T=O7();function w(b,S,A,R,E,C,O){var P=y(b,A),k=y(S,A),I=O.get(k);if(I){t(b,A,I);return}var N=C?C(P,k,A+"",b,S,O):void 0,L=N===void 0;if(L){var $=o(k),Z=!$&&u(k),V=!$&&!Z&&_(k);N=k,$||Z||V?o(P)?N=P:l(P)?N=r(P):Z?(L=!1,N=e(k,!0)):V?(L=!1,N=n(k,!0)):N=[]:m(k)||s(k)?(N=P,s(P)?N=T(P):(!h(P)||d(P))&&(N=i(k))):L=!1}L&&(O.set(k,N),E(N,k,R,C,O),O.delete(k)),t(b,A,N)}return ox=w,ox}var lx,cN;function D7(){if(cN)return lx;cN=1;var t=Xd(),e=RO(),n=E1(),r=P7(),i=gr(),s=ta(),o=CO();function l(u,d,h,m,_){u!==d&&n(d,function(y,T){if(_||(_=new t),i(y))r(u,d,T,h,l,m,_);else{var w=m?m(o(u,T),y,T+"",u,d,_):void 0;w===void 0&&(w=y),e(u,T,w)}},s)}return lx=l,lx}var cx,uN;function j7(){if(uN)return cx;uN=1;var t=ih(),e=sh();function n(r){return t(function(i,s){var o=-1,l=s.length,u=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(s[0],s[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++o<l;){var h=s[o];h&&r(i,h,o,u)}return i})}return cx=n,cx}var ux,fN;function L7(){if(fN)return ux;fN=1;var t=D7(),e=j7(),n=e(function(r,i,s){t(r,i,s)});return ux=n,ux}var fx,dN;function NO(){if(dN)return fx;dN=1;function t(e,n){return e<n}return fx=t,fx}var dx,hN;function B7(){if(hN)return dx;hN=1;var t=M1(),e=NO(),n=na();function r(i){return i&&i.length?t(i,n,e):void 0}return dx=r,dx}var hx,pN;function U7(){if(pN)return hx;pN=1;var t=M1(),e=bi(),n=NO();function r(i,s){return i&&i.length?t(i,e(s,2),n):void 0}return hx=r,hx}var px,gN;function F7(){if(gN)return px;gN=1;var t=Ir(),e=function(){return t.Date.now()};return px=e,px}var gx,mN;function z7(){if(mN)return gx;mN=1;var t=Gd(),e=nh(),n=Kd(),r=gr(),i=Dc();function s(o,l,u,d){if(!r(o))return o;l=e(l,o);for(var h=-1,m=l.length,_=m-1,y=o;y!=null&&++h<m;){var T=i(l[h]),w=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(h!=_){var b=y[T];w=d?d(b,T,y):void 0,w===void 0&&(w=r(b)?b:n(l[h+1])?[]:{})}t(y,T,w),y=y[T]}return o}return gx=s,gx}var mx,_N;function $7(){if(_N)return mx;_N=1;var t=rh(),e=z7(),n=nh();function r(i,s,o){for(var l=-1,u=s.length,d={};++l<u;){var h=s[l],m=t(i,h);o(m,h)&&e(d,n(h,i),m)}return d}return mx=r,mx}var _x,vN;function q7(){if(vN)return _x;vN=1;var t=$7(),e=oO();function n(r,i){return t(r,i,function(s,o){return e(r,o)})}return _x=n,_x}var vx,yN;function V7(){if(yN)return vx;yN=1;var t=AO(),e=gO(),n=mO();function r(i){return n(e(i,void 0,t),i+"")}return vx=r,vx}var yx,xN;function H7(){if(xN)return yx;xN=1;var t=q7(),e=V7(),n=e(function(r,i){return r==null?{}:t(r,i)});return yx=n,yx}var xx,bN;function W7(){if(bN)return xx;bN=1;var t=Math.ceil,e=Math.max;function n(r,i,s,o){for(var l=-1,u=e(t((i-r)/(s||1)),0),d=Array(u);u--;)d[o?u:++l]=r,r+=s;return d}return xx=n,xx}var bx,wN;function X7(){if(wN)return bx;wN=1;var t=W7(),e=sh(),n=EO();function r(i){return function(s,o,l){return l&&typeof l!="number"&&e(s,o,l)&&(o=l=void 0),s=n(s),o===void 0?(o=s,s=0):o=n(o),l=l===void 0?s<o?1:-1:n(l),t(s,o,l,i)}}return bx=r,bx}var wx,TN;function Y7(){if(TN)return wx;TN=1;var t=X7(),e=t();return wx=e,wx}var Tx,SN;function G7(){if(SN)return Tx;SN=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return Tx=t,Tx}var Sx,EN;function K7(){if(EN)return Sx;EN=1;var t=Do();function e(n,r){if(n!==r){var i=n!==void 0,s=n===null,o=n===n,l=t(n),u=r!==void 0,d=r===null,h=r===r,m=t(r);if(!d&&!m&&!l&&n>r||l&&u&&h&&!d&&!m||s&&u&&h||!i&&h||!o)return 1;if(!s&&!l&&!m&&n<r||m&&i&&o&&!s&&!l||d&&i&&o||!u&&o||!h)return-1}return 0}return Sx=e,Sx}var Ex,AN;function Z7(){if(AN)return Ex;AN=1;var t=K7();function e(n,r,i){for(var s=-1,o=n.criteria,l=r.criteria,u=o.length,d=i.length;++s<u;){var h=t(o[s],l[s]);if(h){if(s>=d)return h;var m=i[s];return h*(m=="desc"?-1:1)}}return n.index-r.index}return Ex=e,Ex}var Ax,RN;function Q7(){if(RN)return Ax;RN=1;var t=th(),e=rh(),n=bi(),r=dO(),i=G7(),s=Zd(),o=Z7(),l=na(),u=Gt();function d(h,m,_){m.length?m=t(m,function(w){return u(w)?function(b){return e(b,w.length===1?w[0]:w)}:w}):m=[l];var y=-1;m=t(m,s(n));var T=r(h,function(w,b,S){var A=t(m,function(R){return R(w)});return{criteria:A,index:++y,value:w}});return i(T,function(w,b){return o(w,b,_)})}return Ax=d,Ax}var Rx,CN;function J7(){if(CN)return Rx;CN=1;var t=N1(),e=Q7(),n=ih(),r=sh(),i=n(function(s,o){if(s==null)return[];var l=o.length;return l>1&&r(s,o[0],o[1])?o=[]:l>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(s,t(o,1),[])});return Rx=i,Rx}var Cx,NN;function e$(){if(NN)return Cx;NN=1;var t=sO(),e=0;function n(r){var i=++e;return t(r)+i}return Cx=n,Cx}var Nx,kN;function t$(){if(kN)return Nx;kN=1;function t(e,n,r){for(var i=-1,s=e.length,o=n.length,l={};++i<s;){var u=i<o?n[i]:void 0;r(l,e[i],u)}return l}return Nx=t,Nx}var kx,MN;function n$(){if(MN)return kx;MN=1;var t=Gd(),e=t$();function n(r,i){return e(r||[],i||[],t)}return kx=n,kx}var Mx,IN;function Et(){if(IN)return Mx;IN=1;var t;if(typeof p1=="function")try{t={cloneDeep:v7(),constant:S1(),defaults:y7(),each:QI(),filter:cO(),find:A7(),flatten:AO(),forEach:ZI(),forIn:R7(),has:uO(),isUndefined:fO(),last:C7(),map:hO(),mapValues:N7(),max:M7(),merge:L7(),min:B7(),minBy:U7(),now:F7(),pick:H7(),range:Y7(),reduce:pO(),sortBy:J7(),uniqueId:e$(),values:yO(),zipObject:n$()}}catch{}return t||(t=window._),Mx=t,Mx}var Ix,ON;function r$(){if(ON)return Ix;ON=1,Ix=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},t.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},t.prototype.toString=function(){for(var r=[],i=this._sentinel,s=i._prev;s!==i;)r.push(JSON.stringify(s,n)),s=s._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,i){if(r!=="_next"&&r!=="_prev")return i}return Ix}var Ox,PN;function i$(){if(PN)return Ox;PN=1;var t=Et(),e=Nr().Graph,n=r$();Ox=i;var r=t.constant(1);function i(d,h){if(d.nodeCount()<=1)return[];var m=l(d,h||r),_=s(m.graph,m.buckets,m.zeroIdx);return t.flatten(t.map(_,function(y){return d.outEdges(y.v,y.w)}),!0)}function s(d,h,m){for(var _=[],y=h[h.length-1],T=h[0],w;d.nodeCount();){for(;w=T.dequeue();)o(d,h,m,w);for(;w=y.dequeue();)o(d,h,m,w);if(d.nodeCount()){for(var b=h.length-2;b>0;--b)if(w=h[b].dequeue(),w){_=_.concat(o(d,h,m,w,!0));break}}}return _}function o(d,h,m,_,y){var T=y?[]:void 0;return t.forEach(d.inEdges(_.v),function(w){var b=d.edge(w),S=d.node(w.v);y&&T.push({v:w.v,w:w.w}),S.out-=b,u(h,m,S)}),t.forEach(d.outEdges(_.v),function(w){var b=d.edge(w),S=w.w,A=d.node(S);A.in-=b,u(h,m,A)}),d.removeNode(_.v),T}function l(d,h){var m=new e,_=0,y=0;t.forEach(d.nodes(),function(b){m.setNode(b,{v:b,in:0,out:0})}),t.forEach(d.edges(),function(b){var S=m.edge(b.v,b.w)||0,A=h(b),R=S+A;m.setEdge(b.v,b.w,R),y=Math.max(y,m.node(b.v).out+=A),_=Math.max(_,m.node(b.w).in+=A)});var T=t.range(y+_+3).map(function(){return new n}),w=_+1;return t.forEach(m.nodes(),function(b){u(T,w,m.node(b))}),{graph:m,buckets:T,zeroIdx:w}}function u(d,h,m){m.out?m.in?d[m.out-m.in+h].enqueue(m):d[d.length-1].enqueue(m):d[0].enqueue(m)}return Ox}var Px,DN;function s$(){if(DN)return Px;DN=1;var t=Et(),e=i$();Px={run:n,undo:i};function n(s){var o=s.graph().acyclicer==="greedy"?e(s,l(s)):r(s);t.forEach(o,function(u){var d=s.edge(u);s.removeEdge(u),d.forwardName=u.name,d.reversed=!0,s.setEdge(u.w,u.v,d,t.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(s){var o=[],l={},u={};function d(h){t.has(u,h)||(u[h]=!0,l[h]=!0,t.forEach(s.outEdges(h),function(m){t.has(l,m.w)?o.push(m):d(m.w)}),delete l[h])}return t.forEach(s.nodes(),d),o}function i(s){t.forEach(s.edges(),function(o){var l=s.edge(o);if(l.reversed){s.removeEdge(o);var u=l.forwardName;delete l.reversed,delete l.forwardName,s.setEdge(o.w,o.v,l,u)}})}return Px}var Dx,jN;function Ln(){if(jN)return Dx;jN=1;var t=Et(),e=Nr().Graph;Dx={addDummyNode:n,simplify:r,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:o,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:h,addBorderNode:m,maxRank:_,partition:y,time:T,notime:w};function n(b,S,A,R){var E;do E=t.uniqueId(R);while(b.hasNode(E));return A.dummy=S,b.setNode(E,A),E}function r(b){var S=new e().setGraph(b.graph());return t.forEach(b.nodes(),function(A){S.setNode(A,b.node(A))}),t.forEach(b.edges(),function(A){var R=S.edge(A.v,A.w)||{weight:0,minlen:1},E=b.edge(A);S.setEdge(A.v,A.w,{weight:R.weight+E.weight,minlen:Math.max(R.minlen,E.minlen)})}),S}function i(b){var S=new e({multigraph:b.isMultigraph()}).setGraph(b.graph());return t.forEach(b.nodes(),function(A){b.children(A).length||S.setNode(A,b.node(A))}),t.forEach(b.edges(),function(A){S.setEdge(A,b.edge(A))}),S}function s(b){var S=t.map(b.nodes(),function(A){var R={};return t.forEach(b.outEdges(A),function(E){R[E.w]=(R[E.w]||0)+b.edge(E).weight}),R});return t.zipObject(b.nodes(),S)}function o(b){var S=t.map(b.nodes(),function(A){var R={};return t.forEach(b.inEdges(A),function(E){R[E.v]=(R[E.v]||0)+b.edge(E).weight}),R});return t.zipObject(b.nodes(),S)}function l(b,S){var A=b.x,R=b.y,E=S.x-A,C=S.y-R,O=b.width/2,P=b.height/2;if(!E&&!C)throw new Error("Not possible to find intersection inside of the rectangle");var k,I;return Math.abs(C)*O>Math.abs(E)*P?(C<0&&(P=-P),k=P*E/C,I=P):(E<0&&(O=-O),k=O,I=O*C/E),{x:A+k,y:R+I}}function u(b){var S=t.map(t.range(_(b)+1),function(){return[]});return t.forEach(b.nodes(),function(A){var R=b.node(A),E=R.rank;t.isUndefined(E)||(S[E][R.order]=A)}),S}function d(b){var S=t.min(t.map(b.nodes(),function(A){return b.node(A).rank}));t.forEach(b.nodes(),function(A){var R=b.node(A);t.has(R,"rank")&&(R.rank-=S)})}function h(b){var S=t.min(t.map(b.nodes(),function(C){return b.node(C).rank})),A=[];t.forEach(b.nodes(),function(C){var O=b.node(C).rank-S;A[O]||(A[O]=[]),A[O].push(C)});var R=0,E=b.graph().nodeRankFactor;t.forEach(A,function(C,O){t.isUndefined(C)&&O%E!==0?--R:R&&t.forEach(C,function(P){b.node(P).rank+=R})})}function m(b,S,A,R){var E={width:0,height:0};return arguments.length>=4&&(E.rank=A,E.order=R),n(b,"border",E,S)}function _(b){return t.max(t.map(b.nodes(),function(S){var A=b.node(S).rank;if(!t.isUndefined(A))return A}))}function y(b,S){var A={lhs:[],rhs:[]};return t.forEach(b,function(R){S(R)?A.lhs.push(R):A.rhs.push(R)}),A}function T(b,S){var A=t.now();try{return S()}finally{console.log(b+" time: "+(t.now()-A)+"ms")}}function w(b,S){return S()}return Dx}var jx,LN;function a$(){if(LN)return jx;LN=1;var t=Et(),e=Ln();jx={run:n,undo:i};function n(s){s.graph().dummyChains=[],t.forEach(s.edges(),function(o){r(s,o)})}function r(s,o){var l=o.v,u=s.node(l).rank,d=o.w,h=s.node(d).rank,m=o.name,_=s.edge(o),y=_.labelRank;if(h!==u+1){s.removeEdge(o);var T,w,b;for(b=0,++u;u<h;++b,++u)_.points=[],w={width:0,height:0,edgeLabel:_,edgeObj:o,rank:u},T=e.addDummyNode(s,"edge",w,"_d"),u===y&&(w.width=_.width,w.height=_.height,w.dummy="edge-label",w.labelpos=_.labelpos),s.setEdge(l,T,{weight:_.weight},m),b===0&&s.graph().dummyChains.push(T),l=T;s.setEdge(l,d,{weight:_.weight},m)}}function i(s){t.forEach(s.graph().dummyChains,function(o){var l=s.node(o),u=l.edgeLabel,d;for(s.setEdge(l.edgeObj,u);l.dummy;)d=s.successors(o)[0],s.removeNode(o),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),o=d,l=s.node(o)})}return jx}var Lx,BN;function zf(){if(BN)return Lx;BN=1;var t=Et();Lx={longestPath:e,slack:n};function e(r){var i={};function s(o){var l=r.node(o);if(t.has(i,o))return l.rank;i[o]=!0;var u=t.min(t.map(r.outEdges(o),function(d){return s(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}t.forEach(r.sources(),s)}function n(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return Lx}var Bx,UN;function kO(){if(UN)return Bx;UN=1;var t=Et(),e=Nr().Graph,n=zf().slack;Bx=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],h=l.nodeCount();u.setNode(d,{});for(var m,_;i(u,l)<h;)m=s(u,l),_=u.hasNode(m.v)?n(l,m):-n(l,m),o(u,l,_);return u}function i(l,u){function d(h){t.forEach(u.nodeEdges(h),function(m){var _=m.v,y=h===_?m.w:_;!l.hasNode(y)&&!n(u,m)&&(l.setNode(y,{}),l.setEdge(h,y,{}),d(y))})}return t.forEach(l.nodes(),d),l.nodeCount()}function s(l,u){return t.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return n(u,d)})}function o(l,u,d){t.forEach(l.nodes(),function(h){u.node(h).rank+=d})}return Bx}var Ux,FN;function o$(){if(FN)return Ux;FN=1;var t=Et(),e=kO(),n=zf().slack,r=zf().longestPath,i=Nr().alg.preorder,s=Nr().alg.postorder,o=Ln().simplify;Ux=l,l.initLowLimValues=m,l.initCutValues=u,l.calcCutValue=h,l.leaveEdge=y,l.enterEdge=T,l.exchangeEdges=w;function l(R){R=o(R),r(R);var E=e(R);m(E),u(E,R);for(var C,O;C=y(E);)O=T(E,R,C),w(E,R,C,O)}function u(R,E){var C=s(R,R.nodes());C=C.slice(0,C.length-1),t.forEach(C,function(O){d(R,E,O)})}function d(R,E,C){var O=R.node(C),P=O.parent;R.edge(C,P).cutvalue=h(R,E,C)}function h(R,E,C){var O=R.node(C),P=O.parent,k=!0,I=E.edge(C,P),N=0;return I||(k=!1,I=E.edge(P,C)),N=I.weight,t.forEach(E.nodeEdges(C),function(L){var $=L.v===C,Z=$?L.w:L.v;if(Z!==P){var V=$===k,q=E.edge(L).weight;if(N+=V?q:-q,S(R,C,Z)){var z=R.edge(C,Z).cutvalue;N+=V?-z:z}}}),N}function m(R,E){arguments.length<2&&(E=R.nodes()[0]),_(R,{},1,E)}function _(R,E,C,O,P){var k=C,I=R.node(O);return E[O]=!0,t.forEach(R.neighbors(O),function(N){t.has(E,N)||(C=_(R,E,C,N,O))}),I.low=k,I.lim=C++,P?I.parent=P:delete I.parent,C}function y(R){return t.find(R.edges(),function(E){return R.edge(E).cutvalue<0})}function T(R,E,C){var O=C.v,P=C.w;E.hasEdge(O,P)||(O=C.w,P=C.v);var k=R.node(O),I=R.node(P),N=k,L=!1;k.lim>I.lim&&(N=I,L=!0);var $=t.filter(E.edges(),function(Z){return L===A(R,R.node(Z.v),N)&&L!==A(R,R.node(Z.w),N)});return t.minBy($,function(Z){return n(E,Z)})}function w(R,E,C,O){var P=C.v,k=C.w;R.removeEdge(P,k),R.setEdge(O.v,O.w,{}),m(R),u(R,E),b(R,E)}function b(R,E){var C=t.find(R.nodes(),function(P){return!E.node(P).parent}),O=i(R,C);O=O.slice(1),t.forEach(O,function(P){var k=R.node(P).parent,I=E.edge(P,k),N=!1;I||(I=E.edge(k,P),N=!0),E.node(P).rank=E.node(k).rank+(N?I.minlen:-I.minlen)})}function S(R,E,C){return R.hasEdge(E,C)}function A(R,E,C){return C.low<=E.lim&&E.lim<=C.lim}return Ux}var Fx,zN;function l$(){if(zN)return Fx;zN=1;var t=zf(),e=t.longestPath,n=kO(),r=o$();Fx=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":o(u);break;case"longest-path":s(u);break;default:l(u)}}var s=e;function o(u){e(u),n(u)}function l(u){r(u)}return Fx}var zx,$N;function c$(){if($N)return zx;$N=1;var t=Et();zx=e;function e(i){var s=r(i);t.forEach(i.graph().dummyChains,function(o){for(var l=i.node(o),u=l.edgeObj,d=n(i,s,u.v,u.w),h=d.path,m=d.lca,_=0,y=h[_],T=!0;o!==u.w;){if(l=i.node(o),T){for(;(y=h[_])!==m&&i.node(y).maxRank<l.rank;)_++;y===m&&(T=!1)}if(!T){for(;_<h.length-1&&i.node(y=h[_+1]).minRank<=l.rank;)_++;y=h[_]}i.setParent(o,y),o=i.successors(o)[0]}})}function n(i,s,o,l){var u=[],d=[],h=Math.min(s[o].low,s[l].low),m=Math.max(s[o].lim,s[l].lim),_,y;_=o;do _=i.parent(_),u.push(_);while(_&&(s[_].low>h||m>s[_].lim));for(y=_,_=l;(_=i.parent(_))!==y;)d.push(_);return{path:u.concat(d.reverse()),lca:y}}function r(i){var s={},o=0;function l(u){var d=o;t.forEach(i.children(u),l),s[u]={low:d,lim:o++}}return t.forEach(i.children(),l),s}return zx}var $x,qN;function u$(){if(qN)return $x;qN=1;var t=Et(),e=Ln();$x={run:n,cleanup:o};function n(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),h=t.max(t.values(d))-1,m=2*h+1;l.graph().nestingRoot=u,t.forEach(l.edges(),function(y){l.edge(y).minlen*=m});var _=s(l)+1;t.forEach(l.children(),function(y){r(l,u,m,_,h,d,y)}),l.graph().nodeRankFactor=m}function r(l,u,d,h,m,_,y){var T=l.children(y);if(!T.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var w=e.addBorderNode(l,"_bt"),b=e.addBorderNode(l,"_bb"),S=l.node(y);l.setParent(w,y),S.borderTop=w,l.setParent(b,y),S.borderBottom=b,t.forEach(T,function(A){r(l,u,d,h,m,_,A);var R=l.node(A),E=R.borderTop?R.borderTop:A,C=R.borderBottom?R.borderBottom:A,O=R.borderTop?h:2*h,P=E!==C?1:m-_[y]+1;l.setEdge(w,E,{weight:O,minlen:P,nestingEdge:!0}),l.setEdge(C,b,{weight:O,minlen:P,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,w,{weight:0,minlen:m+_[y]})}function i(l){var u={};function d(h,m){var _=l.children(h);_&&_.length&&t.forEach(_,function(y){d(y,m+1)}),u[h]=m}return t.forEach(l.children(),function(h){d(h,1)}),u}function s(l){return t.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function o(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,t.forEach(l.edges(),function(d){var h=l.edge(d);h.nestingEdge&&l.removeEdge(d)})}return $x}var qx,VN;function f$(){if(VN)return qx;VN=1;var t=Et(),e=Ln();qx=n;function n(i){function s(o){var l=i.children(o),u=i.node(o);if(l.length&&t.forEach(l,s),t.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,h=u.maxRank+1;d<h;++d)r(i,"borderLeft","_bl",o,u,d),r(i,"borderRight","_br",o,u,d)}}t.forEach(i.children(),s)}function r(i,s,o,l,u,d){var h={width:0,height:0,rank:d,borderType:s},m=u[s][d-1],_=e.addDummyNode(i,"border",h,o);u[s][d]=_,i.setParent(_,l),m&&i.setEdge(m,_,{weight:1})}return qx}var Vx,HN;function d$(){if(HN)return Vx;HN=1;var t=Et();Vx={adjust:e,undo:n};function e(d){var h=d.graph().rankdir.toLowerCase();(h==="lr"||h==="rl")&&r(d)}function n(d){var h=d.graph().rankdir.toLowerCase();(h==="bt"||h==="rl")&&s(d),(h==="lr"||h==="rl")&&(l(d),r(d))}function r(d){t.forEach(d.nodes(),function(h){i(d.node(h))}),t.forEach(d.edges(),function(h){i(d.edge(h))})}function i(d){var h=d.width;d.width=d.height,d.height=h}function s(d){t.forEach(d.nodes(),function(h){o(d.node(h))}),t.forEach(d.edges(),function(h){var m=d.edge(h);t.forEach(m.points,o),t.has(m,"y")&&o(m)})}function o(d){d.y=-d.y}function l(d){t.forEach(d.nodes(),function(h){u(d.node(h))}),t.forEach(d.edges(),function(h){var m=d.edge(h);t.forEach(m.points,u),t.has(m,"x")&&u(m)})}function u(d){var h=d.x;d.x=d.y,d.y=h}return Vx}var Hx,WN;function h$(){if(WN)return Hx;WN=1;var t=Et();Hx=e;function e(n){var r={},i=t.filter(n.nodes(),function(d){return!n.children(d).length}),s=t.max(t.map(i,function(d){return n.node(d).rank})),o=t.map(t.range(s+1),function(){return[]});function l(d){if(!t.has(r,d)){r[d]=!0;var h=n.node(d);o[h.rank].push(d),t.forEach(n.successors(d),l)}}var u=t.sortBy(i,function(d){return n.node(d).rank});return t.forEach(u,l),o}return Hx}var Wx,XN;function p$(){if(XN)return Wx;XN=1;var t=Et();Wx=e;function e(r,i){for(var s=0,o=1;o<i.length;++o)s+=n(r,i[o-1],i[o]);return s}function n(r,i,s){for(var o=t.zipObject(s,t.map(s,function(_,y){return y})),l=t.flatten(t.map(i,function(_){return t.sortBy(t.map(r.outEdges(_),function(y){return{pos:o[y.w],weight:r.edge(y).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var d=2*u-1;u-=1;var h=t.map(new Array(d),function(){return 0}),m=0;return t.forEach(l.forEach(function(_){var y=_.pos+u;h[y]+=_.weight;for(var T=0;y>0;)y%2&&(T+=h[y+1]),y=y-1>>1,h[y]+=_.weight;m+=_.weight*T})),m}return Wx}var Xx,YN;function g$(){if(YN)return Xx;YN=1;var t=Et();Xx=e;function e(n,r){return t.map(r,function(i){var s=n.inEdges(i);if(s.length){var o=t.reduce(s,function(l,u){var d=n.edge(u),h=n.node(u.v);return{sum:l.sum+d.weight*h.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:i}})}return Xx}var Yx,GN;function m$(){if(GN)return Yx;GN=1;var t=Et();Yx=e;function e(i,s){var o={};t.forEach(i,function(u,d){var h=o[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};t.isUndefined(u.barycenter)||(h.barycenter=u.barycenter,h.weight=u.weight)}),t.forEach(s.edges(),function(u){var d=o[u.v],h=o[u.w];!t.isUndefined(d)&&!t.isUndefined(h)&&(h.indegree++,d.out.push(o[u.w]))});var l=t.filter(o,function(u){return!u.indegree});return n(l)}function n(i){var s=[];function o(d){return function(h){h.merged||(t.isUndefined(h.barycenter)||t.isUndefined(d.barycenter)||h.barycenter>=d.barycenter)&&r(d,h)}}function l(d){return function(h){h.in.push(d),--h.indegree===0&&i.push(h)}}for(;i.length;){var u=i.pop();s.push(u),t.forEach(u.in.reverse(),o(u)),t.forEach(u.out,l(u))}return t.map(t.filter(s,function(d){return!d.merged}),function(d){return t.pick(d,["vs","i","barycenter","weight"])})}function r(i,s){var o=0,l=0;i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),s.weight&&(o+=s.barycenter*s.weight,l+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=o/l,i.weight=l,i.i=Math.min(s.i,i.i),s.merged=!0}return Yx}var Gx,KN;function _$(){if(KN)return Gx;KN=1;var t=Et(),e=Ln();Gx=n;function n(s,o){var l=e.partition(s,function(w){return t.has(w,"barycenter")}),u=l.lhs,d=t.sortBy(l.rhs,function(w){return-w.i}),h=[],m=0,_=0,y=0;u.sort(i(!!o)),y=r(h,d,y),t.forEach(u,function(w){y+=w.vs.length,h.push(w.vs),m+=w.barycenter*w.weight,_+=w.weight,y=r(h,d,y)});var T={vs:t.flatten(h,!0)};return _&&(T.barycenter=m/_,T.weight=_),T}function r(s,o,l){for(var u;o.length&&(u=t.last(o)).i<=l;)o.pop(),s.push(u.vs),l++;return l}function i(s){return function(o,l){return o.barycenter<l.barycenter?-1:o.barycenter>l.barycenter?1:s?l.i-o.i:o.i-l.i}}return Gx}var Kx,ZN;function v$(){if(ZN)return Kx;ZN=1;var t=Et(),e=g$(),n=m$(),r=_$();Kx=i;function i(l,u,d,h){var m=l.children(u),_=l.node(u),y=_?_.borderLeft:void 0,T=_?_.borderRight:void 0,w={};y&&(m=t.filter(m,function(C){return C!==y&&C!==T}));var b=e(l,m);t.forEach(b,function(C){if(l.children(C.v).length){var O=i(l,C.v,d,h);w[C.v]=O,t.has(O,"barycenter")&&o(C,O)}});var S=n(b,d);s(S,w);var A=r(S,h);if(y&&(A.vs=t.flatten([y,A.vs,T],!0),l.predecessors(y).length)){var R=l.node(l.predecessors(y)[0]),E=l.node(l.predecessors(T)[0]);t.has(A,"barycenter")||(A.barycenter=0,A.weight=0),A.barycenter=(A.barycenter*A.weight+R.order+E.order)/(A.weight+2),A.weight+=2}return A}function s(l,u){t.forEach(l,function(d){d.vs=t.flatten(d.vs.map(function(h){return u[h]?u[h].vs:h}),!0)})}function o(l,u){t.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return Kx}var Zx,QN;function y$(){if(QN)return Zx;QN=1;var t=Et(),e=Nr().Graph;Zx=n;function n(i,s,o){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return t.forEach(i.nodes(),function(d){var h=i.node(d),m=i.parent(d);(h.rank===s||h.minRank<=s&&s<=h.maxRank)&&(u.setNode(d),u.setParent(d,m||l),t.forEach(i[o](d),function(_){var y=_.v===d?_.w:_.v,T=u.edge(y,d),w=t.isUndefined(T)?0:T.weight;u.setEdge(y,d,{weight:i.edge(_).weight+w})}),t.has(h,"minRank")&&u.setNode(d,{borderLeft:h.borderLeft[s],borderRight:h.borderRight[s]}))}),u}function r(i){for(var s;i.hasNode(s=t.uniqueId("_root")););return s}return Zx}var Qx,JN;function x$(){if(JN)return Qx;JN=1;var t=Et();Qx=e;function e(n,r,i){var s={},o;t.forEach(i,function(l){for(var u=n.parent(l),d,h;u;){if(d=n.parent(u),d?(h=s[d],s[d]=u):(h=o,o=u),h&&h!==u){r.setEdge(h,u);return}u=d}})}return Qx}var Jx,ek;function b$(){if(ek)return Jx;ek=1;var t=Et(),e=h$(),n=p$(),r=v$(),i=y$(),s=x$(),o=Nr().Graph,l=Ln();Jx=u;function u(_){var y=l.maxRank(_),T=d(_,t.range(1,y+1),"inEdges"),w=d(_,t.range(y-1,-1,-1),"outEdges"),b=e(_);m(_,b);for(var S=Number.POSITIVE_INFINITY,A,R=0,E=0;E<4;++R,++E){h(R%2?T:w,R%4>=2),b=l.buildLayerMatrix(_);var C=n(_,b);C<S&&(E=0,A=t.cloneDeep(b),S=C)}m(_,A)}function d(_,y,T){return t.map(y,function(w){return i(_,w,T)})}function h(_,y){var T=new o;t.forEach(_,function(w){var b=w.graph().root,S=r(w,b,T,y);t.forEach(S.vs,function(A,R){w.node(A).order=R}),s(w,T,S.vs)})}function m(_,y){t.forEach(y,function(T){t.forEach(T,function(w,b){_.node(w).order=b})})}return Jx}var eb,tk;function w$(){if(tk)return eb;tk=1;var t=Et(),e=Nr().Graph,n=Ln();eb={positionX:T,findType1Conflicts:r,findType2Conflicts:i,addConflict:o,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:_,findSmallestWidthAlignment:m,balance:y};function r(S,A){var R={};function E(C,O){var P=0,k=0,I=C.length,N=t.last(O);return t.forEach(O,function(L,$){var Z=s(S,L),V=Z?S.node(Z).order:I;(Z||L===N)&&(t.forEach(O.slice(k,$+1),function(q){t.forEach(S.predecessors(q),function(z){var Q=S.node(z),oe=Q.order;(oe<P||V<oe)&&!(Q.dummy&&S.node(q).dummy)&&o(R,z,q)})}),k=$+1,P=V)}),O}return t.reduce(A,E),R}function i(S,A){var R={};function E(O,P,k,I,N){var L;t.forEach(t.range(P,k),function($){L=O[$],S.node(L).dummy&&t.forEach(S.predecessors(L),function(Z){var V=S.node(Z);V.dummy&&(V.order<I||V.order>N)&&o(R,Z,L)})})}function C(O,P){var k=-1,I,N=0;return t.forEach(P,function(L,$){if(S.node(L).dummy==="border"){var Z=S.predecessors(L);Z.length&&(I=S.node(Z[0]).order,E(P,N,$,k,I),N=$,k=I)}E(P,N,P.length,I,O.length)}),P}return t.reduce(A,C),R}function s(S,A){if(S.node(A).dummy)return t.find(S.predecessors(A),function(R){return S.node(R).dummy})}function o(S,A,R){if(A>R){var E=A;A=R,R=E}var C=S[A];C||(S[A]=C={}),C[R]=!0}function l(S,A,R){if(A>R){var E=A;A=R,R=E}return t.has(S[A],R)}function u(S,A,R,E){var C={},O={},P={};return t.forEach(A,function(k){t.forEach(k,function(I,N){C[I]=I,O[I]=I,P[I]=N})}),t.forEach(A,function(k){var I=-1;t.forEach(k,function(N){var L=E(N);if(L.length){L=t.sortBy(L,function(z){return P[z]});for(var $=(L.length-1)/2,Z=Math.floor($),V=Math.ceil($);Z<=V;++Z){var q=L[Z];O[N]===N&&I<P[q]&&!l(R,N,q)&&(O[q]=N,O[N]=C[N]=C[q],I=P[q])}}})}),{root:C,align:O}}function d(S,A,R,E,C){var O={},P=h(S,A,R,C),k=C?"borderLeft":"borderRight";function I($,Z){for(var V=P.nodes(),q=V.pop(),z={};q;)z[q]?$(q):(z[q]=!0,V.push(q),V=V.concat(Z(q))),q=V.pop()}function N($){O[$]=P.inEdges($).reduce(function(Z,V){return Math.max(Z,O[V.v]+P.edge(V))},0)}function L($){var Z=P.outEdges($).reduce(function(q,z){return Math.min(q,O[z.w]-P.edge(z))},Number.POSITIVE_INFINITY),V=S.node($);Z!==Number.POSITIVE_INFINITY&&V.borderType!==k&&(O[$]=Math.max(O[$],Z))}return I(N,P.predecessors.bind(P)),I(L,P.successors.bind(P)),t.forEach(E,function($){O[$]=O[R[$]]}),O}function h(S,A,R,E){var C=new e,O=S.graph(),P=w(O.nodesep,O.edgesep,E);return t.forEach(A,function(k){var I;t.forEach(k,function(N){var L=R[N];if(C.setNode(L),I){var $=R[I],Z=C.edge($,L);C.setEdge($,L,Math.max(P(S,N,I),Z||0))}I=N})}),C}function m(S,A){return t.minBy(t.values(A),function(R){var E=Number.NEGATIVE_INFINITY,C=Number.POSITIVE_INFINITY;return t.forIn(R,function(O,P){var k=b(S,P)/2;E=Math.max(O+k,E),C=Math.min(O-k,C)}),E-C})}function _(S,A){var R=t.values(A),E=t.min(R),C=t.max(R);t.forEach(["u","d"],function(O){t.forEach(["l","r"],function(P){var k=O+P,I=S[k],N;if(I!==A){var L=t.values(I);N=P==="l"?E-t.min(L):C-t.max(L),N&&(S[k]=t.mapValues(I,function($){return $+N}))}})})}function y(S,A){return t.mapValues(S.ul,function(R,E){if(A)return S[A.toLowerCase()][E];var C=t.sortBy(t.map(S,E));return(C[1]+C[2])/2})}function T(S){var A=n.buildLayerMatrix(S),R=t.merge(r(S,A),i(S,A)),E={},C;t.forEach(["u","d"],function(P){C=P==="u"?A:t.values(A).reverse(),t.forEach(["l","r"],function(k){k==="r"&&(C=t.map(C,function($){return t.values($).reverse()}));var I=(P==="u"?S.predecessors:S.successors).bind(S),N=u(S,C,R,I),L=d(S,C,N.root,N.align,k==="r");k==="r"&&(L=t.mapValues(L,function($){return-$})),E[P+k]=L})});var O=m(S,E);return _(E,O),y(E,S.graph().align)}function w(S,A,R){return function(E,C,O){var P=E.node(C),k=E.node(O),I=0,N;if(I+=P.width/2,t.has(P,"labelpos"))switch(P.labelpos.toLowerCase()){case"l":N=-P.width/2;break;case"r":N=P.width/2;break}if(N&&(I+=R?N:-N),N=0,I+=(P.dummy?A:S)/2,I+=(k.dummy?A:S)/2,I+=k.width/2,t.has(k,"labelpos"))switch(k.labelpos.toLowerCase()){case"l":N=k.width/2;break;case"r":N=-k.width/2;break}return N&&(I+=R?N:-N),N=0,I}}function b(S,A){return S.node(A).width}return eb}var tb,nk;function T$(){if(nk)return tb;nk=1;var t=Et(),e=Ln(),n=w$().positionX;tb=r;function r(s){s=e.asNonCompoundGraph(s),i(s),t.forEach(n(s),function(o,l){s.node(l).x=o})}function i(s){var o=e.buildLayerMatrix(s),l=s.graph().ranksep,u=0;t.forEach(o,function(d){var h=t.max(t.map(d,function(m){return s.node(m).height}));t.forEach(d,function(m){s.node(m).y=u+h/2}),u+=h+l})}return tb}var nb,rk;function S$(){if(rk)return nb;rk=1;var t=Et(),e=s$(),n=a$(),r=l$(),i=Ln().normalizeRanks,s=c$(),o=Ln().removeEmptyRanks,l=u$(),u=f$(),d=d$(),h=b$(),m=T$(),_=Ln(),y=Nr().Graph;nb=T;function T(F,X){var J=X&&X.debugTiming?_.time:_.notime;J("layout",function(){var pe=J("  buildLayoutGraph",function(){return I(F)});J("  runLayout",function(){w(pe,J)}),J("  updateInputGraph",function(){b(F,pe)})})}function w(F,X){X("    makeSpaceForEdgeLabels",function(){N(F)}),X("    removeSelfEdges",function(){G(F)}),X("    acyclic",function(){e.run(F)}),X("    nestingGraph.run",function(){l.run(F)}),X("    rank",function(){r(_.asNonCompoundGraph(F))}),X("    injectEdgeLabelProxies",function(){L(F)}),X("    removeEmptyRanks",function(){o(F)}),X("    nestingGraph.cleanup",function(){l.cleanup(F)}),X("    normalizeRanks",function(){i(F)}),X("    assignRankMinMax",function(){$(F)}),X("    removeEdgeLabelProxies",function(){Z(F)}),X("    normalize.run",function(){n.run(F)}),X("    parentDummyChains",function(){s(F)}),X("    addBorderSegments",function(){u(F)}),X("    order",function(){h(F)}),X("    insertSelfEdges",function(){D(F)}),X("    adjustCoordinateSystem",function(){d.adjust(F)}),X("    position",function(){m(F)}),X("    positionSelfEdges",function(){Y(F)}),X("    removeBorderNodes",function(){oe(F)}),X("    normalize.undo",function(){n.undo(F)}),X("    fixupEdgeLabelCoords",function(){z(F)}),X("    undoCoordinateSystem",function(){d.undo(F)}),X("    translateGraph",function(){V(F)}),X("    assignNodeIntersects",function(){q(F)}),X("    reversePoints",function(){Q(F)}),X("    acyclic.undo",function(){e.undo(F)})}function b(F,X){t.forEach(F.nodes(),function(J){var pe=F.node(J),ye=X.node(J);pe&&(pe.x=ye.x,pe.y=ye.y,X.children(J).length&&(pe.width=ye.width,pe.height=ye.height))}),t.forEach(F.edges(),function(J){var pe=F.edge(J),ye=X.edge(J);pe.points=ye.points,t.has(ye,"x")&&(pe.x=ye.x,pe.y=ye.y)}),F.graph().width=X.graph().width,F.graph().height=X.graph().height}var S=["nodesep","edgesep","ranksep","marginx","marginy"],A={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},R=["acyclicer","ranker","rankdir","align"],E=["width","height"],C={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],P={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},k=["labelpos"];function I(F){var X=new y({multigraph:!0,compound:!0}),J=ie(F.graph());return X.setGraph(t.merge({},A,le(J,S),t.pick(J,R))),t.forEach(F.nodes(),function(pe){var ye=ie(F.node(pe));X.setNode(pe,t.defaults(le(ye,E),C)),X.setParent(pe,F.parent(pe))}),t.forEach(F.edges(),function(pe){var ye=ie(F.edge(pe));X.setEdge(pe,t.merge({},P,le(ye,O),t.pick(ye,k)))}),X}function N(F){var X=F.graph();X.ranksep/=2,t.forEach(F.edges(),function(J){var pe=F.edge(J);pe.minlen*=2,pe.labelpos.toLowerCase()!=="c"&&(X.rankdir==="TB"||X.rankdir==="BT"?pe.width+=pe.labeloffset:pe.height+=pe.labeloffset)})}function L(F){t.forEach(F.edges(),function(X){var J=F.edge(X);if(J.width&&J.height){var pe=F.node(X.v),ye=F.node(X.w),Ae={rank:(ye.rank-pe.rank)/2+pe.rank,e:X};_.addDummyNode(F,"edge-proxy",Ae,"_ep")}})}function $(F){var X=0;t.forEach(F.nodes(),function(J){var pe=F.node(J);pe.borderTop&&(pe.minRank=F.node(pe.borderTop).rank,pe.maxRank=F.node(pe.borderBottom).rank,X=t.max(X,pe.maxRank))}),F.graph().maxRank=X}function Z(F){t.forEach(F.nodes(),function(X){var J=F.node(X);J.dummy==="edge-proxy"&&(F.edge(J.e).labelRank=J.rank,F.removeNode(X))})}function V(F){var X=Number.POSITIVE_INFINITY,J=0,pe=Number.POSITIVE_INFINITY,ye=0,Ae=F.graph(),Oe=Ae.marginx||0,Ue=Ae.marginy||0;function Ee(Te){var Ne=Te.x,Pe=Te.y,Kt=Te.width,Me=Te.height;X=Math.min(X,Ne-Kt/2),J=Math.max(J,Ne+Kt/2),pe=Math.min(pe,Pe-Me/2),ye=Math.max(ye,Pe+Me/2)}t.forEach(F.nodes(),function(Te){Ee(F.node(Te))}),t.forEach(F.edges(),function(Te){var Ne=F.edge(Te);t.has(Ne,"x")&&Ee(Ne)}),X-=Oe,pe-=Ue,t.forEach(F.nodes(),function(Te){var Ne=F.node(Te);Ne.x-=X,Ne.y-=pe}),t.forEach(F.edges(),function(Te){var Ne=F.edge(Te);t.forEach(Ne.points,function(Pe){Pe.x-=X,Pe.y-=pe}),t.has(Ne,"x")&&(Ne.x-=X),t.has(Ne,"y")&&(Ne.y-=pe)}),Ae.width=J-X+Oe,Ae.height=ye-pe+Ue}function q(F){t.forEach(F.edges(),function(X){var J=F.edge(X),pe=F.node(X.v),ye=F.node(X.w),Ae,Oe;J.points?(Ae=J.points[0],Oe=J.points[J.points.length-1]):(J.points=[],Ae=ye,Oe=pe),J.points.unshift(_.intersectRect(pe,Ae)),J.points.push(_.intersectRect(ye,Oe))})}function z(F){t.forEach(F.edges(),function(X){var J=F.edge(X);if(t.has(J,"x"))switch((J.labelpos==="l"||J.labelpos==="r")&&(J.width-=J.labeloffset),J.labelpos){case"l":J.x-=J.width/2+J.labeloffset;break;case"r":J.x+=J.width/2+J.labeloffset;break}})}function Q(F){t.forEach(F.edges(),function(X){var J=F.edge(X);J.reversed&&J.points.reverse()})}function oe(F){t.forEach(F.nodes(),function(X){if(F.children(X).length){var J=F.node(X),pe=F.node(J.borderTop),ye=F.node(J.borderBottom),Ae=F.node(t.last(J.borderLeft)),Oe=F.node(t.last(J.borderRight));J.width=Math.abs(Oe.x-Ae.x),J.height=Math.abs(ye.y-pe.y),J.x=Ae.x+J.width/2,J.y=pe.y+J.height/2}}),t.forEach(F.nodes(),function(X){F.node(X).dummy==="border"&&F.removeNode(X)})}function G(F){t.forEach(F.edges(),function(X){if(X.v===X.w){var J=F.node(X.v);J.selfEdges||(J.selfEdges=[]),J.selfEdges.push({e:X,label:F.edge(X)}),F.removeEdge(X)}})}function D(F){var X=_.buildLayerMatrix(F);t.forEach(X,function(J){var pe=0;t.forEach(J,function(ye,Ae){var Oe=F.node(ye);Oe.order=Ae+pe,t.forEach(Oe.selfEdges,function(Ue){_.addDummyNode(F,"selfedge",{width:Ue.label.width,height:Ue.label.height,rank:Oe.rank,order:Ae+ ++pe,e:Ue.e,label:Ue.label},"_se")}),delete Oe.selfEdges})})}function Y(F){t.forEach(F.nodes(),function(X){var J=F.node(X);if(J.dummy==="selfedge"){var pe=F.node(J.e.v),ye=pe.x+pe.width/2,Ae=pe.y,Oe=J.x-ye,Ue=pe.height/2;F.setEdge(J.e,J.label),F.removeNode(X),J.label.points=[{x:ye+2*Oe/3,y:Ae-Ue},{x:ye+5*Oe/6,y:Ae-Ue},{x:ye+Oe,y:Ae},{x:ye+5*Oe/6,y:Ae+Ue},{x:ye+2*Oe/3,y:Ae+Ue}],J.label.x=J.x,J.label.y=J.y}})}function le(F,X){return t.mapValues(t.pick(F,X),Number)}function ie(F){var X={};return t.forEach(F,function(J,pe){X[pe.toLowerCase()]=J}),X}return nb}var rb,ik;function E$(){if(ik)return rb;ik=1;var t=Et(),e=Ln(),n=Nr().Graph;rb={debugOrdering:r};function r(i){var s=e.buildLayerMatrix(i),o=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(i.nodes(),function(l){o.setNode(l,{label:l}),o.setParent(l,"layer"+i.node(l).rank)}),t.forEach(i.edges(),function(l){o.setEdge(l.v,l.w,{},l.name)}),t.forEach(s,function(l,u){var d="layer"+u;o.setNode(d,{rank:"same"}),t.reduce(l,function(h,m){return o.setEdge(h,m,{style:"invis"}),m})}),o}return rb}var ib,sk;function A$(){return sk||(sk=1,ib="0.8.5"),ib}var sb,ak;function R$(){return ak||(ak=1,sb={graphlib:Nr(),layout:S$(),debug:E$(),util:{time:Ln().time,notime:Ln().notime},version:A$()}),sb}var ok=R$();const C$={sample:8,root:6,other:5};function s0(t,e,n,r){return t.is_sample||Gl(t,n,r)?t.is_sample?e.sample:e.root:e.other}const $e={ROOT_NODE_STROKE_WIDTH:2,SAMPLE_NODE_STROKE_WIDTH:1,EDGE_STROKE_WIDTH:1,COLLISION_RADIUS:15,TOOLTIP_FONT_SIZE:"12px",PADDING_RATIO:.1,MAX_SIBLING_DISTANCE:50,FORCE_STRENGTH:{LINK_SIBLING:.9,LINK_SAMPLE:.8,LINK_DEFAULT:.3,CHARGE:-20,X_POSITION:.15,Y_POSITION:1,ALPHA_START:.8,ALPHA_DECAY:.05,VELOCITY_DECAY:.7},ZOOM:{MIN_SCALE:.1,MAX_SCALE:4,FOCUS_SCALE:1.5,GRAPH_FIT_SCALE_MIN:.2,GRAPH_FIT_SCALE_MAX:1.5,TRANSITION_DURATION:750,ALPHA_TARGET:.3},LAYOUT:{BOTTOM_MARGIN_RATIO:.15},PERFORMANCE:{ALPHA_THRESHOLD:.1}};function _o(t,e){const n=typeof t.source=="number"?e.find(i=>i.id===t.source)||null:t.source,r=typeof t.target=="number"?e.find(i=>i.id===t.target)||null:t.target;return{source:n,target:r}}function MO(t,e,n){const r=new Set,i=new Set,s=[t];for(;s.length>0;){const o=s.shift();if(i.has(o.id))continue;i.add(o.id),n.filter(u=>{const{source:d,target:h}=_o(u,e);return(d==null?void 0:d.id)===o.id&&h&&h.timeIndex>o.timeIndex}).forEach(u=>{const{target:d}=_o(u,e);d&&(d.is_sample?r.add(d):i.has(d.id)||s.push(d))})}return Array.from(r)}function Af(t,e,n){const r=MO(t,e,n);if(r.length===0)return null;const i=r.map(s=>s.x);return{min:Math.min(...i),max:Math.max(...i)}}function N$(t,e,n){const r=Af(t,e,n);r&&t.x!==void 0&&(t.x=Math.max(r.min,Math.min(r.max,t.x)))}function $f(t,e,n){const r=n.find(s=>{const{source:o,target:l}=_o(s,e);return(l==null?void 0:l.id)===t.id&&o&&o.timeIndex<t.timeIndex});if(!r)return null;const{source:i}=_o(r,e);return i}function lk(t,e,n){const r=$f(t,e,n);return r?e.filter(i=>{if(i.id===t.id||i.timeIndex<=r.timeIndex)return!1;const s=$f(i,e,n);return(s==null?void 0:s.id)===r.id}):[]}function ab(t,e,n,r,i,s,o=5){const l=Math.sqrt((t-n)**2+(e-r)**2),u=Math.sqrt((t-i)**2+(e-s)**2),d=Math.sqrt((i-n)**2+(s-r)**2);return Math.abs(l+u-d)<=o}function k$(t,e,n,r,i,s,o){const l=new Set(e.filter(m=>{const _=typeof m.source=="number"?m.source:m.source.id,y=typeof m.target=="number"?m.target:m.target.id;return _===t.id||y===t.id}).map(m=>`${typeof m.source=="number"?m.source:m.source.id}-${typeof m.target=="number"?m.target:m.target.id}`)),u=e.filter(m=>{const _=`${typeof m.source=="number"?m.source:m.source.id}-${typeof m.target=="number"?m.target:m.target.id}`;if(l.has(_))return!1;const y=typeof m.source=="number"?n.find(w=>w.id===m.source):m.source,T=typeof m.target=="number"?n.find(w=>w.id===m.target):m.target;return!y||!T?!1:ab(t.x,t.y,y.x,y.y,T.x,T.y,r*2)});if(u.length===0)return{x:t.x,y:t.y};const d=30,h=5;for(let m=h;m<=d;m+=h){const _=Math.min(t.x+m,s);let y=!1;for(const b of u){const S=typeof b.source=="number"?n.find(R=>R.id===b.source):b.source,A=typeof b.target=="number"?n.find(R=>R.id===b.target):b.target;if(ab(_,t.y,S.x,S.y,A.x,A.y,r*2)){y=!0;break}}if(!y)return{x:_,y:t.y};const T=Math.max(t.x-m,i);let w=!1;for(const b of u){const S=typeof b.source=="number"?n.find(R=>R.id===b.source):b.source,A=typeof b.target=="number"?n.find(R=>R.id===b.target):b.target;if(ab(T,t.y,S.x,S.y,A.x,A.y,r*2)){w=!0;break}}if(!w)return{x:T,y:t.y}}return{x:t.x,y:t.y}}function M$(t,e){return e.filter(n=>{const r=typeof n.source=="number"?n.source:n.source.id,i=typeof n.target=="number"?n.target:n.target.id;return r===t.id||i===t.id})}function I$(t,e,n){const r=ck(t,n),i=ck(e,n);if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}function ck(t,e){const n=new Set;return M$(t,e).forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id;i!==t.id&&n.add(i),s!==t.id&&n.add(s)}),n}function O$(t,e){const n=new Set,r=[],i=new Map;for(let o=0;o<t.length;o++){if(n.has(t[o].id))continue;const l=t[o];if(l.is_sample){r.push(l),i.set(l.id,l.id),n.add(l.id);continue}const u=P$(l,t,e,n,o),d=D$(l,u);r.push(d),u.forEach(h=>{i.set(h.id,d.id),n.add(h.id)})}const s=j$(e,i);return{nodes:r,edges:s}}function P$(t,e,n,r,i){const s=[t];for(let o=i+1;o<e.length;o++){const l=e[o];r.has(l.id)||l.is_sample||t.time===l.time&&I$(t,l,n)&&s.push(l)}return s}function D$(t,e){return e.length===1?t:{...t,is_combined:!0,combined_nodes:e.map(n=>n.id)}}function j$(t,e){const n=[];return t.forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id,o=e.get(i),l=e.get(s);o!==void 0&&l!==void 0&&n.push({...r,source:o,target:l})}),n}function Gl(t,e,n){const r=n.some(s=>{const{target:o}=_o(s,e);return(o==null?void 0:o.id)===t.id}),i=n.some(s=>{const{source:o}=_o(s,e);return(o==null?void 0:o.id)===t.id});return!r&&i}function L$(t,e,n,r,i){return(s,o,l)=>{if(s)if(l.length===0){const u=o.find(y=>y.id===s.id);if(!u)return;const d=u.x??0,m=r*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO)-u.timeIndex*i,_=$d.translate(n/2,r/2).scale($e.ZOOM.FOCUS_SCALE).translate(-d,-m);t.transition().duration($e.ZOOM.TRANSITION_DURATION).call(e.transform,_)}else{const u=o.filter(m=>m.x!==void 0&&m.timeIndex!==void 0);if(u.length===0)return;const d=B$(u,r,i),h=U$(d,n,r);t.transition().duration($e.ZOOM.TRANSITION_DURATION).call(e.transform,h)}}}function B$(t,e,n){const r=t.map(o=>o.x),i=e*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),s=t.map(o=>i-o.timeIndex*n);return{minX:Math.min(...r),maxX:Math.max(...r),minY:Math.min(...s),maxY:Math.max(...s)}}function U$(t,e,n){const r=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2,s=t.maxX-t.minX,o=t.maxY-t.minY,l=50,u=(e-2*l)/(s||1),d=(n-2*l)/(o||1),h=Math.min(Math.max($e.ZOOM.GRAPH_FIT_SCALE_MIN,Math.min(u,d)),$e.ZOOM.GRAPH_FIT_SCALE_MAX);return $d.translate(e/2,n/2).scale(h).translate(-r,-i)}function F$(t,e,n,r){const i=new Map;t.forEach(s=>{if(!s.is_sample){const o=Math.round(s.x*100)/100,l=i.get(o)||[];l.push(s),i.set(o,l)}}),i.forEach((s,o)=>{if(s.length>1){s.sort((l,u)=>l.y-u.y);for(let l=0;l<s.length;l++)for(let u=l+1;u<s.length;u++){const d=s[l],h=s[u];if(!e.some(_=>{const y=typeof _.source=="number"?_.source:_.source.id,T=typeof _.target=="number"?_.target:_.target.id;return y===d.id&&T===h.id||y===h.id&&T===d.id})){const T=((h.id*1e4+d.id)%1e3/1e3-.5)*15,w=Math.max(n,Math.min(r,h.x+T));h.x=w,h.fx=w}}}})}function lr(t,e,n,r){if(e.length<=1)return n/2;const i=e[0],s=e[e.length-1],o=s-i;let l;switch(r){case"log":const u=i===0?.1:i;l=(Math.log(t===0?.1:t)-Math.log(u))/(Math.log(s)-Math.log(u));break;case"linear":l=(t-i)/o;break;case"equal":default:l=e.indexOf(t)/(e.length-1);break}return n-l*n}function z$(t,e,n,r,i,s,o="equal"){const l=Array.from(new Set(t.map(y=>y.time))).sort((y,T)=>y-T),u=new Map(l.map((y,T)=>[y,T])),d=r*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h=d/(l.length-1||1),m=n*$e.PADDING_RATIO,_=n-2*m;if(t.forEach(y=>{y.timeIndex=u.get(y.time)??0}),i==="dagre"){console.log("Setting up dagre layout...");const y=new ok.graphlib.Graph;y.setGraph({rankdir:"TB",nodesep:50,ranksep:75,marginx:m,marginy:20,ranker:"network-simplex",acyclicer:"greedy",align:"UL"}),y.setDefaultEdgeLabel(()=>({})),t.forEach(I=>{y.setNode(I.id.toString(),{width:20,height:20,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:5})}),e.forEach(I=>{const N=typeof I.source=="number"?I.source:I.source.id,L=typeof I.target=="number"?I.target:I.target.id,$=t.find(q=>q.id===N),Z=t.find(q=>q.id===L);let V=1;$&&Z&&(($.is_sample||Z.is_sample)&&(V=3),Math.abs($.time-Z.time)===1&&(V+=1)),y.setEdge(N.toString(),L.toString(),{weight:V})}),ok.layout(y);const T=t.filter(I=>I.is_sample);let w=1/0,b=-1/0;T.forEach(I=>{const N=y.node(I.id.toString());N&&(w=Math.min(w,N.x),b=Math.max(b,N.x))});const S=100,A=b-w,E=Math.min(A,S*(T.length-1))/A;t.forEach(I=>{const N=y.node(I.id.toString());if(N){const L=(N.x-w)*E+w;I.x=L,I.y=N.y,I.fx=I.x,I.fy=I.y}}),F$(t,e,w,b);const C=new Set;let O=!0;const P=3;let k=0;for(;O&&k<P;){O=!1,k++;const I=t.filter(N=>!C.has(N.id)).sort((N,L)=>{const $=e.filter(V=>{const q=typeof V.source=="number"?V.source:V.source.id,z=typeof V.target=="number"?V.target:V.target.id;return q===N.id||z===N.id}).length;return e.filter(V=>{const q=typeof V.source=="number"?V.source:V.source.id,z=typeof V.target=="number"?V.target:V.target.id;return q===L.id||z===L.id}).length-$});for(const N of I){if(N.is_sample){C.add(N.id);continue}const L=s?s0(N,s,t,e):5,$=k$(N,e,t,L,w,b);($.x!==N.x||$.y!==N.y)&&(N.x=$.x,N.fx=$.x,N.y=$.y,N.fy=$.y,O=!0),C.add(N.id)}}console.log("Dagre layout complete. Node count:",t.length)}else{const y=t.filter(w=>w.is_sample),T=_/(y.length-1||1);y.sort((w,b)=>w.order_position!==void 0&&b.order_position!==void 0?w.order_position-b.order_position:w.order_position!==void 0?-1:b.order_position!==void 0?1:(b.degree??0)-(w.degree??0)),y.forEach((w,b)=>{w.x=m+b*T,w.fx=w.x,w.y=lr(w.time,l,d,o),w.fy=w.y}),t.filter(w=>!w.is_sample).forEach(w=>{w.fx=null,w.fy=null,w.y=lr(w.time,l,d,o)})}return{timeSpacing:h,uniqueTimes:l}}const $$=j.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,onEdgeClick:s,focalNode:o,nodeSizes:l=C$,sampleOrder:u="degree",edgeThickness:d=$e.EDGE_STROKE_WIDTH,temporalSpacingMode:h="equal"},m)=>{const{colors:_}=St(),y=j.useMemo(()=>t?`${t.nodes.length}-${t.edges.length}-${t.metadata.genomic_start||0}-${t.metadata.genomic_end||t.metadata.sequence_length}`:null,[t==null?void 0:t.nodes.length,t==null?void 0:t.edges.length,t==null?void 0:t.metadata.genomic_start,t==null?void 0:t.metadata.genomic_end,t==null?void 0:t.metadata.sequence_length]),T=j.useRef({data:null,key:null}),w=j.useMemo(()=>!t||!y?null:T.current.key===y&&T.current.data?T.current.data:(T.current={data:t,key:y},t),[t,y]);return j.useEffect(()=>{if(!m||typeof m=="function"||!m.current||!w)return;const b=m.current.getBoundingClientRect(),S=e||b.width||800,A=n||b.height||600,R=A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),{nodes:E,edges:C}=O$(w.nodes,w.edges);Array.from(new Set(E.map(G=>G.time))).sort((G,D)=>G-D),cr(m.current).selectAll("*").remove();const O=cr(m.current).attr("width",S).attr("height",A).attr("viewBox",[0,0,S,A]).attr("style","max-width: 100%; height: auto;"),P=O.append("g"),k=dz().scaleExtent([$e.ZOOM.MIN_SCALE,$e.ZOOM.MAX_SCALE]).on("zoom",G=>{P.attr("transform",G.transform)});O.call(k);const I=L$(O,k,S,A,0),{uniqueTimes:N}=z$(E,C,S,A,u,l,h);o&&I(o,E,C);const L=cr("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color",_.tooltipBackground).style("color",_.tooltipText).style("border",`1px solid ${_.border}`).style("padding","8px").style("border-radius","4px").style("font-size",$e.TOOLTIP_FONT_SIZE).style("pointer-events","none"),$=nz(E).alpha(u==="dagre"?0:$e.FORCE_STRENGTH.ALPHA_START).alphaDecay(u==="dagre"?1:$e.FORCE_STRENGTH.ALPHA_DECAY).velocityDecay(u==="dagre"?1:$e.FORCE_STRENGTH.VELOCITY_DECAY).force("link",u==="dagre"?null:Y5(C).id(G=>G.id).distance(50).strength(G=>{const D=typeof G.source=="number"?E.find(F=>F.id===G.source):G.source,Y=typeof G.target=="number"?E.find(F=>F.id===G.target):G.target,le=$f(D,E,C),ie=$f(Y,E,C);return le&&ie&&le.id===ie.id?$e.FORCE_STRENGTH.LINK_SIBLING:D!=null&&D.is_sample||Y!=null&&Y.is_sample?$e.FORCE_STRENGTH.LINK_SAMPLE:$e.FORCE_STRENGTH.LINK_DEFAULT})).force("charge",u==="dagre"?null:rz().strength($e.FORCE_STRENGTH.CHARGE)).force("x",u==="dagre"?null:iz(G=>{if(G.is_sample)return G.x;const D=Af(G,E,C),Y=lk(G,E,C);if(Y.length>0){const le=Y.reduce((ie,F)=>ie+(F.x??0),0)/Y.length;if(D){const ie=(le+(D.min+D.max)/2)/2;return Math.max(D.min,Math.min(D.max,ie))}return le}return D?(D.min+D.max)/2:G.x??S/2}).strength($e.FORCE_STRENGTH.X_POSITION)).force("y",sz(G=>lr(G.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)).strength(u==="dagre"?1:$e.FORCE_STRENGTH.Y_POSITION)).force("collision",u==="dagre"?null:W5().radius($e.COLLISION_RADIUS)),Z=P.append("g").selectAll("line").data(C).join("line").attr("stroke",`rgb(${_.edgeDefault[0]}, ${_.edgeDefault[1]}, ${_.edgeDefault[2]})`).attr("stroke-opacity",_.edgeDefault[3]/255).attr("stroke-width",d).attr("x1",G=>{const D=typeof G.source=="number"?E.find(Y=>Y.id===G.source):G.source;return(D==null?void 0:D.x)??0}).attr("y1",G=>{const D=typeof G.source=="number"?E.find(Y=>Y.id===G.source):G.source;return lr(D.time,N,R,h)}).attr("x2",G=>{const D=typeof G.target=="number"?E.find(Y=>Y.id===G.target):G.target;return(D==null?void 0:D.x)??0}).attr("y2",G=>{const D=typeof G.target=="number"?E.find(Y=>Y.id===G.target):G.target;return lr(D.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).on("click",(G,D)=>s==null?void 0:s(D));function V(G){G.active||$.alphaTarget($e.ZOOM.ALPHA_TARGET).restart(),G.subject.fx=G.subject.x,G.subject.fy=lr(G.subject.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function q(G){if(!w)return;const D=Af(G.subject,E,C),Y=lk(G.subject,E,C);let le=G.x;if(D)le=Math.max(D.min,Math.min(D.max,le));else{const ie=S*$e.PADDING_RATIO;le=Math.max(ie,Math.min(S-ie,le))}if(Y.length>0){const ie=Y.reduce((F,X)=>F+(X.x??0),0)/Y.length;le=Math.max(ie-$e.MAX_SIBLING_DISTANCE,Math.min(ie+$e.MAX_SIBLING_DISTANCE,le))}G.subject.fx=le,G.subject.fy=lr(G.subject.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function z(G){G.active||$.alphaTarget(0),G.subject.fx=null;const D=Af(G.subject,E,C);let Y=G.subject.x??0;if(D)Y=Math.max(D.min,Math.min(D.max,Y));else{const le=S*$e.PADDING_RATIO;Y=Math.max(le,Math.min(S-le,Y))}G.subject.x=Y,G.subject.fy=lr(G.subject.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}const Q=P.append("g").selectAll("circle").data(E).join("circle").attr("r",G=>s0(G,l,E,C)).attr("fill",G=>G.is_sample?`rgb(${_.nodeSample[0]}, ${_.nodeSample[1]}, ${_.nodeSample[2]})`:G.is_combined?`rgb(${_.nodeCombined[0]}, ${_.nodeCombined[1]}, ${_.nodeCombined[2]})`:Gl(G,E,C)?`rgb(${_.nodeRoot[0]}, ${_.nodeRoot[1]}, ${_.nodeRoot[2]})`:`rgb(${_.nodeDefault[0]}, ${_.nodeDefault[1]}, ${_.nodeDefault[2]})`).attr("stroke",G=>Gl(G,E,C)?`rgb(${_.nodeSelected[0]}, ${_.nodeSelected[1]}, ${_.nodeSelected[2]})`:G.is_sample?_.background:"none").attr("stroke-width",G=>Gl(G,E,C)?$e.ROOT_NODE_STROKE_WIDTH:G.is_sample?$e.SAMPLE_NODE_STROKE_WIDTH:0).style("cursor","pointer").call(VF().on("start",V).on("drag",q).on("end",z)).on("click",(G,D)=>{G.preventDefault(),r==null||r(D)}).on("contextmenu",(G,D)=>{G.preventDefault(),i==null||i(D)}).on("mouseover",(G,D)=>{var le;let Y="";if(D.is_sample)Y=`Sample node ${D.id}<br>Time: ${D.time}`;else if(D.is_combined)Y=`Combined node ${D.id}<br>Contains nodes: ${(le=D.combined_nodes)==null?void 0:le.join(", ")}<br>Time: ${D.time}`;else if(Gl(D,E,C)){const ie=[...new Set(C.filter(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return(J==null?void 0:J.id)===D.id}).map(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J),F=MO(D,E,C).map(X=>X.id).sort((X,J)=>X-J);Y=`Root node ${D.id}<br>Time: ${D.time}`,ie.length>0&&(Y+=`<br>Children: ${ie.join(", ")}`),F.length>0&&(Y+=`<br>Descendant samples: ${F.join(", ")}`)}else{const ie=[...new Set(C.filter(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return(J==null?void 0:J.id)===D.id}).map(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J),F=[...new Set(C.filter(X=>{const J=typeof X.source=="number"?E.find(pe=>pe.id===X.source):X.source;return(J==null?void 0:J.id)===D.id}).map(X=>{const J=typeof X.target=="number"?E.find(pe=>pe.id===X.target):X.target;return J==null?void 0:J.id}).filter(X=>X!==void 0))].sort((X,J)=>X-J);Y=`Internal node ${D.id}<br>Time: ${D.time}`,ie.length>0&&(Y+=`<br>Parents: ${ie.join(", ")}`),F.length>0&&(Y+=`<br>Children: ${F.join(", ")}`)}if(D.individual!==void 0&&D.individual!==-1&&(Y+=`<br>Individual: ${D.individual}`),D.location){const ie=D.location,F=ie.x>=-180&&ie.x<=180&&ie.y>=-90&&ie.y<=90&&(ie.x!==0||ie.y!==0);ie.z!==void 0?F?Y+=`<br>Location: Lat: ${ie.y.toFixed(3)}°, Lon: ${ie.x.toFixed(3)}°, Z: ${ie.z.toFixed(2)}`:Y+=`<br>Location: (${ie.x.toFixed(2)}, ${ie.y.toFixed(2)}, ${ie.z.toFixed(2)})`:F?Y+=`<br>Location: Lat: ${ie.y.toFixed(3)}°, Lon: ${ie.x.toFixed(3)}°`:Y+=`<br>Location: (${ie.x.toFixed(2)}, ${ie.y.toFixed(2)})`}L.style("visibility","visible").html(Y).style("left",G.pageX+10+"px").style("top",G.pageY-10+"px")}).on("mousemove",G=>{L.style("left",G.pageX+10+"px").style("top",G.pageY-10+"px")}).on("mouseout",()=>{L.style("visibility","hidden")}),oe=P.append("g").selectAll("text").data(E.filter(G=>G.is_sample)).join("text").text(G=>G.id.toString()).attr("font-size",G=>`${l.sample*1.2}px`).attr("fill",_.text).attr("text-anchor","middle").attr("dx",0).attr("dy",G=>s0(G,l,E,C)+12);return $.on("tick",()=>{w&&($.alpha()>$e.PERFORMANCE.ALPHA_THRESHOLD&&E.forEach(G=>{G.is_sample||N$(G,E,C)}),Z.attr("x1",G=>{const D=typeof G.source=="number"?E.find(Y=>Y.id===G.source):G.source;return(D==null?void 0:D.x)??0}).attr("y1",G=>{const D=typeof G.source=="number"?E.find(Y=>Y.id===G.source):G.source;return lr(D.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).attr("x2",G=>{const D=typeof G.target=="number"?E.find(Y=>Y.id===G.target):G.target;return(D==null?void 0:D.x)??0}).attr("y2",G=>{const D=typeof G.target=="number"?E.find(Y=>Y.id===G.target):G.target;return lr(D.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)}),Q.attr("cx",G=>G.x??0).attr("cy",G=>lr(G.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)),oe.attr("x",G=>G.x??0).attr("y",G=>lr(G.time,N,A*(1-$e.LAYOUT.BOTTOM_MARGIN_RATIO),h)))}),()=>{$&&$.stop(),L&&L.remove()}},[w,e,n,r,i,s,o,l,m,u,d,h]),g.jsx("div",{className:"w-full h-full",children:g.jsx("svg",{ref:m,className:"w-full h-full"})})}),q$=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,genomicRange:o,sequenceLength:l,isFiltered:u=!1,isFilterSectionCollapsed:d=!0})=>{const{colors:h}=St(),[m,_]=j.useState(!0),y=t&&n?(n/t*100).toFixed(1):null,T=e&&r?(r/e*100).toFixed(1):null;if(!(t||n||i))return null;const b=S=>S>=1e6?`${(S/1e6).toFixed(1)}M`:S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toString();return g.jsxs("div",{className:"absolute top-4 right-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${h.background}F0`,borderColor:h.border,color:h.text},children:[g.jsxs("div",{onClick:()=>_(!m),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:m?"transparent":`${h.containerBackground}80`},onMouseEnter:S=>{m||(S.currentTarget.style.backgroundColor=`${h.border}40`)},onMouseLeave:S=>{m||(S.currentTarget.style.backgroundColor=`${h.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:h.text},children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${m?"rotate-180":""}`,style:{color:h.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Graph Statistics"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Original ARG:"}),g.jsxs("span",{style:{color:h.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"SubARG:"}),g.jsxs("span",{style:{color:h.text},children:[n.toLocaleString()," nodes (",y,"%), ",r.toLocaleString()," edges (",T,"%)"]})]}),i&&s&&(i!==n||s!==r)&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Displayed:"}),g.jsxs("span",{style:{color:h.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Reduction:"}),g.jsxs("span",{style:{color:h.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),u&&o&&l&&g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Filter Information"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Range:"}),g.jsxs("span",{style:{color:h.text},children:[b(o[0])," - ",b(o[1])]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Length:"}),g.jsxs("span",{style:{color:h.text},children:[b(o[1]-o[0])," bp"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:h.accentPrimary},children:"Coverage:"}),g.jsxs("span",{style:{color:h.text},children:[((o[1]-o[0])/l*100).toFixed(1),"% of sequence"]})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"View Controls"}),g.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${h.text}CC`},children:[g.jsx("div",{children:"• Drag: Pan view"}),g.jsx("div",{children:"• Scroll: Zoom in/out"}),g.jsx("div",{children:"• Left click: Select node"}),g.jsx("div",{children:"• Right click: Show ancestors"}),g.jsx("div",{children:"• Drag nodes to reposition"})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Node Types"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]})`,borderColor:h.background,borderWidth:"0.5px"}}),g.jsx("span",{style:{color:h.text},children:"Sample Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]})`}}),g.jsx("span",{style:{color:h.text},children:"Internal Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeCombined[0]}, ${h.nodeCombined[1]}, ${h.nodeCombined[2]})`}}),g.jsx("span",{style:{color:h.text},children:"Combined Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]})`,borderColor:`rgb(${h.nodeSelected[0]}, ${h.nodeSelected[1]}, ${h.nodeSelected[2]})`}}),g.jsx("span",{style:{color:h.text},children:"Root Nodes"})]})]})]})]})]})},V$=[{value:"degree",label:"Degree",description:"Order by node connectivity (current default)"},{value:"center_minlex",label:"Center Tree",description:"Minlex postorder of tree at center genomic position"},{value:"first_tree",label:"First Tree",description:"Minlex postorder of first tree"},{value:"custom",label:"Consensus",description:"Majority vote across multiple trees"},{value:"numeric",label:"Numeric",description:"Simple numeric order (0, 1, 2, ...)"},{value:"dagre",label:"Layer-based",description:"Order nodes in each layer using dagre-d3 algorithm"}],H$=({value:t,onChange:e,className:n=""})=>{const{colors:r}=St();return g.jsxs("div",{className:`flex items-center gap-2 ${n}`,children:[g.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Sample Order:"}),g.jsx("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:V$.map(i=>g.jsx("button",{onClick:()=>e(i.value),className:"px-3 py-1 text-xs font-medium transition-colors whitespace-nowrap",style:{backgroundColor:t===i.value?r.textSecondary:r.containerBackground,color:t===i.value?r.background:r.text},title:i.description,children:i.label},i.value))})]})},W$=({sampleOrder:t,onSampleOrderChange:e,nodeSizes:n,onNodeSizeChange:r,edgeThickness:i,onEdgeThicknessChange:s,temporalSpacing:o,onTemporalSpacingChange:l,temporalSpacingMode:u,onTemporalSpacingModeChange:d,isLoading:h=!1})=>{const{colors:m}=St(),[_,y]=j.useState(!0);return g.jsxs("div",{className:"absolute top-4 left-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${m.background}F0`,borderColor:m.border,color:m.text},children:[g.jsxs("div",{onClick:()=>y(!_),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:_?"transparent":`${m.containerBackground}80`},onMouseEnter:T=>{_||(T.currentTarget.style.backgroundColor=`${m.border}40`)},onMouseLeave:T=>{_||(T.currentTarget.style.backgroundColor=`${m.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:m.text},children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),"Graph Controls"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${_?"rotate-180":""}`,style:{color:m.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:m.text},children:"Temporal Spacing"}),g.jsxs("div",{className:"flex gap-2",children:[g.jsx("button",{onClick:()=>d("equal"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="equal"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="equal"?m.accentPrimary:`${m.border}40`,color:u==="equal"?m.background:m.text},children:"Equal"}),g.jsx("button",{onClick:()=>d("log"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="log"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="log"?m.accentPrimary:`${m.border}40`,color:u==="log"?m.background:m.text},children:"Log"}),g.jsx("button",{onClick:()=>d("linear"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="linear"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="linear"?m.accentPrimary:`${m.border}40`,color:u==="linear"?m.background:m.text},children:"Linear"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"flex items-center justify-between",children:g.jsxs("label",{className:"text-xs font-medium",style:{color:m.text},children:["Spacing: ",o]})}),g.jsx("input",{type:"range",min:5,max:50,step:1,value:o,onChange:T=>l(Number(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${m.accentPrimary} 0%, ${m.accentPrimary} ${(o-5)/45*100}%, ${m.border} ${(o-5)/45*100}%, ${m.border} 100%)`,accentColor:m.accentPrimary}})]}),g.jsxs("div",{className:"text-xs",style:{color:`${m.text}CC`},children:[u==="equal"&&g.jsx("div",{children:"• Time points are spaced equally"}),u==="log"&&g.jsx("div",{children:"• Time points are spaced logarithmically based on their actual values"}),u==="linear"&&g.jsx("div",{children:"• Time points are spaced according to their actual time values"})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:m.text},children:"Sample Order"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx(H$,{value:t,onChange:e}),h&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:m.accentPrimary}}),g.jsx("span",{className:"text-xs",style:{color:m.text},children:"Updating sample order..."})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:m.text},children:"Node Sizes"}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"space-y-1",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("label",{className:"text-xs font-medium",style:{color:m.text},children:"Sample Nodes"}),g.jsxs("span",{className:"text-xs",style:{color:m.text},children:[n.sample,"px"]})]}),g.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.sample,onChange:T=>r({...n,sample:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${m.accentPrimary} 0%, ${m.accentPrimary} ${(n.sample-3)/12*100}%, ${m.border} ${(n.sample-3)/12*100}%, ${m.border} 100%)`,accentColor:m.accentPrimary}})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("label",{className:"text-xs font-medium",style:{color:m.text},children:"Root Nodes"}),g.jsxs("span",{className:"text-xs",style:{color:m.text},children:[n.root,"px"]})]}),g.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.root,onChange:T=>r({...n,root:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${m.accentPrimary} 0%, ${m.accentPrimary} ${(n.root-3)/12*100}%, ${m.border} ${(n.root-3)/12*100}%, ${m.border} 100%)`,accentColor:m.accentPrimary}})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("label",{className:"text-xs font-medium",style:{color:m.text},children:"Internal & Combined"}),g.jsxs("span",{className:"text-xs",style:{color:m.text},children:[n.other,"px"]})]}),g.jsx("input",{type:"range",min:"2",max:"10",step:"1",value:n.other,onChange:T=>r({...n,other:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${m.accentPrimary} 0%, ${m.accentPrimary} ${(n.other-2)/8*100}%, ${m.border} ${(n.other-2)/8*100}%, ${m.border} 100%)`,accentColor:m.accentPrimary}})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:m.text},children:"Edge Thickness"}),g.jsxs("div",{className:"space-y-1",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("label",{className:"text-xs font-medium",style:{color:m.text},children:"Edge Width"}),g.jsxs("span",{className:"text-xs",style:{color:m.text},children:[i,"px"]})]}),g.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:i,onChange:T=>s(parseFloat(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${m.accentPrimary} 0%, ${m.accentPrimary} ${(i-.5)/2.5*100}%, ${m.border} ${(i-.5)/2.5*100}%, ${m.border} 100%)`,accentColor:m.accentPrimary}})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:m.text},children:"Graph Layout"}),g.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${m.text}CC`},children:[g.jsx("div",{children:"• Sample nodes are positioned based on the selected order"}),g.jsx("div",{children:"• Internal nodes position themselves relative to descendants"}),g.jsx("div",{children:"• Drag nodes to manually adjust positions"}),g.jsx("div",{children:"• Use zoom and pan to navigate the graph"})]})]})]})]})},IO=({min:t,max:e,step:n=1,value:r,onChange:i,formatValue:s=l=>l.toString(),className:o=""})=>{const{colors:l}=St(),[u,d]=j.useState(null),[h,m]=j.useState({x:0,startValue:[0,0]}),[_,y]=j.useState(!1),[T,w]=j.useState(null),b=j.useRef(null);j.useEffect(()=>{const k=N=>{if(N.key==="Shift"){if(y(!0),T===null){const L=Math.abs(r[1]-r[0]);w(Math.max(L,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},I=N=>{N.key==="Shift"&&(y(!1),w(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",k),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",k),document.removeEventListener("keyup",I),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,T,n]);const S=j.useCallback(k=>{if(!b.current)return t;const I=b.current.getBoundingClientRect(),N=Math.max(0,Math.min(1,(k-I.left)/I.width)),L=t+N*(e-t);return Math.round(L/n)*n},[t,e,n]),A=j.useCallback(k=>(k-t)/(e-t)*100,[t,e]),R=j.useCallback((k,I)=>{k.preventDefault(),k.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",d(I),m({x:k.clientX,startValue:r})},[r]),E=j.useCallback(k=>{if(!u||!b.current)return;const I=S(k.clientX),[N,L]=r;if(u==="left"){const $=Math.min(I,L-n);i([Math.max(t,$),L])}else if(u==="right"){const $=Math.max(I,N+n);i([N,Math.min(e,$)])}else if(u==="range"){const $=k.clientX-h.x,Z=b.current.getBoundingClientRect(),V=$/Z.width*(e-t),[q,z]=h.startValue;let Q=Math.abs(z-q);_&&T!==null&&(Q=T);const G=(q+z)/2+V;let D,Y;_&&T!==null?(D=G-Q/2,Y=G+Q/2):(D=q+V,Y=z+V),D<t&&(D=t,Y=t+Q),Y>e&&(Y=e,D=e-Q),i([Math.round(D/n)*n,Math.round(Y/n)*n])}},[u,r,i,S,t,e,n,h,_,T]),C=j.useCallback(()=>{d(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);j.useEffect(()=>{if(u)return document.addEventListener("mousemove",E),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",C)}},[u,E,C]);const O=A(r[0]),P=A(r[1]);return g.jsxs("div",{className:`relative w-full ${o}`,style:{userSelect:"none"},children:[g.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:l.text},children:[g.jsx("span",{children:s(r[0])}),g.jsx("span",{children:s(r[1])})]}),g.jsxs("div",{ref:b,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:l.containerBackground},onMouseDown:k=>{const I=S(k.clientX),[N,L]=r,$=Math.abs(I-N),Z=Math.abs(I-L);_||Math.abs(L-N)<n*2?R(k,"range"):$<Z?R(k,"left"):R(k,"right")},children:[g.jsx("div",{className:`absolute h-full rounded-full transition-opacity ${_?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{left:`${O}%`,width:`${P-O}%`,backgroundColor:_?l.text:l.textSecondary,opacity:_?.8:1,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"range")}}),g.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${O}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"left")}}),g.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${P}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:k=>{k.preventDefault(),k.stopPropagation(),R(k,"right")}})]}),g.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs",style:{color:l.text},children:[g.jsx("span",{children:s(t)}),g.jsx("div",{className:"flex items-center justify-center",children:_&&g.jsx("div",{className:"px-2 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:l.textSecondary,color:l.background,fontSize:"10px"},children:"Fixed Size"})}),g.jsx("span",{children:s(e)})]})]})},OO=({treeIntervals:t,value:e,onChange:n,className:r=""})=>{const{colors:i}=St(),[s,o]=j.useState(null),[l,u]=j.useState({x:0,startValue:[0,0]}),d=j.useRef(null);if(!t||t.length===0)return null;const h=0,m=t.length-1,_=t[m].right-t[0].left,y=j.useCallback(P=>{if(!d.current)return h;const k=d.current.getBoundingClientRect(),I=Math.max(0,Math.min(1,(P-k.left)/k.width)),N=t[0].left+I*_;for(let L=0;L<t.length;L++){const $=t[L],Z=($.left+$.right)/2;if(L===t.length-1||N<=Z)return L}return m},[t,_]),T=j.useCallback(P=>{if(P<0||P>=t.length)return 0;const k=t[P];return((k.left+k.right)/2-t[0].left)/_*100},[t,_]),w=j.useCallback(P=>{if(P<0||P>=t.length)return"Invalid";const k=t[P];return`Tree ${P} (${k.left.toFixed(1)}-${k.right.toFixed(1)})`},[t]),b=j.useCallback((P,k)=>{if(P<0||k>=t.length||P>k)return"Invalid range";const I=t[P].left,N=t[k].right,L=N-I;return`${(Z=>Z>=1e6?`${(Z/1e6).toFixed(1)}M`:Z>=1e3?`${(Z/1e3).toFixed(1)}K`:Z.toFixed(1))(L)} bp (${I.toFixed(1)}-${N.toFixed(1)})`},[t]),S=j.useCallback((P,k)=>{P.preventDefault(),o(k),u({x:P.clientX,startValue:e})},[e]),A=j.useCallback(P=>{if(!s||!d.current)return;const k=y(P.clientX),[I,N]=e;if(s==="left")k<=N?n([Math.max(h,Math.min(m,k)),N]):n([N,Math.max(h,Math.min(m,k))]);else if(s==="right")k>=I?n([I,Math.max(h,Math.min(m,k))]):n([Math.max(h,Math.min(m,k)),I]);else if(s==="range"){const L=P.clientX-l.x,$=d.current.getBoundingClientRect(),V=L/$.width*_,[q,z]=l.startValue,Q=(t[q].left+t[q].right)/2,oe=(t[z].left+t[z].right)/2,G=Q+V,D=oe+V;let Y=q,le=z;for(let F=0;F<t.length;F++){const X=(t[F].left+t[F].right)/2;if(G<=X||F===t.length-1){Y=F;break}}for(let F=0;F<t.length;F++){const X=(t[F].left+t[F].right)/2;if(D<=X||F===t.length-1){le=F;break}}Y=Math.max(h,Math.min(m,Y)),le=Math.max(h,Math.min(m,le));const ie=z-q;Y!==le&&Math.abs(le-Y)!==ie&&(Y+ie<=m?le=Y+ie:le-ie>=h&&(Y=le-ie)),n([Y,le])}},[s,e,n,y,h,m,l,_,t]),R=j.useCallback(()=>{o(null)},[]);j.useEffect(()=>{if(s)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R)}},[s,A,R]);const E=T(e[0]),C=T(e[1]),O=e[1]-e[0]+1;return g.jsxs("div",{className:`relative w-full ${r}`,children:[g.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:i.text},children:[g.jsx("span",{children:w(e[0])}),g.jsx("span",{children:w(e[1])})]}),g.jsxs("div",{ref:d,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:i.containerBackground},onMouseDown:P=>{const k=y(P.clientX),[I,N]=e,L=Math.abs(k-I),$=Math.abs(k-N);L<$?S(P,"left"):S(P,"right")},children:[g.jsx("div",{className:"absolute h-full rounded-full cursor-grab active:cursor-grabbing",style:{left:`${E}%`,width:`${C-E}%`,backgroundColor:i.textSecondary},onMouseDown:P=>S(P,"range")}),g.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${E}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:P=>S(P,"left")}),g.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${C}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:P=>S(P,"right")})]}),g.jsxs("div",{className:"flex justify-between mt-1 text-xs",style:{color:i.text},children:[g.jsx("span",{children:"Tree 0"}),g.jsxs("div",{className:"text-center",children:[g.jsxs("div",{children:[O," tree",O!==1?"s":""," selected"]}),g.jsx("div",{style:{color:i.textSecondary},children:b(e[0],e[1])})]}),g.jsxs("span",{children:["Tree ",m]})]})]})},X$=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u===o&&!i.has(d)&&(r.add(d),s.push(d))}))}return r},Y$=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id;(typeof l.target=="number"?l.target:l.target.id)===o&&!i.has(u)&&(r.add(u),s.push(u))}))}return r},G$=1,K$={nodeSizes:{sample:8,root:6,other:5},edgeThickness:1,temporalSpacingMode:"equal"},Z$=j.forwardRef(({filename:t,max_samples:e=25},n)=>{var vr,Ft,zt,kn,yr,Qn;const{colors:r}=St(),{treeSequence:i}=Qs(),[s,o]=j.useState(null),[l,u]=j.useState(null),[d,h]=j.useState(null),[m,_]=j.useState(!0),[y,T]=j.useState("full"),[w,b]=j.useState(null),[S,A]=j.useState([0,0]),[R,E]=j.useState(0),[C,O]=j.useState(!1),[P,k]=j.useState([0,0]),[I,N]=j.useState(!1),[L,$]=j.useState(!1),[Z,V]=j.useState("genomic"),[q,z]=j.useState([0,0]),[Q,oe]=j.useState([0,0]),[G,D]=j.useState(!1),[Y,le]=j.useState([]),[ie,F]=j.useState(!1),[X,J]=j.useState("degree"),[pe,ye]=j.useState(!0),[Ae,Oe]=j.useState({sample:8,root:6,other:5}),[Ue,Ee]=j.useState(G$),[Te,Ne]=j.useState(!1),[Pe,Kt]=j.useState(K$),[Me,nn]=j.useState(!1),Mt=j.useCallback(we=>we.map(([lt,Ct,it])=>({index:lt,left:Ct,right:it})),[]);j.useEffect(()=>{ie&&Z==="genomic"&&N(!0);const we=setTimeout(()=>{k(S),N(!1)},500);return()=>clearTimeout(we)},[S,ie,Z]),j.useEffect(()=>{ie&&Z==="tree"&&D(!0);const we=setTimeout(()=>{oe(q),D(!1)},500);return()=>clearTimeout(we)},[q,ie,Z]),j.useEffect(()=>{const we=async()=>{try{_(!0),console.log("Fetching initial graph data for file:",t,"with max_samples:",e);const Ct=(await tt.getGraphData(t,{maxSamples:e,sampleOrder:X})).data;if(console.log("Received initial graph data:",Ct),Ct.metadata.sequence_length){E(Ct.metadata.sequence_length);const it=[0,Ct.metadata.sequence_length];A(it),k(it)}if(Ct.metadata.tree_intervals&&Ct.metadata.tree_intervals.length>0){const it=Mt(Ct.metadata.tree_intervals);le(it);const bt=[0,it.length-1];z(bt),oe(bt)}$(!0),o(Ct),u(Ct),h(null)}catch(lt){console.error("Error fetching initial graph data:",lt),h(lt instanceof Error?lt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}};$(!1),F(!1),we()},[t,e,Mt]),j.useEffect(()=>{if(!L)return;let we=!1,lt=null,Ct=null;if(ie&&(Z==="genomic"?P[0]===0&&P[1]===R||(we=!0,lt={genomic_start:P[0],genomic_end:P[1]}):Z==="tree"&&!(Q[0]===0&&Q[1]===Y.length-1)&&Y.length>0&&(we=!0,Ct={tree_start_idx:Q[0],tree_end_idx:Q[1]})),!we)if(!s||s.metadata.sample_order!==X)we=!0,console.log("Making API call due to sample order change");else{console.log("Skipping API call - using existing data (full range or filter disabled)");return}(async()=>{try{_(!0);let bt={maxSamples:e,sampleOrder:X};lt?(console.log("Fetching filtered graph data for genomic range:",P),bt.genomicStart=lt.genomic_start,bt.genomicEnd=lt.genomic_end):Ct?(console.log("Fetching filtered graph data for tree range:",Q),bt.treeStartIdx=Ct.tree_start_idx,bt.treeEndIdx=Ct.tree_end_idx):console.log("Fetching unfiltered graph data");const Bo=(await tt.getGraphData(t,bt)).data;console.log("Received graph data:",Bo),o(Bo),h(null)}catch(bt){console.error("Error fetching graph data:",bt),h(bt instanceof Error?bt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}})()},[t,e,P,Q,ie,Z,L,R,Y,X]),j.useEffect(()=>{ie||ye(!0)},[ie]);const Rt=()=>{if(!s||!w)return s;switch(y){case"subgraph":{const we=X$(w,s.nodes,s.edges);we.add(w.id);const lt=s.nodes.filter(it=>we.has(it.id)),Ct=s.edges.filter(it=>{const bt=typeof it.source=="number"?it.source:it.source.id,oa=typeof it.target=="number"?it.target:it.target.id;return we.has(bt)&&we.has(oa)});return{...s,nodes:lt,edges:Ct,metadata:{...s.metadata,is_subset:!0}}}case"ancestors":{const we=Y$(w,s.nodes,s.edges);we.add(w.id);const lt=s.nodes.filter(it=>we.has(it.id)),Ct=s.edges.filter(it=>{const bt=typeof it.source=="number"?it.source:it.source.id,oa=typeof it.target=="number"?it.target:it.target.id;return we.has(bt)&&we.has(oa)});return{...s,nodes:lt,edges:Ct,metadata:{...s.metadata,is_subset:!0}}}default:return s}},Ke=()=>{if(!l||!s||!i)return null;const we=Rt();return we?{originalNodes:s.metadata.original_num_nodes||i.num_nodes,originalEdges:s.metadata.original_num_edges||i.num_edges,subArgNodes:l.nodes.length,subArgEdges:l.edges.length,displayedNodes:we.nodes.length,displayedEdges:we.edges.length}:null},rn=we=>{y==="full"?(b(we),T("subgraph")):(w==null?void 0:w.id)===we.id?(T("full"),b(null)):(b(we),T("subgraph"))},Ye=we=>{b(we),T("ancestors")},be=we=>{console.log("Edge clicked:",we)},ke=()=>{T("full"),b(null)},rt=j.useCallback(we=>{(we[0]!==S[0]||we[1]!==S[1])&&A(we)},[S]),He=j.useCallback(we=>{(we[0]!==q[0]||we[1]!==q[1])&&z(we)},[q]),Qe=j.useCallback(()=>{const we=!ie;if(F(we),we){if(Z==="genomic")A([0,R]),k([0,R]);else if(Z==="tree"&&Y.length>0){const lt=[0,Y.length-1];z(lt),oe(lt)}ye(!1)}else ye(!0)},[ie,Z,R,Y]),xt=j.useCallback(we=>{if(V(we),we==="genomic")A([0,R]),k([0,R]);else if(we==="tree"&&Y.length>0){const lt=[0,Y.length-1];z(lt),oe(lt)}},[R,Y]),gn=j.useCallback(we=>we>=1e6?`${(we/1e6).toFixed(1)}M`:we>=1e3?`${(we/1e3).toFixed(1)}K`:we.toString(),[]),Kr=()=>{let we="";switch(y){case"subgraph":we=`SubARG at Root ${w==null?void 0:w.id}`;break;case"ancestors":we=`Parent ARG of Node ${w==null?void 0:w.id}`;break;default:we="Full ARG"}return ie&&(s==null?void 0:s.metadata.genomic_start)!==void 0&&(s==null?void 0:s.metadata.genomic_end)!==void 0&&(we+=` (${gn(s.metadata.genomic_start)} - ${gn(s.metadata.genomic_end)})`),we};return m?g.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:r.accentPrimary}}),g.jsx("p",{style:{color:r.text},children:"Loading force-directed ARG visualization..."})]})}):d?g.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:g.jsxs("div",{className:"text-center",style:{color:r.text},children:[g.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),g.jsx("p",{className:"text-sm",style:{color:`${r.text}B3`},children:d})]})}):g.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:r.background},children:[g.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:g.jsx("div",{className:"px-4 py-2",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("div",{className:"flex flex-col gap-2",children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("h2",{className:"text-lg font-semibold",style:{color:r.headerText},children:Kr()}),(R>0||Y.length>0)&&g.jsx("div",{className:"flex items-center gap-4",children:R>0&&g.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:r.headerText},children:[g.jsx("input",{type:"checkbox",checked:ie,onChange:Qe,className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:r.accentPrimary}}),"Filter Genomic Range"]})}),y!=="full"&&g.jsx("button",{onClick:ke,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:r.containerBackground,color:r.text,borderColor:`${r.accentPrimary}33`},onMouseEnter:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}66`,we.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}33`,we.currentTarget.style.backgroundColor=r.containerBackground},children:"Return to Full ARG"})]})}),g.jsxs("div",{className:"flex items-center gap-6",children:[ie&&g.jsxs("button",{onClick:()=>ye(!pe),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:r.accentPrimary,color:r.background},onMouseEnter:we=>{we.currentTarget.style.opacity="0.8"},onMouseLeave:we=>{we.currentTarget.style.opacity="1"},children:[g.jsx("span",{children:pe?"Show Controls":"Hide Controls"}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:r.headerText},children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${r.nodeSample[0]}, ${r.nodeSample[1]}, ${r.nodeSample[2]})`,borderColor:r.background,borderWidth:"0.5px"}}),g.jsx("span",{children:"Sample"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeDefault[0]}, ${r.nodeDefault[1]}, ${r.nodeDefault[2]})`}}),g.jsx("span",{children:"Internal"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeCombined[0]}, ${r.nodeCombined[1]}, ${r.nodeCombined[2]})`}}),g.jsx("span",{children:"Combined"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${r.nodeRoot[0]}, ${r.nodeRoot[1]}, ${r.nodeRoot[2]})`,borderColor:`rgb(${r.nodeSelected[0]}, ${r.nodeSelected[1]}, ${r.nodeSelected[2]})`}}),g.jsx("span",{children:"Root"})]})]}),g.jsx("div",{className:"text-xs border-l pl-4",style:{color:r.headerText,borderLeftColor:r.border},children:"Left click: Subgraph • Right click: Ancestors"})]})]})})}),ie&&g.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:!pe&&g.jsx("div",{className:"px-4 py-3",children:g.jsxs("div",{className:"flex items-start justify-between gap-6",children:[g.jsx("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:Y.length>0&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Genomic Mode:"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:[g.jsx("button",{onClick:()=>xt("genomic"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="genomic"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="genomic"?r.accentPrimary:r.containerBackground,color:Z==="genomic"?r.background:r.text},children:"Genomic"}),g.jsx("button",{onClick:()=>xt("tree"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="tree"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="tree"?r.accentPrimary:r.containerBackground,color:Z==="tree"?r.background:r.text},children:"Tree Index"})]})]})}),g.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[g.jsx("div",{className:"flex-1 max-w-md min-w-0",children:Z==="genomic"&&R>0?g.jsx(IO,{min:0,max:R,step:Math.max(1,Math.floor(R/1e3)),value:S,onChange:rt,formatValue:gn,className:"w-full"}):Z==="tree"&&Y.length>0?g.jsx(OO,{treeIntervals:Y,value:q,onChange:He,className:"w-full"}):null}),g.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:r.text},children:[Z==="genomic"?g.jsxs("span",{children:[gn(S[1]-S[0])," bp (",((S[1]-S[0])/R*100).toFixed(1),"%)",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&g.jsxs(g.Fragment,{children:[" • ",s.metadata.num_local_trees," trees"]})]}):Z==="tree"&&Y.length>0?g.jsxs("span",{children:["Trees ",q[0],"-",q[1]," (",q[1]-q[0]+1," of ",Y.length,")",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&g.jsxs(g.Fragment,{children:[" • ",s.metadata.expected_tree_count??s.metadata.num_local_trees," displayed"]}),(s==null?void 0:s.metadata.tree_count_mismatch)&&g.jsxs(g.Fragment,{children:[" ⚠️ (actual: ",s.metadata.num_local_trees,")"]})]}):null,m&&g.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:r.accentPrimary}})]})]})]})})}),g.jsx("div",{className:"flex-1 overflow-hidden",children:g.jsxs("div",{className:"w-full h-full relative",children:[g.jsx($$,{ref:n,data:Rt(),onNodeClick:rn,onNodeRightClick:Ye,onEdgeClick:be,focalNode:w,nodeSizes:Ae,sampleOrder:X,edgeThickness:Ue,temporalSpacingMode:Pe.temporalSpacingMode}),g.jsx(W$,{sampleOrder:X,onSampleOrderChange:J,nodeSizes:Ae,onNodeSizeChange:we=>Oe(we),edgeThickness:Ue,onEdgeThicknessChange:we=>Ee(we),temporalSpacingMode:Pe.temporalSpacingMode,onTemporalSpacingModeChange:we=>Kt(lt=>({...lt,temporalSpacingMode:we})),isLoading:Me}),g.jsx(q$,{originalNodeCount:(vr=Ke())==null?void 0:vr.originalNodes,originalEdgeCount:(Ft=Ke())==null?void 0:Ft.originalEdges,subargNodeCount:(zt=Ke())==null?void 0:zt.subArgNodes,subargEdgeCount:(kn=Ke())==null?void 0:kn.subArgEdges,displayedNodeCount:(yr=Ke())==null?void 0:yr.displayedNodes,displayedEdgeCount:(Qn=Ke())==null?void 0:Qn.displayedEdges,genomicRange:ie?S:void 0,sequenceLength:R,isFiltered:ie,isFilterSectionCollapsed:pe})]})})]})});function Q$(t){const e=t.querySelectorAll("circle, line, path, text, rect, ellipse, polygon, polyline");let n=1/0,r=-1/0,i=1/0,s=-1/0;if(e.forEach(u=>{try{const d=u.getBBox();d.width>0&&d.height>0&&(n=Math.min(n,d.x),r=Math.max(r,d.x+d.width),i=Math.min(i,d.y),s=Math.max(s,d.y+d.height))}catch(d){console.warn("Could not get bounding box for element:",u,d)}}),n===1/0){const u=t.viewBox.baseVal;n=u.x,i=u.y,r=u.x+u.width,s=u.y+u.height}const o=r-n,l=s-i;return{minX:n,maxX:r,minY:i,maxY:s,width:o,height:l,centerX:n+o/2,centerY:i+l/2}}async function J$(t,e){const{filename:n,padding:r=50,maxWidth:i=8192,maxHeight:s=8192,backgroundColor:o="#03303E",scale:l=3,watermark:u}=e;try{const d=Q$(t),h=d.width+r*2,m=d.height+r*2,_=Math.min(i/h,s/m),y=Math.min(l,_),T=Math.round(h*y),w=Math.round(m*y),b=t.cloneNode(!0);b.removeAttribute("transform");const S=d.minX-r,A=d.minY-r;b.setAttribute("viewBox",`${S} ${A} ${h} ${m}`),b.setAttribute("width",T.toString()),b.setAttribute("height",w.toString()),b.setAttribute("shape-rendering","geometricPrecision"),b.setAttribute("text-rendering","geometricPrecision"),b.setAttribute("xmlns","http://www.w3.org/2000/svg"),b.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const R=document.createElementNS("http://www.w3.org/2000/svg","rect");R.setAttribute("x",S.toString()),R.setAttribute("y",A.toString()),R.setAttribute("width",h.toString()),R.setAttribute("height",m.toString()),R.setAttribute("fill",o),R.setAttribute("stroke","none"),b.insertBefore(R,b.firstChild),b.querySelectorAll("*").forEach($=>{const Z=window.getComputedStyle($),V=$.getAttribute("style")||"";["fill","stroke","stroke-width","stroke-opacity","fill-opacity","opacity"].forEach(z=>{const Q=z.replace(/([A-Z])/g,"-$1").toLowerCase(),oe=Z.getPropertyValue(Q);oe&&oe!=="none"&&!$.hasAttribute(Q)&&$.setAttribute(Q,oe)})});const C=new XMLSerializer().serializeToString(b),O=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),P=URL.createObjectURL(O),k=document.createElement("canvas");k.width=T,k.height=w;const I=k.getContext("2d",{alpha:!1});if(!I)throw new Error("Could not get canvas context");I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",I.fillStyle=o,I.fillRect(0,0,T,w);const N=new Image,L=setTimeout(()=>{throw URL.revokeObjectURL(P),new Error("SVG loading timed out")},1e4);N.onload=()=>{clearTimeout(L);try{I.fillStyle=o,I.fillRect(0,0,T,w),I.globalCompositeOperation="source-over",I.drawImage(N,0,0,T,w),u&&O1(I,T,w,u),k.toBlob($=>{if(!$)throw new Error("Failed to create image blob");I1($,n)},"image/png",1),URL.revokeObjectURL(P)}catch($){throw URL.revokeObjectURL(P),new Error(`Failed to draw SVG to canvas: ${$}`)}},N.onerror=$=>{throw clearTimeout(L),URL.revokeObjectURL(P),new Error(`Failed to load SVG image: ${$}`)},N.crossOrigin="anonymous",N.src=P}catch(d){throw console.error("Error exporting SVG image:",d),d}}async function PO(t,e,n){var h,m,_,y;const{filename:r,padding:i=50,maxWidth:s=4096,maxHeight:o=4096,backgroundColor:l="#03303E",scale:u=2,watermark:d}=n;try{if(!e.current||!t.nodes.length)throw new Error("No 3D visualization data available for export");const{bounds:T,currentViewState:w}=t,b=(T.minX+T.maxX)/2,S=(T.minY+T.maxY)/2,A=(T.minZ+T.maxZ)/2,R=T.maxX-T.minX,E=T.maxY-T.minY,C=T.maxZ-T.minZ,O=Math.max(R,E,C),k=Math.max(.1,Math.min(3,1/(O*1.3)));let I=null;if((m=(h=e.current)==null?void 0:h.deck)!=null&&m.canvas)I=e.current.deck.canvas;else if((_=e.current)!=null&&_.canvas)I=e.current.canvas;else{const oe=((y=e.current)==null?void 0:y.domElement)||e.current;oe&&(I=oe.querySelector("canvas"))}if(!I)throw new Error("Could not access DeckGL canvas - trying fallback method");const N={...w},L={...w,target:[b,S,A],zoom:k},$=I.width/I.height;let Z=Math.min(s,2048*u),V=Math.min(o,Z/$);V>o&&(V=o,Z=V*$),Z=Math.round(Z),V=Math.round(V);const q=I.width,z=I.height,Q={width:I.style.width,height:I.style.height};try{I.width=Z,I.height=V,I.style.width=`${Z}px`,I.style.height=`${V}px`,e.current.setProps({width:Z,height:V,viewState:L}),await new Promise(D=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(D,200)})})});const oe=document.createElement("canvas");oe.width=Z,oe.height=V;const G=oe.getContext("2d");if(!G)throw new Error("Could not get export canvas context");G.imageSmoothingEnabled=!0,G.imageSmoothingQuality="high",G.fillStyle=l,G.fillRect(0,0,Z,V),G.drawImage(I,0,0),d&&O1(G,Z,V,d),oe.toBlob(D=>{if(!D)throw new Error("Failed to create image blob");I1(D,r)},"image/png",1)}finally{I.width=q,I.height=z,I.style.width=Q.width,I.style.height=Q.height,e.current.setProps({width:q,height:z,viewState:N}),await new Promise(oe=>{requestAnimationFrame(()=>{requestAnimationFrame(oe)})})}}catch(T){throw console.error("Error exporting 3D visualization image:",T),T}}async function DO(t,e){const{filename:n,padding:r=50,maxWidth:i=4096,maxHeight:s=4096,backgroundColor:o="#03303E",scale:l=2,watermark:u}=e;try{await new Promise(y=>requestAnimationFrame(y));const d=Math.min(i,t.width*l),h=Math.min(s,t.height*l),m=document.createElement("canvas");m.width=d,m.height=h;const _=m.getContext("2d");if(!_)throw new Error("Could not get canvas context");_.imageSmoothingEnabled=!0,_.imageSmoothingQuality="high",_.fillStyle=o,_.fillRect(0,0,d,h),_.drawImage(t,0,0,d,h),u&&O1(_,d,h,u),m.toBlob(y=>{if(!y)throw new Error("Failed to create image blob");I1(y,n)},"image/png",1)}catch(d){throw console.error("Error exporting canvas image:",d),d}}function I1(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function O1(t,e,n,r){const{text:i,subtext:s,position:o="bottom-right",color:l="#14E2A8",backgroundColor:u="rgba(3, 48, 62, 0.8)",fontSize:d=24,fontFamily:h="Arial, sans-serif",opacity:m=.9}=r;t.save(),t.globalAlpha=m,t.font=`bold ${d}px ${h}`,t.textAlign="left",t.textBaseline="top";const _=t.measureText(i),y=s?t.measureText(s):{width:0},T=Math.max(_.width,y.width),w=d,b=4,S=s?w*2+b:w,A=16,R=12,E=T+A*2,C=S+R*2;let O,P;const k=20;switch(o){case"top-left":O=k,P=k;break;case"top-right":O=e-E-k,P=k;break;case"bottom-left":O=k,P=n-C-k;break;case"bottom-right":O=e-E-k,P=n-C-k;break;case"top-center":O=(e-E)/2,P=k;break;case"bottom-center":default:O=(e-E)/2,P=n-C-k;break}t.fillStyle=u,t.beginPath(),t.roundRect?t.roundRect(O,P,E,C,6):t.rect(O,P,E,C),t.fill(),t.fillStyle=l,t.fillText(i,O+A,P+R),s&&(t.font=`${Math.round(d*.7)}px ${h}`,t.fillStyle=l,t.fillText(s,O+A,P+R+w+b)),t.restore()}const ah=(t,e)=>{const n=u=>{let d=u.replace("#","");if(d.length===3&&(d=d.split("").map(T=>T+T).join("")),d.length!==6)return console.warn("Invalid hex color:",u),0;const h=parseInt(d.substr(0,2),16)/255,m=parseInt(d.substr(2,2),16)/255,_=parseInt(d.substr(4,2),16)/255,y=T=>T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4);return .2126*y(h)+.7152*y(m)+.0722*y(_)};if(!t||!e)return console.warn("Missing colors for contrast check:",{color1:t,color2:e}),21;const r=n(t),i=n(e),s=Math.max(r,i),o=Math.min(r,i),l=(s+.05)/(o+.05);return t.toLowerCase()==="#ffffff"&&e.toLowerCase()==="#ffffff"&&console.log("White/white contrast check:",{color1:t,color2:e,lum1:r,lum2:i,ratio:l}),l},eq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&ah(e,r)<3;return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),i&&g.jsxs("div",{className:"relative group",children:[g.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),g.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),g.jsx("input",{id:`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),g.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]})]})},tq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=tI(e),s=e[3],o=d=>{const h=J4(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&ah(i,r)<3;return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),u&&g.jsxs("div",{className:"relative group",children:[g.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),g.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),g.jsx("input",{id:`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),g.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-xs text-sp-white/70 flex-shrink-0",children:"Opacity:"}),g.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"flex-1 min-w-0"}),g.jsxs("span",{className:"text-xs text-sp-white/70 w-10 text-right flex-shrink-0",children:[Math.round(s/255*100),"%"]})]})]})},nq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=tI(e),s=e[3],o=d=>{const h=J4(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&ah(i,r)<3;return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),u&&g.jsxs("div",{className:"relative group",children:[g.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),g.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),g.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),g.jsx("div",{className:"flex-1",children:g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-xs text-sp-white/70",children:"Opacity:"}),g.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"w-20"}),g.jsxs("span",{className:"text-xs text-sp-white/70 w-8 text-right",children:[Math.round(s/255*100),"%"]})]})]})})]})]})},rq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&ah(e,r)<3;return g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),i&&g.jsxs("div",{className:"relative group",children:[g.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),g.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),g.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),g.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"})]})]})},iq=({isOpen:t,onClose:e,editingTheme:n})=>{const{saveCustomTheme:r,updateCustomTheme:i,currentVisualizationType:s}=St(),[o,l]=j.useState(""),[u,d]=j.useState(!1),[h,m]=j.useState(()=>{const k=[96,160,183,255],I=[153,153,153,102],N=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];return{background:"#03303E",containerBackground:"#0f1419",nodeDefault:k,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:k,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"}});j.useEffect(()=>{if(n)l(n.name),m(n.colors);else{l("");const k=[96,160,183,255],I=[153,153,153,102],N=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];m({background:"#03303E",containerBackground:"#0f1419",nodeDefault:k,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:k,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"})}},[n,t]),j.useEffect(()=>{const k=I=>{I.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",k),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",k),document.body.style.overflow="unset"}},[t,e]);const _=()=>{if(!o.trim()){alert("Please enter a theme name");return}n?i(n.id,o.trim(),h):r(o.trim(),h),e()},y=k=>I=>{m(N=>({...N,[k]:I}))},T=k=>I=>{m(N=>({...N,[k]:I}))},w=k=>{const I=k.replace("#",""),N=parseInt(I.substr(0,2),16),L=parseInt(I.substr(2,2),16),$=parseInt(I.substr(4,2),16);return(.299*N+.587*L+.114*$)/255>.5?"#000000":"#ffffff"},b=k=>{const I=w(k);m(N=>({...N,background:k,headerText:I,controlPanelText:I,buttonText:I,text:I}))},S=k=>{const I=[Math.min(255,Math.round(k[0]*1.5)),Math.min(255,Math.round(k[1]*1.5)),Math.min(255,Math.round(k[2]*1.5)),Math.min(255,Math.round(k[3]*1.3))];m(N=>({...N,edgeDefault:k,edgeHighlight:I}))},A=k=>{m(I=>({...I,nodeDefault:k,nodeCombined:k}))},R=eI(s),E=QB(s),C=k=>k==="nodeDefault"?A:k==="edgeDefault"?S:y(k),O=k=>({background:"Visualization Background",containerBackground:"Container Background",nodeDefault:"Internal Nodes (combined nodes will match)",nodeRoot:"Root Nodes",nodeSample:"Sample Nodes",nodeCombined:"Combined Nodes",nodeSelected:"Selected Nodes",edgeDefault:"Edges (highlighted edges will be auto-brightened)",edgeHighlight:"Highlighted Edges",text:"Primary Text",textSecondary:"Secondary Text",border:"Borders",exportBackground:"Export Background",accentPrimary:"Primary Accent",accentSecondary:"Secondary Accent",geographicGrid:"Geographic Shapes & Grid",temporalGrid:"Temporal Grid Lines",tooltipBackground:"Tooltip Background",tooltipText:"Tooltip Text",headerText:"Header Text",controlPanelText:"Control Panel Text",buttonText:"Button Text"})[k]||k,P=k=>{const I=h[k];return typeof I=="string"?g.jsx(rq,{label:O(k),value:I,onChange:k==="background"?b:T(k),backgroundColor:k==="tooltipText"?h.tooltipBackground:void 0},k):g.jsx(nq,{label:O(k),value:I,onChange:C(k),backgroundColor:h.background},k)};return t?g.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),g.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden transform transition-all",children:g.jsxs("div",{className:"p-6 overflow-y-auto max-h-[85vh] overflow-x-hidden",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[g.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-sp-pale-green/10",children:g.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})})}),g.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:n?"Edit Custom Theme":"Create Custom Theme"})]}),g.jsxs("div",{className:"mb-6",children:[g.jsx("label",{className:"block text-sm font-medium text-sp-white mb-2",children:"Theme Name"}),g.jsx("input",{type:"text",value:o,onChange:k=>l(k.target.value),className:"w-full px-3 py-2 rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"Enter theme name...",maxLength:50})]}),g.jsxs("div",{className:"space-y-4 mb-6",children:[g.jsx("h4",{className:"text-base font-semibold text-sp-pale-green",children:"Main Colors"}),R.map(k=>P(k))]}),g.jsxs("div",{className:"space-y-4 mb-6",children:[g.jsxs("button",{onClick:()=>d(!u),className:"flex items-center gap-2 text-base font-semibold text-sp-pale-green hover:text-sp-very-pale-green transition-colors",children:[g.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Other Colors"]}),u&&g.jsx("div",{className:"space-y-6 pl-6 border-l-2 border-sp-pale-green/20",children:g.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 min-w-0",children:E.map(k=>{try{const I=h[k];return I?typeof I=="string"?g.jsx(eq,{label:O(k),value:I,onChange:T(k),backgroundColor:k==="tooltipText"?h.tooltipBackground:h.background},k):g.jsx(tq,{label:O(k),value:I,onChange:y(k),backgroundColor:h.background},k):null}catch(I){return console.warn(`Error rendering color picker for ${k}:`,I),null}})})})]}),g.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-sp-pale-green/20 bg-sp-dark-blue/20",children:[g.jsx("h4",{className:"text-sm font-semibold text-sp-pale-green mb-3",children:"Preview"}),g.jsxs("div",{className:"p-4 rounded border text-sm",style:{backgroundColor:h.background,borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`,color:h.text},children:[g.jsx("div",{style:{color:h.headerText},className:"font-semibold mb-2",children:"3D ARG Visualization"}),g.jsx("div",{style:{color:h.controlPanelText},className:"mb-3",children:"Control panel text sample"}),g.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:h.background}}),g.jsx("span",{className:"text-xs",children:"Background"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:`rgba(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]}, ${h.nodeSample[3]/255})`,borderColor:h.background}}),g.jsx("span",{className:"text-xs",children:"Sample"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]}, ${h.nodeRoot[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Root"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]}, ${h.nodeDefault[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Internal"})]})]}),g.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[g.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeDefault[0]}, ${h.edgeDefault[1]}, ${h.edgeDefault[2]}, ${h.edgeDefault[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Edges"}),g.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeHighlight[0]}, ${h.edgeHighlight[1]}, ${h.edgeHighlight[2]}, ${h.edgeHighlight[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Highlighted"})]}),g.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[g.jsx("div",{className:"w-6 h-6 border-2 rounded",style:{borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Geographic Grid"}),g.jsx("div",{className:"w-6 h-1 rounded",style:{backgroundColor:`rgba(${h.temporalGrid[0]}, ${h.temporalGrid[1]}, ${h.temporalGrid[2]}, ${h.temporalGrid[3]/255})`}}),g.jsx("span",{className:"text-xs",children:"Temporal Grid"})]}),g.jsx("div",{className:"text-xs inline-block px-2 py-1 rounded",style:{color:h.tooltipText,backgroundColor:h.tooltipBackground,border:`1px solid rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, 0.3)`},children:"Sample tooltip text"})]})]}),g.jsxs("div",{className:"flex gap-3 mt-6",children:[g.jsx("button",{onClick:e,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:"Cancel"}),g.jsx("button",{onClick:_,disabled:!o.trim(),className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-4 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Update Theme":"Save Theme"})]})]})})]}):null},uk=[{value:"tskit",label:"tskit",icon:"🎨"},{value:"grayscale",label:"B&W",icon:"🌑"},{value:"custom",label:"Custom",icon:"🎭"}],P1=()=>{const{theme:t,setTheme:e,colors:n,customThemes:r,selectedCustomTheme:i,setSelectedCustomTheme:s,deleteCustomTheme:o}=St(),[l,u]=j.useState(!1),[d,h]=j.useState(!1),[m,_]=j.useState(null),[y,T]=j.useState({isOpen:!1,themeId:"",themeName:""}),w=j.useRef(null),b=uk.find(N=>N.value===t),S=t==="custom"&&i?r.find(N=>N.id===i):null;j.useEffect(()=>{const N=L=>{w.current&&!w.current.contains(L.target)&&u(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[]);const A=N=>{N==="custom"?r.length===0?(h(!0),_(null)):(e("custom"),i||s(r[0].id)):e(N),u(!1)},R=N=>{e("custom"),s(N),u(!1)},E=()=>{_(null),h(!0),u(!1)},C=N=>{const L=r.find($=>$.id===N);L&&(_(L),h(!0)),u(!1)},O=N=>{const L=r.find($=>$.id===N);L&&T({isOpen:!0,themeId:N,themeName:L.name}),u(!1)},P=()=>{o(y.themeId),T({isOpen:!1,themeId:"",themeName:""}),i===y.themeId&&r.length<=1&&e("tskit")},k=()=>t==="custom"&&S?S.name.length>12?`${S.name.slice(0,12)}...`:S.name:(b==null?void 0:b.label)||"Custom",I=()=>t==="custom"?"🎭":(b==null?void 0:b.icon)||"🎨";return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"relative",ref:w,children:[g.jsxs("button",{className:"font-medium px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1",style:{backgroundColor:n.containerBackground,color:n.text,border:`1px solid ${n.border}`},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor=n.containerBackground},onClick:()=>u(!l),title:"Select color theme",children:[I()," ",k(),g.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&g.jsxs("div",{className:"absolute right-0 mt-1 py-1 rounded-md shadow-lg z-50 min-w-[160px] max-w-[250px]",style:{backgroundColor:n.containerBackground,border:`1px solid ${n.border}`},children:[uk.filter(N=>N.value!=="custom").map(N=>g.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:t===N.value?n.textSecondary:n.text,backgroundColor:t===N.value?n.border:"transparent"},onMouseEnter:L=>{t!==N.value&&(L.currentTarget.style.backgroundColor=n.border)},onMouseLeave:L=>{t!==N.value&&(L.currentTarget.style.backgroundColor="transparent")},onClick:()=>A(N.value),children:[N.icon," ",N.label,t===N.value&&g.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},N.value)),g.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),g.jsx("div",{className:"px-3 py-1",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("span",{className:"text-xs font-medium",style:{color:n.textSecondary},children:"Custom Themes"}),g.jsx("button",{onClick:E,className:"text-xs hover:underline",style:{color:n.textSecondary},title:"Create new custom theme",children:"+ New"})]})}),r.length===0?g.jsx("div",{className:"px-3 py-2 text-xs",style:{color:n.text+"80"},children:"No custom themes yet"}):r.map(N=>g.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors group",style:{backgroundColor:t==="custom"&&i===N.id?n.border:"transparent"},onMouseEnter:L=>{t==="custom"&&i===N.id||(L.currentTarget.style.backgroundColor=n.border)},onMouseLeave:L=>{t==="custom"&&i===N.id||(L.currentTarget.style.backgroundColor="transparent")},children:[g.jsxs("button",{onClick:()=>R(N.id),className:"flex-1 text-left flex items-center gap-2 min-w-0",style:{color:t==="custom"&&i===N.id?n.textSecondary:n.text},children:["🎭",g.jsx("span",{className:"truncate",children:N.name}),t==="custom"&&i===N.id&&g.jsx("svg",{className:"w-4 h-4 ml-auto flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:g.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),g.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[g.jsx("button",{onClick:()=>C(N.id),className:"p-1 rounded hover:bg-opacity-20",style:{color:n.textSecondary},title:"Edit theme",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),g.jsx("button",{onClick:()=>O(N.id),className:"p-1 rounded hover:bg-red-500 hover:bg-opacity-20",style:{color:"#ef4444"},title:"Delete theme",children:g.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},N.id)),r.length>0&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),g.jsx("button",{onClick:E,className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:n.textSecondary},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor="transparent"},children:"➕ Create New Theme"})]})]})]}),g.jsx(iq,{isOpen:d,onClose:()=>{h(!1),_(null)},editingTheme:m}),g.jsx(rI,{isOpen:y.isOpen,title:"Delete Custom Theme",message:`Are you sure you want to delete the custom theme "${y.themeName}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",cancelText:"Cancel",onConfirm:P,onCancel:()=>T({isOpen:!1,themeId:"",themeName:""})})]})};function sq(){const{filename:t}=i1(),e=cs(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Qs(),{colors:s,setCurrentVisualizationType:o}=St(),l=j.useRef(null),[u,d]=j.useState(!1);if(j.useEffect(()=>{o("force-directed")},[o]),!t)return g.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",style:{backgroundColor:s.background,color:s.text},children:[g.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),g.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4 transition-colors",onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),m=y=>{Re.user.action("switch-tree-sequence-force-directed",{treeSequence:y},"ArgVisualizationPage"),i(y),d(!1),e(`/visualize/${encodeURIComponent(y.filename)}`)},_=async()=>{const y=l.current;if(y)try{const T=`${h.replace(/\.(trees|tsz)$/,"")}_arg.png`;await J$(y,{filename:T,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:3,watermark:{text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"}}),console.log("High-resolution ARG image downloaded successfully")}catch(T){console.error("Error downloading ARG image:",T)}};return g.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[g.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:g.jsxs("div",{className:"max-w-7xl mx-auto",children:[g.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[g.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.color=`${s.accentPrimary}CC`},onMouseLeave:y=>{y.currentTarget.style.color=s.accentPrimary},onClick:()=>e("/result"),children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),g.jsx(ko,{size:"medium"})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[g.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"ARG Visualization"}),g.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),g.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[g.jsx(P1,{}),g.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),g.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download ARG visualization as PNG",children:"Download Image"}),r&&g.jsx(mc,{filename:r.filename})]})]})]})}),g.jsx(_c,{isOpen:u,onClose:()=>d(!1),onSelect:m}),g.jsx("main",{className:"flex-1 overflow-hidden",children:j.useMemo(()=>g.jsx(Z$,{ref:l,filename:h,max_samples:n}),[h,n])})]})}function aq(){const e=No().pathname.startsWith("/visualize"),{colors:n,theme:r}=St(),s=e&&!(e&&r==="custom")?n:null;return g.jsx("footer",{className:`fixed bottom-0 left-0 right-0 py-4 text-center text-sm backdrop-blur-sm border-t z-50 ${e?"":"text-sp-white bg-sp-very-dark-blue/90 border-t-sp-dark-blue/50"}`,style:e&&s?{color:s.text,backgroundColor:s.background+"E6",borderTopColor:s.border+"80"}:{},children:g.jsxs("div",{className:"flex flex-col items-center gap-3",children:[g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsxs("p",{children:["© ",new Date().getFullYear()," ",g.jsx("a",{href:"https://chris-a-talbot.com",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-pale-green hover:text-sp-white transition-colors",style:e&&s?{color:s.accentPrimary}:{},children:"Chris Talbot"}),". All rights reserved."]}),g.jsx("a",{href:"https://github.com/chris-a-talbot/argscape",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary}:{},title:"View source on GitHub",children:g.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})})})]}),g.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[g.jsx("span",{className:e?"":"text-sp-white/70",style:e&&s?{color:s.textSecondary,opacity:.7}:{},children:"Resources:"}),g.jsx("a",{href:"https://tskit.dev/",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tskit"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/tskit-dev/tszip",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tszip"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/tskit-dev/tsdate",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tsdate"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://tskit.dev/msprime/docs/stable/intro.html",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"msprime"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/blueraleigh/gaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaia"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/chris-a-talbot/gaiapy",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaiapy"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/chris-a-talbot/fastgaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"fastgaia"}),g.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),g.jsx("a",{href:"https://github.com/osmond-lab/sparg",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"sparg"})]})]})})}const oq="modulepreload",lq=function(t){return"/"+t},fk={},dk=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(d=>{if(d=lq(d),d in fk)return;fk[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":oq,h||(_.as="script"),_.crossOrigin="",_.href=d,u&&_.setAttribute("nonce",u),document.head.appendChild(_),h)return new Promise((y,T)=>{_.addEventListener("load",y),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};function qf(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const D1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),hk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);hk&&parseFloat(hk[1]);const af=globalThis,Xa=globalThis.process||{},cq=globalThis.navigator||{};function jO(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function ra(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||jO()}function uq(t){return ra()?jO()?"Electron":(cq.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const LO="4.1.0";function fq(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class dq{constructor(e,n,r="sessionStorage"){this.storage=fq(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function hq(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function pq(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Vf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Vf||(Vf={}));const gq=10;function pk(t){return typeof t!="string"?t:(t=t.toUpperCase(),Vf[t]||Vf.WHITE)}function mq(t,e,n){return!ra&&typeof t=="string"&&(e&&(t=`\x1B[${pk(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${pk(n)+gq}m${t}\x1B[49m`)),t}function _q(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(t)))}}function j1(t,e){if(!t)throw new Error("Assertion failed")}function Ya(){var e,n,r;let t;if(ra()&&af.performance)t=(n=(e=af==null?void 0:af.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Xa){const i=(r=Xa==null?void 0:Xa.hrtime)==null?void 0:r.call(Xa);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Ga={debug:ra()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vq={enabled:!0,level:0};function Ka(){}const gk={},mk={once:!0};class jc{constructor({id:e}={id:""}){this.VERSION=LO,this._startTs=Ya(),this._deltaTs=Ya(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new dq(`__probe-${this.id}__`,vq),this.timeStamp(`${this.id} started`),_q(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ya()-this._startTs).toPrecision(10))}getDelta(){return Number((Ya()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ga.warn,arguments,mk)}error(e){return this._getLogFunction(0,e,Ga.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Ga.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ga.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Ga.debug||Ga.info,arguments,mk)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ka,r&&[r],{tag:xq(n)}):Ka}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ka)}group(e,n,r={collapsed:!1}){const i=_k({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ka)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=BO(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=_k({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,j1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ya();const o=s.tag||s.message;if(s.once&&o)if(!gk[o])gk[o]=Ya();else return Ka;return n=yq(this.id,s.message,s),r.bind(console,n,...s.args)}return Ka}}jc.VERSION=LO;function BO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return j1(Number.isFinite(e)&&e>=0),e}function _k(t){const{logLevel:e,message:n}=t;t.logLevel=BO(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return j1(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function yq(t,e,n){if(typeof e=="string"){const r=n.time?pq(hq(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=mq(e,n.color,n.background)}return e}function xq(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const ob="4.3.2",bq=ob[0]>="0"&&ob[0]<="9"?`v${ob}`:"";function wq(){const t=new jc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=bq,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const Tq=wq();function Sq(t,e){return UO(t||{},e)}function UO(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=UO(r[i]||{},e[i],n+1):r[i]=e[i];return r}const Eq="latest";function Aq(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Rq=Aq();function ls(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Us=typeof process!="object"||String(process)!=="[object process]"||process.browser,Cq=typeof window<"u"&&typeof window.orientation<"u",vk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);vk&&parseFloat(vk[1]);class Nq{constructor(e,n){B(this,"name");B(this,"workerThread");B(this,"isRunning",!0);B(this,"result");B(this,"_resolve",()=>{});B(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){ls(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ls(this.isRunning),this.isRunning=!1,this._reject(e)}}class lb{terminate(){}}const cb=new Map;function kq(t){ls(t.source&&!t.url||!t.source&&t.url);let e=cb.get(t.source||t.url);return e||(t.url&&(e=Mq(t.url),cb.set(t.url,e)),t.source&&(e=FO(t.source),cb.set(t.source,e))),ls(e),e}function Mq(t){if(!t.startsWith("http"))return t;const e=Iq(t);return FO(e)}function FO(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Iq(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function zO(t,e=!0,n){const r=n||new Set;if(t){if(yk(t))r.add(t);else if(yk(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)zO(t[i],e,r)}}return n===void 0?Array.from(r):[]}function yk(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const ub=()=>{};class a0{constructor(e){B(this,"name");B(this,"source");B(this,"url");B(this,"terminated",!1);B(this,"worker");B(this,"onMessage");B(this,"onError");B(this,"_loadableURL","");const{name:n,source:r,url:i}=e;ls(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=ub,this.onError=s=>console.log(s),this.worker=Us?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Us||typeof lb<"u"&&!Us}destroy(){this.onMessage=ub,this.onError=ub,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||zO(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=kq({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new lb(r,{eval:!1})}else if(this.source)e=new lb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Oq{constructor(e){B(this,"name","unnamed");B(this,"source");B(this,"url");B(this,"maxConcurrency",1);B(this,"maxMobileConcurrency",1);B(this,"onDebug",()=>{});B(this,"reuseWorkers",!0);B(this,"props",{});B(this,"jobQueue",[]);B(this,"idleQueue",[]);B(this,"count",0);B(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return a0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new Nq(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Us||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new a0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Cq?this.maxMobileConcurrency:this.maxConcurrency}}const Pq={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Zi=class Zi{constructor(e){B(this,"props");B(this,"workerPools",new Map);this.props={...Pq},this.setProps(e),this.workerPools=new Map}static isSupported(){return a0.isSupported()}static getWorkerFarm(e={}){return Zi._workerFarm=Zi._workerFarm||new Zi({}),Zi._workerFarm.setProps(e),Zi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new Oq({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};B(Zi,"_workerFarm");let Hf=Zi;function Dq(t,e={}){const n=e[t.id]||{},r=Us?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Us?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=Eq);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return ls(i),i}function jq(t,e=Rq){ls(t,"no worker provided");const n=t.version;return!(!e||!n)}function Lq(t,e){return!Hf.isSupported()||!Us&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Bq(t,e,n,r,i){const s=t.id,o=Dq(t,n),u=Hf.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",Uq.bind(null,i));return d.postMessage("process",{input:e,options:n,context:r}),await(await d.result).result}async function Uq(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await t(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function Fq(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function zq(...t){return $q(t)}function $q(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function qq(t){const e=[];for await(const n of t)e.push(n);return zq(...e)}function xk(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class bk{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=xk(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(xk()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class oh{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof bk?i=e:i=new bk(n,r),this.stats[n]=i),i}}let Vq="";const wk={};function Hq(t){for(const e in wk)if(t.startsWith(e)){const n=wk[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Vq}${t}`),t}function Wq(t){return t&&typeof t=="object"&&t.isBuffer}function $O(t){if(Wq(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function qO(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Xq(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Yq=t=>typeof t=="boolean",rc=t=>typeof t=="function",Lc=t=>t!==null&&typeof t=="object",Tk=t=>Lc(t)&&t.constructor==={}.constructor,Gq=t=>!!t&&typeof t[Symbol.iterator]=="function",Kq=t=>t&&typeof t[Symbol.asyncIterator]=="function",ia=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,sa=t=>typeof Blob<"u"&&t instanceof Blob,Zq=t=>t&&typeof t=="object"&&t.isBuffer,Qq=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Lc(t)&&rc(t.tee)&&rc(t.cancel)&&rc(t.getReader),Jq=t=>Lc(t)&&rc(t.read)&&rc(t.pipe)&&Yq(t.readable),VO=t=>Qq(t)||Jq(t);class eV extends Error{constructor(n,r){super(n);B(this,"reason");B(this,"url");B(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const tV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,nV=/^([-\w.]+\/[-\w.+]+)/;function Sk(t,e){return t.toLowerCase()===e.toLowerCase()}function rV(t){const e=nV.exec(t);return e?e[1]:t}function Ek(t){const e=tV.exec(t);return e?e[1]:""}const HO=/\?.*/;function iV(t){const e=t.match(HO);return e&&e[0]}function L1(t){return t.replace(HO,"")}function sV(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function lh(t){return ia(t)?t.url:sa(t)?t.name||"":typeof t=="string"?t:""}function B1(t){if(ia(t)){const e=t,n=e.headers.get("content-type")||"",r=L1(e.url);return rV(n)||Ek(r)}return sa(t)?t.type||"":typeof t=="string"?Ek(t):""}function aV(t){return ia(t)?t.headers["content-length"]||-1:sa(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function WO(t){if(ia(t))return t;const e={},n=aV(t);n>=0&&(e["content-length"]=String(n));const r=lh(t),i=B1(t);i&&(e["content-type"]=i);const s=await cV(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function oV(t){if(!t.ok)throw await lV(t)}async function lV(t){const e=sV(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new eV(n,r)}async function cV(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${uV(n)}`}return null}function uV(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function fV(t){return!dV(t)&&!hV(t)}function dV(t){return t.startsWith("http:")||t.startsWith("https:")}function hV(t){return t.startsWith("data:")}async function Ak(t,e){var n,r;if(typeof t=="string"){const i=Hq(t);return fV(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await WO(t)}const Rk=new jc({id:"loaders.gl"});class pV{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class gV{constructor(){B(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const XO={fetch:null,mimeType:void 0,nothrow:!1,log:new gV,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:D1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},mV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function YO(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function GO(){const t=YO();return t.globalOptions=t.globalOptions||{...XO},t.globalOptions}function _V(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],vV(t,n),xV(e,t,r)}function vV(t,e){Ck(t,null,XO,mV,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ck(r,n.id,i,s,e)}}function Ck(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in t){const u=!e&&Lc(t[l]),d=l==="baseUri"&&!e,h=l==="workerUrl"&&e;if(!(l in n)&&!d&&!h){if(l in r)Rk.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const m=yV(l,i);Rk.warn(`${s} loader option '${o}${l}' not recognized. ${m}`)()}}}}function yV(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function xV(t,e,n){const i={...t.options||{}};return bV(i,n),i.log===null&&(i.log=new pV),Nk(i,GO()),Nk(i,e),i}function Nk(t,e){for(const n in e)if(n in e){const r=e[n];Tk(r)&&Tk(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function bV(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function U1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function F1(t){qf(t,"null loader"),qf(U1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const KO=()=>{const t=YO();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function wV(t){const e=KO();t=Array.isArray(t)?t:[t];for(const n of t){const r=F1(n);e.find(i=>r===i)||e.unshift(r)}}function TV(){return KO()}const SV=/\.([^.]+)$/;async function EV(t,e=[],n,r){if(!ZO(t))return null;let i=kk(t,e,{...n,nothrow:!0},r);if(i)return i;if(sa(t)&&(t=await t.slice(0,10).arrayBuffer(),i=kk(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(QO(t));return i}function kk(t,e=[],n,r){if(!ZO(t))return null;if(e&&!Array.isArray(e))return F1(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...TV()),RV(i);const s=AV(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(QO(t));return s}function AV(t,e,n,r){const i=lh(t),s=B1(t),o=L1(i)||(r==null?void 0:r.url);let l=null,u="";return n!=null&&n.mimeType&&(l=fb(e,n==null?void 0:n.mimeType),u=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),l=l||CV(e,o),u=u||(l?`matched url ${o}`:""),l=l||fb(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||kV(e,t),u=u||(l?`matched initial data ${JO(t)}`:""),n!=null&&n.fallbackMimeType&&(l=l||fb(e,n==null?void 0:n.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&Tq.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${u}.`),l}function ZO(t){return!(t instanceof Response&&t.status===204)}function QO(t){const e=lh(t),n=B1(t);let r="No valid loader found (";r+=e?`${qO(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?JO(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function RV(t){for(const e of t)F1(e)}function CV(t,e){const n=e&&SV.exec(e),r=n&&n[1];return r?NV(t,r):null}function NV(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function fb(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>Sk(e,i))||Sk(e,`application/x.${r.id}`))return r;return null}function kV(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(MV(e,n))return n}else if(ArrayBuffer.isView(e)){if(Mk(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Mk(e,0,n))return n;return null}function MV(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Mk(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>IV(t,e,n,i))}function IV(t,e,n,r){if(r instanceof ArrayBuffer)return Fq(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=o0(t,e,r.length);return r===i;default:return!1}}function JO(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?o0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?o0(t,0,e):""}function o0(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const OV=256*1024;function*PV(t,e){const n=(e==null?void 0:e.chunkSize)||OV;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const DV=256*1024;function*jV(t,e={}){const{chunkSize:n=DV}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const LV=1024*1024;async function*BV(t,e){const n=(e==null?void 0:e.chunkSize)||LV;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Ik(t,e){return D1?UV(t,e):FV(t)}async function*UV(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield $O(o)}}catch{n.releaseLock()}}async function*FV(t,e){for await(const n of t)yield $O(n)}function zV(t,e){if(typeof t=="string")return PV(t,e);if(t instanceof ArrayBuffer)return jV(t,e);if(sa(t))return BV(t,e);if(VO(t))return Ik(t,e);if(ia(t))return Ik(t.body,e);throw new Error("makeIterator")}const eP="Cannot convert supplied data type";function $V(t,e,n){if(e.text&&typeof t=="string")return t;if(Zq(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(eP)}async function qV(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return $V(t,e);if(sa(t)&&(t=await WO(t)),ia(t)){const i=t;return await oV(i),e.binary?await i.arrayBuffer():await i.text()}if(VO(t)&&(t=zV(t,n)),Gq(t)||Kq(t))return qq(t);throw new Error(eP)}function tP(t,e){const n=GO(),r=t||n;return typeof r.fetch=="function"?r.fetch:Lc(r.fetch)?i=>Ak(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Ak}function VV(t,e,n){if(n)return n;const r={fetch:tP(e,t),...t};if(r.url){const i=L1(r.url);r.baseUrl=i,r.queryString=iV(r.url),r.filename=qO(i),r.baseUrl=Xq(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function HV(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Wf(t,e,n,r){e&&!Array.isArray(e)&&!U1(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=lh(t),o=HV(e,r),l=await EV(t,o,n);return l?(n=_V(n,l,o,i),r=VV({url:i,_parse:Wf,loaders:o},n,r||null),await WV(l,t,n,r)):null}async function WV(t,e,n,r){if(jq(t),n=Sq(t.options,n),ia(e)){const s=e,{ok:o,redirected:l,status:u,statusText:d,type:h,url:m}=s,_=Object.fromEntries(s.headers.entries());r.response={headers:_,ok:o,redirected:l,status:u,statusText:d,type:h,url:m}}e=await qV(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(Lq(t,n))return await Bq(t,e,n,r,Wf);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw ls(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function l0(t,e,n,r){let i,s;!Array.isArray(e)&&!U1(e)?(i=[],s=e):(i=e,s=n);const o=tP(s);let l=t;return typeof t=="string"&&(l=await o(t)),sa(t)&&(l=await o(t)),Array.isArray(i)?await Wf(l,i,s):await Wf(l,i,s)}const XV="4.3.2";var L4;const YV=(L4=globalThis.loaders)==null?void 0:L4.parseImageNode,c0=typeof Image<"u",u0=typeof ImageBitmap<"u",GV=!!YV,f0=D1?!0:GV;function KV(t){switch(t){case"auto":return u0||c0||f0;case"imagebitmap":return u0;case"image":return c0;case"data":return f0;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function ZV(){if(u0)return"imagebitmap";if(c0)return"image";if(f0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function QV(t){const e=eH(t);if(!e)throw new Error("Not an image");return e}function JV(t){switch(QV(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function eH(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const tH=/^data:image\/svg\+xml/,nH=/\.svg((\?|#).*)?$/;function z1(t){return t&&(tH.test(t)||nH.test(t))}function rH(t,e){if(z1(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return nP(t,e)}function nP(t,e){if(z1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function rP(t,e,n){const r=rH(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await iH(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function iH(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const sH={};let Ok=!0;async function aH(t,e,n){let r;z1(n)?r=await rP(t,e,n):r=nP(t,n);const i=e&&e.imagebitmap;return await oH(r,i)}async function oH(t,e=null){if((lH(e)||!Ok)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Ok=!1}return await createImageBitmap(t)}function lH(t){for(const e in t||sH)return!1;return!0}function cH(t){return!hH(t,"ftyp",4)||(t[8]&96)===0?null:uH(t)}function uH(t){switch(fH(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function fH(t,e,n){return String.fromCharCode(...t.slice(e,n))}function dH(t){return[...t].map(e=>e.charCodeAt(0))}function hH(t,e,n=0){const r=dH(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const qr=!1,ic=!0;function iP(t){const e=Bc(t);return gH(e)||vH(e)||mH(e)||_H(e)||pH(e)}function pH(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=cH(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function gH(t){const e=Bc(t);return e.byteLength>=24&&e.getUint32(0,qr)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qr),height:e.getUint32(20,qr)}:null}function mH(t){const e=Bc(t);return e.byteLength>=10&&e.getUint32(0,qr)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ic),height:e.getUint16(8,ic)}:null}function _H(t){const e=Bc(t);return e.byteLength>=14&&e.getUint16(0,qr)===16973&&e.getUint32(2,ic)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ic),height:e.getUint32(22,ic)}:null}function vH(t){const e=Bc(t);if(!(e.byteLength>=3&&e.getUint16(0,qr)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=yH();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,qr);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,qr),width:e.getUint16(s+7,qr)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,qr)}return null}function yH(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function xH(t,e){var i;const{mimeType:n}=iP(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return qf(r),await r(t,n)}async function bH(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=wH(i);let l;switch(o){case"imagebitmap":l=await aH(t,e,s);break;case"image":l=await rP(t,e,s);break;case"data":l=await xH(t);break;default:qf(!1)}return i==="data"&&(l=JV(l)),l}function wH(t){switch(t){case"auto":case"data":return ZV();default:return KV(t),t}}const TH=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],SH=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],EH={image:{type:"auto",decode:!0}},AH={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:XV,mimeTypes:SH,extensions:TH,parse:bH,tests:[t=>!!iP(new DataView(t))],options:EH},yt=new jc({id:"deck"});let d0={};function RH(t){d0=t}function An(t,e,n,r){yt.level>0&&d0[t]&&d0[t].call(null,e,n,r)}function CH(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const NH={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:CH,parseTextSync:JSON.parse};function kH(){const t="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(yt.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:yt,_registerLoggers:RH},wV([NH,[AH,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const MH=kH();function $1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const db={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function IH(t){const e={};for(const[n,r]of Object.entries(t))e[n]=OH(r);return e}function OH(t){let e=Pk(t);if(e!=="object")return{value:t,...db[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...db[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Pk(t.value),{...t,...db[e],type:e}):{type:"object",value:null};throw new Error("props")}function Pk(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const PH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,DH=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,jH={vertex:PH,fragment:DH},Dk=/void\s+main\s*\([^)]*\)\s*\{\n?/,jk=/}\n?[^{}]*$/,hb=[],Rf="__LUMA_INJECT_DECLARATIONS__";function LH(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=BH(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function BH(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Xf(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((u,d)=>u.order-d.order),hb.length=o.length;for(let u=0,d=o.length;u<d;++u)hb[u]=o[u].injection;const l=`${hb.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Rf,l));break;case"vs:#main-start":i&&(t=t.replace(Dk,u=>u+l));break;case"vs:#main-end":i&&(t=t.replace(jk,u=>l+u));break;case"fs:#decl":i||(t=t.replace(Rf,l));break;case"fs:#main-start":i||(t=t.replace(Dk,u=>u+l));break;case"fs:#main-end":i||(t=t.replace(jk,u=>l+u));break;default:t=t.replace(s,u=>u+l)}}return t=t.replace(Rf,""),r&&(t=t.replace(/\}\s*$/,s=>s+jH[e])),t}function Yf(t){t.map(e=>UH(e))}function UH(t){if(t.instance)return;Yf(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:LH(r),parsedDeprecations:FH(n)};e&&(i.propValidators=IH(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const d=u==null?void 0:u.value;return d&&(o[l]=d),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function sP(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function FH(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function q1(t){Yf(t);const e={},n={};aP({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Yf(r),r}function aP(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&aP({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function zH(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function $H(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Lk(t,qH),t;case"fragment":return t=Lk(t,VH),t;default:throw new Error(e)}}const oP=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qH=[...oP,[h0("attribute"),"in $1"],[h0("varying"),"out $1"]],VH=[...oP,[h0("varying"),"in $1"]];function Lk(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function h0(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function lP(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function cP(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function HH(t,e){return{name:WH(t,e),language:"glsl",version:XH(t)}}function WH(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function XH(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const uP=`

${Rf}
`,YH=`precision highp float;
`;function GH(t){const e=q1(t.modules||[]);return{source:ZH(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:fP(e)}}function KH(t){const{vs:e,fs:n}=t,r=q1(t.modules||[]);return{vs:Bk(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Bk(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:fP(r)}}function ZH(t,e){var w;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;$1(typeof n=="string","shader source must be a string");const u=n;let d="";const h=cP(s),m={},_={},y={};for(const b in o){const S=typeof o[b]=="string"?{injection:o[b],order:0}:o[b],A=/^(v|f)s:(#)?([\w-]+)$/.exec(b);if(A){const R=A[2],E=A[3];R?E==="decl"?_[b]=[S]:y[b]=[S]:m[b]=[S]}else y[b]=[S]}const T=i;for(const b of T){l&&sP(b,u,l);const S=dP(b,"wgsl");d+=S;const A=((w=b.injections)==null?void 0:w[r])||{};for(const R in A){const E=/^(v|f)s:#([\w-]+)$/.exec(R);if(E){const O=E[2]==="decl"?_:y;O[R]=O[R]||[],O[R].push(A[R])}else m[R]=m[R]||[],m[R].push(A[R])}}return d+=uP,d=Xf(d,r,_),d+=lP(h[r],m),d+=u,d=Xf(d,r,y),d}function Bk(t,e){var P;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:d={},prologue:h=!0,log:m}=e;$1(typeof r=="string","shader source must be a string");const _=s==="glsl"?HH(r).version:-1,y=t.shaderLanguageVersion,T=_===100?"#version 100":"#version 300 es",b=r.split(`
`).slice(1).join(`
`),S={};o.forEach(k=>{Object.assign(S,k.defines)}),Object.assign(S,l);let A="";switch(s){case"wgsl":break;case"glsl":A=h?`${T}

// ----- PROLOGUE -------------------------
${QH({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${zH(t)}
${i==="fragment"?YH:""}

// ----- APPLICATION DEFINES -------------------------

${JH(S)}

`:`${T}
`;break}const R=cP(u),E={},C={},O={};for(const k in d){const I=typeof d[k]=="string"?{injection:d[k],order:0}:d[k],N=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(N){const L=N[2],$=N[3];L?$==="decl"?C[k]=[I]:O[k]=[I]:E[k]=[I]}else O[k]=[I]}for(const k of o){m&&sP(k,b,m);const I=dP(k,i);A+=I;const N=((P=k.instance)==null?void 0:P.normalizedInjections[i])||{};for(const L in N){const $=/^(v|f)s:#([\w-]+)$/.exec(L);if($){const V=$[2]==="decl"?C:O;V[L]=V[L]||[],V[L].push(N[L])}else E[L]=E[L]||[],E[L].push(N[L])}}return A+="// ----- MAIN SHADER SOURCE -------------------------",A+=uP,A=Xf(A,i,C),A+=lP(R[i],E),A+=b,A=Xf(A,i,O),s==="glsl"&&_!==y&&(A=$H(A,i)),A.trim()}function fP(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function QH(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function JH(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function dP(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:$1(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const eW=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,tW=/^\s*\#\s*endif\s*$/;function nW(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const l of n){const u=l.match(eW),d=l.match(tW);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):d?i=!0:i&&r.push(l)}return r.join(`
`)}const Ps=class Ps{constructor(){B(this,"_hookFunctions",[]);B(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ps.defaultShaderAssembler=Ps.defaultShaderAssembler||new Ps,Ps.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=GH({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?nW(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...KH({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;n[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(n[i++]=l,r[u]=!0)}return n.length=i,Yf(n),n}};B(Ps,"defaultShaderAssembler");let Gf=Ps;const rW=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,iW=`#version 300 es
${rW}`;function sW(t){const{input:e,inputChannels:n,output:r}={};if(!e)return iW;if(!n)throw new Error("inputChannels");const i=aW(n),s=oW(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function aW(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function oW(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class lW{constructor(){B(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new oh({id:e})),this.stats.get(e)}}const hP=new lW,xe=new jc({id:"luma.gl"}),pb={};function ch(t="id"){pb[t]=pb[t]||1;const e=pb[t]++;return`${t}-${e}`}var Xb;let ht=(Xb=class{constructor(e,n,r){B(this,"id");B(this,"props");B(this,"userData",{});B(this,"_device");B(this,"destroyed",!1);B(this,"allocatedBytes",0);B(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=cW(n,r);const i=this.props.id!=="undefined"?this.props.id:ch(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},B(Xb,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Xb);function cW(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const hn=class hn extends ht{constructor(n,r){const i={...r};(r.usage||0)&hn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,hn.defaultProps);B(this,"usage");B(this,"indexType");B(this,"updateTimestamp");B(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,hn.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};B(hn,"defaultProps",{...ht.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),B(hn,"MAP_READ",1),B(hn,"MAP_WRITE",2),B(hn,"COPY_SRC",4),B(hn,"COPY_DST",8),B(hn,"INDEX",16),B(hn,"VERTEX",32),B(hn,"UNIFORM",64),B(hn,"STORAGE",128),B(hn,"INDIRECT",256),B(hn,"QUERY_RESOLVE",512),B(hn,"DEBUG_DATA_MAX_LENGTH",32);let Tt=hn;function pP(t){const e=Uk[t],n=uW(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Uk[t],byteLength:n,integer:i,signed:s,normalized:r}}function uW(t){return fW[t]}const Uk={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},fW={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},xn="texture-compression-bc",dt="texture-compression-astc",Ur="texture-compression-etc2",dW="texture-compression-etc1-webgl",of="texture-compression-pvrtc-webgl",gb="texture-compression-atc-webgl",lf="float32-renderable-webgl",mb="float16-renderable-webgl",hW="rgb9e5ufloat-renderable-webgl",_b="snorm8-renderable-webgl",Ul="norm16-renderable-webgl",vb="snorm16-renderable-webgl",cf="float32-filterable",Fk="float16-filterable-webgl";function gP(t){const e=pW[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const pW={r8unorm:{},r8snorm:{render:_b},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:_b},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:mb,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ul},"r16snorm-webgl":{f:vb},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:_b},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:mb,filter:Fk},"rg16unorm-webgl":{render:Ul},"rg16snorm-webgl":{render:vb},r32uint:{},r32sint:{},r32float:{render:lf,filter:cf},rgb9e5ufloat:{channels:"rgb",packed:!0,render:hW},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:lf},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ul},"rgb16snorm-webgl":{f:Ul},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:cf},rgba16uint:{},rgba16sint:{},rgba16float:{render:mb,filter:Fk},"rgba16unorm-webgl":{render:Ul},"rgba16snorm-webgl":{render:vb},"rgb32float-webgl":{render:lf,filter:cf},rgba32uint:{},rgba32sint:{},rgba32float:{render:lf,filter:cf},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:xn},"bc1-rgb-unorm-srgb-webgl":{f:xn},"bc1-rgba-unorm":{f:xn},"bc1-rgba-unorm-srgb":{f:xn},"bc2-rgba-unorm":{f:xn},"bc2-rgba-unorm-srgb":{f:xn},"bc3-rgba-unorm":{f:xn},"bc3-rgba-unorm-srgb":{f:xn},"bc4-r-unorm":{f:xn},"bc4-r-snorm":{f:xn},"bc5-rg-unorm":{f:xn},"bc5-rg-snorm":{f:xn},"bc6h-rgb-ufloat":{f:xn},"bc6h-rgb-float":{f:xn},"bc7-rgba-unorm":{f:xn},"bc7-rgba-unorm-srgb":{f:xn},"etc2-rgb8unorm":{f:Ur},"etc2-rgb8unorm-srgb":{f:Ur},"etc2-rgb8a1unorm":{f:Ur},"etc2-rgb8a1unorm-srgb":{f:Ur},"etc2-rgba8unorm":{f:Ur},"etc2-rgba8unorm-srgb":{f:Ur},"eac-r11unorm":{f:Ur},"eac-r11snorm":{f:Ur},"eac-rg11unorm":{f:Ur},"eac-rg11snorm":{f:Ur},"astc-4x4-unorm":{f:dt},"astc-4x4-unorm-srgb":{f:dt},"astc-5x4-unorm":{f:dt},"astc-5x4-unorm-srgb":{f:dt},"astc-5x5-unorm":{f:dt},"astc-5x5-unorm-srgb":{f:dt},"astc-6x5-unorm":{f:dt},"astc-6x5-unorm-srgb":{f:dt},"astc-6x6-unorm":{f:dt},"astc-6x6-unorm-srgb":{f:dt},"astc-8x5-unorm":{f:dt},"astc-8x5-unorm-srgb":{f:dt},"astc-8x6-unorm":{f:dt},"astc-8x6-unorm-srgb":{f:dt},"astc-8x8-unorm":{f:dt},"astc-8x8-unorm-srgb":{f:dt},"astc-10x5-unorm":{f:dt},"astc-10x5-unorm-srgb":{f:dt},"astc-10x6-unorm":{f:dt},"astc-10x6-unorm-srgb":{f:dt},"astc-10x8-unorm":{f:dt},"astc-10x8-unorm-srgb":{f:dt},"astc-10x10-unorm":{f:dt},"astc-10x10-unorm-srgb":{f:dt},"astc-12x10-unorm":{f:dt},"astc-12x10-unorm-srgb":{f:dt},"astc-12x12-unorm":{f:dt},"astc-12x12-unorm-srgb":{f:dt},"pvrtc-rgb4unorm-webgl":{f:of},"pvrtc-rgba4unorm-webgl":{f:of},"pvrtc-rbg2unorm-webgl":{f:of},"pvrtc-rgba2unorm-webgl":{f:of},"etc1-rbg-unorm-webgl":{f:dW},"atc-rgb-unorm-webgl":{f:gb},"atc-rgba-unorm-webgl":{f:gb},"atc-rgbai-unorm-webgl":{f:gb}},gW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],mW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function mP(t){return gW.some(e=>t.startsWith(e))}function V1(t){let e=_W(t);if(mP(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=vW(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=mW.exec(t);if(n){const[,r,i,s,o,l]=n,u=`${s}${i}`,d=pP(u),h=d.byteLength*8,m=r.length,_=[h,m>=2?h:0,m>=3?h:0,m>=4?h:0];e={format:t,attachment:e.attachment,dataType:d.dataType,components:m,channels:r,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:_,bytesPerPixel:d.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function _W(t){var s;const e=gP(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function vW(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function yW(t){const e=gP(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=V1(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!l),n}class xW{}class bW{constructor(e=[],n){B(this,"features");B(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const bd=class bd{constructor(e){B(this,"id");B(this,"props");B(this,"userData",{});B(this,"statsManager",hP);B(this,"timestamp",0);B(this,"_reused",!1);B(this,"_lumaData",{});this.props={...bd.defaultProps,...e},this.id=this.props.id||ch(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=yW(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return mP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Tt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":xe.warn("indices buffer content must be of integer type")()),n}};B(bd,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>xe.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:xe.get("debug")||void 0,debugShaders:xe.get("debug-shaders")||void 0,debugFramebuffers:!!xe.get("debug-framebuffers"),debugWebGL:!!xe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ss=bd;const wW=ra()&&typeof document<"u",TW=()=>wW&&document.readyState==="complete",SW="set luma.log.level=1 (or higher) to trace rendering",zk="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Qi=class Qi{constructor(){B(this,"stats",hP);B(this,"log",xe);B(this,"VERSION","9.1.9");B(this,"spector");B(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw xe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),xe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");xe.error("This version of luma.gl has already been initialized")()}xe.log(1,`${this.VERSION} - ${SW}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Qi.defaultProps,e)}async createDevice(e={}){var l;e={...Qi.defaultProps,...e},e.waitForPageLoad&&await Qi.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((l=s==null?void 0:s.create)==null?void 0:l.call(s,e));if(o)return o;throw new Error(zk)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Qi.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(zk)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||xe.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){xe.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};B(Qi,"defaultProps",{...ss.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),B(Qi,"pageLoaded",EW().then(()=>{xe.probe(2,"DOM is loaded")()}));let p0=Qi;const g0=new p0;function EW(){return TW()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class AW{}const wd=class wd{constructor(e){B(this,"id");B(this,"props");B(this,"canvas");B(this,"htmlCanvas");B(this,"offscreenCanvas");B(this,"type");B(this,"width",1);B(this,"height",1);B(this,"resizeObserver");B(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...wd.defaultProps,...e},e=this.props,!ra()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=CW(e.canvas):this.canvas=e.canvas;else{const n=NW(e),r=RW((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return kW(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(xe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[h,m]=this.getDrawingBufferSize();(h!==l||m!==u)&&(o=Math.min(h/r,m/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),xe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};B(wd,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let m0=wd;function RW(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function CW(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function NW(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=ch("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function kW(t,e,n,r,i){const s=t,o=$k(s[0],e,n);let l=qk(s[1],e,r,i),u=$k(s[0]+1,e,n);const d=u===n-1?u:u-1;u=qk(s[1]+1,e,r,i);let h;return i?(u=u===0?u:u+1,h=l,l=u):h=u===r-1?u:u-1,{x:o,y:l,width:Math.max(d-o+1,1),height:Math.max(h-l+1,1)}}function $k(t,e,n){return Math.min(Math.round(t*e),n-1)}function qk(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const pn=class pn extends ht{constructor(n,r){r=pn.normalizeProps(n,r);super(n,r,pn.defaultProps);B(this,"dimension");B(this,"format");B(this,"width");B(this,"height");B(this,"depth");B(this,"mipLevels");B(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=pn.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?pn.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return pn.getTextureDataSize(n[0]);if(pn.isExternalImage(n))return pn.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var u,d;const i={...r},s=((d=(u=n==null?void 0:n.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:o,height:l}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}};B(pn,"COPY_SRC",1),B(pn,"COPY_DST",2),B(pn,"TEXTURE",4),B(pn,"STORAGE",8),B(pn,"RENDER_ATTACHMENT",16),B(pn,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),B(pn,"defaultProps",{...ht.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),B(pn,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let jt=pn;const Td=class Td extends ht{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Td.defaultProps)}};B(Td,"defaultProps",{...ht.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Kf=Td;function MW(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=_P(i[l-1],l,n);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=Vk(u,i,u.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=Vk(l,i,l.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Vk(t,e,n,r){if(r!=null&&r.inlineSource){const s=IW(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function IW(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=_P(s,e,n))}return r}function _P(t,e,n){const r=n!=null&&n.html?PW(t):t;return`${OW(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function OW(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function PW(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Sd=class Sd extends ht{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:DW(r),...r},Sd.defaultProps);B(this,"stage");B(this,"source");B(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=vP(this.source),i=`${this.stage} ${r}`;let s=MW(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};B(Sd,"defaultProps",{...ht.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Zf=Sd;function DW(t){return vP(t.source)||t.id||ch(`unnamed ${t.stage}-shader`)}function vP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const fc=class fc extends ht{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=fc.normalizeProps(e,n),super(e,n,fc.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};B(fc,"defaultProps",{...ht.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Qf=fc;const Ed=class Ed extends ht{constructor(n,r={}){super(n,r,Ed.defaultProps);B(this,"width");B(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(xe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof jt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof jt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:jt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:jt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};B(Ed,"defaultProps",{...ht.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Jf=Ed;const Ad=class Ad extends ht{constructor(n,r){super(n,r,Ad.defaultProps);B(this,"shaderLayout");B(this,"bufferLayout");B(this,"linkStatus","pending");B(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};B(Ad,"defaultProps",{...ht.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let vo=Ad;const Er=class Er extends ht{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=Er.normalizeProps(e,n),super(e,n,Er.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};B(Er,"defaultClearColor",[0,0,0,1]),B(Er,"defaultClearDepth",1),B(Er,"defaultClearStencil",0),B(Er,"defaultProps",{...ht.defaultProps,framebuffer:null,parameters:void 0,clearColor:Er.defaultClearColor,clearColors:void 0,clearDepth:Er.defaultClearDepth,clearStencil:Er.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let _0=Er;const Rd=class Rd extends ht{constructor(n,r){super(n,r,Rd.defaultProps);B(this,"hash","");B(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};B(Rd,"defaultProps",{...ht.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ed=Rd;const Cd=class Cd extends ht{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Cd.defaultProps)}};B(Cd,"defaultProps",{...ht.defaultProps,measureExecutionTime:void 0});let v0=Cd;const Nd=class Nd extends ht{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Nd.defaultProps)}};B(Nd,"defaultProps",{...ht.defaultProps});let y0=Nd;function jW(t){const[e,n]=BW[t],r=e==="i32"||e==="u32",i=e!=="u32",s=UW[e]*n,o=LW(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function LW(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const BW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},UW={f32:4,f16:2,i32:4,u32:4};function yP(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=pP(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function xP(t,e){const n={};for(const r of t.attributes){const i=zW(t,e,r.name);i&&(n[r.name]=i)}return n}function FW(t,e,n=16){const r=xP(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function zW(t,e,n){const r=$W(t,n),i=qW(e,n);if(!r)return null;const s=jW(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,l=yP(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function $W(t,e){const n=t.attributes.find(r=>r.name===e);return n||xe.warn(`shader layout attribute "${e}" not present in shader`),n||null}function qW(t,e){VW(t);let n=HW(t,e);return n||(n=WW(t,e),n)?n:(xe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function VW(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&xe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function HW(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function WW(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const l=yP(o.format);i+=l.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const kd=class kd extends ht{constructor(n,r){super(n,r,kd.defaultProps);B(this,"maxVertexAttributes");B(this,"attributeInfos");B(this,"indexBuffer",null);B(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=FW(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};B(kd,"defaultProps",{...ht.defaultProps,renderPipeline:null});let x0=kd;const Md=class Md extends ht{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Md.defaultProps)}};B(Md,"defaultProps",{...ht.defaultProps,layout:void 0,buffers:{}});let b0=Md;const Id=class Id extends ht{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Id.defaultProps)}};B(Id,"defaultProps",{...ht.defaultProps,type:void 0,count:void 0});let w0=Id;const XW={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function YW(t){return XW[t]}function GW(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let uf;function bP(t){return(!uf||uf.byteLength<t)&&(uf=new ArrayBuffer(t)),uf}function KW(t,e){const n=bP(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function ZW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function td(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":ZW(t)}const Hk=1024;class QW{constructor(e){B(this,"layout",{});B(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=YW(s),{type:l,components:u}=o;n=GW(n,u);const d=n;n+=u,this.layout[i]={type:l,size:u,offset:d}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,Hk)}getData(e){const n=Math.max(this.byteLength,Hk),r=bP(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){xe.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:h}=l,m=i[u];if(d===1){if(typeof o!="number"&&typeof o!="boolean"){xe.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}m[h]=Number(o)}else{if(!td(o)){xe.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}m.set(o,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function JW(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!td(r))return!1;if(td(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function eX(t){return td(t)?t.slice():t}class tX{constructor(e){B(this,"name");B(this,"uniforms",{});B(this,"modifiedUniforms",{});B(this,"modified",!0);B(this,"bindingLayout",{});B(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){JW(this.uniforms[e],n)||(this.uniforms[e]=eX(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class nX{constructor(e){B(this,"uniformBlocks",new Map);B(this,"uniformBufferLayouts",new Map);B(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new QW(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new tX({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Tt.UNIFORM|Tt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Tt.UNIFORM|Tt.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&xe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const l=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();xe.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return i}}function wP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function TP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function rX(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=wP(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class yb{constructor(e){B(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&xe.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function iX(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(h=>h.attribute):[i.name],l=s.attributes?s.attributes.map(h=>h.attribute):[s.name],u=Math.min(...o.map(h=>n[h])),d=Math.min(...l.map(h=>n[h]));return u-d}),r}class fr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Wk{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class rs extends fr{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class as extends fr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class T0 extends fr{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Hs extends fr{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Ki;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Ki||(Ki={}));class ff{constructor(e,n,r,i,s,o,l){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class sX{constructor(e,n){this.name=e,this.type=n}}class aX{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Xk{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class oX{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class lX{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class cX{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class uX{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const SP=new Float32Array(1),fX=new Int32Array(SP.buffer),bn=new Uint16Array(1);function dX(t){SP[0]=t;const e=fX[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return bn[0]=n<<15|31744|(i!==0?512:0),bn[0];if(r===0){if(i===0)return bn[0]=n<<15,bn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),bn[0]=n<<15|r<<10|i>>13,bn[0]):(bn[0]=n<<15,bn[0])}return r=r-127+15,r>=31?(bn[0]=n<<15|31744,bn[0]):r<=0?r<-10?(bn[0]=n<<15,bn[0]):(i=(8388608|i)>>1-r,bn[0]=n<<15|i>>13,bn[0]):(i>>=13,bn[0]=n<<15|r<<10|i,bn[0])}const H1=new Uint32Array(1),EP=new Float32Array(H1.buffer,0,1);function Yk(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return H1[0]=e,EP[0]}function hX(t,e,n,r,i,s,o,l,u){const d=r*(o>>=i)*(s>>=i)+n*o+e*l;switch(u){case"r8unorm":return[et(t,d,"8unorm",1)[0]];case"r8snorm":return[et(t,d,"8snorm",1)[0]];case"r8uint":return[et(t,d,"8uint",1)[0]];case"r8sint":return[et(t,d,"8sint",1)[0]];case"rg8unorm":{const h=et(t,d,"8unorm",2);return[h[0],h[1]]}case"rg8snorm":{const h=et(t,d,"8snorm",2);return[h[0],h[1]]}case"rg8uint":{const h=et(t,d,"8uint",2);return[h[0],h[1]]}case"rg8sint":{const h=et(t,d,"8sint",2);return[h[0],h[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const h=et(t,d,"8unorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8snorm":{const h=et(t,d,"8snorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8uint":{const h=et(t,d,"8uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba8sint":{const h=et(t,d,"8sint",4);return[h[0],h[1],h[2],h[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const h=et(t,d,"8unorm",4);return[h[2],h[1],h[0],h[3]]}case"r16uint":return[et(t,d,"16uint",1)[0]];case"r16sint":return[et(t,d,"16sint",1)[0]];case"r16float":return[et(t,d,"16float",1)[0]];case"rg16uint":{const h=et(t,d,"16uint",2);return[h[0],h[1]]}case"rg16sint":{const h=et(t,d,"16sint",2);return[h[0],h[1]]}case"rg16float":{const h=et(t,d,"16float",2);return[h[0],h[1]]}case"rgba16uint":{const h=et(t,d,"16uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16sint":{const h=et(t,d,"16sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16float":{const h=et(t,d,"16float",4);return[h[0],h[1],h[2],h[3]]}case"r32uint":return[et(t,d,"32uint",1)[0]];case"r32sint":return[et(t,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[et(t,d,"32float",1)[0]];case"rg32uint":{const h=et(t,d,"32uint",2);return[h[0],h[1]]}case"rg32sint":{const h=et(t,d,"32sint",2);return[h[0],h[1]]}case"rg32float":{const h=et(t,d,"32float",2);return[h[0],h[1]]}case"rgba32uint":{const h=et(t,d,"32uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32sint":{const h=et(t,d,"32sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32float":{const h=et(t,d,"32float",4);return[h[0],h[1],h[2],h[3]]}case"rg11b10ufloat":{const h=new Uint32Array(t.buffer,d,1)[0],m=(4192256&h)>>11,_=(4290772992&h)>>22;return[Yk(2047&h),Yk(m),function(y){const T=112+(y>>5&31)<<23|(31&y)<<18;return H1[0]=T,EP[0]}(_),1]}}return null}function et(t,e,n,r){const i=[0,0,0,0];for(let d=0;d<r;++d)switch(n){case"8unorm":i[d]=t[e]/255,e++;break;case"8snorm":i[d]=t[e]/255*2-1,e++;break;case"8uint":i[d]=t[e],e++;break;case"8sint":i[d]=t[e]-127,e++;break;case"16uint":i[d]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[d]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(s=t[e]|t[e+1]<<8,o=void 0,l=void 0,u=void 0,o=(32768&s)>>15,u=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):l==31?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+u/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,o,l,u;return i}function st(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=dX(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const xb={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class _r{constructor(){this.id=_r._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(nd.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(rd.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}_r._id=0;class nd extends _r{}nd.instance=new nd;class rd extends _r{}rd.instance=new rd;const AP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class At extends _r{constructor(){super()}}class Tc extends At{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class pX extends At{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class RP extends At{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class S0 extends At{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class CP extends At{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class mi extends At{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class W1 extends At{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class sc extends At{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Cf extends At{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var io,Kl,ce,ne;(t=>{t.increment="++",t.decrement="--"})(io||(io={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(io||(io={}));class NP extends At{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Kl||(Kl={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Kl||(Kl={}));class kP extends At{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class X1 extends At{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return AP.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class MP extends At{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class IP extends At{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class OP extends At{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class PP extends At{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class gX extends At{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class mX extends At{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class DP extends At{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class Y1 extends At{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class _X extends At{constructor(){super()}get astNodeType(){return"discard"}}class jP extends At{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class LP extends At{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _e extends At{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=_e._priority.get(n.name);_e._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?_e.i32:n}getTypeName(){return this.name}}_e.x32=new _e("x32"),_e.f32=new _e("f32"),_e.i32=new _e("i32"),_e.u32=new _e("u32"),_e.f16=new _e("f16"),_e.bool=new _e("bool"),_e.void=new _e("void"),_e._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Gk extends _e{constructor(e){super(e)}}class pi extends _e{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class ae extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ae.vec2f=new ae("vec2",_e.f32,null),ae.vec3f=new ae("vec3",_e.f32,null),ae.vec4f=new ae("vec4",_e.f32,null),ae.vec2i=new ae("vec2",_e.i32,null),ae.vec3i=new ae("vec3",_e.i32,null),ae.vec4i=new ae("vec4",_e.i32,null),ae.vec2u=new ae("vec2",_e.u32,null),ae.vec3u=new ae("vec3",_e.u32,null),ae.vec4u=new ae("vec4",_e.u32,null),ae.vec2h=new ae("vec2",_e.f16,null),ae.vec3h=new ae("vec3",_e.f16,null),ae.vec4h=new ae("vec4",_e.f16,null),ae.vec2b=new ae("vec2",_e.bool,null),ae.vec3b=new ae("vec3",_e.bool,null),ae.vec4b=new ae("vec4",_e.bool,null),ae.mat2x2f=new ae("mat2x2",_e.f32,null),ae.mat2x3f=new ae("mat2x3",_e.f32,null),ae.mat2x4f=new ae("mat2x4",_e.f32,null),ae.mat3x2f=new ae("mat3x2",_e.f32,null),ae.mat3x3f=new ae("mat3x3",_e.f32,null),ae.mat3x4f=new ae("mat3x4",_e.f32,null),ae.mat4x2f=new ae("mat4x2",_e.f32,null),ae.mat4x3f=new ae("mat4x3",_e.f32,null),ae.mat4x4f=new ae("mat4x4",_e.f32,null),ae.mat2x2h=new ae("mat2x2",_e.f16,null),ae.mat2x3h=new ae("mat2x3",_e.f16,null),ae.mat2x4h=new ae("mat2x4",_e.f16,null),ae.mat3x2h=new ae("mat3x2",_e.f16,null),ae.mat3x3h=new ae("mat3x3",_e.f16,null),ae.mat3x4h=new ae("mat3x4",_e.f16,null),ae.mat4x2h=new ae("mat4x2",_e.f16,null),ae.mat4x3h=new ae("mat4x3",_e.f16,null),ae.mat4x4h=new ae("mat4x4",_e.f16,null),ae.mat2x2i=new ae("mat2x2",_e.i32,null),ae.mat2x3i=new ae("mat2x3",_e.i32,null),ae.mat2x4i=new ae("mat2x4",_e.i32,null),ae.mat3x2i=new ae("mat3x2",_e.i32,null),ae.mat3x3i=new ae("mat3x3",_e.i32,null),ae.mat3x4i=new ae("mat3x4",_e.i32,null),ae.mat4x2i=new ae("mat4x2",_e.i32,null),ae.mat4x3i=new ae("mat4x3",_e.i32,null),ae.mat4x4i=new ae("mat4x4",_e.i32,null),ae.mat2x2u=new ae("mat2x2",_e.u32,null),ae.mat2x3u=new ae("mat2x3",_e.u32,null),ae.mat2x4u=new ae("mat2x4",_e.u32,null),ae.mat3x2u=new ae("mat3x2",_e.u32,null),ae.mat3x3u=new ae("mat3x3",_e.u32,null),ae.mat3x4u=new ae("mat3x4",_e.u32,null),ae.mat4x2u=new ae("mat4x2",_e.u32,null),ae.mat4x3u=new ae("mat4x3",_e.u32,null),ae.mat4x4u=new ae("mat4x4",_e.u32,null);class Nf extends _e{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class ac extends _e{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Zl extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Or extends _r{constructor(){super(),this.postfix=null}}class Ws extends Or{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class $r extends Or{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class G1 extends Or{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return AP.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Gn extends Or{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class BP extends Or{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Jt extends Or{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof te}get isVector(){return this.value instanceof W||this.value instanceof Le}get scalarValue(){return this.value instanceof te?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof W||this.value instanceof Le?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class UP extends Or{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class yo extends Or{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class FP extends Or{constructor(){super()}}class Xt extends FP{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Sr extends FP{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?_e.f32:e.name==="u32"||n.name==="u32"?_e.u32:_e.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class zP extends _r{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class kf extends Or{constructor(){super()}get astNodeType(){return"default"}}class $P extends zP{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class qP extends zP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Kk extends _r{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class vX extends _r{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Zk extends _r{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class VP extends _r{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class pr{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=pr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}pr._id=0;class E0 extends pr{constructor(){super(new fr("void",null),null)}toString(){return"void"}}E0.void=new E0;class Za extends pr{constructor(e){super(new T0("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class te extends pr{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new te(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new te(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new te(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function yX(t,e,n){const r=e.length;return r===2?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class W extends pr{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new W(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new W(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new W(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Ws?console.error("TODO: Set vector postfix"):n instanceof W?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Hs)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof yo){const o=n.index;let l=-1;if(o instanceof Jt){if(!(o.value instanceof te))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof te))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Ws))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=yX(e,l,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Le extends pr{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Le(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Ws?console.error("TODO: Set matrix postfix"):n instanceof Le?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Hs)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof yo){const s=n.index;let o=-1;if(s instanceof Jt){if(!(s.value instanceof te))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const d=e.evalExpression(s,r);if(!(d instanceof te))return console.error("GetDataValue: Unknown index type",s),null;o=d.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return n.postfix?u.getSubData(e,n.postfix,r):u}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Lt extends pr{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Lt(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof yo)if(o instanceof as){const l=r.index;if(l instanceof Jt){if(!(l.value instanceof te))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof te))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Ws))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof rs){let u=!1;for(const d of o.members)if(d.name===l){s+=d.offset,o=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof fr){const u=o.getTypeName();let d=0;if(l==="x"||l==="r")d=0;else if(l==="y"||l==="g")d=1;else if(l==="z"||l==="b")d=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);d=3}if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);const h=n.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=h):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=h):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=h):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=h):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=h):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=h):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=h):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=h):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(n instanceof Lt){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,i,16);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11],l[12]=n.data[12],l[13]=n.data[13],l[14]=n.data[14],l[15]=n.data[15]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,9);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,4);n instanceof Le?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Int32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Int32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Int32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Float32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Float32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Float32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let l=this.offset,u=this.typeInfo;for(;n;){if(n instanceof yo){const h=n.index,m=h instanceof Or?e.evalExpression(h,r):h;let _=0;if(m instanceof te?_=m.value:typeof m=="number"?_=m:console.error("GetDataValue: Invalid index type",h),u instanceof as)l+=_*u.stride,u=u.format;else{const y=u.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(l+=16*_,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(n instanceof Ws))return console.error("GetDataValue: Unknown postfix type",n),null;{const h=n.value;if(u instanceof rs){let m=!1;for(const _ of u.members)if(_.name===h){l+=_.offset,u=_.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${h} not found`),null}else if(u instanceof fr){const m=u.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(h.length>0&&h.length<5){let _="f";const y=[];for(let T=0;T<h.length;++T){const w=h[T].toLowerCase();let b=0;if(w==="x"||w==="r")b=0;else if(w==="y"||w==="g")b=1;else if(w==="z"||w==="b")b=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${h}`),null;b=3}if(h.length===1){if(m.endsWith("f"))return this.buffer.byteLength<l+4*b+4?(console.log("Insufficient buffer data"),null):new te(new Float32Array(this.buffer,l+4*b,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new te(new Float32Array(this.buffer,l+4*b,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new te(new Int32Array(this.buffer,l+4*b,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new te(new Int32Array(this.buffer,l+4*b,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new te(new Uint32Array(this.buffer,l+4*b,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")y.push(new Float32Array(this.buffer,l,2)[b]);else if(m==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,l,3);y.push(S[b])}else if(m==="vec4f")y.push(new Float32Array(this.buffer,l,4)[b]);else if(m==="vec2i")_="i",y.push(new Int32Array(this.buffer,l,2)[b]);else if(m==="vec3i")_="i",y.push(new Int32Array(this.buffer,l,3)[b]);else if(m==="vec4i")_="i",y.push(new Int32Array(this.buffer,l,4)[b]);else if(m==="vec2u"){_="u";const S=new Uint32Array(this.buffer,l,2);y.push(S[b])}else m==="vec3u"?(_="u",y.push(new Uint32Array(this.buffer,l,3)[b])):m==="vec4u"&&(_="u",y.push(new Uint32Array(this.buffer,l,4)[b]))}return y.length===2?u=e.getTypeInfo(`vec2${_}`):y.length===3?u=e.getTypeInfo(`vec3${_}`):y.length===4?u=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new W(y,u,null)}return console.error(`GetDataValue: Unknown member ${h}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}n=n.postfix}const d=u.getTypeName();return d==="f32"?new te(new Float32Array(this.buffer,l,1),u,this):d==="i32"?new te(new Int32Array(this.buffer,l,1),u,this):d==="u32"?new te(new Uint32Array(this.buffer,l,1),u,this):d==="vec2f"?new W(new Float32Array(this.buffer,l,2),u,this):d==="vec3f"?new W(new Float32Array(this.buffer,l,3),u,this):d==="vec4f"?new W(new Float32Array(this.buffer,l,4),u,this):d==="vec2i"?new W(new Int32Array(this.buffer,l,2),u,this):d==="vec3i"?new W(new Int32Array(this.buffer,l,3),u,this):d==="vec4i"?new W(new Int32Array(this.buffer,l,4),u,this):d==="vec2u"?new W(new Uint32Array(this.buffer,l,2),u,this):d==="vec3u"?new W(new Uint32Array(this.buffer,l,3),u,this):d==="vec4u"?new W(new Uint32Array(this.buffer,l,4),u,this):u instanceof Hs&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new te(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new te(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Lt(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof as)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof rs?e+="{...}":e="[...]";return e}}class gi extends pr{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new gi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=xb[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=xb[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=xb[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return hX(new Uint8Array(u),e,n,r,i,l,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,d=this.data[i];(function(h,m,_,y,T,w,b,S,A,R){const E=y*(b>>=T)*(w>>=T)+_*b+m*S;switch(A){case"r8unorm":return void st(h,E,"8unorm",1,R);case"r8snorm":return void st(h,E,"8snorm",1,R);case"r8uint":return void st(h,E,"8uint",1,R);case"r8sint":return void st(h,E,"8sint",1,R);case"rg8unorm":return void st(h,E,"8unorm",2,R);case"rg8snorm":return void st(h,E,"8snorm",2,R);case"rg8uint":return void st(h,E,"8uint",2,R);case"rg8sint":return void st(h,E,"8sint",2,R);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void st(h,E,"8unorm",4,R);case"rgba8snorm":return void st(h,E,"8snorm",4,R);case"rgba8uint":return void st(h,E,"8uint",4,R);case"rgba8sint":return void st(h,E,"8sint",4,R);case"r16uint":return void st(h,E,"16uint",1,R);case"r16sint":return void st(h,E,"16sint",1,R);case"r16float":return void st(h,E,"16float",1,R);case"rg16uint":return void st(h,E,"16uint",2,R);case"rg16sint":return void st(h,E,"16sint",2,R);case"rg16float":return void st(h,E,"16float",2,R);case"rgba16uint":return void st(h,E,"16uint",4,R);case"rgba16sint":return void st(h,E,"16sint",4,R);case"rgba16float":return void st(h,E,"16float",4,R);case"r32uint":return void st(h,E,"32uint",1,R);case"r32sint":return void st(h,E,"32sint",1,R);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void st(h,E,"32float",1,R);case"rg32uint":return void st(h,E,"32uint",2,R);case"rg32sint":return void st(h,E,"32sint",2,R);case"rg32float":return void st(h,E,"32float",2,R);case"rgba32uint":return void st(h,E,"32uint",4,R);case"rgba32sint":return void st(h,E,"32sint",4,R);case"rgba32float":return void st(h,E,"32float",4,R);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,n,r,i,u,l,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ne||(ne={}));class re{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class H{}ce=H,H.none=new re("",ne.reserved,""),H.eof=new re("EOF",ne.token,""),H.reserved={asm:new re("asm",ne.reserved,"asm"),bf16:new re("bf16",ne.reserved,"bf16"),do:new re("do",ne.reserved,"do"),enum:new re("enum",ne.reserved,"enum"),f16:new re("f16",ne.reserved,"f16"),f64:new re("f64",ne.reserved,"f64"),handle:new re("handle",ne.reserved,"handle"),i8:new re("i8",ne.reserved,"i8"),i16:new re("i16",ne.reserved,"i16"),i64:new re("i64",ne.reserved,"i64"),mat:new re("mat",ne.reserved,"mat"),premerge:new re("premerge",ne.reserved,"premerge"),regardless:new re("regardless",ne.reserved,"regardless"),typedef:new re("typedef",ne.reserved,"typedef"),u8:new re("u8",ne.reserved,"u8"),u16:new re("u16",ne.reserved,"u16"),u64:new re("u64",ne.reserved,"u64"),unless:new re("unless",ne.reserved,"unless"),using:new re("using",ne.reserved,"using"),vec:new re("vec",ne.reserved,"vec"),void:new re("void",ne.reserved,"void")},H.keywords={array:new re("array",ne.keyword,"array"),atomic:new re("atomic",ne.keyword,"atomic"),bool:new re("bool",ne.keyword,"bool"),f32:new re("f32",ne.keyword,"f32"),i32:new re("i32",ne.keyword,"i32"),mat2x2:new re("mat2x2",ne.keyword,"mat2x2"),mat2x3:new re("mat2x3",ne.keyword,"mat2x3"),mat2x4:new re("mat2x4",ne.keyword,"mat2x4"),mat3x2:new re("mat3x2",ne.keyword,"mat3x2"),mat3x3:new re("mat3x3",ne.keyword,"mat3x3"),mat3x4:new re("mat3x4",ne.keyword,"mat3x4"),mat4x2:new re("mat4x2",ne.keyword,"mat4x2"),mat4x3:new re("mat4x3",ne.keyword,"mat4x3"),mat4x4:new re("mat4x4",ne.keyword,"mat4x4"),ptr:new re("ptr",ne.keyword,"ptr"),sampler:new re("sampler",ne.keyword,"sampler"),sampler_comparison:new re("sampler_comparison",ne.keyword,"sampler_comparison"),struct:new re("struct",ne.keyword,"struct"),texture_1d:new re("texture_1d",ne.keyword,"texture_1d"),texture_2d:new re("texture_2d",ne.keyword,"texture_2d"),texture_2d_array:new re("texture_2d_array",ne.keyword,"texture_2d_array"),texture_3d:new re("texture_3d",ne.keyword,"texture_3d"),texture_cube:new re("texture_cube",ne.keyword,"texture_cube"),texture_cube_array:new re("texture_cube_array",ne.keyword,"texture_cube_array"),texture_multisampled_2d:new re("texture_multisampled_2d",ne.keyword,"texture_multisampled_2d"),texture_storage_1d:new re("texture_storage_1d",ne.keyword,"texture_storage_1d"),texture_storage_2d:new re("texture_storage_2d",ne.keyword,"texture_storage_2d"),texture_storage_2d_array:new re("texture_storage_2d_array",ne.keyword,"texture_storage_2d_array"),texture_storage_3d:new re("texture_storage_3d",ne.keyword,"texture_storage_3d"),texture_depth_2d:new re("texture_depth_2d",ne.keyword,"texture_depth_2d"),texture_depth_2d_array:new re("texture_depth_2d_array",ne.keyword,"texture_depth_2d_array"),texture_depth_cube:new re("texture_depth_cube",ne.keyword,"texture_depth_cube"),texture_depth_cube_array:new re("texture_depth_cube_array",ne.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new re("texture_depth_multisampled_2d",ne.keyword,"texture_depth_multisampled_2d"),texture_external:new re("texture_external",ne.keyword,"texture_external"),u32:new re("u32",ne.keyword,"u32"),vec2:new re("vec2",ne.keyword,"vec2"),vec3:new re("vec3",ne.keyword,"vec3"),vec4:new re("vec4",ne.keyword,"vec4"),bitcast:new re("bitcast",ne.keyword,"bitcast"),block:new re("block",ne.keyword,"block"),break:new re("break",ne.keyword,"break"),case:new re("case",ne.keyword,"case"),continue:new re("continue",ne.keyword,"continue"),continuing:new re("continuing",ne.keyword,"continuing"),default:new re("default",ne.keyword,"default"),diagnostic:new re("diagnostic",ne.keyword,"diagnostic"),discard:new re("discard",ne.keyword,"discard"),else:new re("else",ne.keyword,"else"),enable:new re("enable",ne.keyword,"enable"),fallthrough:new re("fallthrough",ne.keyword,"fallthrough"),false:new re("false",ne.keyword,"false"),fn:new re("fn",ne.keyword,"fn"),for:new re("for",ne.keyword,"for"),function:new re("function",ne.keyword,"function"),if:new re("if",ne.keyword,"if"),let:new re("let",ne.keyword,"let"),const:new re("const",ne.keyword,"const"),loop:new re("loop",ne.keyword,"loop"),while:new re("while",ne.keyword,"while"),private:new re("private",ne.keyword,"private"),read:new re("read",ne.keyword,"read"),read_write:new re("read_write",ne.keyword,"read_write"),return:new re("return",ne.keyword,"return"),requires:new re("requires",ne.keyword,"requires"),storage:new re("storage",ne.keyword,"storage"),switch:new re("switch",ne.keyword,"switch"),true:new re("true",ne.keyword,"true"),alias:new re("alias",ne.keyword,"alias"),type:new re("type",ne.keyword,"type"),uniform:new re("uniform",ne.keyword,"uniform"),var:new re("var",ne.keyword,"var"),override:new re("override",ne.keyword,"override"),workgroup:new re("workgroup",ne.keyword,"workgroup"),write:new re("write",ne.keyword,"write"),r8unorm:new re("r8unorm",ne.keyword,"r8unorm"),r8snorm:new re("r8snorm",ne.keyword,"r8snorm"),r8uint:new re("r8uint",ne.keyword,"r8uint"),r8sint:new re("r8sint",ne.keyword,"r8sint"),r16uint:new re("r16uint",ne.keyword,"r16uint"),r16sint:new re("r16sint",ne.keyword,"r16sint"),r16float:new re("r16float",ne.keyword,"r16float"),rg8unorm:new re("rg8unorm",ne.keyword,"rg8unorm"),rg8snorm:new re("rg8snorm",ne.keyword,"rg8snorm"),rg8uint:new re("rg8uint",ne.keyword,"rg8uint"),rg8sint:new re("rg8sint",ne.keyword,"rg8sint"),r32uint:new re("r32uint",ne.keyword,"r32uint"),r32sint:new re("r32sint",ne.keyword,"r32sint"),r32float:new re("r32float",ne.keyword,"r32float"),rg16uint:new re("rg16uint",ne.keyword,"rg16uint"),rg16sint:new re("rg16sint",ne.keyword,"rg16sint"),rg16float:new re("rg16float",ne.keyword,"rg16float"),rgba8unorm:new re("rgba8unorm",ne.keyword,"rgba8unorm"),rgba8unorm_srgb:new re("rgba8unorm_srgb",ne.keyword,"rgba8unorm_srgb"),rgba8snorm:new re("rgba8snorm",ne.keyword,"rgba8snorm"),rgba8uint:new re("rgba8uint",ne.keyword,"rgba8uint"),rgba8sint:new re("rgba8sint",ne.keyword,"rgba8sint"),bgra8unorm:new re("bgra8unorm",ne.keyword,"bgra8unorm"),bgra8unorm_srgb:new re("bgra8unorm_srgb",ne.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new re("rgb10a2unorm",ne.keyword,"rgb10a2unorm"),rg11b10float:new re("rg11b10float",ne.keyword,"rg11b10float"),rg32uint:new re("rg32uint",ne.keyword,"rg32uint"),rg32sint:new re("rg32sint",ne.keyword,"rg32sint"),rg32float:new re("rg32float",ne.keyword,"rg32float"),rgba16uint:new re("rgba16uint",ne.keyword,"rgba16uint"),rgba16sint:new re("rgba16sint",ne.keyword,"rgba16sint"),rgba16float:new re("rgba16float",ne.keyword,"rgba16float"),rgba32uint:new re("rgba32uint",ne.keyword,"rgba32uint"),rgba32sint:new re("rgba32sint",ne.keyword,"rgba32sint"),rgba32float:new re("rgba32float",ne.keyword,"rgba32float"),static_assert:new re("static_assert",ne.keyword,"static_assert")},H.tokens={decimal_float_literal:new re("decimal_float_literal",ne.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new re("hex_float_literal",ne.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new re("int_literal",ne.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new re("uint_literal",ne.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new re("name",ne.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new re("ident",ne.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new re("and",ne.token,"&"),and_and:new re("and_and",ne.token,"&&"),arrow:new re("arrow ",ne.token,"->"),attr:new re("attr",ne.token,"@"),forward_slash:new re("forward_slash",ne.token,"/"),bang:new re("bang",ne.token,"!"),bracket_left:new re("bracket_left",ne.token,"["),bracket_right:new re("bracket_right",ne.token,"]"),brace_left:new re("brace_left",ne.token,"{"),brace_right:new re("brace_right",ne.token,"}"),colon:new re("colon",ne.token,":"),comma:new re("comma",ne.token,","),equal:new re("equal",ne.token,"="),equal_equal:new re("equal_equal",ne.token,"=="),not_equal:new re("not_equal",ne.token,"!="),greater_than:new re("greater_than",ne.token,">"),greater_than_equal:new re("greater_than_equal",ne.token,">="),shift_right:new re("shift_right",ne.token,">>"),less_than:new re("less_than",ne.token,"<"),less_than_equal:new re("less_than_equal",ne.token,"<="),shift_left:new re("shift_left",ne.token,"<<"),modulo:new re("modulo",ne.token,"%"),minus:new re("minus",ne.token,"-"),minus_minus:new re("minus_minus",ne.token,"--"),period:new re("period",ne.token,"."),plus:new re("plus",ne.token,"+"),plus_plus:new re("plus_plus",ne.token,"++"),or:new re("or",ne.token,"|"),or_or:new re("or_or",ne.token,"||"),paren_left:new re("paren_left",ne.token,"("),paren_right:new re("paren_right",ne.token,")"),semicolon:new re("semicolon",ne.token,";"),star:new re("star",ne.token,"*"),tilde:new re("tilde",ne.token,"~"),underscore:new re("underscore",ne.token,"_"),xor:new re("xor",ne.token,"^"),plus_equal:new re("plus_equal",ne.token,"+="),minus_equal:new re("minus_equal",ne.token,"-="),times_equal:new re("times_equal",ne.token,"*="),division_equal:new re("division_equal",ne.token,"/="),modulo_equal:new re("modulo_equal",ne.token,"%="),and_equal:new re("and_equal",ne.token,"&="),or_equal:new re("or_equal",ne.token,"|="),xor_equal:new re("xor_equal",ne.token,"^="),shift_right_equal:new re("shift_right_equal",ne.token,">>="),shift_left_equal:new re("shift_left_equal",ne.token,"<<=")},H.simpleTokens={"@":ce.tokens.attr,"{":ce.tokens.brace_left,"}":ce.tokens.brace_right,":":ce.tokens.colon,",":ce.tokens.comma,"(":ce.tokens.paren_left,")":ce.tokens.paren_right,";":ce.tokens.semicolon},H.literalTokens={"&":ce.tokens.and,"&&":ce.tokens.and_and,"->":ce.tokens.arrow,"/":ce.tokens.forward_slash,"!":ce.tokens.bang,"[":ce.tokens.bracket_left,"]":ce.tokens.bracket_right,"=":ce.tokens.equal,"==":ce.tokens.equal_equal,"!=":ce.tokens.not_equal,">":ce.tokens.greater_than,">=":ce.tokens.greater_than_equal,">>":ce.tokens.shift_right,"<":ce.tokens.less_than,"<=":ce.tokens.less_than_equal,"<<":ce.tokens.shift_left,"%":ce.tokens.modulo,"-":ce.tokens.minus,"--":ce.tokens.minus_minus,".":ce.tokens.period,"+":ce.tokens.plus,"++":ce.tokens.plus_plus,"|":ce.tokens.or,"||":ce.tokens.or_or,"*":ce.tokens.star,"~":ce.tokens.tilde,_:ce.tokens.underscore,"^":ce.tokens.xor,"+=":ce.tokens.plus_equal,"-=":ce.tokens.minus_equal,"*=":ce.tokens.times_equal,"/=":ce.tokens.division_equal,"%=":ce.tokens.modulo_equal,"&=":ce.tokens.and_equal,"|=":ce.tokens.or_equal,"^=":ce.tokens.xor_equal,">>=":ce.tokens.shift_right_equal,"<<=":ce.tokens.shift_left_equal},H.regexTokens={decimal_float_literal:ce.tokens.decimal_float_literal,hex_float_literal:ce.tokens.hex_float_literal,int_literal:ce.tokens.int_literal,uint_literal:ce.tokens.uint_literal,ident:ce.tokens.ident},H.storage_class=[ce.keywords.function,ce.keywords.private,ce.keywords.workgroup,ce.keywords.uniform,ce.keywords.storage],H.access_mode=[ce.keywords.read,ce.keywords.write,ce.keywords.read_write],H.sampler_type=[ce.keywords.sampler,ce.keywords.sampler_comparison],H.sampled_texture_type=[ce.keywords.texture_1d,ce.keywords.texture_2d,ce.keywords.texture_2d_array,ce.keywords.texture_3d,ce.keywords.texture_cube,ce.keywords.texture_cube_array],H.multisampled_texture_type=[ce.keywords.texture_multisampled_2d],H.storage_texture_type=[ce.keywords.texture_storage_1d,ce.keywords.texture_storage_2d,ce.keywords.texture_storage_2d_array,ce.keywords.texture_storage_3d],H.depth_texture_type=[ce.keywords.texture_depth_2d,ce.keywords.texture_depth_2d_array,ce.keywords.texture_depth_cube,ce.keywords.texture_depth_cube_array,ce.keywords.texture_depth_multisampled_2d],H.texture_external_type=[ce.keywords.texture_external],H.any_texture_type=[...ce.sampled_texture_type,...ce.multisampled_texture_type,...ce.storage_texture_type,...ce.depth_texture_type,...ce.texture_external_type],H.texel_format=[ce.keywords.r8unorm,ce.keywords.r8snorm,ce.keywords.r8uint,ce.keywords.r8sint,ce.keywords.r16uint,ce.keywords.r16sint,ce.keywords.r16float,ce.keywords.rg8unorm,ce.keywords.rg8snorm,ce.keywords.rg8uint,ce.keywords.rg8sint,ce.keywords.r32uint,ce.keywords.r32sint,ce.keywords.r32float,ce.keywords.rg16uint,ce.keywords.rg16sint,ce.keywords.rg16float,ce.keywords.rgba8unorm,ce.keywords.rgba8unorm_srgb,ce.keywords.rgba8snorm,ce.keywords.rgba8uint,ce.keywords.rgba8sint,ce.keywords.bgra8unorm,ce.keywords.bgra8unorm_srgb,ce.keywords.rgb10a2unorm,ce.keywords.rg11b10float,ce.keywords.rg32uint,ce.keywords.rg32sint,ce.keywords.rg32float,ce.keywords.rgba16uint,ce.keywords.rgba16sint,ce.keywords.rgba16float,ce.keywords.rgba32uint,ce.keywords.rgba32sint,ce.keywords.rgba32float],H.const_literal=[ce.tokens.int_literal,ce.tokens.uint_literal,ce.tokens.decimal_float_literal,ce.tokens.hex_float_literal,ce.keywords.true,ce.keywords.false],H.literal_or_ident=[ce.tokens.ident,ce.tokens.int_literal,ce.tokens.uint_literal,ce.tokens.decimal_float_literal,ce.tokens.hex_float_literal,ce.tokens.name],H.element_count_expression=[ce.tokens.int_literal,ce.tokens.uint_literal,ce.tokens.ident],H.template_types=[ce.keywords.vec2,ce.keywords.vec3,ce.keywords.vec4,ce.keywords.mat2x2,ce.keywords.mat2x3,ce.keywords.mat2x4,ce.keywords.mat3x2,ce.keywords.mat3x3,ce.keywords.mat3x4,ce.keywords.mat4x2,ce.keywords.mat4x3,ce.keywords.mat4x4,ce.keywords.atomic,ce.keywords.bitcast,...ce.any_texture_type],H.attribute_name=[ce.tokens.ident,ce.keywords.block,ce.keywords.diagnostic],H.assignment_operators=[ce.tokens.equal,ce.tokens.plus_equal,ce.tokens.minus_equal,ce.tokens.times_equal,ce.tokens.division_equal,ce.tokens.modulo_equal,ce.tokens.and_equal,ce.tokens.or_equal,ce.tokens.xor_equal,ce.tokens.shift_right_equal,ce.tokens.shift_left_equal],H.increment_operators=[ce.tokens.plus_plus,ce.tokens.minus_minus];class Qk{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return H.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==H.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class xX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Qk(H.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=H.simpleTokens[e];if(n)return this._addToken(n),!0;let r=H.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=H.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(H.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(H.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(H.tokens.minus_minus),!0;const u=this._tokens.length-1;if((H.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==H.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,d=this._tokens.length-1;for(let h=0;h<5&&d>=0&&H.assignment_operators.indexOf(this._tokens[d].type)===-1;++h,--d)if(this._tokens[d].type===H.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===H.none){let u=e,d=0;const h=2;for(let m=0;m<h;++m)if(u+=this._peekAhead(m),o=this._findType(u),o!==H.none){d=m;break}if(o===H.none)return r!==H.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=d+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==H.none&&(this._addToken(r),!0)}_findType(e){for(const r in H.regexTokens){const i=H.regexTokens[r];if(this._match(e,i.rule))return i}return H.literalTokens[e]||H.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Qk(e,n,this._line,this._start,this._current))}}function Se(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const id=new Float32Array(1),bX=new Uint32Array(id.buffer),wX=new Uint32Array(id.buffer),sd=new Int32Array(1),TX=new Float32Array(sd.buffer),SX=new Uint32Array(sd.buffer),ad=new Uint32Array(1),EX=new Float32Array(ad.buffer),AX=new Int32Array(ad.buffer);function Jk(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return id[0]=t,bX[0];if(n==="u32")return id[0]=t,wX[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return sd[0]=t,TX[0];if(n==="u32")return sd[0]=t,SX[0]}else if(e==="u32"){if(n==="f32")return ad[0]=t,EX[0];if(n==="i32"||n==="x32")return ad[0]=t,AX[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class RX{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class df{constructor(e,n){this.align=e,this.size=n}}class Vr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new uX,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof Tc&&this._functions.set(n.name,new RX(n));for(const n of e)if(n instanceof pi){const r=this.getTypeInfo(n,null);r instanceof rs&&this.structs.push(r)}for(const n of e)if(n instanceof Y1)this.aliases.push(this._getAliasInfo(n));else if(n instanceof W1){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new oX(r.name,s,r.attributes,i))}else if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new ff(r.name,o,i,s,r.attributes,Ki.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new ff(r.name,o,i,s,r.attributes,l?Ki.StorageTexture:Ki.Storage,r.access);u.access||(u.access="read"),this.storage.push(u)}else if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new ff(r.name,o,i,s,r.attributes,l?Ki.StorageTexture:Ki.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new ff(r.name,o,i,s,r.attributes,Ki.Sampler,r.access);this.samplers.push(l)}for(const n of e)if(n instanceof Tc){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,l=new cX(n.name,o==null?void 0:o.name,n.attributes);l.attributes=n.attributes,l.startLine=n.startLine,l.endLine=n.endLine,this.functions.push(l),this._functions.get(n.name).info=l,o&&(this._functions.get(n.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(n,!!o),l.inputs=this._getInputs(n.args),l.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(l)),l.arguments=n.args.map(u=>new lX(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof VP){if(r.value)if(Se(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=n.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=n.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Gn)for(const l of this.overrides)r.name===l.name&&((o=n.info)===null||o===void 0||o.overrides.push(l))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof nd)s.push({});else if(o instanceof rd)s.pop();else if(o instanceof mi){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof $r){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof sc){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Gn){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof G1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}else if(o instanceof X1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof pi)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof pi)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new Xk(r.name,s,i.name,o);n.push(l)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Xk("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof pi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof pi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new aX(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new sX(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Nf){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new T0(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ac){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new as(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof pi){const i=e,s=new rs(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new Wk(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Zl){const i=e,s=i.format instanceof _e,o=i.format?s?this.getTypeInfo(i.format,null):new fr(i.format,null):null,l=new Hs(i.name,o,n,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof ae){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Hs(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new fr(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof as&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof T0&&this._updateTypeInfo(e.format),e instanceof rs&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const d=e.members[l],h=this._getTypeSize(d);if(!h)continue;(n=this._getAlias(d.type.name))!==null&&n!==void 0||d.type;const m=h.align,_=h.size;r=this._roundUp(m,r+i),i=_,s=r,o=Math.max(o,m),d.offset=r,d.size=_,this._updateTypeInfo(d.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Wk&&(e=e.type),e instanceof fr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Vr._typeInfo[e.name];if(o!==void 0){const l=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new df(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Vr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new df(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof as){let o=e,l=8,u=8;const d=this._getTypeSize(o.format);return d!==null&&(u=d.size,l=d.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new df(Math.max(s,l),Math.max(i,u))}if(e instanceof rs){let o=0,l=0,u=0,d=0,h=0;for(const m of e.members){const _=this._getTypeSize(m.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+d),d=_.size,h=u)}return l=this._roundUp(o,h+d),new df(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof mi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof mi&&e.storage=="storage"}_isTextureVar(e){return e instanceof mi&&e.type!==null&&Vr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof mi&&e.type!==null&&Vr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Vr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Vr._textureTypes=H.any_texture_type.map(t=>t.name),Vr._samplerTypes=H.sampler_type.map(t=>t.name);let K1=0;class Z1{constructor(e,n,r){this.id=K1++,this.name=e,this.value=n,this.node=r}clone(){return new Z1(this.name,this.value,this.node)}}class Q1{constructor(e){this.id=K1++,this.name=e.name,this.node=e}clone(){return new Q1(this.node)}}class J1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=K1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new Z1(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new J1(this)}}class CX{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class NX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof W)return r.data.forEach(s=>{s||(i=!1)}),new te(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){const i=r.data.some(s=>s);return new te(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof te))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Lt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new te(o,this.getTypeInfo("u32"))}return new te(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new te(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new te(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new te(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new te(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new te(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new te(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new te(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new te(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((d,h)=>this._clamp(d,i.data[h],s.data[h])),r.typeInfo);const o=r,l=i,u=s;return new te(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new te(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new te(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new te(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new W([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof W?new W(r.data.map(s=>s*i),r.typeInfo):new te(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Le){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new te(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new te(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new te(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof W&&i instanceof W?new te(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new te(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new te(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof W)return new W(r.data.map(d=>d>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new te(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W){const o=this._dot(i.data,s.data);return new W(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new te(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new te(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new te(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new W(r.data.map((d,h)=>d*i.data[h]+s.data[h]),r.typeInfo);const o=r,l=i,u=s;return new te(o.value*l.value+u.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new te(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,d=~u;if(r instanceof W&&i instanceof W)return new W(r.data.map((_,y)=>_&d|i.data[y]<<l&u),r.typeInfo);const h=r.value,m=i.value;return new te(h&d|m<<l&u,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new te(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){let s=0;return r.data.forEach(o=>{s+=o*o}),new te(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new te(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new te(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new te(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((u,d)=>r.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),r.typeInfo);const o=i,l=s;return new te(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new te(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){const i=this.Length(e,n).value;return new W(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof W?new W(r.data.map(i=>i),r.typeInfo):new te(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof W?new W(r.data.map(i=>i*Math.PI/180),r.typeInfo):new te(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){const s=this._dot(r.data,i.data);return new W(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof te){const o=this._dot(i.data,r.data);return new W(r.data.map((l,u)=>{const d=1-s.value*s.value*(1-o*o);if(d<0)return 0;const h=Math.sqrt(d);return s.value*l-(s.value*o+h)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new te(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new te(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new te(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new te(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new te(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof W&&r instanceof W&&i instanceof W)return new W(s.data.map((d,h)=>this._smoothstep(r.data[h],i.data[h],d)),s.typeInfo);const o=r,l=i,u=s;return new te(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new te(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof W&&r instanceof W)return new W(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new te(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new te(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new te(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof Le))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Le([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Le([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Le([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Le([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Le([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Le([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Le([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Le([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Le([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new te(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof Gn){const s=r.name,o=n.getVariableValue(s);if(o instanceof gi){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new te(l[0],this.getTypeInfo("u32")):u==="3d"?new W(l,this.getTypeInfo("vec3u")):u==="2d"?new W(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Gn){const o=r.name,l=n.getVariableValue(o);if(l instanceof gi){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=l.width||d<0||d>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const h=l.getPixel(u,d,0,s);return h===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new W(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof Gn){const i=r.name,s=n.getVariableValue(i);return s instanceof gi?new te(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof Gn){const i=r.name,s=n.getVariableValue(i);return s instanceof gi?new te(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof Gn){const i=r.name,s=n.getVariableValue(i);return s instanceof gi?new te(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Gn){const l=r.name,u=n.getVariableValue(l);if(u instanceof gi){const d=u.getMipLevelSize(0),h=Math.floor(i.data[0]),m=Math.floor(i.data[1]);return h<0||h>=d[0]||m<0||m>=d[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(h,m,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value+=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicSub(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value-=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMax(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.max(u.value,l.value)),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMin(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.min(u.value,l.value)),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicAnd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value&l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicOr(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value|l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicXor(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value^l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicExchange(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Lt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const bb={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},En={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class wn extends CX{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Vr,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new J1,this.builtins=new NX(this),this.typeInfo={bool:this.getTypeInfo(_e.bool),i32:this.getTypeInfo(_e.i32),u32:this.getTypeInfo(_e.u32),f32:this.getTypeInfo(_e.f32),f16:this.getTypeInfo(_e.f16),vec2f:this.getTypeInfo(ae.vec2f),vec2u:this.getTypeInfo(ae.vec2u),vec2i:this.getTypeInfo(ae.vec2i),vec2h:this.getTypeInfo(ae.vec2h),vec3f:this.getTypeInfo(ae.vec3f),vec3u:this.getTypeInfo(ae.vec3u),vec3i:this.getTypeInfo(ae.vec3i),vec3h:this.getTypeInfo(ae.vec3h),vec4f:this.getTypeInfo(ae.vec4f),vec4u:this.getTypeInfo(ae.vec4u),vec4i:this.getTypeInfo(ae.vec4i),vec4h:this.getTypeInfo(ae.vec4h),mat2x2f:this.getTypeInfo(ae.mat2x2f),mat2x3f:this.getTypeInfo(ae.mat2x3f),mat2x4f:this.getTypeInfo(ae.mat2x4f),mat3x2f:this.getTypeInfo(ae.mat3x2f),mat3x3f:this.getTypeInfo(ae.mat3x3f),mat3x4f:this.getTypeInfo(ae.mat3x4f),mat4x2f:this.getTypeInfo(ae.mat4x2f),mat4x3f:this.getTypeInfo(ae.mat4x3f),mat4x4f:this.getTypeInfo(ae.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof te)return i.value;if(i instanceof W||i instanceof Le)return Array.from(i.data);if(i instanceof Lt&&i.typeInfo instanceof as){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const l=n[0],u=n[1],d=n[2],h=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new W(n,h));for(const m in r)for(const _ in r[m]){const y=r[m][_];s.variables.forEach(T=>{var w;const b=T.node;if(b!=null&&b.attributes){let S=null,A=null;for(const R of b.attributes)R.name==="binding"?S=R.value:R.name==="group"&&(A=R.value);if(_==S&&m==A)if(y.texture!==void 0&&y.descriptor!==void 0){const R=new gi(y.texture,this.getTypeInfo(b.type),y.descriptor,(w=y.texture.view)!==null&&w!==void 0?w:null);T.value=R}else y.uniform!==void 0?T.value=new Lt(y.uniform,this.getTypeInfo(b.type)):T.value=new Lt(y,this.getTypeInfo(b.type))}})}for(let m=0;m<d;++m)for(let _=0;_<u;++_)for(let y=0;y<l;++y)s.setVariable("@workgroup_id",new W([y,_,m],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,_,m],s)}execStatement(e,n){if(e instanceof PP)return this.evalExpression(e.value,n);if(e instanceof jP){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof te))throw new Error("Invalid break-if condition");if(!r.value)return null}return wn._breakObj}if(e instanceof LP)return wn._continueObj;if(e instanceof sc)this._let(e,n);else if(e instanceof mi)this._var(e,n);else if(e instanceof Cf)this._const(e,n);else if(e instanceof Tc)this._function(e,n);else{if(e instanceof OP)return this._if(e,n);if(e instanceof IP)return this._switch(e,n);if(e instanceof CP)return this._for(e,n);if(e instanceof RP)return this._while(e,n);if(e instanceof MP)return this._loop(e,n);if(e instanceof S0){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof kP)this._assign(e,n);else if(e instanceof NP)this._increment(e,n);else{if(e instanceof pi)return null;if(e instanceof W1){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new te(0,this.getTypeInfo("u32")))}else if(e instanceof X1)this._call(e,n);else{if(e instanceof DP||e instanceof Y1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Sr?this._evalBinaryOp(e,n):e instanceof Jt?this._evalLiteral(e,n):e instanceof Gn?this._evalVariable(e,n):e instanceof G1?this._evalCall(e,n):e instanceof $r?this._evalCreate(e,n):e instanceof BP?this._evalConst(e,n):e instanceof UP?this._evalBitcast(e,n):e instanceof Xt?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof _e){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new te(i,s.type)):s.type.name==="bool"?n.setVariable(r,new te(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new W(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const m=r.getVariableValue(h.value[0]);i[0]=m instanceof te?m.value:parseInt(h.value[0])}if(h.value.length>1){const m=r.getVariableValue(h.value[1]);i[1]=m instanceof te?m.value:parseInt(h.value[1])}if(h.value.length>2){const m=r.getVariableValue(h.value[2]);i[2]=m instanceof te?m.value:parseInt(h.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new W(i,s));const l=i[0],u=i[1],d=i[2];for(let h=0,m=0;h<d;++h)for(let _=0;_<u;++_)for(let y=0;y<l;++y,++m){const T=[y,_,h],w=[y+n[0]*i[0],_+n[1]*i[1],h+n[2]*i[2]];r.setVariable("@local_invocation_id",new W(T,s)),r.setVariable("@global_invocation_id",new W(w,s)),r.setVariable("@local_invocation_index",new te(m,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Xt;)e=e.right;return e instanceof Gn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof te?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof te?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Gn){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Xt){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof Za?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new Za(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Xt){const u=this._getVariableData(e.variable,n),d=this.evalExpression(e.value,n),h=e.operator;if(h==="="){if(u instanceof te||u instanceof W||u instanceof Le){if(d instanceof te||d instanceof W||d instanceof Le&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Lt&&d instanceof Lt&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(h==="+=")return u instanceof te||u instanceof W||u instanceof Le?d instanceof te||d instanceof W||d instanceof Le?void u.data.set(d.data.map((m,_)=>u.data[_]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(h==="-=")return(u instanceof te||u instanceof W||u instanceof Le)&&(d instanceof te||d instanceof W||d instanceof Le)?void u.data.set(d.data.map((m,_)=>u.data[_]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Xt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const u=n.getVariable(i);if(!(u&&u.value instanceof Za))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let d=e.variable.postfix;if(!d){let h=e.variable.right;for(;h instanceof Xt;){if(h.postfix){d=h.postfix;break}h=h.right}}d&&(r=r.getSubData(this,d,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const u=n.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof Za&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),l=e.operator;if(l==="=")if(r instanceof Lt)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof W||r instanceof Le))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof yo){const u=this.evalExpression(s.index,n).value;if(r instanceof W){if(!(o instanceof te))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Le))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,n).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=r.typeInfo.getTypeName();if(h==="mat2x2"||h==="mat2x2f"||h==="mat2x2h"){if(!(d<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat2x3"||h==="mat2x3f"||h==="mat2x3h"){if(!(d<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat2x4"||h==="mat2x4f"||h==="mat2x4h"){if(!(d<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat3x2"||h==="mat3x2f"||h==="mat3x2h"){if(!(d<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat3x3"||h==="mat3x3f"||h==="mat3x3h"){if(!(d<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat3x4"||h==="mat3x4f"||h==="mat3x4h"){if(!(d<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat4x2"||h==="mat4x2f"||h==="mat4x2h"){if(!(d<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat4x3"||h==="mat4x3f"||h==="mat4x3h"){if(!(d<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else{if(h!=="mat4x4"&&h!=="mat4x4f"&&h!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}}}}}else if(s instanceof Ws){const u=s.value;if(!(r instanceof W))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof te){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const h=u[d];if(h==="x"||h==="r")r.data[0]=o.data[d];else if(h==="y"||h==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[d]}else if(h==="z"||h==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[d]}else{if(h!=="w"&&h!=="a")return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[d]}}}}}else r instanceof te&&o instanceof te?r.value=o.value:r instanceof W&&o instanceof W||r instanceof Le&&o instanceof Le?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const u=r.getSubData(this,s,n);if(u instanceof W&&o instanceof te){const d=u.data,h=o.value;if(l==="+=")for(let m=0;m<d.length;++m)d[m]+=h;else if(l==="-=")for(let m=0;m<d.length;++m)d[m]-=h;else if(l==="*=")for(let m=0;m<d.length;++m)d[m]*=h;else if(l==="/=")for(let m=0;m<d.length;++m)d[m]/=h;else if(l==="%=")for(let m=0;m<d.length;++m)d[m]%=h;else if(l==="&=")for(let m=0;m<d.length;++m)d[m]&=h;else if(l==="|=")for(let m=0;m<d.length;++m)d[m]|=h;else if(l==="^=")for(let m=0;m<d.length;++m)d[m]^=h;else if(l==="<<=")for(let m=0;m<d.length;++m)d[m]<<=h;else if(l===">>=")for(let m=0;m<d.length;++m)d[m]>>=h;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof W&&o instanceof W){const d=u.data,h=o.data;if(d.length!==h.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let m=0;m<d.length;++m)d[m]+=h[m];else if(l==="-=")for(let m=0;m<d.length;++m)d[m]-=h[m];else if(l==="*=")for(let m=0;m<d.length;++m)d[m]*=h[m];else if(l==="/=")for(let m=0;m<d.length;++m)d[m]/=h[m];else if(l==="%=")for(let m=0;m<d.length;++m)d[m]%=h[m];else if(l==="&=")for(let m=0;m<d.length;++m)d[m]&=h[m];else if(l==="|=")for(let m=0;m<d.length;++m)d[m]|=h[m];else if(l==="^=")for(let m=0;m<d.length;++m)d[m]^=h[m];else if(l==="<<=")for(let m=0;m<d.length;++m)d[m]<<=h[m];else if(l===">>=")for(let m=0;m<d.length;++m)d[m]>>=h[m];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof te&&o instanceof te))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}r instanceof Lt&&r.setDataValue(this,u,s,n)}}_function(e,n){const r=new Q1(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new $r(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof ac||e.type instanceof pi||e.type instanceof ae){const s=new $r(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof $P)for(const o of s.selectors){if(o instanceof kf){i=s;continue}const l=this.evalExpression(o,n);if(!(l instanceof te))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,n)}else s instanceof qP&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof te?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r!==null&&r!==wn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r===wn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===wn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===wn._breakObj)break;if(r!==wn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof te){const s=Jk(r.value,r.typeInfo.name,i.name);return new te(s,this.getTypeInfo(i))}if(r instanceof W){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(h,m,_){if(m===_)return h;const y=new Array(h.length);for(let T=0;T<h.length;T++)y[T]=Jk(h[T],m,_);return y}(Array.from(r.data),o,u);return new W(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof $r){if(e.type===null)return E0.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof $r?e.type.name:e.name,s=e instanceof $r?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Lt(new ArrayBuffer(s.size),s,0);if(s instanceof rs){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],d=e.args[l],h=this.evalExpression(d,n);o.setData(this,h,u.type,u.offset,n)}}else if(s instanceof as){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],h=this.evalExpression(d,n);s.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=h.typeInfo),o.setData(this,h,s.format,l,n),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof $r?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new te(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=wn._priority.get(n.name);wn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new Za(r);if(e.operator==="*")return r instanceof Za?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof te?r.value:r instanceof W?Array.from(r.data):null;switch(e.operator){case"+":{if(Se(i)){const l=i.map((u,d)=>+u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(+s,o)}case"-":{if(Se(i)){const l=i.map((u,d)=>-u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(-s,o)}case"!":{if(Se(i)){const l=i.map((u,d)=>u?0:1);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(s?0:1,o)}case"~":{if(Se(i)){const l=i.map((u,d)=>~u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof te?r.value:r instanceof W||r instanceof Le?Array.from(r.data):null,o=i instanceof te?i.value:i instanceof W||i instanceof Le?Array.from(i.data):null;switch(e.operator){case"+":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y+m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_+h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h+_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l+u,d)}case"-":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y-m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_-h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h-_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l-u,d)}case"*":{if(Se(s)&&Se(o)){const h=s,m=o;if(r instanceof Le&&i instanceof Le){const _=function(b,S,A,R){if(En[S.name]===void 0||En[R.name]===void 0)return null;const E=En[S.name][0],C=En[S.name][1],O=En[R.name][0];if(E!==En[R.name][1])return null;const P=new Array(O*C);for(let k=0;k<C;k++)for(let I=0;I<O;I++){let N=0;for(let L=0;L<E;L++)N+=b[L*C+k]*A[I*E+L];P[k*O+I]=N}return P}(h,r.typeInfo,m,i.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const y=En[i.typeInfo.name][0],T=En[r.typeInfo.name][1],w=this.getTypeInfo(`mat${y}x${T}f`);return new Le(_,w)}if(r instanceof Le&&i instanceof W){const _=function(y,T,w,b){if(En[T.name]===void 0||bb[b.name]===void 0)return null;const S=En[T.name][0],A=En[T.name][1];if(S!==w.length)return null;const R=new Array(A);for(let E=0;E<A;E++){let C=0;for(let O=0;O<S;O++)C+=y[O*A+E]*w[O];R[E]=C}return R}(h,r.typeInfo,m,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,i.typeInfo)}if(r instanceof W&&i instanceof Le){const _=function(y,T,w,b){if(bb[T.name]===void 0||En[b.name]===void 0)return null;const S=En[b.name][0],A=En[b.name][1];if(A!==y.length)return null;const R=[];for(let E=0;E<S;E++){let C=0;for(let O=0;O<A;O++)C+=y[O]*w[O*S+E];R[E]=C}return R}(h,r.typeInfo,m,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,r.typeInfo)}{if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y*m[T]);return new W(_,r.typeInfo)}}if(Se(s)){const h=o,m=s.map((_,y)=>_*h);return r instanceof Le?new Le(m,r.typeInfo):new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h*_);return i instanceof Le?new Le(m,i.typeInfo):new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l*u,d)}case"%":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y%m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_%h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h%_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l%u,d)}case"/":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y/m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_/h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h/_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l/u,d)}case"&":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y&m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_&h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h&_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l&u,d)}case"|":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y|m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_|h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h|_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l|u,d)}case"^":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y^m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_^h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h^_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l^u,d)}case"<<":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y<<m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_<<h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h<<_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l<<u,d)}case">>":{if(Se(s)&&Se(o)){const h=s,m=o;if(h.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y>>m[T]);return new W(_,r.typeInfo)}if(Se(s)){const h=o,m=s.map((_,y)=>_>>h);return new W(m,r.typeInfo)}if(Se(o)){const h=s,m=o.map((_,y)=>h>>_);return new W(m,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l>>u,d)}case">":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h>u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d>l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l>d?1:0);return new W(u,i.typeInfo)}return new te(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h<u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d<l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l<d?1:0);return new W(u,i.typeInfo)}return new te(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h===u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d==l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l==d?1:0);return new W(u,i.typeInfo)}return new te(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h!==u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d!==l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l!==d?1:0);return new W(u,i.typeInfo)}return new te(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h>=u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d>=l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l>=d?1:0);return new W(u,i.typeInfo)}return new te(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h<=u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d<=l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l<=d?1:0);return new W(u,i.typeInfo)}return new te(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h&&u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d&&l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l&&d?1:0);return new W(u,i.typeInfo)}return new te(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Se(s)&&Se(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,m)=>h||u[m]?1:0);return new W(d,r.typeInfo)}if(Se(s)){const l=o,u=s.map((d,h)=>d||l?1:0);return new W(u,r.typeInfo)}if(Se(o)){const l=s,u=o.map((d,h)=>l||d?1:0);return new W(u,i.typeInfo)}return new te(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothStep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new te(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=bb[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Jt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);if(u instanceof W){const d=u.data;for(let h=0;h<d.length;++h){let m=d[h];o.push(m)}}else if(u instanceof te){let d=u.value;o.push(d)}}if(e.type instanceof ae&&e.type.format===null&&(e.type.format=ae.f32),o.length===0){const l=new Array(s).fill(0);return new W(l,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new W(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=En[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Jt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);u instanceof W?o.push(...u.data):u instanceof te?o.push(u.value):u instanceof Le&&o.push(...u.data)}if(r instanceof Hs&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new Le(l,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Le(o,r).getSubData(this,e.postfix,n)}}wn._breakObj=new pr(new fr("BREAK",null),null),wn._continueObj=new pr(new fr("CONTINUE",null),null),wn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class kX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class MX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new kX,this._exec=new wn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Gn){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof Zk||i instanceof Nf?i.type=this._forwardType(i.type):i instanceof ac?i.format=this._forwardType(i.format):i instanceof mi||i instanceof sc||i instanceof Cf?i.type=this._forwardType(i.type):i instanceof Tc?i.returnType=this._forwardType(i.returnType):i instanceof Kk&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof Gk){const n=this._getType(e.name);if(n)return n}else e instanceof Nf?e.type=this._forwardType(e.type):e instanceof ac&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new xX(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==H.eof}_match(e){if(e instanceof re)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===H.tokens.name&&(i=!0)}if(i){const s=H.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===H.tokens.name){const r=H.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(H.tokens.semicolon)&&!this._isAtEnd(););if(this._match(H.keywords.alias)){const n=this._type_alias();return this._consume(H.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(H.keywords.diagnostic)){const n=this._diagnostic();return this._consume(H.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(H.keywords.requires)){const n=this._requires_directive();return this._consume(H.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(H.keywords.enable)){const n=this._enable_directive();return this._consume(H.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(H.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(H.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(H.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(H.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(H.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(H.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(H.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(H.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(H.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(H.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(H.keywords.fn))return null;const e=this._currentLine,n=this._consume(H.tokens.ident,"Expected function name.").toString();this._consume(H.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(H.tokens.paren_right))do{if(this._check(H.tokens.paren_right))break;const l=this._attribute(),u=this._consume(H.tokens.name,"Expected argument name.").toString();this._consume(H.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=d,r.push(this._updateNode(new Kk(u,h,l))))}while(this._match(H.tokens.comma));this._consume(H.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(H.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new Tc(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(H.tokens.brace_left,"Expected '{' for block.");!this._check(H.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(H.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(H.tokens.semicolon)&&!this._isAtEnd(););if(this._check(H.tokens.attr)&&this._attribute(),this._check(H.keywords.if))return this._if_statement();if(this._check(H.keywords.switch))return this._switch_statement();if(this._check(H.keywords.loop))return this._loop_statement();if(this._check(H.keywords.for))return this._for_statement();if(this._check(H.keywords.while))return this._while_statement();if(this._check(H.keywords.continuing))return this._continuing_statement();if(this._check(H.keywords.static_assert))return this._static_assert_statement();if(this._check(H.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(H.keywords.return))e=this._return_statement();else if(this._check([H.keywords.var,H.keywords.let,H.keywords.const]))e=this._variable_statement();else if(this._match(H.keywords.discard))e=this._updateNode(new _X);else if(this._match(H.keywords.break)){const n=this._updateNode(new jP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(H.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(H.keywords.continue)){const n=this._updateNode(new LP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(H.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(H.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new pX(n),e)}_while_statement(){if(!this._match(H.keywords.while))return null;const e=this._updateNode(new RP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(H.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(H.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new S0(r,e),n)}_for_statement(){if(!this._match(H.keywords.for))return null;this._consume(H.tokens.paren_left,"Expected '('.");const e=this._updateNode(new CP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(H.tokens.semicolon)?null:this._for_init(),this._consume(H.tokens.semicolon,"Expected ';'."),e.condition=this._check(H.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(H.tokens.semicolon,"Expected ';'."),e.increment=this._check(H.tokens.paren_right)?null:this._for_increment(),this._consume(H.tokens.paren_right,"Expected ')'."),this._check(H.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(H.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(H.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new mi(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(H.keywords.let)){const e=this._currentLine,n=this._consume(H.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(H.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(H.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new sc(n,r,null,null,i),e)}if(this._match(H.keywords.const)){const e=this._currentLine,n=this._consume(H.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(H.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(H.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Jt&&(r=i.type),this._updateNode(new Cf(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(H.increment_operators))return this._current=e,null;const r=this._consume(H.increment_operators,"Expected increment operator");return this._updateNode(new NP(r.type===H.tokens.plus_plus?io.increment:io.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(H.tokens.brace_right))return null;let r=this._match(H.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(H.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new kP(Kl.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(H.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(H.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new X1(r.lexeme,i),e)}_loop_statement(){if(!this._match(H.keywords.loop))return null;this._check(H.tokens.attr)&&this._attribute(),this._consume(H.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new MP([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof S0){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(H.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(H.keywords.switch))return null;const e=this._updateNode(new IP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(H.tokens.attr)&&this._attribute(),this._consume(H.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(H.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([H.keywords.default,H.keywords.case]);){if(this._match(H.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof kf){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(H.tokens.colon),this._check(H.tokens.attr)&&this._attribute(),this._consume(H.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(H.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new $P(r,i)))}if(this._match(H.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(H.tokens.colon),this._check(H.tokens.attr)&&this._attribute(),this._consume(H.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(H.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new qP(r)))}}return e}_case_selectors(){const e=[];for(this._match(H.keywords.default)?e.push(this._updateNode(new kf)):e.push(this._shift_expression());this._match(H.tokens.comma);)this._match(H.keywords.default)?e.push(this._updateNode(new kf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(H.keywords.fallthrough))return this._consume(H.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(H.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(H.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(H.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(H.keywords.else)&&(this._check(H.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new OP(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===H.keywords.else&&this._tokens[this._current+1].type===H.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new vX(n,r))),this._match_elseif()&&(this._check(H.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(H.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new PP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(H.tokens.or_or);)e=this._updateNode(new Sr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(H.tokens.and_and);)e=this._updateNode(new Sr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(H.tokens.or);)e=this._updateNode(new Sr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(H.tokens.xor);)e=this._updateNode(new Sr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(H.tokens.and);)e=this._updateNode(new Sr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([H.tokens.equal_equal,H.tokens.not_equal])?this._updateNode(new Sr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([H.tokens.less_than,H.tokens.greater_than,H.tokens.less_than_equal,H.tokens.greater_than_equal]);)e=this._updateNode(new Sr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([H.tokens.shift_left,H.tokens.shift_right]);)e=this._updateNode(new Sr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([H.tokens.plus,H.tokens.minus]);)e=this._updateNode(new Sr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([H.tokens.star,H.tokens.forward_slash,H.tokens.modulo]);)e=this._updateNode(new Sr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([H.tokens.minus,H.tokens.bang,H.tokens.tilde,H.tokens.star,H.tokens.and])?this._updateNode(new Xt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(H.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(H.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new yo(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(H.tokens.period)){const e=this._consume(H.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Ws(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return _e.void;case"bool":return _e.bool;case"i32":return _e.i32;case"u32":return _e.u32;case"f32":return _e.f32;case"f16":return _e.f16;case"vec2f":return ae.vec2f;case"vec3f":return ae.vec3f;case"vec4f":return ae.vec4f;case"vec2i":return ae.vec2i;case"vec3i":return ae.vec3i;case"vec4i":return ae.vec4i;case"vec2u":return ae.vec2u;case"vec3u":return ae.vec3u;case"vec4u":return ae.vec4u;case"vec2h":return ae.vec2h;case"vec3h":return ae.vec3h;case"vec4h":return ae.vec4h;case"mat2x2f":return ae.mat2x2f;case"mat2x3f":return ae.mat2x3f;case"mat2x4f":return ae.mat2x4f;case"mat3x2f":return ae.mat3x2f;case"mat3x3f":return ae.mat3x3f;case"mat3x4f":return ae.mat3x4f;case"mat4x2f":return ae.mat4x2f;case"mat4x3f":return ae.mat4x3f;case"mat4x4f":return ae.mat4x4f;case"mat2x2h":return ae.mat2x2h;case"mat2x3h":return ae.mat2x3h;case"mat2x4h":return ae.mat2x4h;case"mat3x2h":return ae.mat3x2h;case"mat3x3h":return ae.mat3x3h;case"mat3x4h":return ae.mat3x4h;case"mat4x2h":return ae.mat4x2h;case"mat4x3h":return ae.mat4x3h;case"mat4x4h":return ae.mat4x4h;case"mat2x2i":return ae.mat2x2i;case"mat2x3i":return ae.mat2x3i;case"mat2x4i":return ae.mat2x4i;case"mat3x2i":return ae.mat3x2i;case"mat3x3i":return ae.mat3x3i;case"mat3x4i":return ae.mat3x4i;case"mat4x2i":return ae.mat4x2i;case"mat4x3i":return ae.mat4x3i;case"mat4x4i":return ae.mat4x4i;case"mat2x2u":return ae.mat2x2u;case"mat2x3u":return ae.mat2x3u;case"mat2x4u":return ae.mat2x4u;case"mat3x2u":return ae.mat3x2u;case"mat3x3u":return ae.mat3x3u;case"mat3x4u":return ae.mat3x4u;case"mat4x2u":return ae.mat4x2u;case"mat4x3u":return ae.mat4x3u;case"mat4x4u":return ae.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(H.tokens.ident)){const r=this._previous().toString();if(this._check(H.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new $r(s,i)):this._updateNode(new G1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new BP(r,i.value))}return this._updateNode(new Gn(r))}if(this._match(H.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?_e.i32:r.endsWith("u")||r.endsWith("U")?_e.u32:_e.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Jt(new te(s,this._exec.getTypeInfo(i)),i))}if(this._match(H.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_e.u32),this._updateNode(new Jt(new te(r,this._exec.getTypeInfo(_e.u32)),_e.u32))}if(this._match([H.tokens.decimal_float_literal,H.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?_e.f16:_e.f32);const o=i?_e.f16:_e.f32;return this._updateNode(new Jt(new te(s,this._exec.getTypeInfo(o)),o))}if(this._match([H.keywords.true,H.keywords.false])){let r=this._previous().toString()===H.keywords.true.rule;return this._updateNode(new Jt(new te(r?1:0,this._exec.getTypeInfo(_e.bool)),_e.bool))}if(this._check(H.tokens.paren_left))return this._paren_expression();if(this._match(H.keywords.bitcast)){this._consume(H.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(H.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new UP(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new $r(e,n))}_argument_expression_list(){if(!this._match(H.tokens.paren_left))return null;const e=[];do{if(this._check(H.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(H.tokens.comma));return this._consume(H.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(H.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(H.tokens.paren_right),e}_paren_expression(){this._consume(H.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(H.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(H.keywords.struct))return null;const e=this._currentLine,n=this._consume(H.tokens.ident,"Expected name for struct.").toString();this._consume(H.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(H.tokens.brace_right);){const o=this._attribute(),l=this._consume(H.tokens.name,"Expected variable name.").toString();this._consume(H.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(H.tokens.brace_right)?this._match(H.tokens.comma):this._consume(H.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new Zk(l,d,o)))}this._consume(H.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new pi(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(H.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Jt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Jt&&(e.type=e.value.type.name==="x32"?_e.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(H.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(H.keywords.const))return null;const n=this._consume(H.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(H.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(H.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[_e.f32],d=o.constEvaluate(this._exec,u);d instanceof te&&this._validateTypeRange(d.value,u[0]),u[0]instanceof ae&&u[0].format===null&&d.typeInfo instanceof Hs&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=_e.f16:d.typeInfo.format.name==="f32"?u[0].format=_e.f32:d.typeInfo.format.name==="i32"?u[0].format=_e.i32:d.typeInfo.format.name==="u32"?u[0].format=_e.u32:d.typeInfo.format.name==="bool"?u[0].format=_e.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new Jt(d,u[0])),this._exec.context.setVariable(n.toString(),d)}catch{s=o}if(i!==null&&s instanceof Jt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Jt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:_e.f32,i===_e.x32&&(i=_e.i32));const l=this._updateNode(new Cf(n.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(H.keywords.let))return null;const e=this._currentLine,n=this._consume(H.tokens.name,"Expected variable name");let r=null;if(this._match(H.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(H.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Jt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Jt&&(r=i.type.name==="x32"?_e.i32:i.type);return i instanceof Jt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new sc(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(H.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(H.tokens.less_than)&&(n=this._consume(H.storage_class,"Expected storage_class.").toString(),this._match(H.tokens.comma)&&(r=this._consume(H.access_mode,"Expected access_mode.").toString()),this._consume(H.tokens.greater_than,"Expected '>'."));const i=this._consume(H.tokens.name,"Expected variable name");let s=null;if(this._match(H.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new mi(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(H.keywords.override))return null;const e=this._consume(H.tokens.name,"Expected variable name");let n=null;if(this._match(H.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new W1(e.toString(),n,null))}_diagnostic(){this._consume(H.tokens.paren_left,"Expected '('");const e=this._consume(H.tokens.ident,"Expected severity control name.");this._consume(H.tokens.comma,"Expected ','");let n=this._consume(H.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(H.tokens.period)&&(n+=`.${this._consume(H.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(H.tokens.paren_right,"Expected ')'"),this._updateNode(new DP(e.toString(),n))}_enable_directive(){const e=this._consume(H.tokens.ident,"identity expected.");return this._updateNode(new gX(e.toString()))}_requires_directive(){const e=[this._consume(H.tokens.ident,"identity expected.").toString()];for(;this._match(H.tokens.comma);){const n=this._consume(H.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new mX(e))}_type_alias(){const e=this._consume(H.tokens.ident,"identity expected.");this._consume(H.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new Y1(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([H.tokens.ident,...H.texel_format,H.keywords.bool,H.keywords.f32,H.keywords.i32,H.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new Gk(r));return this._forwardTypeCount++,i}return this._updateNode(new _e(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(H.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(H.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(H.tokens.comma)&&(s=this._consume(H.access_mode,"Expected access_mode for pointer").toString()),this._consume(H.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ae(r,i,s))}if(this._match(H.keywords.ptr)){let r=this._previous().toString();this._consume(H.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(H.storage_class,"Expected storage_class for pointer");this._consume(H.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(H.tokens.comma)&&(o=this._consume(H.access_mode,"Expected access_mode for pointer").toString()),this._consume(H.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Nf(r,i.toString(),s,o))}const n=this._attribute();if(this._match(H.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(H.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(H.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(H.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new ac(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(H.sampler_type))return this._updateNode(new Zl(this._previous().toString(),null,null));if(this._match(H.depth_texture_type))return this._updateNode(new Zl(this._previous().toString(),null,null));if(this._match(H.sampled_texture_type)||this._match(H.multisampled_texture_type)){const e=this._previous();this._consume(H.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(H.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zl(e.toString(),n,null))}if(this._match(H.storage_texture_type)){const e=this._previous();this._consume(H.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(H.texel_format,"Invalid texel format.").toString();this._consume(H.tokens.comma,"Expected ',' after texel format.");const r=this._consume(H.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(H.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zl(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(H.tokens.attr);){const n=this._consume(H.attribute_name,"Expected attribute name"),r=this._updateNode(new VP(n.toString(),null));if(this._match(H.tokens.paren_left)){if(r.value=this._consume(H.literal_or_ident,"Expected attribute value").toString(),this._check(H.tokens.comma)){this._advance();do{const i=this._consume(H.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(H.tokens.comma))}this._consume(H.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class IX extends Vr{constructor(e){super(),e&&this.update(e)}update(e){const n=new MX().parse(e);this.updateAST(n)}}function OX(t){var s;const e={attributes:[],bindings:[]};let n;try{n=PX(t)}catch(o){return xe.error(o.message)(),e}for(const o of n.uniforms){const l=[];for(const u of((s=o.type)==null?void 0:s.members)||[])l.push({name:u.name,type:eM(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const l=r.inputs[o];if(l.locationType==="location"){const u=eM(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function eM(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function PX(t){try{return new IX(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const DX={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...DX}};const dr=globalThis.mathgl.config;function jX(t,{precision:e=dr.precision}={}){return t=LX(t),`${parseFloat(t.toPrecision(e))}`}function xo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Kn(t,e,n){return UX(t,r=>Math.max(e,Math.min(n,r)))}function od(t,e,n){return xo(t)?t.map((r,i)=>od(r,e[i],n)):n*e+(1-n)*t}function Sc(t,e,n){const r=dr.EPSILON;try{if(t===e)return!0;if(xo(t)&&xo(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Sc(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=dr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{dr.EPSILON=r}}function LX(t){return Math.round(t/dr.EPSILON)*dr.EPSILON}function BX(t){return t.clone?t.clone():new Array(t.length)}function UX(t,e,n){if(xo(t)){const r=t;n=n||BX(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class HP extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:xo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(dr)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+jX(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Sc(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(dr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function FX(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Yn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function wb(t,e,n=""){if(dr.debug&&!FX(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function tM(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class zX extends HP{get x(){return this[0]}set x(e){this[0]=Yn(e)}get y(){return this[1]}set y(e){this[1]=Yn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Yn(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Yn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return tM(e>=0&&e<this.ELEMENTS,"index is out of range"),Yn(this[e])}setComponent(e,n){return tM(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Mf=1e-6;let bo=typeof Float32Array<"u"?Float32Array:Array;function $X(){const t=new bo(2);return bo!=Float32Array&&(t[0]=0,t[1]=0),t}function nM(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function qX(t,e){return t[0]=-e[0],t[1]=-e[1],t}function WP(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function VX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=$X();return function(e,n,r,i,s,o){let l,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],s(t,t,o),e[l]=t[0],e[l+1]=t[1];return e}})();function HX(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function XP(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function WX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function XX(){const t=new bo(3);return bo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function YX(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function GX(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function KX(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ZX(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],l=n[1],u=n[2];return t[0]=i*u-s*l,t[1]=s*o-r*u,t[2]=r*l-i*o,t}function YP(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function QX(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function JX(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],l=e[0],u=e[1],d=e[2];let h=i*d-s*u,m=s*l-r*d,_=r*u-i*l,y=i*_-s*m,T=s*h-r*_,w=r*m-i*h;const b=o*2;return h*=b,m*=b,_*=b,y*=2,T*=2,w*=2,t[0]=l+h+y,t[1]=u+m+T,t[2]=d+_+w,t}function eY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function tY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function nY(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function rY(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+l*l)),d=u&&KX(t,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const iY=YX;(function(){const t=XX();return function(e,n,r,i,s,o){let l,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Tb=[0,0,0];let hf;class Wr extends zX{static get ZERO(){return hf||(hf=new Wr(0,0,0),Object.freeze(hf)),hf}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&xo(e)?this.copy(e):(dr.debug&&(Yn(e),Yn(n),Yn(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return dr.debug&&(Yn(e.x),Yn(e.y),Yn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Yn(e)}angle(e){return rY(this,e)}cross(e){return ZX(this,this,e),this.check()}rotateX({radians:e,origin:n=Tb}){return eY(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Tb}){return tY(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Tb}){return nY(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return YP(this,this,e),this.check()}transformAsVector(e){return XP(this,this,e),this.check()}transformByMatrix3(e){return QX(this,this,e),this.check()}transformByMatrix2(e){return WX(this,this,e),this.check()}transformByQuaternion(e){return JX(this,this,e),this.check()}}class sY extends HP{toString(){let e="[";if(dr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Yn(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function aY(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oY(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function A0(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],d=e[7],h=e[8],m=e[9],_=e[10],y=e[11],T=e[12],w=e[13],b=e[14],S=e[15],A=n*l-r*o,R=n*u-i*o,E=n*d-s*o,C=r*u-i*l,O=r*d-s*l,P=i*d-s*u,k=h*w-m*T,I=h*b-_*T,N=h*S-y*T,L=m*b-_*w,$=m*S-y*w,Z=_*S-y*b;let V=A*Z-R*$+E*L+C*N-O*I+P*k;return V?(V=1/V,t[0]=(l*Z-u*$+d*L)*V,t[1]=(i*$-r*Z-s*L)*V,t[2]=(w*P-b*O+S*C)*V,t[3]=(_*O-m*P-y*C)*V,t[4]=(u*N-o*Z-d*I)*V,t[5]=(n*Z-i*N+s*I)*V,t[6]=(b*E-T*P-S*R)*V,t[7]=(h*P-_*E+y*R)*V,t[8]=(o*$-l*N+d*k)*V,t[9]=(r*N-n*$-s*k)*V,t[10]=(T*O-w*E+S*A)*V,t[11]=(m*E-h*O-y*A)*V,t[12]=(l*I-o*L-u*k)*V,t[13]=(n*L-r*I+i*k)*V,t[14]=(w*R-T*C-b*A)*V,t[15]=(h*C-m*R+_*A)*V,t):null}function lY(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=t[6],u=t[7],d=t[8],h=t[9],m=t[10],_=t[11],y=t[12],T=t[13],w=t[14],b=t[15],S=e*o-n*s,A=e*l-r*s,R=n*l-r*o,E=d*T-h*y,C=d*w-m*y,O=h*w-m*T,P=e*O-n*C+r*E,k=s*O-o*C+l*E,I=d*R-h*A+m*S,N=y*R-T*A+w*S;return u*P-i*k+b*I-_*N}function Fs(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],d=e[6],h=e[7],m=e[8],_=e[9],y=e[10],T=e[11],w=e[12],b=e[13],S=e[14],A=e[15];let R=n[0],E=n[1],C=n[2],O=n[3];return t[0]=R*r+E*l+C*m+O*w,t[1]=R*i+E*u+C*_+O*b,t[2]=R*s+E*d+C*y+O*S,t[3]=R*o+E*h+C*T+O*A,R=n[4],E=n[5],C=n[6],O=n[7],t[4]=R*r+E*l+C*m+O*w,t[5]=R*i+E*u+C*_+O*b,t[6]=R*s+E*d+C*y+O*S,t[7]=R*o+E*h+C*T+O*A,R=n[8],E=n[9],C=n[10],O=n[11],t[8]=R*r+E*l+C*m+O*w,t[9]=R*i+E*u+C*_+O*b,t[10]=R*s+E*d+C*y+O*S,t[11]=R*o+E*h+C*T+O*A,R=n[12],E=n[13],C=n[14],O=n[15],t[12]=R*r+E*l+C*m+O*w,t[13]=R*i+E*u+C*_+O*b,t[14]=R*s+E*d+C*y+O*S,t[15]=R*o+E*h+C*T+O*A,t}function ld(t,e,n){const r=n[0],i=n[1],s=n[2];let o,l,u,d,h,m,_,y,T,w,b,S;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],d=e[3],h=e[4],m=e[5],_=e[6],y=e[7],T=e[8],w=e[9],b=e[10],S=e[11],t[0]=o,t[1]=l,t[2]=u,t[3]=d,t[4]=h,t[5]=m,t[6]=_,t[7]=y,t[8]=T,t[9]=w,t[10]=b,t[11]=S,t[12]=o*r+h*i+T*s+e[12],t[13]=l*r+m*i+w*s+e[13],t[14]=u*r+_*i+b*s+e[14],t[15]=d*r+y*i+S*s+e[15]),t}function e2(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function cY(t,e,n,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,d,h,m,_,y,T,w,b,S,A,R,E,C,O,P,k,I,N,L,$,Z,V,q;return l<Mf?null:(l=1/l,i*=l,s*=l,o*=l,d=Math.sin(n),u=Math.cos(n),h=1-u,m=e[0],_=e[1],y=e[2],T=e[3],w=e[4],b=e[5],S=e[6],A=e[7],R=e[8],E=e[9],C=e[10],O=e[11],P=i*i*h+u,k=s*i*h+o*d,I=o*i*h-s*d,N=i*s*h-o*d,L=s*s*h+u,$=o*s*h+i*d,Z=i*o*h+s*d,V=s*o*h-i*d,q=o*o*h+u,t[0]=m*P+w*k+R*I,t[1]=_*P+b*k+E*I,t[2]=y*P+S*k+C*I,t[3]=T*P+A*k+O*I,t[4]=m*N+w*L+R*$,t[5]=_*N+b*L+E*$,t[6]=y*N+S*L+C*$,t[7]=T*N+A*L+O*$,t[8]=m*Z+w*V+R*q,t[9]=_*Z+b*V+E*q,t[10]=y*Z+S*V+C*q,t[11]=T*Z+A*V+O*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function GP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],l=e[6],u=e[7],d=e[8],h=e[9],m=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+d*r,t[5]=o*i+h*r,t[6]=l*i+m*r,t[7]=u*i+_*r,t[8]=d*i-s*r,t[9]=h*i-o*r,t[10]=m*i-l*r,t[11]=_*i-u*r,t}function uY(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[8],h=e[9],m=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-d*r,t[1]=o*i-h*r,t[2]=l*i-m*r,t[3]=u*i-_*r,t[8]=s*r+d*i,t[9]=o*r+h*i,t[10]=l*r+m*i,t[11]=u*r+_*i,t}function KP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[4],h=e[5],m=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+d*r,t[1]=o*i+h*r,t[2]=l*i+m*r,t[3]=u*i+_*r,t[4]=d*i-s*r,t[5]=h*i-o*r,t[6]=m*i-l*r,t[7]=_*i-u*r,t}function fY(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,l=r+r,u=i+i,d=n*o,h=r*o,m=r*l,_=i*o,y=i*l,T=i*u,w=s*o,b=s*l,S=s*u;return t[0]=1-m-T,t[1]=h+S,t[2]=_-b,t[3]=0,t[4]=h-S,t[5]=1-d-T,t[6]=y+w,t[7]=0,t[8]=_+b,t[9]=y-w,t[10]=1-d-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dY(t,e,n,r,i,s,o){const l=1/(n-e),u=1/(i-r),d=1/(s-o);return t[0]=s*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(i+r)*u,t[10]=(o+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*d,t[15]=0,t}function hY(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const pY=hY;function gY(t,e,n,r,i,s,o){const l=1/(e-n),u=1/(r-i),d=1/(s-o);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*l,t[13]=(i+r)*u,t[14]=(o+s)*d,t[15]=1,t}const mY=gY;function _Y(t,e,n,r){let i,s,o,l,u,d,h,m,_,y;const T=e[0],w=e[1],b=e[2],S=r[0],A=r[1],R=r[2],E=n[0],C=n[1],O=n[2];return Math.abs(T-E)<Mf&&Math.abs(w-C)<Mf&&Math.abs(b-O)<Mf?aY(t):(m=T-E,_=w-C,y=b-O,i=1/Math.sqrt(m*m+_*_+y*y),m*=i,_*=i,y*=i,s=A*y-R*_,o=R*m-S*y,l=S*_-A*m,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=_*l-y*o,d=y*s-m*l,h=m*o-_*s,i=Math.sqrt(u*u+d*d+h*h),i?(i=1/i,u*=i,d*=i,h*=i):(u=0,d=0,h=0),t[0]=s,t[1]=u,t[2]=m,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=l,t[9]=h,t[10]=y,t[11]=0,t[12]=-(s*T+o*w+l*b),t[13]=-(u*T+d*w+h*b),t[14]=-(m*T+_*w+y*b),t[15]=1,t)}function vY(){const t=new bo(4);return bo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function yY(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Uc(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=vY();return function(e,n,r,i,s,o){let l,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var R0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(R0||(R0={}));const xY=45*Math.PI/180,bY=1,Sb=.1,Eb=500,wY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class kr extends sY{static get IDENTITY(){return SY()}static get ZERO(){return TY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return R0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,l,u,d,h,m,_,y,T,w,b){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=d,this[9]=h,this[10]=m,this[11]=_,this[12]=y,this[13]=T,this[14]=w,this[15]=b,this.check()}setRowMajor(e,n,r,i,s,o,l,u,d,h,m,_,y,T,w,b){return this[0]=e,this[1]=s,this[2]=d,this[3]=y,this[4]=n,this[5]=o,this[6]=h,this[7]=T,this[8]=r,this[9]=l,this[10]=m,this[11]=w,this[12]=i,this[13]=u,this[14]=_,this[15]=b,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(wY)}fromObject(e){return this.check()}fromQuaternion(e){return fY(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Sb,far:l=Eb}=e;return l===1/0?EY(this,n,r,i,s,o):dY(this,n,r,i,s,o,l),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return _Y(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Sb,far:l=Eb}=e;return mY(this,n,r,i,s,o,l),this.check()}orthographic(e){const{fovy:n=xY,aspect:r=bY,focalDistance:i=1,near:s=Sb,far:o=Eb}=e;rM(n);const l=n/2,u=i*Math.tan(l),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return rM(n),pY(this,n,r,i,s),this.check()}determinant(){return lY(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return oY(this,this),this.check()}invert(){return A0(this,this),this.check()}multiplyLeft(e){return Fs(this,e,this),this.check()}multiplyRight(e){return Fs(this,this,e),this.check()}rotateX(e){return GP(this,this,e),this.check()}rotateY(e){return uY(this,this,e),this.check()}rotateZ(e){return KP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return cY(this,this,e,n),this.check()}scale(e){return e2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ld(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Uc(n||[-0,-0,-0,-0],e,this),wb(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=VX(n||[-0,-0],e,this);break;case 3:i=YP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wb(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=HX(n||[-0,-0],e,this);break;case 3:r=XP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return wb(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let pf,gf;function TY(){return pf||(pf=new kr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(pf)),pf}function SY(){return gf||(gf=new kr,Object.freeze(gf)),gf}function rM(t){if(t>Math.PI*2)throw Error("expected radians")}function EY(t,e,n,r,i,s){const o=2*s/(n-e),l=2*s/(i-r),u=(n+e)/(n-e),d=(i+r)/(i-r),h=-1,m=-1,_=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=u,t[9]=d,t[10]=h,t[11]=m,t[12]=0,t[13]=0,t[14]=_,t[15]=0,t}function ZP(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function AY(t){return t-Math.fround(t)}function RY(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;ZP(t[r*4+n],e,i*2)}return e}const CY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,NY={name:"fp32",vs:CY},kY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,MY={ONE:1},IY={name:"fp64arithmetic",vs:kY,defaultUniforms:MY,uniformTypes:{ONE:"f32"},fp64ify:ZP,fp64LowPart:AY,fp64ifyMatrix4:RY},OY=[0,1,1,1],PY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,DY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,iM={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:OY},vs:PY,fs:DY,getUniforms:jY};function jY(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const sM=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,LY={name:"layer",vs:sM,fs:sM,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},BY=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,QP="#define SMOOTH_EDGE_RADIUS 0.5",UY=`${QP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,FY=`${QP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,JP={name:"geometry",source:BY,vs:UY,fs:FY},zY=25;var Yt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Yt||(Yt={}));var en;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(en||(en={}));var Fe;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Fe||(Fe={}));const $Y="compute",qY="auto",C0="manipulation",If="none",N0="pan-x",k0="pan-y";function VY(t){if(t.includes(If))return If;const e=t.includes(N0),n=t.includes(k0);return e&&n?If:e||n?e?N0:k0:t.includes(C0)?C0:qY}class HY{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===$Y&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return VY(e.join(" "))}}function cd(t){return t.trim().split(/\s+/g)}function Ab(t,e,n){if(t)for(const r of cd(e))t.addEventListener(r,n,!1)}function Rb(t,e,n){if(t)for(const r of cd(e))t.removeEventListener(r,n,!1)}function aM(t){return(t.ownerDocument||t).defaultView}function WY(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function eD(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function oM(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:eD(e),deltaX:t.deltaX,deltaY:t.deltaY}}function tD(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function lM(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function XY(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function cM(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function nD(t,e){return t===e?en.None:Math.abs(t)>=Math.abs(e)?t<0?en.Left:en.Right:e<0?en.Up:en.Down}function YY(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===Yt.Start||(s==null?void 0:s.eventType)===Yt.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function rD(t,e,n){return{x:e/t||0,y:n/t||0}}function GY(t,e){return lM(e[0],e[1])/lM(t[0],t[1])}function KY(t,e){return cM(e[1],e[0])-cM(t[1],t[0])}function ZY(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,l;if(e.eventType!==Yt.Cancel&&(r>zY||n.velocity===void 0)){const u=e.deltaX-n.deltaX,d=e.deltaY-n.deltaY,h=rD(r,u,d);s=h.x,o=h.y,i=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,l=nD(u,d),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,l=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function QY(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=oM(e)),i>1&&!n.firstMultiple?n.firstMultiple=oM(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,l=o?o.center:s.center,u=e.center=eD(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=XY(l,u),e.distance=tD(l,u);const{deltaX:d,deltaY:h}=YY(n,e);e.deltaX=d,e.deltaY=h,e.offsetDirection=nD(e.deltaX,e.deltaY);const m=rD(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=o?GY(o.pointers,r):1,e.rotation=o?KY(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let _=t.element;return WY(e.srcEvent.target,_)&&(_=e.srcEvent.target),e.target=_,ZY(n,e),e}function JY(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&Yt.Start&&r-i===0,o=e&(Yt.End|Yt.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const l=QY(t,n);t.emit("hammer.input",l),t.recognize(l),t.session.prevInput=l}let eG=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){JY(this.manager,e,n)}init(){Ab(this.element,this.evEl,this.domHandler),Ab(this.target,this.evTarget,this.domHandler),Ab(aM(this.element),this.evWin,this.domHandler)}destroy(){Rb(this.element,this.evEl,this.domHandler),Rb(this.target,this.evTarget,this.domHandler),Rb(aM(this.element),this.evWin,this.domHandler)}};const tG={pointerdown:Yt.Start,pointermove:Yt.Move,pointerup:Yt.End,pointercancel:Yt.Cancel,pointerout:Yt.Cancel},nG="pointerdown",rG="pointermove pointerup pointercancel";class iG extends eG{constructor(e){super(e),this.evEl=nG,this.evWin=rG,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=tG[e.type],s=e.pointerType,o=s==="touch";let l=n.findIndex(u=>u.pointerId===e.pointerId);i&Yt.Start&&(e.buttons||o)?l<0&&(n.push(e),l=n.length-1):i&(Yt.End|Yt.Cancel)&&(r=!0),!(l<0)&&(n[l]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(l,1))}}const sG=["","webkit","Moz","MS","ms","o"];function aG(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of sG){const i=r?r+n:e;if(i in t)return i}}const oG=1,uM=2,fM={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class lG{constructor(e,n){this.options={...fM,...n,cssProps:{...fM.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new iG(this),this.touchAction=new HY(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?uM:oG}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&Fe.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==uM&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(Fe.Began|Fe.Changed|Fe.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of cd(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of cd(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=aG(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let cG=1;function uG(){return cG++}function dM(t){return t&Fe.Cancelled?"cancel":t&Fe.Ended?"end":t&Fe.Changed?"move":t&Fe.Began?"start":""}class iD{constructor(e){this.options=e,this.id=uG(),this.state=Fe.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<Fe.Ended&&this.manager.emit(this.options.event+dM(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=Fe.Ended&&this.manager.emit(this.options.event+dM(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Fe.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Fe.Failed|Fe.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=Fe.Failed;return}this.state&(Fe.Recognized|Fe.Cancelled|Fe.Failed)&&(this.state=Fe.Possible),this.state=this.process(n),this.state&(Fe.Began|Fe.Changed|Fe.Ended|Fe.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class sD extends iD{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(Fe.Began|Fe.Changed),s=this.attrTest(e);return i&&(r&Yt.Cancel||!s)?n|Fe.Cancelled:i||s?r&Yt.End?n|Fe.Ended:n&Fe.Began?n|Fe.Changed:Fe.Began:Fe.Failed}}class hM extends iD{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[C0]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&Yt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==Yt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,l=!this.pCenter||tD(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Fe.Recognized,this.tryEmit(this._input)},n.interval),Fe.Began):Fe.Recognized}return Fe.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Fe.Failed},this.options.interval),Fe.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Fe.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const fG=["","start","move","end","cancel","up","down","left","right"];class pM extends sD{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:en.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&en.Horizontal&&n.push(k0),e&en.Vertical&&n.push(N0),n}getEventNames(){return fG.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&n.direction||(n.direction&en.Horizontal?(s=o===0?en.None:o<0?en.Left:en.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?en.None:l<0?en.Up:en.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Fe.Began)||!(this.state&Fe.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=en[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const dG=["","start","move","end","cancel","in","out"];class hG extends sD{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[If]}getEventNames(){return dG.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Fe.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class uh{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const pG=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",gG=pG.indexOf("firefox")!==-1,gM=4.000244140625,mG=40,_G=.25;class vG extends uh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(gG&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=mG)),s!==0&&s%gM===0&&(s=Math.floor(s/gM)),i.shiftKey&&s&&(s=s*_G),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const mM=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class yG extends uh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,mM.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){mM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const _M=["keydown","keyup"];class xG extends uh{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",_M.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){_M.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class bG extends uh{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const vM=1,M0=2,yM=4,wG={pointerdown:vM,pointermove:M0,pointerup:yM,mousedown:vM,mousemove:M0,mouseup:yM},TG=0,SG=1,EG=2,AG=1,RG=2,CG=4;function NG(t){const e=wG[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===M0?(i=!!(n&AG),s=!!(n&CG),o=!!(n&RG)):(i=r===TG,s=r===SG,o=r===EG),{leftButton:i,middleButton:s,rightButton:o}}function kG(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const MG={srcElement:"root",priority:0};class IG{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...MG,...r};let d=l.get(u.srcElement);d||(d=[],l.set(u.srcElement,d));const h={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let m=d.length-1;for(;m>=0&&!(d[m].priority>=h.priority);)m--;d.splice(m+1,0,h)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:d,handler:h,once:m}=r[u];if(h({...e,type:d,stopPropagation:s,stopImmediatePropagation:o}),m&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:d,handler:h}=l[u];this.remove(d,h)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...NG(e),...kG(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function OG(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class PG{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new lG(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=OG(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new vG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new yG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new xG(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new bG(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,l,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(l=this.keyInput)==null||l.enableEventType(e,n),(u=this.contextmenuInput)==null||u.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[d,h]of Object.entries(e))this._addEventHandler(d,h,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new IG(this,d),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const nt={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(nt,"IDENTITY",{get:()=>(yt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ur={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Xs={common:0,meters:1,pixels:2},I0={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},xM={multipan:[pM,{threshold:10,direction:en.Vertical,pointers:2}],pinch:[hG,{},null,["multipan"]],pan:[pM,{threshold:1},["pinch"],["multipan"]],dblclick:[hM,{event:"dblclick",taps:2}],click:[hM,{event:"click"},null,["dblclick"]]};function DG(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Fc(t){let e={},n;return r=>{for(const i in r)if(!DG(r[i],e[i])){n=t(r),e=r;break}return n}}const bM=[0,0,0,0],jG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],aD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],LG=[0,0,0],oD=[0,0,0],BG=Fc(zG);function lD(t,e,n=oD){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===nt.LNGLAT_OFFSETS||e===nt.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ur.WEB_MERCATOR:(e===nt.LNGLAT||e===nt.CARTESIAN)&&(i=[0,0,0],s=!1);break;case ur.WEB_MERCATOR_AUTO_OFFSET:e===nt.LNGLAT?r=i:e===nt.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case ur.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case ur.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function UG(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,l=bM,u=bM,d=t.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:m,offsetMode:_}=lD(t,e,n);return _&&(u=t.projectPosition(h||m),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,l=Uc([],u,o),s=r||s,o=Fs([],i,s),o=Fs([],o,jG)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:m,geospatialOrigin:h}}function FG({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=nt.DEFAULT,coordinateOrigin:i=oD,autoWrapLongitude:s=!1}){r===nt.DEFAULT&&(r=t.isGeospatial?nt.LNGLAT:nt.CARTESIAN);const o=BG({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||aD,o}function zG({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:d}=UG(t,n,r),h=t.getDistanceScales(),m=[t.width*e,t.height*e],_=Uc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,y={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:_,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:LG,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:aD,cameraPosition:l};if(d){const T=t.getDistanceScales(d);switch(n){case nt.METER_OFFSETS:y.commonUnitsPerWorldUnit=T.unitsPerMeter,y.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case nt.LNGLAT:case nt.LNGLAT_OFFSETS:t._pseudoMeters||(y.commonUnitsPerMeter=T.unitsPerMeter),y.commonUnitsPerWorldUnit=T.unitsPerDegree,y.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case nt.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return y}const $G=Object.keys(nt).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${nt[t]};`).join(""),qG=Object.keys(ur).map(t=>`const PROJECTION_MODE_${t}: i32 = ${ur[t]};`).join(""),VG=Object.keys(Xs).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Xs[t]};`).join(""),HG=`${$G}
${qG}
${VG}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,WG=`${HG}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,XG=Object.keys(nt).map(t=>`const int COORDINATE_SYSTEM_${t} = ${nt[t]};`).join(""),YG=Object.keys(ur).map(t=>`const int PROJECTION_MODE_${t} = ${ur[t]};`).join(""),GG=Object.keys(Xs).map(t=>`const int UNIT_${t.toUpperCase()} = ${Xs[t]};`).join(""),KG=`${XG}
${YG}
${GG}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,ZG={};function QG(t=ZG){return"viewport"in t?FG(t):{}}const t2={name:"project",dependencies:[NY,JP],source:WG,vs:KG,getUniforms:QG,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},JG=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,eK=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,cD={name:"project32",dependencies:[t2],source:JG,vs:eK};function tK(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ho(t,e){const n=Uc([],e,t);return yY(n,n,1/n[3]),n}function wM(t,e){const n=t%e;return n<0?e+n:n}function O0(t,e,n){return t<e?e:t>n?n:t}function nK(t){return Math.log(t)*Math.LOG2E}const n2=Math.log2||nK;function yi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Rr=Math.PI,uD=Rr/4,hr=Rr/180,P0=180/Rr,wo=512,ud=4003e4,TM=85.051129,rK=1.5;function iK(t){return n2(t)}function fd(t){const[e,n]=t;yi(Number.isFinite(e)),yi(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*hr,i=n*hr,s=wo*(r+Rr)/(2*Rr),o=wo*(Rr+Math.log(Math.tan(uD+i*.5)))/(2*Rr);return[s,o]}function To(t){const[e,n]=t,r=e/wo*(2*Rr)-Rr,i=2*(Math.atan(Math.exp(n/wo*(2*Rr)-Rr))-uD);return[r*P0,i*P0]}function sK(t){const{latitude:e}=t;yi(Number.isFinite(e));const n=Math.cos(e*hr);return iK(ud*n)-9}function Cb(t){const e=Math.cos(t*hr);return wo/ud/e}function D0(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;yi(Number.isFinite(e)&&Number.isFinite(n));const i=wo,s=Math.cos(e*hr),o=i/360,l=o/s,u=i/ud/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const h=hr*Math.tan(e*hr)/s,m=o*h/2,_=i/ud*h,y=_/l*u;d.unitsPerDegree2=[0,m,_],d.unitsPerMeter2=[y,0,y]}return d}function fD(t,e){const[n,r,i]=t,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:d}=D0({longitude:n,latitude:r,highPrecision:!0}),h=fd(t);h[0]+=s*(u[0]+d[0]*o),h[1]+=o*(u[1]+d[1]*o);const m=To(h),_=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[m[0],m[1],_]:m}function aK(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,l=tK();ld(l,l,[0,0,-i]),GP(l,l,-n*hr),KP(l,l,r*hr);const u=s/e;return e2(l,l,[u,u,u]),o&&ld(l,l,GX([],o)),l}function oK(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:d=1}=t;let{fovy:h=dd(rK)}=t;r!==void 0&&(h=dd(r));const m=h*hr,_=i*hr,y=r2(h);let T=y;o&&(T+=o[2]*l/Math.cos(_)/n);const w=m*(.5+(s?s[1]:0)/n),b=Math.sin(w)*T/Math.sin(O0(Math.PI/2-_-w,.01,Math.PI-.01)),S=Math.sin(_)*b+T,A=T*10,R=Math.min(S*d,A);return{fov:m,aspect:e/n,focalDistance:y,near:u,far:R}}function dd(t){return 2*Math.atan(.5/t)*P0}function r2(t){return .5/Math.tan(.5*t*hr)}function dD(t,e){const[n,r,i=0]=t;return yi(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),ho(e,[n,r,i,1])}function fh(t,e,n=0){const[r,i,s]=t;if(yi(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return ho(e,[r,i,s,1]);const o=ho(e,[r,i,0,1]),l=ho(e,[r,i,1,1]),u=o[2],d=l[2],h=u===d?0:((n||0)-u)/(d-u);return WP([],o,l,h)}function lK(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[l,u],[d,h]]=r,m=cK(t.padding),_=fd([l,O0(h,-85.051129,TM)]),y=fd([d,O0(u,-85.051129,TM)]),T=[Math.max(Math.abs(y[0]-_[0]),i),Math.max(Math.abs(y[1]-_[1]),i)],w=[e-m.left-m.right-Math.abs(o[0])*2,n-m.top-m.bottom-Math.abs(o[1])*2];yi(w[0]>0&&w[1]>0);const b=w[0]/T[0],S=w[1]/T[1],A=(m.right-m.left)/2/b,R=(m.top-m.bottom)/2/S,E=[(y[0]+_[0])/2+A,(y[1]+_[1])/2+R],C=To(E),O=Math.min(s,n2(Math.abs(Math.min(b,S))));return yi(Number.isFinite(O)),{longitude:C[0],latitude:C[1],zoom:O}}function cK(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(yi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const SM=Math.PI/180;function uK(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),l=i([n,r],s);let u,d;const h=t.fovy?.5*t.fovy*SM:Math.atan(.5/t.altitude),m=(90-t.pitch)*SM;return h>m-.01?(u=EM(t,0,e),d=EM(t,n,e)):(u=i([0,0],s),d=i([n,0],s)),[o,l,d,u]}function EM(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=ho(r,[e,0,1,1]),s=ho(r,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=WP([],i,s,l),d=To(u);return d.push(n),d}const AM=512;function fK(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=t;(i<-180||i>180)&&(i=wM(i+180,360)-180),(l<-180||l>180)&&(l=wM(l+180,360)-180);const u=n2(n/AM);if(o<=u)o=u,s=0;else{const d=n/2/Math.pow(2,o),h=To([0,d])[1];if(s<h)s=h;else{const m=To([0,AM-d])[1];s>m&&(s=m)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const hD=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,dK=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,hK=`
${hD}
${dK}
`,pK=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,gK=`
${hD}
${pK}
`,mK=Fc(bK),_K=Fc(wK),vK=[0,0,0,1],yK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function xK(t,e){const[n,r,i]=t,s=fh([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function bK({viewport:t,center:e}){return new kr(t.viewProjectionMatrix).invert().transform(e)}function wK({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>xK(o,r));for(const o of e){const l=o.clone().translate(new Wr(t.center).negate()),u=s.map(h=>l.transform(h)),d=new kr().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});n.push(d.multiplyRight(o))}return n}function TK(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=t2.getUniforms(n),i=mK({viewport:n.viewport,center:r.center}),s=[],o=_K({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const d=o[u],h=d.clone().translate(new Wr(n.viewport.center).negate());r.coordinateSystem===nt.LNGLAT&&r.projectionMode===ur.WEB_MERCATOR?(o[u]=h,s[u]=i):(o[u]=d.clone().multiplyRight(yK),s[u]=h.transform(i))}const l={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||vK,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return l}const RM={name:"shadow",dependencies:[t2],vs:hK,fs:gK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:TK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},pD={...iM,defaultUniforms:{...iM.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},SK=[JP],EK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],AK=[];function RK(t){const e=Gf.getDefaultShaderAssembler();for(const r of SK)e.addDefaultModule(r);const n=t==="glsl"?EK:AK;for(const r of n)e.addShaderHook(r);return e}const CK=[255,255,255],NK=1;let kK=0;class MK{constructor(e={}){this.type="ambient";const{color:n=CK}=e,{intensity:r=NK}=e;this.id=e.id||`ambient-${kK++}`,this.color=n,this.intensity=r}}const IK=[255,255,255],OK=1,PK=[0,0,-1];let DK=0;class CM{constructor(e={}){this.type="directional";const{color:n=IK}=e,{intensity:r=OK}=e,{direction:i=PK}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${DK++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Wr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class jK{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class i2 extends jK{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,n,r]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(h,e)}finally{h.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=n;n.pass=n.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const h of s){const m=o&&o[h.id];l==null||l(h);const _=this._getDrawLayerParams(h,n),y=h.subViewports||[h];for(const T of y){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:T,view:m,pass:n.pass,layers:n.layers},_);d.push(w)}}return d}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},d=!1){var T;const h=[],m=gD(this._lastRenderIndex+1),_={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},y={};for(let w=0;w<n.length;w++){const b=n[w],S=this._shouldDrawLayer(b,_,s,y),A={shouldDrawLayer:S};S&&!d&&(A.shouldDrawLayer=!0,A.layerRenderIndex=m(b,S),A.shaderModuleProps=this._getShaderModuleProps(b,l,r,u),A.layerParameters={...(T=b.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(b,w,e)}),h[w]=A}return h}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const d=LK(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const m=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:m.color?[0,0,0,0]:!1,clearDepth:m.depth?1:!1}).end()}const h={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let m=0;m<n.length;m++){const _=n[m],y=u[m],{shouldDrawLayer:T}=y;if(T&&_.props.pickable&&h.pickableCount++,_.isComposite&&h.compositeCount++,_.isDrawable&&y.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:b,layerParameters:S}=y;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),b.project&&(b.project.viewport=o),_.context.renderPass=e;try{_._drawLayer({renderPass:e,shaderModuleProps:b,uniforms:{layerIndex:w},parameters:S})}catch(A){_.raiseError(A,`drawing ${_} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const l=n.layer.id;if(l in i||(i[l]=r(n)),!i[l])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const h of n)NM(l,(d=h.getShaderModuleProps)==null?void 0:d.call(h,e,l));return NM(l,this.getShaderModuleProps(e,n,l),i)}}function gD(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in n){const h=n[u]=n[u]||gD(e[u],e);d=h(i,s),n[l]=h}else Number.isFinite(o)?(d=o+(e[u]||0),n[l]=null):d=t;return s&&d>=t&&(t=d+1),e[l]=d,d};return r}function LK(t,{shaderModuleProps:e,target:n,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function NM(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class BK extends i2{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:l,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const UK={color:[255,255,255],intensity:1},kM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],FK=[0,0,0,200/255];class mD{constructor(e={}){this.id="lighting-effect",this.shadowColor=FK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(RM),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(RM))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new kr().lookAt({eye:new Wr(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new BK(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new MK(UK),this.directionalLights.push(new CM(kM[0]),new CM(kM[1])))}}class zK{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,h=n*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,h)}let m=1/0;u&&(m=u*r+s);const _=this._allocate(d,h,l,m);return e&&o?_.set(e):l||_.fill(0,0,4),this._release(e),_}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(d=>d.byteLength>=l);if(u>=0){const d=new e(o.splice(u,1)[0],0,s);return r&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Ec=new zK;function Ql(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $K(t,e){const n=t%e;return n<0?e+n:n}function qK(t){return[t[12],t[13],t[14]]}function VK(t){return{left:Qa(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Qa(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Qa(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Qa(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Qa(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Qa(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const MM=new Wr;function Qa(t,e,n,r){MM.set(t,e,n);const i=MM.len();return{distance:r/i,normal:new Wr(-t/i,-e/i,-n/i)}}function HK(t){return t-Math.fround(t)}let Fl;function Nb(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Fl=Ec.allocate(Fl,s,{type:Float32Array,size:n*2});let o=r,l=0;for(;o<i;){for(let u=0;u<n;u++){const d=t[o++];Fl[l+u]=d,Fl[l+u+n]=HK(d)}l+=n*2}return Fl.subarray(0,s*n*2)}function WK(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const XK=Math.PI/180,YK=Ql(),IM=[0,0,0],GK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function KK({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=t/e,d=n?new kr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new kr().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:h=0,right:m=0,top:_=0,bottom:y=0}=s,T=Kn((h+t-m)/2,0,t)-t/2,w=Kn((_+e-y)/2,0,e)-e/2;d[8]-=T*2/t,d[9]+=w*2/e}return d}class jo{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||GK,this.focalDistance=e.focalDistance||1,this.position=e.position||IM,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ur.WEB_MERCATOR:ur.WEB_MERCATOR_AUTO_OFFSET:ur.IDENTITY}equals(e){return e instanceof jo?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Sc(e.projectionMatrix,this.projectionMatrix)&&Sc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=dD(r,this.pixelProjectionMatrix),[s,o]=i,l=n?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,l=n?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],d=fh([i,l,o],this.pixelUnprojectionMatrix,u),[h,m,_]=this.unprojectPosition(d);return Number.isFinite(o)?[h,m,_]:Number.isFinite(r)?[h,m,r]:[h,m]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=fd(e);return n[1]=Kn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?To(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?D0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,VK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=sK({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||D0({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=IM;if(s&&(l=o?new kr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new Wr(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=YK,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:d=null,focalDistance:h=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new kr().multiplyRight(n).translate(new Wr(this.center).negate()),this.projectionMatrix=r||KK({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*XK,focalDistance:h,padding:d,near:l,far:u});const m=Ql();Fs(m,m,this.projectionMatrix),Fs(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=A0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=qK(this.viewMatrixInverse);const _=Ql(),y=Ql();e2(_,_,[this.width/2,-this.height/2,1]),ld(_,_,[1,-1,0]),Fs(y,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=A0(Ql(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||yt.warn("Pixel project matrix not invertible")()}}jo.displayName="Viewport";class So extends jo{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:d,farZ:h,orthographic:m=!1,projectionMatrix:_,repeat:y=!1,worldOffset:T=0,position:w,padding:b,legacyMeterSizes:S=!1}=e;let{width:A,height:R,altitude:E=1.5}=e;const C=Math.pow(2,i);A=A||1,R=R||1;let O,P=null;if(_)E=_[5]/2,O=dd(E);else{e.fovy?(O=e.fovy,E=r2(O)):O=dd(E);let I;if(b){const{top:N=0,bottom:L=0}=b;I=[0,Kn((N+R-L)/2,0,R)-R/2]}P=oK({width:A,height:R,scale:C,center:w&&[0,0,w[2]*Cb(n)],offset:I,pitch:s,fovy:O,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(d)&&(P.near=d),Number.isFinite(h)&&(P.far=h)}let k=aK({height:R,pitch:s,bearing:o,scale:C,altitude:E});T&&(k=new kr().translate([512*T,0,0]).multiplyLeft(k)),super({...e,width:A,height:R,viewMatrix:k,longitude:r,latitude:n,zoom:i,...P,fovy:O,focalDistance:E}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=O,this.orthographic=m,this._subViewports=y?[]:null,this._pseudoMeters=S,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new So({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Cb(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Cb(r);return[n,r,i]}addMetersToLngLat(e,n){return fD(e,n)}panByPosition(e,n){const r=fh(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=nM([],i,qX([],r)),o=nM([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const n=uK(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=lK({width:r,height:i,bounds:e,...n});return new So({width:r,height:i,longitude:s,latitude:o,zoom:l})}}So.displayName="WebMercatorViewport";const OM=[0,0,0];function kb(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof So){const[i,s,o=0]=t,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function ZK(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===nt.DEFAULT&&(i=e.isGeospatial?nt.LNGLAT:nt.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function _D(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=t;switch(n&&([o,l,u]=Uc([],[o,l,u,1],n)),r){case nt.LNGLAT:return kb([o,l,u],e,s);case nt.LNGLAT_OFFSETS:return kb([o+i[0],l+i[1],u+(i[2]||0)],e,s);case nt.METER_OFFSETS:return kb(fD(i,[o,l,u]),e,s);case nt.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function QK(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=ZK(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=OM,shaderCoordinateOrigin:h=OM,offsetMode:m=!1}=u?lD(n,r,i):{},_=_D(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:m});if(m){const y=n.projectPosition(d||h);iY(_,_,y)}return _}let JK=1,eZ=1;class vD{constructor(){B(this,"time",0);B(this,"channels",new Map);B(this,"animations",new Map);B(this,"playing",!1);B(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=JK++,l={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=eZ++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function tZ(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function nZ(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let rZ=0;const iZ={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:g0.stats.get(`animation-loop-${rZ++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class sZ{constructor(e){B(this,"device",null);B(this,"canvas",null);B(this,"props");B(this,"animationProps",null);B(this,"timeline",null);B(this,"stats");B(this,"cpuTime");B(this,"gpuTime");B(this,"frameRate");B(this,"display");B(this,"needsRedraw","initialized");B(this,"_initialized",!1);B(this,"_running",!1);B(this,"_animationFrameId",null);B(this,"_nextFramePromise",null);B(this,"_resolveNextFrame",null);B(this,"_cpuStartTime",0);B(this,"_error",null);if(this.props={...iZ,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new oh({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=tZ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(nZ(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,l,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Mb={};function dh(t="id"){Mb[t]=Mb[t]||1;const e=Mb[t]++;return`${t}-${e}`}class PM{constructor(e){B(this,"id");B(this,"userData",{});B(this,"topology");B(this,"bufferLayout",[]);B(this,"vertexCount");B(this,"indices");B(this,"attributes");if(this.id=e.id||dh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Tt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function aZ(t,e){if(e instanceof PM)return e;const n=oZ(t,e),{attributes:r,bufferLayout:i}=lZ(t,e);return new PM({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function oZ(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Tt.INDEX,data:n})}function lZ(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:d,normalized:h}=o;n.push({name:l,format:rX(u,d,h)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const Od=class Od{constructor(e){B(this,"device");B(this,"destroyPolicy");B(this,"_hashCounter",0);B(this,"_hashes",{});B(this,"_renderPipelineCache",{});B(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Od(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...vo.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...ed.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof ed?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};B(Od,"defaultProps",{...vo.defaultProps});let j0=Od;const Pd=class Pd{constructor(e){B(this,"device");B(this,"destroyPolicy");B(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Pd(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};B(Pd,"defaultProps",{...Zf.defaultProps});let L0=Pd;function cZ(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let cn=null,Cs=null;function uZ(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){cn||(cn=document.createElement("canvas"),cn.id=e,cn.title=e,cn.style.zIndex="100",cn.style.position="absolute",cn.style.top=i,cn.style.left=s,cn.style.border="blue 5px solid",cn.style.transform="scaleY(-1)",document.body.appendChild(cn),Cs=cn.getContext("2d")),(cn.width!==t.width||cn.height!==t.height)&&(cn.width=t.width/2,cn.height=t.height/2,cn.style.width="400px",cn.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),u=Cs==null?void 0:Cs.createImageData(t.width,t.height);if(u){for(let h=0;h<l.length;h+=4)u.data[0+h+0]=l[h+0]*o,u.data[0+h+1]=l[h+1]*o,u.data[0+h+2]=l[h+2]*o,u.data[0+h+3]=r?255:l[h+3]*o;Cs==null||Cs.putImageData(u,0,0)}}function B0(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!B0(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!B0(t[s],e[s],n-1))return!1;return!0}return!1}function fZ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function dZ(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function yD(t){return fZ(t)||dZ(t)}function hZ(t){return yD(t)||typeof t=="number"||typeof t=="boolean"}function xD(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];hZ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class pZ{constructor(e,n){B(this,"options",{disableWarnings:!1});B(this,"modules");B(this,"moduleUniforms");B(this,"moduleBindings");Object.assign(this.options,n);const r=q1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;xe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&xe.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||xe.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],d=((n=o.getUniforms)==null?void 0:n.call(o,s,l))||s,{uniforms:h,bindings:m}=xD(d);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...u,...m}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let gZ="";async function mZ(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:gZ+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class Ib{constructor(e,n){B(this,"device");B(this,"id");B(this,"texture");B(this,"sampler");B(this,"view");B(this,"ready");B(this,"isReady",!1);B(this,"destroyed",!1);B(this,"resolveReady",()=>{});B(this,"rejectReady",()=>{});this.device=e,this.id=n.id||dh("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:mZ(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data;let r;try{r=await bD(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function bD(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(bD));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const Ns=2,_Z=1e4,Dd=class Dd{constructor(e,n){B(this,"device");B(this,"id");B(this,"source");B(this,"vs");B(this,"fs");B(this,"pipelineFactory");B(this,"shaderFactory");B(this,"userData",{});B(this,"parameters");B(this,"topology");B(this,"bufferLayout");B(this,"isInstanced");B(this,"instanceCount",0);B(this,"vertexCount");B(this,"indexBuffer",null);B(this,"bufferAttributes",{});B(this,"constantAttributes",{});B(this,"bindings",{});B(this,"uniforms",{});B(this,"vertexArray");B(this,"transformFeedback",null);B(this,"pipeline");B(this,"shaderInputs");B(this,"_uniformStore");B(this,"_attributeInfos",{});B(this,"_gpuGeometry",null);B(this,"_getModuleUniforms");B(this,"props");B(this,"_pipelineNeedsUpdate","newly created");B(this,"_needsRedraw","initializing");B(this,"_destroyed",!1);B(this,"_lastDrawTimestamp",-1);B(this,"_lastLogTime",0);B(this,"_logOpen",!1);B(this,"_drawCount",0);var u,d,h,m;this.props={...Dd.defaultProps,...n},n=this.props,this.id=n.id||dh("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(_=>[_.name,_]))||[]),i=n.shaderInputs||new pZ(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=yZ(e),o=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(h=this.shaderInputs)==null?void 0:h.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=_,this._getModuleUniforms=y,(m=this.props).shaderLayout||(m.shaderLayout=OX(this.source))}else{const{vs:_,fs:y,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=_,this.fs=y,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||j0.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||L0.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return xe.info(Ns,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),U0(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&aZ(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new yb(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new yb(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){B0(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new nX(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(vZ(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&xe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=iX(this.pipeline.shaderLayout,this.bufferLayout);const i=new yb(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||xe.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let d=!1;for(const h of u){const m=this._attributeInfos[h];if(m){const _=this.device.type==="webgpu"?i.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(_,o),d=!0}}!d&&!r&&xe.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||xe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){U0(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=xD(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Ib&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof Ib?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Kf?e=Math.max(e,n.texture.updateTimestamp):n instanceof Tt||n instanceof jt?e=Math.max(e,n.updateTimestamp):n instanceof Ib?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Qf||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(xe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=xP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=xe.level>3?0:_Z;xe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,xe.group(Ns,`>>> DRAWING MODEL ${this.id}`,{collapsed:xe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=cZ(this.pipeline.shaderLayout,this.id);xe.table(Ns,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};xe.table(Ns,n)();const r=this._getAttributeDebugTable();xe.table(Ns,this._attributeInfos)(),xe.table(Ns,r)(),xe.groupEnd(Ns)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&uZ(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=TP(n);return(e instanceof Tt?new r(e.debugData):e).toString()}};B(Dd,"defaultProps",{...vo.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Gf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Eo=Dd;function vZ(t){return!!(t.uniformTypes&&!U0(t.uniformTypes))}function yZ(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function U0(t){for(const e in t)return!1;return!0}const dc=class dc{constructor(e,n=dc.defaultProps){B(this,"device");B(this,"model");B(this,"transformFeedback");if(!dc.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Eo(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||sW(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof Tt)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};B(dc,"defaultProps",{...Eo.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Ac=dc;class wD{constructor(e){B(this,"id");B(this,"topology");B(this,"vertexCount");B(this,"indices");B(this,"attributes");B(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||dh("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const xZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class TD extends i2{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:d,height:h},cullRect:m,effects:_,pass:y="picking",pickZ:T,shaderModuleProps:w}){this.pickZ=T;const b=this._resetColorEncoder(T),S=[l,u,d,h],A=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:m,effects:_==null?void 0:_.filter(E=>E.useInPicking),pass:y,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:S});return this._colorEncoderState=null,{decodePickingColor:b&&wZ.bind(null,b),stats:A}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,xZ),i.blend=!0,i.blendColor=bZ(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function bZ(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(yt.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function wZ(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ro={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},hd=Symbol.for("component"),zs=Symbol.for("propTypes"),Ob=Symbol.for("deprecatedProps"),po=Symbol.for("asyncPropDefaults"),Ys=Symbol.for("asyncPropOriginal"),is=Symbol.for("asyncPropResolved");function SD(t,e=()=>!0){return Array.isArray(t)?ED(t,e,[]):e(t)?[t]:[]}function ED(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?ED(i,e,n):e(i)&&n.push(i)}return n}function TZ({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=n;o<i;o++)t[l++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class SZ{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=l0(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class EZ{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new SZ(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[n];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[n]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const AZ="layerManager.setLayers",RZ="layerManager.activateViewport";class CZ{constructor(e,n){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{An(RZ,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new EZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:RK(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[LY],renderPass:void 0,stats:i||new oh({id:"deck.gl"}),viewport:s||new jo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new vD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){An(AZ,this,n,e),this._lastRenderedLayers=e;const r=SD(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?yt.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&yt.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ro.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ro.MATCHED,n!==e&&(e.lifecycle=ro.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ro.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ro.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Cr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Cr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Cr(t[s],e[s],n-1))return!1;return!0}return!1}class NZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=SD(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Cr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):yt.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=n[s.id];const d=!!s.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const kZ=/([0-9]+\.?[0-9]*)(%|px)/;function Hi(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=kZ.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Wi(t,e){return t.relative?Math.round(t.position*e):t.position}class Gs{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Hi(r),this._y=Hi(i),this._width=Hi(s),this._height=Hi(o),this._padding=l&&{left:Hi(l.left||0),right:Hi(l.right||0),top:Hi(l.top||0),bottom:Hi(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Cr(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Wi(this._x,e),y:Wi(this._y,n),width:Wi(this._width,e),height:Wi(this._height,n)};return this._padding&&(r.padding={left:Wi(this._padding.left,e),top:Wi(this._padding.top,n),right:Wi(this._padding.right,e),bottom:Wi(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class hh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const DM=()=>{},F0={BREAK:1,SNAP_TO_END:2,IGNORE:3},MZ=t=>t,IZ=F0.BREAK;class OZ{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=n,d=u(r/l),h=i.interpolateProps(s,o,d);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new hh(e.timeline),this.onViewStateChange=e.onViewStateChange||DM,this.onStateChange=e.onStateChange||DM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===F0.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===F0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:n.transitionEasing||MZ,interpolator:s,interruption:n.transitionInterruption||IZ,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Tn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class PZ{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Sc(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Tn(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const DZ=["longitude","latitude","zoom","bearing","pitch"],jZ=["longitude","latitude","zoom"];class s2 extends PZ{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:DZ,required:jZ},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(n),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=od(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,od(e.around,n.around,r)))}return i}}const Xi={transitionDuration:0},LZ=300,mf=t=>1-(1-t)*(1-t),Ja={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},ks={};class AD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new OZ({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?LZ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:d=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(Ja.WHEEL,h&&r),this.toggleEvents(Ja.PAN,h),this.toggleEvents(Ja.PINCH,h&&(l||u)),this.toggleEvents(Ja.MULTI_PAN,h&&u),this.toggleEvents(Ja.DOUBLE_CLICK,h&&o),this.toggleEvents(Ja.KEYBOARD,h&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Xi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Xi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mf},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Xi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mf},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Xi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Xi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:mf},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ks._startPinchRotation=e.rotation,ks._lastPinchEvent=e,this.updateViewport(r,Xi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:ks._startPinchRotation-r})}return this.updateViewport(n,Xi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ks._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=ks;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*n/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:mf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ks._startPinchRotation=null,ks._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=n?l.zoomOut(r).zoomOut(r):l.zoomOut(r),d.isZooming=!0;break;case"Equal":u=n?l.zoomIn(r).zoomIn(r):l.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":n?(u=l.rotateLeft(s),d.isRotating=!0):(u=l.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":n?(u=l.rotateRight(s),d.isRotating=!0):(u=l.moveRight(i),d.isPanning=!0);break;case"ArrowUp":n?(u=l.rotateUp(o),d.isRotating=!0):(u=l.moveUp(i),d.isPanning=!0);break;case"ArrowDown":n?(u=l.rotateDown(o),d.isRotating=!0):(u=l.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Xi:e?{...n,transitionInterpolator:new s2({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class RD{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const jM=5,BZ=1.2;class UZ extends RD{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:d=1.5,position:h=[0,0,0],maxZoom:m=20,minZoom:_=0,maxPitch:y=60,minPitch:T=0,startPanLngLat:w,startZoomLngLat:b,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E,normalize:C=!0}=e;Tn(Number.isFinite(s)),Tn(Number.isFinite(i)),Tn(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:d,maxZoom:m,minZoom:_,maxPitch:y,minPitch:T,normalize:C,position:h},{startPanLngLat:w,startZoomLngLat:b,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+n,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Kn(u,l,o);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Kn(i,r,n);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Kn(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,fK(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],l=e[1],u=n[1],{width:d,height:h}=this.getViewportProps(),m=s/d;let _=0;o>0?Math.abs(h-u)>jM&&(_=o/(u-h)*BZ):o<0&&u>jM&&(_=1-l/u),_=Kn(_,-1,1);const{minPitch:y,maxPitch:T}=this.getViewportProps(),w=i+180*m;let b=r;return _>0?b=r+_*(T-r):_<0&&(b=r-_*(y-r)),{pitch:b,bearing:w}}}class FZ extends AD{constructor(){super(...arguments),this.ControllerState=UZ,this.transition={transitionDuration:300,transitionInterpolator:new s2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class CD extends Gs{constructor(e={}){super(e)}getViewportType(){return So}get ControllerType(){return FZ}}CD.displayName="MapView";const zZ=new mD;function $Z(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class qZ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>$Z(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Cr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof mD)||this._resolvedEffects.push(zZ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class VZ extends i2{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const HZ="deckRenderer.renderLayers";class WZ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new VZ(e),this.pickLayersPass=new TD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,An(HZ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const XZ={pickedColor:null,pickedObjectIndex:-1};function YZ({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:d}=s;let h=i*i,m=-1,_=0;for(let y=0;y<d;y++){const T=y+l-r,w=T*T;if(w>h)_+=4*u;else for(let b=0;b<u;b++){if(t[_+3]-1>=0){const A=b+o-n,R=A*A+w;R<=h&&(h=R,m=_)}_+=4}}if(m>=0){const y=t.slice(m,m+4),T=e(y);if(T){const w=Math.floor(m/4/u),b=m/4-w*u;return{...T,pickedColor:y,pickedX:o+b,pickedY:l+w}}yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return XZ}function GZ({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const l=e(s);l?n.set(o,{...l,color:s}):yt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function ND({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=ZZ((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function KZ(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const m=n.index,_=n.layerId,y=o?o.props.id:null;if(y!==_||l!==m){if(y!==_){const T=i.find(w=>w.props.id===_);T&&u.unshift(T)}n.layerId=y,n.index=l,n.info=null}}const d=ND(t),h=new Map;return h.set(null,d),u.forEach(m=>{let _={...d};m===o&&(_.color=s,_.index=l,_.picked=!0),_=kD({layer:m,info:_,mode:r});const y=_.layer;m===o&&r==="hover"&&(n.info=_),h.set(y.id,_),r==="hover"&&y.updateAutoHighlight(_)}),h}function kD({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function ZZ(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class QZ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new TD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(_=>_.id===o):null,d=l&&i.find(_=>_.id===l)||i[0],h=d&&d.unproject([e-d.x,n-d.y]);return{...s,...{x:e,y:n,viewport:d,coordinate:h,layer:u}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:d,onViewportActive:h,effects:m}){const _=this.device.canvasContext.cssToDeviceRatio(),y=this._getPickable(e);if(!y||r.length===0)return{result:[],emptyInfo:ND({viewports:r,x:i,y:s,pixelRatio:_})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],b=Math.round(o*_),{width:S,height:A}=this.pickingFBO,R=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:b,deviceWidth:S,deviceHeight:A}),E={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const O=[],P=new Set;for(let k=0;k<l;k++){let I;if(R){const L=this._drawAndSample({layers:y,views:n,viewports:r,onViewportActive:h,deviceRect:R,cullRect:E,effects:m,pass:`picking:${u}`});I=YZ({...L,deviceX:w[0],deviceY:w[1],deviceRadius:b,deviceRect:R})}else I={pickedColor:null,pickedObjectIndex:-1};let N;if(I.pickedLayer&&d&&this.depthFBO){const{pickedColors:L}=this._drawAndSample({layers:[I.pickedLayer],views:n,viewports:r,onViewportActive:h,deviceRect:{x:I.pickedX,y:I.pickedY,width:1,height:1},cullRect:E,effects:m,pass:`picking:${u}:z`},!0);L[3]&&(N=L[0])}I.pickedLayer&&k+1<l&&(P.add(I.pickedLayer),I.pickedLayer.disablePickingIndex(I.pickedObjectIndex)),C=KZ({pickInfo:I,lastPickedInfo:this.lastPickedInfo,mode:u,layers:y,viewports:r,x:i,y:s,z:N,pixelRatio:_});for(const L of C.values())L.layer&&O.push(L);if(!I.pickedColor)break}for(const k of P)k.restorePickingColors();return{result:O,emptyInfo:C.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:d=null,onViewportActive:h,effects:m}){const _=this._getPickable(e);if(!_||r.length===0)return[];this._resizeBuffer();const y=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=T.x,b=T.y+T.height,S=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),A=S.x+S.width,R=S.y,E={x:w,y:R,width:A-w,height:b-R},C=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:h,deviceRect:E,cullRect:{x:i,y:s,width:o,height:l},effects:m,pass:`picking:${u}`}),O=GZ(C),P=new Map,k=[],I=Number.isFinite(d);for(let N=0;N<O.length&&!(I&&k.length>=d);N++){const L=O[N];let $={color:L.pickedColor,layer:null,index:L.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:y};$=kD({layer:L.pickedLayer,info:$,mode:u});const Z=$.layer.id;P.has(Z)||P.set(Z,new Set);const V=P.get(Z),q=$.object??$.index;V.has(q)||(V.add(q),k.push($))}return k}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},d=!1){const h=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const A of l)A.useInPicking&&(m.preRenderStats[A.id]=A.preRender(m));const{decodePickingColor:_}=this.pickLayersPass.render(m),{x:y,y:T,width:w,height:b}=s,S=new(d?Float32Array:Uint8Array)(w*b*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:y,sourceY:T,sourceWidth:w,sourceHeight:b,target:S}),{pickedColors:S,decodePickingColor:_}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,n-r),u=Math.min(i,e+r+1)-o,d=Math.min(s,n+r+1)-l;return u<=0||d<=0?null:{x:o,y:l,width:u,height:d}}}const JZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},eQ="top-left",LM="__root";class tQ{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Cr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=eQ}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||LM;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,JZ[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===LM||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=r[l];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:n}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=I0[n.type];if(r)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}}const nQ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class rQ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,nQ),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var so;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(so||(so={}));const a2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vt=(t,e,n)=>e?t.enable(n):t.disable(n),BM=(t,e,n)=>t.hint(n,e),Wn=(t,e,n)=>t.pixelStorei(n,e),UM=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},zl=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function Pb(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const iQ={3042:Vt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Vt,2885:(t,e)=>t.cullFace(e),2929:Vt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Vt,35723:BM,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:UM,36010:UM,34964:zl,36662:zl,36663:zl,35053:zl,35055:zl,2886:(t,e)=>t.frontFace(e),33170:BM,2849:(t,e)=>t.lineWidth(e),32823:Vt,32824:"polygonOffset",10752:"polygonOffset",35977:Vt,32926:Vt,32928:Vt,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vt,3088:(t,e)=>t.scissor(...e),2960:Vt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Vt,10754:Vt,12288:Vt,12289:Vt,12290:Vt,12291:Vt,12292:Vt,12293:Vt,12294:Vt,12295:Vt,3333:Wn,3317:Wn,37440:Wn,37441:Wn,37443:Wn,3330:Wn,3332:Wn,3331:Wn,3314:Wn,32878:Wn,3316:Wn,3315:Wn,32877:Wn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Pb(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Pb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,l)},stencilOp:(t,e)=>{e=Pb(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,l)},viewport:(t,e)=>t.viewport(...e)};function Dt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const sQ={blendEquation:(t,e,n)=>t.blendEquationSeparate(Dt(32777,e,n),Dt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Dt(32969,e,n),Dt(32968,e,n),Dt(32971,e,n),Dt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Dt(32824,e,n),Dt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Dt(32938,e,n),Dt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Dt(2962,e,n),Dt(2967,e,n),Dt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Dt(34816,e,n),Dt(36003,e,n),Dt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Dt(2964,e,n),Dt(2965,e,n),Dt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Dt(34817,e,n),Dt(34818,e,n),Dt(34819,e,n))},FM={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Fr=(t,e)=>t.isEnabled(e),zM={3042:Fr,2884:Fr,2929:Fr,3024:Fr,32823:Fr,32926:Fr,32928:Fr,3089:Fr,2960:Fr,35977:Fr},aQ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Lo(t,e){if(lQ(e))return;const n={};for(const i in e){const s=Number(i),o=iQ[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=sQ[i];s(t,e,r)}}function MD(t,e=a2){if(typeof e=="number"){const i=e,s=zM[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=zM[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function oQ(t){Lo(t,a2)}function lQ(t){for(const e in t)return!1;return!0}function cQ(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class $s{constructor(e,n){B(this,"gl");B(this,"program",null);B(this,"stateStack",[]);B(this,"enable",!0);B(this,"cache",null);B(this,"log");B(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Lo(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?MD(e):Object.assign({},a2),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,fQ(e);for(const r in FM){const i=FM[r];uQ(e,r,i)}$M(e,"getParameter"),$M(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];cQ(o,l)||(n=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function $M(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||aQ.has(i))return n(i);const s=$s.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function uQ(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=$s.get(t),{valueChanged:l,oldValue:u}=n(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function fQ(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=$s.get(t);i.program!==r&&(e(r),i.program=r)}}function dQ(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return t.addEventListener("webglcontextlost",u=>o(u),!1),t.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||(s.luma={}),s}function Ao(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function hQ(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Ao(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||n,u=o||r,d=t.getParameter(7938),h=ID(l,u),m=pQ(l,u),_=gQ(l,u);return{type:"webgl",gpu:h,gpuType:_,gpuBackend:m,vendor:l,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ID(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function pQ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function gQ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(ID(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function OD(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Jl="WEBGL_compressed_texture_s3tc",ec="WEBGL_compressed_texture_s3tc_srgb",ao="EXT_texture_compression_rgtc",oo="EXT_texture_compression_bptc",mQ="WEBGL_compressed_texture_etc",_Q="WEBGL_compressed_texture_astc",vQ="WEBGL_compressed_texture_etc1",yQ="WEBGL_compressed_texture_pvrtc",xQ="WEBGL_compressed_texture_atc",qM="EXT_texture_norm16",VM="EXT_render_snorm",bQ="EXT_color_buffer_float",o2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[VM],"norm16-renderable-webgl":[qM],"snorm16-renderable-webgl":[qM,VM],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Jl,ec,ao,oo],"texture-compression-bc5-webgl":[ao],"texture-compression-bc7-webgl":[oo],"texture-compression-etc2":[mQ],"texture-compression-astc":[_Q],"texture-compression-etc1-webgl":[vQ],"texture-compression-pvrtc-webgl":[yQ],"texture-compression-atc-webgl":[xQ]};function wQ(t){return t in o2}function TQ(t,e,n){return(o2[e]||[]).every(i=>Ao(t,i,n))}const l2={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:bQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Jl},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ec},"bc1-rgba-unorm":{gl:33777,x:Jl},"bc1-rgba-unorm-srgb":{gl:35916,x:ec},"bc2-rgba-unorm":{gl:33778,x:Jl},"bc2-rgba-unorm-srgb":{gl:35918,x:ec},"bc3-rgba-unorm":{gl:33779,x:Jl},"bc3-rgba-unorm-srgb":{gl:35919,x:ec},"bc4-r-unorm":{gl:36283,x:ao},"bc4-r-snorm":{gl:36284,x:ao},"bc5-rg-unorm":{gl:36285,x:ao},"bc5-rg-snorm":{gl:36286,x:ao},"bc6h-rgb-ufloat":{gl:36495,x:oo},"bc6h-rgb-float":{gl:36494,x:oo},"bc7-rgba-unorm":{gl:36492,x:oo},"bc7-rgba-unorm-srgb":{gl:36493,x:oo},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function SQ(t,e,n){let r=e.create;const i=l2[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!Ao(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function PD(t){var i;const e=l2[t],n=RQ(t),r=V1(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||AQ(r.channels,r.integer,r.normalized,n),type:r.dataType?OD(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function EQ(t){switch(V1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function AQ(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function RQ(t){const e=l2[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const HM={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class CQ extends bW{constructor(n,r,i){super([],i);B(this,"gl");B(this,"extensions");B(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Ao(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),wQ(n)&&TQ(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(HM),...Object.keys(o2)]}getWebGLFeature(n){const r=HM[n];return typeof r=="string"?!!Ao(this.gl,r,this.extensions):!!r}}class NQ extends xW{constructor(n){super();B(this,"gl");B(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class oc extends Jf{constructor(n,r){super(n,r);B(this,"device");B(this,"gl");B(this,"handle");B(this,"colorAttachments",[]);B(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=EQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${MQ(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,l);break;case 34067:const u=kQ(l);i.framebufferTexture2D(36160,n,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function kQ(t){return t<34069?t+34069:t}function MQ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class IQ extends m0{constructor(n,r){super(r);B(this,"device");B(this,"format","rgba8unorm");B(this,"depthStencilFormat","depth24plus");B(this,"presentationSize");B(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new oc(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function DD(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const OQ=1;let gt=null,WM=!1;const c2={debugSpectorJS:xe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function PQ(t){if(!globalThis.SPECTOR)try{await DD(t.debugSpectorJSUrl||c2.debugSpectorJSUrl)}catch(e){xe.warn(String(e))}}function DQ(t){var e;if(t={...c2,...t},!t.debugSpectorJS)return null;if(!gt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){xe.probe(OQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;gt=new n,globalThis.luma&&(globalThis.luma.spector=gt)}if(!gt)return null;if(WM||(WM=!0,gt.spyCanvases(),gt==null||gt.onCaptureStarted.add(n=>xe.info("Spector capture started:",n)()),gt==null||gt.onCapture.add(n=>{xe.info("Spector capture complete:",n)(),gt==null||gt.getResultUI(),gt==null||gt.resultView.display(),gt==null||gt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;gt==null||gt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{xe.info("Spector capture stopped after 2 seconds")(),gt==null||gt.stopCapture()})}return gt}const jQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function jD(t){return t.luma=t.luma||{},t.luma}async function LQ(){ra()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await DD(jQ))}function BQ(t,e={}){return e.debugWebGL||e.traceWebGL?FQ(t,e):UQ(t)}function UQ(t){const e=jD(t);return e.realContext?e.realContext:t}function FQ(t,e){if(!globalThis.WebGLDebugUtils)return xe.warn("webgl-debug not loaded")(),t;const n=jD(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...so,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,zQ.bind(null,e),$Q.bind(null,e));for(const o in so)!(o in r)&&typeof so[o]=="number"&&(r[o]=so[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function XM(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function zQ(t,e,n,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;xe.error(o)();debugger}function $Q(t,e,n){let r="";xe.level>=1&&(r=XM(e,n),t.traceWebGL&&xe.log(1,r)());for(const i of n)if(i===void 0){r=r||XM(e,n);debugger}}const Db={};function qQ(t="id"){Db[t]=Db[t]||1;const e=Db[t]++;return`${t}-${e}`}class lc extends Tt{constructor(n,r={}){super(n,r);B(this,"device");B(this,"gl");B(this,"handle");B(this,"glTarget");B(this,"glUsage");B(this,"glIndexType",5123);B(this,"byteLength");B(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=VQ(this.props.usage),this.glUsage=HQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function VQ(t){return t&Tt.INDEX?34963:t&Tt.VERTEX?34962:t&Tt.UNIFORM?35345:34962}function HQ(t){return t&Tt.INDEX||t&Tt.VERTEX?35044:t&Tt.UNIFORM?35048:35044}function WQ(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[m,_]=i;n.push({message:_.trim(),type:YM(m),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let d=parseInt(l,10);isNaN(d)&&(d=0);let h=parseInt(o,10);isNaN(h)&&(h=0),n.push({message:u.join(":").trim(),type:YM(s),lineNum:d,linePos:h})}return n}function YM(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class XQ extends Zf{constructor(n,r){super(n,r);B(this,"device");B(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?WQ(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}xe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),xe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function YQ(t,e,n,r){if(QQ(e))return r(t);const i=t;i.pushState();try{return GQ(t,e),Lo(i.gl,n),r(t)}finally{i.popState()}}function GQ(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(qs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=qs("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=qs("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(ZQ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(z0("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&xe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=z0("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=jb("stencilPassOperation",e.stencilPassOperation),s=jb("stencilFailOperation",e.stencilFailOperation),o=jb("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=GM("blendColorOperation",e.blendColorOperation||"add"),s=GM("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=_f("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=_f("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=_f("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=_f("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,d)}}function z0(t,e){return qs(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function jb(t,e){return qs(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function GM(t,e){return qs(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function _f(t,e){return qs(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function KQ(t,e){return`Illegal parameter ${e} for ${t}`}function qs(t,e,n){if(!(e in n))throw new Error(KQ(t,e));return n[e]}function ZQ(t,e){return e}function QQ(t){let e=!0;for(const n in t){e=!1;break}return e}function LD(t){const e={};return t.addressModeU&&(e[10242]=Lb(t.addressModeU)),t.addressModeV&&(e[10243]=Lb(t.addressModeV)),t.addressModeW&&(e[32882]=Lb(t.addressModeW)),t.magFilter&&(e[10240]=$0(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=JQ(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=z0("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Lb(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function $0(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function JQ(t,e="none"){if(!e)return $0(t);switch(e){case"none":return $0(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class q0 extends Qf{constructor(n,r){super(n,r);B(this,"device");B(this,"handle");B(this,"parameters");this.device=n,this.parameters=LD(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class lo extends Kf{constructor(n,r){super(n,{...jt.defaultProps,...r});B(this,"device");B(this,"gl");B(this,"handle");B(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const eJ="Failed to deduce GL constant from typed array";function tJ(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(eJ)}}function nJ(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function BD(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function rJ(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function pd(t,e,n){if(iJ(e))return n(t);const{nocatch:r=!0}=e,i=$s.get(t);i.push(),Lo(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function iJ(t){for(const e in t)return!1;return!0}function sJ(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:l}=n,u=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,l,i,s,o);break;default:t.texStorage2D(u,e,l,i,s)}}function KM(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:d=0,y:h=0,z:m=0}=r,{glFormat:_,glType:y}=r,T=UD(r.glTarget,o,l),w=r.flipY?{37440:!0}:{};pd(t,w,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(T,e),t.texSubImage3D(T,u,d,h,m,i,s,l,_,y,n),t.bindTexture(T,null);break;case"2d":case"cube":t.bindTexture(T,e),t.texSubImage2D(T,u,d,h,i,s,_,y,n),t.bindTexture(T,null);break;default:throw new Error(o)}})}function ZM(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=n,{x:d=0,y:h=0,z:m=0}=n,{glFormat:_,glType:y,compressed:T}=n,w=UD(n.glTarget,r,o);switch(r){case"2d-array":case"3d":T?t.compressedTexSubImage3D(w,l,d,h,m,i,s,o,_,e,u):t.texSubImage3D(w,l,d,h,m,i,s,o,_,y,e,u);break;case"2d":case"cube":T?t.compressedTexSubImage2D(w,l,d,h,i,s,_,e,u):t.texSubImage2D(w,l,d,h,i,s,_,y,e,u);break;default:throw new Error(r)}}function aJ(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function UD(t,e,n){return e==="cube"?34069+n:t}function oJ(t,e){var S;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:d,sourceType:h}=e||{};const{framebuffer:m,deleteFramebuffer:_}=FD(t),{gl:y,handle:T}=m;o||(o=m.width),l||(l=m.height);const w=(S=m.colorAttachments[i])==null?void 0:S.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);u=(w==null?void 0:w.depth)||1,d||(d=(w==null?void 0:w.glFormat)||6408),h||(h=(w==null?void 0:w.glType)||5121),s=uJ(s,h,d,o,l),h=h||tJ(s);const b=y.bindFramebuffer(36160,T);return y.readBuffer(36064+i),y.readPixels(n,r,o,l,d,h,s),y.readBuffer(36064),y.bindFramebuffer(36160,b||null),_&&m.destroy(),s}function lJ(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:h,deleteFramebuffer:m}=FD(t);l=l||h.width,u=u||h.height;const _=h;d=d||5121;let y=n;if(!y){const w=BD(s),b=rJ(d),S=o+l*u*w*b;y=_.device.createBuffer({byteLength:S})}const T=t.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:t,width:l,height:u,origin:[r,i],destinationBuffer:y,byteOffset:o}),T.destroy(),m&&h.destroy(),y}function FD(t){return t instanceof Jf?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:cJ(t),deleteFramebuffer:!0}}function cJ(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function uJ(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=nJ(e,{clamped:!1}),l=BD(n);return new o(r*i*l)}class cc extends jt{constructor(n,r){super(n,r);B(this,"device");B(this,"gl");B(this,"handle");B(this,"sampler");B(this,"view");B(this,"mipmaps");B(this,"compressed");B(this,"glTarget");B(this,"glFormat");B(this,"glType");B(this,"glInternalFormat");B(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=aJ(this.props.dimension);const s=PD(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=jt.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new lo(this.device,{...this.props,texture:this}),this.bind(),sJ(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new lo(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof q0?(this.sampler=n,r=n.props):(this.sampler=new q0(this.device,n),r=n);const i=LD(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(xe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){xe.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=jt.getExternalImageSize(n.image),i={...jt.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:l,x:u,y:d,z:h,flipY:m}=i;let{width:_,height:y}=i;const{dimension:T,glTarget:w,glFormat:b,glInternalFormat:S,glType:A}=this;if(_=Math.min(_,this.width-u),y=Math.min(y,this.height-d),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return KM(this.device.gl,this.handle,s,{dimension:T,mipLevel:l,x:u,y:d,z:h,width:_,height:y,depth:o,glFormat:b,glType:A,glTarget:w,flipY:m}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=jt.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&xe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),ZM(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of jt.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&xe.warn(`${this.id} has mipmap and multiple LODs.`)();const s=jt.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:l,format:u=6408,type:d=5121}=n,{gl:h}=this,m=o||l;this.bind(),m instanceof Promise?m.then(_=>this.setImageDataForFace(Object.assign({},n,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,u,i,s,0,u,d,m):h.texImage2D(r,0,u,u,d,m)}_getImageDataMap(n){for(let r=0;r<jt.CubeFaces.length;++r){const i=jt.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){xe.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(jt.isExternalImage(i)){KM(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(jt.isTextureLevelData(i)){ZM(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const fJ=[1,2,4,8];class dJ extends _0{constructor(n,r){var o;super(n,r);B(this,"device");B(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:l,height:u}=r.framebuffer;i=[0,0,l,u]}else{const[l,u]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,l,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=fJ.map(i=>!!(i&n.colorMask))),this.glParameters=r,Lo(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&pd(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){pd(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function hJ(t){return pJ.includes(t)}const pJ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],zD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function $D(t){const e=zD[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function gJ(t){const e=zD[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function mJ(t,e){const n={attributes:[],bindings:[]};n.attributes=_J(t,e);const r=xJ(t,e);for(const l of r){const u=l.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));n.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=yJ(t,e);let s=0;for(const l of i)if(hJ(l.type)){const{viewDimension:u,sampleType:d}=wJ(l.type);n.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:d}),l.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=vJ(t,e);return o!=null&&o.length&&(n.varyings=o),n}function _J(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=t.getAttribLocation(e,o);if(u>=0){const{attributeType:d}=gJ(l),h=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:u,stepMode:h,type:d})}}return n.sort((i,s)=>i.location-s.location),n}function vJ(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:d,components:h}=$D(l),m={location:i,name:o,type:d,size:u*h};n.push(m)}return n.sort((i,s)=>i.location-s.location),n}function yJ(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:d,isArray:h}=TJ(o);let m=t.getUniformLocation(e,d);const _={location:m,name:d,size:l,type:u,isArray:h};if(n.push(_),_.size>1)for(let y=0;y<_.size;y++){const T=`${d}[${y}]`;m=t.getUniformLocation(e,T);const w={..._,name:T,location:m};n.push(w)}}return n}function xJ(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},l=n(s,35395)||[],u=t.getActiveUniforms(e,l,35383),d=t.getActiveUniforms(e,l,35384),h=t.getActiveUniforms(e,l,35387),m=t.getActiveUniforms(e,l,35388);for(let _=0;_<o.uniformCount;++_){const y=t.getActiveUniform(e,l[_]);if(!y)throw new Error("activeInfo");o.uniforms.push({name:y.name,format:$D(u[_]).format,type:u[_],arrayLength:d[_],byteOffset:h[_],byteStride:m[_]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const bJ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function wJ(t){const e=bJ[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function TJ(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function SJ(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function EJ(t){return yD(t)!==null||typeof t=="number"||typeof t=="boolean"}function AJ(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];EJ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function RJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function CJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const QM=4;class NJ extends vo{constructor(n,r){super(n,r);B(this,"device");B(this,"handle");B(this,"vs");B(this,"fs");B(this,"introspectedLayout");B(this,"uniforms",{});B(this,"bindings",{});B(this,"varyings",null);B(this,"_uniformCount",0);B(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),xe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=mJ(this.device.gl,this.handle),xe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=kJ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||xe.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||xe.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof lc)&&!(s.buffer instanceof lc))throw new Error("buffer value");break;case"texture":if(!(s instanceof lo||s instanceof cc||s instanceof oc))throw new Error("texture value");break;case"sampler":xe.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var b;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:d=!1,firstVertex:h=0,transformFeedback:m}=n,_=RJ(s),y=!!o.indexBuffer,T=(b=o.indexBuffer)==null?void 0:b.glIndexType;if(this.linkStatus!=="success")return xe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return xe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),m&&m.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return YQ(this.device,i,w.glParameters,()=>{y&&d?this.device.gl.drawElementsInstanced(_,l||0,T,h,u||0):y?this.device.gl.drawElements(_,l||0,T,h):d?this.device.gl.drawArraysInstanced(_,h,l||0,u||0):this.device.gl.drawArrays(_,h,l||0),m&&m.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=AJ(n);Object.keys(r).forEach(i=>{xe.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),xe.time(QM,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),xe.timeEnd(QM,`linkProgram for ${this.id}`)(),xe.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}xe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),xe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(xe.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=n.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);n.uniformBlockBinding(this.handle,i,u),o instanceof lc?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof lo||o instanceof cc||o instanceof oc))throw new Error("texture");let d;if(o instanceof lo)d=o.texture;else if(o instanceof cc)d=o;else if(o instanceof oc&&o.colorAttachments[0]instanceof lo)xe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,l=this.uniforms[r]??o;l!==void 0&&SJ(this.device.gl,i,s,l)}}}function kJ(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):xe.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class MJ extends y0{constructor(n){super(n,{});B(this,"device");B(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":IJ(this.device,r.options);break;case"copy-buffer-to-texture":OJ(this.device,r.options);break;case"copy-texture-to-buffer":PJ(this.device,r.options);break;case"copy-texture-to-texture":DJ(this.device,r.options);break;default:throw new Error(r.name)}}}function IJ(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function OJ(t,e){throw new Error("Not implemented")}function PJ(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:d,byteOffset:h=0,bytesPerRow:m,rowsPerImage:_}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||m||_)throw new Error("not implemented");const{framebuffer:y,destroyFramebuffer:T}=qD(n);let w;try{const b=d,S=s||y.width,A=o||y.height,R=PD(y.colorAttachments[0].texture.props.format),E=R.format,C=R.type;t.gl.bindBuffer(35051,b.handle),w=t.gl.bindFramebuffer(36160,y.handle),t.gl.readPixels(u[0],u[1],S,A,E,C,h)}finally{t.gl.bindBuffer(35051,null),w!==void 0&&t.gl.bindFramebuffer(36160,w),T&&y.destroy()}}function DJ(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:h}=qD(n),[m,_]=i,[y,T,w]=s,b=t.gl.bindFramebuffer(36160,d.handle);let S=null,A;if(o instanceof cc)S=o,l=Number.isFinite(l)?l:S.width,u=Number.isFinite(u)?u:S.height,S.bind(0),A=S.glTarget;else throw new Error("invalid destination");switch(A){case 3553:case 34067:t.gl.copyTexSubImage2D(A,r,y,T,m,_,l,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(A,r,y,T,w,m,_,l,u);break}S&&S.unbind(),t.gl.bindFramebuffer(36160,b),h&&d.destroy()}function qD(t){if(t instanceof jt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class jJ extends v0{constructor(n,r){super(n,r);B(this,"device");B(this,"commandBuffer");this.device=n,this.commandBuffer=new MJ(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function LJ(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=n[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return t.target}class u2 extends x0{constructor(n,r){super(n,r);B(this,"device");B(this,"handle");B(this,"buffer",null);B(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return uq()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:d,integer:h,divisor:m}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(n,s,o,l,u):this.device.gl.vertexAttribPointer(n,s,o,d,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,m||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=OD(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=u2.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=BJ(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!UJ(i,this.bufferValue),l){const u=KW(r.constructor,o);LJ({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function BJ(t){return Array.isArray(t)?new Float32Array(t):t}function UJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class FJ extends b0{constructor(n,r){super(n,r);B(this,"device");B(this,"gl");B(this,"handle");B(this,"layout");B(this,"buffers",{});B(this,"unusedBuffers",{});B(this,"bindOnUse",!0);B(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(CJ(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,xe.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(n){if(JM(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof lc)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(JM(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function JM(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class zJ extends w0{constructor(n,r){super(n,r);B(this,"device");B(this,"handle");B(this,"target",null);B(this,"_queryPending",!1);B(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class co extends ss{constructor(n){var m,_;super({...n,id:n.id||qQ("webgl-device")});B(this,"type","webgl");B(this,"handle");B(this,"features");B(this,"limits");B(this,"info");B(this,"canvasContext");B(this,"lost");B(this,"_resolveContextLost");B(this,"gl");B(this,"debug",!1);B(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});B(this,"_extensions",{});B(this,"_polyfilled",!1);B(this,"spectorJS");B(this,"renderPass",null);B(this,"_constants");const r=ss._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(_=(m=r.canvas)==null?void 0:m.gl)==null?void 0:_.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new IQ(this,r),this.lost=new Promise(y=>{this._resolveContextLost=y});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const l=this.props._handle||dQ(this.canvasContext.canvas,{onContextLost:y=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:y=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(n._reuseDevices)return xe.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=DQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=hQ(this.gl,this._extensions),this.limits=new NQ(this.gl),this.features=new CQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new $s(this.gl,{log:(...y)=>xe.log(1,...y)()}).trackState(this.gl,{copyState:!1});const d=n.debugWebGL||n.debug,h=n.debugWebGL;d&&(this.gl=BQ(this.gl,{debugWebGL:d,traceWebGL:h}),xe.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(xe.level=Math.max(xe.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new lc(this,r)}createTexture(n){return new cc(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new q0(this,n)}createShader(n){return new XQ(this,n)}createFramebuffer(n){return new oc(this,n)}createVertexArray(n){return new u2(this,n)}createTransformFeedback(n){return new FJ(this,n)}createQuerySet(n){return new zJ(this,n)}createRenderPipeline(n){return new NJ(this,n)}beginRenderPass(n){return new dJ(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new jJ(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return oJ(n,r)}readPixelsToBufferWebGL(n,r){return lJ(n,r)}setParametersWebGL(n){Lo(this.gl,n)}getParametersWebGL(n){return MD(this.gl,n)}withParametersWebGL(n,r){return pd(this.gl,n,r)}resetWebGL(){xe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),oQ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return SQ(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){$s.get(this.gl).push()}popState(){$s.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&HJ(s,r)&&xe.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:$J(this,n,r);break;case Int32Array:qJ(this,n,r);break;case Uint32Array:VJ(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return Ao(this.gl,n,this._extensions),this._extensions}}function $J(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function qJ(t,e,n){t.gl.vertexAttribI4iv(e,n)}function VJ(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function HJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const WJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},XJ=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),YJ=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),GJ=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function KJ(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&ZJ(i),i}return this.originalGetContext(n,r)}}function ZJ(t){t.getExtension("EXT_color_buffer_float");const e={...WJ,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:XJ(t),OES_vertex_array_object:YJ(t),ANGLE_instanced_arrays:GJ(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const vf=1;class QJ extends AW{constructor(){super();B(this,"type","webgl");ss.defaultProps={...ss.defaultProps,...c2},co.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){KJ(n)}async attach(n){if(n instanceof co)return n;if((n==null?void 0:n.device)instanceof ss)return n.device;if(!JJ(n))throw new Error("Invalid WebGL2RenderingContext");return new co({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){xe.groupCollapsed(vf,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(LQ()),n.debugSpectorJS&&r.push(PQ(n));const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&xe.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new co(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return xe.probe(vf,o)(),xe.table(vf,s.info)(),xe.groupEnd(vf)(),s}}function JJ(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const e4=new QJ;function Yi(){}const eee=({isDragging:t})=>t?"grabbing":"grab",VD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Yi,onWebGLInitialized:Yi,onResize:Yi,onViewStateChange:Yi,onInteractionStateChange:Yi,onBeforeRender:Yi,onAfterRender:Yi,onLoad:Yi,onError:t=>yt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:eee,getTooltip:null,debug:!1,drawPickingColors:!1};class f2{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new oh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=I0[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,d=u&&(u[i]||u.props[i]),h=this.props[i];let m=!1;d&&(m=d.call(u,l,r)),m||(h==null||h(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...VD,...e},e=this.props,e.viewState&&e.initialViewState&&yt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&yt.error("WebGL1 context not supported.")(),n=e4.attach(e.gl)),n||(n=g0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[e4],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Ec.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,l,u,d,h;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&yt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&yt.removed("onLayerClick","onClick")(),e.initialViewState&&!Cr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Tn(this.viewManager),this.viewManager.views}getViewports(e){return Tn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Tn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Tn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new sZ({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new CD({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=l,d=!1;for(const h of o)u=h,d=((r=h.layer)==null?void 0:r.onHover(h,e.event))||d;d||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new vD;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new PG(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(xM).map(o=>{var y;const[l,u,d,h]=xM[o],m=(y=this.props.eventRecognizerOptions)==null?void 0:y[o],_={...u,...m,event:o};return{recognizer:new l(_),recognizeWith:d,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in I0)this.eventManager.on(o,this._onEvent);this.viewManager=new NZ({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new CZ(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new qZ({deck:this,device:this.device}),this.deckRenderer=new WZ(this.device),this.deckPicker=new QZ(this.device),this.widgetManager=new tQ({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new rQ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),yt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=g0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}f2.defaultProps=VD;f2.VERSION=MH;function tee(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return TP(t)}}const nee=wP;function yf(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function js(t){return t.stride||t.size*t.bytesPerElement}function ree(t,e){return t.type===e.type&&t.size===e.size&&js(t)===js(e)&&(t.offset||0)===(e.offset||0)}function V0(t,e){e.offset&&yt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=js(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function iee(t,e){const n=V0(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class see{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&n.isIndexed?l="uint32":l=i||"float32";let u=tee(i||l);this.doublePrecision=s,s&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*js(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ec.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=V0(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:js(r),attributes:i};if(this.doublePrecision){const o=iee(r,n||{});i.push(yf(e,{...r,...o.high},this.device.type),yf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=V0(r,n);i.push(yf(e,{...r,...o},this.device.type))}else i.push(yf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const h=n[u++];h<o[d]&&(o[d]=h),h>l[d]&&(l[d]=h)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Tt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=nee(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=js(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const l=js(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=Nb(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const d=s.byteLength+u+l*2;(!o||o.byteLength<d)&&(o=this._createBuffer(d)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Nb(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Ec.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),n&&i&&l.write(i instanceof Float64Array?Nb(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&yt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?Tt.INDEX:Tt.VERTEX)|Tt.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const t4=[],n4=[];function aee(t,e=0,n=1/0){let r=t4;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(n4.length=t.length,r=n4):r=t4,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function HD(t){return t&&t[Symbol.asyncIterator]}function oee(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,l=t.BYTES_PER_ELEMENT,u=r?r/l:n,d=i?i/l:0,h=Math.floor((t.length-d)/u);return(m,{index:_,target:y})=>{if(!s){const S=_*u+d;for(let A=0;A<n;A++)y[A]=t[S+A];return y}const T=s[_],w=s[_+1]||h;let b;if(o){b=new Array(w-T);for(let S=T;S<w;S++){const A=S*u+d;y=new Array(n);for(let R=0;R<n;R++)y[R]=t[A+R];b[S-T]=y}}else if(u===n)b=t.subarray(T*n+d,w*n+d);else{b=new t.constructor((w-T)*n);let S=0;for(let A=T;A<w;A++){const R=A*u+d;for(let E=0;E<n;E++)b[S++]=t[R+E]}}return b}}const lee=[],Of=[[0,1/0]];function cee(t,e){if(t===Of||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const uee={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function WD(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...uee[n],...e,...t,type:n}}class XD extends see{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Of}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!ree(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return WD(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=cee(this.state.updateRanges,[r,i])}else this.state.updateRanges=Of}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=lee}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Of),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[d,h]of s)o.call(i,this,{data:n,startRow:d,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,h]of s){const m=Number.isFinite(d)?this.getVertexOffset(d):0,_=Number.isFinite(h)?this.getVertexOffset(h):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Tn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=oee(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:d,size:h,startIndices:m}=e,{accessor:_,transform:y}=l;let T=u.binaryAccessor||(typeof _=="function"?_:s[_]);typeof T!="function"&&(T=()=>T),Tn(typeof T=="function",`accessor "${_}" is not a function`);let w=e.getVertexOffset(r);const{iterable:b,objectInfo:S}=aee(n,r,i);for(const A of b){S.index++;let R=T(A,S);if(y&&(R=y.call(this,R)),m){const E=(S.index<m.length-1?m[S.index+1]:o)-m[S.index];if(R&&Array.isArray(R[0])){let C=w;for(const O of R)e._normalizeValue(O,d,C),C+=h}else R&&R.length>h?d.set(R,w):(e._normalizeValue(R,S.target,0),TZ({target:d,source:S.target,start:w,count:E}));w+=E*h}else e._normalizeValue(R,d,w),w+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Bb(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,l=e.length,u=o-r;if(l>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!s)return;let d=l;for(;d<u;){const h=s(d,e);for(let m=0;m<i;m++)n[r+d]=h[m]||0,d++}}function fee({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Bb({source:t,target:e,size:n,getData:r}),e;let o=0,l=0;const u=r&&((h,m)=>r(h+l,m)),d=Math.min(i.length,s.length);for(let h=1;h<d;h++){const m=i[h]*n,_=s[h]*n;Bb({source:t.subarray(o,m),target:e,start:l,end:_,size:n,getData:u}),o=m,l=_}return l<e.length&&Bb({source:[],target:e,start:l,size:n,getData:u}),e}function dee(t){const{device:e,settings:n,value:r}=t,i=new XD(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function YD(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function GD(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function KD(t){t.push(t.shift())}function hee(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=t.settings;if(u)for(const d of Object.values(u))l=Math.max(l,d.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function ZD({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function QD({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*l,d=n.byteOffset,h=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,m=n.startIndices,_=s&&m,y=n.isConstant;if(!_&&e&&r>=i)return e;const T=n.value instanceof Float64Array?Float32Array:n.value.constructor,w=y?n.value:new T(n.getBuffer().readSyncWebGL(d,i*T.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!y){const R=o;o=(E,C)=>n.normalizeConstant(R(E,C))}const b=y?(R,E)=>o(w,E):(R,E)=>o(w.subarray(R+d,R+d+u),E),S=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),A=new Float32Array(i);return fee({source:S,target:A,sourceStartIndices:s,targetStartIndices:m,size:u,getData:b}),(!e||e.byteLength<A.byteLength+h)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:A.byteLength+h,usage:35050})),e.write(A,h),e}class JD{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new hh(r),this.attribute=n,this.attributeInTransition=dee(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=hee(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class pee extends JD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=vee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;KD(s),s[0]=QD({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=ZD({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let d=Math.floor(this.currentLength/o.size);ej(o)&&(d/=2),u.setVertexCount(d),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const gee=`uniform interpolationUniforms {
  float time;
} interpolation;
`,r4={name:"interpolation",vs:gee,uniformTypes:{time:"f32"}},mee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,_ee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function ej(t){return t.doublePrecision&&t.value instanceof Float64Array}function vee(t,e){const n=e.size,r=YD(n),i=GD(n),s=e.getBufferLayout();return ej(e)?new Ac(t,{vs:_ee,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[IY,r4],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ac(t,{vs:mee,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[r4],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class yee extends JD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=Eee(e),this.framebuffer=Aee(e,this.texture),this.transform=See(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=QD({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=ZD({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),KD(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const xee=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,bee={name:"spring",vs:xee,uniformTypes:{damping:"f32",stiffness:"f32"}},wee=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Tee=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function See(t,e){const n=YD(e.size),r=GD(e.size);return new Ac(t,{vs:wee,fs:Tee,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[bee],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Eee(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Aee(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const Ree={interpolation:pee,spring:yee};class Cee{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=Ree[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(yt.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const i4="attributeManager.invalidate",Nee="attributeManager.updateStart",kee="attributeManager.updateEnd",Mee="attribute.updateStart",Iee="attribute.allocate",Oee="attribute.updateEnd";class Pee{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Fc(WK),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new Cee(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);An(i4,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);An(i4,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;An(Nee,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const h=this.attributes[d],m=h.settings.accessor;h.startIndices=r,h.numInstances=n,s[d]&&yt.removed(`props.${d}`,`data.attributes.${d}`)(),h.setExternalBuffer(o[d])||h.setBinaryValue(typeof m=="string"?o[m]:void 0,e.startIndices)||typeof m=="string"&&!o[m]&&h.setConstantValue(s[m])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:n,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&An(kee,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new XD(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(An(Mee,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&An(Iee,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,An(Oee,n,r))}}class Dee extends hh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=od(n,r,o)}}const s4=1e-5;function a4(t,e,n,r,i){const s=e-t,l=(n-e)*i,u=-s*r;return l+u+s+e}function jee(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=a4(t[o],e[o],n[o],r,i);return s}return a4(t,e,n,r,i)}function o4(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class Lee extends hh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=jee(s,o,n,r,i);const u=o4(l,n),d=o4(l,o);u<s4&&d<s4&&(l=n,this.end()),this._prevValue=o,this._currValue=l}}const Bee={interpolation:Dee,spring:Lee};class Uee{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;n=d,this.remove(e)}if(i=WD(i),!i)return;const o=Bee[i.type];if(!o){yt.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:n,toValue:r}),s.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Fee(t){const e=t[zs];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function zee(t,e){const n=tj({newProps:t,oldProps:e,propTypes:t[zs],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=qee(t,e);let i=!1;return r||(i=Vee(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:Hee(t,e),transitionsChanged:$ee(t,e)}}function $ee(t,e){if(!t.transitions)return!1;const n={},r=t[zs];let i=!1;for(const s in t.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&H0(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function tj({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=H0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=H0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function H0(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function qee(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function Vee(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&l4(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&l4(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function Hee(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function l4(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},tj({oldProps:i,newProps:r,triggerName:n})}const Wee="count(): argument not an object",Xee="count(): argument not a container";function Yee(t){if(!Kee(t))throw new Error(Wee);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Gee(t))return Object.keys(t).length;throw new Error(Xee)}function Gee(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Kee(t){return t!==null&&typeof t=="object"}function c4(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const Zee={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},W0={};function Qee(t,e,n,r){if(n instanceof jt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...Zee,...i,...r},mipmaps:!0});return W0[s.id]=t,s}function Jee(t,e){!e||!(e instanceof jt)||W0[e.id]===t&&(e.delete(),delete W0[e.id])}const ete={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||X0(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Cr(t,e,1)}},accessor:{validate(t,e){const n=gd(t);return n==="function"||n===gd(e.value)},equal(t,e,n){return typeof e=="function"?!0:Cr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||X0(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Cr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Cr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:Qee(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{Jee(n.id,t)}}};function tte(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=nte(i,s);e[i]=l,n[i]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function nte(t,e){switch(gd(e)){case"object":return $l(t,e);case"array":return $l(t,{type:"array",value:e,compare:!1});case"boolean":return $l(t,{type:"boolean",value:e});case"number":return $l(t,{type:"number",value:e});case"function":return $l(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function $l(t,e){return"type"in e?{name:t,...ete[e.type],...e}:"value"in e?{name:t,type:gd(e.value),...e}:{name:t,type:"object",value:e}}function X0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function gd(t){return X0(t)?"array":t===null?"null":typeof t}function rte(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=Y0(t.constructor,n),i=Object.create(r);i[hd]=t,i[Ys]={},i[is]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const ite="_mergedDefaultProps";function Y0(t,e){if(!(t instanceof ph.constructor))return{};let n=ite;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=nj(t,n);return r||(t[n]=ste(t,e||[]))}function ste(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=Y0(r),s=nj(t,"defaultProps")||{},o=tte(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[zs],o.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[Ob],o.deprecatedProps);for(const h of e){const m=Y0(h.constructor);m&&(Object.assign(l,m),Object.assign(u,m[zs]),Object.assign(d,m[Ob]))}return ate(l,t),lte(l,u),ote(l,d),l[zs]=u,l[Ob]=d,e.length===0&&!d2(t,"_propTypes")&&(t._propTypes=u),l}function ate(t,e){const n=ute(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function ote(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])d2(this,s)||(this[s]=r);yt.deprecated(i,e[n].join("/"))()}})}function lte(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(n[o]=l,r[o]=cte(o))}t[po]=n,t[Ys]={},Object.defineProperties(t,r)}function cte(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||HD(e)?this[Ys][t]=e:this[is][t]=e},get(){if(this[is]){if(t in this[is])return this[is][t]||this[po][t];if(t in this[Ys]){const e=this[hd]&&this[hd].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[po][t]}}return this[po][t]}}}function d2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function nj(t,e){return d2(t,e)&&t[e]}function ute(t){const e=t.componentName;return e||yt.warn(`${t.name}.componentName not specified`)(),e||t.name}let fte=0;class ph{constructor(...e){this.props=rte(this,e),this.id=this.props.id,this.count=fte++}clone(e){const{props:n}=this,r={};for(const i in n[po])i in n[is]?r[i]=n[is][i]:i in n[Ys]&&(r[i]=n[Ys][i]);return new this.constructor({...n,...r,...e})}}ph.componentName="Component";ph.defaultProps={};const dte=Object.freeze({});class hte{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||dte}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[hd]||this.component;const n=e[is]||{},r=e[Ys]||e,i=e[po]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(HD(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[zs];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class pte extends hte{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const gte="layer.changeFlag",mte="layer.initialize",_te="layer.update",vte="layer.finalize",yte="layer.matched",u4=2**24-1,xte=Object.freeze([]),bte=Fc(({oldViewport:t,viewport:e})=>t.equals(e));let Tr=new Uint8ClampedArray(0);const wte={data:{type:"data",value:xte,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:l0(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:u=>{var d;return(d=n.internalState)==null?void 0:d.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):l0(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:nt.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class zc extends ph{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ro.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Tn(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=_D(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=dD(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Tn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Tn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return QK(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===nt.DEFAULT||e===nt.LNGLAT||e===nt.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Tn(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Yee(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=c4(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=c4(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=n.attributes,d=l||u;d&&(o&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!o&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!bte({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Tr.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>u4&&yt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Tr=Ec.allocate(Tr,n,{size:4,copy:!0,maxCount:Math.max(n,u4)});const i=Math.floor(Tr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Tr[o*4+0]=s[0],Tr[o*4+1]=s[1],Tr[o*4+2]=s[2],Tr[o*4+3]=0}e.value=Tr.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var l;if(!Object.keys(n).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),n=u.getAttributes()}const i=((l=e.userData)==null?void 0:l.excludeAttributes)||{},s={},o={};for(const u in n){if(i[u])continue;const d=n[u].getValue();for(const h in d){const m=d[h];m instanceof Tt?n[u].settings.isIndexed?e.setIndexBuffer(m):s[h]=m:m&&(o[h]=m)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const h=s.getVertexOffset(d);l[h]===u[0]&&l[h+1]===u[1]&&l[h+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Tr.buffer&&(r.value=Tr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Tn(!this.internalState),Tn(Number.isFinite(this.props.coordinateSystem)),An(mte,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new pte({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(yt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Uee(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){An(yte,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(An(_te,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const h of this.props.extensions)h.updateState.call(this,l,h);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(l,d)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){An(vte,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof co&&o.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(o.device instanceof co)o.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=n[i];o&&Array.isArray(l)&&(n.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&An(gte,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=zee(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){Fee(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Pee(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(n||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}zc.defaultProps=wte;zc.layerName="Layer";const Ub=Math.PI/180;function Tte({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],l=n==="Z"?[0,-e,0]:[0,0,e],u=new kr().lookAt({eye:l,up:o});u.rotateX(r*Ub),n==="Z"?u.rotateZ(i*Ub):u.rotateY(i*Ub);const d=Math.pow(2,s)/t;return u.scale(d),u}class Ste extends jo{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:l=0,rotationOrbit:u=0,zoom:d=0}=e,h=r?r[5]/2:r2(i);super({...e,longitude:void 0,viewMatrix:Tte({height:n||1,focalDistance:h,orbitAxis:s,rotationX:l,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:h,position:o,zoom:d}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[l,u,d]=fh([r,o,s],this.pixelUnprojectionMatrix);return[l,u,d]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class Ete extends RD{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:l=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:h=-1/0,maxZoom:m=1/0,startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:b,startZoom:S}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:l,minRotationX:u,maxRotationX:d,minZoom:h,maxZoom:m},{startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:b,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:l,height:u}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let d;if(e){let h=(e[0]-i[0])/l;const m=(e[1]-i[1])/u;(s<-90||s>90)&&(h*=-1),d={rotationX:s+m*180,rotationOrbit:o+h*180}}else d={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return Kn(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:l}=e;return e.zoom=Array.isArray(i)?[Kn(i[0],r,n),Kn(i[1],r,n)]:Kn(i,r,n),e.rotationX=Kn(e.rotationX,o,s),(l<-180||l>180)&&(e.rotationOrbit=$K(l+180,360)-180),e}}class Ate extends AD{constructor(){super(...arguments),this.ControllerState=Ete,this.transition={transitionDuration:300,transitionInterpolator:new s2({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class h2 extends Gs{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return Ste}get ControllerType(){return Ate}}h2.displayName="OrbitView";const Rte=typeof window<"u"?j.useLayoutEffect:j.useEffect;function md(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const Cte={position:"absolute",zIndex:-1};function rj(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>rj(n,e));if(gh(t)){if(Nte(t))return e.style=Cte,j.cloneElement(t,e);if(kte(t))return j.cloneElement(t,e)}return t}function gh(t){return t&&typeof t=="object"&&"type"in t||!1}function Nte(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function kte(t){const e=t.type;return e&&e.deckGLViewProps}function G0(t){if(typeof t=="function")return j.createElement(Gs,{},t);if(Array.isArray(t))return t.map(G0);if(gh(t)){if(t.type===j.Fragment)return G0(t.props.children);if(md(t.type,Gs))return t}return t}function Mte({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return j.Children.forEach(G0(t),o=>{if(gh(o)){const l=o.type;if(md(l,zc)){const u=Ite(l,o.props);i.push(u)}else r.push(o);if(md(l,Gs)&&l!==Gs&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function Ite(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const Ote=j.createContext();function Pte({children:t,deck:e,ContextProvider:n=Ote.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let l=s,u=o;gh(o)&&md(o.type,Gs)&&(l=o.props.id||s,u=o.props.children);const d=r.getViewport(l),h=r.getViewState(l);if(d){h.padding=d.padding;const{x:m,y:_,width:y,height:T}=d;u=rj(u,{x:m,y:_,width:y,height:T,viewport:d,viewState:h}),i[l]||(i[l]={viewport:d,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:d,y:h,width:m,height:_}=l,y={position:"absolute",left:d,top:h,width:m,height:_},T=`view-${o}`,w=j.createElement("div",{key:T,id:T,style:y},...u),b={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:A=>{A.viewId=o,e._onViewStateChange(A)},widgets:[]},S=`view-${o}-context`;return j.createElement(n,{key:S,value:b},w)})}const Dte={mixBlendMode:null};function jte({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in Dte?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function Lte(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function ij(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Bte(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:l=>{t.redrawReason=l;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():ij(t)}});return r}function Ute(t,e){const[n,r]=j.useState(0),s=j.useRef({control:null,version:n,forceUpdate:()=>r(C=>C+1)}).current,o=j.useRef(null),l=j.useRef(null),u=j.useMemo(()=>Mte(t),[t.layers,t.views,t.children]);let d=!0;const h=C=>{var O;return d&&t.viewState?(s.viewStateUpdateRequested=C,null):(s.viewStateUpdateRequested=null,(O=t.onViewStateChange)==null?void 0:O.call(t,C))},m=C=>{var O;d?s.interactionStateUpdateRequested=C:(s.interactionStateUpdateRequested=null,(O=t.onInteractionStateChange)==null||O.call(t,C))},_=j.useMemo(()=>{const C={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:m};return delete C._customRender,s.deck&&s.deck.setProps(C),C},[t]);j.useEffect(()=>{const C=t.Deck||f2;return s.deck=Bte(s,C,{..._,parent:o.current,canvas:l.current}),()=>{var O;return(O=s.deck)==null?void 0:O.finalize()}},[]),Rte(()=>{ij(s);const{viewStateUpdateRequested:C,interactionStateUpdateRequested:O}=s;C&&h(C),O&&m(O)}),j.useImperativeHandle(e,()=>Lte(s),[]);const y=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:w="100%",height:b="100%",id:S,style:A}=t,{containerStyle:R,canvasStyle:E}=j.useMemo(()=>jte({width:w,height:b,style:A}),[w,b,A]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===y||s.version!==n){s.lastRenderedViewports=y,s.version=n;const C=Pte({children:u.children,deck:s.deck,ContextProvider:T}),O=j.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:l,style:E});s.control=j.createElement("div",{id:`${S||"deckgl"}-wrapper`,ref:o,style:R},[O,C])}return d=!1,s.control}const sj=j.forwardRef(Ute),Fte=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,f4=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,zte={name:"line",source:Fte,vs:f4,fs:f4,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},$te=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90°: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,qte=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Vte=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Hte=[0,0,0,255],Wte={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Hte},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class os extends zc{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:qte,fs:Vte,source:$te,modules:[cD,pD,zte]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,u={widthUnits:Xs[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:u}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...u,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Eo(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new wD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}os.layerName="LineLayer";os.defaultProps=Wte;const d4=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Xte={name:"scatterplot",vs:d4,fs:d4,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Yte=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Gte=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Kte=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,h4=[0,0,0,255],Zte={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:h4},getLineColor:{type:"accessor",value:h4},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class mh extends zc{getShaders(){return super.getShaders({vs:Yte,fs:Gte,source:Kte,modules:[cD,pD,Xte]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:d,lineWidthUnits:h,lineWidthScale:m,lineWidthMinPixels:_,lineWidthMaxPixels:y}=this.props,T={stroked:o,filled:l,billboard:u,antialiasing:d,radiusUnits:Xs[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Xs[h],lineWidthScale:m,lineWidthMinPixels:_,lineWidthMaxPixels:y},w=this.state.model;w.shaderInputs.setProps({scatterplot:T}),w.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Eo(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new wD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}mh.defaultProps=Zte;mh.layerName="ScatterplotLayer";function _h(t,e,n=160,r=[100,100,100,255],i=2){const s=[];if(!t||!t.coordinates)return s;const o=t.bounds||aj(t),[l,u,d,h]=o,m=(l+d)/2,_=(u+h)/2,y=Math.max(d-l,h-u)||1,T=(b,S)=>{const A=(b-m)/y*n,R=(S-_)/y*n;return[A,R]},w=b=>{for(let S=0;S<b.length-1;S++){const[A,R]=T(b[S][0],b[S][1]),[E,C]=T(b[S+1][0],b[S+1][1]);s.push({source:[A,R,e],target:[E,C,e],color:r,width:i})}};switch(t.type){case"Polygon":const b=t.coordinates;if(b.length>0){w(b[0]);for(let R=1;R<b.length;R++)w(b[R])}break;case"MultiPolygon":const S=t.coordinates;for(const R of S)if(R.length>0){w(R[0]);for(let E=1;E<R.length;E++)w(R[E])}break;case"LineString":Array.isArray(t.coordinates)&&t.coordinates.length>0&&Array.isArray(t.coordinates[0])&&typeof t.coordinates[0][0]=="number"&&w(t.coordinates);break;case"MultiLineString":const A=t.coordinates;for(const R of A)w(R);break;case"GeometryCollection":if("geometries"in t){const R=t.geometries;for(const E of R)E.type==="LineString"&&E.coordinates&&w(E.coordinates)}break;default:console.warn(`Unsupported geometry type: ${t.type}`)}return s}function aj(t){let e=1/0,n=1/0,r=-1/0,i=-1/0;const s=o=>{if(typeof o[0]=="number"){const[l,u]=o;e=Math.min(e,l),n=Math.min(n,u),r=Math.max(r,l),i=Math.max(i,u)}else for(const l of o)s(l)};if(t.coordinates&&s(t.coordinates),"geometries"in t){const o=t.geometries;for(const l of o)l.coordinates&&s(l.coordinates)}return[e,n,r,i]}function oj(t,e,n=12,r=160,i=[100,100,100],s,o){const l=[];if(!s||!t)return l;const u=o??.1,d=120,h=2,m=[i[0],i[1],i[2],d],_=_h(t,u,r,m,h);return l.push(..._),l}function Ks(t=10){const e=[];for(let n=0;n<=t;n++)e.push([[0,n],[t,n]]);for(let n=0;n<=t;n++)e.push([[n,0],[n,t]]);return{type:"GeometryCollection",name:"Unit Grid",bounds:[0,0,t,t],coordinates:e.flat(),geometries:e.map(n=>({type:"LineString",coordinates:n}))}}const p4=Object.freeze(Object.defineProperty({__proto__:null,calculateShapeBounds:aj,convertShapeToLines3D:_h,createGeographicTemporalPlanes:oj,createUnitGridShape:Ks},Symbol.toStringTag,{value:"Module"}));function Qte(t,e,n){if(!t.location||!e.location||t.location.x!==e.location.x||t.location.y!==e.location.y)return!1;const r=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===t.id||d===t.id}),i=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===e.id||d===e.id});if(r.length!==i.length)return!1;const s=new Set,o=new Set;if(r.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==t.id&&s.add(u),d!==t.id&&s.add(d)}),i.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==e.id&&o.add(u),d!==e.id&&o.add(d)}),s.size!==o.size)return!1;for(const l of s)if(!o.has(l))return!1;return!0}function lj(t,e){const n=new Set,r=[],i=[],s=new Map;for(let l=0;l<t.length;l++){if(n.has(t[l].id))continue;const u=t[l],d=[u];if(u.is_sample){r.push(u),s.set(u.id,u.id),n.add(u.id);continue}for(let h=l+1;h<t.length;h++){const m=t[h];n.has(m.id)||m.is_sample||u.time===m.time&&u.is_sample===m.is_sample&&Qte(u,m,e)&&(d.push(m),n.add(m.id))}if(d.length>1){const h={...u,id:u.id,is_combined:!0,combined_nodes:d.map(m=>m.id)};r.push(h),d.forEach(m=>s.set(m.id,h.id))}else r.push(u),s.set(u.id,u.id);n.add(u.id)}const o=new Set;return e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id,h=s.get(u),m=s.get(d);if(h!==void 0&&m!==void 0&&h!==m){const _=`${Math.min(h,m)}-${Math.max(h,m)}`;o.has(_)||(o.add(_),i.push({...l,source:h,target:m}))}}),{nodes:r,edges:i}}const Gr=(t,e,n)=>{const r=n.some(s=>(typeof s.target=="number"?s.target:s.target.id)===t.id),i=n.some(s=>(typeof s.source=="number"?s.source:s.source.id)===t.id);return!r&&i},Jte=(t,e,n)=>n?`Lat: ${e.toFixed(3)}°, Lon: ${t.toFixed(3)}°`:`(${t.toFixed(2)}, ${e.toFixed(2)})`,_t={AUTO_FIT_ZOOM:1.8,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,BASE_ELEVATION:.1,SELECTED_NODE_SCALE:1.5,TEMPORAL_FADE_OPACITY:.5,EDGE_FADE_OPACITY:.2,EDGE_PARTIAL_FADE_OPACITY:.5,REDUCED_OPACITY_MULTIPLIER:.3,GEOGRAPHIC_OPACITY_SCALE:2.5,GEOGRAPHIC_REDUCED_OPACITY:.3,TEMPORAL_OPACITY_SCALE:.3,GRID_EXTENSION:2,UNIT_GRID_SIZE:10},tc={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},Ji={GEOGRAPHIC_ACTIVE:.5,GEOGRAPHIC_NORMAL:3,TIME_SLICE_ACTIVE:.5,TIME_SLICE_NORMAL:1.5,NODE_OUTLINE_SELECTED:2,NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4},ene=t=>t*_t.JITTER_SCALE%_t.JITTER_RANGE-_t.JITTER_OFFSET,tne=(t,e,n)=>t.is_sample?tc.SAMPLE:t.is_combined?tc.COMBINED:Gr(t,e,n)?tc.ROOT:tc.DEFAULT,nne=(t,e,n,r)=>{if(n!=="planes"||!e)return r;const[i,s]=e;return t>=i&&t<=s?r:r*_t.TEMPORAL_FADE_OPACITY},rne=(t,e,n,r,i)=>{if(r!=="planes"||!n)return i;const[s,o]=n,l=t.time>=s&&t.time<=o,u=e.time>=s&&e.time<=o;return!l&&!u?i*_t.EDGE_FADE_OPACITY:!l||!u?i*_t.EDGE_PARTIAL_FADE_OPACITY:i},g4=(t,e,n)=>t||(e==="unit_grid"?Ks(_t.UNIT_GRID_SIZE):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):Ks(_t.UNIT_GRID_SIZE)),ine=(t,e,n)=>{const{nodes:r}=lj(t,[]),i=r.filter(w=>{var b,S;return((b=w.location)==null?void 0:b.x)!==void 0&&((S=w.location)==null?void 0:S.y)!==void 0});if(i.length===0)return null;const s=i.map(w=>w.location.x),o=i.map(w=>w.location.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let m,_,y;if((e==="eastern_hemisphere"||e==="custom")&&(n==null?void 0:n.bounds)){const w=n.bounds,[b,S,A,R]=w;m=(b+A)/2,_=(S+R)/2,y=Math.max(A-b,R-S)||1}else m=(l+u)/2,_=(d+h)/2,y=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:m,centerY:_,maxScale:y,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}},sne=t=>{const e=Array.from(new Set(t.map(n=>n.time))).sort((n,r)=>n-r);return new Map(e.map((n,r)=>[n,r]))};function cj(t,e,n,r){if(e.length<=1)return 0;switch(r){case"equal":return e.indexOf(t)*n;case"log":const s=Math.max(1e-4,e[0]),o=e[e.length-1],l=Math.log(s),u=Math.log(o);return(Math.log(Math.max(1e-4,t))-l)/(u-l)*(e.length-1)*n;case"linear":const m=e[0],_=e[e.length-1];return(t-m)/(_-m)*(e.length-1)*n}}const ane=(t,e,n,r,i,s,o,l,u)=>{const{centerX:d,centerY:h,maxScale:m}=e,_=sne(t);return t.map(y=>{const T=(y.location.x-d)/m*r,w=(y.location.y-h)/m*r;_.get(y.time);const b=ene(y.id),S=cj(y.time,l,n,u)+_t.BASE_ELEVATION+b,A=tne(y,s,o);let R;return y.is_sample?R=i.nodeSample:y.is_combined?R=i.nodeCombined:Gr(y,s,o)?R=i.nodeRoot:R=i.nodeDefault,{...y,position:[T,w,S],color:R,size:A}})},one=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=rne(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),lne=(t,e,n,r,i)=>{if(e&&t.id===e.id)return i.nodeSelected;const o=nne(t.time,n,r,t.color[3]);return[t.color[0],t.color[1],t.color[2],o]},cne=(t,e,n,r,i,s)=>{const o=e&&t.id===e.id,l=Gr(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]);let u=1;if(i==="planes"&&r){const[d,h]=r;t.time>=d&&t.time<=h||(u=_t.REDUCED_OPACITY_MULTIPLIER)}if(o)return s.nodeSelected;if(l)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*u];if(t.is_sample){const d=s.background==="#ffffff"?0:255;return[d,d,d,255*u]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},une=(t,e,n)=>{const r=e&&t.id===e.id,i=Gr(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]),o=(r?t.size*_t.SELECTED_NODE_SCALE:t.size)/tc.DEFAULT;return r?Math.max(1,Ji.NODE_OUTLINE_SELECTED*o):i?Math.max(.8,Ji.NODE_OUTLINE_ROOT*o):t.is_sample?Math.max(.5,Ji.NODE_OUTLINE_SAMPLE*o):0},fne=(t,e,n,r)=>{var s;let i="";return t.is_sample?i="Sample Node":t.is_combined?i=`Combined Node (contains: ${(s=t.combined_nodes)==null?void 0:s.join(", ")})`:Gr(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?i="Root Node":i="Internal Node",{html:`
      <div style="background: ${r.tooltipBackground}; color: ${r.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${i}<br/>
        ${t.location?`Location: ${Jte(t.location.x,t.location.y,n==="eastern_hemisphere")}`:""}
      </div>
    `,style:{backgroundColor:"transparent",color:r.tooltipText}}},uj=hc.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,selectedNode:s,temporalRange:o,showTemporalPlanes:l=!1,temporalFilterMode:u=null,temporalSpacing:d=12,spatialSpacing:h=160,geographicShape:m=null,geographicMode:_="unit_grid",temporalGridOpacity:y=30,geographicShapeOpacity:T=70,maxNodeRadius:w=25,onViewStateChange:b,externalViewState:S,temporalSpacingMode:A="equal"},R)=>{const E=j.useRef(null),{colors:C}=St(),[O,P]=j.useState({target:[0,0,0],zoom:_t.AUTO_FIT_ZOOM,minZoom:_t.MIN_ZOOM,maxZoom:_t.MAX_ZOOM,rotationX:30,rotationOrbit:0,orbitAxis:"Y"});hc.useEffect(()=>{S&&P(q=>({...q,...S}))},[S]);const k=j.useMemo(()=>!t||!t.nodes.length?null:ine(t.nodes,_,m),[t,_,m==null?void 0:m.bounds]),{nodes3D:I,edges3D:N,bounds:L}=j.useMemo(()=>{if(!k)return{nodes3D:[],edges3D:[],bounds:null};const{nodes:q,edges:z}=lj(t.nodes,t.edges),Q=Array.from(new Set(q.map(le=>le.time))).sort((le,ie)=>le-ie),oe=ane(k.spatialNodes,k,d,h,C,q,z,Q,A),G=new Map;oe.forEach(le=>G.set(le.id,le));const D=one(z,G,o||null,u||null,C),Y={minX:Math.min(...oe.map(le=>le.position[0])),maxX:Math.max(...oe.map(le=>le.position[0])),minY:Math.min(...oe.map(le=>le.position[1])),maxY:Math.max(...oe.map(le=>le.position[1])),minZ:Math.min(...oe.map(le=>le.position[2])),maxZ:Math.max(...oe.map(le=>le.position[2]))};return{nodes3D:oe,edges3D:D,bounds:Y}},[k,d,h,A,u,o,C]),$=j.useMemo(()=>{if(!l||!o||!L)return[];const q=g4(m,_);if(!q)return[];const z=Array.from(new Set(I.map(D=>D.time))).sort((D,Y)=>D-Y),Q=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2]],oe=(o[0]+o[1])/2,G=cj(oe,z,d,A);return oj(q,z,d,h,Q,o,G)},[l,o,L,I,d,A,h,C.textSecondary,m,_]),Z=j.useMemo(()=>{if(!L||!I.length)return[];const q=g4(m,_);if(!q)return[];const z=l&&u==="planes",Q=T??70,oe=Q>0?z?Math.max(Q*_t.GEOGRAPHIC_REDUCED_OPACITY,8):Q*_t.GEOGRAPHIC_OPACITY_SCALE:0,G=z?Ji.GEOGRAPHIC_ACTIVE:Ji.GEOGRAPHIC_NORMAL,D=[C.geographicGrid[0],C.geographicGrid[1],C.geographicGrid[2],oe],le=[...oe>0?_h(q,0,h,D,G):[]],ie=Array.from(new Set(I.map(Ae=>Ae.time))).sort((Ae,Oe)=>Ae-Oe),F=new Map(ie.map((Ae,Oe)=>[Ae,Oe])),X=y??30,J=z?Math.min(X*_t.TEMPORAL_OPACITY_SCALE,8):X,pe=z?Ji.TIME_SLICE_ACTIVE:Ji.TIME_SLICE_NORMAL,ye=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2],J];return J>0&&ie.forEach(Ae=>{const Ue=(F.get(Ae)||0)*d;Ue!==0&&(le.push({source:[L.minX-_t.GRID_EXTENSION,0,Ue],target:[L.maxX+_t.GRID_EXTENSION,0,Ue],color:ye,width:pe}),le.push({source:[0,L.minY-_t.GRID_EXTENSION,Ue],target:[0,L.maxY+_t.GRID_EXTENSION,Ue],color:ye,width:pe}))}),le},[L,C.textSecondary,I,d,h,m,_,l,u,y,T]),V=[...Z.length>0?[new os({id:"geographic-lines",data:Z,pickable:!1,getSourcePosition:q=>q.source,getTargetPosition:q=>q.target,getColor:q=>q.color,getWidth:q=>q.width||.5})]:[],...l&&$.length>0?[new os({id:"temporal-plane-lines",data:$,pickable:!1,getSourcePosition:q=>q.source,getTargetPosition:q=>q.target,getColor:q=>q.color,getWidth:q=>q.width})]:[],new os({id:"edges",data:N,pickable:!1,getSourcePosition:q=>q.source,getTargetPosition:q=>q.target,getColor:q=>q.color,getWidth:_t.EDGE_WIDTH}),new mh({id:"nodes",data:I,pickable:!0,opacity:_t.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:_t.NODE_RADIUS_SCALE,radiusMinPixels:_t.MIN_NODE_RADIUS,radiusMaxPixels:w,lineWidthMinPixels:_t.MIN_NODE_RADIUS,lineWidthMaxPixels:Ji.MAX_NODE_OUTLINE,getPosition:q=>q.position,getRadius:q=>s&&q.id===s.id?q.size*_t.SELECTED_NODE_SCALE:q.size,getFillColor:q=>lne(q,s||null,o||null,u||null,C),getLineColor:q=>cne(q,s||null,t,o||null,u||null,C),getLineWidth:q=>une(q,s||null,t),onClick:(q,z)=>{z.srcEvent.preventDefault(),q.object&&r&&r(q.object)},onHover:q=>{q.rightButton&&q.object&&i&&i(q.object)}})];return!t||I.length===0?g.jsx("div",{className:"flex items-center justify-center border rounded bg-sp-very-dark-blue text-sp-white border-sp-dark-blue",style:{width:e,height:n},children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-lg mb-2",children:"No spatial data available"}),g.jsx("p",{className:"text-sm text-sp-white/75",children:"This ARG does not contain 2D spatial information required for 3D visualization."})]})}):g.jsx("div",{style:{width:e,height:n},className:"relative bg-sp-very-dark-blue","data-3d-visualization":"true",ref:q=>{q&&typeof R=="function"?R(q):q&&R&&"current"in R&&(R.current=q),q&&(q.getExportData=()=>({nodes:I,edges:N,bounds:L,currentViewState:O}),q.setViewState=z=>{P(Q=>({...Q,...z}))})},onContextMenu:q=>{q.preventDefault();const z=q.currentTarget.getBoundingClientRect(),Q=q.clientX-z.left,oe=q.clientY-z.top;if(E.current){const G=E.current.pickObject({x:Q,y:oe,radius:10});G!=null&&G.object&&i&&i(G.object)}},children:g.jsx(sj,{ref:E,width:e,height:n,views:new h2,viewState:O,onViewStateChange:({viewState:q})=>{P(q),b==null||b(q)},controller:{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0},layers:V,getCursor:()=>"crosshair",style:{backgroundColor:C.background},getTooltip:({object:q})=>q?fne(q,t,_,C):null})})});uj.displayName="SpatialArg3DVisualization";const vh=({initialPosition:t={x:0,y:0},onPositionChange:e,dragHandleRef:n}={})=>{const[r,i]=j.useState({position:t,isDragging:!1,dragOffset:{x:0,y:0},hasMoved:!1,startTime:0}),s=j.useRef(null),o=j.useCallback(h=>{var T;if(n!=null&&n.current&&!n.current.contains(h.target))return;const m=(T=s.current)==null?void 0:T.getBoundingClientRect();if(!m)return;const _=r.position.x===0&&r.position.y===0?{x:m.left,y:m.top}:r.position,y={x:h.clientX-m.left,y:h.clientY-m.top};i(w=>({...w,position:_,isDragging:!0,dragOffset:y,hasMoved:!1,startTime:Date.now()})),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"},[n,r.position]),l=j.useCallback(h=>{var S;if(!r.isDragging)return;const m={x:h.clientX-r.dragOffset.x,y:h.clientY-r.dragOffset.y},_=window.innerWidth,y=window.innerHeight,T=(S=s.current)==null?void 0:S.getBoundingClientRect();T&&(m.x=Math.max(0,Math.min(_-T.width,m.x)),m.y=Math.max(0,Math.min(y-T.height,m.y)));const w=Date.now()-r.startTime>150,b=Math.abs(m.x-r.position.x)>3||Math.abs(m.y-r.position.y)>3;i(A=>({...A,position:m,hasMoved:A.hasMoved||w||b})),e==null||e(m)},[r.isDragging,r.dragOffset,r.startTime,r.position,e]),u=j.useCallback(()=>{i(h=>({...h,isDragging:!1})),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);j.useEffect(()=>{if(r.isDragging)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}},[r.isDragging,l,u]);const d=r.position.x!==0||r.position.y!==0;return{position:r.position,isDragging:r.isDragging,hasMoved:r.hasMoved,isRepositioned:d,elementRef:s,dragProps:{onMouseDown:o,style:d?{position:"fixed",left:r.position.x,top:r.position.y,cursor:r.isDragging?"grabbing":"grab",zIndex:r.isDragging?9999:void 0}:{cursor:"grab"}},setPosition:h=>{i(m=>({...m,position:h})),e==null||e(h)}}},dne=({temporalSpacing:t,onTemporalSpacingChange:e,temporalSpacingMode:n,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:m,geographicMode:_,onGeographicModeChange:y,customShapeFile:T,onCustomShapeFileChange:w,isLoadingGeographic:b,currentShape:S,showCrsWarning:A,crsDetection:R,onDismissCrsWarning:E})=>{const{colors:C}=St(),[O,P]=j.useState(!0),k=j.useRef(null),{elementRef:I,dragProps:N,hasMoved:L,isRepositioned:$}=vh({initialPosition:{x:0,y:0},dragHandleRef:k}),Z=q=>{y(q)},V=q=>{var Q;const z=(Q=q.target.files)==null?void 0:Q[0];z&&w(z)};return g.jsxs("div",{ref:I,className:`border rounded-lg shadow-lg z-30 ${$?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${C.background}F0`,borderColor:C.border,color:C.text,...N.style},onMouseDown:N.onMouseDown,children:[g.jsxs("div",{ref:k,onClick:()=>!L&&P(!O),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:O?"transparent":`${C.containerBackground}80`},onMouseEnter:q=>{O||(q.currentTarget.style.backgroundColor=`${C.border}40`)},onMouseLeave:q=>{O||(q.currentTarget.style.backgroundColor=`${C.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:C.text},children:[g.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"3D Visualization Controls"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${O?"rotate-180":""}`,style:{color:C.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),O&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Geographic Settings"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Geographic Mode"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[g.jsx("button",{onClick:()=>Z("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="unit_grid"?C.accentPrimary:C.containerBackground,color:_==="unit_grid"?C.background:C.text},children:"Unit Grid"}),g.jsx("button",{onClick:()=>Z("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="eastern_hemisphere"?C.accentPrimary:C.containerBackground,color:_==="eastern_hemisphere"?C.background:C.text},children:"Eastern Hemisphere"}),g.jsx("button",{onClick:()=>Z("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="custom"?C.accentPrimary:C.containerBackground,color:_==="custom"?C.background:C.text},children:"Custom"})]})]}),_==="custom"&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Upload Shapefile (.zip)"}),g.jsx("input",{type:"file",accept:".zip",onChange:V,className:"w-full text-xs border rounded px-2 py-1 transition-colors",style:{color:C.text,backgroundColor:C.containerBackground,borderColor:`${C.accentPrimary}33`},onMouseEnter:q=>{q.currentTarget.style.borderColor=`${C.accentPrimary}66`},onMouseLeave:q=>{q.currentTarget.style.borderColor=`${C.accentPrimary}33`}}),T&&g.jsxs("p",{className:"text-xs",style:{color:C.accentPrimary},children:["Selected: ",T.name]})]}),b&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:C.accentPrimary}}),g.jsx("span",{className:"text-xs",style:{color:C.text},children:"Loading geographic data..."})]}),S&&g.jsxs("div",{className:"text-xs",style:{color:`${C.text}B3`},children:[g.jsxs("div",{children:["Shape: ",S.name]}),S.bounds&&g.jsx("div",{children:"Shape loaded successfully"})]}),A&&R&&g.jsxs("div",{className:"border rounded p-3 space-y-2",style:{backgroundColor:`${C.background}33`,borderColor:`${C.accentPrimary}4D`},children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("h5",{className:"text-xs font-bold",style:{color:C.accentPrimary},children:"Coordinate System Detected"}),g.jsx("button",{onClick:E,className:"text-xs",style:{color:`${C.accentPrimary}B3`},onMouseEnter:q=>{q.currentTarget.style.color=C.accentPrimary},onMouseLeave:q=>{q.currentTarget.style.color=`${C.accentPrimary}B3`},children:"✕"})]}),g.jsxs("div",{className:"text-xs space-y-1",style:{color:`${C.accentPrimary}E6`},children:[g.jsxs("div",{children:["CRS: ",R.crs]}),g.jsxs("div",{children:["Confidence: ",(R.confidence*100).toFixed(1),"%"]}),g.jsxs("div",{children:["Land coverage: ",(R.landPercentage*100).toFixed(1),"%"]}),g.jsx("div",{className:"italic",children:R.description})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Temporal Spacing"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsx("label",{className:"text-xs font-medium",style:{color:C.text},children:"Spacing Mode"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[g.jsx("button",{onClick:()=>r("equal"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="equal"?C.accentPrimary:C.containerBackground,color:n==="equal"?C.background:C.text},children:"Equal"}),g.jsx("button",{onClick:()=>r("log"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="log"?C.accentPrimary:C.containerBackground,color:n==="log"?C.background:C.text},children:"Log"}),g.jsx("button",{onClick:()=>r("linear"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="linear"?C.accentPrimary:C.containerBackground,color:n==="linear"?C.background:C.text},children:"Linear"})]})]}),g.jsxs("div",{className:"space-y-1",children:[g.jsx("div",{className:"flex items-center justify-between",children:g.jsxs("label",{className:"text-xs font-medium",style:{color:C.text},children:["Spacing: ",t]})}),g.jsx("input",{type:"range",min:5,max:50,step:1,value:t,onChange:q=>e(Number(q.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(t-5)/45*100}%, ${C.border} ${(t-5)/45*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),g.jsxs("div",{className:"text-xs",style:{color:`${C.text}CC`},children:[n==="equal"&&g.jsx("div",{children:"• Time points are spaced equally"}),n==="log"&&g.jsx("div",{children:"• Time points are spaced logarithmically based on their actual values"}),n==="linear"&&g.jsx("div",{children:"• Time points are spaced according to their actual time values"})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Spacing"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Spatial Spacing: ",i]}),g.jsx("input",{type:"range",min:50,max:500,step:10,value:i,onChange:q=>s(Number(q.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(i-50)/450*100}%, ${C.border} ${(i-50)/450*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Opacity"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Temporal Grid: ",o,"%"]}),g.jsx("input",{type:"range",min:0,max:100,step:5,value:o,onChange:q=>l(Number(q.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${o}%, ${C.border} ${o}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Geographic Shape: ",u,"%"]}),g.jsx("input",{type:"range",min:0,max:100,step:5,value:u,onChange:q=>d(Number(q.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${u}%, ${C.border} ${u}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Node Settings"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Max Node Radius: ",h,"px"]}),g.jsx("input",{type:"range",min:10,max:50,step:1,value:h,onChange:q=>m(Number(q.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(h-10)/40*100}%, ${C.border} ${(h-10)/40*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]})]})]})},hne=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,crsDetection:o})=>{const{colors:l}=St(),[u,d]=j.useState(!0),h=j.useRef(null),{elementRef:m,dragProps:_,hasMoved:y,isRepositioned:T}=vh({initialPosition:{x:0,y:0},dragHandleRef:h}),w=t&&n?(n/t*100).toFixed(1):null,b=e&&r?(r/e*100).toFixed(1):null;return t||n||i||o?g.jsxs("div",{ref:m,className:`border rounded-lg shadow-lg z-10 ${T?"":"absolute top-4 right-4"}`,style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text,maxWidth:"280px",..._.style},onMouseDown:_.onMouseDown,children:[g.jsxs("div",{ref:h,onClick:()=>!y&&d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:A=>{u||(A.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:A=>{u||(A.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[g.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[(t||n||i)&&g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Statistics"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Original ARG:"}),g.jsxs("span",{style:{color:l.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"SubARG:"}),g.jsxs("span",{style:{color:l.text},children:[n.toLocaleString()," nodes (",w,"%), ",r.toLocaleString()," edges (",b,"%)"]})]}),i&&s&&(i!==n||s!==r)&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Displayed:"}),g.jsxs("span",{style:{color:l.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Reduction:"}),g.jsxs("span",{style:{color:l.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),o&&g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Coordinate System"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Detected CRS:"}),g.jsx("span",{style:{color:l.text},children:o.crs})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Confidence:"}),g.jsxs("span",{style:{color:l.text},children:[(o.confidence*100).toFixed(1),"%"]})]}),g.jsxs("div",{className:"flex justify-between",children:[g.jsx("span",{style:{color:l.accentPrimary},children:"Land Coverage:"}),g.jsxs("span",{style:{color:l.text},children:[(o.landPercentage*100).toFixed(1),"%"]})]}),o.description&&g.jsxs("div",{className:"mt-2",children:[g.jsx("div",{className:"mb-1",style:{color:l.accentPrimary},children:"Description:"}),g.jsx("div",{className:"text-xs italic",style:{color:`${l.text}CC`},children:o.description})]})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"View Controls"}),g.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[g.jsx("div",{children:"• Drag: Rotate view"}),g.jsx("div",{children:"• Shift+drag: Pan view"}),g.jsx("div",{children:"• Scroll: Zoom in/out"}),g.jsx("div",{children:"• Left click: Select node"}),g.jsx("div",{children:"• Right click: Show ancestors"})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Types"}),g.jsxs("div",{className:"space-y-2 text-xs",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${l.nodeSample[0]}, ${l.nodeSample[1]}, ${l.nodeSample[2]})`,borderColor:l.background,borderWidth:"0.5px"}}),g.jsx("span",{style:{color:l.text},children:"Sample Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeDefault[0]}, ${l.nodeDefault[1]}, ${l.nodeDefault[2]})`}}),g.jsx("span",{style:{color:l.text},children:"Internal Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeCombined[0]}, ${l.nodeCombined[1]}, ${l.nodeCombined[2]})`}}),g.jsx("span",{style:{color:l.text},children:"Combined Nodes"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${l.nodeRoot[0]}, ${l.nodeRoot[1]}, ${l.nodeRoot[2]})`,borderColor:`rgb(${l.nodeSelected[0]}, ${l.nodeSelected[1]}, ${l.nodeSelected[2]})`}}),g.jsx("span",{style:{color:l.text},children:"Root Nodes"})]})]})]})]})]}):null},Fb={FIT:1.8,MEDIUM:1.2,FAR:.8},pne=({currentViewState:t,bounds:e,onViewStateChange:n})=>{const{colors:r}=St(),[i,s]=j.useState(!0),o=j.useRef(null),{elementRef:l,dragProps:u,hasMoved:d,isRepositioned:h}=vh({initialPosition:{x:0,y:0},dragHandleRef:o}),m=()=>e?[(e.minX+e.maxX)/2,(e.minY+e.maxY)/2,(e.minZ+e.maxZ)/2]:[0,0,0],_=(S,A,R)=>{const E=m();n({target:E,rotationOrbit:S,rotationX:A,zoom:R})},y=()=>{const S=m();n({target:S})},T=[{value:Fb.FIT,label:"Fit All",icon:"🔍"},{value:Fb.MEDIUM,label:"Medium",icon:"👁️"},{value:Fb.FAR,label:"Far",icon:"🌐"}],w=S=>{const A=S%360;_(A,t.rotationX,t.zoom)},b=S=>{const A=Math.max(0,Math.min(90,S));_(t.rotationOrbit,A,t.zoom)};return g.jsxs("div",{ref:l,className:`border rounded-lg shadow-lg z-20 ${h?"":"absolute"}`,style:{backgroundColor:`${r.background}F0`,borderColor:r.border,color:r.text,...h?{}:{top:16,right:300},...u.style},onMouseDown:u.onMouseDown,children:[g.jsxs("div",{ref:o,onClick:()=>!d&&s(!i),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:i?"transparent":`${r.containerBackground}80`},onMouseEnter:S=>{i||(S.currentTarget.style.backgroundColor=`${r.border}40`)},onMouseLeave:S=>{i||(S.currentTarget.style.backgroundColor=`${r.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:r.text},children:[g.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Preset Views"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,style:{color:r.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[g.jsx("div",{className:"space-y-2",children:g.jsxs("button",{onClick:y,className:"w-full px-2 py-1.5 text-xs font-medium rounded transition-colors flex items-center justify-center gap-1",style:{backgroundColor:r.accentPrimary,color:r.background,border:`1px solid ${r.accentPrimary}`},onMouseEnter:S=>{S.currentTarget.style.opacity="0.8"},onMouseLeave:S=>{S.currentTarget.style.opacity="1"},children:[g.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v18m0 0l-4-4m4 4l4-4"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12h18m0 0l-4-4m4 4l-4 4"})]}),"Center ARG"]})}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Rotation"}),g.jsx("div",{className:"space-y-2",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationOrbit),"°"]}),g.jsx("input",{type:"range",min:0,max:360,step:1,value:t.rotationOrbit,onChange:S=>w(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationOrbit/360*100}%, ${r.border} ${t.rotationOrbit/360*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),g.jsx("input",{type:"number",min:0,max:360,value:Math.round(t.rotationOrbit),onChange:S=>w(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"View Angle"}),g.jsx("div",{className:"space-y-2",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationX),"°"]}),g.jsx("input",{type:"range",min:0,max:90,step:1,value:t.rotationX,onChange:S=>b(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationX/90*100}%, ${r.border} ${t.rotationX/90*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),g.jsx("input",{type:"number",min:0,max:90,value:Math.round(t.rotationX),onChange:S=>b(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Zoom Level"}),g.jsx("div",{className:"space-y-2",children:T.map(S=>g.jsxs("button",{onClick:()=>_(t.rotationOrbit,t.rotationX,S.value),className:"w-full px-3 py-2 text-xs font-medium rounded transition-colors flex items-center gap-2",style:{backgroundColor:Math.abs(t.zoom-S.value)<.1?r.accentPrimary:r.containerBackground,color:Math.abs(t.zoom-S.value)<.1?r.background:r.text,border:`1px solid ${r.border}`},title:`Set zoom to ${S.label}`,onMouseEnter:A=>{Math.abs(t.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.border)},onMouseLeave:A=>{Math.abs(t.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.containerBackground)},children:[g.jsx("span",{children:S.icon}),g.jsx("span",{children:S.label})]},S.value))})]}),g.jsxs("div",{className:"space-y-2 pt-2 border-t",style:{borderTopColor:r.border},children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Current View"}),g.jsxs("div",{className:"text-xs space-y-1",style:{color:r.textSecondary},children:[g.jsxs("div",{children:["Rotation: ",Math.round(t.rotationOrbit),"°"]}),g.jsxs("div",{children:["Pan: ",Math.round(Math.abs(t.rotationX)),"° ",t.rotationX<0?"above":t.rotationX>0?"below":"level"]}),g.jsxs("div",{children:["Zoom: ",t.zoom.toFixed(2),"x"]})]})]})]})]})},gne=({min:t,max:e,step:n=.001,value:r,onChange:i,formatValue:s=u=>u.toFixed(3),className:o="",height:l=400})=>{const{colors:u}=St(),[d,h]=j.useState(null),[m,_]=j.useState({y:0,startValue:[0,0]}),[y,T]=j.useState(!1),[w,b]=j.useState(null),S=j.useRef(null);j.useEffect(()=>{const I=L=>{if(L.key==="Shift"){if(T(!0),w===null){const $=Math.abs(r[1]-r[0]);b(Math.max($,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},N=L=>{L.key==="Shift"&&(T(!1),b(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",I),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",I),document.removeEventListener("keyup",N),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,w,n]);const A=j.useCallback(I=>{if(!S.current)return e;const N=S.current.getBoundingClientRect(),L=Math.max(0,Math.min(1,(N.bottom-I)/N.height)),$=t+L*(e-t);return Math.round($/n)*n},[t,e,n]),R=j.useCallback(I=>(e-I)/(e-t)*100,[t,e]),E=j.useCallback((I,N)=>{I.preventDefault(),I.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",h(N),_({y:I.clientY,startValue:r})},[r]),C=j.useCallback(I=>{if(!d||!S.current)return;const N=A(I.clientY),[L,$]=r;if(d==="top"){const Z=Math.max(t,Math.min(e,N));Z<L?i([Z,L]):i([L,Z])}else if(d==="bottom"){const Z=Math.max(t,Math.min(e,N));Z>$?i([$,Z]):i([Z,$])}else if(d==="range"){const Z=I.clientY-m.y,V=S.current.getBoundingClientRect(),q=-(Z/V.height)*(e-t),[z,Q]=m.startValue;let oe=Math.abs(Q-z);y&&w!==null&&(oe=w);const D=(z+Q)/2+q;let Y,le;y&&w!==null?(Y=D-oe/2,le=D+oe/2):(Y=z+q,le=Q+q),Y<t&&(Y=t,le=t+oe),le>e&&(le=e,Y=e-oe),i([Math.round(Y/n)*n,Math.round(le/n)*n])}},[d,r,i,A,t,e,n,m,y,w]),O=j.useCallback(()=>{h(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);j.useEffect(()=>{if(d)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",O),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",O)}},[d,C,O]);const P=R(r[1]),k=R(r[0]);return g.jsxs("div",{className:`flex items-center gap-3 ${o}`,style:{height:l,userSelect:"none"},children:[g.jsxs("div",{className:"flex flex-col justify-between text-xs",style:{color:u.text,height:l},children:[g.jsx("span",{children:s(e)}),g.jsx("span",{children:s(r[1])}),g.jsx("span",{className:"flex-1"}),g.jsx("span",{children:s(r[0])}),g.jsx("span",{children:s(t)})]}),g.jsxs("div",{className:"flex flex-col items-center",children:[g.jsxs("div",{ref:S,className:"relative w-4 rounded-full cursor-pointer",style:{height:l-40,backgroundColor:u.containerBackground},onMouseDown:I=>{const N=A(I.clientY),[L,$]=r,Z=Math.abs(N-L),V=Math.abs(N-$);y||Math.abs($-L)<n*2?E(I,"range"):Z<V?E(I,"bottom"):E(I,"top")},children:[g.jsx("div",{className:`absolute w-full rounded-full transition-opacity ${y?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{top:`${P}%`,height:`${k-P}%`,backgroundColor:y?u.text:u.textSecondary,opacity:y?.8:1,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"range")}}),g.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${P}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"top")}}),g.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${k}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),E(I,"bottom")}})]}),g.jsxs("div",{className:"mt-2 text-xs text-center",style:{color:u.text},children:[g.jsx("div",{children:"Temporal"}),g.jsx("div",{children:"Filter"}),g.jsx("div",{className:"mt-1 h-4 flex items-center justify-center",children:y?g.jsx("div",{className:"px-1 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:u.textSecondary,color:u.background,fontSize:"10px"},children:"Fixed"}):null})]})]})]})},Xn={DEFAULT_DIMENSIONS:{width:800,height:600},DEBOUNCE_DELAY:500,GENOMIC_STEP_DIVISOR:1e3,PERCENTAGE_PRECISION:1,TIME_PRECISION:3,TEMPORAL_STEP_DIVISOR:1e3,TEMPORAL_SLIDER_HEIGHT:350,UNIT_GRID_SIZE:10},mne={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,isFilterSectionCollapsed:!0,temporalSpacingMode:"equal"},_d=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),m4=(t,e)=>(t/e*100).toFixed(Xn.PERCENTAGE_PRECISION),_ne=t=>t.map(([e,n,r])=>({index:e,left:n,right:r})),fj=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;if(n==="descendants"?u===o&&!i.has(d):d===o&&!i.has(u)){const m=n==="descendants"?d:u;r.add(m),s.push(m)}}))}return r},vne=(t,e)=>fj(t,e,"descendants"),yne=(t,e)=>fj(t,e,"ancestors"),_4=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,xne=t=>{if(!(t!=null&&t.length))return{minTime:0,maxTime:1,range:[0,1]};const e=t.map(i=>i.time),n=Math.min(...e),r=Math.max(...e);return{minTime:n,maxTime:r,range:[n,n]}},bne=(t,e,n)=>{const r={maxSamples:n};return t.mode==="genomic"&&(t.genomicRange[0]!==0||t.genomicRange[1]!==e.sequenceLength)?(r.genomicStart=t.genomicRange[0],r.genomicEnd=t.genomicRange[1]):t.mode==="tree"&&(t.treeRange[0]!==0||t.treeRange[1]!==e.treeIntervals.length-1)&&(r.treeStartIdx=t.treeRange[0],r.treeEndIdx=t.treeRange[1]),r},wne=(t,e,n)=>{if(!n)return t;const r=i=>{const s=t.nodes.filter(l=>i.has(l.id)),o=t.edges.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return i.has(u)&&i.has(d)});return{...t,nodes:s,edges:o,metadata:{...t.metadata,is_subset:!0}}};switch(e){case"subgraph":{const i=vne(n,t.edges);return i.add(n.id),r(i)}case"ancestors":{const i=yne(n,t.edges);return i.add(n.id),r(i)}default:return t}},Tne=(t,e)=>{if(!e.isActive||e.mode!=="hide")return t;const[n,r]=e.range;if(n===e.minTime&&r===e.maxTime)return t;const s=t.nodes.filter(u=>u.time>=n&&u.time<=r),o=new Set(s.map(u=>u.id)),l=t.edges.filter(u=>{const d=typeof u.source=="number"?u.source:u.source.id,h=typeof u.target=="number"?u.target:u.target.id;return o.has(d)&&o.has(h)});return{...t,nodes:s,edges:l,metadata:{...t.metadata,is_subset:!0}}},Sne=(t,e,n,r)=>!t||!e||!n||!r?null:{originalNodes:e.metadata.original_num_nodes||r.num_nodes,originalEdges:e.metadata.original_num_edges||r.num_edges,subArgNodes:t.nodes.length,subArgEdges:t.edges.length,displayedNodes:n.nodes.length,displayedEdges:n.edges.length},Ene=(t,e,n,r)=>{let i="";switch(t){case"subgraph":i=`3D SubARG at Root ${e==null?void 0:e.id}`;break;case"ancestors":i=`3D Parent ARG of Node ${e==null?void 0:e.id}`;break;default:i="3D Full ARG"}return n.isActive&&(r==null?void 0:r.metadata.genomic_start)!==void 0&&(r==null?void 0:r.metadata.genomic_end)!==void 0&&(i+=` (${_d(r.metadata.genomic_start)} - ${_d(r.metadata.genomic_end)})`),i},Ane=({data:t,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,temporalSpacingMode:u,spatialSpacing:d,geographicShape:h,geographicMode:m,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,viewState:b})=>{const S=j.useRef(null),[A,R]=j.useState(Xn.DEFAULT_DIMENSIONS);return j.useEffect(()=>{const E=()=>{if(S.current){const{clientWidth:O,clientHeight:P}=S.current;R({width:O||Xn.DEFAULT_DIMENSIONS.width,height:P||Xn.DEFAULT_DIMENSIONS.height})}};E(),window.addEventListener("resize",E);let C=null;return window.ResizeObserver&&S.current&&(C=new ResizeObserver(E),C.observe(S.current)),()=>{window.removeEventListener("resize",E),C&&C.disconnect()}},[]),g.jsx("div",{ref:S,className:"w-full h-full",children:g.jsx(uj,{data:t,width:A.width,height:A.height,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:d,geographicShape:h,geographicMode:m,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,externalViewState:b,temporalSpacingMode:u})})},Rne=({filename:t,max_samples:e})=>{const{colors:n}=St(),{treeSequence:r}=Qs(),[i,s]=j.useState(null),[o,l]=j.useState(null),[u,d]=j.useState(!0),[h,m]=j.useState(null),[_,y]=j.useState("full"),[T,w]=j.useState(null),[b,S]=j.useState({isActive:!1,mode:"genomic",genomicRange:[0,0],treeRange:[0,0]}),[A,R]=j.useState({isActive:!1,mode:"planes",range:[0,1],minTime:0,maxTime:1}),[E,C]=j.useState({sequenceLength:0,treeIntervals:[]}),[O,P]=j.useState(mne),[k,I]=j.useState({target:[0,0,0],zoom:1.8,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[N,L]=j.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1}),$=j.useCallback(async()=>{try{if(L(F=>({...F,isLoading:!0})),N.mode==="unit_grid"){const{createUnitGridShape:F}=await dk(async()=>{const{createUnitGridShape:J}=await Promise.resolve().then(()=>p4);return{createUnitGridShape:J}},void 0),X=F(Xn.UNIT_GRID_SIZE);L(J=>({...J,currentShape:X}))}else if(N.mode==="custom"&&N.customShapeFile){const F=await tt.uploadShapefile(N.customShapeFile);console.log("Custom shapefile uploaded:",F.data)}else try{const F=await tt.getShapeData(N.mode);L(X=>({...X,currentShape:F.data}))}catch{console.warn(`Failed to load ${N.mode}, using fallback`);const{createUnitGridShape:X}=await dk(async()=>{const{createUnitGridShape:pe}=await Promise.resolve().then(()=>p4);return{createUnitGridShape:pe}},void 0),J=X(Xn.UNIT_GRID_SIZE);L(pe=>({...pe,currentShape:J}))}}catch(F){console.error("Error loading geographic data:",F)}finally{L(F=>({...F,isLoading:!1}))}},[N.mode,N.customShapeFile]);j.useEffect(()=>{$()},[$]),j.useEffect(()=>{(async()=>{var X,J;try{d(!0);const ye=(await tt.getGraphData(t,{maxSamples:e})).data;if(ye.metadata.sequence_length&&(C(Ae=>({...Ae,sequenceLength:ye.metadata.sequence_length})),S(Ae=>({...Ae,genomicRange:[0,ye.metadata.sequence_length]}))),(X=ye.metadata.tree_intervals)!=null&&X.length){const Ae=_ne(ye.metadata.tree_intervals);C(Oe=>({...Oe,treeIntervals:Ae})),S(Oe=>({...Oe,treeRange:[0,Ae.length-1]}))}if((J=ye.nodes)!=null&&J.length){const Ae=xne(ye.nodes);R(Oe=>({...Oe,...Ae}))}if(!_4(ye))m("No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.");else if(s(ye),l(ye),Y(ye),ye.metadata.suggested_geographic_mode){const Ae=ye.metadata.suggested_geographic_mode;L(Oe=>({...Oe,mode:Ae}))}}catch(pe){console.error("Error fetching 3D graph data:",pe),m(pe instanceof Error?pe.message:"Unknown error occurred")}finally{d(!1)}})()},[t,e]);const Z=j.useRef(null);j.useEffect(()=>{if(!(!b.isActive||u))return Z.current&&clearTimeout(Z.current),Z.current=setTimeout(async()=>{try{d(!0);const F=bne(b,E,e),J=(await tt.getGraphData(t,F)).data;_4(J)?(s(J),m(null),Y(J)):m("No spatial data found in this range.")}catch(F){console.error("Error fetching filtered data:",F),m(F instanceof Error?F.message:"An error occurred while fetching graph data")}finally{d(!1)}},Xn.DEBOUNCE_DELAY),()=>{Z.current&&clearTimeout(Z.current)}},[b,t,e,E.sequenceLength,E.treeIntervals.length]),j.useEffect(()=>{P(F=>({...F,isFilterSectionCollapsed:!b.isActive&&!A.isActive}))},[b.isActive,A.isActive]);const V=()=>{if(!i)return i;const F=Tne(i,A);return wne(F,_,T)},q=F=>{_==="full"?(w(F),y("subgraph")):(T==null?void 0:T.id)===F.id?(y("full"),w(null)):(w(F),y("subgraph"))},z=F=>{w(F),y("ancestors")},Q=()=>{y("full"),w(null)},oe=F=>{I(X=>({...X,...F}))},G=F=>{I(X=>({...X,...F}))},D=F=>{if(!F||!F.nodes.length)return null;const X=F.nodes.filter(Ye=>{var be,ke;return((be=Ye.location)==null?void 0:be.x)!==void 0&&((ke=Ye.location)==null?void 0:ke.y)!==void 0});if(X.length===0)return null;const J=X.map(Ye=>Ye.location.x),pe=X.map(Ye=>Ye.location.y),ye=X.map(Ye=>Ye.time),Ae=Math.min(...J),Oe=Math.max(...J),Ue=Math.min(...pe),Ee=Math.max(...pe),Te=(Ae+Oe)/2,Ne=(Ue+Ee)/2,Pe=Math.max(Oe-Ae,Ee-Ue)||1,Kt=(Ae-Te)/Pe*O.spatialSpacing,Me=(Oe-Te)/Pe*O.spatialSpacing,nn=(Ue-Ne)/Pe*O.spatialSpacing,Mt=(Ee-Ne)/Pe*O.spatialSpacing,Rt=Array.from(new Set(ye)).sort((Ye,be)=>Ye-be),Ke=0,rn=(Rt.length-1)*O.temporalSpacing;return{minX:Kt,maxX:Me,minY:nn,maxY:Mt,minZ:Ke,maxZ:rn}},Y=F=>{const X=D(F);if(X){const J=[(X.minX+X.maxX)/2,(X.minY+X.maxY)/2,(X.minZ+X.maxZ)/2];I(pe=>({...pe,target:J}))}};if(u)return g.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:g.jsxs("div",{className:"text-center",children:[g.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:n.accentPrimary}}),g.jsx("p",{style:{color:n.text},children:"Loading 3D spatial ARG visualization..."})]})});if(h)return g.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:g.jsxs("div",{className:"text-center",style:{color:n.text},children:[g.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),g.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:h})]})});const le=V(),ie=Sne(o,i,le,r);return g.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:n.background},children:[g.jsx("div",{className:"flex-shrink-0 border-b px-4 py-2",style:{backgroundColor:n.background,borderBottomColor:n.border},children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("div",{className:"flex flex-col gap-2",children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("h2",{className:"text-lg font-semibold",style:{color:n.headerText},children:Ene(_,T,b,i)}),(E.sequenceLength>0||E.treeIntervals.length>0)&&g.jsxs("div",{className:"flex items-center gap-4",children:[E.sequenceLength>0&&g.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[g.jsx("input",{type:"checkbox",checked:b.isActive,onChange:()=>S(F=>({...F,isActive:!F.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Genomic Range"]}),g.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[g.jsx("input",{type:"checkbox",checked:A.isActive,onChange:()=>R(F=>({...F,isActive:!F.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Temporal Range"]})]}),_!=="full"&&g.jsx("button",{onClick:Q,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:F=>{F.currentTarget.style.borderColor=`${n.accentPrimary}66`,F.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:F=>{F.currentTarget.style.borderColor=`${n.accentPrimary}33`,F.currentTarget.style.backgroundColor=n.containerBackground},children:"Return to Full ARG"})]})}),g.jsxs("div",{className:"flex items-center gap-6",children:[(b.isActive||A.isActive)&&g.jsxs("button",{onClick:()=>P(F=>({...F,isFilterSectionCollapsed:!F.isFilterSectionCollapsed})),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:n.accentPrimary,color:n.background},onMouseEnter:F=>{F.currentTarget.style.opacity="0.8"},onMouseLeave:F=>{F.currentTarget.style.opacity="1"},children:[g.jsx("span",{children:O.isFilterSectionCollapsed?"Show Controls":"Hide Controls"}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${O.isFilterSectionCollapsed?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:n.headerText},children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${n.nodeSample[0]}, ${n.nodeSample[1]}, ${n.nodeSample[2]})`,borderColor:n.background,borderWidth:"0.5px"}}),g.jsx("span",{children:"Sample"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeDefault[0]}, ${n.nodeDefault[1]}, ${n.nodeDefault[2]})`}}),g.jsx("span",{children:"Internal"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeCombined[0]}, ${n.nodeCombined[1]}, ${n.nodeCombined[2]})`}}),g.jsx("span",{children:"Combined"})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${n.nodeRoot[0]}, ${n.nodeRoot[1]}, ${n.nodeRoot[2]})`,borderColor:`rgb(${n.nodeSelected[0]}, ${n.nodeSelected[1]}, ${n.nodeSelected[2]})`}}),g.jsx("span",{children:"Root"})]})]}),g.jsx("div",{className:"text-xs border-l pl-4",style:{color:n.headerText,borderLeftColor:n.border},children:"Left click: Subgraph • Right click: Ancestors"})]})]})}),(b.isActive||A.isActive)&&g.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:n.background,borderBottomColor:n.border},children:!O.isFilterSectionCollapsed&&g.jsxs("div",{className:"px-4 py-3",children:[g.jsxs("div",{className:"flex items-start justify-between gap-6",children:[g.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:[b.isActive&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Genomic Mode:"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[g.jsx("button",{onClick:()=>S(F=>({...F,mode:"genomic"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:b.mode==="genomic"?n.accentPrimary:n.containerBackground,color:b.mode==="genomic"?n.background:n.text},children:"Genomic"}),E.treeIntervals.length>0&&g.jsx("button",{onClick:()=>S(F=>({...F,mode:"tree"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:b.mode==="tree"?n.accentPrimary:n.containerBackground,color:b.mode==="tree"?n.background:n.text},children:"Tree Index"})]})]}),A.isActive&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Temporal Mode:"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[g.jsx("button",{onClick:()=>R(F=>({...F,mode:"hide"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="hide"?n.accentPrimary:n.containerBackground,color:A.mode==="hide"?n.background:n.text},children:"Hide Others"}),g.jsx("button",{onClick:()=>R(F=>({...F,mode:"planes"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="planes"?n.accentPrimary:n.containerBackground,color:A.mode==="planes"?n.background:n.text},children:"Dim Others"})]})]})]}),b.isActive&&g.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[g.jsx("div",{className:"flex-1 max-w-md min-w-0",children:b.mode==="genomic"&&E.sequenceLength>0?g.jsx(IO,{min:0,max:E.sequenceLength,step:Math.max(1,Math.floor(E.sequenceLength/Xn.GENOMIC_STEP_DIVISOR)),value:b.genomicRange,onChange:F=>S(X=>({...X,genomicRange:F})),formatValue:_d,className:"w-full"}):b.mode==="tree"&&E.treeIntervals.length>0?g.jsx(OO,{treeIntervals:E.treeIntervals,value:b.treeRange,onChange:F=>S(X=>({...X,treeRange:F})),className:"w-full"}):null}),g.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:n.text},children:[b.mode==="genomic"?g.jsxs("span",{children:[_d(b.genomicRange[1]-b.genomicRange[0])," bp (",m4(b.genomicRange[1]-b.genomicRange[0],E.sequenceLength),"%)",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&g.jsxs(g.Fragment,{children:[" • ",i.metadata.num_local_trees," trees"]})]}):b.mode==="tree"&&E.treeIntervals.length>0?g.jsxs("span",{children:["Trees ",b.treeRange[0],"-",b.treeRange[1]," (",b.treeRange[1]-b.treeRange[0]+1," of ",E.treeIntervals.length,")",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&g.jsxs(g.Fragment,{children:[" • ",i.metadata.expected_tree_count??i.metadata.num_local_trees," displayed"]}),(i==null?void 0:i.metadata.tree_count_mismatch)&&g.jsxs(g.Fragment,{children:[" ⚠️ (actual: ",i.metadata.num_local_trees,")"]})]}):null,u&&g.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})]})]}),A.isActive&&g.jsx("div",{className:"text-xs mt-3",style:{color:n.text},children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("span",{children:["Temporal Range: ",A.range[0].toFixed(Xn.TIME_PRECISION)," - ",A.range[1].toFixed(Xn.TIME_PRECISION)," ","(",m4(A.range[1]-A.range[0],A.maxTime-A.minTime),"% of time range) • Hold Shift + drag to maintain window size"]}),u&&g.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})})]})}),g.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[A.isActive&&!O.isFilterSectionCollapsed&&g.jsx("div",{className:"flex-shrink-0 border-r px-3 py-4 flex items-center justify-center",style:{backgroundColor:n.background,borderRightColor:n.border},children:g.jsx(gne,{min:A.minTime,max:A.maxTime,step:(A.maxTime-A.minTime)/Xn.TEMPORAL_STEP_DIVISOR,value:A.range,onChange:F=>R(X=>({...X,range:F})),formatValue:F=>F.toFixed(Xn.TIME_PRECISION),height:Xn.TEMPORAL_SLIDER_HEIGHT})}),g.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[g.jsx(Ane,{data:le,onNodeClick:q,onNodeRightClick:z,selectedNode:T,temporalRange:A.isActive?A.range:null,showTemporalPlanes:A.isActive&&A.mode==="planes",temporalFilterMode:A.isActive?A.mode:null,temporalSpacing:O.temporalSpacing,temporalSpacingMode:O.temporalSpacingMode,spatialSpacing:O.spatialSpacing,geographicShape:N.currentShape,geographicMode:N.mode,temporalGridOpacity:O.temporalGridOpacity,geographicShapeOpacity:O.geographicShapeOpacity,maxNodeRadius:O.maxNodeRadius,onViewStateChange:oe,viewState:k}),g.jsx(pne,{currentViewState:k,bounds:D(le),onViewStateChange:G}),g.jsx(dne,{temporalSpacing:O.temporalSpacing,onTemporalSpacingChange:F=>P(X=>({...X,temporalSpacing:F})),temporalSpacingMode:O.temporalSpacingMode,onTemporalSpacingModeChange:F=>P(X=>({...X,temporalSpacingMode:F})),spatialSpacing:O.spatialSpacing,onSpatialSpacingChange:F=>P(X=>({...X,spatialSpacing:F})),temporalGridOpacity:O.temporalGridOpacity,onTemporalGridOpacityChange:F=>P(X=>({...X,temporalGridOpacity:F})),geographicShapeOpacity:O.geographicShapeOpacity,onGeographicShapeOpacityChange:F=>P(X=>({...X,geographicShapeOpacity:F})),maxNodeRadius:O.maxNodeRadius,onMaxNodeRadiusChange:F=>P(X=>({...X,maxNodeRadius:F})),geographicMode:N.mode,onGeographicModeChange:F=>L(X=>({...X,mode:F})),customShapeFile:N.customShapeFile,onCustomShapeFileChange:F=>L(X=>({...X,customShapeFile:F})),isLoadingGeographic:N.isLoading,currentShape:N.currentShape,showCrsWarning:N.showCrsWarning,crsDetection:i==null?void 0:i.metadata.coordinate_system_detection,onDismissCrsWarning:()=>L(F=>({...F,showCrsWarning:!1}))}),g.jsx(hne,{originalNodeCount:ie==null?void 0:ie.originalNodes,originalEdgeCount:ie==null?void 0:ie.originalEdges,subargNodeCount:ie==null?void 0:ie.subArgNodes,subargEdgeCount:ie==null?void 0:ie.subArgEdges,displayedNodeCount:ie==null?void 0:ie.displayedNodes,displayedEdgeCount:ie==null?void 0:ie.displayedEdges,crsDetection:i!=null&&i.metadata.coordinate_system_detection?{crs:i.metadata.coordinate_system_detection.likely_crs,confidence:i.metadata.coordinate_system_detection.confidence,landPercentage:i.metadata.coordinate_system_detection.land_percentage,description:i.metadata.coordinate_system_detection.reasoning}:void 0,isTemporalSliderVisible:A.isActive})]})]})]})};function Cne(){const{filename:t}=i1(),e=cs(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Qs(),{colors:s,setCurrentVisualizationType:o}=St(),l=j.useRef(null),[u,d]=j.useState(!1);if(j.useEffect(()=>{o("spatial-3d")},[o]),!t)return g.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 font-sans",style:{backgroundColor:s.background,color:s.text},children:[g.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),g.jsx("button",{className:"font-bold py-2 px-6 rounded-lg mt-4 transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),m=y=>{Re.user.action("switch-tree-sequence-spatial",{treeSequence:y},"SpatialArg3DVisualizationPage"),i(y),d(!1),e(`/visualize-spatial/${encodeURIComponent(y.filename)}`)},_=async()=>{if(l.current)try{const y=`${h.replace(/\.(trees|tsz)$/,"")}_3d_spatial_arg.png`,T={text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"},w=l.current.querySelector("[data-3d-visualization]");if(w!=null&&w.getExportData){const S=w.getExportData(),A=l.current.querySelector('[data-deck="true"]'),R=A?{current:A}:null;try{await PO(S,R,{filename:y,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("High-resolution 3D spatial ARG image exported successfully");return}catch(E){console.warn("High-quality export failed, falling back to canvas capture:",E)}}const b=l.current.querySelector("canvas");if(!b)throw new Error("No canvas found for export");await DO(b,{filename:y,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("3D spatial ARG image captured from canvas")}catch(y){console.error("Error downloading 3D spatial ARG image:",y)}};return g.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[g.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:g.jsxs("div",{className:"max-w-7xl mx-auto",children:[g.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[g.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.opacity="0.8"},onMouseLeave:y=>{y.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),g.jsx(ko,{size:"medium"})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[g.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"3D Spatial ARG"}),g.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),g.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[g.jsx(P1,{}),g.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),g.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download 3D visualization as PNG",children:"Download Image"}),r&&g.jsx(mc,{filename:r.filename})]})]})]})}),g.jsx(_c,{isOpen:u,onClose:()=>d(!1),onSelect:m}),g.jsx("main",{className:"flex-1 overflow-hidden",children:g.jsx("div",{ref:l,className:"w-full h-full",children:j.useMemo(()=>g.jsx(Rne,{filename:h,max_samples:n}),[h,n])})})]})}const Wt={DEFAULT_ZOOM:2.5,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,BASE_ELEVATION:.1,UNIT_GRID_SIZE:10,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,GEOGRAPHIC_OPACITY_SCALE:2.5,GRID_EXTENSION:2},nc={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},uc={NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4,GEOGRAPHIC_NORMAL:1,TIME_SLICE_NORMAL:1},Nne=(t,e,n)=>t.is_sample?nc.SAMPLE:t.is_combined?nc.COMBINED:Gr(t,e,n)?nc.ROOT:nc.DEFAULT,kne=(t,e,n,r,i)=>i,Mne=(t,e,n,r)=>{const i=t.filter(w=>{var b,S;return((b=w.location)==null?void 0:b.x)!==void 0&&((S=w.location)==null?void 0:S.y)!==void 0});if(i.length===0)return null;const s=[...i.map(w=>w.location.x),...e.map(w=>w.location.x)],o=[...i.map(w=>w.location.y),...e.map(w=>w.location.y)],l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let m,_,y;if((n==="eastern_hemisphere"||n==="custom")&&(r==null?void 0:r.bounds)){const w=r.bounds,[b,S,A,R]=w;m=(b+A)/2,_=(S+R)/2,y=Math.max(A-b,R-S)||1}else m=(l+u)/2,_=(d+h)/2,y=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:m,centerY:_,maxScale:y,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}};function Ine(t,e,n,r){if(e.length<=1)return 0;switch(r){case"equal":return e.indexOf(t)*n;case"log":const s=Math.max(1e-4,e[0]),o=e[e.length-1],l=Math.log(s),u=Math.log(o);return(Math.log(Math.max(1e-4,t))-l)/(u-l)*(e.length-1)*n;case"linear":const m=e[0],_=e[e.length-1];return(t-m)/(_-m)*(e.length-1)*n;default:return t*n}}const One=t=>t*Wt.JITTER_SCALE%Wt.JITTER_RANGE-Wt.JITTER_OFFSET,Pne=(t,e,n,r,i,s,o,l,u,d)=>{const{centerX:h,centerY:m,maxScale:_}=n,y=new Map(e.map(S=>[S.id,S])),T=Array.from(new Set([...t.map(S=>S.time),...e.map(S=>S.time)])).sort((S,A)=>S-A),w=[];return{nodes:t.map(S=>{const A=y.get(S.id);if(!A||!S.location||!A.location)throw new Error(`Missing location data for node ${S.id}`);const R=(S.location.x-h)/_*s,E=(S.location.y-m)/_*s,C=(A.location.x-h)/_*s,O=(A.location.y-m)/_*s,P=S.is_sample,k=P?R:(R+C)/2,I=P?E:(E+O)/2,N=One(S.id),L=Ine(S.time,T,r,i)+Wt.BASE_ELEVATION+N,$=C-R,Z=O-E,V=P?0:Math.sqrt($*$+Z*Z),q=Nne(S,l,u);let z;return P?z=o.nodeSample:S.is_combined?z=o.nodeCombined:Gr(S,l,u)?z=o.nodeRoot:z=o.nodeDefault,P||(w.push({source:[R,E,L],target:[k,I,L],color:[255,0,0,180],width:d}),w.push({source:[k,I,L],target:[C,O,L],color:[255,0,0,180],width:d})),{...S,position:[k,I,L],firstPosition:[R,E,L],secondPosition:[C,O,L],color:z,size:q,distance:V}}),diffEdges:w}},Dne=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=kne(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),jne=(t,e,n,r,i,s)=>{const o=Gr(t,[],[]);let l=1;if(o)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*l];if(t.is_sample){const u=s.background==="#ffffff"?0:255;return[u,u,u,255*l]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},Lne=(t,e,n)=>{const r=Gr(t,[],[]),s=t.size/nc.DEFAULT;return r?Math.max(.8,uc.NODE_OUTLINE_ROOT*s):t.is_sample?Math.max(.5,uc.NODE_OUTLINE_SAMPLE*s):0},Bne=(t,e,n,r,i)=>{var h;let s="";t.is_sample?s="Sample Node":t.is_combined?s=`Combined Node (contains: ${(h=t.combined_nodes)==null?void 0:h.join(", ")})`:Gr(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?s="Root Node":s="Internal Node";const o=t.firstPosition[0],l=t.firstPosition[1],u=t.secondPosition[0],d=t.secondPosition[1];return{html:`
      <div style="background: ${i.tooltipBackground}; color: ${i.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${s}<br/>
        ${t.is_sample?"Sample Node (Fixed Position)":`
        First Position: (${o.toFixed(3)}, ${l.toFixed(3)})<br/>
        Second Position: (${u.toFixed(3)}, ${d.toFixed(3)})<br/>
        Movement Distance: ${t.distance.toFixed(3)}`}
      </div>
    `,style:{backgroundColor:"transparent",color:i.tooltipText}}},Une=(t,e,n)=>t||(e==="unit_grid"?Ks(Wt.UNIT_GRID_SIZE):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):Ks(Wt.UNIT_GRID_SIZE)),Ms={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,diffEdgeWidth:3,temporalSpacingMode:"equal"},Fne=({firstData:t,secondData:e,temporalSpacing:n=Ms.temporalSpacing,temporalSpacingMode:r=Ms.temporalSpacingMode,spatialSpacing:i=Ms.spatialSpacing,temporalGridOpacity:s=Ms.temporalGridOpacity,geographicShapeOpacity:o=Ms.geographicShapeOpacity,maxNodeRadius:l=Ms.maxNodeRadius,diffEdgeWidth:u=Ms.diffEdgeWidth,geographicMode:d="unit_grid",geographicShape:h=null})=>{const{colors:m}=St(),{nodes3D:_,diffEdges:y}=j.useMemo(()=>{const R=Mne(t.nodes,e.nodes,d,h);if(!R)return{nodes3D:[],diffEdges:[]};const E=Pne(t.nodes,e.nodes,R,n,r,i,m,t.nodes,t.edges,u);return{nodes3D:E.nodes,diffEdges:E.diffEdges}},[t,e,n,r,i,m,d,h,u]),T=j.useMemo(()=>{const R=new Map(_.map(C=>[C.id,C]));return Dne(t.edges,R,null,null,m).map(C=>({...C,width:Wt.EDGE_WIDTH}))},[t.edges,_,m]),w=j.useMemo(()=>Une(h,d),[h,d,i]),b=j.useMemo(()=>{if(!w&&!_.length)return[];const R=o??70,E=R>0?R*Wt.GEOGRAPHIC_OPACITY_SCALE:0,C=uc.GEOGRAPHIC_NORMAL,O=[m.geographicGrid[0],m.geographicGrid[1],m.geographicGrid[2],E],P=[];w&&P.push(..._h(w,0,i,O,C));const k={minX:Math.min(..._.map(q=>q.position[0])),maxX:Math.max(..._.map(q=>q.position[0])),minY:Math.min(..._.map(q=>q.position[1])),maxY:Math.max(..._.map(q=>q.position[1])),minZ:Math.min(..._.map(q=>q.position[2])),maxZ:Math.max(..._.map(q=>q.position[2]))},I=Array.from(new Set(_.map(q=>q.time))).sort((q,z)=>q-z),N=new Map(I.map((q,z)=>[q,z])),$=s??30,Z=uc.TIME_SLICE_NORMAL,V=[m.temporalGrid[0],m.temporalGrid[1],m.temporalGrid[2],$];return $>0&&I.forEach(q=>{const Q=(N.get(q)||0)*n;Q!==0&&(P.push({source:[k.minX-Wt.GRID_EXTENSION,0,Q],target:[k.maxX+Wt.GRID_EXTENSION,0,Q],color:V,width:Z}),P.push({source:[0,k.minY-Wt.GRID_EXTENSION,Q],target:[0,k.maxY+Wt.GRID_EXTENSION,Q],color:V,width:Z}))}),P},[w,i,o,s,m.geographicGrid,m.temporalGrid,_,n]),S=j.useMemo(()=>{const R=[];return b.length>0&&R.push(new os({id:"geographic-shape",data:b,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>E.width,pickable:!1})),R.push(new os({id:"edges",data:T,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>Wt.EDGE_WIDTH,pickable:!1})),R.push(new os({id:"diff-edges",data:y,getSourcePosition:E=>E.source,getTargetPosition:E=>E.target,getColor:E=>E.color,getWidth:E=>E.width,pickable:!1})),R.push(new mh({id:"nodes",data:_,pickable:!0,opacity:Wt.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:Wt.NODE_RADIUS_SCALE,radiusMinPixels:Wt.MIN_NODE_RADIUS,radiusMaxPixels:l,lineWidthMinPixels:Wt.MIN_NODE_RADIUS,lineWidthMaxPixels:uc.MAX_NODE_OUTLINE,getPosition:E=>E.position,getRadius:E=>E.size,getFillColor:E=>E.color,getLineColor:E=>jne(E,null,null,null,null,m),getLineWidth:E=>Lne(E),onClick:(E,C)=>{C.srcEvent.preventDefault()},onHover:E=>{}})),R},[b,T,y,_,l,m]),A=j.useMemo(()=>({target:[0,0,0],rotationX:0,rotationOrbit:0,zoom:Wt.DEFAULT_ZOOM,minZoom:Wt.MIN_ZOOM,maxZoom:Wt.MAX_ZOOM}),[]);return!t||!e||_.length===0?null:g.jsx(sj,{layers:S,views:new h2,initialViewState:A,controller:!0,parameters:{blend:!0},getTooltip:({object:R})=>R?Bne(R,t,null,i,m):null})},zne=()=>{const[t,e]=j.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1,isManuallySet:!1});return j.useEffect(()=>{(async()=>{try{e(u=>({...u,isLoading:!0}));const l=await tt.getShapeData("unit_grid");e(u=>({...u,currentShape:l.data,isLoading:!1}))}catch(l){console.error("Error loading initial geographic data:",l),e(u=>({...u,isLoading:!1}))}})()},[]),j.useEffect(()=>{(async()=>{if(!(t.mode==="custom"&&!t.customShapeFile))try{if(e(l=>({...l,isLoading:!0})),t.mode==="custom"&&t.customShapeFile){const l=await tt.uploadShapefile(t.customShapeFile);console.log("Custom shapefile uploaded:",l.data)}else if(t.mode==="unit_grid"){const l=Ks(10);e(u=>({...u,currentShape:l,isLoading:!1}))}else try{const l=await tt.getShapeData(t.mode);e(u=>({...u,currentShape:l.data,isLoading:!1}))}catch{console.warn(`Failed to load ${t.mode} from API, creating fallback`);const u=Ks(10);e(d=>({...d,currentShape:u,isLoading:!1}))}}catch(l){console.error("Error loading shape for mode:",t.mode,l),e(u=>({...u,isLoading:!1}))}})()},[t.mode,t.customShapeFile]),{...t,setMode:o=>{e(l=>({...l,mode:o,isManuallySet:!0,currentShape:null}))},setCustomShapeFile:o=>{e(l=>({...l,customShapeFile:o}))},dismissCrsWarning:()=>{e(o=>({...o,showCrsWarning:!1}))},updateFromCrsDetection:(o,l,u)=>{if(!o||!l||!u||t.isManuallySet)return;const d=o.confidence>.7,h=l.confidence>.7,m=o.likely_crs===l.likely_crs;d&&h&&m&&u!==t.mode?(e(_=>({..._,showCrsWarning:!0,mode:u})),console.log(`Setting geographic mode to: ${u} based on matching CRS detections`)):e(_=>({..._,showCrsWarning:!1}))}}},$ne=({temporalSpacing:t,onTemporalSpacingChange:e,temporalSpacingMode:n,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:m,diffEdgeWidth:_,onDiffEdgeWidthChange:y,geographicMode:T,onGeographicModeChange:w,customShapeFile:b,onCustomShapeFileChange:S,isLoadingGeographic:A,currentShape:R,showCrsWarning:E,firstCrsDetection:C,secondCrsDetection:O,onDismissCrsWarning:P})=>{const{colors:k}=St(),[I,N]=j.useState(!0),L=j.useRef(null),{elementRef:$,dragProps:Z,hasMoved:V,isRepositioned:q}=vh({initialPosition:{x:0,y:0},dragHandleRef:L}),z=oe=>{w(oe)},Q=oe=>{var D;const G=(D=oe.target.files)==null?void 0:D[0];G&&S(G)};return g.jsxs("div",{ref:$,className:`border rounded-lg shadow-lg z-30 ${q?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${k.background}F0`,borderColor:k.border,color:k.text,...Z.style},onMouseDown:Z.onMouseDown,children:[g.jsxs("div",{ref:L,onClick:()=>!V&&N(!I),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:I?"transparent":`${k.containerBackground}80`},onMouseEnter:oe=>{I||(oe.currentTarget.style.backgroundColor=`${k.border}40`)},onMouseLeave:oe=>{I||(oe.currentTarget.style.backgroundColor=`${k.containerBackground}80`)},children:[g.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:k.text},children:[g.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"Diff Visualization Controls"]}),g.jsx("svg",{className:`w-4 h-4 transition-transform ${I?"rotate-180":""}`,style:{color:k.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&g.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Geographic Settings"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Geographic Mode"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:k.containerBackground},children:[g.jsx("button",{onClick:()=>z("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:T==="unit_grid"?k.accentPrimary:k.containerBackground,color:T==="unit_grid"?k.background:k.text},children:"Unit Grid"}),g.jsx("button",{onClick:()=>z("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:T==="eastern_hemisphere"?k.accentPrimary:k.containerBackground,color:T==="eastern_hemisphere"?k.background:k.text},children:"Eastern Hemisphere"}),g.jsx("button",{onClick:()=>z("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:T==="custom"?k.accentPrimary:k.containerBackground,color:T==="custom"?k.background:k.text},children:"Custom"})]})]}),T==="custom"&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Custom Shape File"}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("input",{type:"file",accept:".geojson,.json",onChange:Q,className:"hidden",id:"shapefileUpload"}),g.jsx("label",{htmlFor:"shapefileUpload",className:"px-3 py-1.5 text-xs font-medium rounded cursor-pointer transition-colors",style:{backgroundColor:k.accentPrimary,color:k.background},children:"Upload GeoJSON"}),b&&g.jsx("span",{className:"text-xs",style:{color:k.text},children:b.name})]})]}),A&&g.jsx("div",{className:"text-xs",style:{color:k.text},children:"Loading geographic shape..."}),R&&g.jsxs("div",{className:"text-xs space-y-1",style:{color:k.text},children:[g.jsxs("div",{children:["Shape: ",R.name]}),R.bounds&&g.jsx("div",{children:"Shape loaded successfully"})]}),E&&g.jsx("div",{className:"mt-4 p-3 rounded",style:{backgroundColor:`${k.accentPrimary}20`},children:g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",style:{color:k.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),g.jsx("h5",{className:"text-sm font-medium",style:{color:k.accentPrimary},children:"Coordinate System Detection"})]}),P&&g.jsx("button",{onClick:P,className:"text-xs opacity-50 hover:opacity-100 transition-opacity",style:{color:k.accentPrimary},children:"Dismiss"})]}),C&&g.jsxs("div",{className:"text-xs space-y-1",children:[g.jsx("div",{style:{color:k.text},children:"First Tree Sequence:"}),g.jsxs("div",{style:{color:`${k.text}B3`},children:["Likely CRS: ",C.likely_crs,g.jsx("br",{}),"Confidence: ",(C.confidence*100).toFixed(1),"%",g.jsx("br",{}),"Land Coverage: ",(C.land_percentage*100).toFixed(1),"%"]})]}),O&&g.jsxs("div",{className:"text-xs space-y-1",children:[g.jsx("div",{style:{color:k.text},children:"Second Tree Sequence:"}),g.jsxs("div",{style:{color:`${k.text}B3`},children:["Likely CRS: ",O.likely_crs,g.jsx("br",{}),"Confidence: ",(O.confidence*100).toFixed(1),"%",g.jsx("br",{}),"Land Coverage: ",(O.land_percentage*100).toFixed(1),"%"]})]})]})}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Geographic Shape Opacity: ",u,"%"]}),g.jsx("input",{type:"range",min:"0",max:"100",value:u,onChange:oe=>d(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${u}%, ${k.border} ${u}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Temporal Settings"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs",style:{color:k.accentPrimary},children:"Temporal Spacing Mode"}),g.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:k.containerBackground},children:[g.jsx("button",{onClick:()=>r("equal"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="equal"?k.accentPrimary:k.containerBackground,color:n==="equal"?k.background:k.text},children:"Equal"}),g.jsx("button",{onClick:()=>r("log"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="log"?k.accentPrimary:k.containerBackground,color:n==="log"?k.background:k.text},children:"Log"}),g.jsx("button",{onClick:()=>r("linear"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:n==="linear"?k.accentPrimary:k.containerBackground,color:n==="linear"?k.background:k.text},children:"Linear"})]}),g.jsxs("div",{className:"text-xs",style:{color:`${k.text}CC`},children:[n==="equal"&&g.jsx("div",{children:"• Time points are spaced equally"}),n==="log"&&g.jsx("div",{children:"• Time points are spaced logarithmically based on their actual values"}),n==="linear"&&g.jsx("div",{children:"• Time points are spaced according to their actual time values"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Temporal Spacing: ",t]}),g.jsx("input",{type:"range",min:"1",max:"50",value:t,onChange:oe=>e(Number(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${t/50*100}%, ${k.border} ${t/50*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Temporal Grid Opacity: ",o,"%"]}),g.jsx("input",{type:"range",min:"0",max:"100",value:o,onChange:oe=>l(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${o}%, ${k.border} ${o}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsx("h4",{className:"text-sm font-bold",style:{color:k.text},children:"Visual Settings"}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Spatial Spacing: ",i]}),g.jsx("input",{type:"range",min:"50",max:"500",value:i,onChange:oe=>s(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(i-50)/450*100}%, ${k.border} ${(i-50)/450*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Maximum Node Size: ",h]}),g.jsx("input",{type:"range",min:"5",max:"50",value:h,onChange:oe=>m(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(h-5)/45*100}%, ${k.border} ${(h-5)/45*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("label",{className:"text-xs",style:{color:k.accentPrimary},children:["Diff Edge Width: ",_]}),g.jsx("input",{type:"range",min:"1",max:"10",value:_,onChange:oe=>y(parseInt(oe.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${k.accentPrimary} 0%, ${k.accentPrimary} ${(_-1)/9*100}%, ${k.border} ${(_-1)/9*100}%, ${k.border} 100%)`,accentColor:k.accentPrimary}})]})]})]})]})},v4=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,Is={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,diffEdgeWidth:3,temporalSpacingMode:"equal"},qne=({firstFilename:t,secondFilename:e})=>{const{colors:n}=St(),r=cs(),[i,s]=j.useState(Is.temporalSpacing),[o,l]=j.useState(Is.spatialSpacing),[u,d]=j.useState(Is.temporalGridOpacity),[h,m]=j.useState(Is.geographicShapeOpacity),[_,y]=j.useState(Is.maxNodeRadius),[T,w]=j.useState(Is.diffEdgeWidth),[b,S]=j.useState(Is.temporalSpacingMode),[A,R]=j.useState(null),[E,C]=j.useState({target:[0,0,0],zoom:2.5,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[O,P]=j.useState(!0),[k,I]=j.useState(null),[N,L]=j.useState(null),[$,Z]=j.useState(null),{mode:V,setMode:q,currentShape:z,isLoading:Q,customShapeFile:oe,setCustomShapeFile:G,showCrsWarning:D,dismissCrsWarning:Y,updateFromCrsDetection:le}=zne();return j.useEffect(()=>{(async()=>{var F,X;if(!t||!e){I("Both tree sequences must be provided"),P(!1);return}try{P(!0),I(null);const[J,pe]=await Promise.all([tt.getGraphData(t),tt.getGraphData(e)]),ye=J.data,Ae=pe.data;if(!v4(ye)||!v4(Ae)){I("Both tree sequences must have spatial data"),P(!1);return}L(ye),Z(Ae);const Oe=(F=ye.metadata)==null?void 0:F.coordinate_system_detection,Ue=(X=Ae.metadata)==null?void 0:X.coordinate_system_detection;let Ee="unit_grid";Oe&&Ue&&Oe.likely_crs==="EPSG:4326"&&Ue.likely_crs==="EPSG:4326"&&(Ee="eastern_hemisphere"),le(Oe,Ue,Ee),P(!1)}catch{I("Failed to load tree sequences"),P(!1)}})()},[t,e]),O?g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:n.accentPrimary}})}):k?g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-lg mb-4",style:{color:`${n.text}`,opacity:.8,textShadow:"0 0 10px rgba(255, 0, 0, 0.5)"},children:k}),g.jsx("button",{onClick:()=>r("/"),className:"px-4 py-2 rounded",style:{backgroundColor:n.accentPrimary,color:n.background},children:"Return Home"})]})}):!N||!$?g.jsx("div",{className:"flex items-center justify-center h-full",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-lg mb-4",style:{color:`${n.text}`,opacity:.8,textShadow:"0 0 10px rgba(255, 0, 0, 0.5)"},children:"No data available"}),g.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:"Both tree sequences must contain spatial information for all nodes."})]})}):g.jsxs("div",{className:"relative w-full h-full",children:[g.jsx(Fne,{firstData:N,secondData:$,temporalSpacing:i,temporalSpacingMode:b,spatialSpacing:o,temporalGridOpacity:u,geographicShapeOpacity:h,maxNodeRadius:_,diffEdgeWidth:T,geographicMode:V,geographicShape:z}),g.jsx($ne,{temporalSpacing:i,onTemporalSpacingChange:s,temporalSpacingMode:b,onTemporalSpacingModeChange:S,spatialSpacing:o,onSpatialSpacingChange:l,temporalGridOpacity:u,onTemporalGridOpacityChange:d,geographicShapeOpacity:h,onGeographicShapeOpacityChange:m,maxNodeRadius:_,onMaxNodeRadiusChange:y,diffEdgeWidth:T,onDiffEdgeWidthChange:w,geographicMode:V,onGeographicModeChange:q,customShapeFile:oe,onCustomShapeFileChange:G,isLoadingGeographic:Q,currentShape:z,showCrsWarning:D,onDismissCrsWarning:Y})]})};function Vne(){const{filename:t}=i1(),e=cs(),{colors:n,setCurrentVisualizationType:r}=St(),i=j.useRef(null),[s,o]=j.useState(!1),[l,u]=j.useState(null),d=decodeURIComponent(t||""),[h]=HB(),m=h.get("second")||"";j.useEffect(()=>{r("spatial-diff")},[r]);const _=T=>{l==="first"?e(`/visualize-spatial-diff/${T.filename}?second=${d}`):l==="second"&&e(`/visualize-spatial-diff/${d}?second=${T.filename}`),o(!1),u(null)},y=async()=>{if(i.current)try{const T=`${d.replace(/\.(trees|tsz)$/,"")}_spatial_diff.png`,w={text:"ARGscape",subtext:d,position:"bottom-center",color:n.accentPrimary,backgroundColor:n.background+"CC"},b=i.current.querySelector("[data-3d-visualization]");if(b!=null&&b.getExportData){const A=b.getExportData(),R=i.current.querySelector('[data-deck="true"]'),E=R?{current:R}:null;try{await PO(A,E,{filename:T,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:n.exportBackground,scale:2,watermark:w}),console.log("High-resolution spatial diff image exported successfully");return}catch(C){console.warn("High-quality export failed, falling back to canvas capture:",C)}}const S=i.current.querySelector("canvas");if(!S)throw new Error("No canvas found for export");await DO(S,{filename:T,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:n.exportBackground,scale:2,watermark:w}),console.log("Spatial diff image captured from canvas")}catch(T){console.error("Error downloading spatial diff image:",T)}};return g.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:n.background,color:n.text},children:[g.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:n.background,borderBottomColor:n.border},children:g.jsxs("div",{className:"max-w-7xl mx-auto",children:[g.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[g.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:n.accentPrimary},onMouseEnter:T=>{T.currentTarget.style.opacity="0.8"},onMouseLeave:T=>{T.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),g.jsx(ko,{size:"medium"})]}),g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[g.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${n.text}B3`},children:"Spatial ARG Diff"}),g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:n.accentPrimary},children:d}),g.jsx("button",{onClick:()=>{u("first"),o(!0)},className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:T=>{T.currentTarget.style.borderColor=`${n.accentPrimary}66`,T.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:T=>{T.currentTarget.style.borderColor=`${n.accentPrimary}33`,T.currentTarget.style.backgroundColor=n.containerBackground},children:"Change"}),g.jsx(mc,{filename:d})]}),m&&g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:n.accentPrimary},children:m}),g.jsx("button",{onClick:()=>{u("second"),o(!0)},className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:T=>{T.currentTarget.style.borderColor=`${n.accentPrimary}66`,T.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:T=>{T.currentTarget.style.borderColor=`${n.accentPrimary}33`,T.currentTarget.style.backgroundColor=n.containerBackground},children:"Change"}),g.jsx(mc,{filename:m})]})]})]}),g.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[g.jsx(P1,{}),g.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:n.containerBackground,color:n.text},onMouseEnter:T=>{T.currentTarget.style.backgroundColor=n.accentPrimary,T.currentTarget.style.color=n.background},onMouseLeave:T=>{T.currentTarget.style.backgroundColor=n.containerBackground,T.currentTarget.style.color=n.text},onClick:y,title:"Download spatial diff visualization as PNG",children:"Download Image"})]})]})]})}),g.jsx("main",{className:"flex-1 overflow-hidden",children:g.jsx("div",{ref:i,className:"w-full h-full",children:g.jsx(qne,{firstFilename:d,secondFilename:m})})}),g.jsx(_c,{isOpen:s,onClose:()=>{o(!1),u(null)},onSelect:_})]})}function Hne(){return g.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 overflow-hidden pointer-events-none",children:g.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 1200 400",children:[g.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.3s_both]",children:[g.jsx("line",{x1:"200",y1:"30",x2:"200",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.4s_both]"}),g.jsx("line",{x1:"200",y1:"90",x2:"140",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.5s_both]"}),g.jsx("line",{x1:"200",y1:"90",x2:"260",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.55s_both]"}),g.jsx("line",{x1:"140",y1:"150",x2:"100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.6s_both]"}),g.jsx("line",{x1:"140",y1:"150",x2:"180",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.65s_both]"}),g.jsx("line",{x1:"260",y1:"150",x2:"220",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.7s_both]"}),g.jsx("line",{x1:"260",y1:"150",x2:"300",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.75s_both]"}),g.jsx("circle",{cx:"200",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_0.8s_both]"}),g.jsx("circle",{cx:"140",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.85s_both]"}),g.jsx("circle",{cx:"260",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.9s_both]"})]}),g.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.7s_both]",children:[g.jsx("line",{x1:"600",y1:"30",x2:"600",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.8s_both]"}),g.jsx("line",{x1:"600",y1:"90",x2:"540",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.9s_both]"}),g.jsx("line",{x1:"600",y1:"90",x2:"660",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.95s_both]"}),g.jsx("line",{x1:"540",y1:"150",x2:"500",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1s_both]"}),g.jsx("line",{x1:"540",y1:"150",x2:"580",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.05s_both]"}),g.jsx("line",{x1:"660",y1:"150",x2:"620",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.1s_both]"}),g.jsx("line",{x1:"660",y1:"150",x2:"700",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.15s_both]"}),g.jsx("circle",{cx:"600",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.2s_both]"}),g.jsx("circle",{cx:"540",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.25s_both]"}),g.jsx("circle",{cx:"660",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.3s_both]"})]}),g.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_1.1s_both]",children:[g.jsx("line",{x1:"1000",y1:"30",x2:"1000",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_1.2s_both]"}),g.jsx("line",{x1:"1000",y1:"90",x2:"940",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.3s_both]"}),g.jsx("line",{x1:"1000",y1:"90",x2:"1060",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.35s_both]"}),g.jsx("line",{x1:"940",y1:"150",x2:"900",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.4s_both]"}),g.jsx("line",{x1:"940",y1:"150",x2:"980",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.45s_both]"}),g.jsx("line",{x1:"1060",y1:"150",x2:"1020",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.5s_both]"}),g.jsx("line",{x1:"1060",y1:"150",x2:"1100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.55s_both]"}),g.jsx("circle",{cx:"1000",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.6s_both]"}),g.jsx("circle",{cx:"940",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.65s_both]"}),g.jsx("circle",{cx:"1060",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.7s_both]"})]}),g.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_1.5s_both]",children:[g.jsx("circle",{cx:"100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.7s_both]"}),g.jsx("circle",{cx:"180",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.75s_both]"}),g.jsx("circle",{cx:"220",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.8s_both]"}),g.jsx("circle",{cx:"300",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.85s_both]"}),g.jsx("circle",{cx:"500",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.9s_both]"}),g.jsx("circle",{cx:"580",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.95s_both]"}),g.jsx("circle",{cx:"620",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2s_both]"}),g.jsx("circle",{cx:"700",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.05s_both]"}),g.jsx("circle",{cx:"900",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.1s_both]"}),g.jsx("circle",{cx:"980",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.15s_both]"}),g.jsx("circle",{cx:"1020",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.2s_both]"}),g.jsx("circle",{cx:"1100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.25s_both]"})]}),g.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_2.3s_both]",children:[g.jsx("line",{x1:"400",y1:"20",x2:"400",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"}),g.jsx("line",{x1:"800",y1:"20",x2:"800",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"})]})]})})}function y4({onComplete:t,isTransitioning:e=!1}){const[n,r]=j.useState(!1),[i,s]=j.useState(!1);return j.useEffect(()=>{if(e){r(!0),s(!0);return}r(!0);const o=setTimeout(()=>{s(!0)},2300),l=setTimeout(()=>{t()},2600);return()=>{clearTimeout(o),clearTimeout(l)}},[t,e]),g.jsxs(g.Fragment,{children:[g.jsx("style",{children:`
        @keyframes drawLine {
          from { stroke-dasharray: 1000; stroke-dashoffset: 1000; }
          to { stroke-dasharray: 1000; stroke-dashoffset: 0; }
        }
        @keyframes drawPath {
          from { stroke-dasharray: 200; stroke-dashoffset: 200; }
          to { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInScale {
          from { opacity: 0; transform: scale(0); }
          to { opacity: 1; transform: scale(1); }
        }
      `}),g.jsxs("div",{className:`
        ${e?"absolute":"fixed"} inset-0 bg-sp-very-dark-blue flex items-center justify-center z-50
        transition-all duration-2000 ease-in-out
        ${i?"opacity-0":"opacity-100"}
      `,children:[g.jsx("div",{className:`
          transition-opacity duration-1000 ease-in-out
          ${e?"opacity-0":"opacity-100"}
        `,children:g.jsx(Hne,{})}),g.jsxs("div",{className:`
          transform transition-all duration-2000 ease-in-out relative z-10
          ${e?"scale-50 -translate-y-32":n?"scale-100 opacity-100":"scale-75 opacity-0"}
        `,children:[g.jsxs("h1",{className:"text-[6rem] md:text-[8rem] lg:text-[10rem] font-extrabold tracking-tight text-center select-none",style:{letterSpacing:"-0.04em"},children:[g.jsx("span",{className:"text-white",children:"ARG"}),g.jsx("span",{className:"text-sp-pale-green",children:"scape"})]}),g.jsx("div",{className:`
            mt-8 text-center transition-opacity duration-1000 ease-in-out
            ${e?"opacity-0":"opacity-100"}
          `,children:g.jsx("div",{className:"text-sp-pale-green text-2xl md:text-3xl lg:text-4xl font-bold",children:"Visualizing Ancestral Recombination Graphs"})})]})]})]})}function x4({onOptionSelect:t,isTransitioning:e=!1}){const[n,r]=j.useState([]),[i,s]=j.useState(!0),[o,l]=j.useState(!e);j.useEffect(()=>{(async()=>{try{Re.data.processing("fetch-available-tree-sequences","LandingPage");const m=(await tt.getUploadedFiles()).data;r(m.uploaded_tree_sequences||[])}catch(h){Re.error("Failed to fetch available tree sequences",{component:"LandingPage",error:h instanceof Error?h:new Error(String(h))}),r([])}finally{s(!1)}})()},[]),j.useEffect(()=>{if(e){const d=setTimeout(()=>{l(!0)},100);return()=>clearTimeout(d)}else l(!0)},[e]);const u=d=>{d==="load"&&n.length===0||t(d)};return g.jsxs("div",{className:`
      text-sp-white min-h-screen flex flex-col items-center justify-center px-4 font-sans
      ${e?"absolute inset-0 z-40":""}
    `,children:[g.jsxs("div",{className:`
        text-center mb-12 transition-all duration-2000 ease-in-out
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[g.jsx(ko,{size:"large",className:"mb-4"}),g.jsx("p",{className:"text-lg md:text-xl text-sp-white/70 mb-6",children:"Visualizing Ancestral Recombination Graphs"}),g.jsxs("a",{href:"/docs",className:"inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200 text-sm font-medium",children:["📖 View Documentation",g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),g.jsxs("div",{className:`
        w-full max-w-2xl space-y-4 transition-all duration-2000 ease-in-out delay-500
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[g.jsx("button",{onClick:()=>u("upload"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:g.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Upload a tree sequence"}),g.jsx("p",{className:"text-sp-white/60 text-sm",children:"Upload your own .trees or .tsz file to visualize"})]})]})}),g.jsx("button",{onClick:()=>u("simulate"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:g.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Simulate a tree sequence"}),g.jsx("p",{className:"text-sp-white/60 text-sm",children:"Generate new data using msprime simulation"})]})]})}),g.jsx("button",{onClick:()=>u("load"),disabled:n.length===0,className:`w-full border rounded-xl p-6 text-left transition-all duration-200 group ${n.length===0?"bg-sp-dark-blue/50 border-sp-pale-green/10 cursor-not-allowed opacity-50":"bg-sp-dark-blue hover:bg-sp-dark-blue/80 border-sp-pale-green/20 hover:border-sp-pale-green/40"}`,children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors duration-200 ${n.length===0?"bg-sp-pale-green/5":"bg-sp-pale-green/10 group-hover:bg-sp-pale-green/20"}`,children:g.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Load a tree sequence"}),g.jsxs("p",{className:"text-sp-white/60 text-sm",children:["Choose from existing uploaded sequences",i?g.jsx("span",{className:"ml-2",children:g.jsx("span",{className:"animate-pulse",children:"Loading..."})}):g.jsxs("span",{className:`ml-2 font-medium ${n.length===0?"text-red-400":"text-sp-pale-green"}`,children:["(",n.length," available)"]})]})]})]})})]}),g.jsx("div",{className:`
        bg-amber-900/15 border border-amber-700/25 rounded-lg p-3 mt-12 max-w-2xl mx-auto
        transition-all duration-2000 ease-in-out delay-1000
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:g.jsxs("p",{className:"text-amber-200 text-xs md:text-sm text-center leading-relaxed",children:[g.jsx("span",{className:"font-semibold",children:"⚠️ Beta Notice:"})," Tree sequences are stored on a secure server for up to 24 hours. This is a beta application and data may be wiped during updates. Please download your results and respect our limited resources."]})}),g.jsx("div",{className:`
        mt-8 text-center
        transition-all duration-2000 ease-in-out delay-1200
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `})]})}var zb={exports:{}},$b,b4;function Wne(){if(b4)return $b;b4=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return $b=t,$b}var qb,w4;function Xne(){if(w4)return qb;w4=1;var t=Wne();function e(){}function n(){}return n.resetWarningCache=e,qb=function(){function r(o,l,u,d,h,m){if(m!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:e};return s.PropTypes=s,s},qb}var T4;function Yne(){return T4||(T4=1,zb.exports=Xne()()),zb.exports}var Gne=Yne();const mt=t1(Gne);function aa(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(h){try{d(r.next(h))}catch(m){o(m)}}function u(h){try{d(r.throw(h))}catch(m){o(m)}}function d(h){h.done?s(h.value):i(h.value).then(l,u)}d((r=r.apply(t,e||[])).next())})}const Kne=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Ro(t,e,n){const r=Zne(t),{webkitRelativePath:i}=t,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${t.name}`;return typeof r.path!="string"&&S4(r,"path",s),S4(r,"relativePath",s),r}function Zne(t){const{name:e}=t;if(e&&e.lastIndexOf(".")!==-1&&!t.type){const r=e.split(".").pop().toLowerCase(),i=Kne.get(r);i&&Object.defineProperty(t,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return t}function S4(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!0})}const Qne=[".DS_Store","Thumbs.db"];function Jne(t){return aa(this,void 0,void 0,function*(){return vd(t)&&ere(t.dataTransfer)?ire(t.dataTransfer,t.type):tre(t)?nre(t):Array.isArray(t)&&t.every(e=>"getFile"in e&&typeof e.getFile=="function")?rre(t):[]})}function ere(t){return vd(t)}function tre(t){return vd(t)&&vd(t.target)}function vd(t){return typeof t=="object"&&t!==null}function nre(t){return K0(t.target.files).map(e=>Ro(e))}function rre(t){return aa(this,void 0,void 0,function*(){return(yield Promise.all(t.map(n=>n.getFile()))).map(n=>Ro(n))})}function ire(t,e){return aa(this,void 0,void 0,function*(){if(t.items){const n=K0(t.items).filter(i=>i.kind==="file");if(e!=="drop")return n;const r=yield Promise.all(n.map(sre));return E4(dj(r))}return E4(K0(t.files).map(n=>Ro(n)))})}function E4(t){return t.filter(e=>Qne.indexOf(e.name)===-1)}function K0(t){if(t===null)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];e.push(r)}return e}function sre(t){if(typeof t.webkitGetAsEntry!="function")return A4(t);const e=t.webkitGetAsEntry();return e&&e.isDirectory?hj(e):A4(t,e)}function dj(t){return t.reduce((e,n)=>[...e,...Array.isArray(n)?dj(n):[n]],[])}function A4(t,e){return aa(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof t.getAsFileSystemHandle=="function"){const s=yield t.getAsFileSystemHandle();if(s===null)throw new Error(`${t} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,Ro(o)}}const r=t.getAsFile();if(!r)throw new Error(`${t} is not a File`);return Ro(r,(n=e==null?void 0:e.fullPath)!==null&&n!==void 0?n:void 0)})}function are(t){return aa(this,void 0,void 0,function*(){return t.isDirectory?hj(t):ore(t)})}function hj(t){const e=t.createReader();return new Promise((n,r)=>{const i=[];function s(){e.readEntries(o=>aa(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(are));i.push(l),s()}else try{const l=yield Promise.all(i);n(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function ore(t){return aa(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.file(r=>{const i=Ro(r,t.fullPath);e(i)},r=>{n(r)})})})}var xf={},R4;function lre(){return R4||(R4=1,xf.__esModule=!0,xf.default=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(",");if(n.length===0)return!0;var r=t.name||"",i=(t.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return n.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0}),xf}var cre=lre();const Vb=t1(cre);function C4(t){return dre(t)||fre(t)||gj(t)||ure()}function ure(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function dre(t){if(Array.isArray(t))return Z0(t)}function N4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function k4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?N4(Object(n),!0).forEach(function(r){pj(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function pj(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Rc(t,e){return gre(t)||pre(t,e)||gj(t,e)||hre()}function hre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gj(t,e){if(t){if(typeof t=="string")return Z0(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z0(t,e)}}function Z0(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function pre(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function gre(t){if(Array.isArray(t))return t}var mre=typeof Vb=="function"?Vb:Vb.default,_re="file-invalid-type",vre="file-too-large",yre="file-too-small",xre="too-many-files",bre=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=e.split(","),r=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:_re,message:"File type must be ".concat(r)}},M4=function(e){return{code:vre,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},I4=function(e){return{code:yre,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},wre={code:xre,message:"Too many files"};function mj(t,e){var n=t.type==="application/x-moz-file"||mre(t,e);return[n,n?null:bre(e)]}function _j(t,e,n){if(Os(t.size))if(Os(e)&&Os(n)){if(t.size>n)return[!1,M4(n)];if(t.size<e)return[!1,I4(e)]}else{if(Os(e)&&t.size<e)return[!1,I4(e)];if(Os(n)&&t.size>n)return[!1,M4(n)]}return[!0,null]}function Os(t){return t!=null}function Tre(t){var e=t.files,n=t.accept,r=t.minSize,i=t.maxSize,s=t.multiple,o=t.maxFiles,l=t.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(u){var d=mj(u,n),h=Rc(d,1),m=h[0],_=_j(u,r,i),y=Rc(_,1),T=y[0],w=l?l(u):null;return m&&T&&!w})}function yd(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function bf(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function O4(t){t.preventDefault()}function Sre(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function Ere(t){return t.indexOf("Edge/")!==-1}function Are(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Sre(t)||Ere(t)}function zr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!yd(r)&&l&&l.apply(void 0,[r].concat(s)),yd(r)})}}function Rre(){return"showOpenFilePicker"in window}function Cre(t){if(Os(t)){var e=Object.entries(t).filter(function(n){var r=Rc(n,2),i=r[0],s=r[1],o=!0;return vj(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(yj))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(n,r){var i=Rc(r,2),s=i[0],o=i[1];return k4(k4({},n),{},pj({},s,o))},{});return[{description:"Files",accept:e}]}return t}function Nre(t){if(Os(t))return Object.entries(t).reduce(function(e,n){var r=Rc(n,2),i=r[0],s=r[1];return[].concat(C4(e),[i],C4(s))},[]).filter(function(e){return vj(e)||yj(e)}).join(",")}function kre(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function Mre(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}function vj(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||t==="application/*"||/\w+\/[-+.\w]+/g.test(t)}function yj(t){return/^.*\.[\w]+$/.test(t)}var Ire=["children"],Ore=["open"],Pre=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Dre=["refKey","onChange","onClick"];function jre(t){return Ure(t)||Bre(t)||xj(t)||Lre()}function Lre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Ure(t){if(Array.isArray(t))return Q0(t)}function Hb(t,e){return $re(t)||zre(t,e)||xj(t,e)||Fre()}function Fre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xj(t,e){if(t){if(typeof t=="string")return Q0(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q0(t,e)}}function Q0(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zre(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function $re(t){if(Array.isArray(t))return t}function P4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?P4(Object(n),!0).forEach(function(r){J0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function J0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xd(t,e){if(t==null)return{};var n=qre(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function qre(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var p2=j.forwardRef(function(t,e){var n=t.children,r=xd(t,Ire),i=Pf(r),s=i.open,o=xd(i,Ore);return j.useImperativeHandle(e,function(){return{open:s}},[s]),hc.createElement(j.Fragment,null,n(kt(kt({},o),{},{open:s})))});p2.displayName="Dropzone";var bj={disabled:!1,getFilesFromEvent:Jne,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};p2.defaultProps=bj;p2.propTypes={children:mt.func,accept:mt.objectOf(mt.arrayOf(mt.string)),multiple:mt.bool,preventDropOnDocument:mt.bool,noClick:mt.bool,noKeyboard:mt.bool,noDrag:mt.bool,noDragEventsBubbling:mt.bool,minSize:mt.number,maxSize:mt.number,maxFiles:mt.number,disabled:mt.bool,getFilesFromEvent:mt.func,onFileDialogCancel:mt.func,onFileDialogOpen:mt.func,useFsAccessApi:mt.bool,autoFocus:mt.bool,onDragEnter:mt.func,onDragLeave:mt.func,onDragOver:mt.func,onDrop:mt.func,onDropAccepted:mt.func,onDropRejected:mt.func,onError:mt.func,validator:mt.func};var e1={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Pf(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=kt(kt({},bj),t),n=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,u=e.maxFiles,d=e.onDragEnter,h=e.onDragLeave,m=e.onDragOver,_=e.onDrop,y=e.onDropAccepted,T=e.onDropRejected,w=e.onFileDialogCancel,b=e.onFileDialogOpen,S=e.useFsAccessApi,A=e.autoFocus,R=e.preventDropOnDocument,E=e.noClick,C=e.noKeyboard,O=e.noDrag,P=e.noDragEventsBubbling,k=e.onError,I=e.validator,N=j.useMemo(function(){return Nre(n)},[n]),L=j.useMemo(function(){return Cre(n)},[n]),$=j.useMemo(function(){return typeof b=="function"?b:D4},[b]),Z=j.useMemo(function(){return typeof w=="function"?w:D4},[w]),V=j.useRef(null),q=j.useRef(null),z=j.useReducer(Vre,e1),Q=Hb(z,2),oe=Q[0],G=Q[1],D=oe.isFocused,Y=oe.isFileDialogActive,le=j.useRef(typeof window<"u"&&window.isSecureContext&&S&&Rre()),ie=function(){!le.current&&Y&&setTimeout(function(){if(q.current){var ke=q.current.files;ke.length||(G({type:"closeDialog"}),Z())}},300)};j.useEffect(function(){return window.addEventListener("focus",ie,!1),function(){window.removeEventListener("focus",ie,!1)}},[q,Y,Z,le]);var F=j.useRef([]),X=function(ke){V.current&&V.current.contains(ke.target)||(ke.preventDefault(),F.current=[])};j.useEffect(function(){return R&&(document.addEventListener("dragover",O4,!1),document.addEventListener("drop",X,!1)),function(){R&&(document.removeEventListener("dragover",O4),document.removeEventListener("drop",X))}},[V,R]),j.useEffect(function(){return!r&&A&&V.current&&V.current.focus(),function(){}},[V,A,r]);var J=j.useCallback(function(be){k?k(be):console.error(be)},[k]),pe=j.useCallback(function(be){be.preventDefault(),be.persist(),Rt(be),F.current=[].concat(jre(F.current),[be.target]),bf(be)&&Promise.resolve(i(be)).then(function(ke){if(!(yd(be)&&!P)){var rt=ke.length,He=rt>0&&Tre({files:ke,accept:N,minSize:o,maxSize:s,multiple:l,maxFiles:u,validator:I}),Qe=rt>0&&!He;G({isDragAccept:He,isDragReject:Qe,isDragActive:!0,type:"setDraggedFiles"}),d&&d(be)}}).catch(function(ke){return J(ke)})},[i,d,J,P,N,o,s,l,u,I]),ye=j.useCallback(function(be){be.preventDefault(),be.persist(),Rt(be);var ke=bf(be);if(ke&&be.dataTransfer)try{be.dataTransfer.dropEffect="copy"}catch{}return ke&&m&&m(be),!1},[m,P]),Ae=j.useCallback(function(be){be.preventDefault(),be.persist(),Rt(be);var ke=F.current.filter(function(He){return V.current&&V.current.contains(He)}),rt=ke.indexOf(be.target);rt!==-1&&ke.splice(rt,1),F.current=ke,!(ke.length>0)&&(G({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),bf(be)&&h&&h(be))},[V,h,P]),Oe=j.useCallback(function(be,ke){var rt=[],He=[];be.forEach(function(Qe){var xt=mj(Qe,N),gn=Hb(xt,2),Kr=gn[0],vr=gn[1],Ft=_j(Qe,o,s),zt=Hb(Ft,2),kn=zt[0],yr=zt[1],Qn=I?I(Qe):null;if(Kr&&kn&&!Qn)rt.push(Qe);else{var we=[vr,yr];Qn&&(we=we.concat(Qn)),He.push({file:Qe,errors:we.filter(function(lt){return lt})})}}),(!l&&rt.length>1||l&&u>=1&&rt.length>u)&&(rt.forEach(function(Qe){He.push({file:Qe,errors:[wre]})}),rt.splice(0)),G({acceptedFiles:rt,fileRejections:He,isDragReject:He.length>0,type:"setFiles"}),_&&_(rt,He,ke),He.length>0&&T&&T(He,ke),rt.length>0&&y&&y(rt,ke)},[G,l,N,o,s,u,_,y,T,I]),Ue=j.useCallback(function(be){be.preventDefault(),be.persist(),Rt(be),F.current=[],bf(be)&&Promise.resolve(i(be)).then(function(ke){yd(be)&&!P||Oe(ke,be)}).catch(function(ke){return J(ke)}),G({type:"reset"})},[i,Oe,J,P]),Ee=j.useCallback(function(){if(le.current){G({type:"openDialog"}),$();var be={multiple:l,types:L};window.showOpenFilePicker(be).then(function(ke){return i(ke)}).then(function(ke){Oe(ke,null),G({type:"closeDialog"})}).catch(function(ke){kre(ke)?(Z(ke),G({type:"closeDialog"})):Mre(ke)?(le.current=!1,q.current?(q.current.value=null,q.current.click()):J(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):J(ke)});return}q.current&&(G({type:"openDialog"}),$(),q.current.value=null,q.current.click())},[G,$,Z,S,Oe,J,L,l]),Te=j.useCallback(function(be){!V.current||!V.current.isEqualNode(be.target)||(be.key===" "||be.key==="Enter"||be.keyCode===32||be.keyCode===13)&&(be.preventDefault(),Ee())},[V,Ee]),Ne=j.useCallback(function(){G({type:"focus"})},[]),Pe=j.useCallback(function(){G({type:"blur"})},[]),Kt=j.useCallback(function(){E||(Are()?setTimeout(Ee,0):Ee())},[E,Ee]),Me=function(ke){return r?null:ke},nn=function(ke){return C?null:Me(ke)},Mt=function(ke){return O?null:Me(ke)},Rt=function(ke){P&&ke.stopPropagation()},Ke=j.useMemo(function(){return function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ke=be.refKey,rt=ke===void 0?"ref":ke,He=be.role,Qe=be.onKeyDown,xt=be.onFocus,gn=be.onBlur,Kr=be.onClick,vr=be.onDragEnter,Ft=be.onDragOver,zt=be.onDragLeave,kn=be.onDrop,yr=xd(be,Pre);return kt(kt(J0({onKeyDown:nn(zr(Qe,Te)),onFocus:nn(zr(xt,Ne)),onBlur:nn(zr(gn,Pe)),onClick:Me(zr(Kr,Kt)),onDragEnter:Mt(zr(vr,pe)),onDragOver:Mt(zr(Ft,ye)),onDragLeave:Mt(zr(zt,Ae)),onDrop:Mt(zr(kn,Ue)),role:typeof He=="string"&&He!==""?He:"presentation"},rt,V),!r&&!C?{tabIndex:0}:{}),yr)}},[V,Te,Ne,Pe,Kt,pe,ye,Ae,Ue,C,O,r]),rn=j.useCallback(function(be){be.stopPropagation()},[]),Ye=j.useMemo(function(){return function(){var be=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ke=be.refKey,rt=ke===void 0?"ref":ke,He=be.onChange,Qe=be.onClick,xt=xd(be,Dre),gn=J0({accept:N,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Me(zr(He,Ue)),onClick:Me(zr(Qe,rn)),tabIndex:-1},rt,q);return kt(kt({},gn),xt)}},[q,n,l,Ue,r]);return kt(kt({},oe),{},{isFocused:D&&!r,getRootProps:Ke,getInputProps:Ye,rootRef:V,inputRef:q,open:Me(Ee)})}function Vre(t,e){switch(e.type){case"focus":return kt(kt({},t),{},{isFocused:!0});case"blur":return kt(kt({},t),{},{isFocused:!1});case"openDialog":return kt(kt({},e1),{},{isFileDialogActive:!0});case"closeDialog":return kt(kt({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":return kt(kt({},t),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return kt(kt({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return kt({},e1);default:return t}}function D4(){}function Hre({onUploadComplete:t,setLoading:e}){const[n,r]=j.useState(null),[i,s]=j.useState("none"),[o,l]=j.useState({sampleLocations:null,nodeLocations:null}),[u,d]=j.useState({}),h=j.useCallback(P=>{P.length>0&&(r(P[0]),s("none"),l({sampleLocations:null,nodeLocations:null}),d({}))},[]),{getRootProps:m,getInputProps:_,isDragActive:y}=Pf({onDrop:h,multiple:!1,accept:jg.ACCEPTED_FORMATS}),T=j.useCallback(P=>{P.length>0&&l(k=>({...k,sampleLocations:P[0]}))},[]),w=Pf({onDrop:T,multiple:!1,accept:jg.CSV_FORMATS}),b=j.useCallback(P=>{P.length>0&&l(k=>({...k,nodeLocations:P[0]}))},[]),S=Pf({onDrop:b,multiple:!1,accept:jg.CSV_FORMATS}),A=async()=>{if(n){e(!0);try{Re.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone");const P=await tt.uploadTreeSequence(n);Re.info("File upload completed successfully",{component:"Dropzone",data:{filename:n.name,result:P}}),t&&t(P.data)}catch(P){Re.error("File upload failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.name}}),alert(`Upload failed: ${P instanceof Error?P.message:"Unknown error"}`)}finally{e(!1)}}},R=()=>{s("add-locations")},E=async(P,k)=>{try{const I=await tt.uploadLocationCSV(P,k);return d(N=>({...N,[k]:I.data.filename})),I.data.filename}catch(I){throw Re.error("CSV upload failed",{component:"Dropzone",error:I instanceof Error?I:new Error(String(I)),data:{filename:P.name,csvType:k}}),I}},C=async()=>{if(!(!n||!o.sampleLocations||!o.nodeLocations)){e(!0);try{Re.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone"),await tt.uploadTreeSequence(n);let P=u.sample_locations,k=u.node_locations;if(!P&&o.sampleLocations&&(P=await E(o.sampleLocations,"sample_locations")),!k&&o.nodeLocations&&(k=await E(o.nodeLocations,"node_locations")),!P||!k)throw new Error("Failed to upload CSV files");console.log("Starting tree sequence update...");const I=await tt.updateTreeSequenceLocations({tree_sequence_filename:n.name,sample_locations_filename:P,node_locations_filename:k});console.log("Tree sequence update completed:",I),Re.info("Tree sequence updated with custom locations",{component:"Dropzone",data:{originalFilename:n.name,newFilename:I.data.new_filename}}),t&&(console.log("Calling onUploadComplete with:",I.data),t(I.data))}catch(P){Re.error("Tree sequence update failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.name}}),alert(`Update failed: ${P instanceof Error?P.message:"Unknown error"}`)}finally{e(!1)}}},O=n&&o.sampleLocations&&o.nodeLocations;return g.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[g.jsxs("div",{...m(),className:`w-full h-48 border-2 border-dashed rounded-xl flex items-center justify-center text-xl transition-colors cursor-pointer select-none
          ${y?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[g.jsx("input",{..._()}),n?g.jsx("span",{className:"truncate max-w-full px-2",children:n.name}):y?g.jsx("span",{children:"Drop the file here…"}):g.jsxs("span",{className:"text-center",children:["Drag and drop to select a file",g.jsx("br",{}),g.jsx("span",{className:"text-base text-sp-pale-green",children:"or click to browse"}),g.jsx("br",{}),g.jsx("span",{className:"text-sm text-sp-very-pale-green mt-1",children:"Supported formats: .trees, .tsz"})]})]}),n&&i==="none"&&g.jsxs("div",{className:"w-full flex flex-col gap-3",children:[g.jsxs("button",{type:"button",onClick:A,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Load as-is"]}),g.jsxs("button",{type:"button",onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[g.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Add locations"]})]}),i==="add-locations"&&g.jsxs("div",{className:"w-full space-y-4",children:[g.jsx("div",{className:"text-center text-sp-white/70 text-sm mb-4",children:"Upload CSV files with node locations (required columns: node_id, x, y, z)"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Sample Locations"}),g.jsxs("div",{...w.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${w.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[g.jsx("input",{...w.getInputProps()}),o.sampleLocations?g.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.sampleLocations.name}):w.isDragActive?g.jsx("span",{children:"Drop CSV here…"}):g.jsx("span",{children:"Click or drag CSV with sample locations"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Node Locations"}),g.jsxs("div",{...S.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${S.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[g.jsx("input",{...S.getInputProps()}),o.nodeLocations?g.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.nodeLocations.name}):S.isDragActive?g.jsx("span",{children:"Drop CSV here…"}):g.jsx("span",{children:"Click or drag CSV with node locations"})]})]}),g.jsxs("button",{type:"button",onClick:C,disabled:!O,className:`w-full font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 ${O?"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue transform hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Update Tree Sequence"]}),g.jsxs("button",{type:"button",onClick:()=>{s("none"),l({sampleLocations:null,nodeLocations:null}),d({})},className:"w-full bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}const Ht={num_samples:25,sequence_length:1e6,max_time:100,model:"dtwf",filename_prefix:"simulated",crs:"EPSG:4326",ploidy:2,mutation_rate:1e-8,recombination_rate:1e-8},wj=t=>{switch(t){case"dtwf":return"dtwf";case"hudson":return"hud";case"smc":return"smc";case"smc_prime":return"smcp";default:return t.slice(0,4)}},Tj=t=>{switch(t){case"EPSG:4326":return"4326";case"unit_grid":return"ug";case"EPSG:3857":return"3857";default:return t.replace(/[^a-zA-Z0-9]/g,"").slice(0,4)}},Wre=t=>{const e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),r=String(t.getFullYear()).slice(-2),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}${n}${r}${i}${s}`},Wb=(t,e,n=!1)=>{const r=wj(t.model||"dtwf"),i=Tj(t.crs||"EPSG:4326"),o=`r${e??Math.floor(Math.random()*1e3)}`;let l=`s${t.num_samples}_m${r}_t${t.sequence_length}_p${t.ploidy}_c${i}_${o}`;if(n){const d=Wre(new Date);l+=`_d${d}`}return l},eo=t=>t.toExponential(8),to=t=>t>=1e6?`${(t/1e6).toFixed(1)}Mb`:t>=1e3?`${(t/1e3).toFixed(1)}kb`:`${t}bp`,j4=t=>{const e=t.toLowerCase().trim();return e.endsWith("mb")?Math.round(parseFloat(e.slice(0,-2))*1e6):e.endsWith("kb")?Math.round(parseFloat(e.slice(0,-2))*1e3):e.endsWith("bp")?Math.round(parseFloat(e.slice(0,-2))):Math.round(parseFloat(e))};function Xre({onSimulationComplete:t,setLoading:e}){var C,O,P,k,I;const[n,r]=j.useState({...Ht,filename_prefix:Wb(Ht)}),[i,s]=j.useState(!1),[o,l]=j.useState(!0),[u,d]=j.useState(!1),[h,m]=j.useState({num_samples:Ht.num_samples.toString(),sequence_length:to(Ht.sequence_length),max_time:Ht.max_time.toString(),ploidy:((C=Ht.ploidy)==null?void 0:C.toString())||"2",random_seed:((O=Ht.random_seed)==null?void 0:O.toString())||"42",population_size:((P=Ht.population_size)==null?void 0:P.toString())||"",mutation_rate:((k=Ht.mutation_rate)==null?void 0:k.toString())||eo(Ht.mutation_rate),recombination_rate:((I=Ht.recombination_rate)==null?void 0:I.toString())||eo(Ht.recombination_rate)}),_=(N,L)=>{r($=>({...$,[N]:L}))},y=(N,L)=>{m($=>({...$,[N]:L}))},T=(N,L,$,Z,V)=>{if(y(N,L),L==="")return;const q=parseInt(L);isNaN(q)||_(N,q)},w=(N,L,$,Z,V)=>{const q=parseInt(L);let z=V;isNaN(q)||(z=Math.max($,Math.min(Z,q))),_(N,z),y(N,z.toString())},b=N=>{N.key==="Enter"&&(N.preventDefault(),E())},S=N=>{m(L=>({...L,sequence_length:N}));try{const L=j4(N);!isNaN(L)&&L>0&&r($=>({...$,sequence_length:L}))}catch{}},A=N=>{try{const L=j4(N);isNaN(L)||L<=0?(m($=>({...$,sequence_length:to(Ht.sequence_length)})),r($=>({...$,sequence_length:Ht.sequence_length}))):(m($=>({...$,sequence_length:to(L)})),r($=>({...$,sequence_length:L})))}catch{m($=>({...$,sequence_length:to(Ht.sequence_length)})),r($=>({...$,sequence_length:Ht.sequence_length}))}},R=()=>o?Wb(n,i?n.random_seed:void 0):n.filename_prefix,E=async()=>{e(!0);try{Re.user.action("simulate-start",{params:n},"TreeSequenceSimulator");const N={...n,population_size:n.num_samples*(n.ploidy??2),random_seed:i?n.random_seed:void 0,filename_prefix:o?Wb(n,i?n.random_seed:void 0,!0):n.filename_prefix},L=await tt.simulateTreeSequence(N),Z={...(await tt.getTreeSequenceMetadata(L.data.filename)).data,num_mutations:L.data.num_mutations,crs:L.data.crs};Re.info("Tree sequence simulation completed successfully",{component:"TreeSequenceSimulator",data:{params:N,result:L,metadata:Z}}),t&&t(Z)}catch(N){Re.error("Tree sequence simulation failed",{component:"TreeSequenceSimulator",error:N instanceof Error?N:new Error(String(N)),data:{params:n}}),alert(`Simulation failed: ${N instanceof Error?N.message:"Unknown error"}`)}finally{e(!1)}};return g.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[g.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5",children:[g.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:g.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Simulation Parameters"}),g.jsx("p",{className:"text-sp-white/60 text-xs",children:"Configure the tree sequence simulation settings"})]})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sample individuals"}),g.jsx("input",{type:"number",min:"2",max:"500",value:h.num_samples,onChange:N=>T("num_samples",N.target.value),onBlur:N=>w("num_samples",N.target.value,2,500,2),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),g.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Range: 2-500"})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Ploidy"}),g.jsx("input",{type:"number",min:"1",max:"10",value:h.ploidy,onChange:N=>T("ploidy",N.target.value),onBlur:N=>w("ploidy",N.target.value,1,10,2),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),g.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-10 (2=diploid)"})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sequence Length (e.g., 1Mb, 100kb, 1000bp)"}),g.jsx("input",{type:"text",value:h.sequence_length,onChange:N=>S(N.target.value),onBlur:N=>A(N.target.value),className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),g.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:to(n.sequence_length)})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Max generations"}),g.jsx("input",{type:"number",min:"1",max:"1000",value:h.max_time,onChange:N=>T("max_time",N.target.value),onBlur:N=>w("max_time",N.target.value,1,1e3,1),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),g.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Model"}),g.jsxs("select",{value:n.model||"dtwf",onChange:N=>_("model",N.target.value),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[g.jsx("option",{value:"dtwf",children:"Discrete Wright-Fisher"}),g.jsx("option",{value:"hudson",children:"Hudson"}),g.jsx("option",{value:"smc",children:"SMC"}),g.jsx("option",{value:"smc_prime",children:"SMC'"})]})]}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Coordinate System"}),g.jsxs("select",{value:n.crs||"EPSG:4326",onChange:N=>_("crs",N.target.value),onKeyDown:b,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[g.jsx("option",{value:"EPSG:4326",children:"WGS84 Geographic"}),g.jsx("option",{value:"unit_grid",children:"Unit Grid (0-1)"}),g.jsx("option",{value:"EPSG:3857",children:"Web Mercator"})]}),g.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Spatial coordinate system"})]})]})]}),g.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[g.jsxs("div",{className:"bg-sp-pale-green/10 border border-sp-pale-green/30 rounded-lg p-3",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/20 rounded flex items-center justify-center",children:g.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),g.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Population Summary"})]}),g.jsxs("div",{className:"text-sm text-sp-white",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{children:"Total haplotypes:"}),g.jsx("span",{className:"font-bold text-sp-pale-green",children:n.num_samples*(n.ploidy??2)})]}),g.jsxs("div",{className:"text-xs text-sp-white/60",children:[n.num_samples," individuals × ",n.ploidy??2," ploidy"]})]})]}),g.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[g.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:g.jsx("svg",{className:"w-3 h-3 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),g.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Output Filename"})]}),g.jsxs("div",{className:"text-sm text-sp-white",children:[g.jsx("div",{className:"font-mono text-sp-pale-green break-all text-xs",children:R()}),g.jsx("div",{className:"text-xs text-sp-white/60",children:o?g.jsx("button",{onClick:()=>d(!0),className:"underline hover:text-sp-pale-green transition-colors cursor-pointer",children:"Auto-generated from parameters"}):"Custom filename"})]})]})]}),g.jsx("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl overflow-hidden",children:g.jsxs("details",{className:"group",children:[g.jsx("summary",{className:"px-5 py-3 cursor-pointer hover:bg-sp-pale-green/5 transition-colors duration-200 border-b border-sp-pale-green/10 group-open:border-b-0 list-none",children:g.jsx("div",{className:"flex items-center justify-between",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:g.jsx("svg",{className:"w-3 h-3 text-sp-pale-green transition-transform duration-200 group-open:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),g.jsx("span",{className:"font-medium text-sp-white text-sm",children:"Advanced Options"})]})})}),g.jsxs("div",{className:"px-5 py-3 space-y-3 bg-sp-very-dark-blue/50",children:[g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"useAutoFilename",checked:o,onChange:N=>l(N.target.checked),onKeyDown:b,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),g.jsx("label",{htmlFor:"useAutoFilename",className:"text-sm font-medium text-sp-white",children:"Auto-generate filename"})]}),!o&&g.jsxs("div",{className:"ml-6",children:[g.jsx("label",{className:"text-sm font-medium text-sp-white mb-1 block",children:"Custom filename prefix"}),g.jsx("input",{type:"text",value:n.filename_prefix,onChange:N=>_("filename_prefix",N.target.value),onKeyDown:b,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"simulated"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center",children:[g.jsx("input",{type:"checkbox",id:"useCustomSeed",checked:i,onChange:N=>s(N.target.checked),onKeyDown:b,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),g.jsx("label",{htmlFor:"useCustomSeed",className:"text-sm font-medium text-sp-white",children:"Use custom random seed"})]}),i?g.jsx("div",{className:"ml-6",children:g.jsx("input",{type:"number",value:h.random_seed,onChange:N=>{const L=N.target.value;if(y("random_seed",L),L!==""){const $=parseInt(L);isNaN($)||_("random_seed",$)}},onBlur:N=>{const L=parseInt(N.target.value),$=isNaN(L)?42:L;_("random_seed",$),y("random_seed",$.toString())},onKeyDown:b,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"42"})}):g.jsx("div",{className:"ml-6 text-xs text-sp-white/60",children:"Random seed will be generated automatically"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{htmlFor:"population-size",className:"block text-sm font-medium text-sp-white/80",children:"Population Size (optional)"}),g.jsx("input",{type:"number",id:"population-size",value:h.population_size,onChange:N=>T("population_size",N.target.value),onBlur:N=>w("population_size",N.target.value,1,1e6,1e3),className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green",placeholder:"1000"}),g.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1000 (effective population size)"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80",children:"Mutation Rate (per base pair per generation)"}),g.jsx("input",{type:"text",id:"mutation-rate",value:h.mutation_rate,onChange:N=>{m($=>({...$,mutation_rate:N.target.value}));const L=parseFloat(N.target.value);!isNaN(L)&&L>0&&r($=>({...$,mutation_rate:L}))},onBlur:N=>{const L=parseFloat(N.target.value);isNaN(L)||L<=0?(m($=>({...$,mutation_rate:eo(Ht.mutation_rate)})),r($=>({...$,mutation_rate:Ht.mutation_rate}))):(m($=>({...$,mutation_rate:eo(L)})),r($=>({...$,mutation_rate:L})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),g.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{htmlFor:"recombination-rate",className:"block text-sm font-medium text-sp-white/80",children:"Recombination Rate (per base pair per generation)"}),g.jsx("input",{type:"text",id:"recombination-rate",value:h.recombination_rate,onChange:N=>{m($=>({...$,recombination_rate:N.target.value}));const L=parseFloat(N.target.value);!isNaN(L)&&L>0&&r($=>({...$,recombination_rate:L}))},onBlur:N=>{const L=parseFloat(N.target.value);isNaN(L)||L<=0?(m($=>({...$,recombination_rate:eo(Ht.recombination_rate)})),r($=>({...$,recombination_rate:Ht.recombination_rate}))):(m($=>({...$,recombination_rate:eo(L)})),r($=>({...$,recombination_rate:L})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),g.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]})]})]})}),g.jsx("div",{className:"flex justify-center pt-2",children:g.jsxs("button",{type:"button",onClick:E,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[g.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Simulate Tree Sequence"]})}),u&&g.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:g.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/30 rounded-xl p-5 max-w-lg w-full shadow-2xl",children:[g.jsxs("div",{className:"flex justify-between items-start mb-3",children:[g.jsx("h3",{className:"text-lg font-bold text-sp-white",children:"Filename Format Explained"}),g.jsx("button",{onClick:()=>d(!1),className:"text-sp-white/60 hover:text-sp-white transition-colors text-2xl leading-none",children:"×"})]}),g.jsxs("div",{className:"space-y-3 text-sm text-sp-white",children:[g.jsx("div",{className:"font-mono text-sm text-sp-pale-green bg-sp-dark-blue rounded-lg p-3 break-all",children:R()}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["s",n.num_samples]})," - Sample individuals (2-500)"]}),g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["m",wj(n.model||"dtwf")]})," - Model (dtwf, hud, smc, smcp)"]}),g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["t",n.sequence_length]})," - Sequence Length (",to(n.sequence_length),")"]}),g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["g",n.max_time]})," - Max generations (1-1000)"]}),g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["p",n.ploidy??2]})," - Ploidy (1-4)"]}),g.jsxs("div",{children:[g.jsxs("span",{className:"font-bold text-sp-pale-green",children:["c",Tj(n.crs||"EPSG:4326")]})," - Coordinate system"]}),g.jsxs("div",{children:[g.jsx("span",{className:"font-bold text-sp-pale-green",children:"r###"})," - Random seed (0-999)"]}),g.jsxs("div",{children:[g.jsx("span",{className:"font-bold text-sp-pale-green",children:"d##########"})," - Timestamp (MMDDYYHHMM)"]})]})]}),g.jsx("button",{onClick:()=>d(!1),className:"w-full mt-4 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white font-medium py-2.5 rounded-lg transition-colors duration-200",children:"Close"})]})})]})}function Yre({selectedOption:t,onBack:e}){const n=cs(),[r,i]=j.useState(!1),[s,o]=j.useState(0),{setTreeSequence:l}=Qs();j.useEffect(()=>{if(r){const T=setInterval(()=>{o(w=>(w+1)%4)},XB.LOADING_DOTS_INTERVAL);return()=>clearInterval(T)}else o(0)},[r]);const u=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},d=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},h=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},m=()=>{switch(t){case"upload":return"Upload a Tree Sequence";case"simulate":return"Simulate a Tree Sequence";case"load":return"Load a Tree Sequence";default:return""}},_=()=>{switch(t){case"upload":return"Upload your own .trees file to visualize";case"simulate":return"Generate new data using msprime simulation";case"load":return"Choose from existing uploaded sequences";default:return""}},y=()=>{if(r)return g.jsxs("div",{className:"flex flex-col items-center text-xl text-sp-white space-y-4",children:[g.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sp-pale-green"}),g.jsxs("span",{children:["Processing",Array(s+1).join(".")]})]});switch(t){case"upload":return g.jsx(Hre,{onUploadComplete:u,setLoading:i});case"simulate":return g.jsx(Xre,{onSimulationComplete:h,setLoading:i});case"load":return g.jsx(iI,{onSelect:d});default:return null}};return g.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[g.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[g.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[g.jsxs("button",{onClick:e,className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",children:[g.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:g.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to options"]}),g.jsx(ko,{size:"medium"})]}),g.jsxs("div",{className:"text-center mb-8",children:[g.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:m()}),g.jsx("p",{className:"text-sp-white/70 text-lg",children:_()})]})]}),g.jsx("div",{className:"max-w-7xl mx-auto",children:g.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:g.jsx("div",{className:"p-8 min-h-[600px] flex items-start justify-center",children:y()})})})]})}const Sj="argscape_first_visit",Gre=()=>{try{return!sessionStorage.getItem(Sj)}catch{return!0}},Kre=()=>{try{sessionStorage.setItem(Sj,"true")}catch{console.warn("Session storage not available")}};function ql({children:t}){return g.jsxs(g.Fragment,{children:[g.jsx("main",{children:t}),g.jsx(aq,{})]})}function Zre(){const t=No(),[e,n]=j.useState("intro"),[r,i]=j.useState(null),[s,o]=j.useState(!1),[l,u]=j.useState([]),[d,h]=j.useState(!1),[m,_]=j.useState(!1),[y,T]=j.useState(!1);j.useEffect(()=>{d||(async()=>{var R;try{Re.data.processing("fetch-available-tree-sequences","Home");const C=(await tt.getUploadedFiles()).data;u(C.uploaded_tree_sequences||[]),Re.info(`Found ${((R=C.uploaded_tree_sequences)==null?void 0:R.length)||0} available tree sequences for animation logic`,{component:"Home"})}catch(E){Re.error("Failed to fetch available tree sequences",{component:"Home",error:E instanceof Error?E:new Error(String(E))}),u([])}finally{h(!0)}})()},[d]),j.useEffect(()=>{var P,k,I,N;if(!d)return;const A=(P=t.state)==null?void 0:P.fromInternal,R=(k=t.state)==null?void 0:k.fromResult,E=(I=t.state)==null?void 0:I.selectedOption,C=(N=t.state)==null?void 0:N.forceIntro;R&&E?(i(E),n("intermediate"),o(!1)):(l.length>0||R&&E||A?!1:(C||Gre(),!0))?(o(!0),n("intro"),i(null),Kre()):(n("landing"),o(!1),i(null))},[t.state,d,l.length]);const w=()=>{T(!0),n("transitioning"),setTimeout(()=>{n("landing"),o(!1),T(!1)},2e3)},b=A=>{i(A),n("intermediate")},S=()=>{i(null),n("landing")};return g.jsxs("div",{className:"bg-sp-very-dark-blue min-h-screen",children:[s&&e==="intro"&&g.jsx(y4,{onComplete:w}),e==="transitioning"&&g.jsxs("div",{className:"relative min-h-screen",children:[g.jsx(y4,{onComplete:w,isTransitioning:!0}),g.jsx(x4,{onOptionSelect:b,isTransitioning:!0})]}),e==="landing"&&g.jsx(x4,{onOptionSelect:b}),e==="intermediate"&&r&&g.jsx(Yre,{selectedOption:r,onBack:S})]})}function Qre(){return g.jsx(ZB,{children:g.jsx(YB,{children:g.jsx(VB,{children:g.jsxs(FB,{children:[g.jsx(no,{path:"/",element:g.jsx(ql,{children:g.jsx(Zre,{})})}),g.jsx(no,{path:"/result",element:g.jsx(ql,{children:g.jsx(nU,{})})}),g.jsx(no,{path:"/visualize/:filename",element:g.jsx(ql,{children:g.jsx(sq,{})})}),g.jsx(no,{path:"/visualize-spatial/:filename",element:g.jsx(ql,{children:g.jsx(Cne,{})})}),g.jsx(no,{path:"/visualize-spatial-diff/:filename",element:g.jsx(ql,{children:g.jsx(Vne,{})})})]})})})})}XL.createRoot(document.getElementById("root")).render(g.jsx(Qre,{}));
