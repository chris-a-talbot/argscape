var bB=Object.defineProperty;var xB=(t,e,n)=>e in t?bB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var D=(t,e,n)=>xB(t,typeof e!="symbol"?e+"":e,n);function wB(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Bu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hg={exports:{}},_l={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F3;function TB(){if(F3)return _l;F3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return _l.Fragment=e,_l.jsx=n,_l.jsxs=n,_l}var z3;function SB(){return z3||(z3=1,hg.exports=TB()),hg.exports}var m=SB(),pg={exports:{}},vl={},gg={exports:{}},mg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V3;function EB(){return V3||(V3=1,function(t){function e(V,$){var Y=V.length;V.push($);e:for(;0<Y;){var ue=Y-1>>>1,P=V[ue];if(0<i(P,$))V[ue]=$,V[Y]=P,Y=ue;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var $=V[0],Y=V.pop();if(Y!==$){V[0]=Y;e:for(var ue=0,P=V.length,H=P>>>1;ue<H;){var ie=2*(ue+1)-1,re=V[ie],U=ie+1,Z=V[U];if(0>i(re,Y))U<P&&0>i(Z,re)?(V[ue]=Z,V[U]=Y,ue=U):(V[ue]=re,V[ie]=Y,ue=ie);else if(U<P&&0>i(Z,Y))V[ue]=Z,V[U]=Y,ue=U;else break e}}return $}function i(V,$){var Y=V.sortIndex-$.sortIndex;return Y!==0?Y:V.id-$.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var u=[],d=[],h=1,g=null,_=3,y=!1,T=!1,w=!1,x=!1,S=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function A(V){for(var $=n(d);$!==null;){if($.callback===null)r(d);else if($.startTime<=V)r(d),$.sortIndex=$.expirationTime,e(u,$);else break;$=n(d)}}function k(V){if(w=!1,A(V),!T)if(n(u)!==null)T=!0,O||(O=!0,X());else{var $=n(d);$!==null&&J(k,$.startTime-V)}}var O=!1,j=-1,N=5,I=-1;function M(){return x?!0:!(t.unstable_now()-I<N)}function q(){if(x=!1,O){var V=t.unstable_now();I=V;var $=!0;try{e:{T=!1,w&&(w=!1,R(j),j=-1),y=!0;var Y=_;try{t:{for(A(V),g=n(u);g!==null&&!(g.expirationTime>V&&M());){var ue=g.callback;if(typeof ue=="function"){g.callback=null,_=g.priorityLevel;var P=ue(g.expirationTime<=V);if(V=t.unstable_now(),typeof P=="function"){g.callback=P,A(V),$=!0;break t}g===n(u)&&r(u),A(V)}else r(u);g=n(u)}if(g!==null)$=!0;else{var H=n(d);H!==null&&J(k,H.startTime-V),$=!1}}break e}finally{g=null,_=Y,y=!1}$=void 0}}finally{$?X():O=!1}}}var X;if(typeof E=="function")X=function(){E(q)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,L=G.port2;G.port1.onmessage=q,X=function(){L.postMessage(null)}}else X=function(){S(q,0)};function J(V,$){j=S(function(){V(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(V){switch(_){case 1:case 2:case 3:var $=3;break;default:$=_}var Y=_;_=$;try{return V()}finally{_=Y}},t.unstable_requestPaint=function(){x=!0},t.unstable_runWithPriority=function(V,$){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var Y=_;_=V;try{return $()}finally{_=Y}},t.unstable_scheduleCallback=function(V,$,Y){var ue=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ue+Y:ue):Y=ue,V){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=Y+P,V={id:h++,callback:$,priorityLevel:V,startTime:Y,expirationTime:P,sortIndex:-1},Y>ue?(V.sortIndex=Y,e(d,V),n(u)===null&&V===n(d)&&(w?(R(j),j=-1):w=!0,J(k,Y-ue))):(V.sortIndex=P,e(u,V),T||y||(T=!0,O||(O=!0,X()))),V},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(V){var $=_;return function(){var Y=_;_=$;try{return V.apply(this,arguments)}finally{_=Y}}}}(mg)),mg}var q3;function AB(){return q3||(q3=1,gg.exports=EB()),gg.exports}var _g={exports:{}},Be={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $3;function RB(){if($3)return Be;$3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.iterator;function _(P){return P===null||typeof P!="object"?null:(P=g&&P[g]||P["@@iterator"],typeof P=="function"?P:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function x(P,H,ie){this.props=P,this.context=H,this.refs=w,this.updater=ie||y}x.prototype.isReactComponent={},x.prototype.setState=function(P,H){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,H,"setState")},x.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function S(){}S.prototype=x.prototype;function R(P,H,ie){this.props=P,this.context=H,this.refs=w,this.updater=ie||y}var E=R.prototype=new S;E.constructor=R,T(E,x.prototype),E.isPureReactComponent=!0;var A=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function j(P,H,ie,re,U,Z){return ie=Z.ref,{$$typeof:t,type:P,key:H,ref:ie!==void 0?ie:null,props:Z}}function N(P,H){return j(P.type,H,void 0,void 0,void 0,P.props)}function I(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function M(P){var H={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ie){return H[ie]})}var q=/\/+/g;function X(P,H){return typeof P=="object"&&P!==null&&P.key!=null?M(""+P.key):H.toString(36)}function G(){}function L(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(G,G):(P.status="pending",P.then(function(H){P.status==="pending"&&(P.status="fulfilled",P.value=H)},function(H){P.status==="pending"&&(P.status="rejected",P.reason=H)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function J(P,H,ie,re,U){var Z=typeof P;(Z==="undefined"||Z==="boolean")&&(P=null);var oe=!1;if(P===null)oe=!0;else switch(Z){case"bigint":case"string":case"number":oe=!0;break;case"object":switch(P.$$typeof){case t:case e:oe=!0;break;case h:return oe=P._init,J(oe(P._payload),H,ie,re,U)}}if(oe)return U=U(P),oe=re===""?"."+X(P,0):re,A(U)?(ie="",oe!=null&&(ie=oe.replace(q,"$&/")+"/"),J(U,H,ie,"",function(Ae){return Ae})):U!=null&&(I(U)&&(U=N(U,ie+(U.key==null||P&&P.key===U.key?"":(""+U.key).replace(q,"$&/")+"/")+oe)),H.push(U)),1;oe=0;var _e=re===""?".":re+":";if(A(P))for(var ye=0;ye<P.length;ye++)re=P[ye],Z=_e+X(re,ye),oe+=J(re,H,ie,Z,U);else if(ye=_(P),typeof ye=="function")for(P=ye.call(P),ye=0;!(re=P.next()).done;)re=re.value,Z=_e+X(re,ye++),oe+=J(re,H,ie,Z,U);else if(Z==="object"){if(typeof P.then=="function")return J(L(P),H,ie,re,U);throw H=String(P),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.")}return oe}function V(P,H,ie){if(P==null)return P;var re=[],U=0;return J(P,re,"","",function(Z){return H.call(ie,Z,U++)}),re}function $(P){if(P._status===-1){var H=P._result;H=H(),H.then(function(ie){(P._status===0||P._status===-1)&&(P._status=1,P._result=ie)},function(ie){(P._status===0||P._status===-1)&&(P._status=2,P._result=ie)}),P._status===-1&&(P._status=0,P._result=H)}if(P._status===1)return P._result.default;throw P._result}var Y=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var H=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(H))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)};function ue(){}return Be.Children={map:V,forEach:function(P,H,ie){V(P,function(){H.apply(this,arguments)},ie)},count:function(P){var H=0;return V(P,function(){H++}),H},toArray:function(P){return V(P,function(H){return H})||[]},only:function(P){if(!I(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},Be.Component=x,Be.Fragment=n,Be.Profiler=i,Be.PureComponent=R,Be.StrictMode=r,Be.Suspense=u,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Be.__COMPILER_RUNTIME={__proto__:null,c:function(P){return k.H.useMemoCache(P)}},Be.cache=function(P){return function(){return P.apply(null,arguments)}},Be.cloneElement=function(P,H,ie){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var re=T({},P.props),U=P.key,Z=void 0;if(H!=null)for(oe in H.ref!==void 0&&(Z=void 0),H.key!==void 0&&(U=""+H.key),H)!O.call(H,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&H.ref===void 0||(re[oe]=H[oe]);var oe=arguments.length-2;if(oe===1)re.children=ie;else if(1<oe){for(var _e=Array(oe),ye=0;ye<oe;ye++)_e[ye]=arguments[ye+2];re.children=_e}return j(P.type,U,void 0,void 0,Z,re)},Be.createContext=function(P){return P={$$typeof:o,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:s,_context:P},P},Be.createElement=function(P,H,ie){var re,U={},Z=null;if(H!=null)for(re in H.key!==void 0&&(Z=""+H.key),H)O.call(H,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(U[re]=H[re]);var oe=arguments.length-2;if(oe===1)U.children=ie;else if(1<oe){for(var _e=Array(oe),ye=0;ye<oe;ye++)_e[ye]=arguments[ye+2];U.children=_e}if(P&&P.defaultProps)for(re in oe=P.defaultProps,oe)U[re]===void 0&&(U[re]=oe[re]);return j(P,Z,void 0,void 0,null,U)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(P){return{$$typeof:l,render:P}},Be.isValidElement=I,Be.lazy=function(P){return{$$typeof:h,_payload:{_status:-1,_result:P},_init:$}},Be.memo=function(P,H){return{$$typeof:d,type:P,compare:H===void 0?null:H}},Be.startTransition=function(P){var H=k.T,ie={};k.T=ie;try{var re=P(),U=k.S;U!==null&&U(ie,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(ue,Y)}catch(Z){Y(Z)}finally{k.T=H}},Be.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Be.use=function(P){return k.H.use(P)},Be.useActionState=function(P,H,ie){return k.H.useActionState(P,H,ie)},Be.useCallback=function(P,H){return k.H.useCallback(P,H)},Be.useContext=function(P){return k.H.useContext(P)},Be.useDebugValue=function(){},Be.useDeferredValue=function(P,H){return k.H.useDeferredValue(P,H)},Be.useEffect=function(P,H,ie){var re=k.H;if(typeof ie=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return re.useEffect(P,H)},Be.useId=function(){return k.H.useId()},Be.useImperativeHandle=function(P,H,ie){return k.H.useImperativeHandle(P,H,ie)},Be.useInsertionEffect=function(P,H){return k.H.useInsertionEffect(P,H)},Be.useLayoutEffect=function(P,H){return k.H.useLayoutEffect(P,H)},Be.useMemo=function(P,H){return k.H.useMemo(P,H)},Be.useOptimistic=function(P,H){return k.H.useOptimistic(P,H)},Be.useReducer=function(P,H,ie){return k.H.useReducer(P,H,ie)},Be.useRef=function(P){return k.H.useRef(P)},Be.useState=function(P){return k.H.useState(P)},Be.useSyncExternalStore=function(P,H,ie){return k.H.useSyncExternalStore(P,H,ie)},Be.useTransition=function(){return k.H.useTransition()},Be.version="19.1.0",Be}var H3;function Lx(){return H3||(H3=1,_g.exports=RB()),_g.exports}var vg={exports:{}},dn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W3;function CB(){if(W3)return dn;W3=1;var t=Lx();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:d,implementation:h}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return dn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,dn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},dn.flushSync=function(u){var d=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=d,r.p=h,r.d.f()}},dn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},dn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},dn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:y}):h==="script"&&r.d.X(u,{crossOrigin:g,integrity:_,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},dn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},dn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin);r.d.L(u,h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},dn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},dn.requestFormReset=function(u){r.d.r(u)},dn.unstable_batchedUpdates=function(u,d){return u(d)},dn.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},dn.useFormStatus=function(){return o.H.useHostTransitionStatus()},dn.version="19.1.0",dn}var X3;function wM(){if(X3)return vg.exports;X3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),vg.exports=CB(),vg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y3;function NB(){if(Y3)return vl;Y3=1;var t=AB(),e=Lx(),n=wM();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,p=c;;){var v=f.return;if(v===null)break;var b=v.alternate;if(b===null){if(p=v.return,p!==null){f=p;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===f)return l(v),a;if(b===p)return l(v),c;b=b.sibling}throw Error(r(188))}if(f.return!==p.return)f=v,p=b;else{for(var C=!1,B=v.child;B;){if(B===f){C=!0,f=v,p=b;break}if(B===p){C=!0,p=v,f=b;break}B=B.sibling}if(!C){for(B=b.child;B;){if(B===f){C=!0,f=b,p=v;break}if(B===p){C=!0,p=b,f=v;break}B=B.sibling}if(!C)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function d(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=d(a),c!==null)return c;a=a.sibling}return null}var h=Object.assign,g=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),R=Symbol.for("react.consumer"),E=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function X(a){return a===null||typeof a!="object"?null:(a=q&&a[q]||a["@@iterator"],typeof a=="function"?a:null)}var G=Symbol.for("react.client.reference");function L(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===G?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case x:return"Profiler";case w:return"StrictMode";case k:return"Suspense";case O:return"SuspenseList";case I:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case E:return(a.displayName||"Context")+".Provider";case R:return(a._context.displayName||"Context")+".Consumer";case A:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case j:return c=a.displayName||null,c!==null?c:L(a.type)||"Memo";case N:c=a._payload,a=a._init;try{return L(a(c))}catch{}}return null}var J=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},ue=[],P=-1;function H(a){return{current:a}}function ie(a){0>P||(a.current=ue[P],ue[P]=null,P--)}function re(a,c){P++,ue[P]=a.current,a.current=c}var U=H(null),Z=H(null),oe=H(null),_e=H(null);function ye(a,c){switch(re(oe,c),re(Z,a),re(U,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?p3(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=p3(c),a=g3(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ie(U),re(U,a)}function Ae(){ie(U),ie(Z),ie(oe)}function Me(a){a.memoizedState!==null&&re(_e,a);var c=U.current,f=g3(c,a.type);c!==f&&(re(Z,a),re(U,f))}function Ze(a){Z.current===a&&(ie(U),ie(Z)),_e.current===a&&(ie(_e),dl._currentValue=Y)}var It=Object.prototype.hasOwnProperty,_t=t.unstable_scheduleCallback,ut=t.unstable_cancelCallback,De=t.unstable_shouldYield,tn=t.unstable_requestPaint,Ce=t.unstable_now,ln=t.unstable_getCurrentPriorityLevel,Gt=t.unstable_ImmediatePriority,On=t.unstable_UserBlockingPriority,_n=t.unstable_NormalPriority,cn=t.unstable_LowPriority,Ye=t.unstable_IdlePriority,we=t.log,Re=t.unstable_setDisableYieldValue,We=null,ze=null;function Ge(a){if(typeof we=="function"&&Re(a),ze&&typeof ze.setStrictMode=="function")try{ze.setStrictMode(We,a)}catch{}}var vt=Math.clz32?Math.clz32:dr,En=Math.log,Rr=Math.LN2;function dr(a){return a>>>=0,a===0?32:31-(En(a)/Rr|0)|0}var jt=256,xe=4194304;function Xe(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function nt(a,c,f){var p=a.pendingLanes;if(p===0)return 0;var v=0,b=a.suspendedLanes,C=a.pingedLanes;a=a.warmLanes;var B=p&134217727;return B!==0?(p=B&~b,p!==0?v=Xe(p):(C&=B,C!==0?v=Xe(C):f||(f=B&~a,f!==0&&(v=Xe(f))))):(B=p&~b,B!==0?v=Xe(B):C!==0?v=Xe(C):f||(f=p&~a,f!==0&&(v=Xe(f)))),v===0?0:c!==0&&c!==v&&(c&b)===0&&(b=v&-v,f=c&-c,b>=f||b===32&&(f&4194048)!==0)?c:v}function $e(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function yt(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qr(){var a=jt;return jt<<=1,(jt&4194048)===0&&(jt=256),a}function xo(){var a=xe;return xe<<=1,(xe&62914560)===0&&(xe=4194304),a}function nh(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function wo(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function l6(a,c,f,p,v,b){var C=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var B=a.entanglements,K=a.expirationTimes,fe=a.hiddenUpdates;for(f=C&~f;0<f;){var pe=31-vt(f),ve=1<<pe;B[pe]=0,K[pe]=-1;var de=fe[pe];if(de!==null)for(fe[pe]=null,pe=0;pe<de.length;pe++){var he=de[pe];he!==null&&(he.lane&=-536870913)}f&=~ve}p!==0&&J1(a,p,0),b!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=b&~(C&~c))}function J1(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-vt(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|f&4194090}function e2(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var p=31-vt(f),v=1<<p;v&c|a[p]&c&&(a[p]|=c),f&=~v}}function rh(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function ih(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function t2(){var a=$.p;return a!==0?a:(a=window.event,a===void 0?32:P3(a.type))}function c6(a,c){var f=$.p;try{return $.p=a,c()}finally{$.p=f}}var gi=Math.random().toString(36).slice(2),un="__reactFiber$"+gi,An="__reactProps$"+gi,Gs="__reactContainer$"+gi,sh="__reactEvents$"+gi,u6="__reactListeners$"+gi,f6="__reactHandles$"+gi,n2="__reactResources$"+gi,To="__reactMarker$"+gi;function ah(a){delete a[un],delete a[An],delete a[sh],delete a[u6],delete a[f6]}function Ks(a){var c=a[un];if(c)return c;for(var f=a.parentNode;f;){if(c=f[Gs]||f[un]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=y3(a);a!==null;){if(f=a[un])return f;a=y3(a)}return c}a=f,f=a.parentNode}return null}function Zs(a){if(a=a[un]||a[Gs]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function So(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function Qs(a){var c=a[n2];return c||(c=a[n2]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Kt(a){a[To]=!0}var r2=new Set,i2={};function ns(a,c){Js(a,c),Js(a+"Capture",c)}function Js(a,c){for(i2[a]=c,a=0;a<c.length;a++)r2.add(c[a])}var d6=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),s2={},a2={};function h6(a){return It.call(a2,a)?!0:It.call(s2,a)?!1:d6.test(a)?a2[a]=!0:(s2[a]=!0,!1)}function Rc(a,c,f){if(h6(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function Cc(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function $r(a,c,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+p)}}var oh,o2;function ea(a){if(oh===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);oh=c&&c[1]||"",o2=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+oh+a+o2}var lh=!1;function ch(a,c){if(!a||lh)return"";lh=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(he){var de=he}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(he){de=he}a.call(ve.prototype)}}else{try{throw Error()}catch(he){de=he}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(he){if(he&&de&&typeof he.stack=="string")return[he.stack,de.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=p.DetermineComponentFrameRoot(),C=b[0],B=b[1];if(C&&B){var K=C.split(`
`),fe=B.split(`
`);for(v=p=0;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;for(;v<fe.length&&!fe[v].includes("DetermineComponentFrameRoot");)v++;if(p===K.length||v===fe.length)for(p=K.length-1,v=fe.length-1;1<=p&&0<=v&&K[p]!==fe[v];)v--;for(;1<=p&&0<=v;p--,v--)if(K[p]!==fe[v]){if(p!==1||v!==1)do if(p--,v--,0>v||K[p]!==fe[v]){var pe=`
`+K[p].replace(" at new "," at ");return a.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",a.displayName)),pe}while(1<=p&&0<=v);break}}}finally{lh=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?ea(f):""}function p6(a){switch(a.tag){case 26:case 27:case 5:return ea(a.type);case 16:return ea("Lazy");case 13:return ea("Suspense");case 19:return ea("SuspenseList");case 0:case 15:return ch(a.type,!1);case 11:return ch(a.type.render,!1);case 1:return ch(a.type,!0);case 31:return ea("Activity");default:return""}}function l2(a){try{var c="";do c+=p6(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Yn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function c2(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function g6(a){var c=c2(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),p=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,b=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(C){p=""+C,b.call(this,C)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(C){p=""+C},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Nc(a){a._valueTracker||(a._valueTracker=g6(a))}function u2(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return a&&(p=c2(a)?a.checked?"true":"false":a.value),a=p,a!==f?(c.setValue(a),!0):!1}function kc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var m6=/[\n"\\]/g;function Gn(a){return a.replace(m6,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function uh(a,c,f,p,v,b,C,B){a.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?a.type=C:a.removeAttribute("type"),c!=null?C==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Yn(c)):a.value!==""+Yn(c)&&(a.value=""+Yn(c)):C!=="submit"&&C!=="reset"||a.removeAttribute("value"),c!=null?fh(a,C,Yn(c)):f!=null?fh(a,C,Yn(f)):p!=null&&a.removeAttribute("value"),v==null&&b!=null&&(a.defaultChecked=!!b),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?a.name=""+Yn(B):a.removeAttribute("name")}function f2(a,c,f,p,v,b,C,B){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),c!=null||f!=null){if(!(b!=="submit"&&b!=="reset"||c!=null))return;f=f!=null?""+Yn(f):"",c=c!=null?""+Yn(c):f,B||c===a.value||(a.value=c),a.defaultValue=c}p=p??v,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=B?a.checked:!!p,a.defaultChecked=!!p,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(a.name=C)}function fh(a,c,f){c==="number"&&kc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function ta(a,c,f,p){if(a=a.options,c){c={};for(var v=0;v<f.length;v++)c["$"+f[v]]=!0;for(f=0;f<a.length;f++)v=c.hasOwnProperty("$"+a[f].value),a[f].selected!==v&&(a[f].selected=v),v&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Yn(f),c=null,v=0;v<a.length;v++){if(a[v].value===f){a[v].selected=!0,p&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function d2(a,c,f){if(c!=null&&(c=""+Yn(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Yn(f):""}function h2(a,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(J(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Yn(c),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p)}function na(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var _6=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function p2(a,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,f):typeof f!="number"||f===0||_6.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function g2(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var v in c)p=c[v],c.hasOwnProperty(v)&&f[v]!==p&&p2(a,v,p)}else for(var b in c)c.hasOwnProperty(b)&&p2(a,b,c[b])}function dh(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var v6=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),y6=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mc(a){return y6.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var hh=null;function ph(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ra=null,ia=null;function m2(a){var c=Zs(a);if(c&&(a=c.stateNode)){var f=a[An]||null;e:switch(a=c.stateNode,c.type){case"input":if(uh(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Gn(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==a&&p.form===a.form){var v=p[An]||null;if(!v)throw Error(r(90));uh(p,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===a.form&&u2(p)}break e;case"textarea":d2(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&ta(a,!!f.multiple,c,!1)}}}var gh=!1;function _2(a,c,f){if(gh)return a(c,f);gh=!0;try{var p=a(c);return p}finally{if(gh=!1,(ra!==null||ia!==null)&&(mu(),ra&&(c=ra,a=ia,ia=ra=null,m2(c),a)))for(c=0;c<a.length;c++)m2(a[c])}}function Eo(a,c){var f=a.stateNode;if(f===null)return null;var p=f[An]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var Hr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mh=!1;if(Hr)try{var Ao={};Object.defineProperty(Ao,"passive",{get:function(){mh=!0}}),window.addEventListener("test",Ao,Ao),window.removeEventListener("test",Ao,Ao)}catch{mh=!1}var mi=null,_h=null,Ic=null;function v2(){if(Ic)return Ic;var a,c=_h,f=c.length,p,v="value"in mi?mi.value:mi.textContent,b=v.length;for(a=0;a<f&&c[a]===v[a];a++);var C=f-a;for(p=1;p<=C&&c[f-p]===v[b-p];p++);return Ic=v.slice(a,1<p?1-p:void 0)}function Oc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Pc(){return!0}function y2(){return!1}function Rn(a){function c(f,p,v,b,C){this._reactName=f,this._targetInst=v,this.type=p,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(f=a[B],this[B]=f?f(b):b[B]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Pc:y2,this.isPropagationStopped=y2,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Pc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Pc)},persist:function(){},isPersistent:Pc}),c}var rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dc=Rn(rs),Ro=h({},rs,{view:0,detail:0}),b6=Rn(Ro),vh,yh,Co,jc=h({},Ro,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Co&&(Co&&a.type==="mousemove"?(vh=a.screenX-Co.screenX,yh=a.screenY-Co.screenY):yh=vh=0,Co=a),vh)},movementY:function(a){return"movementY"in a?a.movementY:yh}}),b2=Rn(jc),x6=h({},jc,{dataTransfer:0}),w6=Rn(x6),T6=h({},Ro,{relatedTarget:0}),bh=Rn(T6),S6=h({},rs,{animationName:0,elapsedTime:0,pseudoElement:0}),E6=Rn(S6),A6=h({},rs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),R6=Rn(A6),C6=h({},rs,{data:0}),x2=Rn(C6),N6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},k6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},M6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function I6(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=M6[a])?!!c[a]:!1}function xh(){return I6}var O6=h({},Ro,{key:function(a){if(a.key){var c=N6[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Oc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?k6[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xh,charCode:function(a){return a.type==="keypress"?Oc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Oc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),P6=Rn(O6),D6=h({},jc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),w2=Rn(D6),j6=h({},Ro,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xh}),B6=Rn(j6),L6=h({},rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),U6=Rn(L6),F6=h({},jc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),z6=Rn(F6),V6=h({},rs,{newState:0,oldState:0}),q6=Rn(V6),$6=[9,13,27,32],wh=Hr&&"CompositionEvent"in window,No=null;Hr&&"documentMode"in document&&(No=document.documentMode);var H6=Hr&&"TextEvent"in window&&!No,T2=Hr&&(!wh||No&&8<No&&11>=No),S2=" ",E2=!1;function A2(a,c){switch(a){case"keyup":return $6.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function R2(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var sa=!1;function W6(a,c){switch(a){case"compositionend":return R2(c);case"keypress":return c.which!==32?null:(E2=!0,S2);case"textInput":return a=c.data,a===S2&&E2?null:a;default:return null}}function X6(a,c){if(sa)return a==="compositionend"||!wh&&A2(a,c)?(a=v2(),Ic=_h=mi=null,sa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return T2&&c.locale!=="ko"?null:c.data;default:return null}}var Y6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function C2(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!Y6[a.type]:c==="textarea"}function N2(a,c,f,p){ra?ia?ia.push(p):ia=[p]:ra=p,c=wu(c,"onChange"),0<c.length&&(f=new Dc("onChange","change",null,f,p),a.push({event:f,listeners:c}))}var ko=null,Mo=null;function G6(a){c3(a,0)}function Bc(a){var c=So(a);if(u2(c))return a}function k2(a,c){if(a==="change")return c}var M2=!1;if(Hr){var Th;if(Hr){var Sh="oninput"in document;if(!Sh){var I2=document.createElement("div");I2.setAttribute("oninput","return;"),Sh=typeof I2.oninput=="function"}Th=Sh}else Th=!1;M2=Th&&(!document.documentMode||9<document.documentMode)}function O2(){ko&&(ko.detachEvent("onpropertychange",P2),Mo=ko=null)}function P2(a){if(a.propertyName==="value"&&Bc(Mo)){var c=[];N2(c,Mo,a,ph(a)),_2(G6,c)}}function K6(a,c,f){a==="focusin"?(O2(),ko=c,Mo=f,ko.attachEvent("onpropertychange",P2)):a==="focusout"&&O2()}function Z6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Bc(Mo)}function Q6(a,c){if(a==="click")return Bc(c)}function J6(a,c){if(a==="input"||a==="change")return Bc(c)}function ej(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Pn=typeof Object.is=="function"?Object.is:ej;function Io(a,c){if(Pn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var v=f[p];if(!It.call(c,v)||!Pn(a[v],c[v]))return!1}return!0}function D2(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function j2(a,c){var f=D2(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=c&&p>=c)return{node:f,offset:c-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=D2(f)}}function B2(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?B2(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function L2(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=kc(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=kc(a.document)}return c}function Eh(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var tj=Hr&&"documentMode"in document&&11>=document.documentMode,aa=null,Ah=null,Oo=null,Rh=!1;function U2(a,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Rh||aa==null||aa!==kc(p)||(p=aa,"selectionStart"in p&&Eh(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Oo&&Io(Oo,p)||(Oo=p,p=wu(Ah,"onSelect"),0<p.length&&(c=new Dc("onSelect","select",null,c,f),a.push({event:c,listeners:p}),c.target=aa)))}function is(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var oa={animationend:is("Animation","AnimationEnd"),animationiteration:is("Animation","AnimationIteration"),animationstart:is("Animation","AnimationStart"),transitionrun:is("Transition","TransitionRun"),transitionstart:is("Transition","TransitionStart"),transitioncancel:is("Transition","TransitionCancel"),transitionend:is("Transition","TransitionEnd")},Ch={},F2={};Hr&&(F2=document.createElement("div").style,"AnimationEvent"in window||(delete oa.animationend.animation,delete oa.animationiteration.animation,delete oa.animationstart.animation),"TransitionEvent"in window||delete oa.transitionend.transition);function ss(a){if(Ch[a])return Ch[a];if(!oa[a])return a;var c=oa[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in F2)return Ch[a]=c[f];return a}var z2=ss("animationend"),V2=ss("animationiteration"),q2=ss("animationstart"),nj=ss("transitionrun"),rj=ss("transitionstart"),ij=ss("transitioncancel"),$2=ss("transitionend"),H2=new Map,Nh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nh.push("scrollEnd");function hr(a,c){H2.set(a,c),ns(c,[a])}var W2=new WeakMap;function Kn(a,c){if(typeof a=="object"&&a!==null){var f=W2.get(a);return f!==void 0?f:(c={value:a,source:c,stack:l2(c)},W2.set(a,c),c)}return{value:a,source:c,stack:l2(c)}}var Zn=[],la=0,kh=0;function Lc(){for(var a=la,c=kh=la=0;c<a;){var f=Zn[c];Zn[c++]=null;var p=Zn[c];Zn[c++]=null;var v=Zn[c];Zn[c++]=null;var b=Zn[c];if(Zn[c++]=null,p!==null&&v!==null){var C=p.pending;C===null?v.next=v:(v.next=C.next,C.next=v),p.pending=v}b!==0&&X2(f,v,b)}}function Uc(a,c,f,p){Zn[la++]=a,Zn[la++]=c,Zn[la++]=f,Zn[la++]=p,kh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function Mh(a,c,f,p){return Uc(a,c,f,p),Fc(a)}function ca(a,c){return Uc(a,null,null,c),Fc(a)}function X2(a,c,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var v=!1,b=a.return;b!==null;)b.childLanes|=f,p=b.alternate,p!==null&&(p.childLanes|=f),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(v=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,v&&c!==null&&(v=31-vt(f),a=b.hiddenUpdates,p=a[v],p===null?a[v]=[c]:p.push(c),c.lane=f|536870912),b):null}function Fc(a){if(50<il)throw il=0,Bp=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var ua={};function sj(a,c,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dn(a,c,f,p){return new sj(a,c,f,p)}function Ih(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Wr(a,c){var f=a.alternate;return f===null?(f=Dn(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function Y2(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function zc(a,c,f,p,v,b){var C=0;if(p=a,typeof a=="function")Ih(a)&&(C=1);else if(typeof a=="string")C=oB(a,f,U.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case I:return a=Dn(31,f,c,v),a.elementType=I,a.lanes=b,a;case T:return as(f.children,v,b,c);case w:C=8,v|=24;break;case x:return a=Dn(12,f,c,v|2),a.elementType=x,a.lanes=b,a;case k:return a=Dn(13,f,c,v),a.elementType=k,a.lanes=b,a;case O:return a=Dn(19,f,c,v),a.elementType=O,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case S:case E:C=10;break e;case R:C=9;break e;case A:C=11;break e;case j:C=14;break e;case N:C=16,p=null;break e}C=29,f=Error(r(130,a===null?"null":typeof a,"")),p=null}return c=Dn(C,f,c,v),c.elementType=a,c.type=p,c.lanes=b,c}function as(a,c,f,p){return a=Dn(7,a,p,c),a.lanes=f,a}function Oh(a,c,f){return a=Dn(6,a,null,c),a.lanes=f,a}function Ph(a,c,f){return c=Dn(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var fa=[],da=0,Vc=null,qc=0,Qn=[],Jn=0,os=null,Xr=1,Yr="";function ls(a,c){fa[da++]=qc,fa[da++]=Vc,Vc=a,qc=c}function G2(a,c,f){Qn[Jn++]=Xr,Qn[Jn++]=Yr,Qn[Jn++]=os,os=a;var p=Xr;a=Yr;var v=32-vt(p)-1;p&=~(1<<v),f+=1;var b=32-vt(c)+v;if(30<b){var C=v-v%5;b=(p&(1<<C)-1).toString(32),p>>=C,v-=C,Xr=1<<32-vt(c)+v|f<<v|p,Yr=b+a}else Xr=1<<b|f<<v|p,Yr=a}function Dh(a){a.return!==null&&(ls(a,1),G2(a,1,0))}function jh(a){for(;a===Vc;)Vc=fa[--da],fa[da]=null,qc=fa[--da],fa[da]=null;for(;a===os;)os=Qn[--Jn],Qn[Jn]=null,Yr=Qn[--Jn],Qn[Jn]=null,Xr=Qn[--Jn],Qn[Jn]=null}var vn=null,Rt=null,Qe=!1,cs=null,Cr=!1,Bh=Error(r(519));function us(a){var c=Error(r(418,""));throw jo(Kn(c,a)),Bh}function K2(a){var c=a.stateNode,f=a.type,p=a.memoizedProps;switch(c[un]=a,c[An]=p,f){case"dialog":qe("cancel",c),qe("close",c);break;case"iframe":case"object":case"embed":qe("load",c);break;case"video":case"audio":for(f=0;f<al.length;f++)qe(al[f],c);break;case"source":qe("error",c);break;case"img":case"image":case"link":qe("error",c),qe("load",c);break;case"details":qe("toggle",c);break;case"input":qe("invalid",c),f2(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Nc(c);break;case"select":qe("invalid",c);break;case"textarea":qe("invalid",c),h2(c,p.value,p.defaultValue,p.children),Nc(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||h3(c.textContent,f)?(p.popover!=null&&(qe("beforetoggle",c),qe("toggle",c)),p.onScroll!=null&&qe("scroll",c),p.onScrollEnd!=null&&qe("scrollend",c),p.onClick!=null&&(c.onclick=Tu),c=!0):c=!1,c||us(a)}function Z2(a){for(vn=a.return;vn;)switch(vn.tag){case 5:case 13:Cr=!1;return;case 27:case 3:Cr=!0;return;default:vn=vn.return}}function Po(a){if(a!==vn)return!1;if(!Qe)return Z2(a),Qe=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||Jp(a.type,a.memoizedProps)),f=!f),f&&Rt&&us(a),Z2(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){Rt=gr(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}Rt=null}}else c===27?(c=Rt,Ii(a.type)?(a=rg,rg=null,Rt=a):Rt=c):Rt=vn?gr(a.stateNode.nextSibling):null;return!0}function Do(){Rt=vn=null,Qe=!1}function Q2(){var a=cs;return a!==null&&(kn===null?kn=a:kn.push.apply(kn,a),cs=null),a}function jo(a){cs===null?cs=[a]:cs.push(a)}var Lh=H(null),fs=null,Gr=null;function _i(a,c,f){re(Lh,c._currentValue),c._currentValue=f}function Kr(a){a._currentValue=Lh.current,ie(Lh)}function Uh(a,c,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===f)break;a=a.return}}function Fh(a,c,f,p){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var b=v.dependencies;if(b!==null){var C=v.child;b=b.firstContext;e:for(;b!==null;){var B=b;b=v;for(var K=0;K<c.length;K++)if(B.context===c[K]){b.lanes|=f,B=b.alternate,B!==null&&(B.lanes|=f),Uh(b.return,f,a),p||(C=null);break e}b=B.next}}else if(v.tag===18){if(C=v.return,C===null)throw Error(r(341));C.lanes|=f,b=C.alternate,b!==null&&(b.lanes|=f),Uh(C,f,a),C=null}else C=v.child;if(C!==null)C.return=v;else for(C=v;C!==null;){if(C===a){C=null;break}if(v=C.sibling,v!==null){v.return=C.return,C=v;break}C=C.return}v=C}}function Bo(a,c,f,p){a=null;for(var v=c,b=!1;v!==null;){if(!b){if((v.flags&524288)!==0)b=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var C=v.alternate;if(C===null)throw Error(r(387));if(C=C.memoizedProps,C!==null){var B=v.type;Pn(v.pendingProps.value,C.value)||(a!==null?a.push(B):a=[B])}}else if(v===_e.current){if(C=v.alternate,C===null)throw Error(r(387));C.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(dl):a=[dl])}v=v.return}a!==null&&Fh(c,a,f,p),c.flags|=262144}function $c(a){for(a=a.firstContext;a!==null;){if(!Pn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ds(a){fs=a,Gr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function fn(a){return J2(fs,a)}function Hc(a,c){return fs===null&&ds(a),J2(a,c)}function J2(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Gr===null){if(a===null)throw Error(r(308));Gr=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Gr=Gr.next=c;return f}var aj=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},oj=t.unstable_scheduleCallback,lj=t.unstable_NormalPriority,$t={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zh(){return{controller:new aj,data:new Map,refCount:0}}function Lo(a){a.refCount--,a.refCount===0&&oj(lj,function(){a.controller.abort()})}var Uo=null,Vh=0,ha=0,pa=null;function cj(a,c){if(Uo===null){var f=Uo=[];Vh=0,ha=$p(),pa={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Vh++,c.then(ew,ew),c}function ew(){if(--Vh===0&&Uo!==null){pa!==null&&(pa.status="fulfilled");var a=Uo;Uo=null,ha=0,pa=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function uj(a,c){var f=[],p={status:"pending",value:null,reason:null,then:function(v){f.push(v)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var v=0;v<f.length;v++)(0,f[v])(c)},function(v){for(p.status="rejected",p.reason=v,v=0;v<f.length;v++)(0,f[v])(void 0)}),p}var tw=V.S;V.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&cj(a,c),tw!==null&&tw(a,c)};var hs=H(null);function qh(){var a=hs.current;return a!==null?a:gt.pooledCache}function Wc(a,c){c===null?re(hs,hs.current):re(hs,c.pool)}function nw(){var a=qh();return a===null?null:{parent:$t._currentValue,pool:a}}var Fo=Error(r(460)),rw=Error(r(474)),Xc=Error(r(542)),$h={then:function(){}};function iw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Yc(){}function sw(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(Yc,Yc),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,ow(a),a;default:if(typeof c.status=="string")c.then(Yc,Yc);else{if(a=gt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=p}},function(p){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,ow(a),a}throw zo=c,Fo}}var zo=null;function aw(){if(zo===null)throw Error(r(459));var a=zo;return zo=null,a}function ow(a){if(a===Fo||a===Xc)throw Error(r(483))}var vi=!1;function Hh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wh(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function yi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function bi(a,c,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(rt&2)!==0){var v=p.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),p.pending=c,c=Fc(a),X2(a,null,f),c}return Uc(a,p,c,f),Fc(a)}function Vo(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,e2(a,f)}}function Xh(a,c){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var v=null,b=null;if(f=f.firstBaseUpdate,f!==null){do{var C={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};b===null?v=b=C:b=b.next=C,f=f.next}while(f!==null);b===null?v=b=c:b=b.next=c}else v=b=c;f={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var Yh=!1;function qo(){if(Yh){var a=pa;if(a!==null)throw a}}function $o(a,c,f,p){Yh=!1;var v=a.updateQueue;vi=!1;var b=v.firstBaseUpdate,C=v.lastBaseUpdate,B=v.shared.pending;if(B!==null){v.shared.pending=null;var K=B,fe=K.next;K.next=null,C===null?b=fe:C.next=fe,C=K;var pe=a.alternate;pe!==null&&(pe=pe.updateQueue,B=pe.lastBaseUpdate,B!==C&&(B===null?pe.firstBaseUpdate=fe:B.next=fe,pe.lastBaseUpdate=K))}if(b!==null){var ve=v.baseState;C=0,pe=fe=K=null,B=b;do{var de=B.lane&-536870913,he=de!==B.lane;if(he?(He&de)===de:(p&de)===de){de!==0&&de===ha&&(Yh=!0),pe!==null&&(pe=pe.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var Pe=a,ke=B;de=c;var ot=f;switch(ke.tag){case 1:if(Pe=ke.payload,typeof Pe=="function"){ve=Pe.call(ot,ve,de);break e}ve=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=ke.payload,de=typeof Pe=="function"?Pe.call(ot,ve,de):Pe,de==null)break e;ve=h({},ve,de);break e;case 2:vi=!0}}de=B.callback,de!==null&&(a.flags|=64,he&&(a.flags|=8192),he=v.callbacks,he===null?v.callbacks=[de]:he.push(de))}else he={lane:de,tag:B.tag,payload:B.payload,callback:B.callback,next:null},pe===null?(fe=pe=he,K=ve):pe=pe.next=he,C|=de;if(B=B.next,B===null){if(B=v.shared.pending,B===null)break;he=B,B=he.next,he.next=null,v.lastBaseUpdate=he,v.shared.pending=null}}while(!0);pe===null&&(K=ve),v.baseState=K,v.firstBaseUpdate=fe,v.lastBaseUpdate=pe,b===null&&(v.shared.lanes=0),Ci|=C,a.lanes=C,a.memoizedState=ve}}function lw(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function cw(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)lw(f[a],c)}var ga=H(null),Gc=H(0);function uw(a,c){a=ri,re(Gc,a),re(ga,c),ri=a|c.baseLanes}function Gh(){re(Gc,ri),re(ga,ga.current)}function Kh(){ri=Gc.current,ie(ga),ie(Gc)}var xi=0,Le=null,st=null,Bt=null,Kc=!1,ma=!1,ps=!1,Zc=0,Ho=0,_a=null,fj=0;function Ot(){throw Error(r(321))}function Zh(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!Pn(a[f],c[f]))return!1;return!0}function Qh(a,c,f,p,v,b){return xi=b,Le=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,V.H=a===null||a.memoizedState===null?Xw:Yw,ps=!1,b=f(p,v),ps=!1,ma&&(b=dw(c,f,p,v)),fw(a),b}function fw(a){V.H=ru;var c=st!==null&&st.next!==null;if(xi=0,Bt=st=Le=null,Kc=!1,Ho=0,_a=null,c)throw Error(r(300));a===null||Zt||(a=a.dependencies,a!==null&&$c(a)&&(Zt=!0))}function dw(a,c,f,p){Le=a;var v=0;do{if(ma&&(_a=null),Ho=0,ma=!1,25<=v)throw Error(r(301));if(v+=1,Bt=st=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}V.H=vj,b=c(f,p)}while(ma);return b}function dj(){var a=V.H,c=a.useState()[0];return c=typeof c.then=="function"?Wo(c):c,a=a.useState()[0],(st!==null?st.memoizedState:null)!==a&&(Le.flags|=1024),c}function Jh(){var a=Zc!==0;return Zc=0,a}function ep(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function tp(a){if(Kc){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Kc=!1}xi=0,Bt=st=Le=null,ma=!1,Ho=Zc=0,_a=null}function Cn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?Le.memoizedState=Bt=a:Bt=Bt.next=a,Bt}function Lt(){if(st===null){var a=Le.alternate;a=a!==null?a.memoizedState:null}else a=st.next;var c=Bt===null?Le.memoizedState:Bt.next;if(c!==null)Bt=c,st=a;else{if(a===null)throw Le.alternate===null?Error(r(467)):Error(r(310));st=a,a={memoizedState:st.memoizedState,baseState:st.baseState,baseQueue:st.baseQueue,queue:st.queue,next:null},Bt===null?Le.memoizedState=Bt=a:Bt=Bt.next=a}return Bt}function np(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wo(a){var c=Ho;return Ho+=1,_a===null&&(_a=[]),a=sw(_a,a,c),c=Le,(Bt===null?c.memoizedState:Bt.next)===null&&(c=c.alternate,V.H=c===null||c.memoizedState===null?Xw:Yw),a}function Qc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Wo(a);if(a.$$typeof===E)return fn(a)}throw Error(r(438,String(a)))}function rp(a){var c=null,f=Le.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=Le.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=np(),Le.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),p=0;p<a;p++)f[p]=M;return c.index++,f}function Zr(a,c){return typeof c=="function"?c(a):c}function Jc(a){var c=Lt();return ip(c,st,a)}function ip(a,c,f){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var v=a.baseQueue,b=p.pending;if(b!==null){if(v!==null){var C=v.next;v.next=b.next,b.next=C}c.baseQueue=v=b,p.pending=null}if(b=a.baseState,v===null)a.memoizedState=b;else{c=v.next;var B=C=null,K=null,fe=c,pe=!1;do{var ve=fe.lane&-536870913;if(ve!==fe.lane?(He&ve)===ve:(xi&ve)===ve){var de=fe.revertLane;if(de===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),ve===ha&&(pe=!0);else if((xi&de)===de){fe=fe.next,de===ha&&(pe=!0);continue}else ve={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(B=K=ve,C=b):K=K.next=ve,Le.lanes|=de,Ci|=de;ve=fe.action,ps&&f(b,ve),b=fe.hasEagerState?fe.eagerState:f(b,ve)}else de={lane:ve,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(B=K=de,C=b):K=K.next=de,Le.lanes|=ve,Ci|=ve;fe=fe.next}while(fe!==null&&fe!==c);if(K===null?C=b:K.next=B,!Pn(b,a.memoizedState)&&(Zt=!0,pe&&(f=pa,f!==null)))throw f;a.memoizedState=b,a.baseState=C,a.baseQueue=K,p.lastRenderedState=b}return v===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function sp(a){var c=Lt(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var p=f.dispatch,v=f.pending,b=c.memoizedState;if(v!==null){f.pending=null;var C=v=v.next;do b=a(b,C.action),C=C.next;while(C!==v);Pn(b,c.memoizedState)||(Zt=!0),c.memoizedState=b,c.baseQueue===null&&(c.baseState=b),f.lastRenderedState=b}return[b,p]}function hw(a,c,f){var p=Le,v=Lt(),b=Qe;if(b){if(f===void 0)throw Error(r(407));f=f()}else f=c();var C=!Pn((st||v).memoizedState,f);C&&(v.memoizedState=f,Zt=!0),v=v.queue;var B=mw.bind(null,p,v,a);if(Xo(2048,8,B,[a]),v.getSnapshot!==c||C||Bt!==null&&Bt.memoizedState.tag&1){if(p.flags|=2048,va(9,eu(),gw.bind(null,p,v,f,c),null),gt===null)throw Error(r(349));b||(xi&124)!==0||pw(p,c,f)}return f}function pw(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=Le.updateQueue,c===null?(c=np(),Le.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function gw(a,c,f,p){c.value=f,c.getSnapshot=p,_w(c)&&vw(a)}function mw(a,c,f){return f(function(){_w(c)&&vw(a)})}function _w(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!Pn(a,f)}catch{return!0}}function vw(a){var c=ca(a,2);c!==null&&Fn(c,a,2)}function ap(a){var c=Cn();if(typeof a=="function"){var f=a;if(a=f(),ps){Ge(!0);try{f()}finally{Ge(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:a},c}function yw(a,c,f,p){return a.baseState=f,ip(a,st,typeof p=="function"?p:Zr)}function hj(a,c,f,p,v){if(nu(a))throw Error(r(485));if(a=c.action,a!==null){var b={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){b.listeners.push(C)}};V.T!==null?f(!0):b.isTransition=!1,p(b),f=c.pending,f===null?(b.next=c.pending=b,bw(c,b)):(b.next=f.next,c.pending=f.next=b)}}function bw(a,c){var f=c.action,p=c.payload,v=a.state;if(c.isTransition){var b=V.T,C={};V.T=C;try{var B=f(v,p),K=V.S;K!==null&&K(C,B),xw(a,c,B)}catch(fe){op(a,c,fe)}finally{V.T=b}}else try{b=f(v,p),xw(a,c,b)}catch(fe){op(a,c,fe)}}function xw(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){ww(a,c,p)},function(p){return op(a,c,p)}):ww(a,c,f)}function ww(a,c,f){c.status="fulfilled",c.value=f,Tw(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,bw(a,f)))}function op(a,c,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,Tw(c),c=c.next;while(c!==p)}a.action=null}function Tw(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function Sw(a,c){return c}function Ew(a,c){if(Qe){var f=gt.formState;if(f!==null){e:{var p=Le;if(Qe){if(Rt){t:{for(var v=Rt,b=Cr;v.nodeType!==8;){if(!b){v=null;break t}if(v=gr(v.nextSibling),v===null){v=null;break t}}b=v.data,v=b==="F!"||b==="F"?v:null}if(v){Rt=gr(v.nextSibling),p=v.data==="F!";break e}}us(p)}p=!1}p&&(c=f[0])}}return f=Cn(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sw,lastRenderedState:c},f.queue=p,f=$w.bind(null,Le,p),p.dispatch=f,p=ap(!1),b=dp.bind(null,Le,!1,p.queue),p=Cn(),v={state:c,dispatch:null,action:a,pending:null},p.queue=v,f=hj.bind(null,Le,v,b,f),v.dispatch=f,p.memoizedState=a,[c,f,!1]}function Aw(a){var c=Lt();return Rw(c,st,a)}function Rw(a,c,f){if(c=ip(a,c,Sw)[0],a=Jc(Zr)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Wo(c)}catch(C){throw C===Fo?Xc:C}else p=c;c=Lt();var v=c.queue,b=v.dispatch;return f!==c.memoizedState&&(Le.flags|=2048,va(9,eu(),pj.bind(null,v,f),null)),[p,b,a]}function pj(a,c){a.action=c}function Cw(a){var c=Lt(),f=st;if(f!==null)return Rw(c,f,a);Lt(),c=c.memoizedState,f=Lt();var p=f.queue.dispatch;return f.memoizedState=a,[c,p,!1]}function va(a,c,f,p){return a={tag:a,create:f,deps:p,inst:c,next:null},c=Le.updateQueue,c===null&&(c=np(),Le.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,c.lastEffect=a),a}function eu(){return{destroy:void 0,resource:void 0}}function Nw(){return Lt().memoizedState}function tu(a,c,f,p){var v=Cn();p=p===void 0?null:p,Le.flags|=a,v.memoizedState=va(1|c,eu(),f,p)}function Xo(a,c,f,p){var v=Lt();p=p===void 0?null:p;var b=v.memoizedState.inst;st!==null&&p!==null&&Zh(p,st.memoizedState.deps)?v.memoizedState=va(c,b,f,p):(Le.flags|=a,v.memoizedState=va(1|c,b,f,p))}function kw(a,c){tu(8390656,8,a,c)}function Mw(a,c){Xo(2048,8,a,c)}function Iw(a,c){return Xo(4,2,a,c)}function Ow(a,c){return Xo(4,4,a,c)}function Pw(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Dw(a,c,f){f=f!=null?f.concat([a]):null,Xo(4,4,Pw.bind(null,c,a),f)}function lp(){}function jw(a,c){var f=Lt();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&Zh(c,p[1])?p[0]:(f.memoizedState=[a,c],a)}function Bw(a,c){var f=Lt();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&Zh(c,p[1]))return p[0];if(p=a(),ps){Ge(!0);try{a()}finally{Ge(!1)}}return f.memoizedState=[p,c],p}function cp(a,c,f){return f===void 0||(xi&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=FT(),Le.lanes|=a,Ci|=a,f)}function Lw(a,c,f,p){return Pn(f,c)?f:ga.current!==null?(a=cp(a,f,p),Pn(a,c)||(Zt=!0),a):(xi&42)===0?(Zt=!0,a.memoizedState=f):(a=FT(),Le.lanes|=a,Ci|=a,c)}function Uw(a,c,f,p,v){var b=$.p;$.p=b!==0&&8>b?b:8;var C=V.T,B={};V.T=B,dp(a,!1,c,f);try{var K=v(),fe=V.S;if(fe!==null&&fe(B,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var pe=uj(K,p);Yo(a,c,pe,Un(a))}else Yo(a,c,p,Un(a))}catch(ve){Yo(a,c,{then:function(){},status:"rejected",reason:ve},Un())}finally{$.p=b,V.T=C}}function gj(){}function up(a,c,f,p){if(a.tag!==5)throw Error(r(476));var v=Fw(a).queue;Uw(a,v,c,Y,f===null?gj:function(){return zw(a),f(p)})}function Fw(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:Y},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function zw(a){var c=Fw(a).next.queue;Yo(a,c,{},Un())}function fp(){return fn(dl)}function Vw(){return Lt().memoizedState}function qw(){return Lt().memoizedState}function mj(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=Un();a=yi(f);var p=bi(c,a,f);p!==null&&(Fn(p,c,f),Vo(p,c,f)),c={cache:zh()},a.payload=c;return}c=c.return}}function _j(a,c,f){var p=Un();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},nu(a)?Hw(c,f):(f=Mh(a,c,f,p),f!==null&&(Fn(f,a,p),Ww(f,c,p)))}function $w(a,c,f){var p=Un();Yo(a,c,f,p)}function Yo(a,c,f,p){var v={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(nu(a))Hw(c,v);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=c.lastRenderedReducer,b!==null))try{var C=c.lastRenderedState,B=b(C,f);if(v.hasEagerState=!0,v.eagerState=B,Pn(B,C))return Uc(a,c,v,0),gt===null&&Lc(),!1}catch{}finally{}if(f=Mh(a,c,v,p),f!==null)return Fn(f,a,p),Ww(f,c,p),!0}return!1}function dp(a,c,f,p){if(p={lane:2,revertLane:$p(),action:p,hasEagerState:!1,eagerState:null,next:null},nu(a)){if(c)throw Error(r(479))}else c=Mh(a,f,p,2),c!==null&&Fn(c,a,2)}function nu(a){var c=a.alternate;return a===Le||c!==null&&c===Le}function Hw(a,c){ma=Kc=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function Ww(a,c,f){if((f&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,e2(a,f)}}var ru={readContext:fn,use:Qc,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useInsertionEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useSyncExternalStore:Ot,useId:Ot,useHostTransitionStatus:Ot,useFormState:Ot,useActionState:Ot,useOptimistic:Ot,useMemoCache:Ot,useCacheRefresh:Ot},Xw={readContext:fn,use:Qc,useCallback:function(a,c){return Cn().memoizedState=[a,c===void 0?null:c],a},useContext:fn,useEffect:kw,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,tu(4194308,4,Pw.bind(null,c,a),f)},useLayoutEffect:function(a,c){return tu(4194308,4,a,c)},useInsertionEffect:function(a,c){tu(4,2,a,c)},useMemo:function(a,c){var f=Cn();c=c===void 0?null:c;var p=a();if(ps){Ge(!0);try{a()}finally{Ge(!1)}}return f.memoizedState=[p,c],p},useReducer:function(a,c,f){var p=Cn();if(f!==void 0){var v=f(c);if(ps){Ge(!0);try{f(c)}finally{Ge(!1)}}}else v=c;return p.memoizedState=p.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},p.queue=a,a=a.dispatch=_j.bind(null,Le,a),[p.memoizedState,a]},useRef:function(a){var c=Cn();return a={current:a},c.memoizedState=a},useState:function(a){a=ap(a);var c=a.queue,f=$w.bind(null,Le,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:lp,useDeferredValue:function(a,c){var f=Cn();return cp(f,a,c)},useTransition:function(){var a=ap(!1);return a=Uw.bind(null,Le,a.queue,!0,!1),Cn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var p=Le,v=Cn();if(Qe){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),gt===null)throw Error(r(349));(He&124)!==0||pw(p,c,f)}v.memoizedState=f;var b={value:f,getSnapshot:c};return v.queue=b,kw(mw.bind(null,p,b,a),[a]),p.flags|=2048,va(9,eu(),gw.bind(null,p,b,f,c),null),f},useId:function(){var a=Cn(),c=gt.identifierPrefix;if(Qe){var f=Yr,p=Xr;f=(p&~(1<<32-vt(p)-1)).toString(32)+f,c=""+c+"R"+f,f=Zc++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=fj++,c=""+c+"r"+f.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:fp,useFormState:Ew,useActionState:Ew,useOptimistic:function(a){var c=Cn();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=dp.bind(null,Le,!0,f),f.dispatch=c,[a,c]},useMemoCache:rp,useCacheRefresh:function(){return Cn().memoizedState=mj.bind(null,Le)}},Yw={readContext:fn,use:Qc,useCallback:jw,useContext:fn,useEffect:Mw,useImperativeHandle:Dw,useInsertionEffect:Iw,useLayoutEffect:Ow,useMemo:Bw,useReducer:Jc,useRef:Nw,useState:function(){return Jc(Zr)},useDebugValue:lp,useDeferredValue:function(a,c){var f=Lt();return Lw(f,st.memoizedState,a,c)},useTransition:function(){var a=Jc(Zr)[0],c=Lt().memoizedState;return[typeof a=="boolean"?a:Wo(a),c]},useSyncExternalStore:hw,useId:Vw,useHostTransitionStatus:fp,useFormState:Aw,useActionState:Aw,useOptimistic:function(a,c){var f=Lt();return yw(f,st,a,c)},useMemoCache:rp,useCacheRefresh:qw},vj={readContext:fn,use:Qc,useCallback:jw,useContext:fn,useEffect:Mw,useImperativeHandle:Dw,useInsertionEffect:Iw,useLayoutEffect:Ow,useMemo:Bw,useReducer:sp,useRef:Nw,useState:function(){return sp(Zr)},useDebugValue:lp,useDeferredValue:function(a,c){var f=Lt();return st===null?cp(f,a,c):Lw(f,st.memoizedState,a,c)},useTransition:function(){var a=sp(Zr)[0],c=Lt().memoizedState;return[typeof a=="boolean"?a:Wo(a),c]},useSyncExternalStore:hw,useId:Vw,useHostTransitionStatus:fp,useFormState:Cw,useActionState:Cw,useOptimistic:function(a,c){var f=Lt();return st!==null?yw(f,st,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:rp,useCacheRefresh:qw},ya=null,Go=0;function iu(a){var c=Go;return Go+=1,ya===null&&(ya=[]),sw(ya,a,c)}function Ko(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function su(a,c){throw c.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function Gw(a){var c=a._init;return c(a._payload)}function Kw(a){function c(se,Q){if(a){var ce=se.deletions;ce===null?(se.deletions=[Q],se.flags|=16):ce.push(Q)}}function f(se,Q){if(!a)return null;for(;Q!==null;)c(se,Q),Q=Q.sibling;return null}function p(se){for(var Q=new Map;se!==null;)se.key!==null?Q.set(se.key,se):Q.set(se.index,se),se=se.sibling;return Q}function v(se,Q){return se=Wr(se,Q),se.index=0,se.sibling=null,se}function b(se,Q,ce){return se.index=ce,a?(ce=se.alternate,ce!==null?(ce=ce.index,ce<Q?(se.flags|=67108866,Q):ce):(se.flags|=67108866,Q)):(se.flags|=1048576,Q)}function C(se){return a&&se.alternate===null&&(se.flags|=67108866),se}function B(se,Q,ce,ge){return Q===null||Q.tag!==6?(Q=Oh(ce,se.mode,ge),Q.return=se,Q):(Q=v(Q,ce),Q.return=se,Q)}function K(se,Q,ce,ge){var Ee=ce.type;return Ee===T?pe(se,Q,ce.props.children,ge,ce.key):Q!==null&&(Q.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===N&&Gw(Ee)===Q.type)?(Q=v(Q,ce.props),Ko(Q,ce),Q.return=se,Q):(Q=zc(ce.type,ce.key,ce.props,null,se.mode,ge),Ko(Q,ce),Q.return=se,Q)}function fe(se,Q,ce,ge){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ce.containerInfo||Q.stateNode.implementation!==ce.implementation?(Q=Ph(ce,se.mode,ge),Q.return=se,Q):(Q=v(Q,ce.children||[]),Q.return=se,Q)}function pe(se,Q,ce,ge,Ee){return Q===null||Q.tag!==7?(Q=as(ce,se.mode,ge,Ee),Q.return=se,Q):(Q=v(Q,ce),Q.return=se,Q)}function ve(se,Q,ce){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=Oh(""+Q,se.mode,ce),Q.return=se,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case _:return ce=zc(Q.type,Q.key,Q.props,null,se.mode,ce),Ko(ce,Q),ce.return=se,ce;case y:return Q=Ph(Q,se.mode,ce),Q.return=se,Q;case N:var ge=Q._init;return Q=ge(Q._payload),ve(se,Q,ce)}if(J(Q)||X(Q))return Q=as(Q,se.mode,ce,null),Q.return=se,Q;if(typeof Q.then=="function")return ve(se,iu(Q),ce);if(Q.$$typeof===E)return ve(se,Hc(se,Q),ce);su(se,Q)}return null}function de(se,Q,ce,ge){var Ee=Q!==null?Q.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ee!==null?null:B(se,Q,""+ce,ge);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:return ce.key===Ee?K(se,Q,ce,ge):null;case y:return ce.key===Ee?fe(se,Q,ce,ge):null;case N:return Ee=ce._init,ce=Ee(ce._payload),de(se,Q,ce,ge)}if(J(ce)||X(ce))return Ee!==null?null:pe(se,Q,ce,ge,null);if(typeof ce.then=="function")return de(se,Q,iu(ce),ge);if(ce.$$typeof===E)return de(se,Q,Hc(se,ce),ge);su(se,ce)}return null}function he(se,Q,ce,ge,Ee){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return se=se.get(ce)||null,B(Q,se,""+ge,Ee);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case _:return se=se.get(ge.key===null?ce:ge.key)||null,K(Q,se,ge,Ee);case y:return se=se.get(ge.key===null?ce:ge.key)||null,fe(Q,se,ge,Ee);case N:var Ue=ge._init;return ge=Ue(ge._payload),he(se,Q,ce,ge,Ee)}if(J(ge)||X(ge))return se=se.get(ce)||null,pe(Q,se,ge,Ee,null);if(typeof ge.then=="function")return he(se,Q,ce,iu(ge),Ee);if(ge.$$typeof===E)return he(se,Q,ce,Hc(Q,ge),Ee);su(Q,ge)}return null}function Pe(se,Q,ce,ge){for(var Ee=null,Ue=null,Ne=Q,Ie=Q=0,Jt=null;Ne!==null&&Ie<ce.length;Ie++){Ne.index>Ie?(Jt=Ne,Ne=null):Jt=Ne.sibling;var Ke=de(se,Ne,ce[Ie],ge);if(Ke===null){Ne===null&&(Ne=Jt);break}a&&Ne&&Ke.alternate===null&&c(se,Ne),Q=b(Ke,Q,Ie),Ue===null?Ee=Ke:Ue.sibling=Ke,Ue=Ke,Ne=Jt}if(Ie===ce.length)return f(se,Ne),Qe&&ls(se,Ie),Ee;if(Ne===null){for(;Ie<ce.length;Ie++)Ne=ve(se,ce[Ie],ge),Ne!==null&&(Q=b(Ne,Q,Ie),Ue===null?Ee=Ne:Ue.sibling=Ne,Ue=Ne);return Qe&&ls(se,Ie),Ee}for(Ne=p(Ne);Ie<ce.length;Ie++)Jt=he(Ne,se,Ie,ce[Ie],ge),Jt!==null&&(a&&Jt.alternate!==null&&Ne.delete(Jt.key===null?Ie:Jt.key),Q=b(Jt,Q,Ie),Ue===null?Ee=Jt:Ue.sibling=Jt,Ue=Jt);return a&&Ne.forEach(function(Bi){return c(se,Bi)}),Qe&&ls(se,Ie),Ee}function ke(se,Q,ce,ge){if(ce==null)throw Error(r(151));for(var Ee=null,Ue=null,Ne=Q,Ie=Q=0,Jt=null,Ke=ce.next();Ne!==null&&!Ke.done;Ie++,Ke=ce.next()){Ne.index>Ie?(Jt=Ne,Ne=null):Jt=Ne.sibling;var Bi=de(se,Ne,Ke.value,ge);if(Bi===null){Ne===null&&(Ne=Jt);break}a&&Ne&&Bi.alternate===null&&c(se,Ne),Q=b(Bi,Q,Ie),Ue===null?Ee=Bi:Ue.sibling=Bi,Ue=Bi,Ne=Jt}if(Ke.done)return f(se,Ne),Qe&&ls(se,Ie),Ee;if(Ne===null){for(;!Ke.done;Ie++,Ke=ce.next())Ke=ve(se,Ke.value,ge),Ke!==null&&(Q=b(Ke,Q,Ie),Ue===null?Ee=Ke:Ue.sibling=Ke,Ue=Ke);return Qe&&ls(se,Ie),Ee}for(Ne=p(Ne);!Ke.done;Ie++,Ke=ce.next())Ke=he(Ne,se,Ie,Ke.value,ge),Ke!==null&&(a&&Ke.alternate!==null&&Ne.delete(Ke.key===null?Ie:Ke.key),Q=b(Ke,Q,Ie),Ue===null?Ee=Ke:Ue.sibling=Ke,Ue=Ke);return a&&Ne.forEach(function(yB){return c(se,yB)}),Qe&&ls(se,Ie),Ee}function ot(se,Q,ce,ge){if(typeof ce=="object"&&ce!==null&&ce.type===T&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:e:{for(var Ee=ce.key;Q!==null;){if(Q.key===Ee){if(Ee=ce.type,Ee===T){if(Q.tag===7){f(se,Q.sibling),ge=v(Q,ce.props.children),ge.return=se,se=ge;break e}}else if(Q.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===N&&Gw(Ee)===Q.type){f(se,Q.sibling),ge=v(Q,ce.props),Ko(ge,ce),ge.return=se,se=ge;break e}f(se,Q);break}else c(se,Q);Q=Q.sibling}ce.type===T?(ge=as(ce.props.children,se.mode,ge,ce.key),ge.return=se,se=ge):(ge=zc(ce.type,ce.key,ce.props,null,se.mode,ge),Ko(ge,ce),ge.return=se,se=ge)}return C(se);case y:e:{for(Ee=ce.key;Q!==null;){if(Q.key===Ee)if(Q.tag===4&&Q.stateNode.containerInfo===ce.containerInfo&&Q.stateNode.implementation===ce.implementation){f(se,Q.sibling),ge=v(Q,ce.children||[]),ge.return=se,se=ge;break e}else{f(se,Q);break}else c(se,Q);Q=Q.sibling}ge=Ph(ce,se.mode,ge),ge.return=se,se=ge}return C(se);case N:return Ee=ce._init,ce=Ee(ce._payload),ot(se,Q,ce,ge)}if(J(ce))return Pe(se,Q,ce,ge);if(X(ce)){if(Ee=X(ce),typeof Ee!="function")throw Error(r(150));return ce=Ee.call(ce),ke(se,Q,ce,ge)}if(typeof ce.then=="function")return ot(se,Q,iu(ce),ge);if(ce.$$typeof===E)return ot(se,Q,Hc(se,ce),ge);su(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,Q!==null&&Q.tag===6?(f(se,Q.sibling),ge=v(Q,ce),ge.return=se,se=ge):(f(se,Q),ge=Oh(ce,se.mode,ge),ge.return=se,se=ge),C(se)):f(se,Q)}return function(se,Q,ce,ge){try{Go=0;var Ee=ot(se,Q,ce,ge);return ya=null,Ee}catch(Ne){if(Ne===Fo||Ne===Xc)throw Ne;var Ue=Dn(29,Ne,null,se.mode);return Ue.lanes=ge,Ue.return=se,Ue}finally{}}}var ba=Kw(!0),Zw=Kw(!1),er=H(null),Nr=null;function wi(a){var c=a.alternate;re(Ht,Ht.current&1),re(er,a),Nr===null&&(c===null||ga.current!==null||c.memoizedState!==null)&&(Nr=a)}function Qw(a){if(a.tag===22){if(re(Ht,Ht.current),re(er,a),Nr===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Nr=a)}}else Ti()}function Ti(){re(Ht,Ht.current),re(er,er.current)}function Qr(a){ie(er),Nr===a&&(Nr=null),ie(Ht)}var Ht=H(0);function au(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||ng(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function hp(a,c,f,p){c=a.memoizedState,f=f(p,c),f=f==null?c:h({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var pp={enqueueSetState:function(a,c,f){a=a._reactInternals;var p=Un(),v=yi(p);v.payload=c,f!=null&&(v.callback=f),c=bi(a,v,p),c!==null&&(Fn(c,a,p),Vo(c,a,p))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var p=Un(),v=yi(p);v.tag=1,v.payload=c,f!=null&&(v.callback=f),c=bi(a,v,p),c!==null&&(Fn(c,a,p),Vo(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=Un(),p=yi(f);p.tag=2,c!=null&&(p.callback=c),c=bi(a,p,f),c!==null&&(Fn(c,a,f),Vo(c,a,f))}};function Jw(a,c,f,p,v,b,C){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,b,C):c.prototype&&c.prototype.isPureReactComponent?!Io(f,p)||!Io(v,b):!0}function eT(a,c,f,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==a&&pp.enqueueReplaceState(c,c.state,null)}function gs(a,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(a=a.defaultProps){f===c&&(f=h({},f));for(var v in a)f[v]===void 0&&(f[v]=a[v])}return f}var ou=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function tT(a){ou(a)}function nT(a){console.error(a)}function rT(a){ou(a)}function lu(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function iT(a,c,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function gp(a,c,f){return f=yi(f),f.tag=3,f.payload={element:null},f.callback=function(){lu(a,c)},f}function sT(a){return a=yi(a),a.tag=3,a}function aT(a,c,f,p){var v=f.type.getDerivedStateFromError;if(typeof v=="function"){var b=p.value;a.payload=function(){return v(b)},a.callback=function(){iT(c,f,p)}}var C=f.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(a.callback=function(){iT(c,f,p),typeof v!="function"&&(Ni===null?Ni=new Set([this]):Ni.add(this));var B=p.stack;this.componentDidCatch(p.value,{componentStack:B!==null?B:""})})}function yj(a,c,f,p,v){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&Bo(c,f,v,!0),f=er.current,f!==null){switch(f.tag){case 13:return Nr===null?Up():f.alternate===null&&Ct===0&&(Ct=3),f.flags&=-257,f.flags|=65536,f.lanes=v,p===$h?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),zp(a,p,v)),!1;case 22:return f.flags|=65536,p===$h?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),zp(a,p,v)),!1}throw Error(r(435,f.tag))}return zp(a,p,v),Up(),!1}if(Qe)return c=er.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,p!==Bh&&(a=Error(r(422),{cause:p}),jo(Kn(a,f)))):(p!==Bh&&(c=Error(r(423),{cause:p}),jo(Kn(c,f))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,p=Kn(p,f),v=gp(a.stateNode,p,v),Xh(a,v),Ct!==4&&(Ct=2)),!1;var b=Error(r(520),{cause:p});if(b=Kn(b,f),rl===null?rl=[b]:rl.push(b),Ct!==4&&(Ct=2),c===null)return!0;p=Kn(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=v&-v,f.lanes|=a,a=gp(f.stateNode,p,a),Xh(f,a),!1;case 1:if(c=f.type,b=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ni===null||!Ni.has(b))))return f.flags|=65536,v&=-v,f.lanes|=v,v=sT(v),aT(v,a,f,p),Xh(f,v),!1}f=f.return}while(f!==null);return!1}var oT=Error(r(461)),Zt=!1;function nn(a,c,f,p){c.child=a===null?Zw(c,null,f,p):ba(c,a.child,f,p)}function lT(a,c,f,p,v){f=f.render;var b=c.ref;if("ref"in p){var C={};for(var B in p)B!=="ref"&&(C[B]=p[B])}else C=p;return ds(c),p=Qh(a,c,f,C,b,v),B=Jh(),a!==null&&!Zt?(ep(a,c,v),Jr(a,c,v)):(Qe&&B&&Dh(c),c.flags|=1,nn(a,c,p,v),c.child)}function cT(a,c,f,p,v){if(a===null){var b=f.type;return typeof b=="function"&&!Ih(b)&&b.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=b,uT(a,c,b,p,v)):(a=zc(f.type,null,p,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(b=a.child,!Tp(a,v)){var C=b.memoizedProps;if(f=f.compare,f=f!==null?f:Io,f(C,p)&&a.ref===c.ref)return Jr(a,c,v)}return c.flags|=1,a=Wr(b,p),a.ref=c.ref,a.return=c,c.child=a}function uT(a,c,f,p,v){if(a!==null){var b=a.memoizedProps;if(Io(b,p)&&a.ref===c.ref)if(Zt=!1,c.pendingProps=p=b,Tp(a,v))(a.flags&131072)!==0&&(Zt=!0);else return c.lanes=a.lanes,Jr(a,c,v)}return mp(a,c,f,p,v)}function fT(a,c,f){var p=c.pendingProps,v=p.children,b=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=b!==null?b.baseLanes|f:f,a!==null){for(v=c.child=a.child,b=0;v!==null;)b=b|v.lanes|v.childLanes,v=v.sibling;c.childLanes=b&~p}else c.childLanes=0,c.child=null;return dT(a,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&Wc(c,b!==null?b.cachePool:null),b!==null?uw(c,b):Gh(),Qw(c);else return c.lanes=c.childLanes=536870912,dT(a,c,b!==null?b.baseLanes|f:f,f)}else b!==null?(Wc(c,b.cachePool),uw(c,b),Ti(),c.memoizedState=null):(a!==null&&Wc(c,null),Gh(),Ti());return nn(a,c,v,f),c.child}function dT(a,c,f,p){var v=qh();return v=v===null?null:{parent:$t._currentValue,pool:v},c.memoizedState={baseLanes:f,cachePool:v},a!==null&&Wc(c,null),Gh(),Qw(c),a!==null&&Bo(a,c,p,!0),null}function cu(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function mp(a,c,f,p,v){return ds(c),f=Qh(a,c,f,p,void 0,v),p=Jh(),a!==null&&!Zt?(ep(a,c,v),Jr(a,c,v)):(Qe&&p&&Dh(c),c.flags|=1,nn(a,c,f,v),c.child)}function hT(a,c,f,p,v,b){return ds(c),c.updateQueue=null,f=dw(c,p,f,v),fw(a),p=Jh(),a!==null&&!Zt?(ep(a,c,b),Jr(a,c,b)):(Qe&&p&&Dh(c),c.flags|=1,nn(a,c,f,b),c.child)}function pT(a,c,f,p,v){if(ds(c),c.stateNode===null){var b=ua,C=f.contextType;typeof C=="object"&&C!==null&&(b=fn(C)),b=new f(p,b),c.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=pp,c.stateNode=b,b._reactInternals=c,b=c.stateNode,b.props=p,b.state=c.memoizedState,b.refs={},Hh(c),C=f.contextType,b.context=typeof C=="object"&&C!==null?fn(C):ua,b.state=c.memoizedState,C=f.getDerivedStateFromProps,typeof C=="function"&&(hp(c,f,C,p),b.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(C=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),C!==b.state&&pp.enqueueReplaceState(b,b.state,null),$o(c,p,b,v),qo(),b.state=c.memoizedState),typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){b=c.stateNode;var B=c.memoizedProps,K=gs(f,B);b.props=K;var fe=b.context,pe=f.contextType;C=ua,typeof pe=="object"&&pe!==null&&(C=fn(pe));var ve=f.getDerivedStateFromProps;pe=typeof ve=="function"||typeof b.getSnapshotBeforeUpdate=="function",B=c.pendingProps!==B,pe||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(B||fe!==C)&&eT(c,b,p,C),vi=!1;var de=c.memoizedState;b.state=de,$o(c,p,b,v),qo(),fe=c.memoizedState,B||de!==fe||vi?(typeof ve=="function"&&(hp(c,f,ve,p),fe=c.memoizedState),(K=vi||Jw(c,f,K,p,de,fe,C))?(pe||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(c.flags|=4194308)):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=fe),b.props=p,b.state=fe,b.context=C,p=K):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{b=c.stateNode,Wh(a,c),C=c.memoizedProps,pe=gs(f,C),b.props=pe,ve=c.pendingProps,de=b.context,fe=f.contextType,K=ua,typeof fe=="object"&&fe!==null&&(K=fn(fe)),B=f.getDerivedStateFromProps,(fe=typeof B=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C!==ve||de!==K)&&eT(c,b,p,K),vi=!1,de=c.memoizedState,b.state=de,$o(c,p,b,v),qo();var he=c.memoizedState;C!==ve||de!==he||vi||a!==null&&a.dependencies!==null&&$c(a.dependencies)?(typeof B=="function"&&(hp(c,f,B,p),he=c.memoizedState),(pe=vi||Jw(c,f,pe,p,de,he,K)||a!==null&&a.dependencies!==null&&$c(a.dependencies))?(fe||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(p,he,K),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(p,he,K)),typeof b.componentDidUpdate=="function"&&(c.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof b.componentDidUpdate!="function"||C===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=he),b.props=p,b.state=he,b.context=K,p=pe):(typeof b.componentDidUpdate!="function"||C===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),p=!1)}return b=p,cu(a,c),p=(c.flags&128)!==0,b||p?(b=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:b.render(),c.flags|=1,a!==null&&p?(c.child=ba(c,a.child,null,v),c.child=ba(c,null,f,v)):nn(a,c,f,v),c.memoizedState=b.state,a=c.child):a=Jr(a,c,v),a}function gT(a,c,f,p){return Do(),c.flags|=256,nn(a,c,f,p),c.child}var _p={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vp(a){return{baseLanes:a,cachePool:nw()}}function yp(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=tr),a}function mT(a,c,f){var p=c.pendingProps,v=!1,b=(c.flags&128)!==0,C;if((C=b)||(C=a!==null&&a.memoizedState===null?!1:(Ht.current&2)!==0),C&&(v=!0,c.flags&=-129),C=(c.flags&32)!==0,c.flags&=-33,a===null){if(Qe){if(v?wi(c):Ti(),Qe){var B=Rt,K;if(K=B){e:{for(K=B,B=Cr;K.nodeType!==8;){if(!B){B=null;break e}if(K=gr(K.nextSibling),K===null){B=null;break e}}B=K}B!==null?(c.memoizedState={dehydrated:B,treeContext:os!==null?{id:Xr,overflow:Yr}:null,retryLane:536870912,hydrationErrors:null},K=Dn(18,null,null,0),K.stateNode=B,K.return=c,c.child=K,vn=c,Rt=null,K=!0):K=!1}K||us(c)}if(B=c.memoizedState,B!==null&&(B=B.dehydrated,B!==null))return ng(B)?c.lanes=32:c.lanes=536870912,null;Qr(c)}return B=p.children,p=p.fallback,v?(Ti(),v=c.mode,B=uu({mode:"hidden",children:B},v),p=as(p,v,f,null),B.return=c,p.return=c,B.sibling=p,c.child=B,v=c.child,v.memoizedState=vp(f),v.childLanes=yp(a,C,f),c.memoizedState=_p,p):(wi(c),bp(c,B))}if(K=a.memoizedState,K!==null&&(B=K.dehydrated,B!==null)){if(b)c.flags&256?(wi(c),c.flags&=-257,c=xp(a,c,f)):c.memoizedState!==null?(Ti(),c.child=a.child,c.flags|=128,c=null):(Ti(),v=p.fallback,B=c.mode,p=uu({mode:"visible",children:p.children},B),v=as(v,B,f,null),v.flags|=2,p.return=c,v.return=c,p.sibling=v,c.child=p,ba(c,a.child,null,f),p=c.child,p.memoizedState=vp(f),p.childLanes=yp(a,C,f),c.memoizedState=_p,c=v);else if(wi(c),ng(B)){if(C=B.nextSibling&&B.nextSibling.dataset,C)var fe=C.dgst;C=fe,p=Error(r(419)),p.stack="",p.digest=C,jo({value:p,source:null,stack:null}),c=xp(a,c,f)}else if(Zt||Bo(a,c,f,!1),C=(f&a.childLanes)!==0,Zt||C){if(C=gt,C!==null&&(p=f&-f,p=(p&42)!==0?1:rh(p),p=(p&(C.suspendedLanes|f))!==0?0:p,p!==0&&p!==K.retryLane))throw K.retryLane=p,ca(a,p),Fn(C,a,p),oT;B.data==="$?"||Up(),c=xp(a,c,f)}else B.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=K.treeContext,Rt=gr(B.nextSibling),vn=c,Qe=!0,cs=null,Cr=!1,a!==null&&(Qn[Jn++]=Xr,Qn[Jn++]=Yr,Qn[Jn++]=os,Xr=a.id,Yr=a.overflow,os=c),c=bp(c,p.children),c.flags|=4096);return c}return v?(Ti(),v=p.fallback,B=c.mode,K=a.child,fe=K.sibling,p=Wr(K,{mode:"hidden",children:p.children}),p.subtreeFlags=K.subtreeFlags&65011712,fe!==null?v=Wr(fe,v):(v=as(v,B,f,null),v.flags|=2),v.return=c,p.return=c,p.sibling=v,c.child=p,p=v,v=c.child,B=a.child.memoizedState,B===null?B=vp(f):(K=B.cachePool,K!==null?(fe=$t._currentValue,K=K.parent!==fe?{parent:fe,pool:fe}:K):K=nw(),B={baseLanes:B.baseLanes|f,cachePool:K}),v.memoizedState=B,v.childLanes=yp(a,C,f),c.memoizedState=_p,p):(wi(c),f=a.child,a=f.sibling,f=Wr(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,a!==null&&(C=c.deletions,C===null?(c.deletions=[a],c.flags|=16):C.push(a)),c.child=f,c.memoizedState=null,f)}function bp(a,c){return c=uu({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function uu(a,c){return a=Dn(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function xp(a,c,f){return ba(c,a.child,null,f),a=bp(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function _T(a,c,f){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),Uh(a.return,c,f)}function wp(a,c,f,p,v){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:v}:(b.isBackwards=c,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=f,b.tailMode=v)}function vT(a,c,f){var p=c.pendingProps,v=p.revealOrder,b=p.tail;if(nn(a,c,p.children,f),p=Ht.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&_T(a,f,c);else if(a.tag===19)_T(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(re(Ht,p),v){case"forwards":for(f=c.child,v=null;f!==null;)a=f.alternate,a!==null&&au(a)===null&&(v=f),f=f.sibling;f=v,f===null?(v=c.child,c.child=null):(v=f.sibling,f.sibling=null),wp(c,!1,v,f,b);break;case"backwards":for(f=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&au(a)===null){c.child=v;break}a=v.sibling,v.sibling=f,f=v,v=a}wp(c,!0,f,null,b);break;case"together":wp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function Jr(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Ci|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(Bo(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=Wr(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=Wr(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Tp(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&$c(a)))}function bj(a,c,f){switch(c.tag){case 3:ye(c,c.stateNode.containerInfo),_i(c,$t,a.memoizedState.cache),Do();break;case 27:case 5:Me(c);break;case 4:ye(c,c.stateNode.containerInfo);break;case 10:_i(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(wi(c),c.flags|=128,null):(f&c.child.childLanes)!==0?mT(a,c,f):(wi(c),a=Jr(a,c,f),a!==null?a.sibling:null);wi(c);break;case 19:var v=(a.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(Bo(a,c,f,!1),p=(f&c.childLanes)!==0),v){if(p)return vT(a,c,f);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),re(Ht,Ht.current),p)break;return null;case 22:case 23:return c.lanes=0,fT(a,c,f);case 24:_i(c,$t,a.memoizedState.cache)}return Jr(a,c,f)}function yT(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)Zt=!0;else{if(!Tp(a,f)&&(c.flags&128)===0)return Zt=!1,bj(a,c,f);Zt=(a.flags&131072)!==0}else Zt=!1,Qe&&(c.flags&1048576)!==0&&G2(c,qc,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var p=c.elementType,v=p._init;if(p=v(p._payload),c.type=p,typeof p=="function")Ih(p)?(a=gs(p,a),c.tag=1,c=pT(null,c,p,a,f)):(c.tag=0,c=mp(null,c,p,a,f));else{if(p!=null){if(v=p.$$typeof,v===A){c.tag=11,c=lT(null,c,p,a,f);break e}else if(v===j){c.tag=14,c=cT(null,c,p,a,f);break e}}throw c=L(p)||p,Error(r(306,c,""))}}return c;case 0:return mp(a,c,c.type,c.pendingProps,f);case 1:return p=c.type,v=gs(p,c.pendingProps),pT(a,c,p,v,f);case 3:e:{if(ye(c,c.stateNode.containerInfo),a===null)throw Error(r(387));p=c.pendingProps;var b=c.memoizedState;v=b.element,Wh(a,c),$o(c,p,null,f);var C=c.memoizedState;if(p=C.cache,_i(c,$t,p),p!==b.cache&&Fh(c,[$t],f,!0),qo(),p=C.element,b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:C.cache},c.updateQueue.baseState=b,c.memoizedState=b,c.flags&256){c=gT(a,c,p,f);break e}else if(p!==v){v=Kn(Error(r(424)),c),jo(v),c=gT(a,c,p,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Rt=gr(a.firstChild),vn=c,Qe=!0,cs=null,Cr=!0,f=Zw(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(Do(),p===v){c=Jr(a,c,f);break e}nn(a,c,p,f)}c=c.child}return c;case 26:return cu(a,c),a===null?(f=T3(c.type,null,c.pendingProps,null))?c.memoizedState=f:Qe||(f=c.type,a=c.pendingProps,p=Su(oe.current).createElement(f),p[un]=c,p[An]=a,sn(p,f,a),Kt(p),c.stateNode=p):c.memoizedState=T3(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Me(c),a===null&&Qe&&(p=c.stateNode=b3(c.type,c.pendingProps,oe.current),vn=c,Cr=!0,v=Rt,Ii(c.type)?(rg=v,Rt=gr(p.firstChild)):Rt=v),nn(a,c,c.pendingProps.children,f),cu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Qe&&((v=p=Rt)&&(p=Yj(p,c.type,c.pendingProps,Cr),p!==null?(c.stateNode=p,vn=c,Rt=gr(p.firstChild),Cr=!1,v=!0):v=!1),v||us(c)),Me(c),v=c.type,b=c.pendingProps,C=a!==null?a.memoizedProps:null,p=b.children,Jp(v,b)?p=null:C!==null&&Jp(v,C)&&(c.flags|=32),c.memoizedState!==null&&(v=Qh(a,c,dj,null,null,f),dl._currentValue=v),cu(a,c),nn(a,c,p,f),c.child;case 6:return a===null&&Qe&&((a=f=Rt)&&(f=Gj(f,c.pendingProps,Cr),f!==null?(c.stateNode=f,vn=c,Rt=null,a=!0):a=!1),a||us(c)),null;case 13:return mT(a,c,f);case 4:return ye(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=ba(c,null,p,f):nn(a,c,p,f),c.child;case 11:return lT(a,c,c.type,c.pendingProps,f);case 7:return nn(a,c,c.pendingProps,f),c.child;case 8:return nn(a,c,c.pendingProps.children,f),c.child;case 12:return nn(a,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,_i(c,c.type,p.value),nn(a,c,p.children,f),c.child;case 9:return v=c.type._context,p=c.pendingProps.children,ds(c),v=fn(v),p=p(v),c.flags|=1,nn(a,c,p,f),c.child;case 14:return cT(a,c,c.type,c.pendingProps,f);case 15:return uT(a,c,c.type,c.pendingProps,f);case 19:return vT(a,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},a===null?(f=uu(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Wr(a.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return fT(a,c,f);case 24:return ds(c),p=fn($t),a===null?(v=qh(),v===null&&(v=gt,b=zh(),v.pooledCache=b,b.refCount++,b!==null&&(v.pooledCacheLanes|=f),v=b),c.memoizedState={parent:p,cache:v},Hh(c),_i(c,$t,v)):((a.lanes&f)!==0&&(Wh(a,c),$o(c,null,null,f),qo()),v=a.memoizedState,b=c.memoizedState,v.parent!==p?(v={parent:p,cache:p},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),_i(c,$t,p)):(p=b.cache,_i(c,$t,p),p!==v.cache&&Fh(c,[$t],f,!0))),nn(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function ei(a){a.flags|=4}function bT(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!C3(c)){if(c=er.current,c!==null&&((He&4194048)===He?Nr!==null:(He&62914560)!==He&&(He&536870912)===0||c!==Nr))throw zo=$h,rw;a.flags|=8192}}function fu(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?xo():536870912,a.lanes|=c,Sa|=c)}function Zo(a,c){if(!Qe)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Et(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(c)for(var v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags&65011712,p|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=p,a.childLanes=f,c}function xj(a,c,f){var p=c.pendingProps;switch(jh(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(c),null;case 1:return Et(c),null;case 3:return f=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),Kr($t),Ae(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Po(c)?ei(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Q2())),Et(c),null;case 26:return f=c.memoizedState,a===null?(ei(c),f!==null?(Et(c),bT(c,f)):(Et(c),c.flags&=-16777217)):f?f!==a.memoizedState?(ei(c),Et(c),bT(c,f)):(Et(c),c.flags&=-16777217):(a.memoizedProps!==p&&ei(c),Et(c),c.flags&=-16777217),null;case 27:Ze(c),f=oe.current;var v=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ei(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Et(c),null}a=U.current,Po(c)?K2(c):(a=b3(v,p,f),c.stateNode=a,ei(c))}return Et(c),null;case 5:if(Ze(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ei(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Et(c),null}if(a=U.current,Po(c))K2(c);else{switch(v=Su(oe.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?v.createElement("select",{is:p.is}):v.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?v.createElement(f,{is:p.is}):v.createElement(f)}}a[un]=c,a[An]=p;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=a;e:switch(sn(a,f,p),f){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&ei(c)}}return Et(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&ei(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(a=oe.current,Po(c)){if(a=c.stateNode,f=c.memoizedProps,p=null,v=vn,v!==null)switch(v.tag){case 27:case 5:p=v.memoizedProps}a[un]=c,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||h3(a.nodeValue,f)),a||us(c)}else a=Su(a).createTextNode(p),a[un]=c,c.stateNode=a}return Et(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=Po(c),p!==null&&p.dehydrated!==null){if(a===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[un]=c}else Do(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Et(c),v=!1}else v=Q2(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(Qr(c),c):(Qr(c),null)}if(Qr(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,a=a!==null&&a.memoizedState!==null,f){p=c.child,v=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(v=p.alternate.memoizedState.cachePool.pool);var b=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(b=p.memoizedState.cachePool.pool),b!==v&&(p.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),fu(c,c.updateQueue),Et(c),null;case 4:return Ae(),a===null&&Yp(c.stateNode.containerInfo),Et(c),null;case 10:return Kr(c.type),Et(c),null;case 19:if(ie(Ht),v=c.memoizedState,v===null)return Et(c),null;if(p=(c.flags&128)!==0,b=v.rendering,b===null)if(p)Zo(v,!1);else{if(Ct!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(b=au(a),b!==null){for(c.flags|=128,Zo(v,!1),a=b.updateQueue,c.updateQueue=a,fu(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)Y2(f,a),f=f.sibling;return re(Ht,Ht.current&1|2),c.child}a=a.sibling}v.tail!==null&&Ce()>pu&&(c.flags|=128,p=!0,Zo(v,!1),c.lanes=4194304)}else{if(!p)if(a=au(b),a!==null){if(c.flags|=128,p=!0,a=a.updateQueue,c.updateQueue=a,fu(c,a),Zo(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!Qe)return Et(c),null}else 2*Ce()-v.renderingStartTime>pu&&f!==536870912&&(c.flags|=128,p=!0,Zo(v,!1),c.lanes=4194304);v.isBackwards?(b.sibling=c.child,c.child=b):(a=v.last,a!==null?a.sibling=b:c.child=b,v.last=b)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Ce(),c.sibling=null,a=Ht.current,re(Ht,p?a&1|2:a&1),c):(Et(c),null);case 22:case 23:return Qr(c),Kh(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Et(c),c.subtreeFlags&6&&(c.flags|=8192)):Et(c),f=c.updateQueue,f!==null&&fu(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),a!==null&&ie(hs),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Kr($t),Et(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function wj(a,c){switch(jh(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return Kr($t),Ae(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Ze(c),null;case 13:if(Qr(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));Do()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return ie(Ht),null;case 4:return Ae(),null;case 10:return Kr(c.type),null;case 22:case 23:return Qr(c),Kh(),a!==null&&ie(hs),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return Kr($t),null;case 25:return null;default:return null}}function xT(a,c){switch(jh(c),c.tag){case 3:Kr($t),Ae();break;case 26:case 27:case 5:Ze(c);break;case 4:Ae();break;case 13:Qr(c);break;case 19:ie(Ht);break;case 10:Kr(c.type);break;case 22:case 23:Qr(c),Kh(),a!==null&&ie(hs);break;case 24:Kr($t)}}function Qo(a,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var v=p.next;f=v;do{if((f.tag&a)===a){p=void 0;var b=f.create,C=f.inst;p=b(),C.destroy=p}f=f.next}while(f!==v)}}catch(B){ft(c,c.return,B)}}function Si(a,c,f){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var b=v.next;p=b;do{if((p.tag&a)===a){var C=p.inst,B=C.destroy;if(B!==void 0){C.destroy=void 0,v=c;var K=f,fe=B;try{fe()}catch(pe){ft(v,K,pe)}}}p=p.next}while(p!==b)}}catch(pe){ft(c,c.return,pe)}}function wT(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{cw(c,f)}catch(p){ft(a,a.return,p)}}}function TT(a,c,f){f.props=gs(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){ft(a,c,p)}}function Jo(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(v){ft(a,c,v)}}function kr(a,c){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(v){ft(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(v){ft(a,c,v)}else f.current=null}function ST(a){var c=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(v){ft(a,a.return,v)}}function Sp(a,c,f){try{var p=a.stateNode;qj(p,a.type,f,c),p[An]=c}catch(v){ft(a,a.return,v)}}function ET(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ii(a.type)||a.tag===4}function Ep(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ET(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ii(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Ap(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Tu));else if(p!==4&&(p===27&&Ii(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Ap(a,c,f),a=a.sibling;a!==null;)Ap(a,c,f),a=a.sibling}function du(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(p!==4&&(p===27&&Ii(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(du(a,c,f),a=a.sibling;a!==null;)du(a,c,f),a=a.sibling}function AT(a){var c=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);sn(c,p,f),c[un]=a,c[An]=f}catch(b){ft(a,a.return,b)}}var ti=!1,Pt=!1,Rp=!1,RT=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function Tj(a,c){if(a=a.containerInfo,Zp=ku,a=L2(a),Eh(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var v=p.anchorOffset,b=p.focusNode;p=p.focusOffset;try{f.nodeType,b.nodeType}catch{f=null;break e}var C=0,B=-1,K=-1,fe=0,pe=0,ve=a,de=null;t:for(;;){for(var he;ve!==f||v!==0&&ve.nodeType!==3||(B=C+v),ve!==b||p!==0&&ve.nodeType!==3||(K=C+p),ve.nodeType===3&&(C+=ve.nodeValue.length),(he=ve.firstChild)!==null;)de=ve,ve=he;for(;;){if(ve===a)break t;if(de===f&&++fe===v&&(B=C),de===b&&++pe===p&&(K=C),(he=ve.nextSibling)!==null)break;ve=de,de=ve.parentNode}ve=he}f=B===-1||K===-1?null:{start:B,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(Qp={focusedElem:a,selectionRange:f},ku=!1,Qt=c;Qt!==null;)if(c=Qt,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,Qt=a;else for(;Qt!==null;){switch(c=Qt,b=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,f=c,v=b.memoizedProps,b=b.memoizedState,p=f.stateNode;try{var Pe=gs(f.type,v,f.elementType===f.type);a=p.getSnapshotBeforeUpdate(Pe,b),p.__reactInternalSnapshotBeforeUpdate=a}catch(ke){ft(f,f.return,ke)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)tg(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":tg(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,Qt=a;break}Qt=c.return}}function CT(a,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Ei(a,f),p&4&&Qo(5,f);break;case 1:if(Ei(a,f),p&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(C){ft(f,f.return,C)}else{var v=gs(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(C){ft(f,f.return,C)}}p&64&&wT(f),p&512&&Jo(f,f.return);break;case 3:if(Ei(a,f),p&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{cw(a,c)}catch(C){ft(f,f.return,C)}}break;case 27:c===null&&p&4&&AT(f);case 26:case 5:Ei(a,f),c===null&&p&4&&ST(f),p&512&&Jo(f,f.return);break;case 12:Ei(a,f);break;case 13:Ei(a,f),p&4&&MT(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=Ij.bind(null,f),Kj(a,f))));break;case 22:if(p=f.memoizedState!==null||ti,!p){c=c!==null&&c.memoizedState!==null||Pt,v=ti;var b=Pt;ti=p,(Pt=c)&&!b?Ai(a,f,(f.subtreeFlags&8772)!==0):Ei(a,f),ti=v,Pt=b}break;case 30:break;default:Ei(a,f)}}function NT(a){var c=a.alternate;c!==null&&(a.alternate=null,NT(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&ah(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var bt=null,Nn=!1;function ni(a,c,f){for(f=f.child;f!==null;)kT(a,c,f),f=f.sibling}function kT(a,c,f){if(ze&&typeof ze.onCommitFiberUnmount=="function")try{ze.onCommitFiberUnmount(We,f)}catch{}switch(f.tag){case 26:Pt||kr(f,c),ni(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Pt||kr(f,c);var p=bt,v=Nn;Ii(f.type)&&(bt=f.stateNode,Nn=!1),ni(a,c,f),ll(f.stateNode),bt=p,Nn=v;break;case 5:Pt||kr(f,c);case 6:if(p=bt,v=Nn,bt=null,ni(a,c,f),bt=p,Nn=v,bt!==null)if(Nn)try{(bt.nodeType===9?bt.body:bt.nodeName==="HTML"?bt.ownerDocument.body:bt).removeChild(f.stateNode)}catch(b){ft(f,c,b)}else try{bt.removeChild(f.stateNode)}catch(b){ft(f,c,b)}break;case 18:bt!==null&&(Nn?(a=bt,v3(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),ml(a)):v3(bt,f.stateNode));break;case 4:p=bt,v=Nn,bt=f.stateNode.containerInfo,Nn=!0,ni(a,c,f),bt=p,Nn=v;break;case 0:case 11:case 14:case 15:Pt||Si(2,f,c),Pt||Si(4,f,c),ni(a,c,f);break;case 1:Pt||(kr(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&TT(f,c,p)),ni(a,c,f);break;case 21:ni(a,c,f);break;case 22:Pt=(p=Pt)||f.memoizedState!==null,ni(a,c,f),Pt=p;break;default:ni(a,c,f)}}function MT(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ml(a)}catch(f){ft(c,c.return,f)}}function Sj(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new RT),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new RT),c;default:throw Error(r(435,a.tag))}}function Cp(a,c){var f=Sj(a);c.forEach(function(p){var v=Oj.bind(null,a,p);f.has(p)||(f.add(p),p.then(v,v))})}function jn(a,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var v=f[p],b=a,C=c,B=C;e:for(;B!==null;){switch(B.tag){case 27:if(Ii(B.type)){bt=B.stateNode,Nn=!1;break e}break;case 5:bt=B.stateNode,Nn=!1;break e;case 3:case 4:bt=B.stateNode.containerInfo,Nn=!0;break e}B=B.return}if(bt===null)throw Error(r(160));kT(b,C,v),bt=null,Nn=!1,b=v.alternate,b!==null&&(b.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)IT(c,a),c=c.sibling}var pr=null;function IT(a,c){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:jn(c,a),Bn(a),p&4&&(Si(3,a,a.return),Qo(3,a),Si(5,a,a.return));break;case 1:jn(c,a),Bn(a),p&512&&(Pt||f===null||kr(f,f.return)),p&64&&ti&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var v=pr;if(jn(c,a),Bn(a),p&512&&(Pt||f===null||kr(f,f.return)),p&4){var b=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,v=v.ownerDocument||v;t:switch(p){case"title":b=v.getElementsByTagName("title")[0],(!b||b[To]||b[un]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=v.createElement(p),v.head.insertBefore(b,v.querySelector("head > title"))),sn(b,p,f),b[un]=a,Kt(b),p=b;break e;case"link":var C=A3("link","href",v).get(p+(f.href||""));if(C){for(var B=0;B<C.length;B++)if(b=C[B],b.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&b.getAttribute("rel")===(f.rel==null?null:f.rel)&&b.getAttribute("title")===(f.title==null?null:f.title)&&b.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){C.splice(B,1);break t}}b=v.createElement(p),sn(b,p,f),v.head.appendChild(b);break;case"meta":if(C=A3("meta","content",v).get(p+(f.content||""))){for(B=0;B<C.length;B++)if(b=C[B],b.getAttribute("content")===(f.content==null?null:""+f.content)&&b.getAttribute("name")===(f.name==null?null:f.name)&&b.getAttribute("property")===(f.property==null?null:f.property)&&b.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&b.getAttribute("charset")===(f.charSet==null?null:f.charSet)){C.splice(B,1);break t}}b=v.createElement(p),sn(b,p,f),v.head.appendChild(b);break;default:throw Error(r(468,p))}b[un]=a,Kt(b),p=b}a.stateNode=p}else R3(v,a.type,a.stateNode);else a.stateNode=E3(v,p,a.memoizedProps);else b!==p?(b===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):b.count--,p===null?R3(v,a.type,a.stateNode):E3(v,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Sp(a,a.memoizedProps,f.memoizedProps)}break;case 27:jn(c,a),Bn(a),p&512&&(Pt||f===null||kr(f,f.return)),f!==null&&p&4&&Sp(a,a.memoizedProps,f.memoizedProps);break;case 5:if(jn(c,a),Bn(a),p&512&&(Pt||f===null||kr(f,f.return)),a.flags&32){v=a.stateNode;try{na(v,"")}catch(he){ft(a,a.return,he)}}p&4&&a.stateNode!=null&&(v=a.memoizedProps,Sp(a,v,f!==null?f.memoizedProps:v)),p&1024&&(Rp=!0);break;case 6:if(jn(c,a),Bn(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(he){ft(a,a.return,he)}}break;case 3:if(Ru=null,v=pr,pr=Eu(c.containerInfo),jn(c,a),pr=v,Bn(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{ml(c.containerInfo)}catch(he){ft(a,a.return,he)}Rp&&(Rp=!1,OT(a));break;case 4:p=pr,pr=Eu(a.stateNode.containerInfo),jn(c,a),Bn(a),pr=p;break;case 12:jn(c,a),Bn(a);break;case 13:jn(c,a),Bn(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Pp=Ce()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Cp(a,p)));break;case 22:v=a.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,fe=ti,pe=Pt;if(ti=fe||v,Pt=pe||K,jn(c,a),Pt=pe,ti=fe,Bn(a),p&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(f===null||K||ti||Pt||ms(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){K=f=c;try{if(b=K.stateNode,v)C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{B=K.stateNode;var ve=K.memoizedProps.style,de=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;B.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(he){ft(K,K.return,he)}}}else if(c.tag===6){if(f===null){K=c;try{K.stateNode.nodeValue=v?"":K.memoizedProps}catch(he){ft(K,K.return,he)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,Cp(a,f))));break;case 19:jn(c,a),Bn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Cp(a,p)));break;case 30:break;case 21:break;default:jn(c,a),Bn(a)}}function Bn(a){var c=a.flags;if(c&2){try{for(var f,p=a.return;p!==null;){if(ET(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var v=f.stateNode,b=Ep(a);du(a,b,v);break;case 5:var C=f.stateNode;f.flags&32&&(na(C,""),f.flags&=-33);var B=Ep(a);du(a,B,C);break;case 3:case 4:var K=f.stateNode.containerInfo,fe=Ep(a);Ap(a,fe,K);break;default:throw Error(r(161))}}catch(pe){ft(a,a.return,pe)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function OT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;OT(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Ei(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)CT(a,c.alternate,c),c=c.sibling}function ms(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Si(4,c,c.return),ms(c);break;case 1:kr(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&TT(c,c.return,f),ms(c);break;case 27:ll(c.stateNode);case 26:case 5:kr(c,c.return),ms(c);break;case 22:c.memoizedState===null&&ms(c);break;case 30:ms(c);break;default:ms(c)}a=a.sibling}}function Ai(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,v=a,b=c,C=b.flags;switch(b.tag){case 0:case 11:case 15:Ai(v,b,f),Qo(4,b);break;case 1:if(Ai(v,b,f),p=b,v=p.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(fe){ft(p,p.return,fe)}if(p=b,v=p.updateQueue,v!==null){var B=p.stateNode;try{var K=v.shared.hiddenCallbacks;if(K!==null)for(v.shared.hiddenCallbacks=null,v=0;v<K.length;v++)lw(K[v],B)}catch(fe){ft(p,p.return,fe)}}f&&C&64&&wT(b),Jo(b,b.return);break;case 27:AT(b);case 26:case 5:Ai(v,b,f),f&&p===null&&C&4&&ST(b),Jo(b,b.return);break;case 12:Ai(v,b,f);break;case 13:Ai(v,b,f),f&&C&4&&MT(v,b);break;case 22:b.memoizedState===null&&Ai(v,b,f),Jo(b,b.return);break;case 30:break;default:Ai(v,b,f)}c=c.sibling}}function Np(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&Lo(f))}function kp(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Lo(a))}function Mr(a,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)PT(a,c,f,p),c=c.sibling}function PT(a,c,f,p){var v=c.flags;switch(c.tag){case 0:case 11:case 15:Mr(a,c,f,p),v&2048&&Qo(9,c);break;case 1:Mr(a,c,f,p);break;case 3:Mr(a,c,f,p),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Lo(a)));break;case 12:if(v&2048){Mr(a,c,f,p),a=c.stateNode;try{var b=c.memoizedProps,C=b.id,B=b.onPostCommit;typeof B=="function"&&B(C,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(K){ft(c,c.return,K)}}else Mr(a,c,f,p);break;case 13:Mr(a,c,f,p);break;case 23:break;case 22:b=c.stateNode,C=c.alternate,c.memoizedState!==null?b._visibility&2?Mr(a,c,f,p):el(a,c):b._visibility&2?Mr(a,c,f,p):(b._visibility|=2,xa(a,c,f,p,(c.subtreeFlags&10256)!==0)),v&2048&&Np(C,c);break;case 24:Mr(a,c,f,p),v&2048&&kp(c.alternate,c);break;default:Mr(a,c,f,p)}}function xa(a,c,f,p,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var b=a,C=c,B=f,K=p,fe=C.flags;switch(C.tag){case 0:case 11:case 15:xa(b,C,B,K,v),Qo(8,C);break;case 23:break;case 22:var pe=C.stateNode;C.memoizedState!==null?pe._visibility&2?xa(b,C,B,K,v):el(b,C):(pe._visibility|=2,xa(b,C,B,K,v)),v&&fe&2048&&Np(C.alternate,C);break;case 24:xa(b,C,B,K,v),v&&fe&2048&&kp(C.alternate,C);break;default:xa(b,C,B,K,v)}c=c.sibling}}function el(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,p=c,v=p.flags;switch(p.tag){case 22:el(f,p),v&2048&&Np(p.alternate,p);break;case 24:el(f,p),v&2048&&kp(p.alternate,p);break;default:el(f,p)}c=c.sibling}}var tl=8192;function wa(a){if(a.subtreeFlags&tl)for(a=a.child;a!==null;)DT(a),a=a.sibling}function DT(a){switch(a.tag){case 26:wa(a),a.flags&tl&&a.memoizedState!==null&&cB(pr,a.memoizedState,a.memoizedProps);break;case 5:wa(a);break;case 3:case 4:var c=pr;pr=Eu(a.stateNode.containerInfo),wa(a),pr=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=tl,tl=16777216,wa(a),tl=c):wa(a));break;default:wa(a)}}function jT(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function nl(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];Qt=p,LT(p,a)}jT(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)BT(a),a=a.sibling}function BT(a){switch(a.tag){case 0:case 11:case 15:nl(a),a.flags&2048&&Si(9,a,a.return);break;case 3:nl(a);break;case 12:nl(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,hu(a)):nl(a);break;default:nl(a)}}function hu(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];Qt=p,LT(p,a)}jT(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Si(8,c,c.return),hu(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,hu(c));break;default:hu(c)}a=a.sibling}}function LT(a,c){for(;Qt!==null;){var f=Qt;switch(f.tag){case 0:case 11:case 15:Si(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Lo(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,Qt=p;else e:for(f=a;Qt!==null;){p=Qt;var v=p.sibling,b=p.return;if(NT(p),p===f){Qt=null;break e}if(v!==null){v.return=b,Qt=v;break e}Qt=b}}}var Ej={getCacheForType:function(a){var c=fn($t),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},Aj=typeof WeakMap=="function"?WeakMap:Map,rt=0,gt=null,Ve=null,He=0,it=0,Ln=null,Ri=!1,Ta=!1,Mp=!1,ri=0,Ct=0,Ci=0,_s=0,Ip=0,tr=0,Sa=0,rl=null,kn=null,Op=!1,Pp=0,pu=1/0,gu=null,Ni=null,rn=0,ki=null,Ea=null,Aa=0,Dp=0,jp=null,UT=null,il=0,Bp=null;function Un(){if((rt&2)!==0&&He!==0)return He&-He;if(V.T!==null){var a=ha;return a!==0?a:$p()}return t2()}function FT(){tr===0&&(tr=(He&536870912)===0||Qe?qr():536870912);var a=er.current;return a!==null&&(a.flags|=32),tr}function Fn(a,c,f){(a===gt&&(it===2||it===9)||a.cancelPendingCommit!==null)&&(Ra(a,0),Mi(a,He,tr,!1)),wo(a,f),((rt&2)===0||a!==gt)&&(a===gt&&((rt&2)===0&&(_s|=f),Ct===4&&Mi(a,He,tr,!1)),Ir(a))}function zT(a,c,f){if((rt&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&a.expiredLanes)===0||$e(a,c),v=p?Nj(a,c):Fp(a,c,!0),b=p;do{if(v===0){Ta&&!p&&Mi(a,c,0,!1);break}else{if(f=a.current.alternate,b&&!Rj(f)){v=Fp(a,c,!1),b=!1;continue}if(v===2){if(b=c,a.errorRecoveryDisabledLanes&b)var C=0;else C=a.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){c=C;e:{var B=a;v=rl;var K=B.current.memoizedState.isDehydrated;if(K&&(Ra(B,C).flags|=256),C=Fp(B,C,!1),C!==2){if(Mp&&!K){B.errorRecoveryDisabledLanes|=b,_s|=b,v=4;break e}b=kn,kn=v,b!==null&&(kn===null?kn=b:kn.push.apply(kn,b))}v=C}if(b=!1,v!==2)continue}}if(v===1){Ra(a,0),Mi(a,c,0,!0);break}e:{switch(p=a,b=v,b){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:Mi(p,c,tr,!Ri);break e;case 2:kn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(v=Pp+300-Ce(),10<v)){if(Mi(p,c,tr,!Ri),nt(p,0,!0)!==0)break e;p.timeoutHandle=m3(VT.bind(null,p,f,kn,gu,Op,c,tr,_s,Sa,Ri,b,2,-0,0),v);break e}VT(p,f,kn,gu,Op,c,tr,_s,Sa,Ri,b,0,-0,0)}}break}while(!0);Ir(a)}function VT(a,c,f,p,v,b,C,B,K,fe,pe,ve,de,he){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(fl={stylesheets:null,count:0,unsuspend:lB},DT(c),ve=uB(),ve!==null)){a.cancelPendingCommit=ve(GT.bind(null,a,c,b,f,p,v,C,B,K,pe,1,de,he)),Mi(a,b,C,!fe);return}GT(a,c,b,f,p,v,C,B,K)}function Rj(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var v=f[p],b=v.getSnapshot;v=v.value;try{if(!Pn(b(),v))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Mi(a,c,f,p){c&=~Ip,c&=~_s,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var v=c;0<v;){var b=31-vt(v),C=1<<b;p[b]=-1,v&=~C}f!==0&&J1(a,f,c)}function mu(){return(rt&6)===0?(sl(0),!1):!0}function Lp(){if(Ve!==null){if(it===0)var a=Ve.return;else a=Ve,Gr=fs=null,tp(a),ya=null,Go=0,a=Ve;for(;a!==null;)xT(a.alternate,a),a=a.return;Ve=null}}function Ra(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,Hj(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Lp(),gt=a,Ve=f=Wr(a.current,null),He=c,it=0,Ln=null,Ri=!1,Ta=$e(a,c),Mp=!1,Sa=tr=Ip=_s=Ci=Ct=0,kn=rl=null,Op=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var v=31-vt(p),b=1<<v;c|=a[v],p&=~b}return ri=c,Lc(),f}function qT(a,c){Le=null,V.H=ru,c===Fo||c===Xc?(c=aw(),it=3):c===rw?(c=aw(),it=4):it=c===oT?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Ln=c,Ve===null&&(Ct=1,lu(a,Kn(c,a.current)))}function $T(){var a=V.H;return V.H=ru,a===null?ru:a}function HT(){var a=V.A;return V.A=Ej,a}function Up(){Ct=4,Ri||(He&4194048)!==He&&er.current!==null||(Ta=!0),(Ci&134217727)===0&&(_s&134217727)===0||gt===null||Mi(gt,He,tr,!1)}function Fp(a,c,f){var p=rt;rt|=2;var v=$T(),b=HT();(gt!==a||He!==c)&&(gu=null,Ra(a,c)),c=!1;var C=Ct;e:do try{if(it!==0&&Ve!==null){var B=Ve,K=Ln;switch(it){case 8:Lp(),C=6;break e;case 3:case 2:case 9:case 6:er.current===null&&(c=!0);var fe=it;if(it=0,Ln=null,Ca(a,B,K,fe),f&&Ta){C=0;break e}break;default:fe=it,it=0,Ln=null,Ca(a,B,K,fe)}}Cj(),C=Ct;break}catch(pe){qT(a,pe)}while(!0);return c&&a.shellSuspendCounter++,Gr=fs=null,rt=p,V.H=v,V.A=b,Ve===null&&(gt=null,He=0,Lc()),C}function Cj(){for(;Ve!==null;)WT(Ve)}function Nj(a,c){var f=rt;rt|=2;var p=$T(),v=HT();gt!==a||He!==c?(gu=null,pu=Ce()+500,Ra(a,c)):Ta=$e(a,c);e:do try{if(it!==0&&Ve!==null){c=Ve;var b=Ln;t:switch(it){case 1:it=0,Ln=null,Ca(a,c,b,1);break;case 2:case 9:if(iw(b)){it=0,Ln=null,XT(c);break}c=function(){it!==2&&it!==9||gt!==a||(it=7),Ir(a)},b.then(c,c);break e;case 3:it=7;break e;case 4:it=5;break e;case 7:iw(b)?(it=0,Ln=null,XT(c)):(it=0,Ln=null,Ca(a,c,b,7));break;case 5:var C=null;switch(Ve.tag){case 26:C=Ve.memoizedState;case 5:case 27:var B=Ve;if(!C||C3(C)){it=0,Ln=null;var K=B.sibling;if(K!==null)Ve=K;else{var fe=B.return;fe!==null?(Ve=fe,_u(fe)):Ve=null}break t}}it=0,Ln=null,Ca(a,c,b,5);break;case 6:it=0,Ln=null,Ca(a,c,b,6);break;case 8:Lp(),Ct=6;break e;default:throw Error(r(462))}}kj();break}catch(pe){qT(a,pe)}while(!0);return Gr=fs=null,V.H=p,V.A=v,rt=f,Ve!==null?0:(gt=null,He=0,Lc(),Ct)}function kj(){for(;Ve!==null&&!De();)WT(Ve)}function WT(a){var c=yT(a.alternate,a,ri);a.memoizedProps=a.pendingProps,c===null?_u(a):Ve=c}function XT(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=hT(f,c,c.pendingProps,c.type,void 0,He);break;case 11:c=hT(f,c,c.pendingProps,c.type.render,c.ref,He);break;case 5:tp(c);default:xT(f,c),c=Ve=Y2(c,ri),c=yT(f,c,ri)}a.memoizedProps=a.pendingProps,c===null?_u(a):Ve=c}function Ca(a,c,f,p){Gr=fs=null,tp(c),ya=null,Go=0;var v=c.return;try{if(yj(a,v,c,f,He)){Ct=1,lu(a,Kn(f,a.current)),Ve=null;return}}catch(b){if(v!==null)throw Ve=v,b;Ct=1,lu(a,Kn(f,a.current)),Ve=null;return}c.flags&32768?(Qe||p===1?a=!0:Ta||(He&536870912)!==0?a=!1:(Ri=a=!0,(p===2||p===9||p===3||p===6)&&(p=er.current,p!==null&&p.tag===13&&(p.flags|=16384))),YT(c,a)):_u(c)}function _u(a){var c=a;do{if((c.flags&32768)!==0){YT(c,Ri);return}a=c.return;var f=xj(c.alternate,c,ri);if(f!==null){Ve=f;return}if(c=c.sibling,c!==null){Ve=c;return}Ve=c=a}while(c!==null);Ct===0&&(Ct=5)}function YT(a,c){do{var f=wj(a.alternate,a);if(f!==null){f.flags&=32767,Ve=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){Ve=a;return}Ve=a=f}while(a!==null);Ct=6,Ve=null}function GT(a,c,f,p,v,b,C,B,K){a.cancelPendingCommit=null;do vu();while(rn!==0);if((rt&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(b=c.lanes|c.childLanes,b|=kh,l6(a,f,b,C,B,K),a===gt&&(Ve=gt=null,He=0),Ea=c,ki=a,Aa=f,Dp=b,jp=v,UT=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,Pj(_n,function(){return e3(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=V.T,V.T=null,v=$.p,$.p=2,C=rt,rt|=4;try{Tj(a,c,f)}finally{rt=C,$.p=v,V.T=p}}rn=1,KT(),ZT(),QT()}}function KT(){if(rn===1){rn=0;var a=ki,c=Ea,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=V.T,V.T=null;var p=$.p;$.p=2;var v=rt;rt|=4;try{IT(c,a);var b=Qp,C=L2(a.containerInfo),B=b.focusedElem,K=b.selectionRange;if(C!==B&&B&&B.ownerDocument&&B2(B.ownerDocument.documentElement,B)){if(K!==null&&Eh(B)){var fe=K.start,pe=K.end;if(pe===void 0&&(pe=fe),"selectionStart"in B)B.selectionStart=fe,B.selectionEnd=Math.min(pe,B.value.length);else{var ve=B.ownerDocument||document,de=ve&&ve.defaultView||window;if(de.getSelection){var he=de.getSelection(),Pe=B.textContent.length,ke=Math.min(K.start,Pe),ot=K.end===void 0?ke:Math.min(K.end,Pe);!he.extend&&ke>ot&&(C=ot,ot=ke,ke=C);var se=j2(B,ke),Q=j2(B,ot);if(se&&Q&&(he.rangeCount!==1||he.anchorNode!==se.node||he.anchorOffset!==se.offset||he.focusNode!==Q.node||he.focusOffset!==Q.offset)){var ce=ve.createRange();ce.setStart(se.node,se.offset),he.removeAllRanges(),ke>ot?(he.addRange(ce),he.extend(Q.node,Q.offset)):(ce.setEnd(Q.node,Q.offset),he.addRange(ce))}}}}for(ve=[],he=B;he=he.parentNode;)he.nodeType===1&&ve.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<ve.length;B++){var ge=ve[B];ge.element.scrollLeft=ge.left,ge.element.scrollTop=ge.top}}ku=!!Zp,Qp=Zp=null}finally{rt=v,$.p=p,V.T=f}}a.current=c,rn=2}}function ZT(){if(rn===2){rn=0;var a=ki,c=Ea,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=V.T,V.T=null;var p=$.p;$.p=2;var v=rt;rt|=4;try{CT(a,c.alternate,c)}finally{rt=v,$.p=p,V.T=f}}rn=3}}function QT(){if(rn===4||rn===3){rn=0,tn();var a=ki,c=Ea,f=Aa,p=UT;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?rn=5:(rn=0,Ea=ki=null,JT(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Ni=null),ih(f),c=c.stateNode,ze&&typeof ze.onCommitFiberRoot=="function")try{ze.onCommitFiberRoot(We,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=V.T,v=$.p,$.p=2,V.T=null;try{for(var b=a.onRecoverableError,C=0;C<p.length;C++){var B=p[C];b(B.value,{componentStack:B.stack})}}finally{V.T=c,$.p=v}}(Aa&3)!==0&&vu(),Ir(a),v=a.pendingLanes,(f&4194090)!==0&&(v&42)!==0?a===Bp?il++:(il=0,Bp=a):il=0,sl(0)}}function JT(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Lo(c)))}function vu(a){return KT(),ZT(),QT(),e3()}function e3(){if(rn!==5)return!1;var a=ki,c=Dp;Dp=0;var f=ih(Aa),p=V.T,v=$.p;try{$.p=32>f?32:f,V.T=null,f=jp,jp=null;var b=ki,C=Aa;if(rn=0,Ea=ki=null,Aa=0,(rt&6)!==0)throw Error(r(331));var B=rt;if(rt|=4,BT(b.current),PT(b,b.current,C,f),rt=B,sl(0,!1),ze&&typeof ze.onPostCommitFiberRoot=="function")try{ze.onPostCommitFiberRoot(We,b)}catch{}return!0}finally{$.p=v,V.T=p,JT(a,c)}}function t3(a,c,f){c=Kn(f,c),c=gp(a.stateNode,c,2),a=bi(a,c,2),a!==null&&(wo(a,2),Ir(a))}function ft(a,c,f){if(a.tag===3)t3(a,a,f);else for(;c!==null;){if(c.tag===3){t3(c,a,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Ni===null||!Ni.has(p))){a=Kn(f,a),f=sT(2),p=bi(c,f,2),p!==null&&(aT(f,p,c,a),wo(p,2),Ir(p));break}}c=c.return}}function zp(a,c,f){var p=a.pingCache;if(p===null){p=a.pingCache=new Aj;var v=new Set;p.set(c,v)}else v=p.get(c),v===void 0&&(v=new Set,p.set(c,v));v.has(f)||(Mp=!0,v.add(f),a=Mj.bind(null,a,c,f),c.then(a,a))}function Mj(a,c,f){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,gt===a&&(He&f)===f&&(Ct===4||Ct===3&&(He&62914560)===He&&300>Ce()-Pp?(rt&2)===0&&Ra(a,0):Ip|=f,Sa===He&&(Sa=0)),Ir(a)}function n3(a,c){c===0&&(c=xo()),a=ca(a,c),a!==null&&(wo(a,c),Ir(a))}function Ij(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),n3(a,f)}function Oj(a,c){var f=0;switch(a.tag){case 13:var p=a.stateNode,v=a.memoizedState;v!==null&&(f=v.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),n3(a,f)}function Pj(a,c){return _t(a,c)}var yu=null,Na=null,Vp=!1,bu=!1,qp=!1,vs=0;function Ir(a){a!==Na&&a.next===null&&(Na===null?yu=Na=a:Na=Na.next=a),bu=!0,Vp||(Vp=!0,jj())}function sl(a,c){if(!qp&&bu){qp=!0;do for(var f=!1,p=yu;p!==null;){if(a!==0){var v=p.pendingLanes;if(v===0)var b=0;else{var C=p.suspendedLanes,B=p.pingedLanes;b=(1<<31-vt(42|a)+1)-1,b&=v&~(C&~B),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(f=!0,a3(p,b))}else b=He,b=nt(p,p===gt?b:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(b&3)===0||$e(p,b)||(f=!0,a3(p,b));p=p.next}while(f);qp=!1}}function Dj(){r3()}function r3(){bu=Vp=!1;var a=0;vs!==0&&($j()&&(a=vs),vs=0);for(var c=Ce(),f=null,p=yu;p!==null;){var v=p.next,b=i3(p,c);b===0?(p.next=null,f===null?yu=v:f.next=v,v===null&&(Na=f)):(f=p,(a!==0||(b&3)!==0)&&(bu=!0)),p=v}sl(a)}function i3(a,c){for(var f=a.suspendedLanes,p=a.pingedLanes,v=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var C=31-vt(b),B=1<<C,K=v[C];K===-1?((B&f)===0||(B&p)!==0)&&(v[C]=yt(B,c)):K<=c&&(a.expiredLanes|=B),b&=~B}if(c=gt,f=He,f=nt(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===c&&(it===2||it===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&ut(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||$e(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(p!==null&&ut(p),ih(f)){case 2:case 8:f=On;break;case 32:f=_n;break;case 268435456:f=Ye;break;default:f=_n}return p=s3.bind(null,a),f=_t(f,p),a.callbackPriority=c,a.callbackNode=f,c}return p!==null&&p!==null&&ut(p),a.callbackPriority=2,a.callbackNode=null,2}function s3(a,c){if(rn!==0&&rn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(vu()&&a.callbackNode!==f)return null;var p=He;return p=nt(a,a===gt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(zT(a,p,c),i3(a,Ce()),a.callbackNode!=null&&a.callbackNode===f?s3.bind(null,a):null)}function a3(a,c){if(vu())return null;zT(a,c,!0)}function jj(){Wj(function(){(rt&6)!==0?_t(Gt,Dj):r3()})}function $p(){return vs===0&&(vs=qr()),vs}function o3(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Mc(""+a)}function l3(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function Bj(a,c,f,p,v){if(c==="submit"&&f&&f.stateNode===v){var b=o3((v[An]||null).action),C=p.submitter;C&&(c=(c=C[An]||null)?o3(c.formAction):C.getAttribute("formAction"),c!==null&&(b=c,C=null));var B=new Dc("action","action",null,p,v);a.push({event:B,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(vs!==0){var K=C?l3(v,C):new FormData(v);up(f,{pending:!0,data:K,method:v.method,action:b},null,K)}}else typeof b=="function"&&(B.preventDefault(),K=C?l3(v,C):new FormData(v),up(f,{pending:!0,data:K,method:v.method,action:b},b,K))},currentTarget:v}]})}}for(var Hp=0;Hp<Nh.length;Hp++){var Wp=Nh[Hp],Lj=Wp.toLowerCase(),Uj=Wp[0].toUpperCase()+Wp.slice(1);hr(Lj,"on"+Uj)}hr(z2,"onAnimationEnd"),hr(V2,"onAnimationIteration"),hr(q2,"onAnimationStart"),hr("dblclick","onDoubleClick"),hr("focusin","onFocus"),hr("focusout","onBlur"),hr(nj,"onTransitionRun"),hr(rj,"onTransitionStart"),hr(ij,"onTransitionCancel"),hr($2,"onTransitionEnd"),Js("onMouseEnter",["mouseout","mouseover"]),Js("onMouseLeave",["mouseout","mouseover"]),Js("onPointerEnter",["pointerout","pointerover"]),Js("onPointerLeave",["pointerout","pointerover"]),ns("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ns("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ns("onBeforeInput",["compositionend","keypress","textInput","paste"]),ns("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ns("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ns("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var al="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(al));function c3(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],v=p.event;p=p.listeners;e:{var b=void 0;if(c)for(var C=p.length-1;0<=C;C--){var B=p[C],K=B.instance,fe=B.currentTarget;if(B=B.listener,K!==b&&v.isPropagationStopped())break e;b=B,v.currentTarget=fe;try{b(v)}catch(pe){ou(pe)}v.currentTarget=null,b=K}else for(C=0;C<p.length;C++){if(B=p[C],K=B.instance,fe=B.currentTarget,B=B.listener,K!==b&&v.isPropagationStopped())break e;b=B,v.currentTarget=fe;try{b(v)}catch(pe){ou(pe)}v.currentTarget=null,b=K}}}}function qe(a,c){var f=c[sh];f===void 0&&(f=c[sh]=new Set);var p=a+"__bubble";f.has(p)||(u3(c,a,2,!1),f.add(p))}function Xp(a,c,f){var p=0;c&&(p|=4),u3(f,a,p,c)}var xu="_reactListening"+Math.random().toString(36).slice(2);function Yp(a){if(!a[xu]){a[xu]=!0,r2.forEach(function(f){f!=="selectionchange"&&(Fj.has(f)||Xp(f,!1,a),Xp(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[xu]||(c[xu]=!0,Xp("selectionchange",!1,c))}}function u3(a,c,f,p){switch(P3(c)){case 2:var v=hB;break;case 8:v=pB;break;default:v=lg}f=v.bind(null,c,f,a),v=void 0,!mh||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),p?v!==void 0?a.addEventListener(c,f,{capture:!0,passive:v}):a.addEventListener(c,f,!0):v!==void 0?a.addEventListener(c,f,{passive:v}):a.addEventListener(c,f,!1)}function Gp(a,c,f,p,v){var b=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var C=p.tag;if(C===3||C===4){var B=p.stateNode.containerInfo;if(B===v)break;if(C===4)for(C=p.return;C!==null;){var K=C.tag;if((K===3||K===4)&&C.stateNode.containerInfo===v)return;C=C.return}for(;B!==null;){if(C=Ks(B),C===null)return;if(K=C.tag,K===5||K===6||K===26||K===27){p=b=C;continue e}B=B.parentNode}}p=p.return}_2(function(){var fe=b,pe=ph(f),ve=[];e:{var de=H2.get(a);if(de!==void 0){var he=Dc,Pe=a;switch(a){case"keypress":if(Oc(f)===0)break e;case"keydown":case"keyup":he=P6;break;case"focusin":Pe="focus",he=bh;break;case"focusout":Pe="blur",he=bh;break;case"beforeblur":case"afterblur":he=bh;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=b2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=w6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=B6;break;case z2:case V2:case q2:he=E6;break;case $2:he=U6;break;case"scroll":case"scrollend":he=b6;break;case"wheel":he=z6;break;case"copy":case"cut":case"paste":he=R6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=w2;break;case"toggle":case"beforetoggle":he=q6}var ke=(c&4)!==0,ot=!ke&&(a==="scroll"||a==="scrollend"),se=ke?de!==null?de+"Capture":null:de;ke=[];for(var Q=fe,ce;Q!==null;){var ge=Q;if(ce=ge.stateNode,ge=ge.tag,ge!==5&&ge!==26&&ge!==27||ce===null||se===null||(ge=Eo(Q,se),ge!=null&&ke.push(ol(Q,ge,ce))),ot)break;Q=Q.return}0<ke.length&&(de=new he(de,Pe,null,f,pe),ve.push({event:de,listeners:ke}))}}if((c&7)===0){e:{if(de=a==="mouseover"||a==="pointerover",he=a==="mouseout"||a==="pointerout",de&&f!==hh&&(Pe=f.relatedTarget||f.fromElement)&&(Ks(Pe)||Pe[Gs]))break e;if((he||de)&&(de=pe.window===pe?pe:(de=pe.ownerDocument)?de.defaultView||de.parentWindow:window,he?(Pe=f.relatedTarget||f.toElement,he=fe,Pe=Pe?Ks(Pe):null,Pe!==null&&(ot=s(Pe),ke=Pe.tag,Pe!==ot||ke!==5&&ke!==27&&ke!==6)&&(Pe=null)):(he=null,Pe=fe),he!==Pe)){if(ke=b2,ge="onMouseLeave",se="onMouseEnter",Q="mouse",(a==="pointerout"||a==="pointerover")&&(ke=w2,ge="onPointerLeave",se="onPointerEnter",Q="pointer"),ot=he==null?de:So(he),ce=Pe==null?de:So(Pe),de=new ke(ge,Q+"leave",he,f,pe),de.target=ot,de.relatedTarget=ce,ge=null,Ks(pe)===fe&&(ke=new ke(se,Q+"enter",Pe,f,pe),ke.target=ce,ke.relatedTarget=ot,ge=ke),ot=ge,he&&Pe)t:{for(ke=he,se=Pe,Q=0,ce=ke;ce;ce=ka(ce))Q++;for(ce=0,ge=se;ge;ge=ka(ge))ce++;for(;0<Q-ce;)ke=ka(ke),Q--;for(;0<ce-Q;)se=ka(se),ce--;for(;Q--;){if(ke===se||se!==null&&ke===se.alternate)break t;ke=ka(ke),se=ka(se)}ke=null}else ke=null;he!==null&&f3(ve,de,he,ke,!1),Pe!==null&&ot!==null&&f3(ve,ot,Pe,ke,!0)}}e:{if(de=fe?So(fe):window,he=de.nodeName&&de.nodeName.toLowerCase(),he==="select"||he==="input"&&de.type==="file")var Ee=k2;else if(C2(de))if(M2)Ee=J6;else{Ee=Z6;var Ue=K6}else he=de.nodeName,!he||he.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?fe&&dh(fe.elementType)&&(Ee=k2):Ee=Q6;if(Ee&&(Ee=Ee(a,fe))){N2(ve,Ee,f,pe);break e}Ue&&Ue(a,de,fe),a==="focusout"&&fe&&de.type==="number"&&fe.memoizedProps.value!=null&&fh(de,"number",de.value)}switch(Ue=fe?So(fe):window,a){case"focusin":(C2(Ue)||Ue.contentEditable==="true")&&(aa=Ue,Ah=fe,Oo=null);break;case"focusout":Oo=Ah=aa=null;break;case"mousedown":Rh=!0;break;case"contextmenu":case"mouseup":case"dragend":Rh=!1,U2(ve,f,pe);break;case"selectionchange":if(tj)break;case"keydown":case"keyup":U2(ve,f,pe)}var Ne;if(wh)e:{switch(a){case"compositionstart":var Ie="onCompositionStart";break e;case"compositionend":Ie="onCompositionEnd";break e;case"compositionupdate":Ie="onCompositionUpdate";break e}Ie=void 0}else sa?A2(a,f)&&(Ie="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Ie="onCompositionStart");Ie&&(T2&&f.locale!=="ko"&&(sa||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&sa&&(Ne=v2()):(mi=pe,_h="value"in mi?mi.value:mi.textContent,sa=!0)),Ue=wu(fe,Ie),0<Ue.length&&(Ie=new x2(Ie,a,null,f,pe),ve.push({event:Ie,listeners:Ue}),Ne?Ie.data=Ne:(Ne=R2(f),Ne!==null&&(Ie.data=Ne)))),(Ne=H6?W6(a,f):X6(a,f))&&(Ie=wu(fe,"onBeforeInput"),0<Ie.length&&(Ue=new x2("onBeforeInput","beforeinput",null,f,pe),ve.push({event:Ue,listeners:Ie}),Ue.data=Ne)),Bj(ve,a,fe,f,pe)}c3(ve,c)})}function ol(a,c,f){return{instance:a,listener:c,currentTarget:f}}function wu(a,c){for(var f=c+"Capture",p=[];a!==null;){var v=a,b=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||b===null||(v=Eo(a,f),v!=null&&p.unshift(ol(a,v,b)),v=Eo(a,c),v!=null&&p.push(ol(a,v,b))),a.tag===3)return p;a=a.return}return[]}function ka(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function f3(a,c,f,p,v){for(var b=c._reactName,C=[];f!==null&&f!==p;){var B=f,K=B.alternate,fe=B.stateNode;if(B=B.tag,K!==null&&K===p)break;B!==5&&B!==26&&B!==27||fe===null||(K=fe,v?(fe=Eo(f,b),fe!=null&&C.unshift(ol(f,fe,K))):v||(fe=Eo(f,b),fe!=null&&C.push(ol(f,fe,K)))),f=f.return}C.length!==0&&a.push({event:c,listeners:C})}var zj=/\r\n?/g,Vj=/\u0000|\uFFFD/g;function d3(a){return(typeof a=="string"?a:""+a).replace(zj,`
`).replace(Vj,"")}function h3(a,c){return c=d3(c),d3(a)===c}function Tu(){}function at(a,c,f,p,v,b){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||na(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&na(a,""+p);break;case"className":Cc(a,"class",p);break;case"tabIndex":Cc(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Cc(a,f,p);break;case"style":g2(a,p,b);break;case"data":if(c!=="object"){Cc(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Mc(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(f==="formAction"?(c!=="input"&&at(a,c,"name",v.name,v,null),at(a,c,"formEncType",v.formEncType,v,null),at(a,c,"formMethod",v.formMethod,v,null),at(a,c,"formTarget",v.formTarget,v,null)):(at(a,c,"encType",v.encType,v,null),at(a,c,"method",v.method,v,null),at(a,c,"target",v.target,v,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Mc(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=Tu);break;case"onScroll":p!=null&&qe("scroll",a);break;case"onScrollEnd":p!=null&&qe("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Mc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":qe("beforetoggle",a),qe("toggle",a),Rc(a,"popover",p);break;case"xlinkActuate":$r(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":$r(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":$r(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":$r(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":$r(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":$r(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":$r(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":$r(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":$r(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Rc(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=v6.get(f)||f,Rc(a,f,p))}}function Kp(a,c,f,p,v,b){switch(f){case"style":g2(a,p,b);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof p=="string"?na(a,p):(typeof p=="number"||typeof p=="bigint")&&na(a,""+p);break;case"onScroll":p!=null&&qe("scroll",a);break;case"onScrollEnd":p!=null&&qe("scrollend",a);break;case"onClick":p!=null&&(a.onclick=Tu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!i2.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(v=f.endsWith("Capture"),c=f.slice(2,v?f.length-7:void 0),b=a[An]||null,b=b!=null?b[f]:null,typeof b=="function"&&a.removeEventListener(c,b,v),typeof p=="function")){typeof b!="function"&&b!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,p,v);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):Rc(a,f,p)}}}function sn(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":qe("error",a),qe("load",a);var p=!1,v=!1,b;for(b in f)if(f.hasOwnProperty(b)){var C=f[b];if(C!=null)switch(b){case"src":p=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:at(a,c,b,C,f,null)}}v&&at(a,c,"srcSet",f.srcSet,f,null),p&&at(a,c,"src",f.src,f,null);return;case"input":qe("invalid",a);var B=b=C=v=null,K=null,fe=null;for(p in f)if(f.hasOwnProperty(p)){var pe=f[p];if(pe!=null)switch(p){case"name":v=pe;break;case"type":C=pe;break;case"checked":K=pe;break;case"defaultChecked":fe=pe;break;case"value":b=pe;break;case"defaultValue":B=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(r(137,c));break;default:at(a,c,p,pe,f,null)}}f2(a,b,B,K,fe,C,v,!1),Nc(a);return;case"select":qe("invalid",a),p=C=b=null;for(v in f)if(f.hasOwnProperty(v)&&(B=f[v],B!=null))switch(v){case"value":b=B;break;case"defaultValue":C=B;break;case"multiple":p=B;default:at(a,c,v,B,f,null)}c=b,f=C,a.multiple=!!p,c!=null?ta(a,!!p,c,!1):f!=null&&ta(a,!!p,f,!0);return;case"textarea":qe("invalid",a),b=v=p=null;for(C in f)if(f.hasOwnProperty(C)&&(B=f[C],B!=null))switch(C){case"value":p=B;break;case"defaultValue":v=B;break;case"children":b=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(r(91));break;default:at(a,c,C,B,f,null)}h2(a,p,v,b),Nc(a);return;case"option":for(K in f)if(f.hasOwnProperty(K)&&(p=f[K],p!=null))switch(K){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:at(a,c,K,p,f,null)}return;case"dialog":qe("beforetoggle",a),qe("toggle",a),qe("cancel",a),qe("close",a);break;case"iframe":case"object":qe("load",a);break;case"video":case"audio":for(p=0;p<al.length;p++)qe(al[p],a);break;case"image":qe("error",a),qe("load",a);break;case"details":qe("toggle",a);break;case"embed":case"source":case"link":qe("error",a),qe("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in f)if(f.hasOwnProperty(fe)&&(p=f[fe],p!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:at(a,c,fe,p,f,null)}return;default:if(dh(c)){for(pe in f)f.hasOwnProperty(pe)&&(p=f[pe],p!==void 0&&Kp(a,c,pe,p,f,void 0));return}}for(B in f)f.hasOwnProperty(B)&&(p=f[B],p!=null&&at(a,c,B,p,f,null))}function qj(a,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,b=null,C=null,B=null,K=null,fe=null,pe=null;for(he in f){var ve=f[he];if(f.hasOwnProperty(he)&&ve!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":K=ve;default:p.hasOwnProperty(he)||at(a,c,he,null,p,ve)}}for(var de in p){var he=p[de];if(ve=f[de],p.hasOwnProperty(de)&&(he!=null||ve!=null))switch(de){case"type":b=he;break;case"name":v=he;break;case"checked":fe=he;break;case"defaultChecked":pe=he;break;case"value":C=he;break;case"defaultValue":B=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:he!==ve&&at(a,c,de,he,p,ve)}}uh(a,C,B,K,fe,pe,b,v);return;case"select":he=C=B=de=null;for(b in f)if(K=f[b],f.hasOwnProperty(b)&&K!=null)switch(b){case"value":break;case"multiple":he=K;default:p.hasOwnProperty(b)||at(a,c,b,null,p,K)}for(v in p)if(b=p[v],K=f[v],p.hasOwnProperty(v)&&(b!=null||K!=null))switch(v){case"value":de=b;break;case"defaultValue":B=b;break;case"multiple":C=b;default:b!==K&&at(a,c,v,b,p,K)}c=B,f=C,p=he,de!=null?ta(a,!!f,de,!1):!!p!=!!f&&(c!=null?ta(a,!!f,c,!0):ta(a,!!f,f?[]:"",!1));return;case"textarea":he=de=null;for(B in f)if(v=f[B],f.hasOwnProperty(B)&&v!=null&&!p.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:at(a,c,B,null,p,v)}for(C in p)if(v=p[C],b=f[C],p.hasOwnProperty(C)&&(v!=null||b!=null))switch(C){case"value":de=v;break;case"defaultValue":he=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==b&&at(a,c,C,v,p,b)}d2(a,de,he);return;case"option":for(var Pe in f)if(de=f[Pe],f.hasOwnProperty(Pe)&&de!=null&&!p.hasOwnProperty(Pe))switch(Pe){case"selected":a.selected=!1;break;default:at(a,c,Pe,null,p,de)}for(K in p)if(de=p[K],he=f[K],p.hasOwnProperty(K)&&de!==he&&(de!=null||he!=null))switch(K){case"selected":a.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:at(a,c,K,de,p,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ke in f)de=f[ke],f.hasOwnProperty(ke)&&de!=null&&!p.hasOwnProperty(ke)&&at(a,c,ke,null,p,de);for(fe in p)if(de=p[fe],he=f[fe],p.hasOwnProperty(fe)&&de!==he&&(de!=null||he!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,c));break;default:at(a,c,fe,de,p,he)}return;default:if(dh(c)){for(var ot in f)de=f[ot],f.hasOwnProperty(ot)&&de!==void 0&&!p.hasOwnProperty(ot)&&Kp(a,c,ot,void 0,p,de);for(pe in p)de=p[pe],he=f[pe],!p.hasOwnProperty(pe)||de===he||de===void 0&&he===void 0||Kp(a,c,pe,de,p,he);return}}for(var se in f)de=f[se],f.hasOwnProperty(se)&&de!=null&&!p.hasOwnProperty(se)&&at(a,c,se,null,p,de);for(ve in p)de=p[ve],he=f[ve],!p.hasOwnProperty(ve)||de===he||de==null&&he==null||at(a,c,ve,de,p,he)}var Zp=null,Qp=null;function Su(a){return a.nodeType===9?a:a.ownerDocument}function p3(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function g3(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function Jp(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var eg=null;function $j(){var a=window.event;return a&&a.type==="popstate"?a===eg?!1:(eg=a,!0):(eg=null,!1)}var m3=typeof setTimeout=="function"?setTimeout:void 0,Hj=typeof clearTimeout=="function"?clearTimeout:void 0,_3=typeof Promise=="function"?Promise:void 0,Wj=typeof queueMicrotask=="function"?queueMicrotask:typeof _3<"u"?function(a){return _3.resolve(null).then(a).catch(Xj)}:m3;function Xj(a){setTimeout(function(){throw a})}function Ii(a){return a==="head"}function v3(a,c){var f=c,p=0,v=0;do{var b=f.nextSibling;if(a.removeChild(f),b&&b.nodeType===8)if(f=b.data,f==="/$"){if(0<p&&8>p){f=p;var C=a.ownerDocument;if(f&1&&ll(C.documentElement),f&2&&ll(C.body),f&4)for(f=C.head,ll(f),C=f.firstChild;C;){var B=C.nextSibling,K=C.nodeName;C[To]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&C.rel.toLowerCase()==="stylesheet"||f.removeChild(C),C=B}}if(v===0){a.removeChild(b),ml(c);return}v--}else f==="$"||f==="$?"||f==="$!"?v++:p=f.charCodeAt(0)-48;else p=0;f=b}while(f);ml(c)}function tg(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":tg(f),ah(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function Yj(a,c,f,p){for(;a.nodeType===1;){var v=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[To])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var b=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=gr(a.nextSibling),a===null)break}return null}function Gj(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=gr(a.nextSibling),a===null))return null;return a}function ng(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function Kj(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function gr(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var rg=null;function y3(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function b3(a,c,f){switch(c=Su(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function ll(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);ah(a)}var nr=new Map,x3=new Set;function Eu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ii=$.d;$.d={f:Zj,r:Qj,D:Jj,C:eB,L:tB,m:nB,X:iB,S:rB,M:sB};function Zj(){var a=ii.f(),c=mu();return a||c}function Qj(a){var c=Zs(a);c!==null&&c.tag===5&&c.type==="form"?zw(c):ii.r(a)}var Ma=typeof document>"u"?null:document;function w3(a,c,f){var p=Ma;if(p&&typeof c=="string"&&c){var v=Gn(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof f=="string"&&(v+='[crossorigin="'+f+'"]'),x3.has(v)||(x3.add(v),a={rel:a,crossOrigin:f,href:c},p.querySelector(v)===null&&(c=p.createElement("link"),sn(c,"link",a),Kt(c),p.head.appendChild(c)))}}function Jj(a){ii.D(a),w3("dns-prefetch",a,null)}function eB(a,c){ii.C(a,c),w3("preconnect",a,c)}function tB(a,c,f){ii.L(a,c,f);var p=Ma;if(p&&a&&c){var v='link[rel="preload"][as="'+Gn(c)+'"]';c==="image"&&f&&f.imageSrcSet?(v+='[imagesrcset="'+Gn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(v+='[imagesizes="'+Gn(f.imageSizes)+'"]')):v+='[href="'+Gn(a)+'"]';var b=v;switch(c){case"style":b=Ia(a);break;case"script":b=Oa(a)}nr.has(b)||(a=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),nr.set(b,a),p.querySelector(v)!==null||c==="style"&&p.querySelector(cl(b))||c==="script"&&p.querySelector(ul(b))||(c=p.createElement("link"),sn(c,"link",a),Kt(c),p.head.appendChild(c)))}}function nB(a,c){ii.m(a,c);var f=Ma;if(f&&a){var p=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+Gn(p)+'"][href="'+Gn(a)+'"]',b=v;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Oa(a)}if(!nr.has(b)&&(a=h({rel:"modulepreload",href:a},c),nr.set(b,a),f.querySelector(v)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(ul(b)))return}p=f.createElement("link"),sn(p,"link",a),Kt(p),f.head.appendChild(p)}}}function rB(a,c,f){ii.S(a,c,f);var p=Ma;if(p&&a){var v=Qs(p).hoistableStyles,b=Ia(a);c=c||"default";var C=v.get(b);if(!C){var B={loading:0,preload:null};if(C=p.querySelector(cl(b)))B.loading=5;else{a=h({rel:"stylesheet",href:a,"data-precedence":c},f),(f=nr.get(b))&&ig(a,f);var K=C=p.createElement("link");Kt(K),sn(K,"link",a),K._p=new Promise(function(fe,pe){K.onload=fe,K.onerror=pe}),K.addEventListener("load",function(){B.loading|=1}),K.addEventListener("error",function(){B.loading|=2}),B.loading|=4,Au(C,c,p)}C={type:"stylesheet",instance:C,count:1,state:B},v.set(b,C)}}}function iB(a,c){ii.X(a,c);var f=Ma;if(f&&a){var p=Qs(f).hoistableScripts,v=Oa(a),b=p.get(v);b||(b=f.querySelector(ul(v)),b||(a=h({src:a,async:!0},c),(c=nr.get(v))&&sg(a,c),b=f.createElement("script"),Kt(b),sn(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function sB(a,c){ii.M(a,c);var f=Ma;if(f&&a){var p=Qs(f).hoistableScripts,v=Oa(a),b=p.get(v);b||(b=f.querySelector(ul(v)),b||(a=h({src:a,async:!0,type:"module"},c),(c=nr.get(v))&&sg(a,c),b=f.createElement("script"),Kt(b),sn(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function T3(a,c,f,p){var v=(v=oe.current)?Eu(v):null;if(!v)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ia(f.href),f=Qs(v).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ia(f.href);var b=Qs(v).hoistableStyles,C=b.get(a);if(C||(v=v.ownerDocument||v,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,C),(b=v.querySelector(cl(a)))&&!b._p&&(C.instance=b,C.state.loading=5),nr.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},nr.set(a,f),b||aB(v,a,f,C.state))),c&&p===null)throw Error(r(528,""));return C}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Oa(f),f=Qs(v).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Ia(a){return'href="'+Gn(a)+'"'}function cl(a){return'link[rel="stylesheet"]['+a+"]"}function S3(a){return h({},a,{"data-precedence":a.precedence,precedence:null})}function aB(a,c,f,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),sn(c,"link",f),Kt(c),a.head.appendChild(c))}function Oa(a){return'[src="'+Gn(a)+'"]'}function ul(a){return"script[async]"+a}function E3(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+Gn(f.href)+'"]');if(p)return c.instance=p,Kt(p),p;var v=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Kt(p),sn(p,"style",v),Au(p,f.precedence,a),c.instance=p;case"stylesheet":v=Ia(f.href);var b=a.querySelector(cl(v));if(b)return c.state.loading|=4,c.instance=b,Kt(b),b;p=S3(f),(v=nr.get(v))&&ig(p,v),b=(a.ownerDocument||a).createElement("link"),Kt(b);var C=b;return C._p=new Promise(function(B,K){C.onload=B,C.onerror=K}),sn(b,"link",p),c.state.loading|=4,Au(b,f.precedence,a),c.instance=b;case"script":return b=Oa(f.src),(v=a.querySelector(ul(b)))?(c.instance=v,Kt(v),v):(p=f,(v=nr.get(b))&&(p=h({},f),sg(p,v)),a=a.ownerDocument||a,v=a.createElement("script"),Kt(v),sn(v,"link",p),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Au(p,f.precedence,a));return c.instance}function Au(a,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=p.length?p[p.length-1]:null,b=v,C=0;C<p.length;C++){var B=p[C];if(B.dataset.precedence===c)b=B;else if(b!==v)break}b?b.parentNode.insertBefore(a,b.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function ig(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function sg(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Ru=null;function A3(a,c,f){if(Ru===null){var p=new Map,v=Ru=new Map;v.set(f,p)}else v=Ru,p=v.get(f),p||(p=new Map,v.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),v=0;v<f.length;v++){var b=f[v];if(!(b[To]||b[un]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var C=b.getAttribute(c)||"";C=a+C;var B=p.get(C);B?B.push(b):p.set(C,[b])}}return p}function R3(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function oB(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function C3(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var fl=null;function lB(){}function cB(a,c,f){if(fl===null)throw Error(r(475));var p=fl;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Ia(f.href),b=a.querySelector(cl(v));if(b){a=b._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=Cu.bind(p),a.then(p,p)),c.state.loading|=4,c.instance=b,Kt(b);return}b=a.ownerDocument||a,f=S3(f),(v=nr.get(v))&&ig(f,v),b=b.createElement("link"),Kt(b);var C=b;C._p=new Promise(function(B,K){C.onload=B,C.onerror=K}),sn(b,"link",f),c.instance=b}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=Cu.bind(p),a.addEventListener("load",c),a.addEventListener("error",c))}}function uB(){if(fl===null)throw Error(r(475));var a=fl;return a.stylesheets&&a.count===0&&ag(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&ag(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function Cu(){if(this.count--,this.count===0){if(this.stylesheets)ag(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Nu=null;function ag(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Nu=new Map,c.forEach(fB,a),Nu=null,Cu.call(a))}function fB(a,c){if(!(c.state.loading&4)){var f=Nu.get(a);if(f)var p=f.get(null);else{f=new Map,Nu.set(a,f);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<v.length;b++){var C=v[b];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(f.set(C.dataset.precedence,C),p=C)}p&&f.set(null,p)}v=c.instance,C=v.getAttribute("data-precedence"),b=f.get(C)||p,b===p&&f.set(null,v),f.set(C,v),this.count++,p=Cu.bind(this),v.addEventListener("load",p),v.addEventListener("error",p),b?b.parentNode.insertBefore(v,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var dl={$$typeof:E,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function dB(a,c,f,p,v,b,C,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nh(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nh(0),this.hiddenUpdates=nh(null),this.identifierPrefix=p,this.onUncaughtError=v,this.onCaughtError=b,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function N3(a,c,f,p,v,b,C,B,K,fe,pe,ve){return a=new dB(a,c,f,C,B,K,fe,ve),c=1,b===!0&&(c|=24),b=Dn(3,null,null,c),a.current=b,b.stateNode=a,c=zh(),c.refCount++,a.pooledCache=c,c.refCount++,b.memoizedState={element:p,isDehydrated:f,cache:c},Hh(b),a}function k3(a){return a?(a=ua,a):ua}function M3(a,c,f,p,v,b){v=k3(v),p.context===null?p.context=v:p.pendingContext=v,p=yi(c),p.payload={element:f},b=b===void 0?null:b,b!==null&&(p.callback=b),f=bi(a,p,c),f!==null&&(Fn(f,a,c),Vo(f,a,c))}function I3(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function og(a,c){I3(a,c),(a=a.alternate)&&I3(a,c)}function O3(a){if(a.tag===13){var c=ca(a,67108864);c!==null&&Fn(c,a,67108864),og(a,67108864)}}var ku=!0;function hB(a,c,f,p){var v=V.T;V.T=null;var b=$.p;try{$.p=2,lg(a,c,f,p)}finally{$.p=b,V.T=v}}function pB(a,c,f,p){var v=V.T;V.T=null;var b=$.p;try{$.p=8,lg(a,c,f,p)}finally{$.p=b,V.T=v}}function lg(a,c,f,p){if(ku){var v=cg(p);if(v===null)Gp(a,c,p,Mu,f),D3(a,p);else if(mB(v,a,c,f,p))p.stopPropagation();else if(D3(a,p),c&4&&-1<gB.indexOf(a)){for(;v!==null;){var b=Zs(v);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var C=Xe(b.pendingLanes);if(C!==0){var B=b;for(B.pendingLanes|=2,B.entangledLanes|=2;C;){var K=1<<31-vt(C);B.entanglements[1]|=K,C&=~K}Ir(b),(rt&6)===0&&(pu=Ce()+500,sl(0))}}break;case 13:B=ca(b,2),B!==null&&Fn(B,b,2),mu(),og(b,2)}if(b=cg(p),b===null&&Gp(a,c,p,Mu,f),b===v)break;v=b}v!==null&&p.stopPropagation()}else Gp(a,c,p,null,f)}}function cg(a){return a=ph(a),ug(a)}var Mu=null;function ug(a){if(Mu=null,a=Ks(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Mu=a,null}function P3(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ln()){case Gt:return 2;case On:return 8;case _n:case cn:return 32;case Ye:return 268435456;default:return 32}default:return 32}}var fg=!1,Oi=null,Pi=null,Di=null,hl=new Map,pl=new Map,ji=[],gB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function D3(a,c){switch(a){case"focusin":case"focusout":Oi=null;break;case"dragenter":case"dragleave":Pi=null;break;case"mouseover":case"mouseout":Di=null;break;case"pointerover":case"pointerout":hl.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":pl.delete(c.pointerId)}}function gl(a,c,f,p,v,b){return a===null||a.nativeEvent!==b?(a={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:b,targetContainers:[v]},c!==null&&(c=Zs(c),c!==null&&O3(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function mB(a,c,f,p,v){switch(c){case"focusin":return Oi=gl(Oi,a,c,f,p,v),!0;case"dragenter":return Pi=gl(Pi,a,c,f,p,v),!0;case"mouseover":return Di=gl(Di,a,c,f,p,v),!0;case"pointerover":var b=v.pointerId;return hl.set(b,gl(hl.get(b)||null,a,c,f,p,v)),!0;case"gotpointercapture":return b=v.pointerId,pl.set(b,gl(pl.get(b)||null,a,c,f,p,v)),!0}return!1}function j3(a){var c=Ks(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,c6(a.priority,function(){if(f.tag===13){var p=Un();p=rh(p);var v=ca(f,p);v!==null&&Fn(v,f,p),og(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Iu(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=cg(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);hh=p,f.target.dispatchEvent(p),hh=null}else return c=Zs(f),c!==null&&O3(c),a.blockedOn=f,!1;c.shift()}return!0}function B3(a,c,f){Iu(a)&&f.delete(c)}function _B(){fg=!1,Oi!==null&&Iu(Oi)&&(Oi=null),Pi!==null&&Iu(Pi)&&(Pi=null),Di!==null&&Iu(Di)&&(Di=null),hl.forEach(B3),pl.forEach(B3)}function Ou(a,c){a.blockedOn===c&&(a.blockedOn=null,fg||(fg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,_B)))}var Pu=null;function L3(a){Pu!==a&&(Pu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Pu===a&&(Pu=null);for(var c=0;c<a.length;c+=3){var f=a[c],p=a[c+1],v=a[c+2];if(typeof p!="function"){if(ug(p||f)===null)continue;break}var b=Zs(f);b!==null&&(a.splice(c,3),c-=3,up(b,{pending:!0,data:v,method:f.method,action:p},p,v))}}))}function ml(a){function c(K){return Ou(K,a)}Oi!==null&&Ou(Oi,a),Pi!==null&&Ou(Pi,a),Di!==null&&Ou(Di,a),hl.forEach(c),pl.forEach(c);for(var f=0;f<ji.length;f++){var p=ji[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<ji.length&&(f=ji[0],f.blockedOn===null);)j3(f),f.blockedOn===null&&ji.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var v=f[p],b=f[p+1],C=v[An]||null;if(typeof b=="function")C||L3(f);else if(C){var B=null;if(b&&b.hasAttribute("formAction")){if(v=b,C=b[An]||null)B=C.formAction;else if(ug(v)!==null)continue}else B=C.action;typeof B=="function"?f[p+1]=B:(f.splice(p,3),p-=3),L3(f)}}}function dg(a){this._internalRoot=a}Du.prototype.render=dg.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=Un();M3(f,p,a,c,null,null)},Du.prototype.unmount=dg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;M3(a.current,2,null,a,null,null),mu(),c[Gs]=null}};function Du(a){this._internalRoot=a}Du.prototype.unstable_scheduleHydration=function(a){if(a){var c=t2();a={blockedOn:null,target:a,priority:c};for(var f=0;f<ji.length&&c!==0&&c<ji[f].priority;f++);ji.splice(f,0,a),f===0&&j3(a)}};var U3=e.version;if(U3!=="19.1.0")throw Error(r(527,U3,"19.1.0"));$.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var vB={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ju=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ju.isDisabled&&ju.supportsFiber)try{We=ju.inject(vB),ze=ju}catch{}}return vl.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,p="",v=tT,b=nT,C=rT,B=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(C=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(B=c.unstable_transitionCallbacks)),c=N3(a,1,!1,null,null,f,p,v,b,C,B,null),a[Gs]=c.current,Yp(a),new dg(c)},vl.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var p=!1,v="",b=tT,C=nT,B=rT,K=null,fe=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(b=f.onUncaughtError),f.onCaughtError!==void 0&&(C=f.onCaughtError),f.onRecoverableError!==void 0&&(B=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(K=f.unstable_transitionCallbacks),f.formState!==void 0&&(fe=f.formState)),c=N3(a,1,!0,c,f??null,p,v,b,C,B,K,fe),c.context=k3(null),f=c.current,p=Un(),p=rh(p),v=yi(p),v.callback=null,bi(f,v,p),f=p,c.current.lanes=f,wo(c,f),Ir(c),a[Gs]=c.current,Yp(a),new Du(c)},vl.version="19.1.0",vl}var G3;function kB(){if(G3)return pg.exports;G3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),pg.exports=NB(),pg.exports}var MB=kB(),F=Lx();const Kl=Bx(F),IB=wB({__proto__:null,default:Kl},[F]);wM();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Zl(){return Zl=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Zl.apply(this,arguments)}var Xi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Xi||(Xi={}));const K3="popstate";function OB(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return k0("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:SM(i)}return DB(e,n,null,t)}function Yt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function TM(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function PB(){return Math.random().toString(36).substr(2,8)}function Z3(t,e){return{usr:t.state,key:t.key,idx:e}}function k0(t,e,n,r){return n===void 0&&(n=null),Zl({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ho(e):e,{state:n,key:e&&e.key||r||PB()})}function SM(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ho(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function DB(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l=Xi.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(Zl({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function g(){l=Xi.Pop;let x=h(),S=x==null?null:x-d;d=x,u&&u({action:l,location:w.location,delta:S})}function _(x,S){l=Xi.Push;let R=k0(w.location,x,S);d=h()+1;let E=Z3(R,d),A=w.createHref(R);try{o.pushState(E,"",A)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;i.location.assign(A)}s&&u&&u({action:l,location:w.location,delta:1})}function y(x,S){l=Xi.Replace;let R=k0(w.location,x,S);d=h();let E=Z3(R,d),A=w.createHref(R);o.replaceState(E,"",A),s&&u&&u({action:l,location:w.location,delta:0})}function T(x){let S=i.location.origin!=="null"?i.location.origin:i.location.href,R=typeof x=="string"?x:SM(x);return R=R.replace(/ $/,"%20"),Yt(S,"No window.location.(origin|href) available to create URL for href: "+R),new URL(R,S)}let w={get action(){return l},get location(){return t(i,o)},listen(x){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(K3,g),u=x,()=>{i.removeEventListener(K3,g),u=null}},createHref(x){return e(i,x)},createURL:T,encodeLocation(x){let S=T(x);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:_,replace:y,go(x){return o.go(x)}};return w}var Q3;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Q3||(Q3={}));function jB(t,e,n){return n===void 0&&(n="/"),BB(t,e,n)}function BB(t,e,n,r){let i=typeof e=="string"?ho(e):e,s=RM(i.pathname||"/",n);if(s==null)return null;let o=EM(t);LB(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=KB(s);l=XB(o[u],d)}return l}function EM(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,o,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(Yt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=As([r,u.relativePath]),h=n.concat(u);s.children&&s.children.length>0&&(Yt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),EM(s.children,e,h,d)),!(s.path==null&&!s.index)&&e.push({path:d,score:HB(d,s.index),routesMeta:h})};return t.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,o);else for(let u of AM(s.path))i(s,o,u)}),e}function AM(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=AM(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function LB(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:WB(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const UB=/^:[\w-]+$/,FB=3,zB=2,VB=1,qB=10,$B=-2,J3=t=>t==="*";function HB(t,e){let n=t.split("/"),r=n.length;return n.some(J3)&&(r+=$B),e&&(r+=zB),n.filter(i=>!J3(i)).reduce((i,s)=>i+(UB.test(s)?FB:s===""?VB:qB),r)}function WB(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function XB(t,e,n){let{routesMeta:r}=t,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",g=YB({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),_=u.route;if(!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:As([s,g.pathname]),pathnameBase:nL(As([s,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(s=As([s,g.pathnameBase]))}return o}function YB(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=GB(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,h,g)=>{let{paramName:_,isOptional:y}=h;if(_==="*"){let w=l[g]||"";o=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const T=l[g];return y&&!T?d[_]=void 0:d[_]=(T||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:t}}function GB(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),TM(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function KB(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return TM(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function RM(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function ZB(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ho(t):t;return{pathname:n?n.startsWith("/")?n:QB(n,e):e,search:rL(r),hash:iL(i)}}function QB(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function yg(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function JB(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function eL(t,e){let n=JB(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function tL(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=ho(t):(i=Zl({},t),Yt(!i.pathname||!i.pathname.includes("?"),yg("?","pathname","search",i)),Yt(!i.pathname||!i.pathname.includes("#"),yg("#","pathname","hash",i)),Yt(!i.search||!i.search.includes("#"),yg("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=n;else{let g=e.length-1;if(!r&&o.startsWith("..")){let _=o.split("/");for(;_[0]==="..";)_.shift(),g-=1;i.pathname=_.join("/")}l=g>=0?e[g]:"/"}let u=ZB(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const As=t=>t.join("/").replace(/\/\/+/g,"/"),nL=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),rL=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,iL=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function sL(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const CM=["post","put","patch","delete"];new Set(CM);const aL=["get",...CM];new Set(aL);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ql(){return Ql=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ql.apply(this,arguments)}const Ux=F.createContext(null),oL=F.createContext(null),wd=F.createContext(null),Td=F.createContext(null),Us=F.createContext({outlet:null,matches:[],isDataRoute:!1}),NM=F.createContext(null);function Sd(){return F.useContext(Td)!=null}function cc(){return Sd()||Yt(!1),F.useContext(Td).location}function kM(t){F.useContext(wd).static||F.useLayoutEffect(t)}function uc(){let{isDataRoute:t}=F.useContext(Us);return t?bL():lL()}function lL(){Sd()||Yt(!1);let t=F.useContext(Ux),{basename:e,future:n,navigator:r}=F.useContext(wd),{matches:i}=F.useContext(Us),{pathname:s}=cc(),o=JSON.stringify(eL(i,n.v7_relativeSplatPath)),l=F.useRef(!1);return kM(()=>{l.current=!0}),F.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let g=tL(d,JSON.parse(o),s,h.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:As([e,g.pathname])),(h.replace?r.replace:r.push)(g,h.state,h)},[e,r,o,s,t])}function MM(){let{matches:t}=F.useContext(Us),e=t[t.length-1];return e?e.params:{}}function cL(t,e){return uL(t,e)}function uL(t,e,n,r){Sd()||Yt(!1);let{navigator:i}=F.useContext(wd),{matches:s}=F.useContext(Us),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=cc(),h;if(e){var g;let x=typeof e=="string"?ho(e):e;u==="/"||(g=x.pathname)!=null&&g.startsWith(u)||Yt(!1),h=x}else h=d;let _=h.pathname||"/",y=_;if(u!=="/"){let x=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(x.length).join("/")}let T=jB(t,{pathname:y}),w=gL(T&&T.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:As([u,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?u:As([u,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),s,n,r);return e&&w?F.createElement(Td.Provider,{value:{location:Ql({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Xi.Pop}},w):w}function fL(){let t=yL(),e=sL(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return F.createElement(F.Fragment,null,F.createElement("h2",null,"Unexpected Application Error!"),F.createElement("h3",{style:{fontStyle:"italic"}},e),n?F.createElement("pre",{style:i},n):null,null)}const dL=F.createElement(fL,null);class hL extends F.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?F.createElement(Us.Provider,{value:this.props.routeContext},F.createElement(NM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pL(t){let{routeContext:e,match:n,children:r}=t,i=F.useContext(Ux);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),F.createElement(Us.Provider,{value:e},r)}function gL(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(i=n)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(g=>g.route.id&&(l==null?void 0:l[g.route.id])!==void 0);h>=0||Yt(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let g=o[h];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=h),g.route.id){let{loaderData:_,errors:y}=n,T=g.route.loader&&_[g.route.id]===void 0&&(!y||y[g.route.id]===void 0);if(g.route.lazy||T){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,g,_)=>{let y,T=!1,w=null,x=null;n&&(y=l&&g.route.id?l[g.route.id]:void 0,w=g.route.errorElement||dL,u&&(d<0&&_===0?(xL("route-fallback"),T=!0,x=null):d===_&&(T=!0,x=g.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,_+1)),R=()=>{let E;return y?E=w:T?E=x:g.route.Component?E=F.createElement(g.route.Component,null):g.route.element?E=g.route.element:E=h,F.createElement(pL,{match:g,routeContext:{outlet:h,matches:S,isDataRoute:n!=null},children:E})};return n&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?F.createElement(hL,{location:n.location,revalidation:n.revalidation,component:w,error:y,children:R(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):R()},null)}var IM=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(IM||{}),OM=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(OM||{});function mL(t){let e=F.useContext(Ux);return e||Yt(!1),e}function _L(t){let e=F.useContext(oL);return e||Yt(!1),e}function vL(t){let e=F.useContext(Us);return e||Yt(!1),e}function PM(t){let e=vL(),n=e.matches[e.matches.length-1];return n.route.id||Yt(!1),n.route.id}function yL(){var t;let e=F.useContext(NM),n=_L(),r=PM();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function bL(){let{router:t}=mL(IM.UseNavigateStable),e=PM(OM.UseNavigateStable),n=F.useRef(!1);return kM(()=>{n.current=!0}),F.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Ql({fromRouteId:e},s)))},[t,e])}const eS={};function xL(t,e,n){eS[t]||(eS[t]=!0)}function wL(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Rl(t){Yt(!1)}function TL(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Xi.Pop,navigator:s,static:o=!1,future:l}=t;Sd()&&Yt(!1);let u=e.replace(/^\/*/,"/"),d=F.useMemo(()=>({basename:u,navigator:s,static:o,future:Ql({v7_relativeSplatPath:!1},l)}),[u,l,s,o]);typeof r=="string"&&(r=ho(r));let{pathname:h="/",search:g="",hash:_="",state:y=null,key:T="default"}=r,w=F.useMemo(()=>{let x=RM(h,u);return x==null?null:{location:{pathname:x,search:g,hash:_,state:y,key:T},navigationType:i}},[u,h,g,_,y,T,i]);return w==null?null:F.createElement(wd.Provider,{value:d},F.createElement(Td.Provider,{children:n,value:w}))}function SL(t){let{children:e,location:n}=t;return cL(M0(e),n)}new Promise(()=>{});function M0(t,e){e===void 0&&(e=[]);let n=[];return F.Children.forEach(t,(r,i)=>{if(!F.isValidElement(r))return;let s=[...e,i];if(r.type===F.Fragment){n.push.apply(n,M0(r.props.children,s));return}r.type!==Rl&&Yt(!1),!r.props.index||!r.props.children||Yt(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=M0(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const EL="6";try{window.__reactRouterVersion=EL}catch{}const AL="startTransition",tS=IB[AL];function RL(t){let{basename:e,children:n,future:r,window:i}=t,s=F.useRef();s.current==null&&(s.current=OB({window:i,v5Compat:!0}));let o=s.current,[l,u]=F.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=F.useCallback(g=>{d&&tS?tS(()=>u(g)):u(g)},[u,d]);return F.useLayoutEffect(()=>o.listen(h),[o,h]),F.useEffect(()=>wL(r),[r]),F.createElement(TL,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}var nS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(nS||(nS={}));var rS;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(rS||(rS={}));const CL=()=>(console.log("Using default API base: /api"),"/api"),yn={BASE_URL:CL(),ENDPOINTS:{CREATE_SESSION:"/create-session",GET_SESSION:"/session",UPLOAD:"/upload-tree-sequence",UPLOADED_FILES:"/uploaded-files/",TREE_SEQUENCE_METADATA:"/tree-sequence-metadata",DELETE_TREE_SEQUENCE:"/tree-sequence",DOWNLOAD_TREE_SEQUENCE:"/download-tree-sequence",GRAPH_DATA:"/graph-data",INFER_LOCATIONS_FAST:"/infer-locations-fast",INFER_LOCATIONS_GAIA_QUADRATIC:"/infer-locations-gaia-quadratic",INFER_LOCATIONS_MIDPOINT:"/infer-locations-midpoint",INFER_LOCATIONS_SPARG:"/infer-locations-sparg",SIMULATE_TREE_SEQUENCE:"/simulate-tree-sequence/"}},NL={LOADING_DOTS_INTERVAL:420},Yi={DEFAULT_MAX_SAMPLES:25,MIN_SAMPLES:2,WARNING_THRESHOLD:25},bg={ACCEPTED_FORMATS:{"application/octet-stream":[".trees",".tsz"],"application/x-trees":[".trees"],"application/x-tsz":[".tsz"]},CSV_FORMATS:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]}},yl={UPLOAD_FAILED:"Upload failed",DOWNLOAD_FAILED:"Download failed",FETCH_FAILED:"Failed to fetch data",NO_SPATIAL_DATA:"No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.",NO_SPATIAL_RANGE:"No spatial data found in this genomic range.",UNKNOWN_ERROR:"Unknown error occurred"},DM=F.createContext(void 0);function kL({children:t}){const[e,n]=F.useState(null),[r,i]=F.useState(Yi.DEFAULT_MAX_SAMPLES),s=l=>{if(n(l),l!=null&&l.num_samples){const u=Math.min(Yi.DEFAULT_MAX_SAMPLES,l.num_samples);i(u)}},o=l=>{if(e!=null&&e.num_samples){const u=Math.max(Yi.MIN_SAMPLES,Math.min(l,e.num_samples));i(u)}else i(Math.min(l,Yi.DEFAULT_MAX_SAMPLES))};return m.jsx(DM.Provider,{value:{treeSequence:e,setTreeSequence:s,maxSamples:r,setMaxSamples:o},children:t})}function Fs(){const t=F.useContext(DM);if(t===void 0)throw new Error("useTreeSequence must be used within a TreeSequenceProvider");return t}var jM=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t))(jM||{});class ML{constructor(){D(this,"logLevel");D(this,"isDevelopment");this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:2}shouldLog(e){return e>=this.logLevel}formatMessage(e,n,r){const i=new Date().toISOString(),s=r!=null&&r.component?`[${r.component}]`:"",o=r!=null&&r.action?`(${r.action})`:"";return`[${i}] ${e} ${s}${o} ${n}`}logToConsole(e,n,r,i){const s=jM[e],o=this.formatMessage(s,n,r);switch(e){case 0:console.debug(o,r==null?void 0:r.data);break;case 1:console.info(o,r==null?void 0:r.data);break;case 2:console.warn(o,r==null?void 0:r.data);break;case 3:console.error(o,i||(r==null?void 0:r.error),r==null?void 0:r.data);break}}debug(e,n){this.shouldLog(0)&&this.logToConsole(0,e,n)}info(e,n){this.shouldLog(1)&&this.logToConsole(1,e,n)}warn(e,n){this.shouldLog(2)&&this.logToConsole(2,e,n)}error(e,n){this.shouldLog(3)&&this.logToConsole(3,e,n,n==null?void 0:n.error)}apiCall(e,n="GET",r){this.debug(`API ${n} ${e}`,{action:"api-call",data:{endpoint:e,method:n,payload:r}})}apiSuccess(e,n="GET",r){this.info(`API ${n} ${e} succeeded`,{action:"api-success",data:{endpoint:e,method:n,response:r}})}apiError(e,n,r="GET"){this.error(`API ${r} ${e} failed`,{action:"api-error",error:n,data:{endpoint:e,method:r}})}componentMount(e,n){this.debug(`${e} mounted`,{component:e,action:"mount",data:n})}componentUnmount(e){this.debug(`${e} unmounted`,{component:e,action:"unmount"})}userAction(e,n,r){this.info(`User action: ${e}`,{component:r,action:"user-action",data:n})}dataProcessing(e,n,r,i){this.debug(`Data processing: ${e}`,{component:n,action:"data-processing",data:{operation:e,inputSize:r,outputSize:i}})}navigation(e,n){this.info(`Navigation: ${e}  ${n}`,{action:"navigation",data:{from:e,to:n}})}performance(e,n,r){this.info(`Performance: ${e} took ${n}ms`,{component:r,action:"performance",data:{operation:e,duration:n}})}}const zn=new ML,Se={debug:(t,e)=>zn.debug(t,e),info:(t,e)=>zn.info(t,e),warn:(t,e)=>zn.warn(t,e),error:(t,e)=>zn.error(t,e),api:{call:(t,e,n)=>zn.apiCall(t,e,n),success:(t,e,n)=>zn.apiSuccess(t,e,n),error:(t,e,n)=>zn.apiError(t,e,n)},component:{mount:(t,e)=>zn.componentMount(t,e),unmount:t=>zn.componentUnmount(t)},user:{action:(t,e,n)=>zn.userAction(t,e,n)},data:{processing:(t,e,n,r)=>zn.dataProcessing(t,e,n,r)},nav:(t,e)=>zn.navigation(t,e),perf:(t,e,n)=>zn.performance(t,e,n)};class IL{constructor(){D(this,"baseURL");this.baseURL=yn.BASE_URL}async request(e,n={}){const r=`${this.baseURL}${e}`,i=n.method||"GET";Se.api.call(e,i,n.body);try{const s=new AbortController,o=setTimeout(()=>s.abort(),6e4),l=await fetch(r,{...n,headers:{"Content-Type":"application/json",...n.headers},signal:s.signal});if(clearTimeout(o),!l.ok){const d=await l.json().catch(()=>null),h={message:`HTTP error! status: ${l.status}`,status:l.status,details:(d==null?void 0:d.detail)||"No details available"};throw Se.api.error(e,new Error(h.message),i),h}const u=await l.json();return Se.api.success(e,i,u),{data:u,status:l.status}}catch(s){if(s instanceof Error){if(s.name==="AbortError"){const l=new Error("Request timed out after 60 seconds");throw Se.api.error(e,l,i),l}throw Se.api.error(e,s,i),s}const o={message:yl.UNKNOWN_ERROR,details:String(s)};throw Se.api.error(e,new Error(o.message),i),o}}async uploadFile(e,n){const r=`${this.baseURL}${e}`,i=new FormData;i.append("file",n),Se.api.call(e,"POST",{filename:n.name,size:n.size});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok)throw new Error(yl.UPLOAD_FAILED);const o=await s.json();return Se.api.success(e,"POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:yl.UPLOAD_FAILED;throw Se.api.error(e,new Error(o),"POST"),s}}async getCurrentSession(){return this.request(yn.ENDPOINTS.GET_SESSION)}async uploadTreeSequence(e){return this.uploadFile(yn.ENDPOINTS.UPLOAD,e)}async getUploadedFiles(){return this.request(yn.ENDPOINTS.UPLOADED_FILES)}async getTreeSequenceMetadata(e){return this.request(`${yn.ENDPOINTS.TREE_SEQUENCE_METADATA}/${encodeURIComponent(e)}`)}async deleteTreeSequence(e){return this.request(`${yn.ENDPOINTS.DELETE_TREE_SEQUENCE}/${encodeURIComponent(e)}`,{method:"DELETE"})}async downloadTreeSequence(e,n="trees"){const r=`${this.baseURL}${yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE}/${encodeURIComponent(e)}?format=${n}`;Se.api.call(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{filename:e,format:n});try{const i=await fetch(r);if(!i.ok)throw new Error(yl.DOWNLOAD_FAILED);const s=await i.blob();return Se.api.success(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{size:s.size,format:n}),s}catch(i){const s=i instanceof Error?i.message:yl.DOWNLOAD_FAILED;throw Se.api.error(yn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,new Error(s),"GET"),i}}async getGraphData(e,n={}){const r=new URLSearchParams;n.maxSamples&&r.append("max_samples",n.maxSamples.toString()),n.genomicStart!==void 0&&r.append("genomic_start",n.genomicStart.toString()),n.genomicEnd!==void 0&&r.append("genomic_end",n.genomicEnd.toString()),n.treeStartIdx!==void 0&&r.append("tree_start_idx",n.treeStartIdx.toString()),n.treeEndIdx!==void 0&&r.append("tree_end_idx",n.treeEndIdx.toString()),n.sampleOrder&&r.append("sample_order",n.sampleOrder);const i=`${yn.ENDPOINTS.GRAPH_DATA}/${encodeURIComponent(e)}?${r}`;return this.request(i)}async inferLocationsFast(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_FAST,{method:"POST",body:JSON.stringify(e)})}async inferLocationsSparg(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_SPARG,{method:"POST",body:JSON.stringify(e)})}async inferLocationsGaiaQuadratic(e){return this.request("/infer-locations-gaia-quadratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsGaiaLinear(e){return this.request("/infer-locations-gaia-linear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsMidpoint(e){return this.request(yn.ENDPOINTS.INFER_LOCATIONS_MIDPOINT,{method:"POST",body:JSON.stringify(e)})}async simulateTreeSequence(e){return this.request(yn.ENDPOINTS.SIMULATE_TREE_SEQUENCE,{method:"POST",body:JSON.stringify(e)})}async uploadLocationCSV(e,n){const r=`${this.baseURL}/upload-location-csv?csv_type=${n}`,i=new FormData;i.append("file",e),Se.api.call("/upload-location-csv","POST",{filename:e.name,csvType:n});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok){const l=await s.json().catch(()=>null);throw new Error((l==null?void 0:l.detail)||"Failed to upload CSV")}const o=await s.json();return Se.api.success("/upload-location-csv","POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:"Failed to upload CSV";throw Se.api.error("/upload-location-csv",new Error(o),"POST"),s}}async updateTreeSequenceLocations(e){return this.request("/update-tree-sequence-locations",{method:"POST",body:JSON.stringify(e)})}async getAvailableCRS(){return this.request("/geographic/crs")}async getAvailableShapes(){return this.request("/geographic/shapes")}async uploadShapefile(e){return this.uploadFile("/geographic/upload-shapefile",e)}async getShapeData(e){return this.request(`/geographic/shape/${encodeURIComponent(e)}`)}async transformCoordinates(e){return this.request("/geographic/transform-coordinates",{method:"POST",body:JSON.stringify(e)})}async validateSpatialData(e){return this.request("/geographic/validate-spatial",{method:"POST",body:JSON.stringify(e)})}}const Dt=new IL,xt={getCurrentSession:()=>Dt.getCurrentSession(),uploadTreeSequence:t=>Dt.uploadTreeSequence(t),getUploadedFiles:()=>Dt.getUploadedFiles(),getTreeSequenceMetadata:t=>Dt.getTreeSequenceMetadata(t),deleteTreeSequence:t=>Dt.deleteTreeSequence(t),downloadTreeSequence:(t,e="trees")=>Dt.downloadTreeSequence(t,e),getGraphData:(t,e)=>Dt.getGraphData(t,e),inferLocationsFast:t=>Dt.inferLocationsFast(t),inferLocationsSparg:t=>Dt.inferLocationsSparg(t),inferLocationsGaiaQuadratic:t=>Dt.inferLocationsGaiaQuadratic(t),inferLocationsGaiaLinear:t=>Dt.inferLocationsGaiaLinear(t),inferLocationsMidpoint:t=>Dt.inferLocationsMidpoint(t),simulateTreeSequence:t=>Dt.simulateTreeSequence(t),uploadLocationCSV:(t,e)=>Dt.uploadLocationCSV(t,e),updateTreeSequenceLocations:t=>Dt.updateTreeSequenceLocations(t),getAvailableCRS:()=>Dt.getAvailableCRS(),getAvailableShapes:()=>Dt.getAvailableShapes(),uploadShapefile:t=>Dt.uploadShapefile(t),getShapeData:t=>Dt.getShapeData(t),transformCoordinates:t=>Dt.transformCoordinates(t),validateSpatialData:t=>Dt.validateSpatialData(t)},iS={tskit:{background:"#03303E",containerBackground:"#0f1419",nodeDefault:[96,160,183,255],nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:[80,160,175,255],nodeSelected:[255,255,255,255],edgeDefault:[153,153,153,102],edgeHighlight:[255,255,255,200],text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"},grayscale:{background:"#ffffff",containerBackground:"#f8f9fa",nodeDefault:[100,100,100,255],nodeRoot:[50,50,50,255],nodeSample:[70,70,70,255],nodeCombined:[120,120,120,255],nodeSelected:[0,0,0,255],edgeDefault:[140,140,140,128],edgeHighlight:[40,40,40,200],text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",exportBackground:"#ffffff",accentPrimary:"#085167",accentSecondary:"#085167",geographicGrid:[140,140,140,102],temporalGrid:[140,140,140,77],tooltipBackground:"rgba(0, 0, 0, 0.9)",tooltipText:"#ffffff",headerText:"#212529",controlPanelText:"#212529",buttonText:"#212529"}},BM=F.createContext(void 0),Lu="argscape_custom_themes",xg="argscape_selected_theme",bl="argscape_selected_custom_theme",OL=({children:t})=>{const[e,n]=F.useState("tskit"),[r,i]=F.useState([]),[s,o]=F.useState(null),[l,u]=F.useState("any");F.useEffect(()=>{try{const x=localStorage.getItem(Lu);x&&i(JSON.parse(x));const S=localStorage.getItem(xg);S&&(S==="tskit"||S==="grayscale"||S==="custom")&&n(S);const R=localStorage.getItem(bl);R&&o(R)}catch(x){console.warn("Failed to load saved color themes:",x)}},[]);const d=F.useCallback(x=>{n(x),localStorage.setItem(xg,x)},[]),h=F.useCallback(x=>{o(x),x?localStorage.setItem(bl,x):localStorage.removeItem(bl)},[]),g=F.useCallback((x,S)=>{const R=`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,E={id:R,name:x,colors:S};return i(A=>{const k=[...A,E];return localStorage.setItem(Lu,JSON.stringify(k)),k}),n("custom"),o(R),localStorage.setItem(xg,"custom"),localStorage.setItem(bl,R),R},[]),_=F.useCallback(x=>{i(S=>{const R=S.filter(E=>E.id!==x);return localStorage.setItem(Lu,JSON.stringify(R)),R}),s===x&&(o(null),localStorage.removeItem(bl))},[s]),y=F.useCallback((x,S,R)=>{i(E=>{const A=E.map(k=>k.id===x?{...k,name:S,colors:R}:k);return localStorage.setItem(Lu,JSON.stringify(A)),A})},[]),T=Kl.useMemo(()=>{if(e==="custom"&&s){const x=r.find(S=>S.id===s);if(x)return x.colors}return iS[e]||iS.tskit},[e,s,r]),w={theme:e,setTheme:d,colors:T,customThemes:r,selectedCustomTheme:s,setSelectedCustomTheme:h,saveCustomTheme:g,deleteCustomTheme:_,updateCustomTheme:y,currentVisualizationType:l,setCurrentVisualizationType:u};return m.jsx(BM.Provider,{value:w,children:t})},Vt=()=>{const t=F.useContext(BM);if(t===void 0)throw new Error("useColorTheme must be used within a ColorThemeProvider");return t},LM=t=>{if(t.startsWith("#")){const n=t.slice(1),r=parseInt(n.substr(0,2),16),i=parseInt(n.substr(2,2),16),s=parseInt(n.substr(4,2),16);return[r,i,s,255]}const e=t.match(/rgba?\(([^)]+)\)/);if(e){const n=e[1].split(",").map(r=>parseFloat(r.trim()));return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round((n[3]??1)*255)]}return[128,128,128,255]},UM=t=>{const e=["background","nodeSample","nodeRoot","nodeDefault","edgeDefault"];switch(t){case"force-directed":return e;case"spatial-3d":return[...e,"geographicGrid","temporalGrid"];case"any":default:return[...e,"geographicGrid","temporalGrid"]}},PL=t=>{const e=["background","containerBackground","nodeDefault","nodeRoot","nodeSample","nodeCombined","nodeSelected","edgeDefault","edgeHighlight","text","textSecondary","border","exportBackground","accentPrimary","accentSecondary","geographicGrid","temporalGrid","tooltipBackground","tooltipText","headerText","controlPanelText","buttonText"],n=UM(t);return e.filter(r=>!n.includes(r))},FM=t=>`#${t[0].toString(16).padStart(2,"0")}${t[1].toString(16).padStart(2,"0")}${t[2].toString(16).padStart(2,"0")}`;function fc({className:t="",style:e={},size:n="medium",showSubtext:r=!1}){const i=uc(),{colors:s}=Vt(),o=()=>{i("/",{state:{forceIntro:!0}})},l=()=>{switch(n){case"small":return"text-xl md:text-2xl";case"medium":return"text-2xl md:text-3xl";case"large":return"text-[3rem] md:text-[4rem]";default:return"text-2xl md:text-3xl"}};return m.jsxs("div",{className:"cursor-pointer select-none",onClick:o,children:[m.jsxs("h1",{className:`${l()} font-extrabold tracking-tight ${t}`,style:{letterSpacing:"-0.04em",...e},children:["ARG",m.jsx("span",{style:{color:s.accentPrimary},children:"scape"})]}),r&&m.jsx("div",{className:"mt-2 text-center",children:m.jsx("div",{className:"text-sm font-medium",style:{color:s.accentPrimary},children:"Visualizing Ancestral Recombination Graphs"})})]})}function zM({isOpen:t,title:e,message:n,buttonText:r="OK",onClose:i,type:s="info"}){if(F.useEffect(()=>{const h=g=>{g.key==="Escape"&&i()};return t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[t,i]),!t)return null;const o=()=>{switch(s){case"success":return{icon:m.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-green-500/10",buttonColor:"bg-green-600 hover:bg-green-500 text-white"};case"error":return{icon:m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-red-500/10",buttonColor:"bg-red-600 hover:bg-red-500 text-white"};default:return{icon:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-sp-pale-green/10",buttonColor:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}}},{icon:l,bgColor:u,buttonColor:d}=o();return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:i}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u}`,children:l}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("div",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),m.jsx("div",{className:"flex justify-end",children:m.jsx("button",{onClick:i,className:`font-bold py-3 px-6 rounded-xl transition-all duration-200 ${d}`,children:r})})]})})]})}function Fx({filename:t,onError:e}){const[n,r]=F.useState(!1),i=async s=>{try{const o=await xt.downloadTreeSequence(t,s),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const d=`${t.replace(/\.(trees|tsz)$/,"")}.${s}`;u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),Se.user.action("download-tree-sequence",{filename:t,format:s},"DownloadDropdown"),r(!1)}catch(o){Se.error("Download failed",{component:"DownloadDropdown",error:o instanceof Error?o:new Error(String(o)),data:{filename:t}}),e&&o instanceof Error&&e(o)}};return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>r(!n),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download",m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&m.jsx("div",{className:"absolute z-50 w-48 mt-2 right-0 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsxs("div",{className:"py-2",children:[m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("trees"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download .trees"]}),m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("tsz"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Download .tsz"]})]})})]})}function VM({isOpen:t,title:e,message:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:s,onCancel:o,type:l="default"}){if(F.useEffect(()=>{const d=h=>{h.key==="Escape"&&o()};return t&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}},[t,o]),!t)return null;const u=l==="danger";return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u?"bg-red-500/10":"bg-sp-pale-green/10"}`,children:u?m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("p",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:o,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:i}),m.jsx("button",{onClick:s,className:`flex-1 font-bold py-3 px-4 rounded-xl transition-all duration-200 ${u?"bg-red-600 hover:bg-red-500 text-white":"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}`,children:r})]})]})})]})}function qM({onSelect:t,className:e=""}){const[n,r]=F.useState([]),[i,s]=F.useState({}),[o,l]=F.useState(!1),[u,d]=F.useState(""),[h,g]=F.useState(new Set),[_,y]=F.useState(-1),{treeSequence:T}=Fs(),[w,x]=F.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default"}),[S,R]=F.useState({isOpen:!1,title:"",message:"",type:"info"}),E=async()=>{var M;l(!0);try{Se.data.processing("fetch-available-tree-sequences","TreeSequenceSelector");const X=(await xt.getUploadedFiles()).data;r(X.uploaded_tree_sequences||[]),Se.info(`Loaded ${((M=X.uploaded_tree_sequences)==null?void 0:M.length)||0} tree sequences`,{component:"TreeSequenceSelector",action:"fetch-available"})}catch(q){Se.error("Failed to fetch available tree sequences",{component:"TreeSequenceSelector",error:q instanceof Error?q:new Error(String(q))}),r([])}finally{l(!1)}},A=async M=>{try{Se.data.processing("fetch-metadata","TreeSequenceSelector",void 0,void 0);const X=(await xt.getTreeSequenceMetadata(M)).data;return Se.debug(`Retrieved metadata for ${M}`,{component:"TreeSequenceSelector",data:{filename:M,num_samples:X.num_samples,num_nodes:X.num_nodes}}),{filename:X.filename,num_samples:X.num_samples,num_nodes:X.num_nodes,num_edges:X.num_edges,num_trees:X.num_trees,has_temporal:X.has_temporal,has_sample_spatial:X.has_sample_spatial,has_all_spatial:X.has_all_spatial,spatial_status:X.spatial_status}}catch(q){return Se.error(`Failed to get metadata for ${M}`,{component:"TreeSequenceSelector",error:q instanceof Error?q:new Error(String(q)),data:{filename:M}}),null}};F.useEffect(()=>{E()},[]),F.useEffect(()=>{const M=async()=>{const q={};for(const X of n){const G=await A(X);G&&(q[X]=G)}s(q)};n.length>0&&M()},[n]);const k=()=>{u&&i[u]&&t(i[u])},O=(M,q,X)=>{if((X.shiftKey||X.ctrlKey||X.metaKey)&&X.preventDefault(),X.shiftKey&&_!==-1){const G=Math.min(_,q),L=Math.max(_,q),J=new Set;for(let V=G;V<=L;V++)J.add(n[V]);g(J)}else if(X.ctrlKey||X.metaKey){const G=new Set(h);G.has(M)?G.delete(M):G.add(M),g(G),y(q)}else d(M),g(new Set([M])),y(q)},j=async(M,q)=>{q.stopPropagation(),x({isOpen:!0,title:"Delete Tree Sequence",message:`Are you sure you want to delete "${M}"?`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{Se.user.action("delete-tree-sequence",{filename:M},"TreeSequenceSelector");const X=await xt.deleteTreeSequence(M);Se.info(`Successfully deleted tree sequence: ${M}`,{component:"TreeSequenceSelector",data:{filename:M}}),r(G=>G.filter(L=>L!==M)),s(G=>{const L={...G};return delete L[M],L}),u===M&&d(""),g(G=>{const L=new Set(G);return L.delete(M),L})}catch(X){Se.error("Failed to delete tree sequence",{component:"TreeSequenceSelector",error:X instanceof Error?X:new Error(String(X)),data:{filename:M}}),R({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequence: ${X instanceof Error?X.message:"Unknown error"}`,type:"error"})}}})},N=async()=>{if(h.size===0)return;const M=Array.from(h),q=M.length===1?`Are you sure you want to delete "${M[0]}"?`:`Are you sure you want to delete ${M.length} tree sequences?`;x({isOpen:!0,title:"Delete Tree Sequences",message:q,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const X=M.map(G=>xt.deleteTreeSequence(G));await Promise.all(X),Se.info(`Successfully deleted ${M.length} tree sequences`,{component:"TreeSequenceSelector",data:{filenames:M}}),r(G=>G.filter(L=>!M.includes(L))),s(G=>{const L={...G};return M.forEach(J=>delete L[J]),L}),g(new Set),M.includes(u)&&d("")}catch(X){Se.error("Failed to delete selected tree sequences",{component:"TreeSequenceSelector",error:X instanceof Error?X:new Error(String(X)),data:{filenames:M}}),R({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequences: ${X instanceof Error?X.message:"Unknown error"}`,type:"error"})}}})},I=async()=>{n.length!==0&&x({isOpen:!0,title:"Clear All Tree Sequences",message:`Are you sure you want to delete ALL ${n.length} tree sequences? This action cannot be undone.`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const M=n.map(q=>xt.deleteTreeSequence(q));await Promise.all(M),Se.info(`Successfully cleared all ${n.length} tree sequences`,{component:"TreeSequenceSelector",data:{count:n.length}}),r([]),s({}),g(new Set),d("")}catch(M){Se.error("Failed to clear all tree sequences",{component:"TreeSequenceSelector",error:M instanceof Error?M:new Error(String(M))}),R({isOpen:!0,title:"Clear Failed",message:`Failed to clear all tree sequences: ${M instanceof Error?M.message:"Unknown error"}`,type:"error"}),E()}}})};return o?m.jsx("div",{className:`flex items-center justify-center p-8 ${e}`,children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sp-pale-green"})}):n.length===0?m.jsx("div",{className:e,children:m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-8 text-center",children:[m.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[m.jsx("div",{className:"w-10 h-10 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"No Existing Tree Sequences"})]}),m.jsx("p",{className:"text-sp-white/60 text-sm mb-6",children:"No previously uploaded sequences found. Upload or simulate a tree sequence first."}),m.jsxs("button",{onClick:E,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2 mx-auto",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}):m.jsxs("div",{className:e,children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5 mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Select Existing Tree Sequence"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Choose from previously uploaded sequences"})]}),h.size>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{className:"text-sm text-sp-white/70",children:[h.size," selected"]}),m.jsxs("button",{onClick:N,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-1",title:`Delete ${h.size} selected tree sequence${h.size>1?"s":""}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete"]})]})]}),m.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto select-none",children:n.map((M,q)=>{const X=i[M],G=(T==null?void 0:T.filename)===M,L=u===M,J=h.has(M);return m.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${L?"border-sp-pale-green bg-sp-very-dark-blue shadow-lg":J?"border-blue-400 bg-sp-very-dark-blue shadow-md":"border-sp-pale-green/20 bg-sp-very-dark-blue hover:border-sp-pale-green/50 hover:shadow-md"} ${G?"ring-2 ring-sp-pale-green ring-offset-2 ring-offset-sp-dark-blue":""}`,onClick:V=>O(M,q,V),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-shrink-0",children:m.jsx("input",{type:"checkbox",checked:J,onChange:()=>{},className:"w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"font-mono text-sp-pale-green text-sm font-medium truncate",title:M,children:M}),G&&m.jsx("span",{className:"text-xs bg-sp-pale-green text-sp-very-dark-blue px-2 py-1 rounded-full font-medium",children:"Current"})]}),X?m.jsxs("div",{className:"text-xs text-sp-white/70 space-y-0.5",children:[m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[X.num_samples," samples"]}),m.jsxs("span",{children:[X.num_nodes," nodes"]})]}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[X.num_edges," edges"]}),m.jsxs("span",{children:[X.num_trees," trees"]})]})]}):m.jsx("div",{className:"text-xs text-sp-white/50",children:"Loading info..."})]})]}),m.jsx("button",{onClick:V=>j(M,V),className:"ml-3 text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-400/10 transition-all duration-200",title:"Delete tree sequence",children:m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},M)})}),m.jsx("div",{className:"mt-3 text-xs text-sp-white/60 text-center",children:"Click to select for loading  Ctrl+click to multi-select  Shift+click to select range"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{onClick:k,disabled:!u||!i[u],className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Load Selected"]}),m.jsxs("button",{onClick:E,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),m.jsxs("button",{onClick:I,disabled:n.length===0,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2",title:"Delete all tree sequences",children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Clear All"]})]}),m.jsx(VM,{isOpen:w.isOpen,title:w.title,message:w.message,type:w.type,confirmText:"Delete",cancelText:"Cancel",onConfirm:w.onConfirm,onCancel:()=>x({...w,isOpen:!1})}),m.jsx(zM,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>R({...S,isOpen:!1})})]})}function zx({isOpen:t,onClose:e,onSelect:n}){const{colors:r}=Vt();return t?m.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[m.jsx("div",{className:"fixed inset-0 transition-opacity",style:{backgroundColor:`${r.background}CC`},onClick:e}),m.jsx("div",{className:"flex items-start justify-center min-h-screen pt-16 px-4",children:m.jsxs("div",{className:"relative rounded-xl shadow-xl max-w-3xl w-full p-6 border",style:{backgroundColor:r.background,borderColor:r.border},children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h2",{className:"text-lg font-medium",style:{color:r.text},children:"Switch Tree Sequence"}),m.jsx("button",{className:"rounded-lg p-2 transition-colors",style:{color:r.text},onClick:e,onMouseEnter:i=>{i.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent"},children:m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.jsx(qM,{onSelect:n})]})})]}):null}const DL=[{id:"sparg",name:"sparg",description:"Spatial inference using Brownian motion on the full ancestral recombination graph. Modified to include node ID tracking. Best for small ARGs.",reference:"https://www.biorxiv.org/content/10.1101/2024.04.10.588900v2",github:"https://github.com/osmond-lab/sparg",github2:"",speed:1,enabled:!0},{id:"spacetrees",name:"spacetrees",description:"Spatial inference using genome-wide genealogies. Coming Soon!",reference:"https://elifesciences.org/articles/72177",github:"https://github.com/osmond-lab/spacetrees",github2:"",speed:2,enabled:!1},{id:"gaia_quadratic",name:"gaia quadratic",description:"High-accuracy spatial inference using quadratic parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"gaia_linear",name:"gaia linear",description:"High-accuracy spatial inference using linear parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"fastgaia",name:"fastgaia",description:"Fast spatial inference using a greedy algorithm. Best for large ARGs where GAIA is too slow.",reference:"",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/blueraleigh/gaia",speed:4,enabled:!0},{id:"midpoint",name:"Wohns midpoint",description:"Weighted midpoint-based spatial inference. Simple and fast for ARGs of all sizes.",reference:"https://doi.org/10.1126/science.abi8264",github:"https://github.com/awohns/unified_genealogy_paper/",github2:"",speed:5,enabled:!0}];function jL({selectedMethod:t,onMethodSelect:e,disabled:n,isInferring:r,data:i}){const[s,o]=F.useState(!1),[l,u]=F.useState(null),d=DL.map(_=>({..._,isReInference:(i==null?void 0:i.spatial_status)==="all"})),h=d.find(_=>_.enabled),g=d.find(_=>_.id===t)||h||d[0];return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 w-full ${n&&"opacity-50 cursor-not-allowed hover:transform-none"} ${r&&"opacity-75 cursor-not-allowed hover:transform-none"}`,onClick:()=>!n&&!r&&o(!s),disabled:n||r,children:[r&&m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),m.jsx("span",{children:r?"Inferring...":`${g.isReInference?"Re-infer":"Infer"} locations (${g.name})`}),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&m.jsx("div",{className:"absolute z-50 w-full mt-2 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsx("div",{className:"py-2",children:d.map(_=>m.jsxs("div",{className:"relative group",onMouseEnter:()=>u(_),onMouseLeave:y=>{const T=document.querySelector(`[data-tooltip-id="${_.id}"]`);T&&!T.contains(y.relatedTarget)&&u(null)},children:[m.jsx("button",{className:`w-full px-4 py-2 text-left transition-colors duration-200 ${_.enabled?t===_.id?"bg-sp-pale-green/10 hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"text-sp-white/50 cursor-not-allowed"}`,onClick:()=>{_.enabled&&(e(_),o(!1))},disabled:r||!_.enabled,children:m.jsxs("div",{className:"font-medium flex items-center justify-between",children:[m.jsx("span",{children:_.name}),!_.enabled&&m.jsx("span",{className:"text-xs text-sp-pale-green/50",children:"Coming Soon"})]})}),(l==null?void 0:l.id)===_.id&&m.jsxs("div",{"data-tooltip-id":_.id,className:"fixed z-50 w-72 p-4 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",style:{left:"var(--tooltip-x, 0)",top:"var(--tooltip-y, 0)"},ref:y=>{var T;if(y){const w=(T=y.parentElement)==null?void 0:T.getBoundingClientRect();if(w){const x=window.innerHeight-w.bottom,S=w.top,R=y.offsetHeight,E=w.left-y.offsetWidth-8;let A;x>=R?A=w.top:S>=R?A=w.bottom-R:A=Math.max(8,Math.min(window.innerHeight-R-8,w.top-(R-w.height)/2)),y.style.setProperty("--tooltip-x",`${E}px`),y.style.setProperty("--tooltip-y",`${A}px`)}}},onMouseEnter:()=>u(_),onMouseLeave:()=>u(null),children:[m.jsx("h4",{className:"font-bold text-sp-pale-green mb-2",children:l.name}),m.jsx("p",{className:"text-sm text-sp-white/80 mb-2",children:l.description}),m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx("span",{className:"text-xs text-sp-white/80",children:"Speed:"}),m.jsx("div",{className:"flex items-center gap-[2px]",children:[...Array(5)].map((y,T)=>m.jsx("div",{className:`w-3 h-5 rounded-sm transition-all ${T<l.speed?T===0?"bg-yellow-400":T===1?"bg-yellow-500":T===2?"bg-lime-500":T===3?"bg-green-400":"bg-green-500":"bg-gray-700"}`},T))})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[l.reference&&m.jsx("a",{href:l.reference,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View reference"}),l.id==="gaia_quadratic"||l.id==="gaia_linear"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaiapy on GitHub"})]}):l.id==="fastgaia"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View fastgaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"})]}):l.github&&m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View on GitHub"})]})]})]},_.id))})}),m.jsxs("div",{className:"absolute -right-8 top-1/2 transform -translate-y-1/2 group",children:[m.jsx("div",{className:"p-1 cursor-help",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("div",{className:"hidden group-hover:block absolute right-full mr-2 w-64 p-3 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg shadow-xl",children:m.jsx("p",{className:"text-xs text-sp-white/80",children:"Choose from different methods to infer ancestral locations in your ARG. Each method has its own strengths and is optimized for different scenarios."})})]})]})}function BL(){const t=uc(),e=cc(),{treeSequence:n,maxSamples:r,setMaxSamples:i,setTreeSequence:s}=Fs(),[o,l]=F.useState(null),[u,d]=F.useState(!1),[h,g]=F.useState(!1),[_,y]=F.useState(!1),[T,w]=F.useState(!1),[x,S]=F.useState(!1),[R,E]=F.useState(!1),[A,k]=F.useState(r.toString()),[O,j]=F.useState("gaia_quadratic"),[N,I]=F.useState({isOpen:!1,title:"",message:"",type:"info"});F.useEffect(()=>{n!=null&&n.num_samples&&l(n.num_samples)},[n]),F.useEffect(()=>{k(r.toString())},[r]);const M=!(n!=null&&n.has_temporal),q=(n==null?void 0:n.spatial_status)==="sample_only"||(n==null?void 0:n.spatial_status)==="all",X=!!(n!=null&&n.has_temporal&&(n!=null&&n.has_all_spatial)),G=async()=>{if(!(!(n!=null&&n.filename)||u)){d(!0);try{Se.user.action("fast-location-inference-start",{filename:n.filename},"ResultPage");const P=await xt.inferLocationsFast({filename:n.filename,weight_span:!0,weight_branch_length:!0});Se.info("Fast location inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:P.data}});const H=P.data,ie={...n,filename:H.new_filename,has_sample_spatial:H.has_sample_spatial,has_all_spatial:H.has_all_spatial,spatial_status:H.spatial_status};s(ie),I({isOpen:!0,title:"Success!",message:`Fast location inference completed successfully!
Inferred locations for ${H.num_inferred_locations} nodes.
New file: ${H.new_filename}`,type:"success"})}catch(P){Se.error("Fast location inference failed",{component:"ResultPage",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.filename}}),I({isOpen:!0,title:"Error",message:`Fast location inference failed: ${P instanceof Error?P.message:"Unknown error"}`,type:"error"})}finally{d(!1)}}},L=async()=>{if(!(!(n!=null&&n.filename)||h)){g(!0);try{Se.user.action("gaia-quadratic-inference-start",{filename:n.filename},"ResultPage");const P=await xt.inferLocationsGaiaQuadratic({filename:n.filename});Se.info("GAIA quadratic inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:P.data}});const H=P.data,ie={...n,filename:H.new_filename,has_sample_spatial:H.has_sample_spatial,has_all_spatial:H.has_all_spatial,spatial_status:H.spatial_status};s(ie),I({isOpen:!0,title:"Success!",message:`GAIA quadratic inference completed successfully!
Inferred locations for ${H.num_inferred_locations} nodes.
New file: ${H.new_filename}`,type:"success"})}catch(P){Se.error("GAIA quadratic inference failed",{component:"ResultPage",error:P instanceof Error?P:new Error(String(P)),data:{filename:n.filename}}),I({isOpen:!0,title:"Error",message:`GAIA quadratic inference failed: ${P instanceof Error?P.message:"Unknown error"}`,type:"error"})}finally{g(!1)}}},J=P=>{Se.user.action("switch-tree-sequence",{treeSequence:P},"ResultPage"),s(P),E(!1)},V=()=>{var H;const P=(H=e.state)==null?void 0:H.fromIntermediate;P?P==="load"?(Se.nav("result","landing"),t("/",{state:{fromInternal:!0}})):(Se.nav("result","intermediate"),t("/",{state:{fromResult:!0,selectedOption:P}})):(Se.nav("result","landing"),t("/",{state:{fromInternal:!0}}))},$=()=>{var H;const P=(H=e.state)==null?void 0:H.fromIntermediate;if(P)switch(P){case"upload":return"Back to Upload";case"simulate":return"Back to Simulate";case"load":return"Back to options";default:return"Back"}return"Back"},Y=async P=>{if(n!=null&&n.filename)switch(P.id){case"fastgaia":await G();break;case"gaia_quadratic":await L();break;case"gaia_linear":if(_)return;y(!0);try{Se.user.action("gaia-linear-inference-start",{filename:n.filename},"ResultPage");const H=await xt.inferLocationsGaiaLinear({filename:n.filename});Se.info("GAIA linear inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:H.data}});const ie=H.data,re={...n,filename:ie.new_filename,has_sample_spatial:ie.has_sample_spatial,has_all_spatial:ie.has_all_spatial,spatial_status:ie.spatial_status};s(re),I({isOpen:!0,title:"Success!",message:`GAIA linear inference completed successfully!
Inferred locations for ${ie.num_inferred_locations} nodes.
New file: ${ie.new_filename}`,type:"success"})}catch(H){Se.error("GAIA linear inference failed",{component:"ResultPage",error:H instanceof Error?H:new Error(String(H)),data:{filename:n.filename}}),I({isOpen:!0,title:"Error",message:`GAIA linear inference failed: ${H instanceof Error?H.message:"Unknown error"}`,type:"error"})}finally{y(!1)}break;case"sparg":if(x)return;S(!0);try{Se.user.action("sparg-inference-start",{filename:n.filename},"ResultPage");const H=await xt.inferLocationsSparg({filename:n.filename});Se.info("sparg inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:H.data}});const ie=H.data,re={...n,filename:ie.new_filename,has_sample_spatial:ie.has_sample_spatial,has_all_spatial:ie.has_all_spatial,spatial_status:ie.spatial_status};s(re),I({isOpen:!0,title:"Success!",message:`sparg inference completed successfully!
Inferred locations for ${ie.num_inferred_locations} nodes.
New file: ${ie.new_filename}`,type:"success"})}catch(H){Se.error("sparg inference failed",{component:"ResultPage",error:H instanceof Error?H:new Error(String(H)),data:{filename:n.filename}}),I({isOpen:!0,title:"Error",message:`sparg inference failed: ${H instanceof Error?H.message:"Unknown error"}`,type:"error"})}finally{S(!1)}break;case"midpoint":if(T)return;w(!0);try{Se.user.action("midpoint-inference-start",{filename:n.filename},"ResultPage");const H=await xt.inferLocationsMidpoint({filename:n.filename});Se.info("Midpoint inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:H.data}});const ie=H.data,re={...n,filename:ie.new_filename,has_sample_spatial:ie.has_sample_spatial,has_all_spatial:ie.has_all_spatial,spatial_status:ie.spatial_status};s(re),I({isOpen:!0,title:"Success!",message:`Midpoint inference completed successfully!
Inferred locations for ${ie.num_inferred_locations} nodes.
New file: ${ie.new_filename}`,type:"success"})}catch(H){Se.error("Midpoint inference failed",{component:"ResultPage",error:H instanceof Error?H:new Error(String(H)),data:{filename:n.filename}}),I({isOpen:!0,title:"Error",message:`Midpoint inference failed: ${H instanceof Error?H.message:"Unknown error"}`,type:"error"})}finally{w(!1)}break;default:I({isOpen:!0,title:"Not Implemented",message:`The ${P.name} inference method is not yet implemented.`,type:"info"})}},ue=u||h||_||T||x;return n?m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",onClick:V,children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),$()]}),m.jsx(fc,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Tree Sequence Analysis"}),m.jsx("p",{className:"text-sp-white/70 text-lg font-mono break-all",children:n.filename})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-wrap gap-3",children:[m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_temporal?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_temporal?"text-sp-white":"text-red-400"}`,children:n.has_temporal?"":""}),"Temporal"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_sample_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_sample_spatial?"text-sp-white":"text-red-400"}`,children:n.has_sample_spatial?"":""}),"Sample Coords"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_all_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_all_spatial?"text-sp-white":"text-red-400"}`,children:n.has_all_spatial?"":""}),"All Coords"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>E(!R),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),R?"Cancel":"Switch Tree Sequence"]}),m.jsx(Fx,{filename:n.filename,onError:P=>{I({isOpen:!0,title:"Download Failed",message:`Failed to download tree sequence: ${P.message}`,type:"error"})}})]})]}),m.jsx(zx,{isOpen:R,onClose:()=>E(!1),onSelect:J}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_samples}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Samples"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_nodes}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Nodes"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_edges}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Edges"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_trees}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Local Trees"})]})]}),(n.num_mutations!==void 0||n.num_sites!==void 0||n.num_recombination_nodes!==void 0)&&m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3",children:[m.jsx("h4",{className:"text-sm font-medium text-sp-white mb-2",children:"Additional Statistics"}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.num_mutations!==void 0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[n.num_mutations," mutations"]}),n.num_sites!==void 0&&n.num_sites>0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[n.num_sites," sites"]}),n.num_recombination_nodes!==void 0&&n.num_recombination_nodes>0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[n.num_recombination_nodes," recombination nodes"]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 ${!M&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!M,onClick:()=>Se.user.action("infer-times-clicked",{filename:n.filename},"ResultPage"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Infer ages (tsdate)"]}),m.jsx(jL,{selectedMethod:O,onMethodSelect:P=>{j(P.id),Y(P)},disabled:!q,isInferring:ue,data:n})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Visualization Sample Count"})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("input",{type:"range",id:"sample-slider",min:"2",max:o||Yi.DEFAULT_MAX_SAMPLES,value:Math.max(r,2),onChange:P=>i(parseInt(P.target.value)),className:"flex-1 h-2 bg-sp-dark-blue rounded-lg appearance-none cursor-pointer accent-sp-pale-green"}),m.jsxs("div",{className:"flex items-center gap-2 min-w-[8rem]",children:[m.jsx("input",{type:"number",value:A,onChange:P=>{const H=P.target.value;if(k(H),H!==""){const ie=parseInt(H);isNaN(ie)||i(ie)}},onBlur:P=>{const H=parseInt(P.target.value);let ie=2;isNaN(H)||(ie=Math.max(2,Math.min(H,o||Yi.DEFAULT_MAX_SAMPLES))),i(ie),k(ie.toString())},min:"2",max:o||Yi.DEFAULT_MAX_SAMPLES,className:"w-20 bg-sp-dark-blue border border-sp-pale-green/20 rounded px-2 py-1 text-sm text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green"}),m.jsxs("span",{className:"text-sm font-mono text-sp-white/70",children:["/ ",o||"?"]})]})]}),m.jsxs("div",{className:"mt-2",children:[m.jsx("p",{className:"text-xs text-sp-white/60",children:"Adjust before visualizing to control the number of samples shown (minimum: 2)"}),o&&o>Yi.WARNING_THRESHOLD&&m.jsx("p",{className:"text-xs text-sp-white/60 mt-1",children:"Note: Large sample numbers may affect visualization performance"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[m.jsxs("button",{className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 false",disabled:!1,onClick:()=>t(`/visualize/${encodeURIComponent(n.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Visualize ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"Interactive D3"})]})]}),m.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!X&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!X,onClick:()=>t(`/visualize-spatial/${encodeURIComponent(n.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Spatial ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"3D coordinates"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Pretty ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Pretty ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Huge ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Huge ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]})]})]})})}),m.jsx(zM,{isOpen:N.isOpen,title:N.title,message:N.message,type:N.type,onClose:()=>I({...N,isOpen:!1})})]}):m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-sp-very-dark-blue text-sp-white",children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No data loaded"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4",onClick:V,children:"Back to Home"})]})}var LL={value:()=>{}};function dc(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new lf(n)}function lf(t){this._=t}function UL(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}lf.prototype=dc.prototype={constructor:lf,on:function(t,e){var n=this._,r=UL(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=FL(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=sS(n[i],t.name,e);else if(e==null)for(i in n)n[i]=sS(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new lf(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function FL(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function sS(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=LL,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var I0="http://www.w3.org/1999/xhtml";const aS={svg:"http://www.w3.org/2000/svg",xhtml:I0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ed(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),aS.hasOwnProperty(e)?{space:aS[e],local:t}:t}function zL(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===I0&&e.documentElement.namespaceURI===I0?e.createElement(t):e.createElementNS(n,t)}}function VL(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function $M(t){var e=Ed(t);return(e.local?VL:zL)(e)}function qL(){}function Vx(t){return t==null?qL:function(){return this.querySelector(t)}}function $L(t){typeof t!="function"&&(t=Vx(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=new Array(o),u,d,h=0;h<o;++h)(u=s[h])&&(d=t.call(u,u.__data__,h,s))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new Xn(r,this._parents)}function HL(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function WL(){return[]}function HM(t){return t==null?WL:function(){return this.querySelectorAll(t)}}function XL(t){return function(){return HL(t.apply(this,arguments))}}function YL(t){typeof t=="function"?t=XL(t):t=HM(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(t.call(u,u.__data__,d,o)),i.push(u));return new Xn(r,i)}function WM(t){return function(){return this.matches(t)}}function XM(t){return function(e){return e.matches(t)}}var GL=Array.prototype.find;function KL(t){return function(){return GL.call(this.children,t)}}function ZL(){return this.firstElementChild}function QL(t){return this.select(t==null?ZL:KL(typeof t=="function"?t:XM(t)))}var JL=Array.prototype.filter;function eU(){return Array.from(this.children)}function tU(t){return function(){return JL.call(this.children,t)}}function nU(t){return this.selectAll(t==null?eU:tU(typeof t=="function"?t:XM(t)))}function rU(t){typeof t!="function"&&(t=WM(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new Xn(r,this._parents)}function YM(t){return new Array(t.length)}function iU(){return new Xn(this._enter||this._groups.map(YM),this._parents)}function xf(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}xf.prototype={constructor:xf,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function sU(t){return function(){return t}}function aU(t,e,n,r,i,s){for(var o=0,l,u=e.length,d=s.length;o<d;++o)(l=e[o])?(l.__data__=s[o],r[o]=l):n[o]=new xf(t,s[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function oU(t,e,n,r,i,s,o){var l,u,d=new Map,h=e.length,g=s.length,_=new Array(h),y;for(l=0;l<h;++l)(u=e[l])&&(_[l]=y=o.call(u,u.__data__,l,e)+"",d.has(y)?i[l]=u:d.set(y,u));for(l=0;l<g;++l)y=o.call(t,s[l],l,s)+"",(u=d.get(y))?(r[l]=u,u.__data__=s[l],d.delete(y)):n[l]=new xf(t,s[l]);for(l=0;l<h;++l)(u=e[l])&&d.get(_[l])===u&&(i[l]=u)}function lU(t){return t.__data__}function cU(t,e){if(!arguments.length)return Array.from(this,lU);var n=e?oU:aU,r=this._parents,i=this._groups;typeof t!="function"&&(t=sU(t));for(var s=i.length,o=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var h=r[d],g=i[d],_=g.length,y=uU(t.call(h,h&&h.__data__,d,r)),T=y.length,w=l[d]=new Array(T),x=o[d]=new Array(T),S=u[d]=new Array(_);n(h,g,w,x,S,y,e);for(var R=0,E=0,A,k;R<T;++R)if(A=w[R]){for(R>=E&&(E=R+1);!(k=x[E])&&++E<T;);A._next=k||null}}return o=new Xn(o,r),o._enter=l,o._exit=u,o}function uU(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fU(){return new Xn(this._exit||this._groups.map(YM),this._parents)}function dU(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function hU(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),l=new Array(i),u=0;u<o;++u)for(var d=n[u],h=r[u],g=d.length,_=l[u]=new Array(g),y,T=0;T<g;++T)(y=d[T]||h[T])&&(_[T]=y);for(;u<i;++u)l[u]=n[u];return new Xn(l,this._parents)}function pU(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function gU(t){t||(t=mU);function e(g,_){return g&&_?t(g.__data__,_.__data__):!g-!_}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],l=o.length,u=i[s]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(e)}return new Xn(i,this._parents).order()}function mU(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function _U(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function vU(){return Array.from(this)}function yU(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function bU(){let t=0;for(const e of this)++t;return t}function xU(){return!this.node()}function wU(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,l;s<o;++s)(l=i[s])&&t.call(l,l.__data__,s,i);return this}function TU(t){return function(){this.removeAttribute(t)}}function SU(t){return function(){this.removeAttributeNS(t.space,t.local)}}function EU(t,e){return function(){this.setAttribute(t,e)}}function AU(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function RU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function CU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function NU(t,e){var n=Ed(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?SU:TU:typeof e=="function"?n.local?CU:RU:n.local?AU:EU)(n,e))}function GM(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function kU(t){return function(){this.style.removeProperty(t)}}function MU(t,e,n){return function(){this.style.setProperty(t,e,n)}}function IU(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function OU(t,e,n){return arguments.length>1?this.each((e==null?kU:typeof e=="function"?IU:MU)(t,e,n??"")):Ja(this.node(),t)}function Ja(t,e){return t.style.getPropertyValue(e)||GM(t).getComputedStyle(t,null).getPropertyValue(e)}function PU(t){return function(){delete this[t]}}function DU(t,e){return function(){this[t]=e}}function jU(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function BU(t,e){return arguments.length>1?this.each((e==null?PU:typeof e=="function"?jU:DU)(t,e)):this.node()[t]}function KM(t){return t.trim().split(/^|\s+/)}function qx(t){return t.classList||new ZM(t)}function ZM(t){this._node=t,this._names=KM(t.getAttribute("class")||"")}ZM.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function QM(t,e){for(var n=qx(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function JM(t,e){for(var n=qx(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function LU(t){return function(){QM(this,t)}}function UU(t){return function(){JM(this,t)}}function FU(t,e){return function(){(e.apply(this,arguments)?QM:JM)(this,t)}}function zU(t,e){var n=KM(t+"");if(arguments.length<2){for(var r=qx(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?FU:e?LU:UU)(n,e))}function VU(){this.textContent=""}function qU(t){return function(){this.textContent=t}}function $U(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function HU(t){return arguments.length?this.each(t==null?VU:(typeof t=="function"?$U:qU)(t)):this.node().textContent}function WU(){this.innerHTML=""}function XU(t){return function(){this.innerHTML=t}}function YU(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function GU(t){return arguments.length?this.each(t==null?WU:(typeof t=="function"?YU:XU)(t)):this.node().innerHTML}function KU(){this.nextSibling&&this.parentNode.appendChild(this)}function ZU(){return this.each(KU)}function QU(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function JU(){return this.each(QU)}function e8(t){var e=typeof t=="function"?t:$M(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function t8(){return null}function n8(t,e){var n=typeof t=="function"?t:$M(t),r=e==null?t8:typeof e=="function"?e:Vx(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function r8(){var t=this.parentNode;t&&t.removeChild(this)}function i8(){return this.each(r8)}function s8(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function a8(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function o8(t){return this.select(t?a8:s8)}function l8(t){return arguments.length?this.property("__data__",t):this.node().__data__}function c8(t){return function(e){t.call(this,e,this.__data__)}}function u8(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function f8(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function d8(t,e,n){return function(){var r=this.__on,i,s=c8(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function h8(t,e,n){var r=u8(t+""),i,s=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(i=0,h=l[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(l=e?d8:f8,i=0;i<s;++i)this.each(l(r[i],e,n));return this}function eI(t,e,n){var r=GM(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function p8(t,e){return function(){return eI(this,t,e)}}function g8(t,e){return function(){return eI(this,t,e.apply(this,arguments))}}function m8(t,e){return this.each((typeof e=="function"?g8:p8)(t,e))}function*_8(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var tI=[null];function Xn(t,e){this._groups=t,this._parents=e}function hc(){return new Xn([[document.documentElement]],tI)}function v8(){return this}Xn.prototype=hc.prototype={constructor:Xn,select:$L,selectAll:YL,selectChild:QL,selectChildren:nU,filter:rU,data:cU,enter:iU,exit:fU,join:dU,merge:hU,selection:v8,order:pU,sort:gU,call:_U,nodes:vU,node:yU,size:bU,empty:xU,each:wU,attr:NU,style:OU,property:BU,classed:zU,text:HU,html:GU,raise:ZU,lower:JU,append:e8,insert:n8,remove:i8,clone:o8,datum:l8,on:h8,dispatch:m8,[Symbol.iterator]:_8};function rr(t){return typeof t=="string"?new Xn([[document.querySelector(t)]],[document.documentElement]):new Xn([[t]],tI)}function y8(t){let e;for(;e=t.sourceEvent;)t=e;return t}function ai(t,e){if(t=y8(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const b8={passive:!1},Jl={capture:!0,passive:!1};function wg(t){t.stopImmediatePropagation()}function Ga(t){t.preventDefault(),t.stopImmediatePropagation()}function nI(t){var e=t.document.documentElement,n=rr(t).on("dragstart.drag",Ga,Jl);"onselectstart"in e?n.on("selectstart.drag",Ga,Jl):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function rI(t,e){var n=t.document.documentElement,r=rr(t).on("dragstart.drag",null);e&&(r.on("click.drag",Ga,Jl),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Uu=t=>()=>t;function O0(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}O0.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function x8(t){return!t.ctrlKey&&!t.button}function w8(){return this.parentNode}function T8(t,e){return e??{x:t.x,y:t.y}}function S8(){return navigator.maxTouchPoints||"ontouchstart"in this}function E8(){var t=x8,e=w8,n=T8,r=S8,i={},s=dc("start","drag","end"),o=0,l,u,d,h,g=0;function _(A){A.on("mousedown.drag",y).filter(r).on("touchstart.drag",x).on("touchmove.drag",S,b8).on("touchend.drag touchcancel.drag",R).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(A,k){if(!(h||!t.call(this,A,k))){var O=E(this,e.call(this,A,k),A,k,"mouse");O&&(rr(A.view).on("mousemove.drag",T,Jl).on("mouseup.drag",w,Jl),nI(A.view),wg(A),d=!1,l=A.clientX,u=A.clientY,O("start",A))}}function T(A){if(Ga(A),!d){var k=A.clientX-l,O=A.clientY-u;d=k*k+O*O>g}i.mouse("drag",A)}function w(A){rr(A.view).on("mousemove.drag mouseup.drag",null),rI(A.view,d),Ga(A),i.mouse("end",A)}function x(A,k){if(t.call(this,A,k)){var O=A.changedTouches,j=e.call(this,A,k),N=O.length,I,M;for(I=0;I<N;++I)(M=E(this,j,A,k,O[I].identifier,O[I]))&&(wg(A),M("start",A,O[I]))}}function S(A){var k=A.changedTouches,O=k.length,j,N;for(j=0;j<O;++j)(N=i[k[j].identifier])&&(Ga(A),N("drag",A,k[j]))}function R(A){var k=A.changedTouches,O=k.length,j,N;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),j=0;j<O;++j)(N=i[k[j].identifier])&&(wg(A),N("end",A,k[j]))}function E(A,k,O,j,N,I){var M=s.copy(),q=ai(I||O,k),X,G,L;if((L=n.call(A,new O0("beforestart",{sourceEvent:O,target:_,identifier:N,active:o,x:q[0],y:q[1],dx:0,dy:0,dispatch:M}),j))!=null)return X=L.x-q[0]||0,G=L.y-q[1]||0,function J(V,$,Y){var ue=q,P;switch(V){case"start":i[N]=J,P=o++;break;case"end":delete i[N],--o;case"drag":q=ai(Y||$,k),P=o;break}M.call(V,A,new O0(V,{sourceEvent:$,subject:L,target:_,identifier:N,active:P,x:q[0]+X,y:q[1]+G,dx:q[0]-ue[0],dy:q[1]-ue[1],dispatch:M}),j)}}return _.filter=function(A){return arguments.length?(t=typeof A=="function"?A:Uu(!!A),_):t},_.container=function(A){return arguments.length?(e=typeof A=="function"?A:Uu(A),_):e},_.subject=function(A){return arguments.length?(n=typeof A=="function"?A:Uu(A),_):n},_.touchable=function(A){return arguments.length?(r=typeof A=="function"?A:Uu(!!A),_):r},_.on=function(){var A=s.on.apply(s,arguments);return A===s?_:A},_.clickDistance=function(A){return arguments.length?(g=(A=+A)*A,_):Math.sqrt(g)},_}function $x(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function iI(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function pc(){}var ec=.7,wf=1/ec,Ka="\\s*([+-]?\\d+)\\s*",tc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ur="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",A8=/^#([0-9a-f]{3,8})$/,R8=new RegExp(`^rgb\\(${Ka},${Ka},${Ka}\\)$`),C8=new RegExp(`^rgb\\(${Ur},${Ur},${Ur}\\)$`),N8=new RegExp(`^rgba\\(${Ka},${Ka},${Ka},${tc}\\)$`),k8=new RegExp(`^rgba\\(${Ur},${Ur},${Ur},${tc}\\)$`),M8=new RegExp(`^hsl\\(${tc},${Ur},${Ur}\\)$`),I8=new RegExp(`^hsla\\(${tc},${Ur},${Ur},${tc}\\)$`),oS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$x(pc,nc,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:lS,formatHex:lS,formatHex8:O8,formatHsl:P8,formatRgb:cS,toString:cS});function lS(){return this.rgb().formatHex()}function O8(){return this.rgb().formatHex8()}function P8(){return sI(this).formatHsl()}function cS(){return this.rgb().formatRgb()}function nc(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=A8.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?uS(e):n===3?new Mn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Fu(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Fu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=R8.exec(t))?new Mn(e[1],e[2],e[3],1):(e=C8.exec(t))?new Mn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=N8.exec(t))?Fu(e[1],e[2],e[3],e[4]):(e=k8.exec(t))?Fu(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=M8.exec(t))?hS(e[1],e[2]/100,e[3]/100,1):(e=I8.exec(t))?hS(e[1],e[2]/100,e[3]/100,e[4]):oS.hasOwnProperty(t)?uS(oS[t]):t==="transparent"?new Mn(NaN,NaN,NaN,0):null}function uS(t){return new Mn(t>>16&255,t>>8&255,t&255,1)}function Fu(t,e,n,r){return r<=0&&(t=e=n=NaN),new Mn(t,e,n,r)}function D8(t){return t instanceof pc||(t=nc(t)),t?(t=t.rgb(),new Mn(t.r,t.g,t.b,t.opacity)):new Mn}function P0(t,e,n,r){return arguments.length===1?D8(t):new Mn(t,e,n,r??1)}function Mn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}$x(Mn,P0,iI(pc,{brighter(t){return t=t==null?wf:Math.pow(wf,t),new Mn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ec:Math.pow(ec,t),new Mn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Mn(Rs(this.r),Rs(this.g),Rs(this.b),Tf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fS,formatHex:fS,formatHex8:j8,formatRgb:dS,toString:dS}));function fS(){return`#${Ss(this.r)}${Ss(this.g)}${Ss(this.b)}`}function j8(){return`#${Ss(this.r)}${Ss(this.g)}${Ss(this.b)}${Ss((isNaN(this.opacity)?1:this.opacity)*255)}`}function dS(){const t=Tf(this.opacity);return`${t===1?"rgb(":"rgba("}${Rs(this.r)}, ${Rs(this.g)}, ${Rs(this.b)}${t===1?")":`, ${t})`}`}function Tf(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Rs(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ss(t){return t=Rs(t),(t<16?"0":"")+t.toString(16)}function hS(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new yr(t,e,n,r)}function sI(t){if(t instanceof yr)return new yr(t.h,t.s,t.l,t.opacity);if(t instanceof pc||(t=nc(t)),!t)return new yr;if(t instanceof yr)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,l=s-i,u=(s+i)/2;return l?(e===s?o=(n-r)/l+(n<r)*6:n===s?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?s+i:2-s-i,o*=60):l=u>0&&u<1?0:o,new yr(o,l,u,t.opacity)}function B8(t,e,n,r){return arguments.length===1?sI(t):new yr(t,e,n,r??1)}function yr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}$x(yr,B8,iI(pc,{brighter(t){return t=t==null?wf:Math.pow(wf,t),new yr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ec:Math.pow(ec,t),new yr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Mn(Tg(t>=240?t-240:t+120,i,r),Tg(t,i,r),Tg(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new yr(pS(this.h),zu(this.s),zu(this.l),Tf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Tf(this.opacity);return`${t===1?"hsl(":"hsla("}${pS(this.h)}, ${zu(this.s)*100}%, ${zu(this.l)*100}%${t===1?")":`, ${t})`}`}}));function pS(t){return t=(t||0)%360,t<0?t+360:t}function zu(t){return Math.max(0,Math.min(1,t||0))}function Tg(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const aI=t=>()=>t;function L8(t,e){return function(n){return t+n*e}}function U8(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function F8(t){return(t=+t)==1?oI:function(e,n){return n-e?U8(e,n,t):aI(isNaN(e)?n:e)}}function oI(t,e){var n=e-t;return n?L8(t,n):aI(isNaN(t)?e:t)}const gS=function t(e){var n=F8(e);function r(i,s){var o=n((i=P0(i)).r,(s=P0(s)).r),l=n(i.g,s.g),u=n(i.b,s.b),d=oI(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=l(h),i.b=u(h),i.opacity=d(h),i+""}}return r.gamma=t,r}(1);function Vi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var D0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Sg=new RegExp(D0.source,"g");function z8(t){return function(){return t}}function V8(t){return function(e){return t(e)+""}}function q8(t,e){var n=D0.lastIndex=Sg.lastIndex=0,r,i,s,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=D0.exec(t))&&(i=Sg.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:Vi(r,i)})),n=Sg.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?u[0]?V8(u[0].x):z8(e):(e=u.length,function(d){for(var h=0,g;h<e;++h)l[(g=u[h]).i]=g.x(d);return l.join("")})}var mS=180/Math.PI,j0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function lI(t,e,n,r,i,s){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*mS,skewX:Math.atan(u)*mS,scaleX:o,scaleY:l}}var Vu;function $8(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?j0:lI(e.a,e.b,e.c,e.d,e.e,e.f)}function H8(t){return t==null||(Vu||(Vu=document.createElementNS("http://www.w3.org/2000/svg","g")),Vu.setAttribute("transform",t),!(t=Vu.transform.baseVal.consolidate()))?j0:(t=t.matrix,lI(t.a,t.b,t.c,t.d,t.e,t.f))}function cI(t,e,n,r){function i(d){return d.length?d.pop()+" ":""}function s(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push("translate(",null,e,null,n);T.push({i:w-4,x:Vi(d,g)},{i:w-2,x:Vi(h,_)})}else(g||_)&&y.push("translate("+g+e+_+n)}function o(d,h,g,_){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),_.push({i:g.push(i(g)+"rotate(",null,r)-2,x:Vi(d,h)})):h&&g.push(i(g)+"rotate("+h+r)}function l(d,h,g,_){d!==h?_.push({i:g.push(i(g)+"skewX(",null,r)-2,x:Vi(d,h)}):h&&g.push(i(g)+"skewX("+h+r)}function u(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push(i(y)+"scale(",null,",",null,")");T.push({i:w-4,x:Vi(d,g)},{i:w-2,x:Vi(h,_)})}else(g!==1||_!==1)&&y.push(i(y)+"scale("+g+","+_+")")}return function(d,h){var g=[],_=[];return d=t(d),h=t(h),s(d.translateX,d.translateY,h.translateX,h.translateY,g,_),o(d.rotate,h.rotate,g,_),l(d.skewX,h.skewX,g,_),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,g,_),d=h=null,function(y){for(var T=-1,w=_.length,x;++T<w;)g[(x=_[T]).i]=x.x(y);return g.join("")}}}var W8=cI($8,"px, ","px)","deg)"),X8=cI(H8,", ",")",")"),Y8=1e-12;function _S(t){return((t=Math.exp(t))+1/t)/2}function G8(t){return((t=Math.exp(t))-1/t)/2}function K8(t){return((t=Math.exp(2*t))-1)/(t+1)}const Z8=function t(e,n,r){function i(s,o){var l=s[0],u=s[1],d=s[2],h=o[0],g=o[1],_=o[2],y=h-l,T=g-u,w=y*y+T*T,x,S;if(w<Y8)S=Math.log(_/d)/e,x=function(j){return[l+j*y,u+j*T,d*Math.exp(e*j*S)]};else{var R=Math.sqrt(w),E=(_*_-d*d+r*w)/(2*d*n*R),A=(_*_-d*d-r*w)/(2*_*n*R),k=Math.log(Math.sqrt(E*E+1)-E),O=Math.log(Math.sqrt(A*A+1)-A);S=(O-k)/e,x=function(j){var N=j*S,I=_S(k),M=d/(n*R)*(I*K8(e*N+k)-G8(k));return[l+M*y,u+M*T,d*I/_S(e*N+k)]}}return x.duration=S*1e3*e/Math.SQRT2,x}return i.rho=function(s){var o=Math.max(.001,+s),l=o*o,u=l*l;return t(o,l,u)},i}(Math.SQRT2,2,4);var eo=0,Cl=0,xl=0,uI=1e3,Sf,Nl,Ef=0,Os=0,Ad=0,rc=typeof performance=="object"&&performance.now?performance:Date,fI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Hx(){return Os||(fI(Q8),Os=rc.now()+Ad)}function Q8(){Os=0}function Af(){this._call=this._time=this._next=null}Af.prototype=Wx.prototype={constructor:Af,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Hx():+n)+(e==null?0:+e),!this._next&&Nl!==this&&(Nl?Nl._next=this:Sf=this,Nl=this),this._call=t,this._time=n,B0()},stop:function(){this._call&&(this._call=null,this._time=1/0,B0())}};function Wx(t,e,n){var r=new Af;return r.restart(t,e,n),r}function J8(){Hx(),++eo;for(var t=Sf,e;t;)(e=Os-t._time)>=0&&t._call.call(void 0,e),t=t._next;--eo}function vS(){Os=(Ef=rc.now())+Ad,eo=Cl=0;try{J8()}finally{eo=0,tF(),Os=0}}function eF(){var t=rc.now(),e=t-Ef;e>uI&&(Ad-=e,Ef=t)}function tF(){for(var t,e=Sf,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Sf=n);Nl=t,B0(r)}function B0(t){if(!eo){Cl&&(Cl=clearTimeout(Cl));var e=t-Os;e>24?(t<1/0&&(Cl=setTimeout(vS,t-rc.now()-Ad)),xl&&(xl=clearInterval(xl))):(xl||(Ef=rc.now(),xl=setInterval(eF,uI)),eo=1,fI(vS))}}function yS(t,e,n){var r=new Af;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var nF=dc("start","end","cancel","interrupt"),rF=[],dI=0,bS=1,L0=2,cf=3,xS=4,U0=5,uf=6;function Rd(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;iF(t,n,{name:e,index:r,group:i,on:nF,tween:rF,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:dI})}function Xx(t,e){var n=Sr(t,e);if(n.state>dI)throw new Error("too late; already scheduled");return n}function zr(t,e){var n=Sr(t,e);if(n.state>cf)throw new Error("too late; already running");return n}function Sr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function iF(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Wx(s,0,n.time);function s(d){n.state=bS,n.timer.restart(o,n.delay,n.time),n.delay<=d&&o(d-n.delay)}function o(d){var h,g,_,y;if(n.state!==bS)return u();for(h in r)if(y=r[h],y.name===n.name){if(y.state===cf)return yS(o);y.state===xS?(y.state=uf,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete r[h]):+h<e&&(y.state=uf,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete r[h])}if(yS(function(){n.state===cf&&(n.state=xS,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=L0,n.on.call("start",t,t.__data__,n.index,n.group),n.state===L0){for(n.state=cf,i=new Array(_=n.tween.length),h=0,g=-1;h<_;++h)(y=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++g]=y);i.length=g+1}}function l(d){for(var h=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=U0,1),g=-1,_=i.length;++g<_;)i[g].call(t,h);n.state===U0&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=uf,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function ff(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>L0&&r.state<U0,r.state=uf,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function sF(t){return this.each(function(){ff(this,t)})}function aF(t,e){var n,r;return function(){var i=zr(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function oF(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=zr(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}s.tween=i}}function lF(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Sr(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?aF:oF)(n,t,e))}function Yx(t,e,n){var r=t._id;return t.each(function(){var i=zr(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return Sr(i,r).value[e]}}function hI(t,e){var n;return(typeof e=="number"?Vi:e instanceof nc?gS:(n=nc(e))?(e=n,gS):q8)(t,e)}function cF(t){return function(){this.removeAttribute(t)}}function uF(t){return function(){this.removeAttributeNS(t.space,t.local)}}function fF(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function dF(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function hF(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function pF(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function gF(t,e){var n=Ed(t),r=n==="transform"?X8:hI;return this.attrTween(t,typeof e=="function"?(n.local?pF:hF)(n,r,Yx(this,"attr."+t,e)):e==null?(n.local?uF:cF)(n):(n.local?dF:fF)(n,r,e))}function mF(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function _F(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function vF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&_F(t,s)),n}return i._value=e,i}function yF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&mF(t,s)),n}return i._value=e,i}function bF(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ed(t);return this.tween(n,(r.local?vF:yF)(r,e))}function xF(t,e){return function(){Xx(this,t).delay=+e.apply(this,arguments)}}function wF(t,e){return e=+e,function(){Xx(this,t).delay=e}}function TF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?xF:wF)(e,t)):Sr(this.node(),e).delay}function SF(t,e){return function(){zr(this,t).duration=+e.apply(this,arguments)}}function EF(t,e){return e=+e,function(){zr(this,t).duration=e}}function AF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?SF:EF)(e,t)):Sr(this.node(),e).duration}function RF(t,e){if(typeof e!="function")throw new Error;return function(){zr(this,t).ease=e}}function CF(t){var e=this._id;return arguments.length?this.each(RF(e,t)):Sr(this.node(),e).ease}function NF(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;zr(this,t).ease=n}}function kF(t){if(typeof t!="function")throw new Error;return this.each(NF(this._id,t))}function MF(t){typeof t!="function"&&(t=WM(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new fi(r,this._parents,this._name,this._id)}function IF(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),l=0;l<s;++l)for(var u=e[l],d=n[l],h=u.length,g=o[l]=new Array(h),_,y=0;y<h;++y)(_=u[y]||d[y])&&(g[y]=_);for(;l<r;++l)o[l]=e[l];return new fi(o,this._parents,this._name,this._id)}function OF(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function PF(t,e,n){var r,i,s=OF(e)?Xx:zr;return function(){var o=s(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function DF(t,e){var n=this._id;return arguments.length<2?Sr(this.node(),n).on.on(t):this.each(PF(n,t,e))}function jF(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function BF(){return this.on("end.remove",jF(this._id))}function LF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Vx(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=s[o]=new Array(u),h,g,_=0;_<u;++_)(h=l[_])&&(g=t.call(h,h.__data__,_,l))&&("__data__"in h&&(g.__data__=h.__data__),d[_]=g,Rd(d[_],e,n,_,d,Sr(h,n)));return new fi(s,this._parents,e,n)}function UF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=HM(t));for(var r=this._groups,i=r.length,s=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,h,g=0;g<d;++g)if(h=u[g]){for(var _=t.call(h,h.__data__,g,u),y,T=Sr(h,n),w=0,x=_.length;w<x;++w)(y=_[w])&&Rd(y,e,n,w,_,T);s.push(_),o.push(h)}return new fi(s,o,e,n)}var FF=hc.prototype.constructor;function zF(){return new FF(this._groups,this._parents)}function VF(t,e){var n,r,i;return function(){var s=Ja(this,t),o=(this.style.removeProperty(t),Ja(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function pI(t){return function(){this.style.removeProperty(t)}}function qF(t,e,n){var r,i=n+"",s;return function(){var o=Ja(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function $F(t,e,n){var r,i,s;return function(){var o=Ja(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),Ja(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l))}}function HF(t,e){var n,r,i,s="style."+e,o="end."+s,l;return function(){var u=zr(this,t),d=u.on,h=u.value[s]==null?l||(l=pI(e)):void 0;(d!==n||i!==h)&&(r=(n=d).copy()).on(o,i=h),u.on=r}}function WF(t,e,n){var r=(t+="")=="transform"?W8:hI;return e==null?this.styleTween(t,VF(t,r)).on("end.style."+t,pI(t)):typeof e=="function"?this.styleTween(t,$F(t,r,Yx(this,"style."+t,e))).each(HF(this._id,t)):this.styleTween(t,qF(t,r,e),n).on("end.style."+t,null)}function XF(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function YF(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&XF(t,o,n)),r}return s._value=e,s}function GF(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,YF(t,e,n??""))}function KF(t){return function(){this.textContent=t}}function ZF(t){return function(){var e=t(this);this.textContent=e??""}}function QF(t){return this.tween("text",typeof t=="function"?ZF(Yx(this,"text",t)):KF(t==null?"":t+""))}function JF(t){return function(e){this.textContent=t.call(this,e)}}function e5(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&JF(i)),e}return r._value=t,r}function t5(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,e5(t))}function n5(){for(var t=this._name,e=this._id,n=gI(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=Sr(u,e);Rd(u,t,n,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new fi(r,this._parents,t,n)}function r5(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var l={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var d=zr(this,r),h=d.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&s()})}var i5=0;function fi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function gI(){return++i5}var si=hc.prototype;fi.prototype={constructor:fi,select:LF,selectAll:UF,selectChild:si.selectChild,selectChildren:si.selectChildren,filter:MF,merge:IF,selection:zF,transition:n5,call:si.call,nodes:si.nodes,node:si.node,size:si.size,empty:si.empty,each:si.each,on:DF,attr:gF,attrTween:bF,style:WF,styleTween:GF,text:QF,textTween:t5,remove:BF,tween:lF,delay:TF,duration:AF,ease:CF,easeVarying:kF,end:r5,[Symbol.iterator]:si[Symbol.iterator]};function s5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var a5={time:null,delay:0,duration:250,ease:s5};function o5(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function l5(t){var e,n;t instanceof fi?(e=t._id,t=t._name):(e=gI(),(n=a5).time=Hx(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&Rd(u,t,e,d,o,n||o5(u,e));return new fi(r,this._parents,t,e)}hc.prototype.interrupt=sF;hc.prototype.transition=l5;function c5(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return mI(this.cover(e,n),e,n,t)}function mI(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},l=t._x0,u=t._y0,d=t._x1,h=t._y1,g,_,y,T,w,x,S,R;if(!s)return t._root=o,t;for(;s.length;)if((w=e>=(g=(l+d)/2))?l=g:d=g,(x=n>=(_=(u+h)/2))?u=_:h=_,i=s,!(s=s[S=x<<1|w]))return i[S]=o,t;if(y=+t._x.call(null,s.data),T=+t._y.call(null,s.data),e===y&&n===T)return o.next=s,i?i[S]=o:t._root=o,t;do i=i?i[S]=new Array(4):t._root=new Array(4),(w=e>=(g=(l+d)/2))?l=g:d=g,(x=n>=(_=(u+h)/2))?u=_:h=_;while((S=x<<1|w)===(R=(T>=_)<<1|y>=g));return i[R]=s,i[S]=o,t}function u5(t){var e,n,r=t.length,i,s,o=new Array(r),l=new Array(r),u=1/0,d=1/0,h=-1/0,g=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,l[n]=s,i<u&&(u=i),i>h&&(h=i),s<d&&(d=s),s>g&&(g=s));if(u>h||d>g)return this;for(this.cover(u,d).cover(h,g),n=0;n<r;++n)mI(this,o[n],l[n],t[n]);return this}function f5(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,l=this._root,u,d;n>t||t>=i||r>e||e>=s;)switch(d=(e<r)<<1|t<n,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function d5(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function h5(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function wn(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function p5(t,e,n){var r,i=this._x0,s=this._y0,o,l,u,d,h=this._x1,g=this._y1,_=[],y=this._root,T,w;for(y&&_.push(new wn(y,i,s,h,g)),n==null?n=1/0:(i=t-n,s=e-n,h=t+n,g=e+n,n*=n);T=_.pop();)if(!(!(y=T.node)||(o=T.x0)>h||(l=T.y0)>g||(u=T.x1)<i||(d=T.y1)<s))if(y.length){var x=(o+u)/2,S=(l+d)/2;_.push(new wn(y[3],x,S,u,d),new wn(y[2],o,S,x,d),new wn(y[1],x,l,u,S),new wn(y[0],o,l,x,S)),(w=(e>=S)<<1|t>=x)&&(T=_[_.length-1],_[_.length-1]=_[_.length-1-w],_[_.length-1-w]=T)}else{var R=t-+this._x.call(null,y.data),E=e-+this._y.call(null,y.data),A=R*R+E*E;if(A<n){var k=Math.sqrt(n=A);i=t-k,s=e-k,h=t+k,g=e+k,r=y.data}}return r}function g5(t){if(isNaN(h=+this._x.call(null,t))||isNaN(g=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,g,_,y,T,w,x,S;if(!n)return this;if(n.length)for(;;){if((T=h>=(_=(o+u)/2))?o=_:u=_,(w=g>=(y=(l+d)/2))?l=y:d=y,e=n,!(n=n[x=w<<1|T]))return this;if(!n.length)break;(e[x+1&3]||e[x+2&3]||e[x+3&3])&&(r=e,S=x)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[x]=s:delete e[x],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[S]=n:this._root=n),this):(this._root=s,this)}function m5(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function _5(){return this._root}function v5(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function y5(t){var e=[],n,r=this._root,i,s,o,l,u;for(r&&e.push(new wn(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,l=n.x1,u=n.y1)&&r.length){var d=(s+l)/2,h=(o+u)/2;(i=r[3])&&e.push(new wn(i,d,h,l,u)),(i=r[2])&&e.push(new wn(i,s,h,d,u)),(i=r[1])&&e.push(new wn(i,d,o,l,h)),(i=r[0])&&e.push(new wn(i,s,o,d,h))}return this}function b5(t){var e=[],n=[],r;for(this._root&&e.push(new wn(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,l=r.y0,u=r.x1,d=r.y1,h=(o+u)/2,g=(l+d)/2;(s=i[0])&&e.push(new wn(s,o,l,h,g)),(s=i[1])&&e.push(new wn(s,h,l,u,g)),(s=i[2])&&e.push(new wn(s,o,g,h,d)),(s=i[3])&&e.push(new wn(s,h,g,u,d))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function x5(t){return t[0]}function w5(t){return arguments.length?(this._x=t,this):this._x}function T5(t){return t[1]}function S5(t){return arguments.length?(this._y=t,this):this._y}function Gx(t,e,n){var r=new Kx(e??x5,n??T5,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function Kx(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function wS(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Sn=Gx.prototype=Kx.prototype;Sn.copy=function(){var t=new Kx(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=wS(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=wS(r));return t};Sn.add=c5;Sn.addAll=u5;Sn.cover=f5;Sn.data=d5;Sn.extent=h5;Sn.find=p5;Sn.remove=g5;Sn.removeAll=m5;Sn.root=_5;Sn.size=v5;Sn.visit=y5;Sn.visitAfter=b5;Sn.x=w5;Sn.y=S5;function Tn(t){return function(){return t}}function Gi(t){return(t()-.5)*1e-6}function E5(t){return t.x+t.vx}function A5(t){return t.y+t.vy}function R5(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Tn(t==null?1:+t));function o(){for(var d,h=e.length,g,_,y,T,w,x,S=0;S<s;++S)for(g=Gx(e,E5,A5).visitAfter(l),d=0;d<h;++d)_=e[d],w=n[_.index],x=w*w,y=_.x+_.vx,T=_.y+_.vy,g.visit(R);function R(E,A,k,O,j){var N=E.data,I=E.r,M=w+I;if(N){if(N.index>_.index){var q=y-N.x-N.vx,X=T-N.y-N.vy,G=q*q+X*X;G<M*M&&(q===0&&(q=Gi(r),G+=q*q),X===0&&(X=Gi(r),G+=X*X),G=(M-(G=Math.sqrt(G)))/G*i,_.vx+=(q*=G)*(M=(I*=I)/(x+I)),_.vy+=(X*=G)*M,N.vx-=q*(M=1-M),N.vy-=X*M)}return}return A>y+M||O<y-M||k>T+M||j<T-M}}function l(d){if(d.data)return d.r=n[d.data.index];for(var h=d.r=0;h<4;++h)d[h]&&d[h].r>d.r&&(d.r=d[h].r)}function u(){if(e){var d,h=e.length,g;for(n=new Array(h),d=0;d<h;++d)g=e[d],n[g.index]=+t(g,d,e)}}return o.initialize=function(d,h){e=d,r=h,u()},o.iterations=function(d){return arguments.length?(s=+d,o):s},o.strength=function(d){return arguments.length?(i=+d,o):i},o.radius=function(d){return arguments.length?(t=typeof d=="function"?d:Tn(+d),u(),o):t},o}function C5(t){return t.index}function TS(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function N5(t){var e=C5,n=g,r,i=Tn(30),s,o,l,u,d,h=1;t==null&&(t=[]);function g(x){return 1/Math.min(l[x.source.index],l[x.target.index])}function _(x){for(var S=0,R=t.length;S<h;++S)for(var E=0,A,k,O,j,N,I,M;E<R;++E)A=t[E],k=A.source,O=A.target,j=O.x+O.vx-k.x-k.vx||Gi(d),N=O.y+O.vy-k.y-k.vy||Gi(d),I=Math.sqrt(j*j+N*N),I=(I-s[E])/I*x*r[E],j*=I,N*=I,O.vx-=j*(M=u[E]),O.vy-=N*M,k.vx+=j*(M=1-M),k.vy+=N*M}function y(){if(o){var x,S=o.length,R=t.length,E=new Map(o.map((k,O)=>[e(k,O,o),k])),A;for(x=0,l=new Array(S);x<R;++x)A=t[x],A.index=x,typeof A.source!="object"&&(A.source=TS(E,A.source)),typeof A.target!="object"&&(A.target=TS(E,A.target)),l[A.source.index]=(l[A.source.index]||0)+1,l[A.target.index]=(l[A.target.index]||0)+1;for(x=0,u=new Array(R);x<R;++x)A=t[x],u[x]=l[A.source.index]/(l[A.source.index]+l[A.target.index]);r=new Array(R),T(),s=new Array(R),w()}}function T(){if(o)for(var x=0,S=t.length;x<S;++x)r[x]=+n(t[x],x,t)}function w(){if(o)for(var x=0,S=t.length;x<S;++x)s[x]=+i(t[x],x,t)}return _.initialize=function(x,S){o=x,d=S,y()},_.links=function(x){return arguments.length?(t=x,y(),_):t},_.id=function(x){return arguments.length?(e=x,_):e},_.iterations=function(x){return arguments.length?(h=+x,_):h},_.strength=function(x){return arguments.length?(n=typeof x=="function"?x:Tn(+x),T(),_):n},_.distance=function(x){return arguments.length?(i=typeof x=="function"?x:Tn(+x),w(),_):i},_}const k5=1664525,M5=1013904223,SS=4294967296;function I5(){let t=1;return()=>(t=(k5*t+M5)%SS)/SS}function O5(t){return t.x}function P5(t){return t.y}var D5=10,j5=Math.PI*(3-Math.sqrt(5));function B5(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,l=new Map,u=Wx(g),d=dc("tick","end"),h=I5();t==null&&(t=[]);function g(){_(),d.call("tick",e),n<r&&(u.stop(),d.call("end",e))}function _(w){var x,S=t.length,R;w===void 0&&(w=1);for(var E=0;E<w;++E)for(n+=(s-n)*i,l.forEach(function(A){A(n)}),x=0;x<S;++x)R=t[x],R.fx==null?R.x+=R.vx*=o:(R.x=R.fx,R.vx=0),R.fy==null?R.y+=R.vy*=o:(R.y=R.fy,R.vy=0);return e}function y(){for(var w=0,x=t.length,S;w<x;++w){if(S=t[w],S.index=w,S.fx!=null&&(S.x=S.fx),S.fy!=null&&(S.y=S.fy),isNaN(S.x)||isNaN(S.y)){var R=D5*Math.sqrt(.5+w),E=w*j5;S.x=R*Math.cos(E),S.y=R*Math.sin(E)}(isNaN(S.vx)||isNaN(S.vy))&&(S.vx=S.vy=0)}}function T(w){return w.initialize&&w.initialize(t,h),w}return y(),e={tick:_,restart:function(){return u.restart(g),e},stop:function(){return u.stop(),e},nodes:function(w){return arguments.length?(t=w,y(),l.forEach(T),e):t},alpha:function(w){return arguments.length?(n=+w,e):n},alphaMin:function(w){return arguments.length?(r=+w,e):r},alphaDecay:function(w){return arguments.length?(i=+w,e):+i},alphaTarget:function(w){return arguments.length?(s=+w,e):s},velocityDecay:function(w){return arguments.length?(o=1-w,e):1-o},randomSource:function(w){return arguments.length?(h=w,l.forEach(T),e):h},force:function(w,x){return arguments.length>1?(x==null?l.delete(w):l.set(w,T(x)),e):l.get(w)},find:function(w,x,S){var R=0,E=t.length,A,k,O,j,N;for(S==null?S=1/0:S*=S,R=0;R<E;++R)j=t[R],A=w-j.x,k=x-j.y,O=A*A+k*k,O<S&&(N=j,S=O);return N},on:function(w,x){return arguments.length>1?(d.on(w,x),e):d.on(w)}}}function L5(){var t,e,n,r,i=Tn(-30),s,o=1,l=1/0,u=.81;function d(y){var T,w=t.length,x=Gx(t,O5,P5).visitAfter(g);for(r=y,T=0;T<w;++T)e=t[T],x.visit(_)}function h(){if(t){var y,T=t.length,w;for(s=new Array(T),y=0;y<T;++y)w=t[y],s[w.index]=+i(w,y,t)}}function g(y){var T=0,w,x,S=0,R,E,A;if(y.length){for(R=E=A=0;A<4;++A)(w=y[A])&&(x=Math.abs(w.value))&&(T+=w.value,S+=x,R+=x*w.x,E+=x*w.y);y.x=R/S,y.y=E/S}else{w=y,w.x=w.data.x,w.y=w.data.y;do T+=s[w.data.index];while(w=w.next)}y.value=T}function _(y,T,w,x){if(!y.value)return!0;var S=y.x-e.x,R=y.y-e.y,E=x-T,A=S*S+R*R;if(E*E/u<A)return A<l&&(S===0&&(S=Gi(n),A+=S*S),R===0&&(R=Gi(n),A+=R*R),A<o&&(A=Math.sqrt(o*A)),e.vx+=S*y.value*r/A,e.vy+=R*y.value*r/A),!0;if(y.length||A>=l)return;(y.data!==e||y.next)&&(S===0&&(S=Gi(n),A+=S*S),R===0&&(R=Gi(n),A+=R*R),A<o&&(A=Math.sqrt(o*A)));do y.data!==e&&(E=s[y.data.index]*r/A,e.vx+=S*E,e.vy+=R*E);while(y=y.next)}return d.initialize=function(y,T){t=y,n=T,h()},d.strength=function(y){return arguments.length?(i=typeof y=="function"?y:Tn(+y),h(),d):i},d.distanceMin=function(y){return arguments.length?(o=y*y,d):Math.sqrt(o)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(u=y*y,d):Math.sqrt(u)},d}function U5(t){var e=Tn(.1),n,r,i;typeof t!="function"&&(t=Tn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vx+=(i[u]-h.x)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Tn(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:Tn(+l),o(),s):t},s}function F5(t){var e=Tn(.1),n,r,i;typeof t!="function"&&(t=Tn(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vy+=(i[u]-h.y)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:Tn(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Tn(+l),o(),s):t},s}const qu=t=>()=>t;function z5(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function ui(t,e,n){this.k=t,this.x=e,this.y=n}ui.prototype={constructor:ui,scale:function(t){return t===1?this:new ui(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ui(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Cd=new ui(1,0,0);ui.prototype;function Eg(t){t.stopImmediatePropagation()}function wl(t){t.preventDefault(),t.stopImmediatePropagation()}function V5(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function q5(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function ES(){return this.__zoom||Cd}function $5(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function H5(){return navigator.maxTouchPoints||"ontouchstart"in this}function W5(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function X5(){var t=V5,e=q5,n=W5,r=$5,i=H5,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=Z8,d=dc("start","zoom","end"),h,g,_,y=500,T=150,w=0,x=10;function S(L){L.property("__zoom",ES).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",M).filter(i).on("touchstart.zoom",q).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",G).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}S.transform=function(L,J,V,$){var Y=L.selection?L.selection():L;Y.property("__zoom",ES),L!==Y?k(L,J,V,$):Y.interrupt().each(function(){O(this,arguments).event($).start().zoom(null,typeof J=="function"?J.apply(this,arguments):J).end()})},S.scaleBy=function(L,J,V,$){S.scaleTo(L,function(){var Y=this.__zoom.k,ue=typeof J=="function"?J.apply(this,arguments):J;return Y*ue},V,$)},S.scaleTo=function(L,J,V,$){S.transform(L,function(){var Y=e.apply(this,arguments),ue=this.__zoom,P=V==null?A(Y):typeof V=="function"?V.apply(this,arguments):V,H=ue.invert(P),ie=typeof J=="function"?J.apply(this,arguments):J;return n(E(R(ue,ie),P,H),Y,o)},V,$)},S.translateBy=function(L,J,V,$){S.transform(L,function(){return n(this.__zoom.translate(typeof J=="function"?J.apply(this,arguments):J,typeof V=="function"?V.apply(this,arguments):V),e.apply(this,arguments),o)},null,$)},S.translateTo=function(L,J,V,$,Y){S.transform(L,function(){var ue=e.apply(this,arguments),P=this.__zoom,H=$==null?A(ue):typeof $=="function"?$.apply(this,arguments):$;return n(Cd.translate(H[0],H[1]).scale(P.k).translate(typeof J=="function"?-J.apply(this,arguments):-J,typeof V=="function"?-V.apply(this,arguments):-V),ue,o)},$,Y)};function R(L,J){return J=Math.max(s[0],Math.min(s[1],J)),J===L.k?L:new ui(J,L.x,L.y)}function E(L,J,V){var $=J[0]-V[0]*L.k,Y=J[1]-V[1]*L.k;return $===L.x&&Y===L.y?L:new ui(L.k,$,Y)}function A(L){return[(+L[0][0]+ +L[1][0])/2,(+L[0][1]+ +L[1][1])/2]}function k(L,J,V,$){L.on("start.zoom",function(){O(this,arguments).event($).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event($).end()}).tween("zoom",function(){var Y=this,ue=arguments,P=O(Y,ue).event($),H=e.apply(Y,ue),ie=V==null?A(H):typeof V=="function"?V.apply(Y,ue):V,re=Math.max(H[1][0]-H[0][0],H[1][1]-H[0][1]),U=Y.__zoom,Z=typeof J=="function"?J.apply(Y,ue):J,oe=u(U.invert(ie).concat(re/U.k),Z.invert(ie).concat(re/Z.k));return function(_e){if(_e===1)_e=Z;else{var ye=oe(_e),Ae=re/ye[2];_e=new ui(Ae,ie[0]-ye[0]*Ae,ie[1]-ye[1]*Ae)}P.zoom(null,_e)}})}function O(L,J,V){return!V&&L.__zooming||new j(L,J)}function j(L,J){this.that=L,this.args=J,this.active=0,this.sourceEvent=null,this.extent=e.apply(L,J),this.taps=0}j.prototype={event:function(L){return L&&(this.sourceEvent=L),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(L,J){return this.mouse&&L!=="mouse"&&(this.mouse[1]=J.invert(this.mouse[0])),this.touch0&&L!=="touch"&&(this.touch0[1]=J.invert(this.touch0[0])),this.touch1&&L!=="touch"&&(this.touch1[1]=J.invert(this.touch1[0])),this.that.__zoom=J,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(L){var J=rr(this.that).datum();d.call(L,this.that,new z5(L,{sourceEvent:this.sourceEvent,target:S,transform:this.that.__zoom,dispatch:d}),J)}};function N(L,...J){if(!t.apply(this,arguments))return;var V=O(this,J).event(L),$=this.__zoom,Y=Math.max(s[0],Math.min(s[1],$.k*Math.pow(2,r.apply(this,arguments)))),ue=ai(L);if(V.wheel)(V.mouse[0][0]!==ue[0]||V.mouse[0][1]!==ue[1])&&(V.mouse[1]=$.invert(V.mouse[0]=ue)),clearTimeout(V.wheel);else{if($.k===Y)return;V.mouse=[ue,$.invert(ue)],ff(this),V.start()}wl(L),V.wheel=setTimeout(P,T),V.zoom("mouse",n(E(R($,Y),V.mouse[0],V.mouse[1]),V.extent,o));function P(){V.wheel=null,V.end()}}function I(L,...J){if(_||!t.apply(this,arguments))return;var V=L.currentTarget,$=O(this,J,!0).event(L),Y=rr(L.view).on("mousemove.zoom",ie,!0).on("mouseup.zoom",re,!0),ue=ai(L,V),P=L.clientX,H=L.clientY;nI(L.view),Eg(L),$.mouse=[ue,this.__zoom.invert(ue)],ff(this),$.start();function ie(U){if(wl(U),!$.moved){var Z=U.clientX-P,oe=U.clientY-H;$.moved=Z*Z+oe*oe>w}$.event(U).zoom("mouse",n(E($.that.__zoom,$.mouse[0]=ai(U,V),$.mouse[1]),$.extent,o))}function re(U){Y.on("mousemove.zoom mouseup.zoom",null),rI(U.view,$.moved),wl(U),$.event(U).end()}}function M(L,...J){if(t.apply(this,arguments)){var V=this.__zoom,$=ai(L.changedTouches?L.changedTouches[0]:L,this),Y=V.invert($),ue=V.k*(L.shiftKey?.5:2),P=n(E(R(V,ue),$,Y),e.apply(this,J),o);wl(L),l>0?rr(this).transition().duration(l).call(k,P,$,L):rr(this).call(S.transform,P,$,L)}}function q(L,...J){if(t.apply(this,arguments)){var V=L.touches,$=V.length,Y=O(this,J,L.changedTouches.length===$).event(L),ue,P,H,ie;for(Eg(L),P=0;P<$;++P)H=V[P],ie=ai(H,this),ie=[ie,this.__zoom.invert(ie),H.identifier],Y.touch0?!Y.touch1&&Y.touch0[2]!==ie[2]&&(Y.touch1=ie,Y.taps=0):(Y.touch0=ie,ue=!0,Y.taps=1+!!h);h&&(h=clearTimeout(h)),ue&&(Y.taps<2&&(g=ie[0],h=setTimeout(function(){h=null},y)),ff(this),Y.start())}}function X(L,...J){if(this.__zooming){var V=O(this,J).event(L),$=L.changedTouches,Y=$.length,ue,P,H,ie;for(wl(L),ue=0;ue<Y;++ue)P=$[ue],H=ai(P,this),V.touch0&&V.touch0[2]===P.identifier?V.touch0[0]=H:V.touch1&&V.touch1[2]===P.identifier&&(V.touch1[0]=H);if(P=V.that.__zoom,V.touch1){var re=V.touch0[0],U=V.touch0[1],Z=V.touch1[0],oe=V.touch1[1],_e=(_e=Z[0]-re[0])*_e+(_e=Z[1]-re[1])*_e,ye=(ye=oe[0]-U[0])*ye+(ye=oe[1]-U[1])*ye;P=R(P,Math.sqrt(_e/ye)),H=[(re[0]+Z[0])/2,(re[1]+Z[1])/2],ie=[(U[0]+oe[0])/2,(U[1]+oe[1])/2]}else if(V.touch0)H=V.touch0[0],ie=V.touch0[1];else return;V.zoom("touch",n(E(P,H,ie),V.extent,o))}}function G(L,...J){if(this.__zooming){var V=O(this,J).event(L),$=L.changedTouches,Y=$.length,ue,P;for(Eg(L),_&&clearTimeout(_),_=setTimeout(function(){_=null},y),ue=0;ue<Y;++ue)P=$[ue],V.touch0&&V.touch0[2]===P.identifier?delete V.touch0:V.touch1&&V.touch1[2]===P.identifier&&delete V.touch1;if(V.touch1&&!V.touch0&&(V.touch0=V.touch1,delete V.touch1),V.touch0)V.touch0[1]=this.__zoom.invert(V.touch0[0]);else if(V.end(),V.taps===2&&(P=ai(P,this),Math.hypot(g[0]-P[0],g[1]-P[1])<x)){var H=rr(this).on("dblclick.zoom");H&&H.apply(this,arguments)}}}return S.wheelDelta=function(L){return arguments.length?(r=typeof L=="function"?L:qu(+L),S):r},S.filter=function(L){return arguments.length?(t=typeof L=="function"?L:qu(!!L),S):t},S.touchable=function(L){return arguments.length?(i=typeof L=="function"?L:qu(!!L),S):i},S.extent=function(L){return arguments.length?(e=typeof L=="function"?L:qu([[+L[0][0],+L[0][1]],[+L[1][0],+L[1][1]]]),S):e},S.scaleExtent=function(L){return arguments.length?(s[0]=+L[0],s[1]=+L[1],S):[s[0],s[1]]},S.translateExtent=function(L){return arguments.length?(o[0][0]=+L[0][0],o[1][0]=+L[1][0],o[0][1]=+L[0][1],o[1][1]=+L[1][1],S):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},S.constrain=function(L){return arguments.length?(n=L,S):n},S.duration=function(L){return arguments.length?(l=+L,S):l},S.interpolate=function(L){return arguments.length?(u=L,S):u},S.on=function(){var L=d.on.apply(d,arguments);return L===d?S:L},S.clickDistance=function(L){return arguments.length?(w=(L=+L)*L,S):Math.sqrt(w)},S.tapDistance=function(L){return arguments.length?(x=+L,S):x},S}function Zx(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ag,AS;function Y5(){if(AS)return Ag;AS=1;function t(){this.__data__=[],this.size=0}return Ag=t,Ag}var Rg,RS;function po(){if(RS)return Rg;RS=1;function t(e,n){return e===n||e!==e&&n!==n}return Rg=t,Rg}var Cg,CS;function Nd(){if(CS)return Cg;CS=1;var t=po();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return Cg=e,Cg}var Ng,NS;function G5(){if(NS)return Ng;NS=1;var t=Nd(),e=Array.prototype,n=e.splice;function r(i){var s=this.__data__,o=t(s,i);if(o<0)return!1;var l=s.length-1;return o==l?s.pop():n.call(s,o,1),--this.size,!0}return Ng=r,Ng}var kg,kS;function K5(){if(kS)return kg;kS=1;var t=Nd();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return kg=e,kg}var Mg,MS;function Z5(){if(MS)return Mg;MS=1;var t=Nd();function e(n){return t(this.__data__,n)>-1}return Mg=e,Mg}var Ig,IS;function Q5(){if(IS)return Ig;IS=1;var t=Nd();function e(n,r){var i=this.__data__,s=t(i,n);return s<0?(++this.size,i.push([n,r])):i[s][1]=r,this}return Ig=e,Ig}var Og,OS;function kd(){if(OS)return Og;OS=1;var t=Y5(),e=G5(),n=K5(),r=Z5(),i=Q5();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,Og=s,Og}var Pg,PS;function J5(){if(PS)return Pg;PS=1;var t=kd();function e(){this.__data__=new t,this.size=0}return Pg=e,Pg}var Dg,DS;function ez(){if(DS)return Dg;DS=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return Dg=t,Dg}var jg,jS;function tz(){if(jS)return jg;jS=1;function t(e){return this.__data__.get(e)}return jg=t,jg}var Bg,BS;function nz(){if(BS)return Bg;BS=1;function t(e){return this.__data__.has(e)}return Bg=t,Bg}var Lg,LS;function _I(){if(LS)return Lg;LS=1;var t=typeof Bu=="object"&&Bu&&Bu.Object===Object&&Bu;return Lg=t,Lg}var Ug,US;function Er(){if(US)return Ug;US=1;var t=_I(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return Ug=n,Ug}var Fg,FS;function go(){if(FS)return Fg;FS=1;var t=Er(),e=t.Symbol;return Fg=e,Fg}var zg,zS;function rz(){if(zS)return zg;zS=1;var t=go(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function s(o){var l=n.call(o,i),u=o[i];try{o[i]=void 0;var d=!0}catch{}var h=r.call(o);return d&&(l?o[i]=u:delete o[i]),h}return zg=s,zg}var Vg,VS;function iz(){if(VS)return Vg;VS=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return Vg=n,Vg}var qg,qS;function zs(){if(qS)return qg;qS=1;var t=go(),e=rz(),n=iz(),r="[object Null]",i="[object Undefined]",s=t?t.toStringTag:void 0;function o(l){return l==null?l===void 0?i:r:s&&s in Object(l)?e(l):n(l)}return qg=o,qg}var $g,$S;function cr(){if($S)return $g;$S=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return $g=t,$g}var Hg,HS;function gc(){if(HS)return Hg;HS=1;var t=zs(),e=cr(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function o(l){if(!e(l))return!1;var u=t(l);return u==r||u==i||u==n||u==s}return Hg=o,Hg}var Wg,WS;function sz(){if(WS)return Wg;WS=1;var t=Er(),e=t["__core-js_shared__"];return Wg=e,Wg}var Xg,XS;function az(){if(XS)return Xg;XS=1;var t=sz(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return Xg=n,Xg}var Yg,YS;function vI(){if(YS)return Yg;YS=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return Yg=n,Yg}var Gg,GS;function oz(){if(GS)return Gg;GS=1;var t=gc(),e=az(),n=cr(),r=vI(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,u=o.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function g(_){if(!n(_)||e(_))return!1;var y=t(_)?h:s;return y.test(r(_))}return Gg=g,Gg}var Kg,KS;function lz(){if(KS)return Kg;KS=1;function t(e,n){return e==null?void 0:e[n]}return Kg=t,Kg}var Zg,ZS;function Vs(){if(ZS)return Zg;ZS=1;var t=oz(),e=lz();function n(r,i){var s=e(r,i);return t(s)?s:void 0}return Zg=n,Zg}var Qg,QS;function Qx(){if(QS)return Qg;QS=1;var t=Vs(),e=Er(),n=t(e,"Map");return Qg=n,Qg}var Jg,JS;function Md(){if(JS)return Jg;JS=1;var t=Vs(),e=t(Object,"create");return Jg=e,Jg}var em,eE;function cz(){if(eE)return em;eE=1;var t=Md();function e(){this.__data__=t?t(null):{},this.size=0}return em=e,em}var tm,tE;function uz(){if(tE)return tm;tE=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return tm=t,tm}var nm,nE;function fz(){if(nE)return nm;nE=1;var t=Md(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(s){var o=this.__data__;if(t){var l=o[s];return l===e?void 0:l}return r.call(o,s)?o[s]:void 0}return nm=i,nm}var rm,rE;function dz(){if(rE)return rm;rE=1;var t=Md(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var s=this.__data__;return t?s[i]!==void 0:n.call(s,i)}return rm=r,rm}var im,iE;function hz(){if(iE)return im;iE=1;var t=Md(),e="__lodash_hash_undefined__";function n(r,i){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=t&&i===void 0?e:i,this}return im=n,im}var sm,sE;function pz(){if(sE)return sm;sE=1;var t=cz(),e=uz(),n=fz(),r=dz(),i=hz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,sm=s,sm}var am,aE;function gz(){if(aE)return am;aE=1;var t=pz(),e=kd(),n=Qx();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return am=r,am}var om,oE;function mz(){if(oE)return om;oE=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return om=t,om}var lm,lE;function Id(){if(lE)return lm;lE=1;var t=mz();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return lm=e,lm}var cm,cE;function _z(){if(cE)return cm;cE=1;var t=Id();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return cm=e,cm}var um,uE;function vz(){if(uE)return um;uE=1;var t=Id();function e(n){return t(this,n).get(n)}return um=e,um}var fm,fE;function yz(){if(fE)return fm;fE=1;var t=Id();function e(n){return t(this,n).has(n)}return fm=e,fm}var dm,dE;function bz(){if(dE)return dm;dE=1;var t=Id();function e(n,r){var i=t(this,n),s=i.size;return i.set(n,r),this.size+=i.size==s?0:1,this}return dm=e,dm}var hm,hE;function Jx(){if(hE)return hm;hE=1;var t=gz(),e=_z(),n=vz(),r=yz(),i=bz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,hm=s,hm}var pm,pE;function xz(){if(pE)return pm;pE=1;var t=kd(),e=Qx(),n=Jx(),r=200;function i(s,o){var l=this.__data__;if(l instanceof t){var u=l.__data__;if(!e||u.length<r-1)return u.push([s,o]),this.size=++l.size,this;l=this.__data__=new n(u)}return l.set(s,o),this.size=l.size,this}return pm=i,pm}var gm,gE;function Od(){if(gE)return gm;gE=1;var t=kd(),e=J5(),n=ez(),r=tz(),i=nz(),s=xz();function o(l){var u=this.__data__=new t(l);this.size=u.size}return o.prototype.clear=e,o.prototype.delete=n,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,gm=o,gm}var mm,mE;function e1(){if(mE)return mm;mE=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return mm=t,mm}var _m,_E;function yI(){if(_E)return _m;_E=1;var t=Vs(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return _m=e,_m}var vm,vE;function Pd(){if(vE)return vm;vE=1;var t=yI();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return vm=e,vm}var ym,yE;function Dd(){if(yE)return ym;yE=1;var t=Pd(),e=po(),n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l){var u=s[o];(!(r.call(s,o)&&e(u,l))||l===void 0&&!(o in s))&&t(s,o,l)}return ym=i,ym}var bm,bE;function mc(){if(bE)return bm;bE=1;var t=Dd(),e=Pd();function n(r,i,s,o){var l=!s;s||(s={});for(var u=-1,d=i.length;++u<d;){var h=i[u],g=o?o(s[h],r[h],h,s,r):void 0;g===void 0&&(g=r[h]),l?e(s,h,g):t(s,h,g)}return s}return bm=n,bm}var xm,xE;function wz(){if(xE)return xm;xE=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return xm=t,xm}var wm,wE;function Vr(){if(wE)return wm;wE=1;function t(e){return e!=null&&typeof e=="object"}return wm=t,wm}var Tm,TE;function Tz(){if(TE)return Tm;TE=1;var t=zs(),e=Vr(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return Tm=r,Tm}var Sm,SE;function _c(){if(SE)return Sm;SE=1;var t=Tz(),e=Vr(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,s=t(function(){return arguments}())?t:function(o){return e(o)&&r.call(o,"callee")&&!i.call(o,"callee")};return Sm=s,Sm}var Em,EE;function qt(){if(EE)return Em;EE=1;var t=Array.isArray;return Em=t,Em}var kl={exports:{}},Am,AE;function Sz(){if(AE)return Am;AE=1;function t(){return!1}return Am=t,Am}kl.exports;var RE;function mo(){return RE||(RE=1,function(t,e){var n=Er(),r=Sz(),i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,o=s&&s.exports===i,l=o?n.Buffer:void 0,u=l?l.isBuffer:void 0,d=u||r;t.exports=d}(kl,kl.exports)),kl.exports}var Rm,CE;function jd(){if(CE)return Rm;CE=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var s=typeof r;return i=i??t,!!i&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return Rm=n,Rm}var Cm,NE;function t1(){if(NE)return Cm;NE=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Cm=e,Cm}var Nm,kE;function Ez(){if(kE)return Nm;kE=1;var t=zs(),e=t1(),n=Vr(),r="[object Arguments]",i="[object Array]",s="[object Boolean]",o="[object Date]",l="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",g="[object Object]",_="[object RegExp]",y="[object Set]",T="[object String]",w="[object WeakMap]",x="[object ArrayBuffer]",S="[object DataView]",R="[object Float32Array]",E="[object Float64Array]",A="[object Int8Array]",k="[object Int16Array]",O="[object Int32Array]",j="[object Uint8Array]",N="[object Uint8ClampedArray]",I="[object Uint16Array]",M="[object Uint32Array]",q={};q[R]=q[E]=q[A]=q[k]=q[O]=q[j]=q[N]=q[I]=q[M]=!0,q[r]=q[i]=q[x]=q[s]=q[S]=q[o]=q[l]=q[u]=q[d]=q[h]=q[g]=q[_]=q[y]=q[T]=q[w]=!1;function X(G){return n(G)&&e(G.length)&&!!q[t(G)]}return Nm=X,Nm}var km,ME;function Bd(){if(ME)return km;ME=1;function t(e){return function(n){return e(n)}}return km=t,km}var Ml={exports:{}};Ml.exports;var IE;function n1(){return IE||(IE=1,function(t,e){var n=_I(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s&&n.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();t.exports=l}(Ml,Ml.exports)),Ml.exports}var Mm,OE;function vc(){if(OE)return Mm;OE=1;var t=Ez(),e=Bd(),n=n1(),r=n&&n.isTypedArray,i=r?e(r):t;return Mm=i,Mm}var Im,PE;function bI(){if(PE)return Im;PE=1;var t=wz(),e=_c(),n=qt(),r=mo(),i=jd(),s=vc(),o=Object.prototype,l=o.hasOwnProperty;function u(d,h){var g=n(d),_=!g&&e(d),y=!g&&!_&&r(d),T=!g&&!_&&!y&&s(d),w=g||_||y||T,x=w?t(d.length,String):[],S=x.length;for(var R in d)(h||l.call(d,R))&&!(w&&(R=="length"||y&&(R=="offset"||R=="parent")||T&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||i(R,S)))&&x.push(R);return x}return Im=u,Im}var Om,DE;function Ld(){if(DE)return Om;DE=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return Om=e,Om}var Pm,jE;function xI(){if(jE)return Pm;jE=1;function t(e,n){return function(r){return e(n(r))}}return Pm=t,Pm}var Dm,BE;function Az(){if(BE)return Dm;BE=1;var t=xI(),e=t(Object.keys,Object);return Dm=e,Dm}var jm,LE;function r1(){if(LE)return jm;LE=1;var t=Ld(),e=Az(),n=Object.prototype,r=n.hasOwnProperty;function i(s){if(!t(s))return e(s);var o=[];for(var l in Object(s))r.call(s,l)&&l!="constructor"&&o.push(l);return o}return jm=i,jm}var Bm,UE;function hi(){if(UE)return Bm;UE=1;var t=gc(),e=t1();function n(r){return r!=null&&e(r.length)&&!t(r)}return Bm=n,Bm}var Lm,FE;function ts(){if(FE)return Lm;FE=1;var t=bI(),e=r1(),n=hi();function r(i){return n(i)?t(i):e(i)}return Lm=r,Lm}var Um,zE;function Rz(){if(zE)return Um;zE=1;var t=mc(),e=ts();function n(r,i){return r&&t(i,e(i),r)}return Um=n,Um}var Fm,VE;function Cz(){if(VE)return Fm;VE=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return Fm=t,Fm}var zm,qE;function Nz(){if(qE)return zm;qE=1;var t=cr(),e=Ld(),n=Cz(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!t(o))return n(o);var l=e(o),u=[];for(var d in o)d=="constructor"&&(l||!i.call(o,d))||u.push(d);return u}return zm=s,zm}var Vm,$E;function qs(){if($E)return Vm;$E=1;var t=bI(),e=Nz(),n=hi();function r(i){return n(i)?t(i,!0):e(i)}return Vm=r,Vm}var qm,HE;function kz(){if(HE)return qm;HE=1;var t=mc(),e=qs();function n(r,i){return r&&t(i,e(i),r)}return qm=n,qm}var Il={exports:{}};Il.exports;var WE;function wI(){return WE||(WE=1,function(t,e){var n=Er(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s?n.Buffer:void 0,l=o?o.allocUnsafe:void 0;function u(d,h){if(h)return d.slice();var g=d.length,_=l?l(g):new d.constructor(g);return d.copy(_),_}t.exports=u}(Il,Il.exports)),Il.exports}var $m,XE;function TI(){if(XE)return $m;XE=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return $m=t,$m}var Hm,YE;function SI(){if(YE)return Hm;YE=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=0,o=[];++r<i;){var l=e[r];n(l,r,e)&&(o[s++]=l)}return o}return Hm=t,Hm}var Wm,GE;function EI(){if(GE)return Wm;GE=1;function t(){return[]}return Wm=t,Wm}var Xm,KE;function i1(){if(KE)return Xm;KE=1;var t=SI(),e=EI(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(o){return o==null?[]:(o=Object(o),t(i(o),function(l){return r.call(o,l)}))}:e;return Xm=s,Xm}var Ym,ZE;function Mz(){if(ZE)return Ym;ZE=1;var t=mc(),e=i1();function n(r,i){return t(r,e(r),i)}return Ym=n,Ym}var Gm,QE;function s1(){if(QE)return Gm;QE=1;function t(e,n){for(var r=-1,i=n.length,s=e.length;++r<i;)e[s+r]=n[r];return e}return Gm=t,Gm}var Km,JE;function Ud(){if(JE)return Km;JE=1;var t=xI(),e=t(Object.getPrototypeOf,Object);return Km=e,Km}var Zm,eA;function AI(){if(eA)return Zm;eA=1;var t=s1(),e=Ud(),n=i1(),r=EI(),i=Object.getOwnPropertySymbols,s=i?function(o){for(var l=[];o;)t(l,n(o)),o=e(o);return l}:r;return Zm=s,Zm}var Qm,tA;function Iz(){if(tA)return Qm;tA=1;var t=mc(),e=AI();function n(r,i){return t(r,e(r),i)}return Qm=n,Qm}var Jm,nA;function RI(){if(nA)return Jm;nA=1;var t=s1(),e=qt();function n(r,i,s){var o=i(r);return e(r)?o:t(o,s(r))}return Jm=n,Jm}var e_,rA;function CI(){if(rA)return e_;rA=1;var t=RI(),e=i1(),n=ts();function r(i){return t(i,n,e)}return e_=r,e_}var t_,iA;function Oz(){if(iA)return t_;iA=1;var t=RI(),e=AI(),n=qs();function r(i){return t(i,n,e)}return t_=r,t_}var n_,sA;function Pz(){if(sA)return n_;sA=1;var t=Vs(),e=Er(),n=t(e,"DataView");return n_=n,n_}var r_,aA;function Dz(){if(aA)return r_;aA=1;var t=Vs(),e=Er(),n=t(e,"Promise");return r_=n,r_}var i_,oA;function NI(){if(oA)return i_;oA=1;var t=Vs(),e=Er(),n=t(e,"Set");return i_=n,i_}var s_,lA;function jz(){if(lA)return s_;lA=1;var t=Vs(),e=Er(),n=t(e,"WeakMap");return s_=n,s_}var a_,cA;function _o(){if(cA)return a_;cA=1;var t=Pz(),e=Qx(),n=Dz(),r=NI(),i=jz(),s=zs(),o=vI(),l="[object Map]",u="[object Object]",d="[object Promise]",h="[object Set]",g="[object WeakMap]",_="[object DataView]",y=o(t),T=o(e),w=o(n),x=o(r),S=o(i),R=s;return(t&&R(new t(new ArrayBuffer(1)))!=_||e&&R(new e)!=l||n&&R(n.resolve())!=d||r&&R(new r)!=h||i&&R(new i)!=g)&&(R=function(E){var A=s(E),k=A==u?E.constructor:void 0,O=k?o(k):"";if(O)switch(O){case y:return _;case T:return l;case w:return d;case x:return h;case S:return g}return A}),a_=R,a_}var o_,uA;function Bz(){if(uA)return o_;uA=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}return o_=n,o_}var l_,fA;function kI(){if(fA)return l_;fA=1;var t=Er(),e=t.Uint8Array;return l_=e,l_}var c_,dA;function a1(){if(dA)return c_;dA=1;var t=kI();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return c_=e,c_}var u_,hA;function Lz(){if(hA)return u_;hA=1;var t=a1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return u_=e,u_}var f_,pA;function Uz(){if(pA)return f_;pA=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return f_=e,f_}var d_,gA;function Fz(){if(gA)return d_;gA=1;var t=go(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return d_=r,d_}var h_,mA;function MI(){if(mA)return h_;mA=1;var t=a1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return h_=e,h_}var p_,_A;function zz(){if(_A)return p_;_A=1;var t=a1(),e=Lz(),n=Uz(),r=Fz(),i=MI(),s="[object Boolean]",o="[object Date]",l="[object Map]",u="[object Number]",d="[object RegExp]",h="[object Set]",g="[object String]",_="[object Symbol]",y="[object ArrayBuffer]",T="[object DataView]",w="[object Float32Array]",x="[object Float64Array]",S="[object Int8Array]",R="[object Int16Array]",E="[object Int32Array]",A="[object Uint8Array]",k="[object Uint8ClampedArray]",O="[object Uint16Array]",j="[object Uint32Array]";function N(I,M,q){var X=I.constructor;switch(M){case y:return t(I);case s:case o:return new X(+I);case T:return e(I,q);case w:case x:case S:case R:case E:case A:case k:case O:case j:return i(I,q);case l:return new X;case u:case g:return new X(I);case d:return n(I);case h:return new X;case _:return r(I)}}return p_=N,p_}var g_,vA;function II(){if(vA)return g_;vA=1;var t=cr(),e=Object.create,n=function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var s=new r;return r.prototype=void 0,s}}();return g_=n,g_}var m_,yA;function OI(){if(yA)return m_;yA=1;var t=II(),e=Ud(),n=Ld();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return m_=r,m_}var __,bA;function Vz(){if(bA)return __;bA=1;var t=_o(),e=Vr(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return __=r,__}var v_,xA;function qz(){if(xA)return v_;xA=1;var t=Vz(),e=Bd(),n=n1(),r=n&&n.isMap,i=r?e(r):t;return v_=i,v_}var y_,wA;function $z(){if(wA)return y_;wA=1;var t=_o(),e=Vr(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return y_=r,y_}var b_,TA;function Hz(){if(TA)return b_;TA=1;var t=$z(),e=Bd(),n=n1(),r=n&&n.isSet,i=r?e(r):t;return b_=i,b_}var x_,SA;function PI(){if(SA)return x_;SA=1;var t=Od(),e=e1(),n=Dd(),r=Rz(),i=kz(),s=wI(),o=TI(),l=Mz(),u=Iz(),d=CI(),h=Oz(),g=_o(),_=Bz(),y=zz(),T=OI(),w=qt(),x=mo(),S=qz(),R=cr(),E=Hz(),A=ts(),k=qs(),O=1,j=2,N=4,I="[object Arguments]",M="[object Array]",q="[object Boolean]",X="[object Date]",G="[object Error]",L="[object Function]",J="[object GeneratorFunction]",V="[object Map]",$="[object Number]",Y="[object Object]",ue="[object RegExp]",P="[object Set]",H="[object String]",ie="[object Symbol]",re="[object WeakMap]",U="[object ArrayBuffer]",Z="[object DataView]",oe="[object Float32Array]",_e="[object Float64Array]",ye="[object Int8Array]",Ae="[object Int16Array]",Me="[object Int32Array]",Ze="[object Uint8Array]",It="[object Uint8ClampedArray]",_t="[object Uint16Array]",ut="[object Uint32Array]",De={};De[I]=De[M]=De[U]=De[Z]=De[q]=De[X]=De[oe]=De[_e]=De[ye]=De[Ae]=De[Me]=De[V]=De[$]=De[Y]=De[ue]=De[P]=De[H]=De[ie]=De[Ze]=De[It]=De[_t]=De[ut]=!0,De[G]=De[L]=De[re]=!1;function tn(Ce,ln,Gt,On,_n,cn){var Ye,we=ln&O,Re=ln&j,We=ln&N;if(Gt&&(Ye=_n?Gt(Ce,On,_n,cn):Gt(Ce)),Ye!==void 0)return Ye;if(!R(Ce))return Ce;var ze=w(Ce);if(ze){if(Ye=_(Ce),!we)return o(Ce,Ye)}else{var Ge=g(Ce),vt=Ge==L||Ge==J;if(x(Ce))return s(Ce,we);if(Ge==Y||Ge==I||vt&&!_n){if(Ye=Re||vt?{}:T(Ce),!we)return Re?u(Ce,i(Ye,Ce)):l(Ce,r(Ye,Ce))}else{if(!De[Ge])return _n?Ce:{};Ye=y(Ce,Ge,we)}}cn||(cn=new t);var En=cn.get(Ce);if(En)return En;cn.set(Ce,Ye),E(Ce)?Ce.forEach(function(jt){Ye.add(tn(jt,ln,Gt,jt,Ce,cn))}):S(Ce)&&Ce.forEach(function(jt,xe){Ye.set(xe,tn(jt,ln,Gt,xe,Ce,cn))});var Rr=We?Re?h:d:Re?k:A,dr=ze?void 0:Rr(Ce);return e(dr||Ce,function(jt,xe){dr&&(xe=jt,jt=Ce[xe]),n(Ye,xe,tn(jt,ln,Gt,xe,Ce,cn))}),Ye}return x_=tn,x_}var w_,EA;function Wz(){if(EA)return w_;EA=1;var t=PI(),e=4;function n(r){return t(r,e)}return w_=n,w_}var T_,AA;function o1(){if(AA)return T_;AA=1;function t(e){return function(){return e}}return T_=t,T_}var S_,RA;function Xz(){if(RA)return S_;RA=1;function t(e){return function(n,r,i){for(var s=-1,o=Object(n),l=i(n),u=l.length;u--;){var d=l[e?u:++s];if(r(o[d],d,o)===!1)break}return n}}return S_=t,S_}var E_,CA;function l1(){if(CA)return E_;CA=1;var t=Xz(),e=t();return E_=e,E_}var A_,NA;function c1(){if(NA)return A_;NA=1;var t=l1(),e=ts();function n(r,i){return r&&t(r,i,e)}return A_=n,A_}var R_,kA;function Yz(){if(kA)return R_;kA=1;var t=hi();function e(n,r){return function(i,s){if(i==null)return i;if(!t(i))return n(i,s);for(var o=i.length,l=r?o:-1,u=Object(i);(r?l--:++l<o)&&s(u[l],l,u)!==!1;);return i}}return R_=e,R_}var C_,MA;function Fd(){if(MA)return C_;MA=1;var t=c1(),e=Yz(),n=e(t);return C_=n,C_}var N_,IA;function $s(){if(IA)return N_;IA=1;function t(e){return e}return N_=t,N_}var k_,OA;function DI(){if(OA)return k_;OA=1;var t=$s();function e(n){return typeof n=="function"?n:t}return k_=e,k_}var M_,PA;function jI(){if(PA)return M_;PA=1;var t=e1(),e=Fd(),n=DI(),r=qt();function i(s,o){var l=r(s)?t:e;return l(s,n(o))}return M_=i,M_}var I_,DA;function BI(){return DA||(DA=1,I_=jI()),I_}var O_,jA;function Gz(){if(jA)return O_;jA=1;var t=Fd();function e(n,r){var i=[];return t(n,function(s,o,l){r(s,o,l)&&i.push(s)}),i}return O_=e,O_}var P_,BA;function Kz(){if(BA)return P_;BA=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return P_=e,P_}var D_,LA;function Zz(){if(LA)return D_;LA=1;function t(e){return this.__data__.has(e)}return D_=t,D_}var j_,UA;function LI(){if(UA)return j_;UA=1;var t=Jx(),e=Kz(),n=Zz();function r(i){var s=-1,o=i==null?0:i.length;for(this.__data__=new t;++s<o;)this.add(i[s])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,j_=r,j_}var B_,FA;function Qz(){if(FA)return B_;FA=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return B_=t,B_}var L_,zA;function UI(){if(zA)return L_;zA=1;function t(e,n){return e.has(n)}return L_=t,L_}var U_,VA;function FI(){if(VA)return U_;VA=1;var t=LI(),e=Qz(),n=UI(),r=1,i=2;function s(o,l,u,d,h,g){var _=u&r,y=o.length,T=l.length;if(y!=T&&!(_&&T>y))return!1;var w=g.get(o),x=g.get(l);if(w&&x)return w==l&&x==o;var S=-1,R=!0,E=u&i?new t:void 0;for(g.set(o,l),g.set(l,o);++S<y;){var A=o[S],k=l[S];if(d)var O=_?d(k,A,S,l,o,g):d(A,k,S,o,l,g);if(O!==void 0){if(O)continue;R=!1;break}if(E){if(!e(l,function(j,N){if(!n(E,N)&&(A===j||h(A,j,u,d,g)))return E.push(N)})){R=!1;break}}else if(!(A===k||h(A,k,u,d,g))){R=!1;break}}return g.delete(o),g.delete(l),R}return U_=s,U_}var F_,qA;function Jz(){if(qA)return F_;qA=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,s){r[++n]=[s,i]}),r}return F_=t,F_}var z_,$A;function u1(){if($A)return z_;$A=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return z_=t,z_}var V_,HA;function e9(){if(HA)return V_;HA=1;var t=go(),e=kI(),n=po(),r=FI(),i=Jz(),s=u1(),o=1,l=2,u="[object Boolean]",d="[object Date]",h="[object Error]",g="[object Map]",_="[object Number]",y="[object RegExp]",T="[object Set]",w="[object String]",x="[object Symbol]",S="[object ArrayBuffer]",R="[object DataView]",E=t?t.prototype:void 0,A=E?E.valueOf:void 0;function k(O,j,N,I,M,q,X){switch(N){case R:if(O.byteLength!=j.byteLength||O.byteOffset!=j.byteOffset)return!1;O=O.buffer,j=j.buffer;case S:return!(O.byteLength!=j.byteLength||!q(new e(O),new e(j)));case u:case d:case _:return n(+O,+j);case h:return O.name==j.name&&O.message==j.message;case y:case w:return O==j+"";case g:var G=i;case T:var L=I&o;if(G||(G=s),O.size!=j.size&&!L)return!1;var J=X.get(O);if(J)return J==j;I|=l,X.set(O,j);var V=r(G(O),G(j),I,M,q,X);return X.delete(O),V;case x:if(A)return A.call(O)==A.call(j)}return!1}return V_=k,V_}var q_,WA;function t9(){if(WA)return q_;WA=1;var t=CI(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l,u,d,h){var g=l&e,_=t(s),y=_.length,T=t(o),w=T.length;if(y!=w&&!g)return!1;for(var x=y;x--;){var S=_[x];if(!(g?S in o:r.call(o,S)))return!1}var R=h.get(s),E=h.get(o);if(R&&E)return R==o&&E==s;var A=!0;h.set(s,o),h.set(o,s);for(var k=g;++x<y;){S=_[x];var O=s[S],j=o[S];if(u)var N=g?u(j,O,S,o,s,h):u(O,j,S,s,o,h);if(!(N===void 0?O===j||d(O,j,l,u,h):N)){A=!1;break}k||(k=S=="constructor")}if(A&&!k){var I=s.constructor,M=o.constructor;I!=M&&"constructor"in s&&"constructor"in o&&!(typeof I=="function"&&I instanceof I&&typeof M=="function"&&M instanceof M)&&(A=!1)}return h.delete(s),h.delete(o),A}return q_=i,q_}var $_,XA;function n9(){if(XA)return $_;XA=1;var t=Od(),e=FI(),n=e9(),r=t9(),i=_o(),s=qt(),o=mo(),l=vc(),u=1,d="[object Arguments]",h="[object Array]",g="[object Object]",_=Object.prototype,y=_.hasOwnProperty;function T(w,x,S,R,E,A){var k=s(w),O=s(x),j=k?h:i(w),N=O?h:i(x);j=j==d?g:j,N=N==d?g:N;var I=j==g,M=N==g,q=j==N;if(q&&o(w)){if(!o(x))return!1;k=!0,I=!1}if(q&&!I)return A||(A=new t),k||l(w)?e(w,x,S,R,E,A):n(w,x,j,S,R,E,A);if(!(S&u)){var X=I&&y.call(w,"__wrapped__"),G=M&&y.call(x,"__wrapped__");if(X||G){var L=X?w.value():w,J=G?x.value():x;return A||(A=new t),E(L,J,S,R,A)}}return q?(A||(A=new t),r(w,x,S,R,E,A)):!1}return $_=T,$_}var H_,YA;function zI(){if(YA)return H_;YA=1;var t=n9(),e=Vr();function n(r,i,s,o,l){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,s,o,n,l)}return H_=n,H_}var W_,GA;function r9(){if(GA)return W_;GA=1;var t=Od(),e=zI(),n=1,r=2;function i(s,o,l,u){var d=l.length,h=d,g=!u;if(s==null)return!h;for(s=Object(s);d--;){var _=l[d];if(g&&_[2]?_[1]!==s[_[0]]:!(_[0]in s))return!1}for(;++d<h;){_=l[d];var y=_[0],T=s[y],w=_[1];if(g&&_[2]){if(T===void 0&&!(y in s))return!1}else{var x=new t;if(u)var S=u(T,w,y,s,o,x);if(!(S===void 0?e(w,T,n|r,u,x):S))return!1}}return!0}return W_=i,W_}var X_,KA;function VI(){if(KA)return X_;KA=1;var t=cr();function e(n){return n===n&&!t(n)}return X_=e,X_}var Y_,ZA;function i9(){if(ZA)return Y_;ZA=1;var t=VI(),e=ts();function n(r){for(var i=e(r),s=i.length;s--;){var o=i[s],l=r[o];i[s]=[o,l,t(l)]}return i}return Y_=n,Y_}var G_,QA;function qI(){if(QA)return G_;QA=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return G_=t,G_}var K_,JA;function s9(){if(JA)return K_;JA=1;var t=r9(),e=i9(),n=qI();function r(i){var s=e(i);return s.length==1&&s[0][2]?n(s[0][0],s[0][1]):function(o){return o===i||t(o,i,s)}}return K_=r,K_}var Z_,eR;function vo(){if(eR)return Z_;eR=1;var t=zs(),e=Vr(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return Z_=r,Z_}var Q_,tR;function f1(){if(tR)return Q_;tR=1;var t=qt(),e=vo(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){if(t(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||e(s)?!0:r.test(s)||!n.test(s)||o!=null&&s in Object(o)}return Q_=i,Q_}var J_,nR;function a9(){if(nR)return J_;nR=1;var t=Jx(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var s=function(){var o=arguments,l=i?i.apply(this,o):o[0],u=s.cache;if(u.has(l))return u.get(l);var d=r.apply(this,o);return s.cache=u.set(l,d)||u,d};return s.cache=new(n.Cache||t),s}return n.Cache=t,J_=n,J_}var ev,rR;function o9(){if(rR)return ev;rR=1;var t=a9(),e=500;function n(r){var i=t(r,function(o){return s.size===e&&s.clear(),o}),s=i.cache;return i}return ev=n,ev}var tv,iR;function l9(){if(iR)return tv;iR=1;var t=o9(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(e,function(o,l,u,d){s.push(u?d.replace(n,"$1"):l||o)}),s});return tv=r,tv}var nv,sR;function zd(){if(sR)return nv;sR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=Array(i);++r<i;)s[r]=n(e[r],r,e);return s}return nv=t,nv}var rv,aR;function c9(){if(aR)return rv;aR=1;var t=go(),e=zd(),n=qt(),r=vo(),i=t?t.prototype:void 0,s=i?i.toString:void 0;function o(l){if(typeof l=="string")return l;if(n(l))return e(l,o)+"";if(r(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}return rv=o,rv}var iv,oR;function $I(){if(oR)return iv;oR=1;var t=c9();function e(n){return n==null?"":t(n)}return iv=e,iv}var sv,lR;function Vd(){if(lR)return sv;lR=1;var t=qt(),e=f1(),n=l9(),r=$I();function i(s,o){return t(s)?s:e(s,o)?[s]:n(r(s))}return sv=i,sv}var av,cR;function yc(){if(cR)return av;cR=1;var t=vo();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return av=e,av}var ov,uR;function qd(){if(uR)return ov;uR=1;var t=Vd(),e=yc();function n(r,i){i=t(i,r);for(var s=0,o=i.length;r!=null&&s<o;)r=r[e(i[s++])];return s&&s==o?r:void 0}return ov=n,ov}var lv,fR;function u9(){if(fR)return lv;fR=1;var t=qd();function e(n,r,i){var s=n==null?void 0:t(n,r);return s===void 0?i:s}return lv=e,lv}var cv,dR;function f9(){if(dR)return cv;dR=1;function t(e,n){return e!=null&&n in Object(e)}return cv=t,cv}var uv,hR;function HI(){if(hR)return uv;hR=1;var t=Vd(),e=_c(),n=qt(),r=jd(),i=t1(),s=yc();function o(l,u,d){u=t(u,l);for(var h=-1,g=u.length,_=!1;++h<g;){var y=s(u[h]);if(!(_=l!=null&&d(l,y)))break;l=l[y]}return _||++h!=g?_:(g=l==null?0:l.length,!!g&&i(g)&&r(y,g)&&(n(l)||e(l)))}return uv=o,uv}var fv,pR;function WI(){if(pR)return fv;pR=1;var t=f9(),e=HI();function n(r,i){return r!=null&&e(r,i,t)}return fv=n,fv}var dv,gR;function d9(){if(gR)return dv;gR=1;var t=zI(),e=u9(),n=WI(),r=f1(),i=VI(),s=qI(),o=yc(),l=1,u=2;function d(h,g){return r(h)&&i(g)?s(o(h),g):function(_){var y=e(_,h);return y===void 0&&y===g?n(_,h):t(g,y,l|u)}}return dv=d,dv}var hv,mR;function XI(){if(mR)return hv;mR=1;function t(e){return function(n){return n==null?void 0:n[e]}}return hv=t,hv}var pv,_R;function h9(){if(_R)return pv;_R=1;var t=qd();function e(n){return function(r){return t(r,n)}}return pv=e,pv}var gv,vR;function p9(){if(vR)return gv;vR=1;var t=XI(),e=h9(),n=f1(),r=yc();function i(s){return n(s)?t(r(s)):e(s)}return gv=i,gv}var mv,yR;function pi(){if(yR)return mv;yR=1;var t=s9(),e=d9(),n=$s(),r=qt(),i=p9();function s(o){return typeof o=="function"?o:o==null?n:typeof o=="object"?r(o)?e(o[0],o[1]):t(o):i(o)}return mv=s,mv}var _v,bR;function YI(){if(bR)return _v;bR=1;var t=SI(),e=Gz(),n=pi(),r=qt();function i(s,o){var l=r(s)?t:e;return l(s,n(o,3))}return _v=i,_v}var vv,xR;function g9(){if(xR)return vv;xR=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,i){return r!=null&&e.call(r,i)}return vv=n,vv}var yv,wR;function GI(){if(wR)return yv;wR=1;var t=g9(),e=HI();function n(r,i){return r!=null&&e(r,i,t)}return yv=n,yv}var bv,TR;function m9(){if(TR)return bv;TR=1;var t=r1(),e=_o(),n=_c(),r=qt(),i=hi(),s=mo(),o=Ld(),l=vc(),u="[object Map]",d="[object Set]",h=Object.prototype,g=h.hasOwnProperty;function _(y){if(y==null)return!0;if(i(y)&&(r(y)||typeof y=="string"||typeof y.splice=="function"||s(y)||l(y)||n(y)))return!y.length;var T=e(y);if(T==u||T==d)return!y.size;if(o(y))return!t(y).length;for(var w in y)if(g.call(y,w))return!1;return!0}return bv=_,bv}var xv,SR;function KI(){if(SR)return xv;SR=1;function t(e){return e===void 0}return xv=t,xv}var wv,ER;function ZI(){if(ER)return wv;ER=1;var t=Fd(),e=hi();function n(r,i){var s=-1,o=e(r)?Array(r.length):[];return t(r,function(l,u,d){o[++s]=i(l,u,d)}),o}return wv=n,wv}var Tv,AR;function QI(){if(AR)return Tv;AR=1;var t=zd(),e=pi(),n=ZI(),r=qt();function i(s,o){var l=r(s)?t:n;return l(s,e(o,3))}return Tv=i,Tv}var Sv,RR;function _9(){if(RR)return Sv;RR=1;function t(e,n,r,i){var s=-1,o=e==null?0:e.length;for(i&&o&&(r=e[++s]);++s<o;)r=n(r,e[s],s,e);return r}return Sv=t,Sv}var Ev,CR;function v9(){if(CR)return Ev;CR=1;function t(e,n,r,i,s){return s(e,function(o,l,u){r=i?(i=!1,o):n(r,o,l,u)}),r}return Ev=t,Ev}var Av,NR;function JI(){if(NR)return Av;NR=1;var t=_9(),e=Fd(),n=pi(),r=v9(),i=qt();function s(o,l,u){var d=i(o)?t:r,h=arguments.length<3;return d(o,n(l,4),u,h,e)}return Av=s,Av}var Rv,kR;function y9(){if(kR)return Rv;kR=1;var t=zs(),e=qt(),n=Vr(),r="[object String]";function i(s){return typeof s=="string"||!e(s)&&n(s)&&t(s)==r}return Rv=i,Rv}var Cv,MR;function b9(){if(MR)return Cv;MR=1;var t=XI(),e=t("length");return Cv=e,Cv}var Nv,IR;function x9(){if(IR)return Nv;IR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="\\u200d",l=RegExp("["+o+t+i+s+"]");function u(d){return l.test(d)}return Nv=u,Nv}var kv,OR;function w9(){if(OR)return kv;OR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="["+t+"]",l="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+u+")",h="[^"+t+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",y="\\u200d",T=d+"?",w="["+s+"]?",x="(?:"+y+"(?:"+[h,g,_].join("|")+")"+w+T+")*",S=w+T+x,R="(?:"+[h+l+"?",l,g,_,o].join("|")+")",E=RegExp(u+"(?="+u+")|"+R+S,"g");function A(k){for(var O=E.lastIndex=0;E.test(k);)++O;return O}return kv=A,kv}var Mv,PR;function T9(){if(PR)return Mv;PR=1;var t=b9(),e=x9(),n=w9();function r(i){return e(i)?n(i):t(i)}return Mv=r,Mv}var Iv,DR;function S9(){if(DR)return Iv;DR=1;var t=r1(),e=_o(),n=hi(),r=y9(),i=T9(),s="[object Map]",o="[object Set]";function l(u){if(u==null)return 0;if(n(u))return r(u)?i(u):u.length;var d=e(u);return d==s||d==o?u.size:t(u).length}return Iv=l,Iv}var Ov,jR;function E9(){if(jR)return Ov;jR=1;var t=e1(),e=II(),n=c1(),r=pi(),i=Ud(),s=qt(),o=mo(),l=gc(),u=cr(),d=vc();function h(g,_,y){var T=s(g),w=T||o(g)||d(g);if(_=r(_,4),y==null){var x=g&&g.constructor;w?y=T?new x:[]:u(g)?y=l(x)?e(i(g)):{}:y={}}return(w?t:n)(g,function(S,R,E){return _(y,S,R,E)}),y}return Ov=h,Ov}var Pv,BR;function A9(){if(BR)return Pv;BR=1;var t=go(),e=_c(),n=qt(),r=t?t.isConcatSpreadable:void 0;function i(s){return n(s)||e(s)||!!(r&&s&&s[r])}return Pv=i,Pv}var Dv,LR;function d1(){if(LR)return Dv;LR=1;var t=s1(),e=A9();function n(r,i,s,o,l){var u=-1,d=r.length;for(s||(s=e),l||(l=[]);++u<d;){var h=r[u];i>0&&s(h)?i>1?n(h,i-1,s,o,l):t(l,h):o||(l[l.length]=h)}return l}return Dv=n,Dv}var jv,UR;function R9(){if(UR)return jv;UR=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return jv=t,jv}var Bv,FR;function eO(){if(FR)return Bv;FR=1;var t=R9(),e=Math.max;function n(r,i,s){return i=e(i===void 0?r.length-1:i,0),function(){for(var o=arguments,l=-1,u=e(o.length-i,0),d=Array(u);++l<u;)d[l]=o[i+l];l=-1;for(var h=Array(i+1);++l<i;)h[l]=o[l];return h[i]=s(d),t(r,this,h)}}return Bv=n,Bv}var Lv,zR;function C9(){if(zR)return Lv;zR=1;var t=o1(),e=yI(),n=$s(),r=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(s),writable:!0})}:n;return Lv=r,Lv}var Uv,VR;function N9(){if(VR)return Uv;VR=1;var t=800,e=16,n=Date.now;function r(i){var s=0,o=0;return function(){var l=n(),u=e-(l-o);if(o=l,u>0){if(++s>=t)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return Uv=r,Uv}var Fv,qR;function tO(){if(qR)return Fv;qR=1;var t=C9(),e=N9(),n=e(t);return Fv=n,Fv}var zv,$R;function $d(){if($R)return zv;$R=1;var t=$s(),e=eO(),n=tO();function r(i,s){return n(e(i,s,t),i+"")}return zv=r,zv}var Vv,HR;function nO(){if(HR)return Vv;HR=1;function t(e,n,r,i){for(var s=e.length,o=r+(i?1:-1);i?o--:++o<s;)if(n(e[o],o,e))return o;return-1}return Vv=t,Vv}var qv,WR;function k9(){if(WR)return qv;WR=1;function t(e){return e!==e}return qv=t,qv}var $v,XR;function M9(){if(XR)return $v;XR=1;function t(e,n,r){for(var i=r-1,s=e.length;++i<s;)if(e[i]===n)return i;return-1}return $v=t,$v}var Hv,YR;function I9(){if(YR)return Hv;YR=1;var t=nO(),e=k9(),n=M9();function r(i,s,o){return s===s?n(i,s,o):t(i,e,o)}return Hv=r,Hv}var Wv,GR;function O9(){if(GR)return Wv;GR=1;var t=I9();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return Wv=e,Wv}var Xv,KR;function P9(){if(KR)return Xv;KR=1;function t(e,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(n,e[i]))return!0;return!1}return Xv=t,Xv}var Yv,ZR;function D9(){if(ZR)return Yv;ZR=1;function t(){}return Yv=t,Yv}var Gv,QR;function j9(){if(QR)return Gv;QR=1;var t=NI(),e=D9(),n=u1(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(s){return new t(s)}:e;return Gv=i,Gv}var Kv,JR;function B9(){if(JR)return Kv;JR=1;var t=LI(),e=O9(),n=P9(),r=UI(),i=j9(),s=u1(),o=200;function l(u,d,h){var g=-1,_=e,y=u.length,T=!0,w=[],x=w;if(h)T=!1,_=n;else if(y>=o){var S=d?null:i(u);if(S)return s(S);T=!1,_=r,x=new t}else x=d?[]:w;e:for(;++g<y;){var R=u[g],E=d?d(R):R;if(R=h||R!==0?R:0,T&&E===E){for(var A=x.length;A--;)if(x[A]===E)continue e;d&&x.push(E),w.push(R)}else _(x,E,h)||(x!==w&&x.push(E),w.push(R))}return w}return Kv=l,Kv}var Zv,eC;function rO(){if(eC)return Zv;eC=1;var t=hi(),e=Vr();function n(r){return e(r)&&t(r)}return Zv=n,Zv}var Qv,tC;function L9(){if(tC)return Qv;tC=1;var t=d1(),e=$d(),n=B9(),r=rO(),i=e(function(s){return n(t(s,1,r,!0))});return Qv=i,Qv}var Jv,nC;function U9(){if(nC)return Jv;nC=1;var t=zd();function e(n,r){return t(r,function(i){return n[i]})}return Jv=e,Jv}var ey,rC;function iO(){if(rC)return ey;rC=1;var t=U9(),e=ts();function n(r){return r==null?[]:t(r,e(r))}return ey=n,ey}var ty,iC;function ur(){if(iC)return ty;iC=1;var t;if(typeof Zx=="function")try{t={clone:Wz(),constant:o1(),each:BI(),filter:YI(),has:GI(),isArray:qt(),isEmpty:m9(),isFunction:gc(),isUndefined:KI(),keys:ts(),map:QI(),reduce:JI(),size:S9(),transform:E9(),union:L9(),values:iO()}}catch{}return t||(t=window._),ty=t,ty}var ny,sC;function h1(){if(sC)return ny;sC=1;var t=ur();ny=i;var e="\0",n="\0",r="";function i(h){this._isDirected=t.has(h,"directed")?h.directed:!0,this._isMultigraph=t.has(h,"multigraph")?h.multigraph:!1,this._isCompound=t.has(h,"compound")?h.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(h){return this._label=h,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultNodeLabelFn=h,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._in[g])})},i.prototype.sinks=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._out[g])})},i.prototype.setNodes=function(h,g){var _=arguments,y=this;return t.each(h,function(T){_.length>1?y.setNode(T,g):y.setNode(T)}),this},i.prototype.setNode=function(h,g){return t.has(this._nodes,h)?(arguments.length>1&&(this._nodes[h]=g),this):(this._nodes[h]=arguments.length>1?g:this._defaultNodeLabelFn(h),this._isCompound&&(this._parent[h]=n,this._children[h]={},this._children[n][h]=!0),this._in[h]={},this._preds[h]={},this._out[h]={},this._sucs[h]={},++this._nodeCount,this)},i.prototype.node=function(h){return this._nodes[h]},i.prototype.hasNode=function(h){return t.has(this._nodes,h)},i.prototype.removeNode=function(h){var g=this;if(t.has(this._nodes,h)){var _=function(y){g.removeEdge(g._edgeObjs[y])};delete this._nodes[h],this._isCompound&&(this._removeFromParentsChildList(h),delete this._parent[h],t.each(this.children(h),function(y){g.setParent(y)}),delete this._children[h]),t.each(t.keys(this._in[h]),_),delete this._in[h],delete this._preds[h],t.each(t.keys(this._out[h]),_),delete this._out[h],delete this._sucs[h],--this._nodeCount}return this},i.prototype.setParent=function(h,g){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(g))g=n;else{g+="";for(var _=g;!t.isUndefined(_);_=this.parent(_))if(_===h)throw new Error("Setting "+g+" as parent of "+h+" would create a cycle");this.setNode(g)}return this.setNode(h),this._removeFromParentsChildList(h),this._parent[h]=g,this._children[g][h]=!0,this},i.prototype._removeFromParentsChildList=function(h){delete this._children[this._parent[h]][h]},i.prototype.parent=function(h){if(this._isCompound){var g=this._parent[h];if(g!==n)return g}},i.prototype.children=function(h){if(t.isUndefined(h)&&(h=n),this._isCompound){var g=this._children[h];if(g)return t.keys(g)}else{if(h===n)return this.nodes();if(this.hasNode(h))return[]}},i.prototype.predecessors=function(h){var g=this._preds[h];if(g)return t.keys(g)},i.prototype.successors=function(h){var g=this._sucs[h];if(g)return t.keys(g)},i.prototype.neighbors=function(h){var g=this.predecessors(h);if(g)return t.union(g,this.successors(h))},i.prototype.isLeaf=function(h){var g;return this.isDirected()?g=this.successors(h):g=this.neighbors(h),g.length===0},i.prototype.filterNodes=function(h){var g=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});g.setGraph(this.graph());var _=this;t.each(this._nodes,function(w,x){h(x)&&g.setNode(x,w)}),t.each(this._edgeObjs,function(w){g.hasNode(w.v)&&g.hasNode(w.w)&&g.setEdge(w,_.edge(w))});var y={};function T(w){var x=_.parent(w);return x===void 0||g.hasNode(x)?(y[w]=x,x):x in y?y[x]:T(x)}return this._isCompound&&t.each(g.nodes(),function(w){g.setParent(w,T(w))}),g},i.prototype.setDefaultEdgeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultEdgeLabelFn=h,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(h,g){var _=this,y=arguments;return t.reduce(h,function(T,w){return y.length>1?_.setEdge(T,w,g):_.setEdge(T,w),w}),this},i.prototype.setEdge=function(){var h,g,_,y,T=!1,w=arguments[0];typeof w=="object"&&w!==null&&"v"in w?(h=w.v,g=w.w,_=w.name,arguments.length===2&&(y=arguments[1],T=!0)):(h=w,g=arguments[1],_=arguments[3],arguments.length>2&&(y=arguments[2],T=!0)),h=""+h,g=""+g,t.isUndefined(_)||(_=""+_);var x=l(this._isDirected,h,g,_);if(t.has(this._edgeLabels,x))return T&&(this._edgeLabels[x]=y),this;if(!t.isUndefined(_)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(h),this.setNode(g),this._edgeLabels[x]=T?y:this._defaultEdgeLabelFn(h,g,_);var S=u(this._isDirected,h,g,_);return h=S.v,g=S.w,Object.freeze(S),this._edgeObjs[x]=S,s(this._preds[g],h),s(this._sucs[h],g),this._in[g][x]=S,this._out[h][x]=S,this._edgeCount++,this},i.prototype.edge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return this._edgeLabels[y]},i.prototype.hasEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return t.has(this._edgeLabels,y)},i.prototype.removeEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_),T=this._edgeObjs[y];return T&&(h=T.v,g=T.w,delete this._edgeLabels[y],delete this._edgeObjs[y],o(this._preds[g],h),o(this._sucs[h],g),delete this._in[g][y],delete this._out[h][y],this._edgeCount--),this},i.prototype.inEdges=function(h,g){var _=this._in[h];if(_){var y=t.values(_);return g?t.filter(y,function(T){return T.v===g}):y}},i.prototype.outEdges=function(h,g){var _=this._out[h];if(_){var y=t.values(_);return g?t.filter(y,function(T){return T.w===g}):y}},i.prototype.nodeEdges=function(h,g){var _=this.inEdges(h,g);if(_)return _.concat(this.outEdges(h,g))};function s(h,g){h[g]?h[g]++:h[g]=1}function o(h,g){--h[g]||delete h[g]}function l(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}return T+r+w+r+(t.isUndefined(y)?e:y)}function u(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}var S={v:T,w};return y&&(S.name=y),S}function d(h,g){return l(h,g.v,g.w,g.name)}return ny}var ry,aC;function F9(){return aC||(aC=1,ry="2.1.8"),ry}var iy,oC;function z9(){return oC||(oC=1,iy={Graph:h1(),version:F9()}),iy}var sy,lC;function V9(){if(lC)return sy;lC=1;var t=ur(),e=h1();sy={write:n,read:s};function n(o){var l={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:i(o)};return t.isUndefined(o.graph())||(l.value=t.clone(o.graph())),l}function r(o){return t.map(o.nodes(),function(l){var u=o.node(l),d=o.parent(l),h={v:l};return t.isUndefined(u)||(h.value=u),t.isUndefined(d)||(h.parent=d),h})}function i(o){return t.map(o.edges(),function(l){var u=o.edge(l),d={v:l.v,w:l.w};return t.isUndefined(l.name)||(d.name=l.name),t.isUndefined(u)||(d.value=u),d})}function s(o){var l=new e(o.options).setGraph(o.value);return t.each(o.nodes,function(u){l.setNode(u.v,u.value),u.parent&&l.setParent(u.v,u.parent)}),t.each(o.edges,function(u){l.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),l}return sy}var ay,cC;function q9(){if(cC)return ay;cC=1;var t=ur();ay=e;function e(n){var r={},i=[],s;function o(l){t.has(r,l)||(r[l]=!0,s.push(l),t.each(n.successors(l),o),t.each(n.predecessors(l),o))}return t.each(n.nodes(),function(l){s=[],o(l),s.length&&i.push(s)}),i}return ay}var oy,uC;function sO(){if(uC)return oy;uC=1;var t=ur();oy=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var i=this._keyIndices;if(n=String(n),!t.has(i,n)){var s=this._arr,o=s.length;return i[n]=o,s.push({key:n,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var i=this._keyIndices[n];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(n){var r=this._arr,i=2*n,s=i+1,o=n;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==n&&(this._swap(n,o),this._heapify(o)))},e.prototype._decrease=function(n){for(var r=this._arr,i=r[n].priority,s;n!==0&&(s=n>>1,!(r[s].priority<i));)this._swap(n,s),n=s},e.prototype._swap=function(n,r){var i=this._arr,s=this._keyIndices,o=i[n],l=i[r];i[n]=l,i[r]=o,s[l.key]=n,s[o.key]=r},oy}var ly,fC;function aO(){if(fC)return ly;fC=1;var t=ur(),e=sO();ly=r;var n=t.constant(1);function r(s,o,l,u){return i(s,String(o),l||n,u||function(d){return s.outEdges(d)})}function i(s,o,l,u){var d={},h=new e,g,_,y=function(T){var w=T.v!==g?T.v:T.w,x=d[w],S=l(T),R=_.distance+S;if(S<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+T+" Weight: "+S);R<x.distance&&(x.distance=R,x.predecessor=g,h.decrease(w,R))};for(s.nodes().forEach(function(T){var w=T===o?0:Number.POSITIVE_INFINITY;d[T]={distance:w},h.add(T,w)});h.size()>0&&(g=h.removeMin(),_=d[g],_.distance!==Number.POSITIVE_INFINITY);)u(g).forEach(y);return d}return ly}var cy,dC;function $9(){if(dC)return cy;dC=1;var t=aO(),e=ur();cy=n;function n(r,i,s){return e.transform(r.nodes(),function(o,l){o[l]=t(r,l,i,s)},{})}return cy}var uy,hC;function oO(){if(hC)return uy;hC=1;var t=ur();uy=e;function e(n){var r=0,i=[],s={},o=[];function l(u){var d=s[u]={onStack:!0,lowlink:r,index:r++};if(i.push(u),n.successors(u).forEach(function(_){t.has(s,_)?s[_].onStack&&(d.lowlink=Math.min(d.lowlink,s[_].index)):(l(_),d.lowlink=Math.min(d.lowlink,s[_].lowlink))}),d.lowlink===d.index){var h=[],g;do g=i.pop(),s[g].onStack=!1,h.push(g);while(u!==g);o.push(h)}}return n.nodes().forEach(function(u){t.has(s,u)||l(u)}),o}return uy}var fy,pC;function H9(){if(pC)return fy;pC=1;var t=ur(),e=oO();fy=n;function n(r){return t.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return fy}var dy,gC;function W9(){if(gC)return dy;gC=1;var t=ur();dy=n;var e=t.constant(1);function n(i,s,o){return r(i,s||e,o||function(l){return i.outEdges(l)})}function r(i,s,o){var l={},u=i.nodes();return u.forEach(function(d){l[d]={},l[d][d]={distance:0},u.forEach(function(h){d!==h&&(l[d][h]={distance:Number.POSITIVE_INFINITY})}),o(d).forEach(function(h){var g=h.v===d?h.w:h.v,_=s(h);l[d][g]={distance:_,predecessor:d}})}),u.forEach(function(d){var h=l[d];u.forEach(function(g){var _=l[g];u.forEach(function(y){var T=_[d],w=h[y],x=_[y],S=T.distance+w.distance;S<x.distance&&(x.distance=S,x.predecessor=w.predecessor)})})}),l}return dy}var hy,mC;function lO(){if(mC)return hy;mC=1;var t=ur();hy=e,e.CycleException=n;function e(r){var i={},s={},o=[];function l(u){if(t.has(s,u))throw new n;t.has(i,u)||(s[u]=!0,i[u]=!0,t.each(r.predecessors(u),l),delete s[u],o.push(u))}if(t.each(r.sinks(),l),t.size(i)!==r.nodeCount())throw new n;return o}function n(){}return n.prototype=new Error,hy}var py,_C;function X9(){if(_C)return py;_C=1;var t=lO();py=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return py}var gy,vC;function cO(){if(vC)return gy;vC=1;var t=ur();gy=e;function e(r,i,s){t.isArray(i)||(i=[i]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),l=[],u={};return t.each(i,function(d){if(!r.hasNode(d))throw new Error("Graph does not have node: "+d);n(r,d,s==="post",u,o,l)}),l}function n(r,i,s,o,l,u){t.has(o,i)||(o[i]=!0,s||u.push(i),t.each(l(i),function(d){n(r,d,s,o,l,u)}),s&&u.push(i))}return gy}var my,yC;function Y9(){if(yC)return my;yC=1;var t=cO();my=e;function e(n,r){return t(n,r,"post")}return my}var _y,bC;function G9(){if(bC)return _y;bC=1;var t=cO();_y=e;function e(n,r){return t(n,r,"pre")}return _y}var vy,xC;function K9(){if(xC)return vy;xC=1;var t=ur(),e=h1(),n=sO();vy=r;function r(i,s){var o=new e,l={},u=new n,d;function h(_){var y=_.v===d?_.w:_.v,T=u.priority(y);if(T!==void 0){var w=s(_);w<T&&(l[y]=d,u.decrease(y,w))}}if(i.nodeCount()===0)return o;t.each(i.nodes(),function(_){u.add(_,Number.POSITIVE_INFINITY),o.setNode(_)}),u.decrease(i.nodes()[0],0);for(var g=!1;u.size()>0;){if(d=u.removeMin(),t.has(l,d))o.setEdge(d,l[d]);else{if(g)throw new Error("Input graph is not connected: "+i);g=!0}i.nodeEdges(d).forEach(h)}return o}return vy}var yy,wC;function Z9(){return wC||(wC=1,yy={components:q9(),dijkstra:aO(),dijkstraAll:$9(),findCycles:H9(),floydWarshall:W9(),isAcyclic:X9(),postorder:Y9(),preorder:G9(),prim:K9(),tarjan:oO(),topsort:lO()}),yy}var by,TC;function Q9(){if(TC)return by;TC=1;var t=z9();return by={Graph:t.Graph,json:V9(),alg:Z9(),version:t.version},by}var xy,SC;function wr(){if(SC)return xy;SC=1;var t;if(typeof Zx=="function")try{t=Q9()}catch{}return t||(t=window.graphlib),xy=t,xy}var wy,EC;function J9(){if(EC)return wy;EC=1;var t=PI(),e=1,n=4;function r(i){return t(i,e|n)}return wy=r,wy}var Ty,AC;function Hd(){if(AC)return Ty;AC=1;var t=po(),e=hi(),n=jd(),r=cr();function i(s,o,l){if(!r(l))return!1;var u=typeof o;return(u=="number"?e(l)&&n(o,l.length):u=="string"&&o in l)?t(l[o],s):!1}return Ty=i,Ty}var Sy,RC;function e7(){if(RC)return Sy;RC=1;var t=$d(),e=po(),n=Hd(),r=qs(),i=Object.prototype,s=i.hasOwnProperty,o=t(function(l,u){l=Object(l);var d=-1,h=u.length,g=h>2?u[2]:void 0;for(g&&n(u[0],u[1],g)&&(h=1);++d<h;)for(var _=u[d],y=r(_),T=-1,w=y.length;++T<w;){var x=y[T],S=l[x];(S===void 0||e(S,i[x])&&!s.call(l,x))&&(l[x]=_[x])}return l});return Sy=o,Sy}var Ey,CC;function t7(){if(CC)return Ey;CC=1;var t=pi(),e=hi(),n=ts();function r(i){return function(s,o,l){var u=Object(s);if(!e(s)){var d=t(o,3);s=n(s),o=function(g){return d(u[g],g,u)}}var h=i(s,o,l);return h>-1?u[d?s[h]:h]:void 0}}return Ey=r,Ey}var Ay,NC;function n7(){if(NC)return Ay;NC=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return Ay=e,Ay}var Ry,kC;function r7(){if(kC)return Ry;kC=1;var t=n7(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return Ry=n,Ry}var Cy,MC;function i7(){if(MC)return Cy;MC=1;var t=r7(),e=cr(),n=vo(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(n(d))return r;if(e(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=e(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=t(d);var g=s.test(d);return g||o.test(d)?l(d.slice(2),g?2:8):i.test(d)?r:+d}return Cy=u,Cy}var Ny,IC;function uO(){if(IC)return Ny;IC=1;var t=i7(),e=1/0,n=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-1/0){var s=i<0?-1:1;return s*n}return i===i?i:0}return Ny=r,Ny}var ky,OC;function s7(){if(OC)return ky;OC=1;var t=uO();function e(n){var r=t(n),i=r%1;return r===r?i?r-i:r:0}return ky=e,ky}var My,PC;function a7(){if(PC)return My;PC=1;var t=nO(),e=pi(),n=s7(),r=Math.max;function i(s,o,l){var u=s==null?0:s.length;if(!u)return-1;var d=l==null?0:n(l);return d<0&&(d=r(u+d,0)),t(s,e(o,3),d)}return My=i,My}var Iy,DC;function o7(){if(DC)return Iy;DC=1;var t=t7(),e=a7(),n=t(e);return Iy=n,Iy}var Oy,jC;function fO(){if(jC)return Oy;jC=1;var t=d1();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return Oy=e,Oy}var Py,BC;function l7(){if(BC)return Py;BC=1;var t=l1(),e=DI(),n=qs();function r(i,s){return i==null?i:t(i,e(s),n)}return Py=r,Py}var Dy,LC;function c7(){if(LC)return Dy;LC=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return Dy=t,Dy}var jy,UC;function u7(){if(UC)return jy;UC=1;var t=Pd(),e=c1(),n=pi();function r(i,s){var o={};return s=n(s,3),e(i,function(l,u,d){t(o,u,s(l,u,d))}),o}return jy=r,jy}var By,FC;function p1(){if(FC)return By;FC=1;var t=vo();function e(n,r,i){for(var s=-1,o=n.length;++s<o;){var l=n[s],u=r(l);if(u!=null&&(d===void 0?u===u&&!t(u):i(u,d)))var d=u,h=l}return h}return By=e,By}var Ly,zC;function f7(){if(zC)return Ly;zC=1;function t(e,n){return e>n}return Ly=t,Ly}var Uy,VC;function d7(){if(VC)return Uy;VC=1;var t=p1(),e=f7(),n=$s();function r(i){return i&&i.length?t(i,n,e):void 0}return Uy=r,Uy}var Fy,qC;function dO(){if(qC)return Fy;qC=1;var t=Pd(),e=po();function n(r,i,s){(s!==void 0&&!e(r[i],s)||s===void 0&&!(i in r))&&t(r,i,s)}return Fy=n,Fy}var zy,$C;function h7(){if($C)return zy;$C=1;var t=zs(),e=Ud(),n=Vr(),r="[object Object]",i=Function.prototype,s=Object.prototype,o=i.toString,l=s.hasOwnProperty,u=o.call(Object);function d(h){if(!n(h)||t(h)!=r)return!1;var g=e(h);if(g===null)return!0;var _=l.call(g,"constructor")&&g.constructor;return typeof _=="function"&&_ instanceof _&&o.call(_)==u}return zy=d,zy}var Vy,HC;function hO(){if(HC)return Vy;HC=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return Vy=t,Vy}var qy,WC;function p7(){if(WC)return qy;WC=1;var t=mc(),e=qs();function n(r){return t(r,e(r))}return qy=n,qy}var $y,XC;function g7(){if(XC)return $y;XC=1;var t=dO(),e=wI(),n=MI(),r=TI(),i=OI(),s=_c(),o=qt(),l=rO(),u=mo(),d=gc(),h=cr(),g=h7(),_=vc(),y=hO(),T=p7();function w(x,S,R,E,A,k,O){var j=y(x,R),N=y(S,R),I=O.get(N);if(I){t(x,R,I);return}var M=k?k(j,N,R+"",x,S,O):void 0,q=M===void 0;if(q){var X=o(N),G=!X&&u(N),L=!X&&!G&&_(N);M=N,X||G||L?o(j)?M=j:l(j)?M=r(j):G?(q=!1,M=e(N,!0)):L?(q=!1,M=n(N,!0)):M=[]:g(N)||s(N)?(M=j,s(j)?M=T(j):(!h(j)||d(j))&&(M=i(N))):q=!1}q&&(O.set(N,M),A(M,N,E,k,O),O.delete(N)),t(x,R,M)}return $y=w,$y}var Hy,YC;function m7(){if(YC)return Hy;YC=1;var t=Od(),e=dO(),n=l1(),r=g7(),i=cr(),s=qs(),o=hO();function l(u,d,h,g,_){u!==d&&n(d,function(y,T){if(_||(_=new t),i(y))r(u,d,T,h,l,g,_);else{var w=g?g(o(u,T),y,T+"",u,d,_):void 0;w===void 0&&(w=y),e(u,T,w)}},s)}return Hy=l,Hy}var Wy,GC;function _7(){if(GC)return Wy;GC=1;var t=$d(),e=Hd();function n(r){return t(function(i,s){var o=-1,l=s.length,u=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(s[0],s[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++o<l;){var h=s[o];h&&r(i,h,o,u)}return i})}return Wy=n,Wy}var Xy,KC;function v7(){if(KC)return Xy;KC=1;var t=m7(),e=_7(),n=e(function(r,i,s){t(r,i,s)});return Xy=n,Xy}var Yy,ZC;function pO(){if(ZC)return Yy;ZC=1;function t(e,n){return e<n}return Yy=t,Yy}var Gy,QC;function y7(){if(QC)return Gy;QC=1;var t=p1(),e=pO(),n=$s();function r(i){return i&&i.length?t(i,n,e):void 0}return Gy=r,Gy}var Ky,JC;function b7(){if(JC)return Ky;JC=1;var t=p1(),e=pi(),n=pO();function r(i,s){return i&&i.length?t(i,e(s,2),n):void 0}return Ky=r,Ky}var Zy,eN;function x7(){if(eN)return Zy;eN=1;var t=Er(),e=function(){return t.Date.now()};return Zy=e,Zy}var Qy,tN;function w7(){if(tN)return Qy;tN=1;var t=Dd(),e=Vd(),n=jd(),r=cr(),i=yc();function s(o,l,u,d){if(!r(o))return o;l=e(l,o);for(var h=-1,g=l.length,_=g-1,y=o;y!=null&&++h<g;){var T=i(l[h]),w=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(h!=_){var x=y[T];w=d?d(x,T,y):void 0,w===void 0&&(w=r(x)?x:n(l[h+1])?[]:{})}t(y,T,w),y=y[T]}return o}return Qy=s,Qy}var Jy,nN;function T7(){if(nN)return Jy;nN=1;var t=qd(),e=w7(),n=Vd();function r(i,s,o){for(var l=-1,u=s.length,d={};++l<u;){var h=s[l],g=t(i,h);o(g,h)&&e(d,n(h,i),g)}return d}return Jy=r,Jy}var eb,rN;function S7(){if(rN)return eb;rN=1;var t=T7(),e=WI();function n(r,i){return t(r,i,function(s,o){return e(r,o)})}return eb=n,eb}var tb,iN;function E7(){if(iN)return tb;iN=1;var t=fO(),e=eO(),n=tO();function r(i){return n(e(i,void 0,t),i+"")}return tb=r,tb}var nb,sN;function A7(){if(sN)return nb;sN=1;var t=S7(),e=E7(),n=e(function(r,i){return r==null?{}:t(r,i)});return nb=n,nb}var rb,aN;function R7(){if(aN)return rb;aN=1;var t=Math.ceil,e=Math.max;function n(r,i,s,o){for(var l=-1,u=e(t((i-r)/(s||1)),0),d=Array(u);u--;)d[o?u:++l]=r,r+=s;return d}return rb=n,rb}var ib,oN;function C7(){if(oN)return ib;oN=1;var t=R7(),e=Hd(),n=uO();function r(i){return function(s,o,l){return l&&typeof l!="number"&&e(s,o,l)&&(o=l=void 0),s=n(s),o===void 0?(o=s,s=0):o=n(o),l=l===void 0?s<o?1:-1:n(l),t(s,o,l,i)}}return ib=r,ib}var sb,lN;function N7(){if(lN)return sb;lN=1;var t=C7(),e=t();return sb=e,sb}var ab,cN;function k7(){if(cN)return ab;cN=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return ab=t,ab}var ob,uN;function M7(){if(uN)return ob;uN=1;var t=vo();function e(n,r){if(n!==r){var i=n!==void 0,s=n===null,o=n===n,l=t(n),u=r!==void 0,d=r===null,h=r===r,g=t(r);if(!d&&!g&&!l&&n>r||l&&u&&h&&!d&&!g||s&&u&&h||!i&&h||!o)return 1;if(!s&&!l&&!g&&n<r||g&&i&&o&&!s&&!l||d&&i&&o||!u&&o||!h)return-1}return 0}return ob=e,ob}var lb,fN;function I7(){if(fN)return lb;fN=1;var t=M7();function e(n,r,i){for(var s=-1,o=n.criteria,l=r.criteria,u=o.length,d=i.length;++s<u;){var h=t(o[s],l[s]);if(h){if(s>=d)return h;var g=i[s];return h*(g=="desc"?-1:1)}}return n.index-r.index}return lb=e,lb}var cb,dN;function O7(){if(dN)return cb;dN=1;var t=zd(),e=qd(),n=pi(),r=ZI(),i=k7(),s=Bd(),o=I7(),l=$s(),u=qt();function d(h,g,_){g.length?g=t(g,function(w){return u(w)?function(x){return e(x,w.length===1?w[0]:w)}:w}):g=[l];var y=-1;g=t(g,s(n));var T=r(h,function(w,x,S){var R=t(g,function(E){return E(w)});return{criteria:R,index:++y,value:w}});return i(T,function(w,x){return o(w,x,_)})}return cb=d,cb}var ub,hN;function P7(){if(hN)return ub;hN=1;var t=d1(),e=O7(),n=$d(),r=Hd(),i=n(function(s,o){if(s==null)return[];var l=o.length;return l>1&&r(s,o[0],o[1])?o=[]:l>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(s,t(o,1),[])});return ub=i,ub}var fb,pN;function D7(){if(pN)return fb;pN=1;var t=$I(),e=0;function n(r){var i=++e;return t(r)+i}return fb=n,fb}var db,gN;function j7(){if(gN)return db;gN=1;function t(e,n,r){for(var i=-1,s=e.length,o=n.length,l={};++i<s;){var u=i<o?n[i]:void 0;r(l,e[i],u)}return l}return db=t,db}var hb,mN;function B7(){if(mN)return hb;mN=1;var t=Dd(),e=j7();function n(r,i){return e(r||[],i||[],t)}return hb=n,hb}var pb,_N;function Tt(){if(_N)return pb;_N=1;var t;if(typeof Zx=="function")try{t={cloneDeep:J9(),constant:o1(),defaults:e7(),each:BI(),filter:YI(),find:o7(),flatten:fO(),forEach:jI(),forIn:l7(),has:GI(),isUndefined:KI(),last:c7(),map:QI(),mapValues:u7(),max:d7(),merge:v7(),min:y7(),minBy:b7(),now:x7(),pick:A7(),range:N7(),reduce:JI(),sortBy:P7(),uniqueId:D7(),values:iO(),zipObject:B7()}}catch{}return t||(t=window._),pb=t,pb}var gb,vN;function L7(){if(vN)return gb;vN=1,gb=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},t.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},t.prototype.toString=function(){for(var r=[],i=this._sentinel,s=i._prev;s!==i;)r.push(JSON.stringify(s,n)),s=s._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,i){if(r!=="_next"&&r!=="_prev")return i}return gb}var mb,yN;function U7(){if(yN)return mb;yN=1;var t=Tt(),e=wr().Graph,n=L7();mb=i;var r=t.constant(1);function i(d,h){if(d.nodeCount()<=1)return[];var g=l(d,h||r),_=s(g.graph,g.buckets,g.zeroIdx);return t.flatten(t.map(_,function(y){return d.outEdges(y.v,y.w)}),!0)}function s(d,h,g){for(var _=[],y=h[h.length-1],T=h[0],w;d.nodeCount();){for(;w=T.dequeue();)o(d,h,g,w);for(;w=y.dequeue();)o(d,h,g,w);if(d.nodeCount()){for(var x=h.length-2;x>0;--x)if(w=h[x].dequeue(),w){_=_.concat(o(d,h,g,w,!0));break}}}return _}function o(d,h,g,_,y){var T=y?[]:void 0;return t.forEach(d.inEdges(_.v),function(w){var x=d.edge(w),S=d.node(w.v);y&&T.push({v:w.v,w:w.w}),S.out-=x,u(h,g,S)}),t.forEach(d.outEdges(_.v),function(w){var x=d.edge(w),S=w.w,R=d.node(S);R.in-=x,u(h,g,R)}),d.removeNode(_.v),T}function l(d,h){var g=new e,_=0,y=0;t.forEach(d.nodes(),function(x){g.setNode(x,{v:x,in:0,out:0})}),t.forEach(d.edges(),function(x){var S=g.edge(x.v,x.w)||0,R=h(x),E=S+R;g.setEdge(x.v,x.w,E),y=Math.max(y,g.node(x.v).out+=R),_=Math.max(_,g.node(x.w).in+=R)});var T=t.range(y+_+3).map(function(){return new n}),w=_+1;return t.forEach(g.nodes(),function(x){u(T,w,g.node(x))}),{graph:g,buckets:T,zeroIdx:w}}function u(d,h,g){g.out?g.in?d[g.out-g.in+h].enqueue(g):d[d.length-1].enqueue(g):d[0].enqueue(g)}return mb}var _b,bN;function F7(){if(bN)return _b;bN=1;var t=Tt(),e=U7();_b={run:n,undo:i};function n(s){var o=s.graph().acyclicer==="greedy"?e(s,l(s)):r(s);t.forEach(o,function(u){var d=s.edge(u);s.removeEdge(u),d.forwardName=u.name,d.reversed=!0,s.setEdge(u.w,u.v,d,t.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(s){var o=[],l={},u={};function d(h){t.has(u,h)||(u[h]=!0,l[h]=!0,t.forEach(s.outEdges(h),function(g){t.has(l,g.w)?o.push(g):d(g.w)}),delete l[h])}return t.forEach(s.nodes(),d),o}function i(s){t.forEach(s.edges(),function(o){var l=s.edge(o);if(l.reversed){s.removeEdge(o);var u=l.forwardName;delete l.reversed,delete l.forwardName,s.setEdge(o.w,o.v,l,u)}})}return _b}var vb,xN;function In(){if(xN)return vb;xN=1;var t=Tt(),e=wr().Graph;vb={addDummyNode:n,simplify:r,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:o,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:h,addBorderNode:g,maxRank:_,partition:y,time:T,notime:w};function n(x,S,R,E){var A;do A=t.uniqueId(E);while(x.hasNode(A));return R.dummy=S,x.setNode(A,R),A}function r(x){var S=new e().setGraph(x.graph());return t.forEach(x.nodes(),function(R){S.setNode(R,x.node(R))}),t.forEach(x.edges(),function(R){var E=S.edge(R.v,R.w)||{weight:0,minlen:1},A=x.edge(R);S.setEdge(R.v,R.w,{weight:E.weight+A.weight,minlen:Math.max(E.minlen,A.minlen)})}),S}function i(x){var S=new e({multigraph:x.isMultigraph()}).setGraph(x.graph());return t.forEach(x.nodes(),function(R){x.children(R).length||S.setNode(R,x.node(R))}),t.forEach(x.edges(),function(R){S.setEdge(R,x.edge(R))}),S}function s(x){var S=t.map(x.nodes(),function(R){var E={};return t.forEach(x.outEdges(R),function(A){E[A.w]=(E[A.w]||0)+x.edge(A).weight}),E});return t.zipObject(x.nodes(),S)}function o(x){var S=t.map(x.nodes(),function(R){var E={};return t.forEach(x.inEdges(R),function(A){E[A.v]=(E[A.v]||0)+x.edge(A).weight}),E});return t.zipObject(x.nodes(),S)}function l(x,S){var R=x.x,E=x.y,A=S.x-R,k=S.y-E,O=x.width/2,j=x.height/2;if(!A&&!k)throw new Error("Not possible to find intersection inside of the rectangle");var N,I;return Math.abs(k)*O>Math.abs(A)*j?(k<0&&(j=-j),N=j*A/k,I=j):(A<0&&(O=-O),N=O,I=O*k/A),{x:R+N,y:E+I}}function u(x){var S=t.map(t.range(_(x)+1),function(){return[]});return t.forEach(x.nodes(),function(R){var E=x.node(R),A=E.rank;t.isUndefined(A)||(S[A][E.order]=R)}),S}function d(x){var S=t.min(t.map(x.nodes(),function(R){return x.node(R).rank}));t.forEach(x.nodes(),function(R){var E=x.node(R);t.has(E,"rank")&&(E.rank-=S)})}function h(x){var S=t.min(t.map(x.nodes(),function(k){return x.node(k).rank})),R=[];t.forEach(x.nodes(),function(k){var O=x.node(k).rank-S;R[O]||(R[O]=[]),R[O].push(k)});var E=0,A=x.graph().nodeRankFactor;t.forEach(R,function(k,O){t.isUndefined(k)&&O%A!==0?--E:E&&t.forEach(k,function(j){x.node(j).rank+=E})})}function g(x,S,R,E){var A={width:0,height:0};return arguments.length>=4&&(A.rank=R,A.order=E),n(x,"border",A,S)}function _(x){return t.max(t.map(x.nodes(),function(S){var R=x.node(S).rank;if(!t.isUndefined(R))return R}))}function y(x,S){var R={lhs:[],rhs:[]};return t.forEach(x,function(E){S(E)?R.lhs.push(E):R.rhs.push(E)}),R}function T(x,S){var R=t.now();try{return S()}finally{console.log(x+" time: "+(t.now()-R)+"ms")}}function w(x,S){return S()}return vb}var yb,wN;function z7(){if(wN)return yb;wN=1;var t=Tt(),e=In();yb={run:n,undo:i};function n(s){s.graph().dummyChains=[],t.forEach(s.edges(),function(o){r(s,o)})}function r(s,o){var l=o.v,u=s.node(l).rank,d=o.w,h=s.node(d).rank,g=o.name,_=s.edge(o),y=_.labelRank;if(h!==u+1){s.removeEdge(o);var T,w,x;for(x=0,++u;u<h;++x,++u)_.points=[],w={width:0,height:0,edgeLabel:_,edgeObj:o,rank:u},T=e.addDummyNode(s,"edge",w,"_d"),u===y&&(w.width=_.width,w.height=_.height,w.dummy="edge-label",w.labelpos=_.labelpos),s.setEdge(l,T,{weight:_.weight},g),x===0&&s.graph().dummyChains.push(T),l=T;s.setEdge(l,d,{weight:_.weight},g)}}function i(s){t.forEach(s.graph().dummyChains,function(o){var l=s.node(o),u=l.edgeLabel,d;for(s.setEdge(l.edgeObj,u);l.dummy;)d=s.successors(o)[0],s.removeNode(o),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),o=d,l=s.node(o)})}return yb}var bb,TN;function Rf(){if(TN)return bb;TN=1;var t=Tt();bb={longestPath:e,slack:n};function e(r){var i={};function s(o){var l=r.node(o);if(t.has(i,o))return l.rank;i[o]=!0;var u=t.min(t.map(r.outEdges(o),function(d){return s(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}t.forEach(r.sources(),s)}function n(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return bb}var xb,SN;function gO(){if(SN)return xb;SN=1;var t=Tt(),e=wr().Graph,n=Rf().slack;xb=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],h=l.nodeCount();u.setNode(d,{});for(var g,_;i(u,l)<h;)g=s(u,l),_=u.hasNode(g.v)?n(l,g):-n(l,g),o(u,l,_);return u}function i(l,u){function d(h){t.forEach(u.nodeEdges(h),function(g){var _=g.v,y=h===_?g.w:_;!l.hasNode(y)&&!n(u,g)&&(l.setNode(y,{}),l.setEdge(h,y,{}),d(y))})}return t.forEach(l.nodes(),d),l.nodeCount()}function s(l,u){return t.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return n(u,d)})}function o(l,u,d){t.forEach(l.nodes(),function(h){u.node(h).rank+=d})}return xb}var wb,EN;function V7(){if(EN)return wb;EN=1;var t=Tt(),e=gO(),n=Rf().slack,r=Rf().longestPath,i=wr().alg.preorder,s=wr().alg.postorder,o=In().simplify;wb=l,l.initLowLimValues=g,l.initCutValues=u,l.calcCutValue=h,l.leaveEdge=y,l.enterEdge=T,l.exchangeEdges=w;function l(E){E=o(E),r(E);var A=e(E);g(A),u(A,E);for(var k,O;k=y(A);)O=T(A,E,k),w(A,E,k,O)}function u(E,A){var k=s(E,E.nodes());k=k.slice(0,k.length-1),t.forEach(k,function(O){d(E,A,O)})}function d(E,A,k){var O=E.node(k),j=O.parent;E.edge(k,j).cutvalue=h(E,A,k)}function h(E,A,k){var O=E.node(k),j=O.parent,N=!0,I=A.edge(k,j),M=0;return I||(N=!1,I=A.edge(j,k)),M=I.weight,t.forEach(A.nodeEdges(k),function(q){var X=q.v===k,G=X?q.w:q.v;if(G!==j){var L=X===N,J=A.edge(q).weight;if(M+=L?J:-J,S(E,k,G)){var V=E.edge(k,G).cutvalue;M+=L?-V:V}}}),M}function g(E,A){arguments.length<2&&(A=E.nodes()[0]),_(E,{},1,A)}function _(E,A,k,O,j){var N=k,I=E.node(O);return A[O]=!0,t.forEach(E.neighbors(O),function(M){t.has(A,M)||(k=_(E,A,k,M,O))}),I.low=N,I.lim=k++,j?I.parent=j:delete I.parent,k}function y(E){return t.find(E.edges(),function(A){return E.edge(A).cutvalue<0})}function T(E,A,k){var O=k.v,j=k.w;A.hasEdge(O,j)||(O=k.w,j=k.v);var N=E.node(O),I=E.node(j),M=N,q=!1;N.lim>I.lim&&(M=I,q=!0);var X=t.filter(A.edges(),function(G){return q===R(E,E.node(G.v),M)&&q!==R(E,E.node(G.w),M)});return t.minBy(X,function(G){return n(A,G)})}function w(E,A,k,O){var j=k.v,N=k.w;E.removeEdge(j,N),E.setEdge(O.v,O.w,{}),g(E),u(E,A),x(E,A)}function x(E,A){var k=t.find(E.nodes(),function(j){return!A.node(j).parent}),O=i(E,k);O=O.slice(1),t.forEach(O,function(j){var N=E.node(j).parent,I=A.edge(j,N),M=!1;I||(I=A.edge(N,j),M=!0),A.node(j).rank=A.node(N).rank+(M?I.minlen:-I.minlen)})}function S(E,A,k){return E.hasEdge(A,k)}function R(E,A,k){return k.low<=A.lim&&A.lim<=k.lim}return wb}var Tb,AN;function q7(){if(AN)return Tb;AN=1;var t=Rf(),e=t.longestPath,n=gO(),r=V7();Tb=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":o(u);break;case"longest-path":s(u);break;default:l(u)}}var s=e;function o(u){e(u),n(u)}function l(u){r(u)}return Tb}var Sb,RN;function $7(){if(RN)return Sb;RN=1;var t=Tt();Sb=e;function e(i){var s=r(i);t.forEach(i.graph().dummyChains,function(o){for(var l=i.node(o),u=l.edgeObj,d=n(i,s,u.v,u.w),h=d.path,g=d.lca,_=0,y=h[_],T=!0;o!==u.w;){if(l=i.node(o),T){for(;(y=h[_])!==g&&i.node(y).maxRank<l.rank;)_++;y===g&&(T=!1)}if(!T){for(;_<h.length-1&&i.node(y=h[_+1]).minRank<=l.rank;)_++;y=h[_]}i.setParent(o,y),o=i.successors(o)[0]}})}function n(i,s,o,l){var u=[],d=[],h=Math.min(s[o].low,s[l].low),g=Math.max(s[o].lim,s[l].lim),_,y;_=o;do _=i.parent(_),u.push(_);while(_&&(s[_].low>h||g>s[_].lim));for(y=_,_=l;(_=i.parent(_))!==y;)d.push(_);return{path:u.concat(d.reverse()),lca:y}}function r(i){var s={},o=0;function l(u){var d=o;t.forEach(i.children(u),l),s[u]={low:d,lim:o++}}return t.forEach(i.children(),l),s}return Sb}var Eb,CN;function H7(){if(CN)return Eb;CN=1;var t=Tt(),e=In();Eb={run:n,cleanup:o};function n(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),h=t.max(t.values(d))-1,g=2*h+1;l.graph().nestingRoot=u,t.forEach(l.edges(),function(y){l.edge(y).minlen*=g});var _=s(l)+1;t.forEach(l.children(),function(y){r(l,u,g,_,h,d,y)}),l.graph().nodeRankFactor=g}function r(l,u,d,h,g,_,y){var T=l.children(y);if(!T.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var w=e.addBorderNode(l,"_bt"),x=e.addBorderNode(l,"_bb"),S=l.node(y);l.setParent(w,y),S.borderTop=w,l.setParent(x,y),S.borderBottom=x,t.forEach(T,function(R){r(l,u,d,h,g,_,R);var E=l.node(R),A=E.borderTop?E.borderTop:R,k=E.borderBottom?E.borderBottom:R,O=E.borderTop?h:2*h,j=A!==k?1:g-_[y]+1;l.setEdge(w,A,{weight:O,minlen:j,nestingEdge:!0}),l.setEdge(k,x,{weight:O,minlen:j,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,w,{weight:0,minlen:g+_[y]})}function i(l){var u={};function d(h,g){var _=l.children(h);_&&_.length&&t.forEach(_,function(y){d(y,g+1)}),u[h]=g}return t.forEach(l.children(),function(h){d(h,1)}),u}function s(l){return t.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function o(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,t.forEach(l.edges(),function(d){var h=l.edge(d);h.nestingEdge&&l.removeEdge(d)})}return Eb}var Ab,NN;function W7(){if(NN)return Ab;NN=1;var t=Tt(),e=In();Ab=n;function n(i){function s(o){var l=i.children(o),u=i.node(o);if(l.length&&t.forEach(l,s),t.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,h=u.maxRank+1;d<h;++d)r(i,"borderLeft","_bl",o,u,d),r(i,"borderRight","_br",o,u,d)}}t.forEach(i.children(),s)}function r(i,s,o,l,u,d){var h={width:0,height:0,rank:d,borderType:s},g=u[s][d-1],_=e.addDummyNode(i,"border",h,o);u[s][d]=_,i.setParent(_,l),g&&i.setEdge(g,_,{weight:1})}return Ab}var Rb,kN;function X7(){if(kN)return Rb;kN=1;var t=Tt();Rb={adjust:e,undo:n};function e(d){var h=d.graph().rankdir.toLowerCase();(h==="lr"||h==="rl")&&r(d)}function n(d){var h=d.graph().rankdir.toLowerCase();(h==="bt"||h==="rl")&&s(d),(h==="lr"||h==="rl")&&(l(d),r(d))}function r(d){t.forEach(d.nodes(),function(h){i(d.node(h))}),t.forEach(d.edges(),function(h){i(d.edge(h))})}function i(d){var h=d.width;d.width=d.height,d.height=h}function s(d){t.forEach(d.nodes(),function(h){o(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,o),t.has(g,"y")&&o(g)})}function o(d){d.y=-d.y}function l(d){t.forEach(d.nodes(),function(h){u(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,u),t.has(g,"x")&&u(g)})}function u(d){var h=d.x;d.x=d.y,d.y=h}return Rb}var Cb,MN;function Y7(){if(MN)return Cb;MN=1;var t=Tt();Cb=e;function e(n){var r={},i=t.filter(n.nodes(),function(d){return!n.children(d).length}),s=t.max(t.map(i,function(d){return n.node(d).rank})),o=t.map(t.range(s+1),function(){return[]});function l(d){if(!t.has(r,d)){r[d]=!0;var h=n.node(d);o[h.rank].push(d),t.forEach(n.successors(d),l)}}var u=t.sortBy(i,function(d){return n.node(d).rank});return t.forEach(u,l),o}return Cb}var Nb,IN;function G7(){if(IN)return Nb;IN=1;var t=Tt();Nb=e;function e(r,i){for(var s=0,o=1;o<i.length;++o)s+=n(r,i[o-1],i[o]);return s}function n(r,i,s){for(var o=t.zipObject(s,t.map(s,function(_,y){return y})),l=t.flatten(t.map(i,function(_){return t.sortBy(t.map(r.outEdges(_),function(y){return{pos:o[y.w],weight:r.edge(y).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var d=2*u-1;u-=1;var h=t.map(new Array(d),function(){return 0}),g=0;return t.forEach(l.forEach(function(_){var y=_.pos+u;h[y]+=_.weight;for(var T=0;y>0;)y%2&&(T+=h[y+1]),y=y-1>>1,h[y]+=_.weight;g+=_.weight*T})),g}return Nb}var kb,ON;function K7(){if(ON)return kb;ON=1;var t=Tt();kb=e;function e(n,r){return t.map(r,function(i){var s=n.inEdges(i);if(s.length){var o=t.reduce(s,function(l,u){var d=n.edge(u),h=n.node(u.v);return{sum:l.sum+d.weight*h.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:i}})}return kb}var Mb,PN;function Z7(){if(PN)return Mb;PN=1;var t=Tt();Mb=e;function e(i,s){var o={};t.forEach(i,function(u,d){var h=o[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};t.isUndefined(u.barycenter)||(h.barycenter=u.barycenter,h.weight=u.weight)}),t.forEach(s.edges(),function(u){var d=o[u.v],h=o[u.w];!t.isUndefined(d)&&!t.isUndefined(h)&&(h.indegree++,d.out.push(o[u.w]))});var l=t.filter(o,function(u){return!u.indegree});return n(l)}function n(i){var s=[];function o(d){return function(h){h.merged||(t.isUndefined(h.barycenter)||t.isUndefined(d.barycenter)||h.barycenter>=d.barycenter)&&r(d,h)}}function l(d){return function(h){h.in.push(d),--h.indegree===0&&i.push(h)}}for(;i.length;){var u=i.pop();s.push(u),t.forEach(u.in.reverse(),o(u)),t.forEach(u.out,l(u))}return t.map(t.filter(s,function(d){return!d.merged}),function(d){return t.pick(d,["vs","i","barycenter","weight"])})}function r(i,s){var o=0,l=0;i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),s.weight&&(o+=s.barycenter*s.weight,l+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=o/l,i.weight=l,i.i=Math.min(s.i,i.i),s.merged=!0}return Mb}var Ib,DN;function Q7(){if(DN)return Ib;DN=1;var t=Tt(),e=In();Ib=n;function n(s,o){var l=e.partition(s,function(w){return t.has(w,"barycenter")}),u=l.lhs,d=t.sortBy(l.rhs,function(w){return-w.i}),h=[],g=0,_=0,y=0;u.sort(i(!!o)),y=r(h,d,y),t.forEach(u,function(w){y+=w.vs.length,h.push(w.vs),g+=w.barycenter*w.weight,_+=w.weight,y=r(h,d,y)});var T={vs:t.flatten(h,!0)};return _&&(T.barycenter=g/_,T.weight=_),T}function r(s,o,l){for(var u;o.length&&(u=t.last(o)).i<=l;)o.pop(),s.push(u.vs),l++;return l}function i(s){return function(o,l){return o.barycenter<l.barycenter?-1:o.barycenter>l.barycenter?1:s?l.i-o.i:o.i-l.i}}return Ib}var Ob,jN;function J7(){if(jN)return Ob;jN=1;var t=Tt(),e=K7(),n=Z7(),r=Q7();Ob=i;function i(l,u,d,h){var g=l.children(u),_=l.node(u),y=_?_.borderLeft:void 0,T=_?_.borderRight:void 0,w={};y&&(g=t.filter(g,function(k){return k!==y&&k!==T}));var x=e(l,g);t.forEach(x,function(k){if(l.children(k.v).length){var O=i(l,k.v,d,h);w[k.v]=O,t.has(O,"barycenter")&&o(k,O)}});var S=n(x,d);s(S,w);var R=r(S,h);if(y&&(R.vs=t.flatten([y,R.vs,T],!0),l.predecessors(y).length)){var E=l.node(l.predecessors(y)[0]),A=l.node(l.predecessors(T)[0]);t.has(R,"barycenter")||(R.barycenter=0,R.weight=0),R.barycenter=(R.barycenter*R.weight+E.order+A.order)/(R.weight+2),R.weight+=2}return R}function s(l,u){t.forEach(l,function(d){d.vs=t.flatten(d.vs.map(function(h){return u[h]?u[h].vs:h}),!0)})}function o(l,u){t.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return Ob}var Pb,BN;function eV(){if(BN)return Pb;BN=1;var t=Tt(),e=wr().Graph;Pb=n;function n(i,s,o){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return t.forEach(i.nodes(),function(d){var h=i.node(d),g=i.parent(d);(h.rank===s||h.minRank<=s&&s<=h.maxRank)&&(u.setNode(d),u.setParent(d,g||l),t.forEach(i[o](d),function(_){var y=_.v===d?_.w:_.v,T=u.edge(y,d),w=t.isUndefined(T)?0:T.weight;u.setEdge(y,d,{weight:i.edge(_).weight+w})}),t.has(h,"minRank")&&u.setNode(d,{borderLeft:h.borderLeft[s],borderRight:h.borderRight[s]}))}),u}function r(i){for(var s;i.hasNode(s=t.uniqueId("_root")););return s}return Pb}var Db,LN;function tV(){if(LN)return Db;LN=1;var t=Tt();Db=e;function e(n,r,i){var s={},o;t.forEach(i,function(l){for(var u=n.parent(l),d,h;u;){if(d=n.parent(u),d?(h=s[d],s[d]=u):(h=o,o=u),h&&h!==u){r.setEdge(h,u);return}u=d}})}return Db}var jb,UN;function nV(){if(UN)return jb;UN=1;var t=Tt(),e=Y7(),n=G7(),r=J7(),i=eV(),s=tV(),o=wr().Graph,l=In();jb=u;function u(_){var y=l.maxRank(_),T=d(_,t.range(1,y+1),"inEdges"),w=d(_,t.range(y-1,-1,-1),"outEdges"),x=e(_);g(_,x);for(var S=Number.POSITIVE_INFINITY,R,E=0,A=0;A<4;++E,++A){h(E%2?T:w,E%4>=2),x=l.buildLayerMatrix(_);var k=n(_,x);k<S&&(A=0,R=t.cloneDeep(x),S=k)}g(_,R)}function d(_,y,T){return t.map(y,function(w){return i(_,w,T)})}function h(_,y){var T=new o;t.forEach(_,function(w){var x=w.graph().root,S=r(w,x,T,y);t.forEach(S.vs,function(R,E){w.node(R).order=E}),s(w,T,S.vs)})}function g(_,y){t.forEach(y,function(T){t.forEach(T,function(w,x){_.node(w).order=x})})}return jb}var Bb,FN;function rV(){if(FN)return Bb;FN=1;var t=Tt(),e=wr().Graph,n=In();Bb={positionX:T,findType1Conflicts:r,findType2Conflicts:i,addConflict:o,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:_,findSmallestWidthAlignment:g,balance:y};function r(S,R){var E={};function A(k,O){var j=0,N=0,I=k.length,M=t.last(O);return t.forEach(O,function(q,X){var G=s(S,q),L=G?S.node(G).order:I;(G||q===M)&&(t.forEach(O.slice(N,X+1),function(J){t.forEach(S.predecessors(J),function(V){var $=S.node(V),Y=$.order;(Y<j||L<Y)&&!($.dummy&&S.node(J).dummy)&&o(E,V,J)})}),N=X+1,j=L)}),O}return t.reduce(R,A),E}function i(S,R){var E={};function A(O,j,N,I,M){var q;t.forEach(t.range(j,N),function(X){q=O[X],S.node(q).dummy&&t.forEach(S.predecessors(q),function(G){var L=S.node(G);L.dummy&&(L.order<I||L.order>M)&&o(E,G,q)})})}function k(O,j){var N=-1,I,M=0;return t.forEach(j,function(q,X){if(S.node(q).dummy==="border"){var G=S.predecessors(q);G.length&&(I=S.node(G[0]).order,A(j,M,X,N,I),M=X,N=I)}A(j,M,j.length,I,O.length)}),j}return t.reduce(R,k),E}function s(S,R){if(S.node(R).dummy)return t.find(S.predecessors(R),function(E){return S.node(E).dummy})}function o(S,R,E){if(R>E){var A=R;R=E,E=A}var k=S[R];k||(S[R]=k={}),k[E]=!0}function l(S,R,E){if(R>E){var A=R;R=E,E=A}return t.has(S[R],E)}function u(S,R,E,A){var k={},O={},j={};return t.forEach(R,function(N){t.forEach(N,function(I,M){k[I]=I,O[I]=I,j[I]=M})}),t.forEach(R,function(N){var I=-1;t.forEach(N,function(M){var q=A(M);if(q.length){q=t.sortBy(q,function(V){return j[V]});for(var X=(q.length-1)/2,G=Math.floor(X),L=Math.ceil(X);G<=L;++G){var J=q[G];O[M]===M&&I<j[J]&&!l(E,M,J)&&(O[J]=M,O[M]=k[M]=k[J],I=j[J])}}})}),{root:k,align:O}}function d(S,R,E,A,k){var O={},j=h(S,R,E,k),N=k?"borderLeft":"borderRight";function I(X,G){for(var L=j.nodes(),J=L.pop(),V={};J;)V[J]?X(J):(V[J]=!0,L.push(J),L=L.concat(G(J))),J=L.pop()}function M(X){O[X]=j.inEdges(X).reduce(function(G,L){return Math.max(G,O[L.v]+j.edge(L))},0)}function q(X){var G=j.outEdges(X).reduce(function(J,V){return Math.min(J,O[V.w]-j.edge(V))},Number.POSITIVE_INFINITY),L=S.node(X);G!==Number.POSITIVE_INFINITY&&L.borderType!==N&&(O[X]=Math.max(O[X],G))}return I(M,j.predecessors.bind(j)),I(q,j.successors.bind(j)),t.forEach(A,function(X){O[X]=O[E[X]]}),O}function h(S,R,E,A){var k=new e,O=S.graph(),j=w(O.nodesep,O.edgesep,A);return t.forEach(R,function(N){var I;t.forEach(N,function(M){var q=E[M];if(k.setNode(q),I){var X=E[I],G=k.edge(X,q);k.setEdge(X,q,Math.max(j(S,M,I),G||0))}I=M})}),k}function g(S,R){return t.minBy(t.values(R),function(E){var A=Number.NEGATIVE_INFINITY,k=Number.POSITIVE_INFINITY;return t.forIn(E,function(O,j){var N=x(S,j)/2;A=Math.max(O+N,A),k=Math.min(O-N,k)}),A-k})}function _(S,R){var E=t.values(R),A=t.min(E),k=t.max(E);t.forEach(["u","d"],function(O){t.forEach(["l","r"],function(j){var N=O+j,I=S[N],M;if(I!==R){var q=t.values(I);M=j==="l"?A-t.min(q):k-t.max(q),M&&(S[N]=t.mapValues(I,function(X){return X+M}))}})})}function y(S,R){return t.mapValues(S.ul,function(E,A){if(R)return S[R.toLowerCase()][A];var k=t.sortBy(t.map(S,A));return(k[1]+k[2])/2})}function T(S){var R=n.buildLayerMatrix(S),E=t.merge(r(S,R),i(S,R)),A={},k;t.forEach(["u","d"],function(j){k=j==="u"?R:t.values(R).reverse(),t.forEach(["l","r"],function(N){N==="r"&&(k=t.map(k,function(X){return t.values(X).reverse()}));var I=(j==="u"?S.predecessors:S.successors).bind(S),M=u(S,k,E,I),q=d(S,k,M.root,M.align,N==="r");N==="r"&&(q=t.mapValues(q,function(X){return-X})),A[j+N]=q})});var O=g(S,A);return _(A,O),y(A,S.graph().align)}function w(S,R,E){return function(A,k,O){var j=A.node(k),N=A.node(O),I=0,M;if(I+=j.width/2,t.has(j,"labelpos"))switch(j.labelpos.toLowerCase()){case"l":M=-j.width/2;break;case"r":M=j.width/2;break}if(M&&(I+=E?M:-M),M=0,I+=(j.dummy?R:S)/2,I+=(N.dummy?R:S)/2,I+=N.width/2,t.has(N,"labelpos"))switch(N.labelpos.toLowerCase()){case"l":M=N.width/2;break;case"r":M=-N.width/2;break}return M&&(I+=E?M:-M),M=0,I}}function x(S,R){return S.node(R).width}return Bb}var Lb,zN;function iV(){if(zN)return Lb;zN=1;var t=Tt(),e=In(),n=rV().positionX;Lb=r;function r(s){s=e.asNonCompoundGraph(s),i(s),t.forEach(n(s),function(o,l){s.node(l).x=o})}function i(s){var o=e.buildLayerMatrix(s),l=s.graph().ranksep,u=0;t.forEach(o,function(d){var h=t.max(t.map(d,function(g){return s.node(g).height}));t.forEach(d,function(g){s.node(g).y=u+h/2}),u+=h+l})}return Lb}var Ub,VN;function sV(){if(VN)return Ub;VN=1;var t=Tt(),e=F7(),n=z7(),r=q7(),i=In().normalizeRanks,s=$7(),o=In().removeEmptyRanks,l=H7(),u=W7(),d=X7(),h=nV(),g=iV(),_=In(),y=wr().Graph;Ub=T;function T(U,Z){var oe=Z&&Z.debugTiming?_.time:_.notime;oe("layout",function(){var _e=oe("  buildLayoutGraph",function(){return I(U)});oe("  runLayout",function(){w(_e,oe)}),oe("  updateInputGraph",function(){x(U,_e)})})}function w(U,Z){Z("    makeSpaceForEdgeLabels",function(){M(U)}),Z("    removeSelfEdges",function(){ue(U)}),Z("    acyclic",function(){e.run(U)}),Z("    nestingGraph.run",function(){l.run(U)}),Z("    rank",function(){r(_.asNonCompoundGraph(U))}),Z("    injectEdgeLabelProxies",function(){q(U)}),Z("    removeEmptyRanks",function(){o(U)}),Z("    nestingGraph.cleanup",function(){l.cleanup(U)}),Z("    normalizeRanks",function(){i(U)}),Z("    assignRankMinMax",function(){X(U)}),Z("    removeEdgeLabelProxies",function(){G(U)}),Z("    normalize.run",function(){n.run(U)}),Z("    parentDummyChains",function(){s(U)}),Z("    addBorderSegments",function(){u(U)}),Z("    order",function(){h(U)}),Z("    insertSelfEdges",function(){P(U)}),Z("    adjustCoordinateSystem",function(){d.adjust(U)}),Z("    position",function(){g(U)}),Z("    positionSelfEdges",function(){H(U)}),Z("    removeBorderNodes",function(){Y(U)}),Z("    normalize.undo",function(){n.undo(U)}),Z("    fixupEdgeLabelCoords",function(){V(U)}),Z("    undoCoordinateSystem",function(){d.undo(U)}),Z("    translateGraph",function(){L(U)}),Z("    assignNodeIntersects",function(){J(U)}),Z("    reversePoints",function(){$(U)}),Z("    acyclic.undo",function(){e.undo(U)})}function x(U,Z){t.forEach(U.nodes(),function(oe){var _e=U.node(oe),ye=Z.node(oe);_e&&(_e.x=ye.x,_e.y=ye.y,Z.children(oe).length&&(_e.width=ye.width,_e.height=ye.height))}),t.forEach(U.edges(),function(oe){var _e=U.edge(oe),ye=Z.edge(oe);_e.points=ye.points,t.has(ye,"x")&&(_e.x=ye.x,_e.y=ye.y)}),U.graph().width=Z.graph().width,U.graph().height=Z.graph().height}var S=["nodesep","edgesep","ranksep","marginx","marginy"],R={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},E=["acyclicer","ranker","rankdir","align"],A=["width","height"],k={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],j={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},N=["labelpos"];function I(U){var Z=new y({multigraph:!0,compound:!0}),oe=re(U.graph());return Z.setGraph(t.merge({},R,ie(oe,S),t.pick(oe,E))),t.forEach(U.nodes(),function(_e){var ye=re(U.node(_e));Z.setNode(_e,t.defaults(ie(ye,A),k)),Z.setParent(_e,U.parent(_e))}),t.forEach(U.edges(),function(_e){var ye=re(U.edge(_e));Z.setEdge(_e,t.merge({},j,ie(ye,O),t.pick(ye,N)))}),Z}function M(U){var Z=U.graph();Z.ranksep/=2,t.forEach(U.edges(),function(oe){var _e=U.edge(oe);_e.minlen*=2,_e.labelpos.toLowerCase()!=="c"&&(Z.rankdir==="TB"||Z.rankdir==="BT"?_e.width+=_e.labeloffset:_e.height+=_e.labeloffset)})}function q(U){t.forEach(U.edges(),function(Z){var oe=U.edge(Z);if(oe.width&&oe.height){var _e=U.node(Z.v),ye=U.node(Z.w),Ae={rank:(ye.rank-_e.rank)/2+_e.rank,e:Z};_.addDummyNode(U,"edge-proxy",Ae,"_ep")}})}function X(U){var Z=0;t.forEach(U.nodes(),function(oe){var _e=U.node(oe);_e.borderTop&&(_e.minRank=U.node(_e.borderTop).rank,_e.maxRank=U.node(_e.borderBottom).rank,Z=t.max(Z,_e.maxRank))}),U.graph().maxRank=Z}function G(U){t.forEach(U.nodes(),function(Z){var oe=U.node(Z);oe.dummy==="edge-proxy"&&(U.edge(oe.e).labelRank=oe.rank,U.removeNode(Z))})}function L(U){var Z=Number.POSITIVE_INFINITY,oe=0,_e=Number.POSITIVE_INFINITY,ye=0,Ae=U.graph(),Me=Ae.marginx||0,Ze=Ae.marginy||0;function It(_t){var ut=_t.x,De=_t.y,tn=_t.width,Ce=_t.height;Z=Math.min(Z,ut-tn/2),oe=Math.max(oe,ut+tn/2),_e=Math.min(_e,De-Ce/2),ye=Math.max(ye,De+Ce/2)}t.forEach(U.nodes(),function(_t){It(U.node(_t))}),t.forEach(U.edges(),function(_t){var ut=U.edge(_t);t.has(ut,"x")&&It(ut)}),Z-=Me,_e-=Ze,t.forEach(U.nodes(),function(_t){var ut=U.node(_t);ut.x-=Z,ut.y-=_e}),t.forEach(U.edges(),function(_t){var ut=U.edge(_t);t.forEach(ut.points,function(De){De.x-=Z,De.y-=_e}),t.has(ut,"x")&&(ut.x-=Z),t.has(ut,"y")&&(ut.y-=_e)}),Ae.width=oe-Z+Me,Ae.height=ye-_e+Ze}function J(U){t.forEach(U.edges(),function(Z){var oe=U.edge(Z),_e=U.node(Z.v),ye=U.node(Z.w),Ae,Me;oe.points?(Ae=oe.points[0],Me=oe.points[oe.points.length-1]):(oe.points=[],Ae=ye,Me=_e),oe.points.unshift(_.intersectRect(_e,Ae)),oe.points.push(_.intersectRect(ye,Me))})}function V(U){t.forEach(U.edges(),function(Z){var oe=U.edge(Z);if(t.has(oe,"x"))switch((oe.labelpos==="l"||oe.labelpos==="r")&&(oe.width-=oe.labeloffset),oe.labelpos){case"l":oe.x-=oe.width/2+oe.labeloffset;break;case"r":oe.x+=oe.width/2+oe.labeloffset;break}})}function $(U){t.forEach(U.edges(),function(Z){var oe=U.edge(Z);oe.reversed&&oe.points.reverse()})}function Y(U){t.forEach(U.nodes(),function(Z){if(U.children(Z).length){var oe=U.node(Z),_e=U.node(oe.borderTop),ye=U.node(oe.borderBottom),Ae=U.node(t.last(oe.borderLeft)),Me=U.node(t.last(oe.borderRight));oe.width=Math.abs(Me.x-Ae.x),oe.height=Math.abs(ye.y-_e.y),oe.x=Ae.x+oe.width/2,oe.y=_e.y+oe.height/2}}),t.forEach(U.nodes(),function(Z){U.node(Z).dummy==="border"&&U.removeNode(Z)})}function ue(U){t.forEach(U.edges(),function(Z){if(Z.v===Z.w){var oe=U.node(Z.v);oe.selfEdges||(oe.selfEdges=[]),oe.selfEdges.push({e:Z,label:U.edge(Z)}),U.removeEdge(Z)}})}function P(U){var Z=_.buildLayerMatrix(U);t.forEach(Z,function(oe){var _e=0;t.forEach(oe,function(ye,Ae){var Me=U.node(ye);Me.order=Ae+_e,t.forEach(Me.selfEdges,function(Ze){_.addDummyNode(U,"selfedge",{width:Ze.label.width,height:Ze.label.height,rank:Me.rank,order:Ae+ ++_e,e:Ze.e,label:Ze.label},"_se")}),delete Me.selfEdges})})}function H(U){t.forEach(U.nodes(),function(Z){var oe=U.node(Z);if(oe.dummy==="selfedge"){var _e=U.node(oe.e.v),ye=_e.x+_e.width/2,Ae=_e.y,Me=oe.x-ye,Ze=_e.height/2;U.setEdge(oe.e,oe.label),U.removeNode(Z),oe.label.points=[{x:ye+2*Me/3,y:Ae-Ze},{x:ye+5*Me/6,y:Ae-Ze},{x:ye+Me,y:Ae},{x:ye+5*Me/6,y:Ae+Ze},{x:ye+2*Me/3,y:Ae+Ze}],oe.label.x=oe.x,oe.label.y=oe.y}})}function ie(U,Z){return t.mapValues(t.pick(U,Z),Number)}function re(U){var Z={};return t.forEach(U,function(oe,_e){Z[_e.toLowerCase()]=oe}),Z}return Ub}var Fb,qN;function aV(){if(qN)return Fb;qN=1;var t=Tt(),e=In(),n=wr().Graph;Fb={debugOrdering:r};function r(i){var s=e.buildLayerMatrix(i),o=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(i.nodes(),function(l){o.setNode(l,{label:l}),o.setParent(l,"layer"+i.node(l).rank)}),t.forEach(i.edges(),function(l){o.setEdge(l.v,l.w,{},l.name)}),t.forEach(s,function(l,u){var d="layer"+u;o.setNode(d,{rank:"same"}),t.reduce(l,function(h,g){return o.setEdge(h,g,{style:"invis"}),g})}),o}return Fb}var zb,$N;function oV(){return $N||($N=1,zb="0.8.5"),zb}var Vb,HN;function lV(){return HN||(HN=1,Vb={graphlib:wr(),layout:sV(),debug:aV(),util:{time:In().time,notime:In().notime},version:oV()}),Vb}var WN=lV();const cV={sample:8,root:6,other:5};function F0(t,e,n,r){return t.is_sample||Ol(t,n,r)?t.is_sample?e.sample:e.root:e.other}const Fe={ROOT_NODE_STROKE_WIDTH:2,SAMPLE_NODE_STROKE_WIDTH:1,EDGE_STROKE_WIDTH:1,COLLISION_RADIUS:15,TOOLTIP_FONT_SIZE:"12px",PADDING_RATIO:.1,MAX_SIBLING_DISTANCE:50,FORCE_STRENGTH:{LINK_SIBLING:.9,LINK_SAMPLE:.8,LINK_DEFAULT:.3,CHARGE:-20,X_POSITION:.15,Y_POSITION:1,ALPHA_START:.8,ALPHA_DECAY:.05,VELOCITY_DECAY:.7},ZOOM:{MIN_SCALE:.1,MAX_SCALE:4,FOCUS_SCALE:1.5,GRAPH_FIT_SCALE_MIN:.2,GRAPH_FIT_SCALE_MAX:1.5,TRANSITION_DURATION:750,ALPHA_TARGET:.3},LAYOUT:{BOTTOM_MARGIN_RATIO:.15},PERFORMANCE:{ALPHA_THRESHOLD:.1}};function to(t,e){const n=typeof t.source=="number"?e.find(i=>i.id===t.source)||null:t.source,r=typeof t.target=="number"?e.find(i=>i.id===t.target)||null:t.target;return{source:n,target:r}}function mO(t,e,n){const r=new Set,i=new Set,s=[t];for(;s.length>0;){const o=s.shift();if(i.has(o.id))continue;i.add(o.id),n.filter(u=>{const{source:d,target:h}=to(u,e);return(d==null?void 0:d.id)===o.id&&h&&h.timeIndex>o.timeIndex}).forEach(u=>{const{target:d}=to(u,e);d&&(d.is_sample?r.add(d):i.has(d.id)||s.push(d))})}return Array.from(r)}function df(t,e,n){const r=mO(t,e,n);if(r.length===0)return null;const i=r.map(s=>s.x);return{min:Math.min(...i),max:Math.max(...i)}}function uV(t,e,n){const r=df(t,e,n);r&&t.x!==void 0&&(t.x=Math.max(r.min,Math.min(r.max,t.x)))}function Cf(t,e,n){const r=n.find(s=>{const{source:o,target:l}=to(s,e);return(l==null?void 0:l.id)===t.id&&o&&o.timeIndex<t.timeIndex});if(!r)return null;const{source:i}=to(r,e);return i}function XN(t,e,n){const r=Cf(t,e,n);return r?e.filter(i=>{if(i.id===t.id||i.timeIndex<=r.timeIndex)return!1;const s=Cf(i,e,n);return(s==null?void 0:s.id)===r.id}):[]}function qb(t,e,n,r,i,s,o=5){const l=Math.sqrt((t-n)**2+(e-r)**2),u=Math.sqrt((t-i)**2+(e-s)**2),d=Math.sqrt((i-n)**2+(s-r)**2);return Math.abs(l+u-d)<=o}function fV(t,e,n,r,i,s,o){const l=new Set(e.filter(g=>{const _=typeof g.source=="number"?g.source:g.source.id,y=typeof g.target=="number"?g.target:g.target.id;return _===t.id||y===t.id}).map(g=>`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`)),u=e.filter(g=>{const _=`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`;if(l.has(_))return!1;const y=typeof g.source=="number"?n.find(w=>w.id===g.source):g.source,T=typeof g.target=="number"?n.find(w=>w.id===g.target):g.target;return!y||!T?!1:qb(t.x,t.y,y.x,y.y,T.x,T.y,r*2)});if(u.length===0)return{x:t.x,y:t.y};const d=30,h=5;for(let g=h;g<=d;g+=h){const _=Math.min(t.x+g,s);let y=!1;for(const x of u){const S=typeof x.source=="number"?n.find(E=>E.id===x.source):x.source,R=typeof x.target=="number"?n.find(E=>E.id===x.target):x.target;if(qb(_,t.y,S.x,S.y,R.x,R.y,r*2)){y=!0;break}}if(!y)return{x:_,y:t.y};const T=Math.max(t.x-g,i);let w=!1;for(const x of u){const S=typeof x.source=="number"?n.find(E=>E.id===x.source):x.source,R=typeof x.target=="number"?n.find(E=>E.id===x.target):x.target;if(qb(T,t.y,S.x,S.y,R.x,R.y,r*2)){w=!0;break}}if(!w)return{x:T,y:t.y}}return{x:t.x,y:t.y}}function dV(t,e){return e.filter(n=>{const r=typeof n.source=="number"?n.source:n.source.id,i=typeof n.target=="number"?n.target:n.target.id;return r===t.id||i===t.id})}function hV(t,e,n){const r=YN(t,n),i=YN(e,n);if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}function YN(t,e){const n=new Set;return dV(t,e).forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id;i!==t.id&&n.add(i),s!==t.id&&n.add(s)}),n}function pV(t,e){const n=new Set,r=[],i=new Map;for(let o=0;o<t.length;o++){if(n.has(t[o].id))continue;const l=t[o];if(l.is_sample){r.push(l),i.set(l.id,l.id),n.add(l.id);continue}const u=gV(l,t,e,n,o),d=mV(l,u);r.push(d),u.forEach(h=>{i.set(h.id,d.id),n.add(h.id)})}const s=_V(e,i);return{nodes:r,edges:s}}function gV(t,e,n,r,i){const s=[t];for(let o=i+1;o<e.length;o++){const l=e[o];r.has(l.id)||l.is_sample||t.time===l.time&&hV(t,l,n)&&s.push(l)}return s}function mV(t,e){return e.length===1?t:{...t,is_combined:!0,combined_nodes:e.map(n=>n.id)}}function _V(t,e){const n=[];return t.forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id,o=e.get(i),l=e.get(s);o!==void 0&&l!==void 0&&n.push({...r,source:o,target:l})}),n}function Ol(t,e,n){const r=n.some(s=>{const{target:o}=to(s,e);return(o==null?void 0:o.id)===t.id}),i=n.some(s=>{const{source:o}=to(s,e);return(o==null?void 0:o.id)===t.id});return!r&&i}function vV(t,e,n,r,i){return(s,o,l)=>{if(s)if(l.length===0){const u=o.find(y=>y.id===s.id);if(!u)return;const d=u.x??0,g=r*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO)-u.timeIndex*i,_=Cd.translate(n/2,r/2).scale(Fe.ZOOM.FOCUS_SCALE).translate(-d,-g);t.transition().duration(Fe.ZOOM.TRANSITION_DURATION).call(e.transform,_)}else{const u=o.filter(g=>g.x!==void 0&&g.timeIndex!==void 0);if(u.length===0)return;const d=yV(u,r,i),h=bV(d,n,r);t.transition().duration(Fe.ZOOM.TRANSITION_DURATION).call(e.transform,h)}}}function yV(t,e,n){const r=t.map(o=>o.x),i=e*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO),s=t.map(o=>i-o.timeIndex*n);return{minX:Math.min(...r),maxX:Math.max(...r),minY:Math.min(...s),maxY:Math.max(...s)}}function bV(t,e,n){const r=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2,s=t.maxX-t.minX,o=t.maxY-t.minY,l=50,u=(e-2*l)/(s||1),d=(n-2*l)/(o||1),h=Math.min(Math.max(Fe.ZOOM.GRAPH_FIT_SCALE_MIN,Math.min(u,d)),Fe.ZOOM.GRAPH_FIT_SCALE_MAX);return Cd.translate(e/2,n/2).scale(h).translate(-r,-i)}function xV(t,e,n,r){const i=new Map;t.forEach(s=>{if(!s.is_sample){const o=Math.round(s.x*100)/100,l=i.get(o)||[];l.push(s),i.set(o,l)}}),i.forEach((s,o)=>{if(s.length>1){s.sort((l,u)=>l.y-u.y);for(let l=0;l<s.length;l++)for(let u=l+1;u<s.length;u++){const d=s[l],h=s[u];if(!e.some(_=>{const y=typeof _.source=="number"?_.source:_.source.id,T=typeof _.target=="number"?_.target:_.target.id;return y===d.id&&T===h.id||y===h.id&&T===d.id})){const T=((h.id*1e4+d.id)%1e3/1e3-.5)*15,w=Math.max(n,Math.min(r,h.x+T));h.x=w,h.fx=w}}}})}function wV(t,e,n,r,i,s){const o=Array.from(new Set(t.map(_=>_.time))).sort((_,y)=>_-y),l=new Map(o.map((_,y)=>[_,y])),u=r*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO),d=u/(o.length-1||1),h=n*Fe.PADDING_RATIO,g=n-2*h;if(t.forEach(_=>{_.timeIndex=l.get(_.time)??0}),i==="dagre"){console.log("Setting up dagre layout...");const _=new WN.graphlib.Graph;_.setGraph({rankdir:"TB",nodesep:50,ranksep:75,marginx:h,marginy:20,ranker:"network-simplex",acyclicer:"greedy",align:"UL"}),_.setDefaultEdgeLabel(()=>({})),t.forEach(N=>{_.setNode(N.id.toString(),{width:20,height:20,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:5})}),e.forEach(N=>{const I=typeof N.source=="number"?N.source:N.source.id,M=typeof N.target=="number"?N.target:N.target.id,q=t.find(L=>L.id===I),X=t.find(L=>L.id===M);let G=1;q&&X&&((q.is_sample||X.is_sample)&&(G=3),Math.abs(q.time-X.time)===1&&(G+=1)),_.setEdge(I.toString(),M.toString(),{weight:G})}),WN.layout(_);const y=t.filter(N=>N.is_sample);let T=1/0,w=-1/0;y.forEach(N=>{const I=_.node(N.id.toString());I&&(T=Math.min(T,I.x),w=Math.max(w,I.x))});const x=100,S=w-T,E=Math.min(S,x*(y.length-1))/S;t.forEach(N=>{const I=_.node(N.id.toString());if(I){const M=(I.x-T)*E+T;N.x=M,N.y=I.y,N.fx=N.x,N.fy=N.y}}),xV(t,e,T,w);const A=new Set;let k=!0;const O=3;let j=0;for(;k&&j<O;){k=!1,j++;const N=t.filter(I=>!A.has(I.id)).sort((I,M)=>{const q=e.filter(G=>{const L=typeof G.source=="number"?G.source:G.source.id,J=typeof G.target=="number"?G.target:G.target.id;return L===I.id||J===I.id}).length;return e.filter(G=>{const L=typeof G.source=="number"?G.source:G.source.id,J=typeof G.target=="number"?G.target:G.target.id;return L===M.id||J===M.id}).length-q});for(const I of N){if(I.is_sample){A.add(I.id);continue}const M=s?F0(I,s,t,e):5,q=fV(I,e,t,M,T,w);(q.x!==I.x||q.y!==I.y)&&(I.x=q.x,I.fx=q.x,I.y=q.y,I.fy=q.y,k=!0),A.add(I.id)}}console.log("Dagre layout complete. Node count:",t.length)}else{const _=t.filter(T=>T.is_sample),y=g/(_.length-1||1);_.sort((T,w)=>T.order_position!==void 0&&w.order_position!==void 0?T.order_position-w.order_position:T.order_position!==void 0?-1:w.order_position!==void 0?1:(w.degree??0)-(T.degree??0)),_.forEach((T,w)=>{T.x=h+w*y,T.fx=T.x,T.y=u-T.timeIndex*d,T.fy=T.y}),t.filter(T=>!T.is_sample).forEach(T=>{T.fx=null,T.fy=null,T.y=u-T.timeIndex*d})}return{timeSpacing:d,uniqueTimes:o}}const TV=F.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,onEdgeClick:s,focalNode:o,nodeSizes:l=cV,sampleOrder:u="degree",edgeThickness:d=Fe.EDGE_STROKE_WIDTH},h)=>{const{colors:g}=Vt(),_=F.useMemo(()=>t?`${t.nodes.length}-${t.edges.length}-${t.metadata.genomic_start||0}-${t.metadata.genomic_end||t.metadata.sequence_length}`:null,[t==null?void 0:t.nodes.length,t==null?void 0:t.edges.length,t==null?void 0:t.metadata.genomic_start,t==null?void 0:t.metadata.genomic_end,t==null?void 0:t.metadata.sequence_length]),y=F.useRef({data:null,key:null}),T=F.useMemo(()=>!t||!_?null:y.current.key===_&&y.current.data?y.current.data:(y.current={data:t,key:_},t),[t,_]);return F.useEffect(()=>{if(!h||typeof h=="function"||!h.current||!T)return;const w=h.current.getBoundingClientRect(),x=e||w.width||800,S=n||w.height||600,{nodes:R,edges:E}=pV(T.nodes,T.edges);rr(h.current).selectAll("*").remove();const A=rr(h.current).attr("width",x).attr("height",S).attr("viewBox",[0,0,x,S]).attr("style","max-width: 100%; height: auto;"),k=A.append("g"),O=X5().scaleExtent([Fe.ZOOM.MIN_SCALE,Fe.ZOOM.MAX_SCALE]).on("zoom",$=>{k.attr("transform",$.transform)});A.call(O);const j=vV(A,O,x,S,0),{timeSpacing:N}=wV(R,E,x,S,u,l);o&&j(o,R,E);const I=B5(R).alpha(u==="dagre"?0:Fe.FORCE_STRENGTH.ALPHA_START).alphaDecay(u==="dagre"?1:Fe.FORCE_STRENGTH.ALPHA_DECAY).velocityDecay(u==="dagre"?1:Fe.FORCE_STRENGTH.VELOCITY_DECAY).force("link",u==="dagre"?null:N5(E).id($=>$.id).distance(50).strength($=>{const Y=typeof $.source=="number"?R.find(ie=>ie.id===$.source):$.source,ue=typeof $.target=="number"?R.find(ie=>ie.id===$.target):$.target,P=Cf(Y,R,E),H=Cf(ue,R,E);return P&&H&&P.id===H.id?Fe.FORCE_STRENGTH.LINK_SIBLING:Y!=null&&Y.is_sample||ue!=null&&ue.is_sample?Fe.FORCE_STRENGTH.LINK_SAMPLE:Fe.FORCE_STRENGTH.LINK_DEFAULT})).force("charge",u==="dagre"?null:L5().strength(Fe.FORCE_STRENGTH.CHARGE)).force("x",u==="dagre"?null:U5($=>{if($.is_sample)return $.x;const Y=df($,R,E),ue=XN($,R,E);if(ue.length>0){const P=ue.reduce((H,ie)=>H+(ie.x??0),0)/ue.length;if(Y){const H=(P+(Y.min+Y.max)/2)/2;return Math.max(Y.min,Math.min(Y.max,H))}return P}return Y?(Y.min+Y.max)/2:$.x??x/2}).strength(Fe.FORCE_STRENGTH.X_POSITION)).force("y",F5($=>S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO)-$.timeIndex*N).strength(u==="dagre"?1:Fe.FORCE_STRENGTH.Y_POSITION)).force("collision",u==="dagre"?null:R5().radius(Fe.COLLISION_RADIUS)),M=k.append("g").selectAll("line").data(E).join("line").attr("stroke",`rgb(${g.edgeDefault[0]}, ${g.edgeDefault[1]}, ${g.edgeDefault[2]})`).attr("stroke-opacity",g.edgeDefault[3]/255).attr("stroke-width",d).attr("x1",$=>{const Y=typeof $.source=="number"?R.find(ue=>ue.id===$.source):$.source;return(Y==null?void 0:Y.x)??0}).attr("y1",$=>{const Y=typeof $.source=="number"?R.find(P=>P.id===$.source):$.source;return S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO)-(Y==null?void 0:Y.timeIndex)*N}).attr("x2",$=>{const Y=typeof $.target=="number"?R.find(ue=>ue.id===$.target):$.target;return(Y==null?void 0:Y.x)??0}).attr("y2",$=>{const Y=typeof $.target=="number"?R.find(P=>P.id===$.target):$.target;return S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO)-(Y==null?void 0:Y.timeIndex)*N}).on("click",($,Y)=>s==null?void 0:s(Y)),q=rr("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color",g.tooltipBackground).style("color",g.tooltipText).style("border",`1px solid ${g.border}`).style("padding","8px").style("border-radius","4px").style("font-size",Fe.TOOLTIP_FONT_SIZE).style("pointer-events","none");function X($){$.active||I.alphaTarget(Fe.ZOOM.ALPHA_TARGET).restart(),$.subject.fx=$.subject.x;const Y=S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO);$.subject.fy=Y-$.subject.timeIndex*N}function G($){if(!T)return;const Y=df($.subject,R,E),ue=XN($.subject,R,E);let P=$.x;if(Y)P=Math.max(Y.min,Math.min(Y.max,P));else{const ie=x*Fe.PADDING_RATIO;P=Math.max(ie,Math.min(x-ie,P))}if(ue.length>0){const ie=ue.reduce((re,U)=>re+(U.x??0),0)/ue.length;P=Math.max(ie-Fe.MAX_SIBLING_DISTANCE,Math.min(ie+Fe.MAX_SIBLING_DISTANCE,P))}$.subject.fx=P;const H=S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO);$.subject.fy=H-$.subject.timeIndex*N}function L($){$.active||I.alphaTarget(0),$.subject.fx=null;const Y=df($.subject,R,E);let ue=$.subject.x??0;if(Y)ue=Math.max(Y.min,Math.min(Y.max,ue));else{const H=x*Fe.PADDING_RATIO;ue=Math.max(H,Math.min(x-H,ue))}$.subject.x=ue;const P=S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO);$.subject.fy=P-$.subject.timeIndex*N}const J=k.append("g").selectAll("circle").data(R).join("circle").attr("r",$=>F0($,l,R,E)).attr("fill",$=>$.is_sample?`rgb(${g.nodeSample[0]}, ${g.nodeSample[1]}, ${g.nodeSample[2]})`:$.is_combined?`rgb(${g.nodeCombined[0]}, ${g.nodeCombined[1]}, ${g.nodeCombined[2]})`:Ol($,R,E)?`rgb(${g.nodeRoot[0]}, ${g.nodeRoot[1]}, ${g.nodeRoot[2]})`:`rgb(${g.nodeDefault[0]}, ${g.nodeDefault[1]}, ${g.nodeDefault[2]})`).attr("stroke",$=>Ol($,R,E)?`rgb(${g.nodeSelected[0]}, ${g.nodeSelected[1]}, ${g.nodeSelected[2]})`:$.is_sample?g.background:"none").attr("stroke-width",$=>Ol($,R,E)?Fe.ROOT_NODE_STROKE_WIDTH:$.is_sample?Fe.SAMPLE_NODE_STROKE_WIDTH:0).style("cursor","pointer").call(E8().on("start",X).on("drag",G).on("end",L)).on("click",($,Y)=>{$.preventDefault(),r==null||r(Y)}).on("contextmenu",($,Y)=>{$.preventDefault(),i==null||i(Y)}).on("mouseover",($,Y)=>{var P;let ue="";if(Y.is_sample)ue=`Sample node ${Y.id}<br>Time: ${Y.time}`;else if(Y.is_combined)ue=`Combined node ${Y.id}<br>Contains nodes: ${(P=Y.combined_nodes)==null?void 0:P.join(", ")}<br>Time: ${Y.time}`;else if(Ol(Y,R,E)){const H=[...new Set(E.filter(re=>{const U=typeof re.source=="number"?R.find(Z=>Z.id===re.source):re.source;return(U==null?void 0:U.id)===Y.id}).map(re=>{const U=typeof re.target=="number"?R.find(Z=>Z.id===re.target):re.target;return U==null?void 0:U.id}).filter(re=>re!==void 0))].sort((re,U)=>re-U),ie=mO(Y,R,E).map(re=>re.id).sort((re,U)=>re-U);ue=`Root node ${Y.id}<br>Time: ${Y.time}`,H.length>0&&(ue+=`<br>Children: ${H.join(", ")}`),ie.length>0&&(ue+=`<br>Descendant samples: ${ie.join(", ")}`)}else{const H=[...new Set(E.filter(re=>{const U=typeof re.target=="number"?R.find(Z=>Z.id===re.target):re.target;return(U==null?void 0:U.id)===Y.id}).map(re=>{const U=typeof re.source=="number"?R.find(Z=>Z.id===re.source):re.source;return U==null?void 0:U.id}).filter(re=>re!==void 0))].sort((re,U)=>re-U),ie=[...new Set(E.filter(re=>{const U=typeof re.source=="number"?R.find(Z=>Z.id===re.source):re.source;return(U==null?void 0:U.id)===Y.id}).map(re=>{const U=typeof re.target=="number"?R.find(Z=>Z.id===re.target):re.target;return U==null?void 0:U.id}).filter(re=>re!==void 0))].sort((re,U)=>re-U);ue=`Internal node ${Y.id}<br>Time: ${Y.time}`,H.length>0&&(ue+=`<br>Parents: ${H.join(", ")}`),ie.length>0&&(ue+=`<br>Children: ${ie.join(", ")}`)}if(Y.individual!==void 0&&Y.individual!==-1&&(ue+=`<br>Individual: ${Y.individual}`),Y.location){const H=Y.location,ie=H.x>=-180&&H.x<=180&&H.y>=-90&&H.y<=90&&(H.x!==0||H.y!==0);H.z!==void 0?ie?ue+=`<br>Location: Lat: ${H.y.toFixed(3)}, Lon: ${H.x.toFixed(3)}, Z: ${H.z.toFixed(2)}`:ue+=`<br>Location: (${H.x.toFixed(2)}, ${H.y.toFixed(2)}, ${H.z.toFixed(2)})`:ie?ue+=`<br>Location: Lat: ${H.y.toFixed(3)}, Lon: ${H.x.toFixed(3)}`:ue+=`<br>Location: (${H.x.toFixed(2)}, ${H.y.toFixed(2)})`}q.style("visibility","visible").html(ue).style("left",$.pageX+10+"px").style("top",$.pageY-10+"px")}).on("mousemove",$=>{q.style("left",$.pageX+10+"px").style("top",$.pageY-10+"px")}).on("mouseout",()=>{q.style("visibility","hidden")}),V=k.append("g").selectAll("text").data(R.filter($=>$.is_sample)).join("text").text($=>$.id.toString()).attr("font-size",$=>`${l.sample*1.2}px`).attr("fill",g.text).attr("text-anchor","middle").attr("dx",0).attr("dy",$=>F0($,l,R,E)+12);return I.on("tick",()=>{if(!T)return;I.alpha()>Fe.PERFORMANCE.ALPHA_THRESHOLD&&R.forEach(Y=>{Y.is_sample||uV(Y,R,E)});const $=S*(1-Fe.LAYOUT.BOTTOM_MARGIN_RATIO);M.attr("x1",Y=>{const ue=typeof Y.source=="number"?R.find(P=>P.id===Y.source):Y.source;return(ue==null?void 0:ue.x)??0}).attr("y1",Y=>{const ue=typeof Y.source=="number"?R.find(P=>P.id===Y.source):Y.source;return $-(ue==null?void 0:ue.timeIndex)*N}).attr("x2",Y=>{const ue=typeof Y.target=="number"?R.find(P=>P.id===Y.target):Y.target;return(ue==null?void 0:ue.x)??0}).attr("y2",Y=>{const ue=typeof Y.target=="number"?R.find(P=>P.id===Y.target):Y.target;return $-(ue==null?void 0:ue.timeIndex)*N}),J.attr("cx",Y=>Y.x??0).attr("cy",Y=>$-Y.timeIndex*N),V.attr("x",Y=>Y.x??0).attr("y",Y=>$-Y.timeIndex*N)}),()=>{I.stop(),q.remove()}},[T,e,n,r,i,s,o,l,h,u,d]),m.jsx("div",{className:"w-full h-full",children:m.jsx("svg",{ref:h,className:"w-full h-full"})})}),SV=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,genomicRange:o,sequenceLength:l,isFiltered:u=!1,isFilterSectionCollapsed:d=!0})=>{const{colors:h}=Vt(),[g,_]=F.useState(!0),y=t&&n?(n/t*100).toFixed(1):null,T=e&&r?(r/e*100).toFixed(1):null;if(!(t||n||i))return null;const x=S=>S>=1e6?`${(S/1e6).toFixed(1)}M`:S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toString();return m.jsxs("div",{className:"absolute top-4 right-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${h.background}F0`,borderColor:h.border,color:h.text},children:[m.jsxs("div",{onClick:()=>_(!g),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:g?"transparent":`${h.containerBackground}80`},onMouseEnter:S=>{g||(S.currentTarget.style.backgroundColor=`${h.border}40`)},onMouseLeave:S=>{g||(S.currentTarget.style.backgroundColor=`${h.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:h.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-180":""}`,style:{color:h.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:h.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:h.text},children:[n.toLocaleString()," nodes (",y,"%), ",r.toLocaleString()," edges (",T,"%)"]})]}),i&&s&&(i!==n||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:h.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:h.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),u&&o&&l&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Filter Information"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Range:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[0])," - ",x(o[1])]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Length:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[1]-o[0])," bp"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Coverage:"}),m.jsxs("span",{style:{color:h.text},children:[((o[1]-o[0])/l*100).toFixed(1),"% of sequence"]})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${h.text}CC`},children:[m.jsx("div",{children:" Drag: Pan view"}),m.jsx("div",{children:" Scroll: Zoom in/out"}),m.jsx("div",{children:" Left click: Select node"}),m.jsx("div",{children:" Right click: Show ancestors"}),m.jsx("div",{children:" Drag nodes to reposition"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]})`,borderColor:h.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:h.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeCombined[0]}, ${h.nodeCombined[1]}, ${h.nodeCombined[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]})`,borderColor:`rgb(${h.nodeSelected[0]}, ${h.nodeSelected[1]}, ${h.nodeSelected[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Root Nodes"})]})]})]})]})]})},EV=[{value:"degree",label:"Degree",description:"Order by node connectivity (current default)"},{value:"center_minlex",label:"Center Tree",description:"Minlex postorder of tree at center genomic position"},{value:"first_tree",label:"First Tree",description:"Minlex postorder of first tree"},{value:"custom",label:"Consensus",description:"Majority vote across multiple trees"},{value:"numeric",label:"Numeric",description:"Simple numeric order (0, 1, 2, ...)"},{value:"dagre",label:"Layer-based",description:"Order nodes in each layer using dagre-d3 algorithm"}],AV=({value:t,onChange:e,className:n=""})=>{const{colors:r}=Vt();return m.jsxs("div",{className:`flex items-center gap-2 ${n}`,children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Sample Order:"}),m.jsx("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:EV.map(i=>m.jsx("button",{onClick:()=>e(i.value),className:"px-3 py-1 text-xs font-medium transition-colors whitespace-nowrap",style:{backgroundColor:t===i.value?r.textSecondary:r.containerBackground,color:t===i.value?r.background:r.text},title:i.description,children:i.label},i.value))})]})},RV=({sampleOrder:t,onSampleOrderChange:e,nodeSizes:n,onNodeSizeChange:r,edgeThickness:i,onEdgeThicknessChange:s,isLoading:o=!1})=>{const{colors:l}=Vt(),[u,d]=F.useState(!0);return m.jsxs("div",{className:"absolute top-4 left-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text},children:[m.jsxs("div",{onClick:()=>d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:h=>{u||(h.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:h=>{u||(h.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),"Graph Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Sample Order"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(AV,{value:t,onChange:e}),o&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:l.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:l.text},children:"Updating sample order..."})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Sizes"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:l.text},children:"Sample Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:l.text},children:[n.sample,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.sample,onChange:h=>r({...n,sample:parseInt(h.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${l.accentPrimary} 0%, ${l.accentPrimary} ${(n.sample-3)/12*100}%, ${l.border} ${(n.sample-3)/12*100}%, ${l.border} 100%)`,accentColor:l.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:l.text},children:"Root Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:l.text},children:[n.root,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.root,onChange:h=>r({...n,root:parseInt(h.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${l.accentPrimary} 0%, ${l.accentPrimary} ${(n.root-3)/12*100}%, ${l.border} ${(n.root-3)/12*100}%, ${l.border} 100%)`,accentColor:l.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:l.text},children:"Internal & Combined"}),m.jsxs("span",{className:"text-xs",style:{color:l.text},children:[n.other,"px"]})]}),m.jsx("input",{type:"range",min:"2",max:"10",step:"1",value:n.other,onChange:h=>r({...n,other:parseInt(h.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${l.accentPrimary} 0%, ${l.accentPrimary} ${(n.other-2)/8*100}%, ${l.border} ${(n.other-2)/8*100}%, ${l.border} 100%)`,accentColor:l.accentPrimary}})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Edge Thickness"}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:l.text},children:"Edge Width"}),m.jsxs("span",{className:"text-xs",style:{color:l.text},children:[i,"px"]})]}),m.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:i,onChange:h=>s(parseFloat(h.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${l.accentPrimary} 0%, ${l.accentPrimary} ${(i-.5)/2.5*100}%, ${l.border} ${(i-.5)/2.5*100}%, ${l.border} 100%)`,accentColor:l.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Layout"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[m.jsx("div",{children:" Sample nodes are positioned based on the selected order"}),m.jsx("div",{children:" Internal nodes position themselves relative to descendants"}),m.jsx("div",{children:" Drag nodes to manually adjust positions"}),m.jsx("div",{children:" Use zoom and pan to navigate the graph"})]})]})]})]})},_O=({min:t,max:e,step:n=1,value:r,onChange:i,formatValue:s=l=>l.toString(),className:o=""})=>{const{colors:l}=Vt(),[u,d]=F.useState(null),[h,g]=F.useState({x:0,startValue:[0,0]}),[_,y]=F.useState(!1),[T,w]=F.useState(null),x=F.useRef(null);F.useEffect(()=>{const N=M=>{if(M.key==="Shift"){if(y(!0),T===null){const q=Math.abs(r[1]-r[0]);w(Math.max(q,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},I=M=>{M.key==="Shift"&&(y(!1),w(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",N),document.addEventListener("keyup",I),()=>{document.removeEventListener("keydown",N),document.removeEventListener("keyup",I),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,T,n]);const S=F.useCallback(N=>{if(!x.current)return t;const I=x.current.getBoundingClientRect(),M=Math.max(0,Math.min(1,(N-I.left)/I.width)),q=t+M*(e-t);return Math.round(q/n)*n},[t,e,n]),R=F.useCallback(N=>(N-t)/(e-t)*100,[t,e]),E=F.useCallback((N,I)=>{N.preventDefault(),N.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",d(I),g({x:N.clientX,startValue:r})},[r]),A=F.useCallback(N=>{if(!u||!x.current)return;const I=S(N.clientX),[M,q]=r;if(u==="left"){const X=Math.min(I,q-n);i([Math.max(t,X),q])}else if(u==="right"){const X=Math.max(I,M+n);i([M,Math.min(e,X)])}else if(u==="range"){const X=N.clientX-h.x,G=x.current.getBoundingClientRect(),L=X/G.width*(e-t),[J,V]=h.startValue;let $=Math.abs(V-J);_&&T!==null&&($=T);const ue=(J+V)/2+L;let P,H;_&&T!==null?(P=ue-$/2,H=ue+$/2):(P=J+L,H=V+L),P<t&&(P=t,H=t+$),H>e&&(H=e,P=e-$),i([Math.round(P/n)*n,Math.round(H/n)*n])}},[u,r,i,S,t,e,n,h,_,T]),k=F.useCallback(()=>{d(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);F.useEffect(()=>{if(u)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",k),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",k)}},[u,A,k]);const O=R(r[0]),j=R(r[1]);return m.jsxs("div",{className:`relative w-full ${o}`,style:{userSelect:"none"},children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:l.text},children:[m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(r[1])})]}),m.jsxs("div",{ref:x,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:l.containerBackground},onMouseDown:N=>{const I=S(N.clientX),[M,q]=r,X=Math.abs(I-M),G=Math.abs(I-q);_||Math.abs(q-M)<n*2?E(N,"range"):X<G?E(N,"left"):E(N,"right")},children:[m.jsx("div",{className:`absolute h-full rounded-full transition-opacity ${_?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{left:`${O}%`,width:`${j-O}%`,backgroundColor:_?l.text:l.textSecondary,opacity:_?.8:1,userSelect:"none"},onMouseDown:N=>{N.preventDefault(),N.stopPropagation(),E(N,"range")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${O}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:N=>{N.preventDefault(),N.stopPropagation(),E(N,"left")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${j}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:N=>{N.preventDefault(),N.stopPropagation(),E(N,"right")}})]}),m.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs",style:{color:l.text},children:[m.jsx("span",{children:s(t)}),m.jsx("div",{className:"flex items-center justify-center",children:_&&m.jsx("div",{className:"px-2 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:l.textSecondary,color:l.background,fontSize:"10px"},children:"Fixed Size"})}),m.jsx("span",{children:s(e)})]})]})},vO=({treeIntervals:t,value:e,onChange:n,className:r=""})=>{const{colors:i}=Vt(),[s,o]=F.useState(null),[l,u]=F.useState({x:0,startValue:[0,0]}),d=F.useRef(null);if(!t||t.length===0)return null;const h=0,g=t.length-1,_=t[g].right-t[0].left,y=F.useCallback(j=>{if(!d.current)return h;const N=d.current.getBoundingClientRect(),I=Math.max(0,Math.min(1,(j-N.left)/N.width)),M=t[0].left+I*_;for(let q=0;q<t.length;q++){const X=t[q],G=(X.left+X.right)/2;if(q===t.length-1||M<=G)return q}return g},[t,_]),T=F.useCallback(j=>{if(j<0||j>=t.length)return 0;const N=t[j];return((N.left+N.right)/2-t[0].left)/_*100},[t,_]),w=F.useCallback(j=>{if(j<0||j>=t.length)return"Invalid";const N=t[j];return`Tree ${j} (${N.left.toFixed(1)}-${N.right.toFixed(1)})`},[t]),x=F.useCallback((j,N)=>{if(j<0||N>=t.length||j>N)return"Invalid range";const I=t[j].left,M=t[N].right,q=M-I;return`${(G=>G>=1e6?`${(G/1e6).toFixed(1)}M`:G>=1e3?`${(G/1e3).toFixed(1)}K`:G.toFixed(1))(q)} bp (${I.toFixed(1)}-${M.toFixed(1)})`},[t]),S=F.useCallback((j,N)=>{j.preventDefault(),o(N),u({x:j.clientX,startValue:e})},[e]),R=F.useCallback(j=>{if(!s||!d.current)return;const N=y(j.clientX),[I,M]=e;if(s==="left")N<=M?n([Math.max(h,Math.min(g,N)),M]):n([M,Math.max(h,Math.min(g,N))]);else if(s==="right")N>=I?n([I,Math.max(h,Math.min(g,N))]):n([Math.max(h,Math.min(g,N)),I]);else if(s==="range"){const q=j.clientX-l.x,X=d.current.getBoundingClientRect(),L=q/X.width*_,[J,V]=l.startValue,$=(t[J].left+t[J].right)/2,Y=(t[V].left+t[V].right)/2,ue=$+L,P=Y+L;let H=J,ie=V;for(let U=0;U<t.length;U++){const Z=(t[U].left+t[U].right)/2;if(ue<=Z||U===t.length-1){H=U;break}}for(let U=0;U<t.length;U++){const Z=(t[U].left+t[U].right)/2;if(P<=Z||U===t.length-1){ie=U;break}}H=Math.max(h,Math.min(g,H)),ie=Math.max(h,Math.min(g,ie));const re=V-J;H!==ie&&Math.abs(ie-H)!==re&&(H+re<=g?ie=H+re:ie-re>=h&&(H=ie-re)),n([H,ie])}},[s,e,n,y,h,g,l,_,t]),E=F.useCallback(()=>{o(null)},[]);F.useEffect(()=>{if(s)return document.addEventListener("mousemove",R),document.addEventListener("mouseup",E),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",E)}},[s,R,E]);const A=T(e[0]),k=T(e[1]),O=e[1]-e[0]+1;return m.jsxs("div",{className:`relative w-full ${r}`,children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:i.text},children:[m.jsx("span",{children:w(e[0])}),m.jsx("span",{children:w(e[1])})]}),m.jsxs("div",{ref:d,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:i.containerBackground},onMouseDown:j=>{const N=y(j.clientX),[I,M]=e,q=Math.abs(N-I),X=Math.abs(N-M);q<X?S(j,"left"):S(j,"right")},children:[m.jsx("div",{className:"absolute h-full rounded-full cursor-grab active:cursor-grabbing",style:{left:`${A}%`,width:`${k-A}%`,backgroundColor:i.textSecondary},onMouseDown:j=>S(j,"range")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${A}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:j=>S(j,"left")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${k}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:j=>S(j,"right")})]}),m.jsxs("div",{className:"flex justify-between mt-1 text-xs",style:{color:i.text},children:[m.jsx("span",{children:"Tree 0"}),m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{children:[O," tree",O!==1?"s":""," selected"]}),m.jsx("div",{style:{color:i.textSecondary},children:x(e[0],e[1])})]}),m.jsxs("span",{children:["Tree ",g]})]})]})},CV=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u===o&&!i.has(d)&&(r.add(d),s.push(d))}))}return r},NV=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id;(typeof l.target=="number"?l.target:l.target.id)===o&&!i.has(u)&&(r.add(u),s.push(u))}))}return r},kV=1,MV=F.forwardRef(({filename:t,max_samples:e=25},n)=>{var Ge,vt,En,Rr,dr,jt;const{colors:r}=Vt(),{treeSequence:i}=Fs(),[s,o]=F.useState(null),[l,u]=F.useState(null),[d,h]=F.useState(null),[g,_]=F.useState(!0),[y,T]=F.useState("full"),[w,x]=F.useState(null),[S,R]=F.useState([0,0]),[E,A]=F.useState(0),[k,O]=F.useState(!1),[j,N]=F.useState([0,0]),[I,M]=F.useState(!1),[q,X]=F.useState(!1),[G,L]=F.useState("genomic"),[J,V]=F.useState([0,0]),[$,Y]=F.useState([0,0]),[ue,P]=F.useState(!1),[H,ie]=F.useState([]),[re,U]=F.useState(!1),[Z,oe]=F.useState("degree"),[_e,ye]=F.useState(!0),[Ae,Me]=F.useState({sample:8,root:6,other:5}),[Ze,It]=F.useState(kV),[_t,ut]=F.useState(!1),De=F.useCallback(xe=>xe.map(([Xe,nt,$e])=>({index:Xe,left:nt,right:$e})),[]);F.useEffect(()=>{re&&G==="genomic"&&M(!0);const xe=setTimeout(()=>{N(S),M(!1)},500);return()=>clearTimeout(xe)},[S,re,G]),F.useEffect(()=>{re&&G==="tree"&&P(!0);const xe=setTimeout(()=>{Y(J),P(!1)},500);return()=>clearTimeout(xe)},[J,re,G]),F.useEffect(()=>{const xe=async()=>{try{_(!0),console.log("Fetching initial graph data for file:",t,"with max_samples:",e);const nt=(await xt.getGraphData(t,{maxSamples:e,sampleOrder:Z})).data;if(console.log("Received initial graph data:",nt),nt.metadata.sequence_length){A(nt.metadata.sequence_length);const $e=[0,nt.metadata.sequence_length];R($e),N($e)}if(nt.metadata.tree_intervals&&nt.metadata.tree_intervals.length>0){const $e=De(nt.metadata.tree_intervals);ie($e);const yt=[0,$e.length-1];V(yt),Y(yt)}X(!0),o(nt),u(nt),h(null)}catch(Xe){console.error("Error fetching initial graph data:",Xe),h(Xe instanceof Error?Xe.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}};X(!1),U(!1),xe()},[t,e,De]),F.useEffect(()=>{if(!q)return;let xe=!1,Xe=null,nt=null;if(re&&(G==="genomic"?j[0]===0&&j[1]===E||(xe=!0,Xe={genomic_start:j[0],genomic_end:j[1]}):G==="tree"&&!($[0]===0&&$[1]===H.length-1)&&H.length>0&&(xe=!0,nt={tree_start_idx:$[0],tree_end_idx:$[1]})),!xe)if(!s||s.metadata.sample_order!==Z)xe=!0,console.log("Making API call due to sample order change");else{console.log("Skipping API call - using existing data (full range or filter disabled)");return}(async()=>{try{_(!0);let yt={maxSamples:e,sampleOrder:Z};Xe?(console.log("Fetching filtered graph data for genomic range:",j),yt.genomicStart=Xe.genomic_start,yt.genomicEnd=Xe.genomic_end):nt?(console.log("Fetching filtered graph data for tree range:",$),yt.treeStartIdx=nt.tree_start_idx,yt.treeEndIdx=nt.tree_end_idx):console.log("Fetching unfiltered graph data");const xo=(await xt.getGraphData(t,yt)).data;console.log("Received graph data:",xo),o(xo),h(null)}catch(yt){console.error("Error fetching graph data:",yt),h(yt instanceof Error?yt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}})()},[t,e,j,$,re,G,q,E,H,Z]),F.useEffect(()=>{re||ye(!0)},[re]);const tn=()=>{if(!s||!w)return s;switch(y){case"subgraph":{const xe=CV(w,s.nodes,s.edges);xe.add(w.id);const Xe=s.nodes.filter($e=>xe.has($e.id)),nt=s.edges.filter($e=>{const yt=typeof $e.source=="number"?$e.source:$e.source.id,qr=typeof $e.target=="number"?$e.target:$e.target.id;return xe.has(yt)&&xe.has(qr)});return{...s,nodes:Xe,edges:nt,metadata:{...s.metadata,is_subset:!0}}}case"ancestors":{const xe=NV(w,s.nodes,s.edges);xe.add(w.id);const Xe=s.nodes.filter($e=>xe.has($e.id)),nt=s.edges.filter($e=>{const yt=typeof $e.source=="number"?$e.source:$e.source.id,qr=typeof $e.target=="number"?$e.target:$e.target.id;return xe.has(yt)&&xe.has(qr)});return{...s,nodes:Xe,edges:nt,metadata:{...s.metadata,is_subset:!0}}}default:return s}},Ce=()=>{if(!l||!s||!i)return null;const xe=tn();return xe?{originalNodes:s.metadata.original_num_nodes||i.num_nodes,originalEdges:s.metadata.original_num_edges||i.num_edges,subArgNodes:l.nodes.length,subArgEdges:l.edges.length,displayedNodes:xe.nodes.length,displayedEdges:xe.edges.length}:null},ln=xe=>{y==="full"?(x(xe),T("subgraph")):(w==null?void 0:w.id)===xe.id?(T("full"),x(null)):(x(xe),T("subgraph"))},Gt=xe=>{x(xe),T("ancestors")},On=xe=>{console.log("Edge clicked:",xe)},_n=()=>{T("full"),x(null)},cn=F.useCallback(xe=>{(xe[0]!==S[0]||xe[1]!==S[1])&&R(xe)},[S]),Ye=F.useCallback(xe=>{(xe[0]!==J[0]||xe[1]!==J[1])&&V(xe)},[J]),we=F.useCallback(()=>{const xe=!re;if(U(xe),xe){if(G==="genomic")R([0,E]),N([0,E]);else if(G==="tree"&&H.length>0){const Xe=[0,H.length-1];V(Xe),Y(Xe)}ye(!1)}else ye(!0)},[re,G,E,H]),Re=F.useCallback(xe=>{if(L(xe),xe==="genomic")R([0,E]),N([0,E]);else if(xe==="tree"&&H.length>0){const Xe=[0,H.length-1];V(Xe),Y(Xe)}},[E,H]),We=F.useCallback(xe=>xe>=1e6?`${(xe/1e6).toFixed(1)}M`:xe>=1e3?`${(xe/1e3).toFixed(1)}K`:xe.toString(),[]),ze=()=>{let xe="";switch(y){case"subgraph":xe=`SubARG at Root ${w==null?void 0:w.id}`;break;case"ancestors":xe=`Parent ARG of Node ${w==null?void 0:w.id}`;break;default:xe="Full ARG"}return re&&(s==null?void 0:s.metadata.genomic_start)!==void 0&&(s==null?void 0:s.metadata.genomic_end)!==void 0&&(xe+=` (${We(s.metadata.genomic_start)} - ${We(s.metadata.genomic_end)})`),xe};return g?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:r.accentPrimary}}),m.jsx("p",{style:{color:r.text},children:"Loading force-directed ARG visualization..."})]})}):d?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",style:{color:r.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${r.text}B3`},children:d})]})}):m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:r.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:m.jsx("div",{className:"px-4 py-2",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:r.headerText},children:ze()}),(E>0||H.length>0)&&m.jsx("div",{className:"flex items-center gap-4",children:E>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:r.headerText},children:[m.jsx("input",{type:"checkbox",checked:re,onChange:we,className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:r.accentPrimary}}),"Filter Genomic Range"]})}),y!=="full"&&m.jsx("button",{onClick:_n,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:r.containerBackground,color:r.text,borderColor:`${r.accentPrimary}33`},onMouseEnter:xe=>{xe.currentTarget.style.borderColor=`${r.accentPrimary}66`,xe.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:xe=>{xe.currentTarget.style.borderColor=`${r.accentPrimary}33`,xe.currentTarget.style.backgroundColor=r.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[re&&m.jsxs("button",{onClick:()=>ye(!_e),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:r.accentPrimary,color:r.background},onMouseEnter:xe=>{xe.currentTarget.style.opacity="0.8"},onMouseLeave:xe=>{xe.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:_e?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${_e?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:r.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${r.nodeSample[0]}, ${r.nodeSample[1]}, ${r.nodeSample[2]})`,borderColor:r.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeDefault[0]}, ${r.nodeDefault[1]}, ${r.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeCombined[0]}, ${r.nodeCombined[1]}, ${r.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${r.nodeRoot[0]}, ${r.nodeRoot[1]}, ${r.nodeRoot[2]})`,borderColor:`rgb(${r.nodeSelected[0]}, ${r.nodeSelected[1]}, ${r.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:r.headerText,borderLeftColor:r.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})})}),re&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:!_e&&m.jsx("div",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsx("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:H.length>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:[m.jsx("button",{onClick:()=>Re("genomic"),className:`px-3 py-1 text-xs font-medium transition-colors ${G==="genomic"?"":"hover:opacity-80"}`,style:{backgroundColor:G==="genomic"?r.accentPrimary:r.containerBackground,color:G==="genomic"?r.background:r.text},children:"Genomic"}),m.jsx("button",{onClick:()=>Re("tree"),className:`px-3 py-1 text-xs font-medium transition-colors ${G==="tree"?"":"hover:opacity-80"}`,style:{backgroundColor:G==="tree"?r.accentPrimary:r.containerBackground,color:G==="tree"?r.background:r.text},children:"Tree Index"})]})]})}),m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:G==="genomic"&&E>0?m.jsx(_O,{min:0,max:E,step:Math.max(1,Math.floor(E/1e3)),value:S,onChange:cn,formatValue:We,className:"w-full"}):G==="tree"&&H.length>0?m.jsx(vO,{treeIntervals:H,value:J,onChange:Ye,className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:r.text},children:[G==="genomic"?m.jsxs("span",{children:[We(S[1]-S[0])," bp (",((S[1]-S[0])/E*100).toFixed(1),"%)",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",s.metadata.num_local_trees," trees"]})]}):G==="tree"&&H.length>0?m.jsxs("span",{children:["Trees ",J[0],"-",J[1]," (",J[1]-J[0]+1," of ",H.length,")",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",s.metadata.expected_tree_count??s.metadata.num_local_trees," displayed"]}),(s==null?void 0:s.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:["  (actual: ",s.metadata.num_local_trees,")"]})]}):null,g&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:r.accentPrimary}})]})]})]})})}),m.jsx("div",{className:"flex-1 overflow-hidden",children:m.jsxs("div",{className:"w-full h-full relative",children:[m.jsx(TV,{ref:n,data:tn(),onNodeClick:ln,onNodeRightClick:Gt,onEdgeClick:On,focalNode:w,nodeSizes:Ae,sampleOrder:Z,edgeThickness:Ze}),m.jsx(RV,{sampleOrder:Z,onSampleOrderChange:oe,nodeSizes:Ae,onNodeSizeChange:Me,edgeThickness:Ze,onEdgeThicknessChange:It,isLoading:g}),m.jsx(SV,{originalNodeCount:(Ge=Ce())==null?void 0:Ge.originalNodes,originalEdgeCount:(vt=Ce())==null?void 0:vt.originalEdges,subargNodeCount:(En=Ce())==null?void 0:En.subArgNodes,subargEdgeCount:(Rr=Ce())==null?void 0:Rr.subArgEdges,displayedNodeCount:(dr=Ce())==null?void 0:dr.displayedNodes,displayedEdgeCount:(jt=Ce())==null?void 0:jt.displayedEdges,genomicRange:re?S:void 0,sequenceLength:E,isFiltered:re,isFilterSectionCollapsed:_e})]})})]})});function IV(t){const e=t.querySelectorAll("circle, line, path, text, rect, ellipse, polygon, polyline");let n=1/0,r=-1/0,i=1/0,s=-1/0;if(e.forEach(u=>{try{const d=u.getBBox();d.width>0&&d.height>0&&(n=Math.min(n,d.x),r=Math.max(r,d.x+d.width),i=Math.min(i,d.y),s=Math.max(s,d.y+d.height))}catch(d){console.warn("Could not get bounding box for element:",u,d)}}),n===1/0){const u=t.viewBox.baseVal;n=u.x,i=u.y,r=u.x+u.width,s=u.y+u.height}const o=r-n,l=s-i;return{minX:n,maxX:r,minY:i,maxY:s,width:o,height:l,centerX:n+o/2,centerY:i+l/2}}async function OV(t,e){const{filename:n,padding:r=50,maxWidth:i=8192,maxHeight:s=8192,backgroundColor:o="#03303E",scale:l=3,watermark:u}=e;try{const d=IV(t),h=d.width+r*2,g=d.height+r*2,_=Math.min(i/h,s/g),y=Math.min(l,_),T=Math.round(h*y),w=Math.round(g*y),x=t.cloneNode(!0);x.removeAttribute("transform");const S=d.minX-r,R=d.minY-r;x.setAttribute("viewBox",`${S} ${R} ${h} ${g}`),x.setAttribute("width",T.toString()),x.setAttribute("height",w.toString()),x.setAttribute("shape-rendering","geometricPrecision"),x.setAttribute("text-rendering","geometricPrecision"),x.setAttribute("xmlns","http://www.w3.org/2000/svg"),x.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const E=document.createElementNS("http://www.w3.org/2000/svg","rect");E.setAttribute("x",S.toString()),E.setAttribute("y",R.toString()),E.setAttribute("width",h.toString()),E.setAttribute("height",g.toString()),E.setAttribute("fill",o),E.setAttribute("stroke","none"),x.insertBefore(E,x.firstChild),x.querySelectorAll("*").forEach(X=>{const G=window.getComputedStyle(X),L=X.getAttribute("style")||"";["fill","stroke","stroke-width","stroke-opacity","fill-opacity","opacity"].forEach(V=>{const $=V.replace(/([A-Z])/g,"-$1").toLowerCase(),Y=G.getPropertyValue($);Y&&Y!=="none"&&!X.hasAttribute($)&&X.setAttribute($,Y)})});const k=new XMLSerializer().serializeToString(x),O=new Blob([k],{type:"image/svg+xml;charset=utf-8"}),j=URL.createObjectURL(O),N=document.createElement("canvas");N.width=T,N.height=w;const I=N.getContext("2d",{alpha:!1});if(!I)throw new Error("Could not get canvas context");I.imageSmoothingEnabled=!0,I.imageSmoothingQuality="high",I.fillStyle=o,I.fillRect(0,0,T,w);const M=new Image,q=setTimeout(()=>{throw URL.revokeObjectURL(j),new Error("SVG loading timed out")},1e4);M.onload=()=>{clearTimeout(q);try{I.fillStyle=o,I.fillRect(0,0,T,w),I.globalCompositeOperation="source-over",I.drawImage(M,0,0,T,w),u&&m1(I,T,w,u),N.toBlob(X=>{if(!X)throw new Error("Failed to create image blob");g1(X,n)},"image/png",1),URL.revokeObjectURL(j)}catch(X){throw URL.revokeObjectURL(j),new Error(`Failed to draw SVG to canvas: ${X}`)}},M.onerror=X=>{throw clearTimeout(q),URL.revokeObjectURL(j),new Error(`Failed to load SVG image: ${X}`)},M.crossOrigin="anonymous",M.src=j}catch(d){throw console.error("Error exporting SVG image:",d),d}}async function PV(t,e,n){var d,h,g,_;const{filename:r,maxWidth:i=4096,maxHeight:s=4096,backgroundColor:o="#03303E",scale:l=2,watermark:u}=n;try{if(!e.current||!t.nodes.length)throw new Error("No 3D visualization data available for export");const{bounds:y,currentViewState:T}=t,w=(y.minX+y.maxX)/2,x=(y.minY+y.maxY)/2,S=(y.minZ+y.maxZ)/2,R=y.maxX-y.minX,E=y.maxY-y.minY,A=y.maxZ-y.minZ,k=Math.max(R,E,A),j=Math.max(.1,Math.min(3,1/(k*1.3)));let N=null;if((h=(d=e.current)==null?void 0:d.deck)!=null&&h.canvas)N=e.current.deck.canvas;else if((g=e.current)!=null&&g.canvas)N=e.current.canvas;else{const $=((_=e.current)==null?void 0:_.domElement)||e.current;$&&(N=$.querySelector("canvas"))}if(!N)throw new Error("Could not access DeckGL canvas - trying fallback method");const I={...T},M={...T,target:[w,x,S],zoom:j},q=N.width/N.height;let X=Math.min(i,2048*l),G=Math.min(s,X/q);G>s&&(G=s,X=G*q),X=Math.round(X),G=Math.round(G);const L=N.width,J=N.height,V={width:N.style.width,height:N.style.height};try{N.width=X,N.height=G,N.style.width=`${X}px`,N.style.height=`${G}px`,e.current.setProps({width:X,height:G,viewState:M}),await new Promise(ue=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(ue,200)})})});const $=document.createElement("canvas");$.width=X,$.height=G;const Y=$.getContext("2d");if(!Y)throw new Error("Could not get export canvas context");Y.imageSmoothingEnabled=!0,Y.imageSmoothingQuality="high",Y.fillStyle=o,Y.fillRect(0,0,X,G),Y.drawImage(N,0,0),u&&m1(Y,X,G,u),$.toBlob(ue=>{if(!ue)throw new Error("Failed to create image blob");g1(ue,r)},"image/png",1)}finally{N.width=L,N.height=J,N.style.width=V.width,N.style.height=V.height,e.current.setProps({width:L,height:J,viewState:I}),await new Promise($=>{requestAnimationFrame(()=>{requestAnimationFrame($)})})}}catch(y){throw console.error("Error exporting 3D visualization image:",y),y}}async function DV(t,e){const{filename:n,maxWidth:r=4096,maxHeight:i=4096,backgroundColor:s="#03303E",scale:o=2,watermark:l}=e;try{await new Promise(_=>requestAnimationFrame(_));const u=Math.min(r,t.width*o),d=Math.min(i,t.height*o),h=document.createElement("canvas");h.width=u,h.height=d;const g=h.getContext("2d");if(!g)throw new Error("Could not get canvas context");g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.fillStyle=s,g.fillRect(0,0,u,d),g.drawImage(t,0,0,u,d),l&&m1(g,u,d,l),h.toBlob(_=>{if(!_)throw new Error("Failed to create image blob");g1(_,n)},"image/png",1)}catch(u){throw console.error("Error exporting canvas image:",u),u}}function g1(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function m1(t,e,n,r){const{text:i,subtext:s,position:o="bottom-right",color:l="#14E2A8",backgroundColor:u="rgba(3, 48, 62, 0.8)",fontSize:d=24,fontFamily:h="Arial, sans-serif",opacity:g=.9}=r;t.save(),t.globalAlpha=g,t.font=`bold ${d}px ${h}`,t.textAlign="left",t.textBaseline="top";const _=t.measureText(i),y=s?t.measureText(s):{width:0},T=Math.max(_.width,y.width),w=d,x=4,S=s?w*2+x:w,R=16,E=12,A=T+R*2,k=S+E*2;let O,j;const N=20;switch(o){case"top-left":O=N,j=N;break;case"top-right":O=e-A-N,j=N;break;case"bottom-left":O=N,j=n-k-N;break;case"bottom-right":O=e-A-N,j=n-k-N;break;case"top-center":O=(e-A)/2,j=N;break;case"bottom-center":default:O=(e-A)/2,j=n-k-N;break}t.fillStyle=u,t.beginPath(),t.roundRect?t.roundRect(O,j,A,k,6):t.rect(O,j,A,k),t.fill(),t.fillStyle=l,t.fillText(i,O+R,j+E),s&&(t.font=`${Math.round(d*.7)}px ${h}`,t.fillStyle=l,t.fillText(s,O+R,j+E+w+x)),t.restore()}const Wd=(t,e)=>{const n=u=>{let d=u.replace("#","");if(d.length===3&&(d=d.split("").map(T=>T+T).join("")),d.length!==6)return console.warn("Invalid hex color:",u),0;const h=parseInt(d.substr(0,2),16)/255,g=parseInt(d.substr(2,2),16)/255,_=parseInt(d.substr(4,2),16)/255,y=T=>T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4);return .2126*y(h)+.7152*y(g)+.0722*y(_)};if(!t||!e)return console.warn("Missing colors for contrast check:",{color1:t,color2:e}),21;const r=n(t),i=n(e),s=Math.max(r,i),o=Math.min(r,i),l=(s+.05)/(o+.05);return t.toLowerCase()==="#ffffff"&&e.toLowerCase()==="#ffffff"&&console.log("White/white contrast check:",{color1:t,color2:e,lum1:r,lum2:i,ratio:l}),l},jV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&Wd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]})]})},BV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=FM(e),s=e[3],o=d=>{const h=LM(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&Wd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70 flex-shrink-0",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"flex-1 min-w-0"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-10 text-right flex-shrink-0",children:[Math.round(s/255*100),"%"]})]})]})},LV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=FM(e),s=e[3],o=d=>{const h=LM(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&Wd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"w-20"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-8 text-right",children:[Math.round(s/255*100),"%"]})]})]})})]})]})},UV=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&Wd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"})]})]})},FV=({isOpen:t,onClose:e,editingTheme:n})=>{const{saveCustomTheme:r,updateCustomTheme:i,currentVisualizationType:s}=Vt(),[o,l]=F.useState(""),[u,d]=F.useState(!1),[h,g]=F.useState(()=>{const N=[96,160,183,255],I=[153,153,153,102],M=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];return{background:"#03303E",containerBackground:"#0f1419",nodeDefault:N,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:N,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:M,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"}});F.useEffect(()=>{if(n)l(n.name),g(n.colors);else{l("");const N=[96,160,183,255],I=[153,153,153,102],M=[Math.min(255,Math.round(I[0]*1.5)),Math.min(255,Math.round(I[1]*1.5)),Math.min(255,Math.round(I[2]*1.5)),Math.min(255,Math.round(I[3]*1.3))];g({background:"#03303E",containerBackground:"#0f1419",nodeDefault:N,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:N,nodeSelected:[255,255,255,255],edgeDefault:I,edgeHighlight:M,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"})}},[n,t]),F.useEffect(()=>{const N=I=>{I.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",N),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",N),document.body.style.overflow="unset"}},[t,e]);const _=()=>{if(!o.trim()){alert("Please enter a theme name");return}n?i(n.id,o.trim(),h):r(o.trim(),h),e()},y=N=>I=>{g(M=>({...M,[N]:I}))},T=N=>I=>{g(M=>({...M,[N]:I}))},w=N=>{const I=N.replace("#",""),M=parseInt(I.substr(0,2),16),q=parseInt(I.substr(2,2),16),X=parseInt(I.substr(4,2),16);return(.299*M+.587*q+.114*X)/255>.5?"#000000":"#ffffff"},x=N=>{const I=w(N);g(M=>({...M,background:N,headerText:I,controlPanelText:I,buttonText:I,text:I}))},S=N=>{const I=[Math.min(255,Math.round(N[0]*1.5)),Math.min(255,Math.round(N[1]*1.5)),Math.min(255,Math.round(N[2]*1.5)),Math.min(255,Math.round(N[3]*1.3))];g(M=>({...M,edgeDefault:N,edgeHighlight:I}))},R=N=>{g(I=>({...I,nodeDefault:N,nodeCombined:N}))},E=UM(s),A=PL(s),k=N=>N==="nodeDefault"?R:N==="edgeDefault"?S:y(N),O=N=>({background:"Visualization Background",containerBackground:"Container Background",nodeDefault:"Internal Nodes (combined nodes will match)",nodeRoot:"Root Nodes",nodeSample:"Sample Nodes",nodeCombined:"Combined Nodes",nodeSelected:"Selected Nodes",edgeDefault:"Edges (highlighted edges will be auto-brightened)",edgeHighlight:"Highlighted Edges",text:"Primary Text",textSecondary:"Secondary Text",border:"Borders",exportBackground:"Export Background",accentPrimary:"Primary Accent",accentSecondary:"Secondary Accent",geographicGrid:"Geographic Shapes & Grid",temporalGrid:"Temporal Grid Lines",tooltipBackground:"Tooltip Background",tooltipText:"Tooltip Text",headerText:"Header Text",controlPanelText:"Control Panel Text",buttonText:"Button Text"})[N]||N,j=N=>{const I=h[N];return typeof I=="string"?m.jsx(UV,{label:O(N),value:I,onChange:N==="background"?x:T(N),backgroundColor:N==="tooltipText"?h.tooltipBackground:void 0},N):m.jsx(LV,{label:O(N),value:I,onChange:k(N),backgroundColor:h.background},N)};return t?m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden transform transition-all",children:m.jsxs("div",{className:"p-6 overflow-y-auto max-h-[85vh] overflow-x-hidden",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[m.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-sp-pale-green/10",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:n?"Edit Custom Theme":"Create Custom Theme"})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-sp-white mb-2",children:"Theme Name"}),m.jsx("input",{type:"text",value:o,onChange:N=>l(N.target.value),className:"w-full px-3 py-2 rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"Enter theme name...",maxLength:50})]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsx("h4",{className:"text-base font-semibold text-sp-pale-green",children:"Main Colors"}),E.map(N=>j(N))]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsxs("button",{onClick:()=>d(!u),className:"flex items-center gap-2 text-base font-semibold text-sp-pale-green hover:text-sp-very-pale-green transition-colors",children:[m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Other Colors"]}),u&&m.jsx("div",{className:"space-y-6 pl-6 border-l-2 border-sp-pale-green/20",children:m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 min-w-0",children:A.map(N=>{try{const I=h[N];return I?typeof I=="string"?m.jsx(jV,{label:O(N),value:I,onChange:T(N),backgroundColor:N==="tooltipText"?h.tooltipBackground:h.background},N):m.jsx(BV,{label:O(N),value:I,onChange:y(N),backgroundColor:h.background},N):null}catch(I){return console.warn(`Error rendering color picker for ${N}:`,I),null}})})})]}),m.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-sp-pale-green/20 bg-sp-dark-blue/20",children:[m.jsx("h4",{className:"text-sm font-semibold text-sp-pale-green mb-3",children:"Preview"}),m.jsxs("div",{className:"p-4 rounded border text-sm",style:{backgroundColor:h.background,borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`,color:h.text},children:[m.jsx("div",{style:{color:h.headerText},className:"font-semibold mb-2",children:"3D ARG Visualization"}),m.jsx("div",{style:{color:h.controlPanelText},className:"mb-3",children:"Control panel text sample"}),m.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Background"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:`rgba(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]}, ${h.nodeSample[3]/255})`,borderColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]}, ${h.nodeRoot[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Root"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]}, ${h.nodeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Internal"})]})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeDefault[0]}, ${h.edgeDefault[1]}, ${h.edgeDefault[2]}, ${h.edgeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Edges"}),m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeHighlight[0]}, ${h.edgeHighlight[1]}, ${h.edgeHighlight[2]}, ${h.edgeHighlight[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Highlighted"})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 border-2 rounded",style:{borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Geographic Grid"}),m.jsx("div",{className:"w-6 h-1 rounded",style:{backgroundColor:`rgba(${h.temporalGrid[0]}, ${h.temporalGrid[1]}, ${h.temporalGrid[2]}, ${h.temporalGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Temporal Grid"})]}),m.jsx("div",{className:"text-xs inline-block px-2 py-1 rounded",style:{color:h.tooltipText,backgroundColor:h.tooltipBackground,border:`1px solid rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, 0.3)`},children:"Sample tooltip text"})]})]}),m.jsxs("div",{className:"flex gap-3 mt-6",children:[m.jsx("button",{onClick:e,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:"Cancel"}),m.jsx("button",{onClick:_,disabled:!o.trim(),className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-4 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Update Theme":"Save Theme"})]})]})})]}):null},GN=[{value:"tskit",label:"tskit",icon:""},{value:"grayscale",label:"B&W",icon:""},{value:"custom",label:"Custom",icon:""}],yO=()=>{const{theme:t,setTheme:e,colors:n,customThemes:r,selectedCustomTheme:i,setSelectedCustomTheme:s,deleteCustomTheme:o}=Vt(),[l,u]=F.useState(!1),[d,h]=F.useState(!1),[g,_]=F.useState(null),[y,T]=F.useState({isOpen:!1,themeId:"",themeName:""}),w=F.useRef(null),x=GN.find(M=>M.value===t),S=t==="custom"&&i?r.find(M=>M.id===i):null;F.useEffect(()=>{const M=q=>{w.current&&!w.current.contains(q.target)&&u(!1)};return document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[]);const R=M=>{M==="custom"?r.length===0?(h(!0),_(null)):(e("custom"),i||s(r[0].id)):e(M),u(!1)},E=M=>{e("custom"),s(M),u(!1)},A=()=>{_(null),h(!0),u(!1)},k=M=>{const q=r.find(X=>X.id===M);q&&(_(q),h(!0)),u(!1)},O=M=>{const q=r.find(X=>X.id===M);q&&T({isOpen:!0,themeId:M,themeName:q.name}),u(!1)},j=()=>{o(y.themeId),T({isOpen:!1,themeId:"",themeName:""}),i===y.themeId&&r.length<=1&&e("tskit")},N=()=>t==="custom"&&S?S.name.length>12?`${S.name.slice(0,12)}...`:S.name:(x==null?void 0:x.label)||"Custom",I=()=>t==="custom"?"":(x==null?void 0:x.icon)||"";return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative",ref:w,children:[m.jsxs("button",{className:"font-medium px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1",style:{backgroundColor:n.containerBackground,color:n.text,border:`1px solid ${n.border}`},onMouseEnter:M=>{M.currentTarget.style.backgroundColor=n.border},onMouseLeave:M=>{M.currentTarget.style.backgroundColor=n.containerBackground},onClick:()=>u(!l),title:"Select color theme",children:[I()," ",N(),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&m.jsxs("div",{className:"absolute right-0 mt-1 py-1 rounded-md shadow-lg z-50 min-w-[160px] max-w-[250px]",style:{backgroundColor:n.containerBackground,border:`1px solid ${n.border}`},children:[GN.filter(M=>M.value!=="custom").map(M=>m.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:t===M.value?n.textSecondary:n.text,backgroundColor:t===M.value?n.border:"transparent"},onMouseEnter:q=>{t!==M.value&&(q.currentTarget.style.backgroundColor=n.border)},onMouseLeave:q=>{t!==M.value&&(q.currentTarget.style.backgroundColor="transparent")},onClick:()=>R(M.value),children:[M.icon," ",M.label,t===M.value&&m.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},M.value)),m.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),m.jsx("div",{className:"px-3 py-1",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-xs font-medium",style:{color:n.textSecondary},children:"Custom Themes"}),m.jsx("button",{onClick:A,className:"text-xs hover:underline",style:{color:n.textSecondary},title:"Create new custom theme",children:"+ New"})]})}),r.length===0?m.jsx("div",{className:"px-3 py-2 text-xs",style:{color:n.text+"80"},children:"No custom themes yet"}):r.map(M=>m.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors group",style:{backgroundColor:t==="custom"&&i===M.id?n.border:"transparent"},onMouseEnter:q=>{t==="custom"&&i===M.id||(q.currentTarget.style.backgroundColor=n.border)},onMouseLeave:q=>{t==="custom"&&i===M.id||(q.currentTarget.style.backgroundColor="transparent")},children:[m.jsxs("button",{onClick:()=>E(M.id),className:"flex-1 text-left flex items-center gap-2 min-w-0",style:{color:t==="custom"&&i===M.id?n.textSecondary:n.text},children:["",m.jsx("span",{className:"truncate",children:M.name}),t==="custom"&&i===M.id&&m.jsx("svg",{className:"w-4 h-4 ml-auto flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),m.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[m.jsx("button",{onClick:()=>k(M.id),className:"p-1 rounded hover:bg-opacity-20",style:{color:n.textSecondary},title:"Edit theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),m.jsx("button",{onClick:()=>O(M.id),className:"p-1 rounded hover:bg-red-500 hover:bg-opacity-20",style:{color:"#ef4444"},title:"Delete theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},M.id)),r.length>0&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),m.jsx("button",{onClick:A,className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:n.textSecondary},onMouseEnter:M=>{M.currentTarget.style.backgroundColor=n.border},onMouseLeave:M=>{M.currentTarget.style.backgroundColor="transparent"},children:" Create New Theme"})]})]})]}),m.jsx(FV,{isOpen:d,onClose:()=>{h(!1),_(null)},editingTheme:g}),m.jsx(VM,{isOpen:y.isOpen,title:"Delete Custom Theme",message:`Are you sure you want to delete the custom theme "${y.themeName}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",cancelText:"Cancel",onConfirm:j,onCancel:()=>T({isOpen:!1,themeId:"",themeName:""})})]})};function zV(){const{filename:t}=MM(),e=uc(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Fs(),{colors:s,setCurrentVisualizationType:o}=Vt(),l=F.useRef(null),[u,d]=F.useState(!1);if(F.useEffect(()=>{o("force-directed")},[o]),!t)return m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4 transition-colors",onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=y=>{Se.user.action("switch-tree-sequence-force-directed",{treeSequence:y},"ArgVisualizationPage"),i(y),d(!1),e(`/visualize/${encodeURIComponent(y.filename)}`)},_=async()=>{const y=l.current;if(y)try{const T=`${h.replace(/\.(trees|tsz)$/,"")}_arg.png`;await OV(y,{filename:T,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:3,watermark:{text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"}}),console.log("High-resolution ARG image downloaded successfully")}catch(T){console.error("Error downloading ARG image:",T)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.color=`${s.accentPrimary}CC`},onMouseLeave:y=>{y.currentTarget.style.color=s.accentPrimary},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(fc,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"ARG Visualization"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(yO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download ARG visualization as PNG",children:"Download Image"}),r&&m.jsx(Fx,{filename:r.filename})]})]})]})}),m.jsx(zx,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:F.useMemo(()=>m.jsx(MV,{ref:l,filename:h,max_samples:n}),[h,n])})]})}function VV(){const e=cc().pathname.startsWith("/visualize"),{colors:n,theme:r}=Vt(),s=e&&!(e&&r==="custom")?n:null;return m.jsx("footer",{className:`fixed bottom-0 left-0 right-0 py-4 text-center text-sm backdrop-blur-sm border-t z-50 ${e?"":"text-sp-white bg-sp-very-dark-blue/90 border-t-sp-dark-blue/50"}`,style:e&&s?{color:s.text,backgroundColor:s.background+"E6",borderTopColor:s.border+"80"}:{},children:m.jsxs("div",{className:"flex flex-col items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("p",{children:[" ",new Date().getFullYear()," ",m.jsx("a",{href:"https://chris-a-talbot.com",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-pale-green hover:text-sp-white transition-colors",style:e&&s?{color:s.accentPrimary}:{},children:"Chris Talbot"}),". All rights reserved."]}),m.jsx("a",{href:"https://github.com/chris-a-talbot/argscape",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary}:{},title:"View source on GitHub",children:m.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[m.jsx("span",{className:e?"":"text-sp-white/70",style:e&&s?{color:s.textSecondary,opacity:.7}:{},children:"Resources:"}),m.jsx("a",{href:"https://tskit.dev/",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tskit"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://tskit.dev/msprime/docs/stable/intro.html",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"msprime"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/chris-a-talbot/fastgaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"fastgaia"})]})]})})}const qV="modulepreload",$V=function(t){return"/"+t},KN={},ZN=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(d=>{if(d=$V(d),d in KN)return;KN[d]=!0;const h=d.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":qV,h||(_.as="script"),_.crossOrigin="",_.href=d,u&&_.setAttribute("nonce",u),document.head.appendChild(_),h)return new Promise((y,T)=>{_.addEventListener("load",y),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};function Nf(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const _1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),QN=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);QN&&parseFloat(QN[1]);const $u=globalThis,Pa=globalThis.process||{},HV=globalThis.navigator||{};function bO(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Hs(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||bO()}function WV(t){return Hs()?bO()?"Electron":(HV.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const xO="4.1.0";function XV(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class YV{constructor(e,n,r="sessionStorage"){this.storage=XV(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function GV(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function KV(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var kf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(kf||(kf={}));const ZV=10;function JN(t){return typeof t!="string"?t:(t=t.toUpperCase(),kf[t]||kf.WHITE)}function QV(t,e,n){return!Hs&&typeof t=="string"&&(e&&(t=`\x1B[${JN(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${JN(n)+ZV}m${t}\x1B[49m`)),t}function JV(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(t)))}}function v1(t,e){if(!t)throw new Error("Assertion failed")}function Da(){var e,n,r;let t;if(Hs()&&$u.performance)t=(n=(e=$u==null?void 0:$u.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Pa){const i=(r=Pa==null?void 0:Pa.hrtime)==null?void 0:r.call(Pa);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const ja={debug:Hs()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eq={enabled:!0,level:0};function Ba(){}const ek={},tk={once:!0};class bc{constructor({id:e}={id:""}){this.VERSION=xO,this._startTs=Da(),this._deltaTs=Da(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new YV(`__probe-${this.id}__`,eq),this.timeStamp(`${this.id} started`),JV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Da()-this._startTs).toPrecision(10))}getDelta(){return Number((Da()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ja.warn,arguments,tk)}error(e){return this._getLogFunction(0,e,ja.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ja.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ja.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ja.debug||ja.info,arguments,tk)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ba,r&&[r],{tag:nq(n)}):Ba}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ba)}group(e,n,r={collapsed:!1}){const i=nk({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ba)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=wO(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=nk({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,v1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Da();const o=s.tag||s.message;if(s.once&&o)if(!ek[o])ek[o]=Da();else return Ba;return n=tq(this.id,s.message,s),r.bind(console,n,...s.args)}return Ba}}bc.VERSION=xO;function wO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return v1(Number.isFinite(e)&&e>=0),e}function nk(t){const{logLevel:e,message:n}=t;t.logLevel=wO(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return v1(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function tq(t,e,n){if(typeof e=="string"){const r=n.time?KV(GV(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=QV(e,n.color,n.background)}return e}function nq(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const $b="4.3.2",rq=$b[0]>="0"&&$b[0]<="9"?`v${$b}`:"";function iq(){const t=new bc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=rq,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const sq=iq();function aq(t,e){return TO(t||{},e)}function TO(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=TO(r[i]||{},e[i],n+1):r[i]=e[i];return r}const oq="latest";function lq(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const cq=lq();function es(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Cs=typeof process!="object"||String(process)!=="[object process]"||process.browser,uq=typeof window<"u"&&typeof window.orientation<"u",rk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rk&&parseFloat(rk[1]);class fq{constructor(e,n){D(this,"name");D(this,"workerThread");D(this,"isRunning",!0);D(this,"result");D(this,"_resolve",()=>{});D(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){es(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){es(this.isRunning),this.isRunning=!1,this._reject(e)}}class Hb{terminate(){}}const Wb=new Map;function dq(t){es(t.source&&!t.url||!t.source&&t.url);let e=Wb.get(t.source||t.url);return e||(t.url&&(e=hq(t.url),Wb.set(t.url,e)),t.source&&(e=SO(t.source),Wb.set(t.source,e))),es(e),e}function hq(t){if(!t.startsWith("http"))return t;const e=pq(t);return SO(e)}function SO(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function pq(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function EO(t,e=!0,n){const r=n||new Set;if(t){if(ik(t))r.add(t);else if(ik(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)EO(t[i],e,r)}}return n===void 0?Array.from(r):[]}function ik(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Xb=()=>{};class z0{constructor(e){D(this,"name");D(this,"source");D(this,"url");D(this,"terminated",!1);D(this,"worker");D(this,"onMessage");D(this,"onError");D(this,"_loadableURL","");const{name:n,source:r,url:i}=e;es(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Xb,this.onError=s=>console.log(s),this.worker=Cs?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Cs||typeof Hb<"u"&&!Cs}destroy(){this.onMessage=Xb,this.onError=Xb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||EO(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=dq({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Hb(r,{eval:!1})}else if(this.source)e=new Hb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class gq{constructor(e){D(this,"name","unnamed");D(this,"source");D(this,"url");D(this,"maxConcurrency",1);D(this,"maxMobileConcurrency",1);D(this,"onDebug",()=>{});D(this,"reuseWorkers",!0);D(this,"props",{});D(this,"jobQueue",[]);D(this,"idleQueue",[]);D(this,"count",0);D(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return z0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new fq(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Cs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new z0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return uq?this.maxMobileConcurrency:this.maxConcurrency}}const mq={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},$i=class $i{constructor(e){D(this,"props");D(this,"workerPools",new Map);this.props={...mq},this.setProps(e),this.workerPools=new Map}static isSupported(){return z0.isSupported()}static getWorkerFarm(e={}){return $i._workerFarm=$i._workerFarm||new $i({}),$i._workerFarm.setProps(e),$i._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new gq({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};D($i,"_workerFarm");let Mf=$i;function _q(t,e={}){const n=e[t.id]||{},r=Cs?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Cs?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=oq);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return es(i),i}function vq(t,e=cq){es(t,"no worker provided");const n=t.version;return!(!e||!n)}function yq(t,e){return!Mf.isSupported()||!Cs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function bq(t,e,n,r,i){const s=t.id,o=_q(t,n),u=Mf.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",xq.bind(null,i));return d.postMessage("process",{input:e,options:n,context:r}),await(await d.result).result}async function xq(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await t(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function wq(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function Tq(...t){return Sq(t)}function Sq(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function Eq(t){const e=[];for await(const n of t)e.push(n);return Tq(...e)}function sk(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class ak{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=sk(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(sk()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Xd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof ak?i=e:i=new ak(n,r),this.stats[n]=i),i}}let Aq="";const ok={};function Rq(t){for(const e in ok)if(t.startsWith(e)){const n=ok[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Aq}${t}`),t}function Cq(t){return t&&typeof t=="object"&&t.isBuffer}function AO(t){if(Cq(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function RO(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Nq(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const kq=t=>typeof t=="boolean",Fl=t=>typeof t=="function",xc=t=>t!==null&&typeof t=="object",lk=t=>xc(t)&&t.constructor==={}.constructor,Mq=t=>!!t&&typeof t[Symbol.iterator]=="function",Iq=t=>t&&typeof t[Symbol.asyncIterator]=="function",Ws=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Xs=t=>typeof Blob<"u"&&t instanceof Blob,Oq=t=>t&&typeof t=="object"&&t.isBuffer,Pq=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||xc(t)&&Fl(t.tee)&&Fl(t.cancel)&&Fl(t.getReader),Dq=t=>xc(t)&&Fl(t.read)&&Fl(t.pipe)&&kq(t.readable),CO=t=>Pq(t)||Dq(t);class jq extends Error{constructor(n,r){super(n);D(this,"reason");D(this,"url");D(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const Bq=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Lq=/^([-\w.]+\/[-\w.+]+)/;function ck(t,e){return t.toLowerCase()===e.toLowerCase()}function Uq(t){const e=Lq.exec(t);return e?e[1]:t}function uk(t){const e=Bq.exec(t);return e?e[1]:""}const NO=/\?.*/;function Fq(t){const e=t.match(NO);return e&&e[0]}function y1(t){return t.replace(NO,"")}function zq(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Yd(t){return Ws(t)?t.url:Xs(t)?t.name||"":typeof t=="string"?t:""}function b1(t){if(Ws(t)){const e=t,n=e.headers.get("content-type")||"",r=y1(e.url);return Uq(n)||uk(r)}return Xs(t)?t.type||"":typeof t=="string"?uk(t):""}function Vq(t){return Ws(t)?t.headers["content-length"]||-1:Xs(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function kO(t){if(Ws(t))return t;const e={},n=Vq(t);n>=0&&(e["content-length"]=String(n));const r=Yd(t),i=b1(t);i&&(e["content-type"]=i);const s=await Hq(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function qq(t){if(!t.ok)throw await $q(t)}async function $q(t){const e=zq(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new jq(n,r)}async function Hq(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${Wq(n)}`}return null}function Wq(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function Xq(t){return!Yq(t)&&!Gq(t)}function Yq(t){return t.startsWith("http:")||t.startsWith("https:")}function Gq(t){return t.startsWith("data:")}async function fk(t,e){var n,r;if(typeof t=="string"){const i=Rq(t);return Xq(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await kO(t)}const dk=new bc({id:"loaders.gl"});class Kq{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Zq{constructor(){D(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const MO={fetch:null,mimeType:void 0,nothrow:!1,log:new Zq,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:_1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Qq={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function IO(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function OO(){const t=IO();return t.globalOptions=t.globalOptions||{...MO},t.globalOptions}function Jq(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],e$(t,n),n$(e,t,r)}function e$(t,e){hk(t,null,MO,Qq,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};hk(r,n.id,i,s,e)}}function hk(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in t){const u=!e&&xc(t[l]),d=l==="baseUri"&&!e,h=l==="workerUrl"&&e;if(!(l in n)&&!d&&!h){if(l in r)dk.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const g=t$(l,i);dk.warn(`${s} loader option '${o}${l}' not recognized. ${g}`)()}}}}function t$(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function n$(t,e,n){const i={...t.options||{}};return r$(i,n),i.log===null&&(i.log=new Kq),pk(i,OO()),pk(i,e),i}function pk(t,e){for(const n in e)if(n in e){const r=e[n];lk(r)&&lk(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function r$(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function x1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function w1(t){Nf(t,"null loader"),Nf(x1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const PO=()=>{const t=IO();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function i$(t){const e=PO();t=Array.isArray(t)?t:[t];for(const n of t){const r=w1(n);e.find(i=>r===i)||e.unshift(r)}}function s$(){return PO()}const a$=/\.([^.]+)$/;async function o$(t,e=[],n,r){if(!DO(t))return null;let i=gk(t,e,{...n,nothrow:!0},r);if(i)return i;if(Xs(t)&&(t=await t.slice(0,10).arrayBuffer(),i=gk(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(jO(t));return i}function gk(t,e=[],n,r){if(!DO(t))return null;if(e&&!Array.isArray(e))return w1(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...s$()),c$(i);const s=l$(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(jO(t));return s}function l$(t,e,n,r){const i=Yd(t),s=b1(t),o=y1(i)||(r==null?void 0:r.url);let l=null,u="";return n!=null&&n.mimeType&&(l=Yb(e,n==null?void 0:n.mimeType),u=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),l=l||u$(e,o),u=u||(l?`matched url ${o}`:""),l=l||Yb(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||d$(e,t),u=u||(l?`matched initial data ${BO(t)}`:""),n!=null&&n.fallbackMimeType&&(l=l||Yb(e,n==null?void 0:n.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&sq.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${u}.`),l}function DO(t){return!(t instanceof Response&&t.status===204)}function jO(t){const e=Yd(t),n=b1(t);let r="No valid loader found (";r+=e?`${RO(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?BO(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function c$(t){for(const e of t)w1(e)}function u$(t,e){const n=e&&a$.exec(e),r=n&&n[1];return r?f$(t,r):null}function f$(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Yb(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>ck(e,i))||ck(e,`application/x.${r.id}`))return r;return null}function d$(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(h$(e,n))return n}else if(ArrayBuffer.isView(e)){if(mk(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&mk(e,0,n))return n;return null}function h$(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function mk(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>p$(t,e,n,i))}function p$(t,e,n,r){if(r instanceof ArrayBuffer)return wq(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=V0(t,e,r.length);return r===i;default:return!1}}function BO(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?V0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?V0(t,0,e):""}function V0(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const g$=256*1024;function*m$(t,e){const n=(e==null?void 0:e.chunkSize)||g$;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const _$=256*1024;function*v$(t,e={}){const{chunkSize:n=_$}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const y$=1024*1024;async function*b$(t,e){const n=(e==null?void 0:e.chunkSize)||y$;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function _k(t,e){return _1?x$(t,e):w$(t)}async function*x$(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield AO(o)}}catch{n.releaseLock()}}async function*w$(t,e){for await(const n of t)yield AO(n)}function T$(t,e){if(typeof t=="string")return m$(t,e);if(t instanceof ArrayBuffer)return v$(t,e);if(Xs(t))return b$(t,e);if(CO(t))return _k(t,e);if(Ws(t))return _k(t.body,e);throw new Error("makeIterator")}const LO="Cannot convert supplied data type";function S$(t,e,n){if(e.text&&typeof t=="string")return t;if(Oq(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(LO)}async function E$(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return S$(t,e);if(Xs(t)&&(t=await kO(t)),Ws(t)){const i=t;return await qq(i),e.binary?await i.arrayBuffer():await i.text()}if(CO(t)&&(t=T$(t,n)),Mq(t)||Iq(t))return Eq(t);throw new Error(LO)}function UO(t,e){const n=OO(),r=t||n;return typeof r.fetch=="function"?r.fetch:xc(r.fetch)?i=>fk(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:fk}function A$(t,e,n){if(n)return n;const r={fetch:UO(e,t),...t};if(r.url){const i=y1(r.url);r.baseUrl=i,r.queryString=Fq(r.url),r.filename=RO(i),r.baseUrl=Nq(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function R$(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function If(t,e,n,r){e&&!Array.isArray(e)&&!x1(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Yd(t),o=R$(e,r),l=await o$(t,o,n);return l?(n=Jq(n,l,o,i),r=A$({url:i,_parse:If,loaders:o},n,r||null),await C$(l,t,n,r)):null}async function C$(t,e,n,r){if(vq(t),n=aq(t.options,n),Ws(e)){const s=e,{ok:o,redirected:l,status:u,statusText:d,type:h,url:g}=s,_=Object.fromEntries(s.headers.entries());r.response={headers:_,ok:o,redirected:l,status:u,statusText:d,type:h,url:g}}e=await E$(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(yq(t,n))return await bq(t,e,n,r,If);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw es(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function q0(t,e,n,r){let i,s;!Array.isArray(e)&&!x1(e)?(i=[],s=e):(i=e,s=n);const o=UO(s);let l=t;return typeof t=="string"&&(l=await o(t)),Xs(t)&&(l=await o(t)),Array.isArray(i)?await If(l,i,s):await If(l,i,s)}const N$="4.3.2";var xM;const k$=(xM=globalThis.loaders)==null?void 0:xM.parseImageNode,$0=typeof Image<"u",H0=typeof ImageBitmap<"u",M$=!!k$,W0=_1?!0:M$;function I$(t){switch(t){case"auto":return H0||$0||W0;case"imagebitmap":return H0;case"image":return $0;case"data":return W0;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function O$(){if(H0)return"imagebitmap";if($0)return"image";if(W0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function P$(t){const e=j$(t);if(!e)throw new Error("Not an image");return e}function D$(t){switch(P$(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function j$(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const B$=/^data:image\/svg\+xml/,L$=/\.svg((\?|#).*)?$/;function T1(t){return t&&(B$.test(t)||L$.test(t))}function U$(t,e){if(T1(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return FO(t,e)}function FO(t,e){if(T1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function zO(t,e,n){const r=U$(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await F$(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function F$(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const z$={};let vk=!0;async function V$(t,e,n){let r;T1(n)?r=await zO(t,e,n):r=FO(t,n);const i=e&&e.imagebitmap;return await q$(r,i)}async function q$(t,e=null){if(($$(e)||!vk)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),vk=!1}return await createImageBitmap(t)}function $$(t){for(const e in t||z$)return!1;return!0}function H$(t){return!G$(t,"ftyp",4)||(t[8]&96)===0?null:W$(t)}function W$(t){switch(X$(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function X$(t,e,n){return String.fromCharCode(...t.slice(e,n))}function Y$(t){return[...t].map(e=>e.charCodeAt(0))}function G$(t,e,n=0){const r=Y$(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Br=!1,zl=!0;function VO(t){const e=wc(t);return Z$(e)||eH(e)||Q$(e)||J$(e)||K$(e)}function K$(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=H$(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function Z$(t){const e=wc(t);return e.byteLength>=24&&e.getUint32(0,Br)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Br),height:e.getUint32(20,Br)}:null}function Q$(t){const e=wc(t);return e.byteLength>=10&&e.getUint32(0,Br)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,zl),height:e.getUint16(8,zl)}:null}function J$(t){const e=wc(t);return e.byteLength>=14&&e.getUint16(0,Br)===16973&&e.getUint32(2,zl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,zl),height:e.getUint32(22,zl)}:null}function eH(t){const e=wc(t);if(!(e.byteLength>=3&&e.getUint16(0,Br)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=tH();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Br);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Br),width:e.getUint16(s+7,Br)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Br)}return null}function tH(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function wc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function nH(t,e){var i;const{mimeType:n}=VO(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Nf(r),await r(t,n)}async function rH(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=iH(i);let l;switch(o){case"imagebitmap":l=await V$(t,e,s);break;case"image":l=await zO(t,e,s);break;case"data":l=await nH(t);break;default:Nf(!1)}return i==="data"&&(l=D$(l)),l}function iH(t){switch(t){case"auto":case"data":return O$();default:return I$(t),t}}const sH=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],aH=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],oH={image:{type:"auto",decode:!0}},lH={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:N$,mimeTypes:aH,extensions:sH,parse:rH,tests:[t=>!!VO(new DataView(t))],options:oH},mt=new bc({id:"deck"});let X0={};function cH(t){X0=t}function xn(t,e,n,r){mt.level>0&&X0[t]&&X0[t].call(null,e,n,r)}function uH(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const fH={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:uH,parseTextSync:JSON.parse};function dH(){const t="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(mt.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:mt,_registerLoggers:cH},i$([fH,[lH,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const hH=dH();function S1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Gb={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function pH(t){const e={};for(const[n,r]of Object.entries(t))e[n]=gH(r);return e}function gH(t){let e=yk(t);if(e!=="object")return{value:t,...Gb[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Gb[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=yk(t.value),{...t,...Gb[e],type:e}):{type:"object",value:null};throw new Error("props")}function yk(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const mH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,_H=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,vH={vertex:mH,fragment:_H},bk=/void\s+main\s*\([^)]*\)\s*\{\n?/,xk=/}\n?[^{}]*$/,Kb=[],hf="__LUMA_INJECT_DECLARATIONS__";function yH(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=bH(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function bH(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Of(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((u,d)=>u.order-d.order),Kb.length=o.length;for(let u=0,d=o.length;u<d;++u)Kb[u]=o[u].injection;const l=`${Kb.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(hf,l));break;case"vs:#main-start":i&&(t=t.replace(bk,u=>u+l));break;case"vs:#main-end":i&&(t=t.replace(xk,u=>l+u));break;case"fs:#decl":i||(t=t.replace(hf,l));break;case"fs:#main-start":i||(t=t.replace(bk,u=>u+l));break;case"fs:#main-end":i||(t=t.replace(xk,u=>l+u));break;default:t=t.replace(s,u=>u+l)}}return t=t.replace(hf,""),r&&(t=t.replace(/\}\s*$/,s=>s+vH[e])),t}function Pf(t){t.map(e=>xH(e))}function xH(t){if(t.instance)return;Pf(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:yH(r),parsedDeprecations:wH(n)};e&&(i.propValidators=pH(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const d=u==null?void 0:u.value;return d&&(o[l]=d),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function qO(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function wH(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function E1(t){Pf(t);const e={},n={};$O({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Pf(r),r}function $O(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&$O({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function TH(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function SH(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=wk(t,EH),t;case"fragment":return t=wk(t,AH),t;default:throw new Error(e)}}const HO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],EH=[...HO,[Y0("attribute"),"in $1"],[Y0("varying"),"out $1"]],AH=[...HO,[Y0("varying"),"in $1"]];function wk(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Y0(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function WO(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function XO(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function RH(t,e){return{name:CH(t,e),language:"glsl",version:NH(t)}}function CH(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function NH(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const YO=`

${hf}
`,kH=`precision highp float;
`;function MH(t){const e=E1(t.modules||[]);return{source:OH(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:GO(e)}}function IH(t){const{vs:e,fs:n}=t,r=E1(t.modules||[]);return{vs:Tk(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Tk(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:GO(r)}}function OH(t,e){var w;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;S1(typeof n=="string","shader source must be a string");const u=n;let d="";const h=XO(s),g={},_={},y={};for(const x in o){const S=typeof o[x]=="string"?{injection:o[x],order:0}:o[x],R=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(R){const E=R[2],A=R[3];E?A==="decl"?_[x]=[S]:y[x]=[S]:g[x]=[S]}else y[x]=[S]}const T=i;for(const x of T){l&&qO(x,u,l);const S=KO(x,"wgsl");d+=S;const R=((w=x.injections)==null?void 0:w[r])||{};for(const E in R){const A=/^(v|f)s:#([\w-]+)$/.exec(E);if(A){const O=A[2]==="decl"?_:y;O[E]=O[E]||[],O[E].push(R[E])}else g[E]=g[E]||[],g[E].push(R[E])}}return d+=YO,d=Of(d,r,_),d+=WO(h[r],g),d+=u,d=Of(d,r,y),d}function Tk(t,e){var j;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:d={},prologue:h=!0,log:g}=e;S1(typeof r=="string","shader source must be a string");const _=s==="glsl"?RH(r).version:-1,y=t.shaderLanguageVersion,T=_===100?"#version 100":"#version 300 es",x=r.split(`
`).slice(1).join(`
`),S={};o.forEach(N=>{Object.assign(S,N.defines)}),Object.assign(S,l);let R="";switch(s){case"wgsl":break;case"glsl":R=h?`${T}

// ----- PROLOGUE -------------------------
${PH({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${TH(t)}
${i==="fragment"?kH:""}

// ----- APPLICATION DEFINES -------------------------

${DH(S)}

`:`${T}
`;break}const E=XO(u),A={},k={},O={};for(const N in d){const I=typeof d[N]=="string"?{injection:d[N],order:0}:d[N],M=/^(v|f)s:(#)?([\w-]+)$/.exec(N);if(M){const q=M[2],X=M[3];q?X==="decl"?k[N]=[I]:O[N]=[I]:A[N]=[I]}else O[N]=[I]}for(const N of o){g&&qO(N,x,g);const I=KO(N,i);R+=I;const M=((j=N.instance)==null?void 0:j.normalizedInjections[i])||{};for(const q in M){const X=/^(v|f)s:#([\w-]+)$/.exec(q);if(X){const L=X[2]==="decl"?k:O;L[q]=L[q]||[],L[q].push(M[q])}else A[q]=A[q]||[],A[q].push(M[q])}}return R+="// ----- MAIN SHADER SOURCE -------------------------",R+=YO,R=Of(R,i,k),R+=WO(E[i],A),R+=x,R=Of(R,i,O),s==="glsl"&&_!==y&&(R=SH(R,i)),R.trim()}function GO(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function PH(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function DH(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function KO(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:S1(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const jH=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,BH=/^\s*\#\s*endif\s*$/;function LH(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const l of n){const u=l.match(jH),d=l.match(BH);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):d?i=!0:i&&r.push(l)}return r.join(`
`)}const Ts=class Ts{constructor(){D(this,"_hookFunctions",[]);D(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ts.defaultShaderAssembler=Ts.defaultShaderAssembler||new Ts,Ts.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=MH({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?LH(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...IH({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;n[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(n[i++]=l,r[u]=!0)}return n.length=i,Pf(n),n}};D(Ts,"defaultShaderAssembler");let Df=Ts;const UH=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FH=`#version 300 es
${UH}`;function zH(t){const{input:e,inputChannels:n,output:r}={};if(!e)return FH;if(!n)throw new Error("inputChannels");const i=VH(n),s=qH(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function VH(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function qH(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class $H{constructor(){D(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Xd({id:e})),this.stats.get(e)}}const ZO=new $H,be=new bc({id:"luma.gl"}),Zb={};function Gd(t="id"){Zb[t]=Zb[t]||1;const e=Zb[t]++;return`${t}-${e}`}var N0;let ct=(N0=class{constructor(e,n,r){D(this,"id");D(this,"props");D(this,"userData",{});D(this,"_device");D(this,"destroyed",!1);D(this,"allocatedBytes",0);D(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=HH(n,r);const i=this.props.id!=="undefined"?this.props.id:Gd(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},D(N0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),N0);function HH(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const an=class an extends ct{constructor(n,r){const i={...r};(r.usage||0)&an.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,an.defaultProps);D(this,"usage");D(this,"indexType");D(this,"updateTimestamp");D(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,an.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};D(an,"defaultProps",{...ct.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),D(an,"MAP_READ",1),D(an,"MAP_WRITE",2),D(an,"COPY_SRC",4),D(an,"COPY_DST",8),D(an,"INDEX",16),D(an,"VERTEX",32),D(an,"UNIFORM",64),D(an,"STORAGE",128),D(an,"INDIRECT",256),D(an,"QUERY_RESOLVE",512),D(an,"DEBUG_DATA_MAX_LENGTH",32);let wt=an;function QO(t){const e=Sk[t],n=WH(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Sk[t],byteLength:n,integer:i,signed:s,normalized:r}}function WH(t){return XH[t]}const Sk={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},XH={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},hn="texture-compression-bc",lt="texture-compression-astc",Or="texture-compression-etc2",YH="texture-compression-etc1-webgl",Hu="texture-compression-pvrtc-webgl",Qb="texture-compression-atc-webgl",Wu="float32-renderable-webgl",Jb="float16-renderable-webgl",GH="rgb9e5ufloat-renderable-webgl",e0="snorm8-renderable-webgl",Tl="norm16-renderable-webgl",t0="snorm16-renderable-webgl",Xu="float32-filterable",Ek="float16-filterable-webgl";function JO(t){const e=KH[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const KH={r8unorm:{},r8snorm:{render:e0},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:e0},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Jb,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Tl},"r16snorm-webgl":{f:t0},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:e0},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Jb,filter:Ek},"rg16unorm-webgl":{render:Tl},"rg16snorm-webgl":{render:t0},r32uint:{},r32sint:{},r32float:{render:Wu,filter:Xu},rgb9e5ufloat:{channels:"rgb",packed:!0,render:GH},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Wu},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Tl},"rgb16snorm-webgl":{f:Tl},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Xu},rgba16uint:{},rgba16sint:{},rgba16float:{render:Jb,filter:Ek},"rgba16unorm-webgl":{render:Tl},"rgba16snorm-webgl":{render:t0},"rgb32float-webgl":{render:Wu,filter:Xu},rgba32uint:{},rgba32sint:{},rgba32float:{render:Wu,filter:Xu},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:hn},"bc1-rgb-unorm-srgb-webgl":{f:hn},"bc1-rgba-unorm":{f:hn},"bc1-rgba-unorm-srgb":{f:hn},"bc2-rgba-unorm":{f:hn},"bc2-rgba-unorm-srgb":{f:hn},"bc3-rgba-unorm":{f:hn},"bc3-rgba-unorm-srgb":{f:hn},"bc4-r-unorm":{f:hn},"bc4-r-snorm":{f:hn},"bc5-rg-unorm":{f:hn},"bc5-rg-snorm":{f:hn},"bc6h-rgb-ufloat":{f:hn},"bc6h-rgb-float":{f:hn},"bc7-rgba-unorm":{f:hn},"bc7-rgba-unorm-srgb":{f:hn},"etc2-rgb8unorm":{f:Or},"etc2-rgb8unorm-srgb":{f:Or},"etc2-rgb8a1unorm":{f:Or},"etc2-rgb8a1unorm-srgb":{f:Or},"etc2-rgba8unorm":{f:Or},"etc2-rgba8unorm-srgb":{f:Or},"eac-r11unorm":{f:Or},"eac-r11snorm":{f:Or},"eac-rg11unorm":{f:Or},"eac-rg11snorm":{f:Or},"astc-4x4-unorm":{f:lt},"astc-4x4-unorm-srgb":{f:lt},"astc-5x4-unorm":{f:lt},"astc-5x4-unorm-srgb":{f:lt},"astc-5x5-unorm":{f:lt},"astc-5x5-unorm-srgb":{f:lt},"astc-6x5-unorm":{f:lt},"astc-6x5-unorm-srgb":{f:lt},"astc-6x6-unorm":{f:lt},"astc-6x6-unorm-srgb":{f:lt},"astc-8x5-unorm":{f:lt},"astc-8x5-unorm-srgb":{f:lt},"astc-8x6-unorm":{f:lt},"astc-8x6-unorm-srgb":{f:lt},"astc-8x8-unorm":{f:lt},"astc-8x8-unorm-srgb":{f:lt},"astc-10x5-unorm":{f:lt},"astc-10x5-unorm-srgb":{f:lt},"astc-10x6-unorm":{f:lt},"astc-10x6-unorm-srgb":{f:lt},"astc-10x8-unorm":{f:lt},"astc-10x8-unorm-srgb":{f:lt},"astc-10x10-unorm":{f:lt},"astc-10x10-unorm-srgb":{f:lt},"astc-12x10-unorm":{f:lt},"astc-12x10-unorm-srgb":{f:lt},"astc-12x12-unorm":{f:lt},"astc-12x12-unorm-srgb":{f:lt},"pvrtc-rgb4unorm-webgl":{f:Hu},"pvrtc-rgba4unorm-webgl":{f:Hu},"pvrtc-rbg2unorm-webgl":{f:Hu},"pvrtc-rgba2unorm-webgl":{f:Hu},"etc1-rbg-unorm-webgl":{f:YH},"atc-rgb-unorm-webgl":{f:Qb},"atc-rgba-unorm-webgl":{f:Qb},"atc-rgbai-unorm-webgl":{f:Qb}},ZH=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],QH=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function eP(t){return ZH.some(e=>t.startsWith(e))}function A1(t){let e=JH(t);if(eP(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=eW(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=QH.exec(t);if(n){const[,r,i,s,o,l]=n,u=`${s}${i}`,d=QO(u),h=d.byteLength*8,g=r.length,_=[h,g>=2?h:0,g>=3?h:0,g>=4?h:0];e={format:t,attachment:e.attachment,dataType:d.dataType,components:g,channels:r,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:_,bytesPerPixel:d.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function JH(t){var s;const e=JO(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function eW(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function tW(t){const e=JO(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=A1(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!l),n}class nW{}class rW{constructor(e=[],n){D(this,"features");D(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const od=class od{constructor(e){D(this,"id");D(this,"props");D(this,"userData",{});D(this,"statsManager",ZO);D(this,"timestamp",0);D(this,"_reused",!1);D(this,"_lumaData",{});this.props={...od.defaultProps,...e},this.id=this.props.id||Gd(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=tW(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return eP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&wt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":be.warn("indices buffer content must be of integer type")()),n}};D(od,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>be.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:be.get("debug")||void 0,debugShaders:be.get("debug-shaders")||void 0,debugFramebuffers:!!be.get("debug-framebuffers"),debugWebGL:!!be.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Qi=od;const iW=Hs()&&typeof document<"u",sW=()=>iW&&document.readyState==="complete",aW="set luma.log.level=1 (or higher) to trace rendering",Ak="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Hi=class Hi{constructor(){D(this,"stats",ZO);D(this,"log",be);D(this,"VERSION","9.1.9");D(this,"spector");D(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw be.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),be.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");be.error("This version of luma.gl has already been initialized")()}be.log(1,`${this.VERSION} - ${aW}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Hi.defaultProps,e)}async createDevice(e={}){var l;e={...Hi.defaultProps,...e},e.waitForPageLoad&&await Hi.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((l=s==null?void 0:s.create)==null?void 0:l.call(s,e));if(o)return o;throw new Error(Ak)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Hi.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(Ak)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||be.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){be.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};D(Hi,"defaultProps",{...Qi.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),D(Hi,"pageLoaded",oW().then(()=>{be.probe(2,"DOM is loaded")()}));let G0=Hi;const K0=new G0;function oW(){return sW()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class lW{}const ld=class ld{constructor(e){D(this,"id");D(this,"props");D(this,"canvas");D(this,"htmlCanvas");D(this,"offscreenCanvas");D(this,"type");D(this,"width",1);D(this,"height",1);D(this,"resizeObserver");D(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...ld.defaultProps,...e},e=this.props,!Hs()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=uW(e.canvas):this.canvas=e.canvas;else{const n=fW(e),r=cW((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return dW(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(be.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[h,g]=this.getDrawingBufferSize();(h!==l||g!==u)&&(o=Math.min(h/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),be.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};D(ld,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Z0=ld;function cW(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function uW(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function fW(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=Gd("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function dW(t,e,n,r,i){const s=t,o=Rk(s[0],e,n);let l=Ck(s[1],e,r,i),u=Rk(s[0]+1,e,n);const d=u===n-1?u:u-1;u=Ck(s[1]+1,e,r,i);let h;return i?(u=u===0?u:u+1,h=l,l=u):h=u===r-1?u:u-1,{x:o,y:l,width:Math.max(d-o+1,1),height:Math.max(h-l+1,1)}}function Rk(t,e,n){return Math.min(Math.round(t*e),n-1)}function Ck(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const on=class on extends ct{constructor(n,r){r=on.normalizeProps(n,r);super(n,r,on.defaultProps);D(this,"dimension");D(this,"format");D(this,"width");D(this,"height");D(this,"depth");D(this,"mipLevels");D(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=on.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?on.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return on.getTextureDataSize(n[0]);if(on.isExternalImage(n))return on.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var u,d;const i={...r},s=((d=(u=n==null?void 0:n.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:o,height:l}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}};D(on,"COPY_SRC",1),D(on,"COPY_DST",2),D(on,"TEXTURE",4),D(on,"STORAGE",8),D(on,"RENDER_ATTACHMENT",16),D(on,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),D(on,"defaultProps",{...ct.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),D(on,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let kt=on;const cd=class cd extends ct{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,cd.defaultProps)}};D(cd,"defaultProps",{...ct.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let jf=cd;function hW(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=tP(i[l-1],l,n);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=Nk(u,i,u.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=Nk(l,i,l.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Nk(t,e,n,r){if(r!=null&&r.inlineSource){const s=pW(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function pW(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=tP(s,e,n))}return r}function tP(t,e,n){const r=n!=null&&n.html?mW(t):t;return`${gW(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function gW(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function mW(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const ud=class ud extends ct{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:_W(r),...r},ud.defaultProps);D(this,"stage");D(this,"source");D(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=nP(this.source),i=`${this.stage} ${r}`;let s=hW(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};D(ud,"defaultProps",{...ct.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Bf=ud;function _W(t){return nP(t.source)||t.id||Gd(`unnamed ${t.stage}-shader`)}function nP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const Yl=class Yl extends ct{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=Yl.normalizeProps(e,n),super(e,n,Yl.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};D(Yl,"defaultProps",{...ct.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Lf=Yl;const fd=class fd extends ct{constructor(n,r={}){super(n,r,fd.defaultProps);D(this,"width");D(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(be.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof kt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof kt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:kt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:kt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};D(fd,"defaultProps",{...ct.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Uf=fd;const dd=class dd extends ct{constructor(n,r){super(n,r,dd.defaultProps);D(this,"shaderLayout");D(this,"bufferLayout");D(this,"linkStatus","pending");D(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};D(dd,"defaultProps",{...ct.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let no=dd;const vr=class vr extends ct{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=vr.normalizeProps(e,n),super(e,n,vr.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};D(vr,"defaultClearColor",[0,0,0,1]),D(vr,"defaultClearDepth",1),D(vr,"defaultClearStencil",0),D(vr,"defaultProps",{...ct.defaultProps,framebuffer:null,parameters:void 0,clearColor:vr.defaultClearColor,clearColors:void 0,clearDepth:vr.defaultClearDepth,clearStencil:vr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Q0=vr;const hd=class hd extends ct{constructor(n,r){super(n,r,hd.defaultProps);D(this,"hash","");D(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};D(hd,"defaultProps",{...ct.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Ff=hd;const pd=class pd extends ct{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,pd.defaultProps)}};D(pd,"defaultProps",{...ct.defaultProps,measureExecutionTime:void 0});let J0=pd;const gd=class gd extends ct{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,gd.defaultProps)}};D(gd,"defaultProps",{...ct.defaultProps});let ex=gd;function vW(t){const[e,n]=bW[t],r=e==="i32"||e==="u32",i=e!=="u32",s=xW[e]*n,o=yW(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function yW(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const bW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},xW={f32:4,f16:2,i32:4,u32:4};function rP(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=QO(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function iP(t,e){const n={};for(const r of t.attributes){const i=TW(t,e,r.name);i&&(n[r.name]=i)}return n}function wW(t,e,n=16){const r=iP(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function TW(t,e,n){const r=SW(t,n),i=EW(e,n);if(!r)return null;const s=vW(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,l=rP(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function SW(t,e){const n=t.attributes.find(r=>r.name===e);return n||be.warn(`shader layout attribute "${e}" not present in shader`),n||null}function EW(t,e){AW(t);let n=RW(t,e);return n||(n=CW(t,e),n)?n:(be.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function AW(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&be.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function RW(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function CW(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const l=rP(o.format);i+=l.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const md=class md extends ct{constructor(n,r){super(n,r,md.defaultProps);D(this,"maxVertexAttributes");D(this,"attributeInfos");D(this,"indexBuffer",null);D(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=wW(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};D(md,"defaultProps",{...ct.defaultProps,renderPipeline:null});let tx=md;const _d=class _d extends ct{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,_d.defaultProps)}};D(_d,"defaultProps",{...ct.defaultProps,layout:void 0,buffers:{}});let nx=_d;const vd=class vd extends ct{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,vd.defaultProps)}};D(vd,"defaultProps",{...ct.defaultProps,type:void 0,count:void 0});let rx=vd;const NW={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function kW(t){return NW[t]}function MW(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Yu;function sP(t){return(!Yu||Yu.byteLength<t)&&(Yu=new ArrayBuffer(t)),Yu}function IW(t,e){const n=sP(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function OW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function zf(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":OW(t)}const kk=1024;class PW{constructor(e){D(this,"layout",{});D(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=kW(s),{type:l,components:u}=o;n=MW(n,u);const d=n;n+=u,this.layout[i]={type:l,size:u,offset:d}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,kk)}getData(e){const n=Math.max(this.byteLength,kk),r=sP(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){be.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:h}=l,g=i[u];if(d===1){if(typeof o!="number"&&typeof o!="boolean"){be.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[h]=Number(o)}else{if(!zf(o)){be.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function DW(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!zf(r))return!1;if(zf(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function jW(t){return zf(t)?t.slice():t}class BW{constructor(e){D(this,"name");D(this,"uniforms",{});D(this,"modifiedUniforms",{});D(this,"modified",!0);D(this,"bindingLayout",{});D(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){DW(this.uniforms[e],n)||(this.uniforms[e]=jW(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class LW{constructor(e){D(this,"uniformBlocks",new Map);D(this,"uniformBufferLayouts",new Map);D(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new PW(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new BW({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:wt.UNIFORM|wt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:wt.UNIFORM|wt.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&be.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const l=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();be.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return i}}function aP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function oP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function UW(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=aP(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class n0{constructor(e){D(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&be.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function FW(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(h=>h.attribute):[i.name],l=s.attributes?s.attributes.map(h=>h.attribute):[s.name],u=Math.min(...o.map(h=>n[h])),d=Math.min(...l.map(h=>n[h]));return u-d}),r}class sr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Mk{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ki extends sr{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ji extends sr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class ix extends sr{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ps extends sr{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var qi;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(qi||(qi={}));class Gu{constructor(e,n,r,i,s,o,l){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class zW{constructor(e,n){this.name=e,this.type=n}}class VW{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Ik{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class qW{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class $W{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class HW{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class WW{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const lP=new Float32Array(1),XW=new Int32Array(lP.buffer),pn=new Uint16Array(1);function YW(t){lP[0]=t;const e=XW[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return pn[0]=n<<15|31744|(i!==0?512:0),pn[0];if(r===0){if(i===0)return pn[0]=n<<15,pn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),pn[0]=n<<15|r<<10|i>>13,pn[0]):(pn[0]=n<<15,pn[0])}return r=r-127+15,r>=31?(pn[0]=n<<15|31744,pn[0]):r<=0?r<-10?(pn[0]=n<<15,pn[0]):(i=(8388608|i)>>1-r,pn[0]=n<<15|i>>13,pn[0]):(i>>=13,pn[0]=n<<15|r<<10|i,pn[0])}const R1=new Uint32Array(1),cP=new Float32Array(R1.buffer,0,1);function Ok(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return R1[0]=e,cP[0]}function GW(t,e,n,r,i,s,o,l,u){const d=r*(o>>=i)*(s>>=i)+n*o+e*l;switch(u){case"r8unorm":return[Je(t,d,"8unorm",1)[0]];case"r8snorm":return[Je(t,d,"8snorm",1)[0]];case"r8uint":return[Je(t,d,"8uint",1)[0]];case"r8sint":return[Je(t,d,"8sint",1)[0]];case"rg8unorm":{const h=Je(t,d,"8unorm",2);return[h[0],h[1]]}case"rg8snorm":{const h=Je(t,d,"8snorm",2);return[h[0],h[1]]}case"rg8uint":{const h=Je(t,d,"8uint",2);return[h[0],h[1]]}case"rg8sint":{const h=Je(t,d,"8sint",2);return[h[0],h[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const h=Je(t,d,"8unorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8snorm":{const h=Je(t,d,"8snorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8uint":{const h=Je(t,d,"8uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba8sint":{const h=Je(t,d,"8sint",4);return[h[0],h[1],h[2],h[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const h=Je(t,d,"8unorm",4);return[h[2],h[1],h[0],h[3]]}case"r16uint":return[Je(t,d,"16uint",1)[0]];case"r16sint":return[Je(t,d,"16sint",1)[0]];case"r16float":return[Je(t,d,"16float",1)[0]];case"rg16uint":{const h=Je(t,d,"16uint",2);return[h[0],h[1]]}case"rg16sint":{const h=Je(t,d,"16sint",2);return[h[0],h[1]]}case"rg16float":{const h=Je(t,d,"16float",2);return[h[0],h[1]]}case"rgba16uint":{const h=Je(t,d,"16uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16sint":{const h=Je(t,d,"16sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16float":{const h=Je(t,d,"16float",4);return[h[0],h[1],h[2],h[3]]}case"r32uint":return[Je(t,d,"32uint",1)[0]];case"r32sint":return[Je(t,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Je(t,d,"32float",1)[0]];case"rg32uint":{const h=Je(t,d,"32uint",2);return[h[0],h[1]]}case"rg32sint":{const h=Je(t,d,"32sint",2);return[h[0],h[1]]}case"rg32float":{const h=Je(t,d,"32float",2);return[h[0],h[1]]}case"rgba32uint":{const h=Je(t,d,"32uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32sint":{const h=Je(t,d,"32sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32float":{const h=Je(t,d,"32float",4);return[h[0],h[1],h[2],h[3]]}case"rg11b10ufloat":{const h=new Uint32Array(t.buffer,d,1)[0],g=(4192256&h)>>11,_=(4290772992&h)>>22;return[Ok(2047&h),Ok(g),function(y){const T=112+(y>>5&31)<<23|(31&y)<<18;return R1[0]=T,cP[0]}(_),1]}}return null}function Je(t,e,n,r){const i=[0,0,0,0];for(let d=0;d<r;++d)switch(n){case"8unorm":i[d]=t[e]/255,e++;break;case"8snorm":i[d]=t[e]/255*2-1,e++;break;case"8uint":i[d]=t[e],e++;break;case"8sint":i[d]=t[e]-127,e++;break;case"16uint":i[d]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[d]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(s=t[e]|t[e+1]<<8,o=void 0,l=void 0,u=void 0,o=(32768&s)>>15,u=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):l==31?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+u/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,o,l,u;return i}function tt(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=YW(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const r0={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class fr{constructor(){this.id=fr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(Vf.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(qf.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}fr._id=0;class Vf extends fr{}Vf.instance=new Vf;class qf extends fr{}qf.instance=new qf;const uP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class St extends fr{constructor(){super()}}class ic extends St{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class KW extends St{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class fP extends St{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class sx extends St{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class dP extends St{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class ci extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class C1 extends St{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Vl extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class pf extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var qa,Pl,le,te;(t=>{t.increment="++",t.decrement="--"})(qa||(qa={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(qa||(qa={}));class hP extends St{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Pl||(Pl={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Pl||(Pl={}));class pP extends St{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class N1 extends St{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return uP.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class gP extends St{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class mP extends St{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class _P extends St{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class vP extends St{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class ZW extends St{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class QW extends St{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class yP extends St{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class k1 extends St{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class JW extends St{constructor(){super()}get astNodeType(){return"discard"}}class bP extends St{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class xP extends St{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class me extends St{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=me._priority.get(n.name);me._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?me.i32:n}getTypeName(){return this.name}}me.x32=new me("x32"),me.f32=new me("f32"),me.i32=new me("i32"),me.u32=new me("u32"),me.f16=new me("f16"),me.bool=new me("bool"),me.void=new me("void"),me._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Pk extends me{constructor(e){super(e)}}class oi extends me{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class ae extends me{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ae.vec2f=new ae("vec2",me.f32,null),ae.vec3f=new ae("vec3",me.f32,null),ae.vec4f=new ae("vec4",me.f32,null),ae.vec2i=new ae("vec2",me.i32,null),ae.vec3i=new ae("vec3",me.i32,null),ae.vec4i=new ae("vec4",me.i32,null),ae.vec2u=new ae("vec2",me.u32,null),ae.vec3u=new ae("vec3",me.u32,null),ae.vec4u=new ae("vec4",me.u32,null),ae.vec2h=new ae("vec2",me.f16,null),ae.vec3h=new ae("vec3",me.f16,null),ae.vec4h=new ae("vec4",me.f16,null),ae.vec2b=new ae("vec2",me.bool,null),ae.vec3b=new ae("vec3",me.bool,null),ae.vec4b=new ae("vec4",me.bool,null),ae.mat2x2f=new ae("mat2x2",me.f32,null),ae.mat2x3f=new ae("mat2x3",me.f32,null),ae.mat2x4f=new ae("mat2x4",me.f32,null),ae.mat3x2f=new ae("mat3x2",me.f32,null),ae.mat3x3f=new ae("mat3x3",me.f32,null),ae.mat3x4f=new ae("mat3x4",me.f32,null),ae.mat4x2f=new ae("mat4x2",me.f32,null),ae.mat4x3f=new ae("mat4x3",me.f32,null),ae.mat4x4f=new ae("mat4x4",me.f32,null),ae.mat2x2h=new ae("mat2x2",me.f16,null),ae.mat2x3h=new ae("mat2x3",me.f16,null),ae.mat2x4h=new ae("mat2x4",me.f16,null),ae.mat3x2h=new ae("mat3x2",me.f16,null),ae.mat3x3h=new ae("mat3x3",me.f16,null),ae.mat3x4h=new ae("mat3x4",me.f16,null),ae.mat4x2h=new ae("mat4x2",me.f16,null),ae.mat4x3h=new ae("mat4x3",me.f16,null),ae.mat4x4h=new ae("mat4x4",me.f16,null),ae.mat2x2i=new ae("mat2x2",me.i32,null),ae.mat2x3i=new ae("mat2x3",me.i32,null),ae.mat2x4i=new ae("mat2x4",me.i32,null),ae.mat3x2i=new ae("mat3x2",me.i32,null),ae.mat3x3i=new ae("mat3x3",me.i32,null),ae.mat3x4i=new ae("mat3x4",me.i32,null),ae.mat4x2i=new ae("mat4x2",me.i32,null),ae.mat4x3i=new ae("mat4x3",me.i32,null),ae.mat4x4i=new ae("mat4x4",me.i32,null),ae.mat2x2u=new ae("mat2x2",me.u32,null),ae.mat2x3u=new ae("mat2x3",me.u32,null),ae.mat2x4u=new ae("mat2x4",me.u32,null),ae.mat3x2u=new ae("mat3x2",me.u32,null),ae.mat3x3u=new ae("mat3x3",me.u32,null),ae.mat3x4u=new ae("mat3x4",me.u32,null),ae.mat4x2u=new ae("mat4x2",me.u32,null),ae.mat4x3u=new ae("mat4x3",me.u32,null),ae.mat4x4u=new ae("mat4x4",me.u32,null);class gf extends me{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class ql extends me{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Dl extends me{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Ar extends fr{constructor(){super(),this.postfix=null}}class Ds extends Ar{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class jr extends Ar{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class M1 extends Ar{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return uP.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Hn extends Ar{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class wP extends Ar{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Wt extends Ar{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof ee}get isVector(){return this.value instanceof W||this.value instanceof Oe}get scalarValue(){return this.value instanceof ee?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof W||this.value instanceof Oe?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class TP extends Ar{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class ro extends Ar{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class SP extends Ar{constructor(){super()}}class Ft extends SP{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class _r extends SP{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?me.f32:e.name==="u32"||n.name==="u32"?me.u32:me.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class EP extends fr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class mf extends Ar{constructor(){super()}get astNodeType(){return"default"}}class AP extends EP{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class RP extends EP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Dk extends fr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class eX extends fr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class jk extends fr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class CP extends fr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class lr{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=lr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}lr._id=0;class ax extends lr{constructor(){super(new sr("void",null),null)}toString(){return"void"}}ax.void=new ax;class La extends lr{constructor(e){super(new ix("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class ee extends lr{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new ee(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ee(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ee(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof ee))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function tX(t,e,n){const r=e.length;return r===2?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new W(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new W(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new W(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new W(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class W extends lr{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new W(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new W(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new W(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Ds?console.error("TODO: Set vector postfix"):n instanceof W?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ps)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof ro){const o=n.index;let l=-1;if(o instanceof Wt){if(!(o.value instanceof ee))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof ee))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ee(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ee(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ee(u,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Ds))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ee(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ee(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ee(d,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=tX(e,l,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Oe extends lr{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Oe(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Ds?console.error("TODO: Set matrix postfix"):n instanceof Oe?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ps)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof ro){const s=n.index;let o=-1;if(s instanceof Wt){if(!(s.value instanceof ee))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const d=e.evalExpression(s,r);if(!(d instanceof ee))return console.error("GetDataValue: Unknown index type",s),null;o=d.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return n.postfix?u.getSubData(e,n.postfix,r):u}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Mt extends lr{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Mt(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof ro)if(o instanceof Ji){const l=r.index;if(l instanceof Wt){if(!(l.value instanceof ee))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof ee))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Ds))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof Ki){let u=!1;for(const d of o.members)if(d.name===l){s+=d.offset,o=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof sr){const u=o.getTypeName();let d=0;if(l==="x"||l==="r")d=0;else if(l==="y"||l==="g")d=1;else if(l==="z"||l==="b")d=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);d=3}if(!(n instanceof ee))return void console.error("SetDataValue: Invalid value",n);const h=n.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=h):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=h):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=h):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=h):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=h):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=h):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=h):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=h):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(n instanceof Mt){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,i,16);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11],l[12]=n.data[12],l[13]=n.data[13],l[14]=n.data[14],l[15]=n.data[15]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,9);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,4);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Int32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Int32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Int32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Float32Array(this.buffer,i,4);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Float32Array(this.buffer,i,3);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Float32Array(this.buffer,i,2);n instanceof W?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else n instanceof ee&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof ee&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof ee&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof ee&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let l=this.offset,u=this.typeInfo;for(;n;){if(n instanceof ro){const h=n.index,g=h instanceof Ar?e.evalExpression(h,r):h;let _=0;if(g instanceof ee?_=g.value:typeof g=="number"?_=g:console.error("GetDataValue: Invalid index type",h),u instanceof Ji)l+=_*u.stride,u=u.format;else{const y=u.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(l+=16*_,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(n instanceof Ds))return console.error("GetDataValue: Unknown postfix type",n),null;{const h=n.value;if(u instanceof Ki){let g=!1;for(const _ of u.members)if(_.name===h){l+=_.offset,u=_.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${h} not found`),null}else if(u instanceof sr){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(h.length>0&&h.length<5){let _="f";const y=[];for(let T=0;T<h.length;++T){const w=h[T].toLowerCase();let x=0;if(w==="x"||w==="r")x=0;else if(w==="y"||w==="g")x=1;else if(w==="z"||w==="b")x=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${h}`),null;x=3}if(h.length===1){if(g.endsWith("f"))return this.buffer.byteLength<l+4*x+4?(console.log("Insufficient buffer data"),null):new ee(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new ee(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new ee(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new ee(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new ee(new Uint32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")y.push(new Float32Array(this.buffer,l,2)[x]);else if(g==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,l,3);y.push(S[x])}else if(g==="vec4f")y.push(new Float32Array(this.buffer,l,4)[x]);else if(g==="vec2i")_="i",y.push(new Int32Array(this.buffer,l,2)[x]);else if(g==="vec3i")_="i",y.push(new Int32Array(this.buffer,l,3)[x]);else if(g==="vec4i")_="i",y.push(new Int32Array(this.buffer,l,4)[x]);else if(g==="vec2u"){_="u";const S=new Uint32Array(this.buffer,l,2);y.push(S[x])}else g==="vec3u"?(_="u",y.push(new Uint32Array(this.buffer,l,3)[x])):g==="vec4u"&&(_="u",y.push(new Uint32Array(this.buffer,l,4)[x]))}return y.length===2?u=e.getTypeInfo(`vec2${_}`):y.length===3?u=e.getTypeInfo(`vec3${_}`):y.length===4?u=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new W(y,u,null)}return console.error(`GetDataValue: Unknown member ${h}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}n=n.postfix}const d=u.getTypeName();return d==="f32"?new ee(new Float32Array(this.buffer,l,1),u,this):d==="i32"?new ee(new Int32Array(this.buffer,l,1),u,this):d==="u32"?new ee(new Uint32Array(this.buffer,l,1),u,this):d==="vec2f"?new W(new Float32Array(this.buffer,l,2),u,this):d==="vec3f"?new W(new Float32Array(this.buffer,l,3),u,this):d==="vec4f"?new W(new Float32Array(this.buffer,l,4),u,this):d==="vec2i"?new W(new Int32Array(this.buffer,l,2),u,this):d==="vec3i"?new W(new Int32Array(this.buffer,l,3),u,this):d==="vec4i"?new W(new Int32Array(this.buffer,l,4),u,this):d==="vec2u"?new W(new Uint32Array(this.buffer,l,2),u,this):d==="vec3u"?new W(new Uint32Array(this.buffer,l,3),u,this):d==="vec4u"?new W(new Uint32Array(this.buffer,l,4),u,this):u instanceof Ps&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new ee(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new ee(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Mt(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof Ji)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof Ki?e+="{...}":e="[...]";return e}}class li extends lr{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new li(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=r0[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=r0[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=r0[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return GW(new Uint8Array(u),e,n,r,i,l,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,d=this.data[i];(function(h,g,_,y,T,w,x,S,R,E){const A=y*(x>>=T)*(w>>=T)+_*x+g*S;switch(R){case"r8unorm":return void tt(h,A,"8unorm",1,E);case"r8snorm":return void tt(h,A,"8snorm",1,E);case"r8uint":return void tt(h,A,"8uint",1,E);case"r8sint":return void tt(h,A,"8sint",1,E);case"rg8unorm":return void tt(h,A,"8unorm",2,E);case"rg8snorm":return void tt(h,A,"8snorm",2,E);case"rg8uint":return void tt(h,A,"8uint",2,E);case"rg8sint":return void tt(h,A,"8sint",2,E);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void tt(h,A,"8unorm",4,E);case"rgba8snorm":return void tt(h,A,"8snorm",4,E);case"rgba8uint":return void tt(h,A,"8uint",4,E);case"rgba8sint":return void tt(h,A,"8sint",4,E);case"r16uint":return void tt(h,A,"16uint",1,E);case"r16sint":return void tt(h,A,"16sint",1,E);case"r16float":return void tt(h,A,"16float",1,E);case"rg16uint":return void tt(h,A,"16uint",2,E);case"rg16sint":return void tt(h,A,"16sint",2,E);case"rg16float":return void tt(h,A,"16float",2,E);case"rgba16uint":return void tt(h,A,"16uint",4,E);case"rgba16sint":return void tt(h,A,"16sint",4,E);case"rgba16float":return void tt(h,A,"16float",4,E);case"r32uint":return void tt(h,A,"32uint",1,E);case"r32sint":return void tt(h,A,"32sint",1,E);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void tt(h,A,"32float",1,E);case"rg32uint":return void tt(h,A,"32uint",2,E);case"rg32sint":return void tt(h,A,"32sint",2,E);case"rg32float":return void tt(h,A,"32float",2,E);case"rgba32uint":return void tt(h,A,"32uint",4,E);case"rgba32sint":return void tt(h,A,"32sint",4,E);case"rgba32float":return void tt(h,A,"32float",4,E);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,n,r,i,u,l,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(te||(te={}));class ne{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class z{}le=z,z.none=new ne("",te.reserved,""),z.eof=new ne("EOF",te.token,""),z.reserved={asm:new ne("asm",te.reserved,"asm"),bf16:new ne("bf16",te.reserved,"bf16"),do:new ne("do",te.reserved,"do"),enum:new ne("enum",te.reserved,"enum"),f16:new ne("f16",te.reserved,"f16"),f64:new ne("f64",te.reserved,"f64"),handle:new ne("handle",te.reserved,"handle"),i8:new ne("i8",te.reserved,"i8"),i16:new ne("i16",te.reserved,"i16"),i64:new ne("i64",te.reserved,"i64"),mat:new ne("mat",te.reserved,"mat"),premerge:new ne("premerge",te.reserved,"premerge"),regardless:new ne("regardless",te.reserved,"regardless"),typedef:new ne("typedef",te.reserved,"typedef"),u8:new ne("u8",te.reserved,"u8"),u16:new ne("u16",te.reserved,"u16"),u64:new ne("u64",te.reserved,"u64"),unless:new ne("unless",te.reserved,"unless"),using:new ne("using",te.reserved,"using"),vec:new ne("vec",te.reserved,"vec"),void:new ne("void",te.reserved,"void")},z.keywords={array:new ne("array",te.keyword,"array"),atomic:new ne("atomic",te.keyword,"atomic"),bool:new ne("bool",te.keyword,"bool"),f32:new ne("f32",te.keyword,"f32"),i32:new ne("i32",te.keyword,"i32"),mat2x2:new ne("mat2x2",te.keyword,"mat2x2"),mat2x3:new ne("mat2x3",te.keyword,"mat2x3"),mat2x4:new ne("mat2x4",te.keyword,"mat2x4"),mat3x2:new ne("mat3x2",te.keyword,"mat3x2"),mat3x3:new ne("mat3x3",te.keyword,"mat3x3"),mat3x4:new ne("mat3x4",te.keyword,"mat3x4"),mat4x2:new ne("mat4x2",te.keyword,"mat4x2"),mat4x3:new ne("mat4x3",te.keyword,"mat4x3"),mat4x4:new ne("mat4x4",te.keyword,"mat4x4"),ptr:new ne("ptr",te.keyword,"ptr"),sampler:new ne("sampler",te.keyword,"sampler"),sampler_comparison:new ne("sampler_comparison",te.keyword,"sampler_comparison"),struct:new ne("struct",te.keyword,"struct"),texture_1d:new ne("texture_1d",te.keyword,"texture_1d"),texture_2d:new ne("texture_2d",te.keyword,"texture_2d"),texture_2d_array:new ne("texture_2d_array",te.keyword,"texture_2d_array"),texture_3d:new ne("texture_3d",te.keyword,"texture_3d"),texture_cube:new ne("texture_cube",te.keyword,"texture_cube"),texture_cube_array:new ne("texture_cube_array",te.keyword,"texture_cube_array"),texture_multisampled_2d:new ne("texture_multisampled_2d",te.keyword,"texture_multisampled_2d"),texture_storage_1d:new ne("texture_storage_1d",te.keyword,"texture_storage_1d"),texture_storage_2d:new ne("texture_storage_2d",te.keyword,"texture_storage_2d"),texture_storage_2d_array:new ne("texture_storage_2d_array",te.keyword,"texture_storage_2d_array"),texture_storage_3d:new ne("texture_storage_3d",te.keyword,"texture_storage_3d"),texture_depth_2d:new ne("texture_depth_2d",te.keyword,"texture_depth_2d"),texture_depth_2d_array:new ne("texture_depth_2d_array",te.keyword,"texture_depth_2d_array"),texture_depth_cube:new ne("texture_depth_cube",te.keyword,"texture_depth_cube"),texture_depth_cube_array:new ne("texture_depth_cube_array",te.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ne("texture_depth_multisampled_2d",te.keyword,"texture_depth_multisampled_2d"),texture_external:new ne("texture_external",te.keyword,"texture_external"),u32:new ne("u32",te.keyword,"u32"),vec2:new ne("vec2",te.keyword,"vec2"),vec3:new ne("vec3",te.keyword,"vec3"),vec4:new ne("vec4",te.keyword,"vec4"),bitcast:new ne("bitcast",te.keyword,"bitcast"),block:new ne("block",te.keyword,"block"),break:new ne("break",te.keyword,"break"),case:new ne("case",te.keyword,"case"),continue:new ne("continue",te.keyword,"continue"),continuing:new ne("continuing",te.keyword,"continuing"),default:new ne("default",te.keyword,"default"),diagnostic:new ne("diagnostic",te.keyword,"diagnostic"),discard:new ne("discard",te.keyword,"discard"),else:new ne("else",te.keyword,"else"),enable:new ne("enable",te.keyword,"enable"),fallthrough:new ne("fallthrough",te.keyword,"fallthrough"),false:new ne("false",te.keyword,"false"),fn:new ne("fn",te.keyword,"fn"),for:new ne("for",te.keyword,"for"),function:new ne("function",te.keyword,"function"),if:new ne("if",te.keyword,"if"),let:new ne("let",te.keyword,"let"),const:new ne("const",te.keyword,"const"),loop:new ne("loop",te.keyword,"loop"),while:new ne("while",te.keyword,"while"),private:new ne("private",te.keyword,"private"),read:new ne("read",te.keyword,"read"),read_write:new ne("read_write",te.keyword,"read_write"),return:new ne("return",te.keyword,"return"),requires:new ne("requires",te.keyword,"requires"),storage:new ne("storage",te.keyword,"storage"),switch:new ne("switch",te.keyword,"switch"),true:new ne("true",te.keyword,"true"),alias:new ne("alias",te.keyword,"alias"),type:new ne("type",te.keyword,"type"),uniform:new ne("uniform",te.keyword,"uniform"),var:new ne("var",te.keyword,"var"),override:new ne("override",te.keyword,"override"),workgroup:new ne("workgroup",te.keyword,"workgroup"),write:new ne("write",te.keyword,"write"),r8unorm:new ne("r8unorm",te.keyword,"r8unorm"),r8snorm:new ne("r8snorm",te.keyword,"r8snorm"),r8uint:new ne("r8uint",te.keyword,"r8uint"),r8sint:new ne("r8sint",te.keyword,"r8sint"),r16uint:new ne("r16uint",te.keyword,"r16uint"),r16sint:new ne("r16sint",te.keyword,"r16sint"),r16float:new ne("r16float",te.keyword,"r16float"),rg8unorm:new ne("rg8unorm",te.keyword,"rg8unorm"),rg8snorm:new ne("rg8snorm",te.keyword,"rg8snorm"),rg8uint:new ne("rg8uint",te.keyword,"rg8uint"),rg8sint:new ne("rg8sint",te.keyword,"rg8sint"),r32uint:new ne("r32uint",te.keyword,"r32uint"),r32sint:new ne("r32sint",te.keyword,"r32sint"),r32float:new ne("r32float",te.keyword,"r32float"),rg16uint:new ne("rg16uint",te.keyword,"rg16uint"),rg16sint:new ne("rg16sint",te.keyword,"rg16sint"),rg16float:new ne("rg16float",te.keyword,"rg16float"),rgba8unorm:new ne("rgba8unorm",te.keyword,"rgba8unorm"),rgba8unorm_srgb:new ne("rgba8unorm_srgb",te.keyword,"rgba8unorm_srgb"),rgba8snorm:new ne("rgba8snorm",te.keyword,"rgba8snorm"),rgba8uint:new ne("rgba8uint",te.keyword,"rgba8uint"),rgba8sint:new ne("rgba8sint",te.keyword,"rgba8sint"),bgra8unorm:new ne("bgra8unorm",te.keyword,"bgra8unorm"),bgra8unorm_srgb:new ne("bgra8unorm_srgb",te.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ne("rgb10a2unorm",te.keyword,"rgb10a2unorm"),rg11b10float:new ne("rg11b10float",te.keyword,"rg11b10float"),rg32uint:new ne("rg32uint",te.keyword,"rg32uint"),rg32sint:new ne("rg32sint",te.keyword,"rg32sint"),rg32float:new ne("rg32float",te.keyword,"rg32float"),rgba16uint:new ne("rgba16uint",te.keyword,"rgba16uint"),rgba16sint:new ne("rgba16sint",te.keyword,"rgba16sint"),rgba16float:new ne("rgba16float",te.keyword,"rgba16float"),rgba32uint:new ne("rgba32uint",te.keyword,"rgba32uint"),rgba32sint:new ne("rgba32sint",te.keyword,"rgba32sint"),rgba32float:new ne("rgba32float",te.keyword,"rgba32float"),static_assert:new ne("static_assert",te.keyword,"static_assert")},z.tokens={decimal_float_literal:new ne("decimal_float_literal",te.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ne("hex_float_literal",te.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ne("int_literal",te.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ne("uint_literal",te.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ne("name",te.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ne("ident",te.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ne("and",te.token,"&"),and_and:new ne("and_and",te.token,"&&"),arrow:new ne("arrow ",te.token,"->"),attr:new ne("attr",te.token,"@"),forward_slash:new ne("forward_slash",te.token,"/"),bang:new ne("bang",te.token,"!"),bracket_left:new ne("bracket_left",te.token,"["),bracket_right:new ne("bracket_right",te.token,"]"),brace_left:new ne("brace_left",te.token,"{"),brace_right:new ne("brace_right",te.token,"}"),colon:new ne("colon",te.token,":"),comma:new ne("comma",te.token,","),equal:new ne("equal",te.token,"="),equal_equal:new ne("equal_equal",te.token,"=="),not_equal:new ne("not_equal",te.token,"!="),greater_than:new ne("greater_than",te.token,">"),greater_than_equal:new ne("greater_than_equal",te.token,">="),shift_right:new ne("shift_right",te.token,">>"),less_than:new ne("less_than",te.token,"<"),less_than_equal:new ne("less_than_equal",te.token,"<="),shift_left:new ne("shift_left",te.token,"<<"),modulo:new ne("modulo",te.token,"%"),minus:new ne("minus",te.token,"-"),minus_minus:new ne("minus_minus",te.token,"--"),period:new ne("period",te.token,"."),plus:new ne("plus",te.token,"+"),plus_plus:new ne("plus_plus",te.token,"++"),or:new ne("or",te.token,"|"),or_or:new ne("or_or",te.token,"||"),paren_left:new ne("paren_left",te.token,"("),paren_right:new ne("paren_right",te.token,")"),semicolon:new ne("semicolon",te.token,";"),star:new ne("star",te.token,"*"),tilde:new ne("tilde",te.token,"~"),underscore:new ne("underscore",te.token,"_"),xor:new ne("xor",te.token,"^"),plus_equal:new ne("plus_equal",te.token,"+="),minus_equal:new ne("minus_equal",te.token,"-="),times_equal:new ne("times_equal",te.token,"*="),division_equal:new ne("division_equal",te.token,"/="),modulo_equal:new ne("modulo_equal",te.token,"%="),and_equal:new ne("and_equal",te.token,"&="),or_equal:new ne("or_equal",te.token,"|="),xor_equal:new ne("xor_equal",te.token,"^="),shift_right_equal:new ne("shift_right_equal",te.token,">>="),shift_left_equal:new ne("shift_left_equal",te.token,"<<=")},z.simpleTokens={"@":le.tokens.attr,"{":le.tokens.brace_left,"}":le.tokens.brace_right,":":le.tokens.colon,",":le.tokens.comma,"(":le.tokens.paren_left,")":le.tokens.paren_right,";":le.tokens.semicolon},z.literalTokens={"&":le.tokens.and,"&&":le.tokens.and_and,"->":le.tokens.arrow,"/":le.tokens.forward_slash,"!":le.tokens.bang,"[":le.tokens.bracket_left,"]":le.tokens.bracket_right,"=":le.tokens.equal,"==":le.tokens.equal_equal,"!=":le.tokens.not_equal,">":le.tokens.greater_than,">=":le.tokens.greater_than_equal,">>":le.tokens.shift_right,"<":le.tokens.less_than,"<=":le.tokens.less_than_equal,"<<":le.tokens.shift_left,"%":le.tokens.modulo,"-":le.tokens.minus,"--":le.tokens.minus_minus,".":le.tokens.period,"+":le.tokens.plus,"++":le.tokens.plus_plus,"|":le.tokens.or,"||":le.tokens.or_or,"*":le.tokens.star,"~":le.tokens.tilde,_:le.tokens.underscore,"^":le.tokens.xor,"+=":le.tokens.plus_equal,"-=":le.tokens.minus_equal,"*=":le.tokens.times_equal,"/=":le.tokens.division_equal,"%=":le.tokens.modulo_equal,"&=":le.tokens.and_equal,"|=":le.tokens.or_equal,"^=":le.tokens.xor_equal,">>=":le.tokens.shift_right_equal,"<<=":le.tokens.shift_left_equal},z.regexTokens={decimal_float_literal:le.tokens.decimal_float_literal,hex_float_literal:le.tokens.hex_float_literal,int_literal:le.tokens.int_literal,uint_literal:le.tokens.uint_literal,ident:le.tokens.ident},z.storage_class=[le.keywords.function,le.keywords.private,le.keywords.workgroup,le.keywords.uniform,le.keywords.storage],z.access_mode=[le.keywords.read,le.keywords.write,le.keywords.read_write],z.sampler_type=[le.keywords.sampler,le.keywords.sampler_comparison],z.sampled_texture_type=[le.keywords.texture_1d,le.keywords.texture_2d,le.keywords.texture_2d_array,le.keywords.texture_3d,le.keywords.texture_cube,le.keywords.texture_cube_array],z.multisampled_texture_type=[le.keywords.texture_multisampled_2d],z.storage_texture_type=[le.keywords.texture_storage_1d,le.keywords.texture_storage_2d,le.keywords.texture_storage_2d_array,le.keywords.texture_storage_3d],z.depth_texture_type=[le.keywords.texture_depth_2d,le.keywords.texture_depth_2d_array,le.keywords.texture_depth_cube,le.keywords.texture_depth_cube_array,le.keywords.texture_depth_multisampled_2d],z.texture_external_type=[le.keywords.texture_external],z.any_texture_type=[...le.sampled_texture_type,...le.multisampled_texture_type,...le.storage_texture_type,...le.depth_texture_type,...le.texture_external_type],z.texel_format=[le.keywords.r8unorm,le.keywords.r8snorm,le.keywords.r8uint,le.keywords.r8sint,le.keywords.r16uint,le.keywords.r16sint,le.keywords.r16float,le.keywords.rg8unorm,le.keywords.rg8snorm,le.keywords.rg8uint,le.keywords.rg8sint,le.keywords.r32uint,le.keywords.r32sint,le.keywords.r32float,le.keywords.rg16uint,le.keywords.rg16sint,le.keywords.rg16float,le.keywords.rgba8unorm,le.keywords.rgba8unorm_srgb,le.keywords.rgba8snorm,le.keywords.rgba8uint,le.keywords.rgba8sint,le.keywords.bgra8unorm,le.keywords.bgra8unorm_srgb,le.keywords.rgb10a2unorm,le.keywords.rg11b10float,le.keywords.rg32uint,le.keywords.rg32sint,le.keywords.rg32float,le.keywords.rgba16uint,le.keywords.rgba16sint,le.keywords.rgba16float,le.keywords.rgba32uint,le.keywords.rgba32sint,le.keywords.rgba32float],z.const_literal=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.keywords.true,le.keywords.false],z.literal_or_ident=[le.tokens.ident,le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.tokens.name],z.element_count_expression=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.ident],z.template_types=[le.keywords.vec2,le.keywords.vec3,le.keywords.vec4,le.keywords.mat2x2,le.keywords.mat2x3,le.keywords.mat2x4,le.keywords.mat3x2,le.keywords.mat3x3,le.keywords.mat3x4,le.keywords.mat4x2,le.keywords.mat4x3,le.keywords.mat4x4,le.keywords.atomic,le.keywords.bitcast,...le.any_texture_type],z.attribute_name=[le.tokens.ident,le.keywords.block,le.keywords.diagnostic],z.assignment_operators=[le.tokens.equal,le.tokens.plus_equal,le.tokens.minus_equal,le.tokens.times_equal,le.tokens.division_equal,le.tokens.modulo_equal,le.tokens.and_equal,le.tokens.or_equal,le.tokens.xor_equal,le.tokens.shift_right_equal,le.tokens.shift_left_equal],z.increment_operators=[le.tokens.plus_plus,le.tokens.minus_minus];class Bk{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return z.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==z.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class nX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Bk(z.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=z.simpleTokens[e];if(n)return this._addToken(n),!0;let r=z.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=z.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(z.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(z.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(z.tokens.minus_minus),!0;const u=this._tokens.length-1;if((z.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==z.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,d=this._tokens.length-1;for(let h=0;h<5&&d>=0&&z.assignment_operators.indexOf(this._tokens[d].type)===-1;++h,--d)if(this._tokens[d].type===z.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===z.none){let u=e,d=0;const h=2;for(let g=0;g<h;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==z.none){d=g;break}if(o===z.none)return r!==z.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=d+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==z.none&&(this._addToken(r),!0)}_findType(e){for(const r in z.regexTokens){const i=z.regexTokens[r];if(this._match(e,i.rule))return i}return z.literalTokens[e]||z.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Bk(e,n,this._line,this._start,this._current))}}function Te(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const $f=new Float32Array(1),rX=new Uint32Array($f.buffer),iX=new Uint32Array($f.buffer),Hf=new Int32Array(1),sX=new Float32Array(Hf.buffer),aX=new Uint32Array(Hf.buffer),Wf=new Uint32Array(1),oX=new Float32Array(Wf.buffer),lX=new Int32Array(Wf.buffer);function Lk(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return $f[0]=t,rX[0];if(n==="u32")return $f[0]=t,iX[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return Hf[0]=t,sX[0];if(n==="u32")return Hf[0]=t,aX[0]}else if(e==="u32"){if(n==="f32")return Wf[0]=t,oX[0];if(n==="i32"||n==="x32")return Wf[0]=t,lX[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class cX{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Ku{constructor(e,n){this.align=e,this.size=n}}class Lr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new WW,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof ic&&this._functions.set(n.name,new cX(n));for(const n of e)if(n instanceof oi){const r=this.getTypeInfo(n,null);r instanceof Ki&&this.structs.push(r)}for(const n of e)if(n instanceof k1)this.aliases.push(this._getAliasInfo(n));else if(n instanceof C1){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new qW(r.name,s,r.attributes,i))}else if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new Gu(r.name,o,i,s,r.attributes,qi.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new Gu(r.name,o,i,s,r.attributes,l?qi.StorageTexture:qi.Storage,r.access);u.access||(u.access="read"),this.storage.push(u)}else if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new Gu(r.name,o,i,s,r.attributes,l?qi.StorageTexture:qi.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new Gu(r.name,o,i,s,r.attributes,qi.Sampler,r.access);this.samplers.push(l)}for(const n of e)if(n instanceof ic){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,l=new HW(n.name,o==null?void 0:o.name,n.attributes);l.attributes=n.attributes,l.startLine=n.startLine,l.endLine=n.endLine,this.functions.push(l),this._functions.get(n.name).info=l,o&&(this._functions.get(n.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(n,!!o),l.inputs=this._getInputs(n.args),l.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(l)),l.arguments=n.args.map(u=>new $W(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof CP){if(r.value)if(Te(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=n.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=n.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Hn)for(const l of this.overrides)r.name===l.name&&((o=n.info)===null||o===void 0||o.overrides.push(l))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Vf)s.push({});else if(o instanceof qf)s.pop();else if(o instanceof ci){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof jr){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof Vl){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Hn){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof M1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}else if(o instanceof N1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof oi)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof oi)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new Ik(r.name,s,i.name,o);n.push(l)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Ik("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof oi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof oi)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new VW(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new zW(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof gf){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new ix(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof ql){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new Ji(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof oi){const i=e,s=new Ki(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new Mk(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Dl){const i=e,s=i.format instanceof me,o=i.format?s?this.getTypeInfo(i.format,null):new sr(i.format,null):null,l=new Ps(i.name,o,n,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof ae){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Ps(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new sr(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof Ji&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof ix&&this._updateTypeInfo(e.format),e instanceof Ki&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const d=e.members[l],h=this._getTypeSize(d);if(!h)continue;(n=this._getAlias(d.type.name))!==null&&n!==void 0||d.type;const g=h.align,_=h.size;r=this._roundUp(g,r+i),i=_,s=r,o=Math.max(o,g),d.offset=r,d.size=_,this._updateTypeInfo(d.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Mk&&(e=e.type),e instanceof sr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Lr._typeInfo[e.name];if(o!==void 0){const l=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Ku(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Lr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new Ku(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof Ji){let o=e,l=8,u=8;const d=this._getTypeSize(o.format);return d!==null&&(u=d.size,l=d.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new Ku(Math.max(s,l),Math.max(i,u))}if(e instanceof Ki){let o=0,l=0,u=0,d=0,h=0;for(const g of e.members){const _=this._getTypeSize(g.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+d),d=_.size,h=u)}return l=this._roundUp(o,h+d),new Ku(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof ci&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ci&&e.storage=="storage"}_isTextureVar(e){return e instanceof ci&&e.type!==null&&Lr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ci&&e.type!==null&&Lr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Lr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Lr._textureTypes=z.any_texture_type.map(t=>t.name),Lr._samplerTypes=z.sampler_type.map(t=>t.name);let I1=0;class O1{constructor(e,n,r){this.id=I1++,this.name=e,this.value=n,this.node=r}clone(){return new O1(this.name,this.value,this.node)}}class P1{constructor(e){this.id=I1++,this.name=e.name,this.node=e}clone(){return new P1(this.node)}}class D1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=I1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new O1(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new D1(this)}}class uX{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class fX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof W)return r.data.forEach(s=>{s||(i=!1)}),new ee(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){const i=r.data.some(s=>s);return new ee(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof ee))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Mt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new ee(o,this.getTypeInfo("u32"))}return new ee(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new ee(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new ee(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new ee(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new ee(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new ee(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new ee(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new ee(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ee(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new ee(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((d,h)=>this._clamp(d,i.data[h],s.data[h])),r.typeInfo);const o=r,l=i,u=s;return new ee(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new ee(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new ee(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new ee(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new ee(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new ee(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new W([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof W?new W(r.data.map(s=>s*i),r.typeInfo):new ee(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Oe){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ee(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ee(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ee(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new ee(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new ee(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof W&&i instanceof W?new ee(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new ee(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new ee(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof W)return new W(r.data.map(d=>d>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new ee(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W){const o=this._dot(i.data,s.data);return new W(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new ee(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new ee(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new ee(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new W(r.data.map((d,h)=>d*i.data[h]+s.data[h]),r.typeInfo);const o=r,l=i,u=s;return new ee(o.value*l.value+u.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new ee(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,d=~u;if(r instanceof W&&i instanceof W)return new W(r.data.map((_,y)=>_&d|i.data[y]<<l&u),r.typeInfo);const h=r.value,g=i.value;return new ee(h&d|g<<l&u,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new ee(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){let s=0;return r.data.forEach(o=>{s+=o*o}),new ee(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new ee(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new ee(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new ee(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ee(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ee(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((u,d)=>r.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),r.typeInfo);const o=i,l=s;return new ee(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new ee(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W){const i=this.Length(e,n).value;return new W(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ee(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof W?new W(r.data.map(i=>i),r.typeInfo):new ee(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof W?new W(r.data.map(i=>i*Math.PI/180),r.typeInfo):new ee(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof W&&i instanceof W){const s=this._dot(r.data,i.data);return new W(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof W&&i instanceof W&&s instanceof ee){const o=this._dot(i.data,r.data);return new W(r.data.map((l,u)=>{const d=1-s.value*s.value*(1-o*o);if(d<0)return 0;const h=Math.sqrt(d);return s.value*l-(s.value*o+h)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new ee(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new ee(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new ee(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new ee(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new ee(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof W&&r instanceof W&&i instanceof W)return new W(s.data.map((d,h)=>this._smoothstep(r.data[h],i.data[h],d)),s.typeInfo);const o=r,l=i,u=s;return new ee(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new ee(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof W&&r instanceof W)return new W(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new ee(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new ee(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new ee(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof Oe))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Oe([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Oe([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Oe([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Oe([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Oe([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof W)return new W(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new ee(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof Hn){const s=r.name,o=n.getVariableValue(s);if(o instanceof li){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new ee(l[0],this.getTypeInfo("u32")):u==="3d"?new W(l,this.getTypeInfo("vec3u")):u==="2d"?new W(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Hn){const o=r.name,l=n.getVariableValue(o);if(l instanceof li){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=l.width||d<0||d>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const h=l.getPixel(u,d,0,s);return h===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new W(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof li?new ee(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof li?new ee(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof li?new ee(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Hn){const l=r.name,u=n.getVariableValue(l);if(u instanceof li){const d=u.getMipLevelSize(0),h=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return h<0||h>=d[0]||g<0||g>=d[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(h,g,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n);return u instanceof ee&&l instanceof ee&&(u.value=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value+=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicSub(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value-=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMax(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=Math.max(u.value,l.value)),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMin(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=Math.min(u.value,l.value)),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicAnd(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=u.value&l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicOr(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=u.value|l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicXor(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=u.value^l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicExchange(e,n){let r=e.args[0];r instanceof Ft&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new ee(u.value,u.typeInfo);return u instanceof ee&&l instanceof ee&&(u.value=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const i0={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},bn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class gn extends uX{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Lr,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new D1,this.builtins=new fX(this),this.typeInfo={bool:this.getTypeInfo(me.bool),i32:this.getTypeInfo(me.i32),u32:this.getTypeInfo(me.u32),f32:this.getTypeInfo(me.f32),f16:this.getTypeInfo(me.f16),vec2f:this.getTypeInfo(ae.vec2f),vec2u:this.getTypeInfo(ae.vec2u),vec2i:this.getTypeInfo(ae.vec2i),vec2h:this.getTypeInfo(ae.vec2h),vec3f:this.getTypeInfo(ae.vec3f),vec3u:this.getTypeInfo(ae.vec3u),vec3i:this.getTypeInfo(ae.vec3i),vec3h:this.getTypeInfo(ae.vec3h),vec4f:this.getTypeInfo(ae.vec4f),vec4u:this.getTypeInfo(ae.vec4u),vec4i:this.getTypeInfo(ae.vec4i),vec4h:this.getTypeInfo(ae.vec4h),mat2x2f:this.getTypeInfo(ae.mat2x2f),mat2x3f:this.getTypeInfo(ae.mat2x3f),mat2x4f:this.getTypeInfo(ae.mat2x4f),mat3x2f:this.getTypeInfo(ae.mat3x2f),mat3x3f:this.getTypeInfo(ae.mat3x3f),mat3x4f:this.getTypeInfo(ae.mat3x4f),mat4x2f:this.getTypeInfo(ae.mat4x2f),mat4x3f:this.getTypeInfo(ae.mat4x3f),mat4x4f:this.getTypeInfo(ae.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof ee)return i.value;if(i instanceof W||i instanceof Oe)return Array.from(i.data);if(i instanceof Mt&&i.typeInfo instanceof Ji){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const l=n[0],u=n[1],d=n[2],h=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new W(n,h));for(const g in r)for(const _ in r[g]){const y=r[g][_];s.variables.forEach(T=>{var w;const x=T.node;if(x!=null&&x.attributes){let S=null,R=null;for(const E of x.attributes)E.name==="binding"?S=E.value:E.name==="group"&&(R=E.value);if(_==S&&g==R)if(y.texture!==void 0&&y.descriptor!==void 0){const E=new li(y.texture,this.getTypeInfo(x.type),y.descriptor,(w=y.texture.view)!==null&&w!==void 0?w:null);T.value=E}else y.uniform!==void 0?T.value=new Mt(y.uniform,this.getTypeInfo(x.type)):T.value=new Mt(y,this.getTypeInfo(x.type))}})}for(let g=0;g<d;++g)for(let _=0;_<u;++_)for(let y=0;y<l;++y)s.setVariable("@workgroup_id",new W([y,_,g],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,_,g],s)}execStatement(e,n){if(e instanceof vP)return this.evalExpression(e.value,n);if(e instanceof bP){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof ee))throw new Error("Invalid break-if condition");if(!r.value)return null}return gn._breakObj}if(e instanceof xP)return gn._continueObj;if(e instanceof Vl)this._let(e,n);else if(e instanceof ci)this._var(e,n);else if(e instanceof pf)this._const(e,n);else if(e instanceof ic)this._function(e,n);else{if(e instanceof _P)return this._if(e,n);if(e instanceof mP)return this._switch(e,n);if(e instanceof dP)return this._for(e,n);if(e instanceof fP)return this._while(e,n);if(e instanceof gP)return this._loop(e,n);if(e instanceof sx){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof pP)this._assign(e,n);else if(e instanceof hP)this._increment(e,n);else{if(e instanceof oi)return null;if(e instanceof C1){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new ee(0,this.getTypeInfo("u32")))}else if(e instanceof N1)this._call(e,n);else{if(e instanceof yP||e instanceof k1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof _r?this._evalBinaryOp(e,n):e instanceof Wt?this._evalLiteral(e,n):e instanceof Hn?this._evalVariable(e,n):e instanceof M1?this._evalCall(e,n):e instanceof jr?this._evalCreate(e,n):e instanceof wP?this._evalConst(e,n):e instanceof TP?this._evalBitcast(e,n):e instanceof Ft?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof me){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new ee(i,s.type)):s.type.name==="bool"?n.setVariable(r,new ee(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new W(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const g=r.getVariableValue(h.value[0]);i[0]=g instanceof ee?g.value:parseInt(h.value[0])}if(h.value.length>1){const g=r.getVariableValue(h.value[1]);i[1]=g instanceof ee?g.value:parseInt(h.value[1])}if(h.value.length>2){const g=r.getVariableValue(h.value[2]);i[2]=g instanceof ee?g.value:parseInt(h.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new W(i,s));const l=i[0],u=i[1],d=i[2];for(let h=0,g=0;h<d;++h)for(let _=0;_<u;++_)for(let y=0;y<l;++y,++g){const T=[y,_,h],w=[y+n[0]*i[0],_+n[1]*i[1],h+n[2]*i[2]];r.setVariable("@local_invocation_id",new W(T,s)),r.setVariable("@global_invocation_id",new W(w,s)),r.setVariable("@local_invocation_index",new ee(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Ft;)e=e.right;return e instanceof Hn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof ee?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof ee?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Hn){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Ft){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof La?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new La(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Ft){const u=this._getVariableData(e.variable,n),d=this.evalExpression(e.value,n),h=e.operator;if(h==="="){if(u instanceof ee||u instanceof W||u instanceof Oe){if(d instanceof ee||d instanceof W||d instanceof Oe&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Mt&&d instanceof Mt&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(h==="+=")return u instanceof ee||u instanceof W||u instanceof Oe?d instanceof ee||d instanceof W||d instanceof Oe?void u.data.set(d.data.map((g,_)=>u.data[_]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(h==="-=")return(u instanceof ee||u instanceof W||u instanceof Oe)&&(d instanceof ee||d instanceof W||d instanceof Oe)?void u.data.set(d.data.map((g,_)=>u.data[_]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Ft){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const u=n.getVariable(i);if(!(u&&u.value instanceof La))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let d=e.variable.postfix;if(!d){let h=e.variable.right;for(;h instanceof Ft;){if(h.postfix){d=h.postfix;break}h=h.right}}d&&(r=r.getSubData(this,d,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const u=n.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof La&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),l=e.operator;if(l==="=")if(r instanceof Mt)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof W||r instanceof Oe))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof ro){const u=this.evalExpression(s.index,n).value;if(r instanceof W){if(!(o instanceof ee))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Oe))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,n).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=r.typeInfo.getTypeName();if(h==="mat2x2"||h==="mat2x2f"||h==="mat2x2h"){if(!(d<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat2x3"||h==="mat2x3f"||h==="mat2x3h"){if(!(d<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat2x4"||h==="mat2x4f"||h==="mat2x4h"){if(!(d<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat3x2"||h==="mat3x2f"||h==="mat3x2h"){if(!(d<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat3x3"||h==="mat3x3f"||h==="mat3x3h"){if(!(d<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat3x4"||h==="mat3x4f"||h==="mat3x4h"){if(!(d<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat4x2"||h==="mat4x2f"||h==="mat4x2h"){if(!(d<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat4x3"||h==="mat4x3f"||h==="mat4x3h"){if(!(d<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else{if(h!=="mat4x4"&&h!=="mat4x4f"&&h!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}}}}}else if(s instanceof Ds){const u=s.value;if(!(r instanceof W))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof ee){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const h=u[d];if(h==="x"||h==="r")r.data[0]=o.data[d];else if(h==="y"||h==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[d]}else if(h==="z"||h==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[d]}else{if(h!=="w"&&h!=="a")return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[d]}}}}}else r instanceof ee&&o instanceof ee?r.value=o.value:r instanceof W&&o instanceof W||r instanceof Oe&&o instanceof Oe?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const u=r.getSubData(this,s,n);if(u instanceof W&&o instanceof ee){const d=u.data,h=o.value;if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h;else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h;else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h;else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h;else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h;else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h;else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h;else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h;else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h;else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof W&&o instanceof W){const d=u.data,h=o.data;if(d.length!==h.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h[g];else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h[g];else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h[g];else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h[g];else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h[g];else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h[g];else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h[g];else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h[g];else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h[g];else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h[g];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof ee&&o instanceof ee))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}r instanceof Mt&&r.setDataValue(this,u,s,n)}}_function(e,n){const r=new P1(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ft||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new jr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Ft||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof ql||e.type instanceof oi||e.type instanceof ae){const s=new jr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof ee))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof AP)for(const o of s.selectors){if(o instanceof mf){i=s;continue}const l=this.evalExpression(o,n);if(!(l instanceof ee))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,n)}else s instanceof RP&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof ee))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof ee))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof ee?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===gn._breakObj)break;if(r!==null&&r!==gn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===gn._breakObj)break;if(r===gn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===gn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===gn._breakObj)break;if(r!==gn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof ee){const s=Lk(r.value,r.typeInfo.name,i.name);return new ee(s,this.getTypeInfo(i))}if(r instanceof W){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(h,g,_){if(g===_)return h;const y=new Array(h.length);for(let T=0;T<h.length;T++)y[T]=Lk(h[T],g,_);return y}(Array.from(r.data),o,u);return new W(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof jr){if(e.type===null)return ax.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof jr?e.type.name:e.name,s=e instanceof jr?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Mt(new ArrayBuffer(s.size),s,0);if(s instanceof Ki){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],d=e.args[l],h=this.evalExpression(d,n);o.setData(this,h,u.type,u.offset,n)}}else if(s instanceof Ji){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],h=this.evalExpression(d,n);s.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=h.typeInfo),o.setData(this,h,s.format,l,n),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof jr?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new ee(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=gn._priority.get(n.name);gn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new La(r);if(e.operator==="*")return r instanceof La?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof ee?r.value:r instanceof W?Array.from(r.data):null;switch(e.operator){case"+":{if(Te(i)){const l=i.map((u,d)=>+u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ee(+s,o)}case"-":{if(Te(i)){const l=i.map((u,d)=>-u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ee(-s,o)}case"!":{if(Te(i)){const l=i.map((u,d)=>u?0:1);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ee(s?0:1,o)}case"~":{if(Te(i)){const l=i.map((u,d)=>~u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ee(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof ee?r.value:r instanceof W||r instanceof Oe?Array.from(r.data):null,o=i instanceof ee?i.value:i instanceof W||i instanceof Oe?Array.from(i.data):null;switch(e.operator){case"+":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y+g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_+h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h+_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l+u,d)}case"-":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y-g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_-h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h-_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l-u,d)}case"*":{if(Te(s)&&Te(o)){const h=s,g=o;if(r instanceof Oe&&i instanceof Oe){const _=function(x,S,R,E){if(bn[S.name]===void 0||bn[E.name]===void 0)return null;const A=bn[S.name][0],k=bn[S.name][1],O=bn[E.name][0];if(A!==bn[E.name][1])return null;const j=new Array(O*k);for(let N=0;N<k;N++)for(let I=0;I<O;I++){let M=0;for(let q=0;q<A;q++)M+=x[q*k+N]*R[I*A+q];j[N*O+I]=M}return j}(h,r.typeInfo,g,i.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const y=bn[i.typeInfo.name][0],T=bn[r.typeInfo.name][1],w=this.getTypeInfo(`mat${y}x${T}f`);return new Oe(_,w)}if(r instanceof Oe&&i instanceof W){const _=function(y,T,w,x){if(bn[T.name]===void 0||i0[x.name]===void 0)return null;const S=bn[T.name][0],R=bn[T.name][1];if(S!==w.length)return null;const E=new Array(R);for(let A=0;A<R;A++){let k=0;for(let O=0;O<S;O++)k+=y[O*R+A]*w[O];E[A]=k}return E}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,i.typeInfo)}if(r instanceof W&&i instanceof Oe){const _=function(y,T,w,x){if(i0[T.name]===void 0||bn[x.name]===void 0)return null;const S=bn[x.name][0],R=bn[x.name][1];if(R!==y.length)return null;const E=[];for(let A=0;A<S;A++){let k=0;for(let O=0;O<R;O++)k+=y[O]*w[O*S+A];E[A]=k}return E}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,r.typeInfo)}{if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y*g[T]);return new W(_,r.typeInfo)}}if(Te(s)){const h=o,g=s.map((_,y)=>_*h);return r instanceof Oe?new Oe(g,r.typeInfo):new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h*_);return i instanceof Oe?new Oe(g,i.typeInfo):new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l*u,d)}case"%":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y%g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_%h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h%_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l%u,d)}case"/":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y/g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_/h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h/_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l/u,d)}case"&":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y&g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_&h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h&_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l&u,d)}case"|":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y|g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_|h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h|_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l|u,d)}case"^":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y^g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_^h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h^_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l^u,d)}case"<<":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y<<g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_<<h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h<<_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l<<u,d)}case">>":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y>>g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_>>h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h>>_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ee(l>>u,d)}case">":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>d?1:0);return new W(u,i.typeInfo)}return new ee(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<d?1:0);return new W(u,i.typeInfo)}return new ee(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h===u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d==l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l==d?1:0);return new W(u,i.typeInfo)}return new ee(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h!==u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d!==l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l!==d?1:0);return new W(u,i.typeInfo)}return new ee(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>=u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>=l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>=d?1:0);return new W(u,i.typeInfo)}return new ee(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<=u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<=l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<=d?1:0);return new W(u,i.typeInfo)}return new ee(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h&&u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d&&l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l&&d?1:0);return new W(u,i.typeInfo)}return new ee(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h||u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d||l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l||d?1:0);return new W(u,i.typeInfo)}return new ee(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothStep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new ee(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=i0[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Wt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);if(u instanceof W){const d=u.data;for(let h=0;h<d.length;++h){let g=d[h];o.push(g)}}else if(u instanceof ee){let d=u.value;o.push(d)}}if(e.type instanceof ae&&e.type.format===null&&(e.type.format=ae.f32),o.length===0){const l=new Array(s).fill(0);return new W(l,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new W(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=bn[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Wt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);u instanceof W?o.push(...u.data):u instanceof ee?o.push(u.value):u instanceof Oe&&o.push(...u.data)}if(r instanceof Ps&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new Oe(l,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Oe(o,r).getSubData(this,e.postfix,n)}}gn._breakObj=new lr(new sr("BREAK",null),null),gn._continueObj=new lr(new sr("CONTINUE",null),null),gn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class dX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class hX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new dX,this._exec=new gn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Hn){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof jk||i instanceof gf?i.type=this._forwardType(i.type):i instanceof ql?i.format=this._forwardType(i.format):i instanceof ci||i instanceof Vl||i instanceof pf?i.type=this._forwardType(i.type):i instanceof ic?i.returnType=this._forwardType(i.returnType):i instanceof Dk&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof Pk){const n=this._getType(e.name);if(n)return n}else e instanceof gf?e.type=this._forwardType(e.type):e instanceof ql&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new nX(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==z.eof}_match(e){if(e instanceof ne)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===z.tokens.name&&(i=!0)}if(i){const s=z.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===z.tokens.name){const r=z.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(z.tokens.semicolon)&&!this._isAtEnd(););if(this._match(z.keywords.alias)){const n=this._type_alias();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(z.keywords.diagnostic)){const n=this._diagnostic();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(z.keywords.requires)){const n=this._requires_directive();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(z.keywords.enable)){const n=this._enable_directive();return this._consume(z.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(z.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(z.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(z.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(z.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(z.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(z.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(z.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(z.keywords.fn))return null;const e=this._currentLine,n=this._consume(z.tokens.ident,"Expected function name.").toString();this._consume(z.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(z.tokens.paren_right))do{if(this._check(z.tokens.paren_right))break;const l=this._attribute(),u=this._consume(z.tokens.name,"Expected argument name.").toString();this._consume(z.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=d,r.push(this._updateNode(new Dk(u,h,l))))}while(this._match(z.tokens.comma));this._consume(z.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(z.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new ic(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(z.tokens.brace_left,"Expected '{' for block.");!this._check(z.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(z.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(z.tokens.semicolon)&&!this._isAtEnd(););if(this._check(z.tokens.attr)&&this._attribute(),this._check(z.keywords.if))return this._if_statement();if(this._check(z.keywords.switch))return this._switch_statement();if(this._check(z.keywords.loop))return this._loop_statement();if(this._check(z.keywords.for))return this._for_statement();if(this._check(z.keywords.while))return this._while_statement();if(this._check(z.keywords.continuing))return this._continuing_statement();if(this._check(z.keywords.static_assert))return this._static_assert_statement();if(this._check(z.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(z.keywords.return))e=this._return_statement();else if(this._check([z.keywords.var,z.keywords.let,z.keywords.const]))e=this._variable_statement();else if(this._match(z.keywords.discard))e=this._updateNode(new JW);else if(this._match(z.keywords.break)){const n=this._updateNode(new bP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(z.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(z.keywords.continue)){const n=this._updateNode(new xP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(z.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(z.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new KW(n),e)}_while_statement(){if(!this._match(z.keywords.while))return null;const e=this._updateNode(new fP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(z.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(z.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new sx(r,e),n)}_for_statement(){if(!this._match(z.keywords.for))return null;this._consume(z.tokens.paren_left,"Expected '('.");const e=this._updateNode(new dP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(z.tokens.semicolon)?null:this._for_init(),this._consume(z.tokens.semicolon,"Expected ';'."),e.condition=this._check(z.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(z.tokens.semicolon,"Expected ';'."),e.increment=this._check(z.tokens.paren_right)?null:this._for_increment(),this._consume(z.tokens.paren_right,"Expected ')'."),this._check(z.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(z.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(z.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new ci(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(z.keywords.let)){const e=this._currentLine,n=this._consume(z.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(z.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Vl(n,r,null,null,i),e)}if(this._match(z.keywords.const)){const e=this._currentLine,n=this._consume(z.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(z.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Wt&&(r=i.type),this._updateNode(new pf(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(z.increment_operators))return this._current=e,null;const r=this._consume(z.increment_operators,"Expected increment operator");return this._updateNode(new hP(r.type===z.tokens.plus_plus?qa.increment:qa.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(z.tokens.brace_right))return null;let r=this._match(z.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(z.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new pP(Pl.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(z.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(z.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new N1(r.lexeme,i),e)}_loop_statement(){if(!this._match(z.keywords.loop))return null;this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new gP([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof sx){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(z.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(z.keywords.switch))return null;const e=this._updateNode(new mP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(z.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([z.keywords.default,z.keywords.case]);){if(this._match(z.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof mf){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(z.tokens.colon),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(z.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new AP(r,i)))}if(this._match(z.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(z.tokens.colon),this._check(z.tokens.attr)&&this._attribute(),this._consume(z.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(z.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new RP(r)))}}return e}_case_selectors(){const e=[];for(this._match(z.keywords.default)?e.push(this._updateNode(new mf)):e.push(this._shift_expression());this._match(z.tokens.comma);)this._match(z.keywords.default)?e.push(this._updateNode(new mf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(z.keywords.fallthrough))return this._consume(z.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(z.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(z.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(z.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(z.keywords.else)&&(this._check(z.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new _P(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===z.keywords.else&&this._tokens[this._current+1].type===z.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new eX(n,r))),this._match_elseif()&&(this._check(z.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(z.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new vP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(z.tokens.or_or);)e=this._updateNode(new _r(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(z.tokens.and_and);)e=this._updateNode(new _r(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(z.tokens.or);)e=this._updateNode(new _r(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(z.tokens.xor);)e=this._updateNode(new _r(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(z.tokens.and);)e=this._updateNode(new _r(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([z.tokens.equal_equal,z.tokens.not_equal])?this._updateNode(new _r(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([z.tokens.less_than,z.tokens.greater_than,z.tokens.less_than_equal,z.tokens.greater_than_equal]);)e=this._updateNode(new _r(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([z.tokens.shift_left,z.tokens.shift_right]);)e=this._updateNode(new _r(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([z.tokens.plus,z.tokens.minus]);)e=this._updateNode(new _r(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([z.tokens.star,z.tokens.forward_slash,z.tokens.modulo]);)e=this._updateNode(new _r(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([z.tokens.minus,z.tokens.bang,z.tokens.tilde,z.tokens.star,z.tokens.and])?this._updateNode(new Ft(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(z.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(z.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new ro(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(z.tokens.period)){const e=this._consume(z.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Ds(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return me.void;case"bool":return me.bool;case"i32":return me.i32;case"u32":return me.u32;case"f32":return me.f32;case"f16":return me.f16;case"vec2f":return ae.vec2f;case"vec3f":return ae.vec3f;case"vec4f":return ae.vec4f;case"vec2i":return ae.vec2i;case"vec3i":return ae.vec3i;case"vec4i":return ae.vec4i;case"vec2u":return ae.vec2u;case"vec3u":return ae.vec3u;case"vec4u":return ae.vec4u;case"vec2h":return ae.vec2h;case"vec3h":return ae.vec3h;case"vec4h":return ae.vec4h;case"mat2x2f":return ae.mat2x2f;case"mat2x3f":return ae.mat2x3f;case"mat2x4f":return ae.mat2x4f;case"mat3x2f":return ae.mat3x2f;case"mat3x3f":return ae.mat3x3f;case"mat3x4f":return ae.mat3x4f;case"mat4x2f":return ae.mat4x2f;case"mat4x3f":return ae.mat4x3f;case"mat4x4f":return ae.mat4x4f;case"mat2x2h":return ae.mat2x2h;case"mat2x3h":return ae.mat2x3h;case"mat2x4h":return ae.mat2x4h;case"mat3x2h":return ae.mat3x2h;case"mat3x3h":return ae.mat3x3h;case"mat3x4h":return ae.mat3x4h;case"mat4x2h":return ae.mat4x2h;case"mat4x3h":return ae.mat4x3h;case"mat4x4h":return ae.mat4x4h;case"mat2x2i":return ae.mat2x2i;case"mat2x3i":return ae.mat2x3i;case"mat2x4i":return ae.mat2x4i;case"mat3x2i":return ae.mat3x2i;case"mat3x3i":return ae.mat3x3i;case"mat3x4i":return ae.mat3x4i;case"mat4x2i":return ae.mat4x2i;case"mat4x3i":return ae.mat4x3i;case"mat4x4i":return ae.mat4x4i;case"mat2x2u":return ae.mat2x2u;case"mat2x3u":return ae.mat2x3u;case"mat2x4u":return ae.mat2x4u;case"mat3x2u":return ae.mat3x2u;case"mat3x3u":return ae.mat3x3u;case"mat3x4u":return ae.mat3x4u;case"mat4x2u":return ae.mat4x2u;case"mat4x3u":return ae.mat4x3u;case"mat4x4u":return ae.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(z.tokens.ident)){const r=this._previous().toString();if(this._check(z.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new jr(s,i)):this._updateNode(new M1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new wP(r,i.value))}return this._updateNode(new Hn(r))}if(this._match(z.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?me.i32:r.endsWith("u")||r.endsWith("U")?me.u32:me.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Wt(new ee(s,this._exec.getTypeInfo(i)),i))}if(this._match(z.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,me.u32),this._updateNode(new Wt(new ee(r,this._exec.getTypeInfo(me.u32)),me.u32))}if(this._match([z.tokens.decimal_float_literal,z.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?me.f16:me.f32);const o=i?me.f16:me.f32;return this._updateNode(new Wt(new ee(s,this._exec.getTypeInfo(o)),o))}if(this._match([z.keywords.true,z.keywords.false])){let r=this._previous().toString()===z.keywords.true.rule;return this._updateNode(new Wt(new ee(r?1:0,this._exec.getTypeInfo(me.bool)),me.bool))}if(this._check(z.tokens.paren_left))return this._paren_expression();if(this._match(z.keywords.bitcast)){this._consume(z.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(z.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new TP(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new jr(e,n))}_argument_expression_list(){if(!this._match(z.tokens.paren_left))return null;const e=[];do{if(this._check(z.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(z.tokens.comma));return this._consume(z.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(z.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(z.tokens.paren_right),e}_paren_expression(){this._consume(z.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(z.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(z.keywords.struct))return null;const e=this._currentLine,n=this._consume(z.tokens.ident,"Expected name for struct.").toString();this._consume(z.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(z.tokens.brace_right);){const o=this._attribute(),l=this._consume(z.tokens.name,"Expected variable name.").toString();this._consume(z.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(z.tokens.brace_right)?this._match(z.tokens.comma):this._consume(z.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new jk(l,d,o)))}this._consume(z.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new oi(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(z.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Wt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Wt&&(e.type=e.value.type.name==="x32"?me.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(z.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(z.keywords.const))return null;const n=this._consume(z.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(z.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(z.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[me.f32],d=o.constEvaluate(this._exec,u);d instanceof ee&&this._validateTypeRange(d.value,u[0]),u[0]instanceof ae&&u[0].format===null&&d.typeInfo instanceof Ps&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=me.f16:d.typeInfo.format.name==="f32"?u[0].format=me.f32:d.typeInfo.format.name==="i32"?u[0].format=me.i32:d.typeInfo.format.name==="u32"?u[0].format=me.u32:d.typeInfo.format.name==="bool"?u[0].format=me.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new Wt(d,u[0])),this._exec.context.setVariable(n.toString(),d)}catch{s=o}if(i!==null&&s instanceof Wt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Wt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:me.f32,i===me.x32&&(i=me.i32));const l=this._updateNode(new pf(n.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(z.keywords.let))return null;const e=this._currentLine,n=this._consume(z.tokens.name,"Expected variable name");let r=null;if(this._match(z.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(z.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Wt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Wt&&(r=i.type.name==="x32"?me.i32:i.type);return i instanceof Wt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new Vl(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(z.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(z.tokens.less_than)&&(n=this._consume(z.storage_class,"Expected storage_class.").toString(),this._match(z.tokens.comma)&&(r=this._consume(z.access_mode,"Expected access_mode.").toString()),this._consume(z.tokens.greater_than,"Expected '>'."));const i=this._consume(z.tokens.name,"Expected variable name");let s=null;if(this._match(z.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new ci(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(z.keywords.override))return null;const e=this._consume(z.tokens.name,"Expected variable name");let n=null;if(this._match(z.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new C1(e.toString(),n,null))}_diagnostic(){this._consume(z.tokens.paren_left,"Expected '('");const e=this._consume(z.tokens.ident,"Expected severity control name.");this._consume(z.tokens.comma,"Expected ','");let n=this._consume(z.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(z.tokens.period)&&(n+=`.${this._consume(z.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(z.tokens.paren_right,"Expected ')'"),this._updateNode(new yP(e.toString(),n))}_enable_directive(){const e=this._consume(z.tokens.ident,"identity expected.");return this._updateNode(new ZW(e.toString()))}_requires_directive(){const e=[this._consume(z.tokens.ident,"identity expected.").toString()];for(;this._match(z.tokens.comma);){const n=this._consume(z.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new QW(e))}_type_alias(){const e=this._consume(z.tokens.ident,"identity expected.");this._consume(z.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new k1(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([z.tokens.ident,...z.texel_format,z.keywords.bool,z.keywords.f32,z.keywords.i32,z.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new Pk(r));return this._forwardTypeCount++,i}return this._updateNode(new me(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(z.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(z.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(z.tokens.comma)&&(s=this._consume(z.access_mode,"Expected access_mode for pointer").toString()),this._consume(z.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ae(r,i,s))}if(this._match(z.keywords.ptr)){let r=this._previous().toString();this._consume(z.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(z.storage_class,"Expected storage_class for pointer");this._consume(z.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(z.tokens.comma)&&(o=this._consume(z.access_mode,"Expected access_mode for pointer").toString()),this._consume(z.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new gf(r,i.toString(),s,o))}const n=this._attribute();if(this._match(z.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(z.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(z.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(z.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new ql(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(z.sampler_type))return this._updateNode(new Dl(this._previous().toString(),null,null));if(this._match(z.depth_texture_type))return this._updateNode(new Dl(this._previous().toString(),null,null));if(this._match(z.sampled_texture_type)||this._match(z.multisampled_texture_type)){const e=this._previous();this._consume(z.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(z.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Dl(e.toString(),n,null))}if(this._match(z.storage_texture_type)){const e=this._previous();this._consume(z.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(z.texel_format,"Invalid texel format.").toString();this._consume(z.tokens.comma,"Expected ',' after texel format.");const r=this._consume(z.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(z.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Dl(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(z.tokens.attr);){const n=this._consume(z.attribute_name,"Expected attribute name"),r=this._updateNode(new CP(n.toString(),null));if(this._match(z.tokens.paren_left)){if(r.value=this._consume(z.literal_or_ident,"Expected attribute value").toString(),this._check(z.tokens.comma)){this._advance();do{const i=this._consume(z.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(z.tokens.comma))}this._consume(z.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class pX extends Lr{constructor(e){super(),e&&this.update(e)}update(e){const n=new hX().parse(e);this.updateAST(n)}}function gX(t){var s;const e={attributes:[],bindings:[]};let n;try{n=mX(t)}catch(o){return be.error(o.message)(),e}for(const o of n.uniforms){const l=[];for(const u of((s=o.type)==null?void 0:s.members)||[])l.push({name:u.name,type:Uk(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const l=r.inputs[o];if(l.locationType==="location"){const u=Uk(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function Uk(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function mX(t){try{return new pX(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const _X={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{..._X}};const ar=globalThis.mathgl.config;function vX(t,{precision:e=ar.precision}={}){return t=yX(t),`${parseFloat(t.toPrecision(e))}`}function io(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wn(t,e,n){return xX(t,r=>Math.max(e,Math.min(n,r)))}function Xf(t,e,n){return io(t)?t.map((r,i)=>Xf(r,e[i],n)):n*e+(1-n)*t}function sc(t,e,n){const r=ar.EPSILON;try{if(t===e)return!0;if(io(t)&&io(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!sc(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=ar.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ar.EPSILON=r}}function yX(t){return Math.round(t/ar.EPSILON)*ar.EPSILON}function bX(t){return t.clone?t.clone():new Array(t.length)}function xX(t,e,n){if(io(t)){const r=t;n=n||bX(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class NP extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:io(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ar)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+vX(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!sc(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(ar.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function wX(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function $n(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function s0(t,e,n=""){if(ar.debug&&!wX(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Fk(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class TX extends NP{get x(){return this[0]}set x(e){this[0]=$n(e)}get y(){return this[1]}set y(e){this[1]=$n(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return $n(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return $n(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Fk(e>=0&&e<this.ELEMENTS,"index is out of range"),$n(this[e])}setComponent(e,n){return Fk(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const _f=1e-6;let so=typeof Float32Array<"u"?Float32Array:Array;function SX(){const t=new so(2);return so!=Float32Array&&(t[0]=0,t[1]=0),t}function zk(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function EX(t,e){return t[0]=-e[0],t[1]=-e[1],t}function kP(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function AX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=SX();return function(e,n,r,i,s,o){let l,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],s(t,t,o),e[l]=t[0],e[l+1]=t[1];return e}})();function RX(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function MP(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function CX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function NX(){const t=new so(3);return so!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function kX(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function MX(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function IX(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function OX(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],l=n[1],u=n[2];return t[0]=i*u-s*l,t[1]=s*o-r*u,t[2]=r*l-i*o,t}function IP(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function PX(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function DX(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],l=e[0],u=e[1],d=e[2];let h=i*d-s*u,g=s*l-r*d,_=r*u-i*l,y=i*_-s*g,T=s*h-r*_,w=r*g-i*h;const x=o*2;return h*=x,g*=x,_*=x,y*=2,T*=2,w*=2,t[0]=l+h+y,t[1]=u+g+T,t[2]=d+_+w,t}function jX(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function BX(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function LX(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function UX(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+l*l)),d=u&&IX(t,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const FX=kX;(function(){const t=NX();return function(e,n,r,i,s,o){let l,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const a0=[0,0,0];let Zu;class Fr extends TX{static get ZERO(){return Zu||(Zu=new Fr(0,0,0),Object.freeze(Zu)),Zu}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&io(e)?this.copy(e):(ar.debug&&($n(e),$n(n),$n(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ar.debug&&($n(e.x),$n(e.y),$n(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=$n(e)}angle(e){return UX(this,e)}cross(e){return OX(this,this,e),this.check()}rotateX({radians:e,origin:n=a0}){return jX(this,this,n,e),this.check()}rotateY({radians:e,origin:n=a0}){return BX(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=a0}){return LX(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return IP(this,this,e),this.check()}transformAsVector(e){return MP(this,this,e),this.check()}transformByMatrix3(e){return PX(this,this,e),this.check()}transformByMatrix2(e){return CX(this,this,e),this.check()}transformByQuaternion(e){return DX(this,this,e),this.check()}}class zX extends NP{toString(){let e="[";if(ar.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=$n(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function VX(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qX(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ox(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],d=e[7],h=e[8],g=e[9],_=e[10],y=e[11],T=e[12],w=e[13],x=e[14],S=e[15],R=n*l-r*o,E=n*u-i*o,A=n*d-s*o,k=r*u-i*l,O=r*d-s*l,j=i*d-s*u,N=h*w-g*T,I=h*x-_*T,M=h*S-y*T,q=g*x-_*w,X=g*S-y*w,G=_*S-y*x;let L=R*G-E*X+A*q+k*M-O*I+j*N;return L?(L=1/L,t[0]=(l*G-u*X+d*q)*L,t[1]=(i*X-r*G-s*q)*L,t[2]=(w*j-x*O+S*k)*L,t[3]=(_*O-g*j-y*k)*L,t[4]=(u*M-o*G-d*I)*L,t[5]=(n*G-i*M+s*I)*L,t[6]=(x*A-T*j-S*E)*L,t[7]=(h*j-_*A+y*E)*L,t[8]=(o*X-l*M+d*N)*L,t[9]=(r*M-n*X-s*N)*L,t[10]=(T*O-w*A+S*R)*L,t[11]=(g*A-h*O-y*R)*L,t[12]=(l*I-o*q-u*N)*L,t[13]=(n*q-r*I+i*N)*L,t[14]=(w*E-T*k-x*R)*L,t[15]=(h*k-g*E+_*R)*L,t):null}function $X(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=t[6],u=t[7],d=t[8],h=t[9],g=t[10],_=t[11],y=t[12],T=t[13],w=t[14],x=t[15],S=e*o-n*s,R=e*l-r*s,E=n*l-r*o,A=d*T-h*y,k=d*w-g*y,O=h*w-g*T,j=e*O-n*k+r*A,N=s*O-o*k+l*A,I=d*E-h*R+g*S,M=y*E-T*R+w*S;return u*j-i*N+x*I-_*M}function Ns(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],d=e[6],h=e[7],g=e[8],_=e[9],y=e[10],T=e[11],w=e[12],x=e[13],S=e[14],R=e[15];let E=n[0],A=n[1],k=n[2],O=n[3];return t[0]=E*r+A*l+k*g+O*w,t[1]=E*i+A*u+k*_+O*x,t[2]=E*s+A*d+k*y+O*S,t[3]=E*o+A*h+k*T+O*R,E=n[4],A=n[5],k=n[6],O=n[7],t[4]=E*r+A*l+k*g+O*w,t[5]=E*i+A*u+k*_+O*x,t[6]=E*s+A*d+k*y+O*S,t[7]=E*o+A*h+k*T+O*R,E=n[8],A=n[9],k=n[10],O=n[11],t[8]=E*r+A*l+k*g+O*w,t[9]=E*i+A*u+k*_+O*x,t[10]=E*s+A*d+k*y+O*S,t[11]=E*o+A*h+k*T+O*R,E=n[12],A=n[13],k=n[14],O=n[15],t[12]=E*r+A*l+k*g+O*w,t[13]=E*i+A*u+k*_+O*x,t[14]=E*s+A*d+k*y+O*S,t[15]=E*o+A*h+k*T+O*R,t}function Yf(t,e,n){const r=n[0],i=n[1],s=n[2];let o,l,u,d,h,g,_,y,T,w,x,S;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],d=e[3],h=e[4],g=e[5],_=e[6],y=e[7],T=e[8],w=e[9],x=e[10],S=e[11],t[0]=o,t[1]=l,t[2]=u,t[3]=d,t[4]=h,t[5]=g,t[6]=_,t[7]=y,t[8]=T,t[9]=w,t[10]=x,t[11]=S,t[12]=o*r+h*i+T*s+e[12],t[13]=l*r+g*i+w*s+e[13],t[14]=u*r+_*i+x*s+e[14],t[15]=d*r+y*i+S*s+e[15]),t}function j1(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function HX(t,e,n,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,d,h,g,_,y,T,w,x,S,R,E,A,k,O,j,N,I,M,q,X,G,L,J;return l<_f?null:(l=1/l,i*=l,s*=l,o*=l,d=Math.sin(n),u=Math.cos(n),h=1-u,g=e[0],_=e[1],y=e[2],T=e[3],w=e[4],x=e[5],S=e[6],R=e[7],E=e[8],A=e[9],k=e[10],O=e[11],j=i*i*h+u,N=s*i*h+o*d,I=o*i*h-s*d,M=i*s*h-o*d,q=s*s*h+u,X=o*s*h+i*d,G=i*o*h+s*d,L=s*o*h-i*d,J=o*o*h+u,t[0]=g*j+w*N+E*I,t[1]=_*j+x*N+A*I,t[2]=y*j+S*N+k*I,t[3]=T*j+R*N+O*I,t[4]=g*M+w*q+E*X,t[5]=_*M+x*q+A*X,t[6]=y*M+S*q+k*X,t[7]=T*M+R*q+O*X,t[8]=g*G+w*L+E*J,t[9]=_*G+x*L+A*J,t[10]=y*G+S*L+k*J,t[11]=T*G+R*L+O*J,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function OP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],l=e[6],u=e[7],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+d*r,t[5]=o*i+h*r,t[6]=l*i+g*r,t[7]=u*i+_*r,t[8]=d*i-s*r,t[9]=h*i-o*r,t[10]=g*i-l*r,t[11]=_*i-u*r,t}function WX(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-d*r,t[1]=o*i-h*r,t[2]=l*i-g*r,t[3]=u*i-_*r,t[8]=s*r+d*i,t[9]=o*r+h*i,t[10]=l*r+g*i,t[11]=u*r+_*i,t}function PP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[4],h=e[5],g=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+d*r,t[1]=o*i+h*r,t[2]=l*i+g*r,t[3]=u*i+_*r,t[4]=d*i-s*r,t[5]=h*i-o*r,t[6]=g*i-l*r,t[7]=_*i-u*r,t}function XX(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,l=r+r,u=i+i,d=n*o,h=r*o,g=r*l,_=i*o,y=i*l,T=i*u,w=s*o,x=s*l,S=s*u;return t[0]=1-g-T,t[1]=h+S,t[2]=_-x,t[3]=0,t[4]=h-S,t[5]=1-d-T,t[6]=y+w,t[7]=0,t[8]=_+x,t[9]=y-w,t[10]=1-d-g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function YX(t,e,n,r,i,s,o){const l=1/(n-e),u=1/(i-r),d=1/(s-o);return t[0]=s*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(i+r)*u,t[10]=(o+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*d,t[15]=0,t}function GX(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const KX=GX;function ZX(t,e,n,r,i,s,o){const l=1/(e-n),u=1/(r-i),d=1/(s-o);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*l,t[13]=(i+r)*u,t[14]=(o+s)*d,t[15]=1,t}const QX=ZX;function JX(t,e,n,r){let i,s,o,l,u,d,h,g,_,y;const T=e[0],w=e[1],x=e[2],S=r[0],R=r[1],E=r[2],A=n[0],k=n[1],O=n[2];return Math.abs(T-A)<_f&&Math.abs(w-k)<_f&&Math.abs(x-O)<_f?VX(t):(g=T-A,_=w-k,y=x-O,i=1/Math.sqrt(g*g+_*_+y*y),g*=i,_*=i,y*=i,s=R*y-E*_,o=E*g-S*y,l=S*_-R*g,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=_*l-y*o,d=y*s-g*l,h=g*o-_*s,i=Math.sqrt(u*u+d*d+h*h),i?(i=1/i,u*=i,d*=i,h*=i):(u=0,d=0,h=0),t[0]=s,t[1]=u,t[2]=g,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=l,t[9]=h,t[10]=y,t[11]=0,t[12]=-(s*T+o*w+l*x),t[13]=-(u*T+d*w+h*x),t[14]=-(g*T+_*w+y*x),t[15]=1,t)}function eY(){const t=new so(4);return so!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tY(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Tc(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=eY();return function(e,n,r,i,s,o){let l,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var lx;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(lx||(lx={}));const nY=45*Math.PI/180,rY=1,o0=.1,l0=500,iY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Tr extends zX{static get IDENTITY(){return aY()}static get ZERO(){return sY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return lx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=d,this[9]=h,this[10]=g,this[11]=_,this[12]=y,this[13]=T,this[14]=w,this[15]=x,this.check()}setRowMajor(e,n,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=s,this[2]=d,this[3]=y,this[4]=n,this[5]=o,this[6]=h,this[7]=T,this[8]=r,this[9]=l,this[10]=g,this[11]=w,this[12]=i,this[13]=u,this[14]=_,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(iY)}fromObject(e){return this.check()}fromQuaternion(e){return XX(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=o0,far:l=l0}=e;return l===1/0?oY(this,n,r,i,s,o):YX(this,n,r,i,s,o,l),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return JX(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=o0,far:l=l0}=e;return QX(this,n,r,i,s,o,l),this.check()}orthographic(e){const{fovy:n=nY,aspect:r=rY,focalDistance:i=1,near:s=o0,far:o=l0}=e;Vk(n);const l=n/2,u=i*Math.tan(l),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Vk(n),KX(this,n,r,i,s),this.check()}determinant(){return $X(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return qX(this,this),this.check()}invert(){return ox(this,this),this.check()}multiplyLeft(e){return Ns(this,e,this),this.check()}multiplyRight(e){return Ns(this,this,e),this.check()}rotateX(e){return OP(this,this,e),this.check()}rotateY(e){return WX(this,this,e),this.check()}rotateZ(e){return PP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return HX(this,this,e,n),this.check()}scale(e){return j1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Yf(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Tc(n||[-0,-0,-0,-0],e,this),s0(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=AX(n||[-0,-0],e,this);break;case 3:i=IP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return s0(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=RX(n||[-0,-0],e,this);break;case 3:r=MP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return s0(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Qu,Ju;function sY(){return Qu||(Qu=new Tr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Qu)),Qu}function aY(){return Ju||(Ju=new Tr,Object.freeze(Ju)),Ju}function Vk(t){if(t>Math.PI*2)throw Error("expected radians")}function oY(t,e,n,r,i,s){const o=2*s/(n-e),l=2*s/(i-r),u=(n+e)/(n-e),d=(i+r)/(i-r),h=-1,g=-1,_=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=u,t[9]=d,t[10]=h,t[11]=g,t[12]=0,t[13]=0,t[14]=_,t[15]=0,t}function DP(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function lY(t){return t-Math.fround(t)}function cY(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;DP(t[r*4+n],e,i*2)}return e}const uY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fY={name:"fp32",vs:uY},dY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,hY={ONE:1},pY={name:"fp64arithmetic",vs:dY,defaultUniforms:hY,uniformTypes:{ONE:"f32"},fp64ify:DP,fp64LowPart:lY,fp64ifyMatrix4:cY},gY=[0,1,1,1],mY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,_Y=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,qk={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:gY},vs:mY,fs:_Y,getUniforms:vY};function vY(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const $k=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,yY={name:"layer",vs:$k,fs:$k,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},bY=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,jP="#define SMOOTH_EDGE_RADIUS 0.5",xY=`${jP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,wY=`${jP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,BP={name:"geometry",source:bY,vs:xY,fs:wY},TY=25;var zt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(zt||(zt={}));var Xt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Xt||(Xt={}));var je;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(je||(je={}));const SY="compute",EY="auto",cx="manipulation",vf="none",ux="pan-x",fx="pan-y";function AY(t){if(t.includes(vf))return vf;const e=t.includes(ux),n=t.includes(fx);return e&&n?vf:e||n?e?ux:fx:t.includes(cx)?cx:EY}class RY{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===SY&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return AY(e.join(" "))}}function Gf(t){return t.trim().split(/\s+/g)}function c0(t,e,n){if(t)for(const r of Gf(e))t.addEventListener(r,n,!1)}function u0(t,e,n){if(t)for(const r of Gf(e))t.removeEventListener(r,n,!1)}function Hk(t){return(t.ownerDocument||t).defaultView}function CY(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function LP(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function Wk(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:LP(e),deltaX:t.deltaX,deltaY:t.deltaY}}function UP(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function Xk(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function NY(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function Yk(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function FP(t,e){return t===e?Xt.None:Math.abs(t)>=Math.abs(e)?t<0?Xt.Left:Xt.Right:e<0?Xt.Up:Xt.Down}function kY(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===zt.Start||(s==null?void 0:s.eventType)===zt.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function zP(t,e,n){return{x:e/t||0,y:n/t||0}}function MY(t,e){return Xk(e[0],e[1])/Xk(t[0],t[1])}function IY(t,e){return Yk(e[1],e[0])-Yk(t[1],t[0])}function OY(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,l;if(e.eventType!==zt.Cancel&&(r>TY||n.velocity===void 0)){const u=e.deltaX-n.deltaX,d=e.deltaY-n.deltaY,h=zP(r,u,d);s=h.x,o=h.y,i=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,l=FP(u,d),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,l=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function PY(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=Wk(e)),i>1&&!n.firstMultiple?n.firstMultiple=Wk(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,l=o?o.center:s.center,u=e.center=LP(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=NY(l,u),e.distance=UP(l,u);const{deltaX:d,deltaY:h}=kY(n,e);e.deltaX=d,e.deltaY=h,e.offsetDirection=FP(e.deltaX,e.deltaY);const g=zP(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?MY(o.pointers,r):1,e.rotation=o?IY(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let _=t.element;return CY(e.srcEvent.target,_)&&(_=e.srcEvent.target),e.target=_,OY(n,e),e}function DY(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&zt.Start&&r-i===0,o=e&(zt.End|zt.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const l=PY(t,n);t.emit("hammer.input",l),t.recognize(l),t.session.prevInput=l}let jY=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){DY(this.manager,e,n)}init(){c0(this.element,this.evEl,this.domHandler),c0(this.target,this.evTarget,this.domHandler),c0(Hk(this.element),this.evWin,this.domHandler)}destroy(){u0(this.element,this.evEl,this.domHandler),u0(this.target,this.evTarget,this.domHandler),u0(Hk(this.element),this.evWin,this.domHandler)}};const BY={pointerdown:zt.Start,pointermove:zt.Move,pointerup:zt.End,pointercancel:zt.Cancel,pointerout:zt.Cancel},LY="pointerdown",UY="pointermove pointerup pointercancel";class FY extends jY{constructor(e){super(e),this.evEl=LY,this.evWin=UY,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=BY[e.type],s=e.pointerType,o=s==="touch";let l=n.findIndex(u=>u.pointerId===e.pointerId);i&zt.Start&&(e.buttons||o)?l<0&&(n.push(e),l=n.length-1):i&(zt.End|zt.Cancel)&&(r=!0),!(l<0)&&(n[l]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(l,1))}}const zY=["","webkit","Moz","MS","ms","o"];function VY(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of zY){const i=r?r+n:e;if(i in t)return i}}const qY=1,Gk=2,Kk={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class $Y{constructor(e,n){this.options={...Kk,...n,cssProps:{...Kk.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new FY(this),this.touchAction=new RY(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Gk:qY}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&je.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==Gk&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(je.Began|je.Changed|je.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of Gf(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of Gf(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=VY(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let HY=1;function WY(){return HY++}function Zk(t){return t&je.Cancelled?"cancel":t&je.Ended?"end":t&je.Changed?"move":t&je.Began?"start":""}class VP{constructor(e){this.options=e,this.id=WY(),this.state=je.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<je.Ended&&this.manager.emit(this.options.event+Zk(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=je.Ended&&this.manager.emit(this.options.event+Zk(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=je.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(je.Failed|je.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=je.Failed;return}this.state&(je.Recognized|je.Cancelled|je.Failed)&&(this.state=je.Possible),this.state=this.process(n),this.state&(je.Began|je.Changed|je.Ended|je.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class qP extends VP{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(je.Began|je.Changed),s=this.attrTest(e);return i&&(r&zt.Cancel||!s)?n|je.Cancelled:i||s?r&zt.End?n|je.Ended:n&je.Began?n|je.Changed:je.Began:je.Failed}}class Qk extends VP{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[cx]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&zt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==zt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,l=!this.pCenter||UP(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=je.Recognized,this.tryEmit(this._input)},n.interval),je.Began):je.Recognized}return je.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=je.Failed},this.options.interval),je.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===je.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const XY=["","start","move","end","cancel","up","down","left","right"];class Jk extends qP{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Xt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&Xt.Horizontal&&n.push(fx),e&Xt.Vertical&&n.push(ux),n}getEventNames(){return XY.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&n.direction||(n.direction&Xt.Horizontal?(s=o===0?Xt.None:o<0?Xt.Left:Xt.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?Xt.None:l<0?Xt.Up:Xt.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&je.Began)||!(this.state&je.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=Xt[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const YY=["","start","move","end","cancel","in","out"];class GY extends qP{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[vf]}getEventNames(){return YY.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&je.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class Kd{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const KY=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ZY=KY.indexOf("firefox")!==-1,e4=4.000244140625,QY=40,JY=.25;class eG extends Kd{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(ZY&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=QY)),s!==0&&s%e4===0&&(s=Math.floor(s/e4)),i.shiftKey&&s&&(s=s*JY),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const t4=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class tG extends Kd{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,t4.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){t4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const n4=["keydown","keyup"];class nG extends Kd{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",n4.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){n4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class rG extends Kd{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const r4=1,dx=2,i4=4,iG={pointerdown:r4,pointermove:dx,pointerup:i4,mousedown:r4,mousemove:dx,mouseup:i4},sG=0,aG=1,oG=2,lG=1,cG=2,uG=4;function fG(t){const e=iG[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===dx?(i=!!(n&lG),s=!!(n&uG),o=!!(n&cG)):(i=r===sG,s=r===aG,o=r===oG),{leftButton:i,middleButton:s,rightButton:o}}function dG(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const hG={srcElement:"root",priority:0};class pG{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...hG,...r};let d=l.get(u.srcElement);d||(d=[],l.set(u.srcElement,d));const h={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let g=d.length-1;for(;g>=0&&!(d[g].priority>=h.priority);)g--;d.splice(g+1,0,h)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:d,handler:h,once:g}=r[u];if(h({...e,type:d,stopPropagation:s,stopImmediatePropagation:o}),g&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:d,handler:h}=l[u];this.remove(d,h)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...fG(e),...dG(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function gG(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class mG{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new $Y(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=gG(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new eG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new tG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new nG(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new rG(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,l,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(l=this.keyInput)==null||l.enableEventType(e,n),(u=this.contextmenuInput)==null||u.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[d,h]of Object.entries(e))this._addEventHandler(d,h,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new pG(this,d),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const et={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(et,"IDENTITY",{get:()=>(mt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ir={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},js={common:0,meters:1,pixels:2},hx={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},s4={multipan:[Jk,{threshold:10,direction:Xt.Vertical,pointers:2}],pinch:[GY,{},null,["multipan"]],pan:[Jk,{threshold:1},["pinch"],["multipan"]],dblclick:[Qk,{event:"dblclick",taps:2}],click:[Qk,{event:"click"},null,["dblclick"]]};function _G(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Sc(t){let e={},n;return r=>{for(const i in r)if(!_G(r[i],e[i])){n=t(r),e=r;break}return n}}const a4=[0,0,0,0],vG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$P=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],yG=[0,0,0],HP=[0,0,0],bG=Sc(TG);function WP(t,e,n=HP){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===et.LNGLAT_OFFSETS||e===et.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ir.WEB_MERCATOR:(e===et.LNGLAT||e===et.CARTESIAN)&&(i=[0,0,0],s=!1);break;case ir.WEB_MERCATOR_AUTO_OFFSET:e===et.LNGLAT?r=i:e===et.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case ir.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case ir.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function xG(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,l=a4,u=a4,d=t.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:g,offsetMode:_}=WP(t,e,n);return _&&(u=t.projectPosition(h||g),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,l=Tc([],u,o),s=r||s,o=Ns([],i,s),o=Ns([],o,vG)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:g,geospatialOrigin:h}}function wG({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=et.DEFAULT,coordinateOrigin:i=HP,autoWrapLongitude:s=!1}){r===et.DEFAULT&&(r=t.isGeospatial?et.LNGLAT:et.CARTESIAN);const o=bG({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||$P,o}function TG({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:d}=xG(t,n,r),h=t.getDistanceScales(),g=[t.width*e,t.height*e],_=Tc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,y={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:_,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:yG,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:$P,cameraPosition:l};if(d){const T=t.getDistanceScales(d);switch(n){case et.METER_OFFSETS:y.commonUnitsPerWorldUnit=T.unitsPerMeter,y.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case et.LNGLAT:case et.LNGLAT_OFFSETS:t._pseudoMeters||(y.commonUnitsPerMeter=T.unitsPerMeter),y.commonUnitsPerWorldUnit=T.unitsPerDegree,y.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case et.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return y}const SG=Object.keys(et).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${et[t]};`).join(""),EG=Object.keys(ir).map(t=>`const PROJECTION_MODE_${t}: i32 = ${ir[t]};`).join(""),AG=Object.keys(js).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${js[t]};`).join(""),RG=`${SG}
${EG}
${AG}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,CG=`${RG}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,NG=Object.keys(et).map(t=>`const int COORDINATE_SYSTEM_${t} = ${et[t]};`).join(""),kG=Object.keys(ir).map(t=>`const int PROJECTION_MODE_${t} = ${ir[t]};`).join(""),MG=Object.keys(js).map(t=>`const int UNIT_${t.toUpperCase()} = ${js[t]};`).join(""),IG=`${NG}
${kG}
${MG}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,OG={};function PG(t=OG){return"viewport"in t?wG(t):{}}const B1={name:"project",dependencies:[fY,BP],source:CG,vs:IG,getUniforms:PG,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},DG=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,jG=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,XP={name:"project32",dependencies:[B1],source:DG,vs:jG};function BG(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Za(t,e){const n=Tc([],e,t);return tY(n,n,1/n[3]),n}function o4(t,e){const n=t%e;return n<0?e+n:n}function px(t,e,n){return t<e?e:t>n?n:t}function LG(t){return Math.log(t)*Math.LOG2E}const L1=Math.log2||LG;function di(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const br=Math.PI,YP=br/4,or=br/180,gx=180/br,ao=512,Kf=4003e4,l4=85.051129,UG=1.5;function FG(t){return L1(t)}function Zf(t){const[e,n]=t;di(Number.isFinite(e)),di(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*or,i=n*or,s=ao*(r+br)/(2*br),o=ao*(br+Math.log(Math.tan(YP+i*.5)))/(2*br);return[s,o]}function oo(t){const[e,n]=t,r=e/ao*(2*br)-br,i=2*(Math.atan(Math.exp(n/ao*(2*br)-br))-YP);return[r*gx,i*gx]}function zG(t){const{latitude:e}=t;di(Number.isFinite(e));const n=Math.cos(e*or);return FG(Kf*n)-9}function f0(t){const e=Math.cos(t*or);return ao/Kf/e}function mx(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;di(Number.isFinite(e)&&Number.isFinite(n));const i=ao,s=Math.cos(e*or),o=i/360,l=o/s,u=i/Kf/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const h=or*Math.tan(e*or)/s,g=o*h/2,_=i/Kf*h,y=_/l*u;d.unitsPerDegree2=[0,g,_],d.unitsPerMeter2=[y,0,y]}return d}function GP(t,e){const[n,r,i]=t,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:d}=mx({longitude:n,latitude:r,highPrecision:!0}),h=Zf(t);h[0]+=s*(u[0]+d[0]*o),h[1]+=o*(u[1]+d[1]*o);const g=oo(h),_=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[g[0],g[1],_]:g}function VG(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,l=BG();Yf(l,l,[0,0,-i]),OP(l,l,-n*or),PP(l,l,r*or);const u=s/e;return j1(l,l,[u,u,u]),o&&Yf(l,l,MX([],o)),l}function qG(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:d=1}=t;let{fovy:h=Qf(UG)}=t;r!==void 0&&(h=Qf(r));const g=h*or,_=i*or,y=U1(h);let T=y;o&&(T+=o[2]*l/Math.cos(_)/n);const w=g*(.5+(s?s[1]:0)/n),x=Math.sin(w)*T/Math.sin(px(Math.PI/2-_-w,.01,Math.PI-.01)),S=Math.sin(_)*x+T,R=T*10,E=Math.min(S*d,R);return{fov:g,aspect:e/n,focalDistance:y,near:u,far:E}}function Qf(t){return 2*Math.atan(.5/t)*gx}function U1(t){return .5/Math.tan(.5*t*or)}function KP(t,e){const[n,r,i=0]=t;return di(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Za(e,[n,r,i,1])}function Zd(t,e,n=0){const[r,i,s]=t;if(di(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Za(e,[r,i,s,1]);const o=Za(e,[r,i,0,1]),l=Za(e,[r,i,1,1]),u=o[2],d=l[2],h=u===d?0:((n||0)-u)/(d-u);return kP([],o,l,h)}function $G(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[l,u],[d,h]]=r,g=HG(t.padding),_=Zf([l,px(h,-85.051129,l4)]),y=Zf([d,px(u,-85.051129,l4)]),T=[Math.max(Math.abs(y[0]-_[0]),i),Math.max(Math.abs(y[1]-_[1]),i)],w=[e-g.left-g.right-Math.abs(o[0])*2,n-g.top-g.bottom-Math.abs(o[1])*2];di(w[0]>0&&w[1]>0);const x=w[0]/T[0],S=w[1]/T[1],R=(g.right-g.left)/2/x,E=(g.top-g.bottom)/2/S,A=[(y[0]+_[0])/2+R,(y[1]+_[1])/2+E],k=oo(A),O=Math.min(s,L1(Math.abs(Math.min(x,S))));return di(Number.isFinite(O)),{longitude:k[0],latitude:k[1],zoom:O}}function HG(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(di(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const c4=Math.PI/180;function WG(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),l=i([n,r],s);let u,d;const h=t.fovy?.5*t.fovy*c4:Math.atan(.5/t.altitude),g=(90-t.pitch)*c4;return h>g-.01?(u=u4(t,0,e),d=u4(t,n,e)):(u=i([0,0],s),d=i([n,0],s)),[o,l,d,u]}function u4(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Za(r,[e,0,1,1]),s=Za(r,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=kP([],i,s,l),d=oo(u);return d.push(n),d}const f4=512;function XG(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=t;(i<-180||i>180)&&(i=o4(i+180,360)-180),(l<-180||l>180)&&(l=o4(l+180,360)-180);const u=L1(n/f4);if(o<=u)o=u,s=0;else{const d=n/2/Math.pow(2,o),h=oo([0,d])[1];if(s<h)s=h;else{const g=oo([0,f4-d])[1];s>g&&(s=g)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const ZP=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,YG=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,GG=`
${ZP}
${YG}
`,KG=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,ZG=`
${ZP}
${KG}
`,QG=Sc(rK),JG=Sc(iK),eK=[0,0,0,1],tK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function nK(t,e){const[n,r,i]=t,s=Zd([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function rK({viewport:t,center:e}){return new Tr(t.viewProjectionMatrix).invert().transform(e)}function iK({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>nK(o,r));for(const o of e){const l=o.clone().translate(new Fr(t.center).negate()),u=s.map(h=>l.transform(h)),d=new Tr().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});n.push(d.multiplyRight(o))}return n}function sK(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=B1.getUniforms(n),i=QG({viewport:n.viewport,center:r.center}),s=[],o=JG({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const d=o[u],h=d.clone().translate(new Fr(n.viewport.center).negate());r.coordinateSystem===et.LNGLAT&&r.projectionMode===ir.WEB_MERCATOR?(o[u]=h,s[u]=i):(o[u]=d.clone().multiplyRight(tK),s[u]=h.transform(i))}const l={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||eK,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return l}const d4={name:"shadow",dependencies:[B1],vs:GG,fs:ZG,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:sK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},QP={...qk,defaultUniforms:{...qk.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},aK=[BP],oK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],lK=[];function cK(t){const e=Df.getDefaultShaderAssembler();for(const r of aK)e.addDefaultModule(r);const n=t==="glsl"?oK:lK;for(const r of n)e.addShaderHook(r);return e}const uK=[255,255,255],fK=1;let dK=0;class hK{constructor(e={}){this.type="ambient";const{color:n=uK}=e,{intensity:r=fK}=e;this.id=e.id||`ambient-${dK++}`,this.color=n,this.intensity=r}}const pK=[255,255,255],gK=1,mK=[0,0,-1];let _K=0;class h4{constructor(e={}){this.type="directional";const{color:n=pK}=e,{intensity:r=gK}=e,{direction:i=mK}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${_K++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Fr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class vK{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class F1 extends vK{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,n,r]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(h,e)}finally{h.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=n;n.pass=n.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const h of s){const g=o&&o[h.id];l==null||l(h);const _=this._getDrawLayerParams(h,n),y=h.subViewports||[h];for(const T of y){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:T,view:g,pass:n.pass,layers:n.layers},_);d.push(w)}}return d}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},d=!1){var T;const h=[],g=JP(this._lastRenderIndex+1),_={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},y={};for(let w=0;w<n.length;w++){const x=n[w],S=this._shouldDrawLayer(x,_,s,y),R={shouldDrawLayer:S};S&&!d&&(R.shouldDrawLayer=!0,R.layerRenderIndex=g(x,S),R.shaderModuleProps=this._getShaderModuleProps(x,l,r,u),R.layerParameters={...(T=x.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(x,w,e)}),h[w]=R}return h}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const d=yK(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const g=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const h={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let g=0;g<n.length;g++){const _=n[g],y=u[g],{shouldDrawLayer:T}=y;if(T&&_.props.pickable&&h.pickableCount++,_.isComposite&&h.compositeCount++,_.isDrawable&&y.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:x,layerParameters:S}=y;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),x.project&&(x.project.viewport=o),_.context.renderPass=e;try{_._drawLayer({renderPass:e,shaderModuleProps:x,uniforms:{layerIndex:w},parameters:S})}catch(R){_.raiseError(R,`drawing ${_} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const l=n.layer.id;if(l in i||(i[l]=r(n)),!i[l])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const h of n)p4(l,(d=h.getShaderModuleProps)==null?void 0:d.call(h,e,l));return p4(l,this.getShaderModuleProps(e,n,l),i)}}function JP(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in n){const h=n[u]=n[u]||JP(e[u],e);d=h(i,s),n[l]=h}else Number.isFinite(o)?(d=o+(e[u]||0),n[l]=null):d=t;return s&&d>=t&&(t=d+1),e[l]=d,d};return r}function yK(t,{shaderModuleProps:e,target:n,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function p4(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class bK extends F1{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:l,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const xK={color:[255,255,255],intensity:1},g4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],wK=[0,0,0,200/255];class eD{constructor(e={}){this.id="lighting-effect",this.shadowColor=wK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(d4),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(d4))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Tr().lookAt({eye:new Fr(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new bK(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new hK(xK),this.directionalLights.push(new h4(g4[0]),new h4(g4[1])))}}class TK{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,h=n*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,h)}let g=1/0;u&&(g=u*r+s);const _=this._allocate(d,h,l,g);return e&&o?_.set(e):l||_.fill(0,0,4),this._release(e),_}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(d=>d.byteLength>=l);if(u>=0){const d=new e(o.splice(u,1)[0],0,s);return r&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const ac=new TK;function jl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function SK(t,e){const n=t%e;return n<0?e+n:n}function EK(t){return[t[12],t[13],t[14]]}function AK(t){return{left:Ua(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ua(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ua(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ua(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ua(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ua(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const m4=new Fr;function Ua(t,e,n,r){m4.set(t,e,n);const i=m4.len();return{distance:r/i,normal:new Fr(-t/i,-e/i,-n/i)}}function RK(t){return t-Math.fround(t)}let Sl;function d0(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Sl=ac.allocate(Sl,s,{type:Float32Array,size:n*2});let o=r,l=0;for(;o<i;){for(let u=0;u<n;u++){const d=t[o++];Sl[l+u]=d,Sl[l+u+n]=RK(d)}l+=n*2}return Sl.subarray(0,s*n*2)}function CK(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const NK=Math.PI/180,kK=jl(),_4=[0,0,0],MK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function IK({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=t/e,d=n?new Tr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new Tr().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:h=0,right:g=0,top:_=0,bottom:y=0}=s,T=Wn((h+t-g)/2,0,t)-t/2,w=Wn((_+e-y)/2,0,e)-e/2;d[8]-=T*2/t,d[9]+=w*2/e}return d}class yo{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||MK,this.focalDistance=e.focalDistance||1,this.position=e.position||_4,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ir.WEB_MERCATOR:ir.WEB_MERCATOR_AUTO_OFFSET:ir.IDENTITY}equals(e){return e instanceof yo?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&sc(e.projectionMatrix,this.projectionMatrix)&&sc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=KP(r,this.pixelProjectionMatrix),[s,o]=i,l=n?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,l=n?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],d=Zd([i,l,o],this.pixelUnprojectionMatrix,u),[h,g,_]=this.unprojectPosition(d);return Number.isFinite(o)?[h,g,_]:Number.isFinite(r)?[h,g,r]:[h,g]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Zf(e);return n[1]=Wn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?oo(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?mx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,AK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=zG({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||mx({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=_4;if(s&&(l=o?new Tr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new Fr(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=kK,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:d=null,focalDistance:h=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Tr().multiplyRight(n).translate(new Fr(this.center).negate()),this.projectionMatrix=r||IK({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*NK,focalDistance:h,padding:d,near:l,far:u});const g=jl();Ns(g,g,this.projectionMatrix),Ns(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=ox([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=EK(this.viewMatrixInverse);const _=jl(),y=jl();j1(_,_,[this.width/2,-this.height/2,1]),Yf(_,_,[1,-1,0]),Ns(y,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=ox(jl(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||mt.warn("Pixel project matrix not invertible")()}}yo.displayName="Viewport";class lo extends yo{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:d,farZ:h,orthographic:g=!1,projectionMatrix:_,repeat:y=!1,worldOffset:T=0,position:w,padding:x,legacyMeterSizes:S=!1}=e;let{width:R,height:E,altitude:A=1.5}=e;const k=Math.pow(2,i);R=R||1,E=E||1;let O,j=null;if(_)A=_[5]/2,O=Qf(A);else{e.fovy?(O=e.fovy,A=U1(O)):O=Qf(A);let I;if(x){const{top:M=0,bottom:q=0}=x;I=[0,Wn((M+E-q)/2,0,E)-E/2]}j=qG({width:R,height:E,scale:k,center:w&&[0,0,w[2]*f0(n)],offset:I,pitch:s,fovy:O,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(d)&&(j.near=d),Number.isFinite(h)&&(j.far=h)}let N=VG({height:E,pitch:s,bearing:o,scale:k,altitude:A});T&&(N=new Tr().translate([512*T,0,0]).multiplyLeft(N)),super({...e,width:R,height:E,viewMatrix:N,longitude:r,latitude:n,zoom:i,...j,fovy:O,focalDistance:A}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=A,this.fovy=O,this.orthographic=g,this._subViewports=y?[]:null,this._pseudoMeters=S,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new lo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*f0(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/f0(r);return[n,r,i]}addMetersToLngLat(e,n){return GP(e,n)}panByPosition(e,n){const r=Zd(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=zk([],i,EX([],r)),o=zk([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const n=WG(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=$G({width:r,height:i,bounds:e,...n});return new lo({width:r,height:i,longitude:s,latitude:o,zoom:l})}}lo.displayName="WebMercatorViewport";const v4=[0,0,0];function h0(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof lo){const[i,s,o=0]=t,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function OK(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===et.DEFAULT&&(i=e.isGeospatial?et.LNGLAT:et.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function tD(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=t;switch(n&&([o,l,u]=Tc([],[o,l,u,1],n)),r){case et.LNGLAT:return h0([o,l,u],e,s);case et.LNGLAT_OFFSETS:return h0([o+i[0],l+i[1],u+(i[2]||0)],e,s);case et.METER_OFFSETS:return h0(GP(i,[o,l,u]),e,s);case et.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function PK(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=OK(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=v4,shaderCoordinateOrigin:h=v4,offsetMode:g=!1}=u?WP(n,r,i):{},_=tD(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:g});if(g){const y=n.projectPosition(d||h);FX(_,_,y)}return _}let DK=1,jK=1;class nD{constructor(){D(this,"time",0);D(this,"channels",new Map);D(this,"animations",new Map);D(this,"playing",!1);D(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=DK++,l={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=jK++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function BK(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function LK(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let UK=0;const FK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:K0.stats.get(`animation-loop-${UK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class zK{constructor(e){D(this,"device",null);D(this,"canvas",null);D(this,"props");D(this,"animationProps",null);D(this,"timeline",null);D(this,"stats");D(this,"cpuTime");D(this,"gpuTime");D(this,"frameRate");D(this,"display");D(this,"needsRedraw","initialized");D(this,"_initialized",!1);D(this,"_running",!1);D(this,"_animationFrameId",null);D(this,"_nextFramePromise",null);D(this,"_resolveNextFrame",null);D(this,"_cpuStartTime",0);D(this,"_error",null);if(this.props={...FK,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Xd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=BK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(LK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,l,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const p0={};function Qd(t="id"){p0[t]=p0[t]||1;const e=p0[t]++;return`${t}-${e}`}class y4{constructor(e){D(this,"id");D(this,"userData",{});D(this,"topology");D(this,"bufferLayout",[]);D(this,"vertexCount");D(this,"indices");D(this,"attributes");if(this.id=e.id||Qd("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&wt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function VK(t,e){if(e instanceof y4)return e;const n=qK(t,e),{attributes:r,bufferLayout:i}=$K(t,e);return new y4({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function qK(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:wt.INDEX,data:n})}function $K(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:d,normalized:h}=o;n.push({name:l,format:UW(u,d,h)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const yd=class yd{constructor(e){D(this,"device");D(this,"destroyPolicy");D(this,"_hashCounter",0);D(this,"_hashes",{});D(this,"_renderPipelineCache",{});D(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new yd(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...no.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Ff.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Ff?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};D(yd,"defaultProps",{...no.defaultProps});let _x=yd;const bd=class bd{constructor(e){D(this,"device");D(this,"destroyPolicy");D(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new bd(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};D(bd,"defaultProps",{...Bf.defaultProps});let vx=bd;function HK(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let en=null,ys=null;function WK(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){en||(en=document.createElement("canvas"),en.id=e,en.title=e,en.style.zIndex="100",en.style.position="absolute",en.style.top=i,en.style.left=s,en.style.border="blue 5px solid",en.style.transform="scaleY(-1)",document.body.appendChild(en),ys=en.getContext("2d")),(en.width!==t.width||en.height!==t.height)&&(en.width=t.width/2,en.height=t.height/2,en.style.width="400px",en.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),u=ys==null?void 0:ys.createImageData(t.width,t.height);if(u){for(let h=0;h<l.length;h+=4)u.data[0+h+0]=l[h+0]*o,u.data[0+h+1]=l[h+1]*o,u.data[0+h+2]=l[h+2]*o,u.data[0+h+3]=r?255:l[h+3]*o;ys==null||ys.putImageData(u,0,0)}}function yx(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!yx(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!yx(t[s],e[s],n-1))return!1;return!0}return!1}function XK(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function YK(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function rD(t){return XK(t)||YK(t)}function GK(t){return rD(t)||typeof t=="number"||typeof t=="boolean"}function iD(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];GK(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class KK{constructor(e,n){D(this,"options",{disableWarnings:!1});D(this,"modules");D(this,"moduleUniforms");D(this,"moduleBindings");Object.assign(this.options,n);const r=E1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;be.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&be.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||be.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],d=((n=o.getUniforms)==null?void 0:n.call(o,s,l))||s,{uniforms:h,bindings:g}=iD(d);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...u,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let ZK="";async function QK(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:ZK+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class g0{constructor(e,n){D(this,"device");D(this,"id");D(this,"texture");D(this,"sampler");D(this,"view");D(this,"ready");D(this,"isReady",!1);D(this,"destroyed",!1);D(this,"resolveReady",()=>{});D(this,"rejectReady",()=>{});this.device=e,this.id=n.id||Qd("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:QK(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data;let r;try{r=await sD(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function sD(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(sD));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const bs=2,JK=1e4,xd=class xd{constructor(e,n){D(this,"device");D(this,"id");D(this,"source");D(this,"vs");D(this,"fs");D(this,"pipelineFactory");D(this,"shaderFactory");D(this,"userData",{});D(this,"parameters");D(this,"topology");D(this,"bufferLayout");D(this,"isInstanced");D(this,"instanceCount",0);D(this,"vertexCount");D(this,"indexBuffer",null);D(this,"bufferAttributes",{});D(this,"constantAttributes",{});D(this,"bindings",{});D(this,"uniforms",{});D(this,"vertexArray");D(this,"transformFeedback",null);D(this,"pipeline");D(this,"shaderInputs");D(this,"_uniformStore");D(this,"_attributeInfos",{});D(this,"_gpuGeometry",null);D(this,"_getModuleUniforms");D(this,"props");D(this,"_pipelineNeedsUpdate","newly created");D(this,"_needsRedraw","initializing");D(this,"_destroyed",!1);D(this,"_lastDrawTimestamp",-1);D(this,"_lastLogTime",0);D(this,"_logOpen",!1);D(this,"_drawCount",0);var u,d,h,g;this.props={...xd.defaultProps,...n},n=this.props,this.id=n.id||Qd("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(_=>[_.name,_]))||[]),i=n.shaderInputs||new KK(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=tZ(e),o=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(h=this.shaderInputs)==null?void 0:h.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=_,this._getModuleUniforms=y,(g=this.props).shaderLayout||(g.shaderLayout=gX(this.source))}else{const{vs:_,fs:y,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=_,this.fs=y,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||_x.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||vx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return be.info(bs,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),bx(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&VK(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new n0(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new n0(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){yx(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new LW(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(eZ(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&be.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=FW(this.pipeline.shaderLayout,this.bufferLayout);const i=new n0(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||be.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let d=!1;for(const h of u){const g=this._attributeInfos[h];if(g){const _=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(_,o),d=!0}}!d&&!r&&be.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||be.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){bx(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=iD(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof g0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof g0?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof jf?e=Math.max(e,n.texture.updateTimestamp):n instanceof wt||n instanceof kt?e=Math.max(e,n.updateTimestamp):n instanceof g0?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Lf||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(be.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=iP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=be.level>3?0:JK;be.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,be.group(bs,`>>> DRAWING MODEL ${this.id}`,{collapsed:be.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=HK(this.pipeline.shaderLayout,this.id);be.table(bs,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};be.table(bs,n)();const r=this._getAttributeDebugTable();be.table(bs,this._attributeInfos)(),be.table(bs,r)(),be.groupEnd(bs)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&WK(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=oP(n);return(e instanceof wt?new r(e.debugData):e).toString()}};D(xd,"defaultProps",{...no.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Df.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let co=xd;function eZ(t){return!!(t.uniformTypes&&!bx(t.uniformTypes))}function tZ(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function bx(t){for(const e in t)return!1;return!0}const Gl=class Gl{constructor(e,n=Gl.defaultProps){D(this,"device");D(this,"model");D(this,"transformFeedback");if(!Gl.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new co(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||zH(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof wt)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};D(Gl,"defaultProps",{...co.defaultProps,outputs:void 0,feedbackBuffers:void 0});let oc=Gl;class aD{constructor(e){D(this,"id");D(this,"topology");D(this,"vertexCount");D(this,"indices");D(this,"attributes");D(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Qd("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const nZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class oD extends F1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:d,height:h},cullRect:g,effects:_,pass:y="picking",pickZ:T,shaderModuleProps:w}){this.pickZ=T;const x=this._resetColorEncoder(T),S=[l,u,d,h],R=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:_==null?void 0:_.filter(A=>A.useInPicking),pass:y,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:S});return this._colorEncoderState=null,{decodePickingColor:x&&iZ.bind(null,x),stats:R}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,nZ),i.blend=!0,i.blendColor=rZ(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function rZ(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(mt.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function iZ(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Va={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Jf=Symbol.for("component"),ks=Symbol.for("propTypes"),m0=Symbol.for("deprecatedProps"),Qa=Symbol.for("asyncPropDefaults"),Bs=Symbol.for("asyncPropOriginal"),Zi=Symbol.for("asyncPropResolved");function lD(t,e=()=>!0){return Array.isArray(t)?cD(t,e,[]):e(t)?[t]:[]}function cD(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?cD(i,e,n):e(i)&&n.push(i)}return n}function sZ({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=n;o<i;o++)t[l++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class aZ{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=q0(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class oZ{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new aZ(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[n];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[n]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const lZ="layerManager.setLayers",cZ="layerManager.activateViewport";class uZ{constructor(e,n){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{xn(cZ,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new oZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:cK(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[yY],renderPass:void 0,stats:i||new Xd({id:"deck.gl"}),viewport:s||new yo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new nD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){xn(lZ,this,n,e),this._lastRenderedLayers=e;const r=lD(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?mt.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&mt.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Va.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Va.MATCHED,n!==e&&(e.lifecycle=Va.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Va.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Va.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function xr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!xr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!xr(t[s],e[s],n-1))return!1;return!0}return!1}class fZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=lD(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!xr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):mt.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=n[s.id];const d=!!s.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const dZ=/([0-9]+\.?[0-9]*)(%|px)/;function Li(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=dZ.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Ui(t,e){return t.relative?Math.round(t.position*e):t.position}class Ls{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Li(r),this._y=Li(i),this._width=Li(s),this._height=Li(o),this._padding=l&&{left:Li(l.left||0),right:Li(l.right||0),top:Li(l.top||0),bottom:Li(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&xr(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Ui(this._x,e),y:Ui(this._y,n),width:Ui(this._width,e),height:Ui(this._height,n)};return this._padding&&(r.padding={left:Ui(this._padding.left,e),top:Ui(this._padding.top,n),right:Ui(this._padding.right,e),bottom:Ui(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Jd{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const b4=()=>{},xx={BREAK:1,SNAP_TO_END:2,IGNORE:3},hZ=t=>t,pZ=xx.BREAK;class gZ{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=n,d=u(r/l),h=i.interpolateProps(s,o,d);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Jd(e.timeline),this.onViewStateChange=e.onViewStateChange||b4,this.onStateChange=e.onStateChange||b4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===xx.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===xx.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:n.transitionEasing||hZ,interpolator:s,interruption:n.transitionInterruption||pZ,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function mn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class mZ{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!sc(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];mn(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const _Z=["longitude","latitude","zoom","bearing","pitch"],vZ=["longitude","latitude","zoom"];class z1 extends mZ{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:_Z,required:vZ},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(n),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Xf(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Xf(e.around,n.around,r)))}return i}}const Fi={transitionDuration:0},yZ=300,ef=t=>1-(1-t)*(1-t),Fa={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},xs={};class uD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new gZ({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?yZ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:d=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(Fa.WHEEL,h&&r),this.toggleEvents(Fa.PAN,h),this.toggleEvents(Fa.PINCH,h&&(l||u)),this.toggleEvents(Fa.MULTI_PAN,h&&u),this.toggleEvents(Fa.DOUBLE_CLICK,h&&o),this.toggleEvents(Fa.KEYBOARD,h&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Fi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Fi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ef},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Fi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ef},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Fi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Fi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ef},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return xs._startPinchRotation=e.rotation,xs._lastPinchEvent=e,this.updateViewport(r,Fi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:xs._startPinchRotation-r})}return this.updateViewport(n,Fi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),xs._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=xs;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*n/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:ef},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return xs._startPinchRotation=null,xs._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=n?l.zoomOut(r).zoomOut(r):l.zoomOut(r),d.isZooming=!0;break;case"Equal":u=n?l.zoomIn(r).zoomIn(r):l.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":n?(u=l.rotateLeft(s),d.isRotating=!0):(u=l.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":n?(u=l.rotateRight(s),d.isRotating=!0):(u=l.moveRight(i),d.isPanning=!0);break;case"ArrowUp":n?(u=l.rotateUp(o),d.isRotating=!0):(u=l.moveUp(i),d.isPanning=!0);break;case"ArrowDown":n?(u=l.rotateDown(o),d.isRotating=!0):(u=l.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Fi:e?{...n,transitionInterpolator:new z1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class fD{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const x4=5,bZ=1.2;class xZ extends fD{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:d=1.5,position:h=[0,0,0],maxZoom:g=20,minZoom:_=0,maxPitch:y=60,minPitch:T=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:R,startPitch:E,startZoom:A,normalize:k=!0}=e;mn(Number.isFinite(s)),mn(Number.isFinite(i)),mn(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:d,maxZoom:g,minZoom:_,maxPitch:y,minPitch:T,normalize:k,position:h},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:R,startPitch:E,startZoom:A}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+n,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Wn(u,l,o);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Wn(i,r,n);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Wn(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,XG(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],l=e[1],u=n[1],{width:d,height:h}=this.getViewportProps(),g=s/d;let _=0;o>0?Math.abs(h-u)>x4&&(_=o/(u-h)*bZ):o<0&&u>x4&&(_=1-l/u),_=Wn(_,-1,1);const{minPitch:y,maxPitch:T}=this.getViewportProps(),w=i+180*g;let x=r;return _>0?x=r+_*(T-r):_<0&&(x=r-_*(y-r)),{pitch:x,bearing:w}}}class wZ extends uD{constructor(){super(...arguments),this.ControllerState=xZ,this.transition={transitionDuration:300,transitionInterpolator:new z1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class dD extends Ls{constructor(e={}){super(e)}getViewportType(){return lo}get ControllerType(){return wZ}}dD.displayName="MapView";const TZ=new eD;function SZ(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class EZ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>SZ(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(xr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof eD)||this._resolvedEffects.push(TZ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class AZ extends F1{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const RZ="deckRenderer.renderLayers";class CZ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new AZ(e),this.pickLayersPass=new oD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,xn(RZ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const NZ={pickedColor:null,pickedObjectIndex:-1};function kZ({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:d}=s;let h=i*i,g=-1,_=0;for(let y=0;y<d;y++){const T=y+l-r,w=T*T;if(w>h)_+=4*u;else for(let x=0;x<u;x++){if(t[_+3]-1>=0){const R=x+o-n,E=R*R+w;E<=h&&(h=E,g=_)}_+=4}}if(g>=0){const y=t.slice(g,g+4),T=e(y);if(T){const w=Math.floor(g/4/u),x=g/4-w*u;return{...T,pickedColor:y,pickedX:o+x,pickedY:l+w}}mt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return NZ}function MZ({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const l=e(s);l?n.set(o,{...l,color:s}):mt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function hD({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=OZ((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function IZ(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const g=n.index,_=n.layerId,y=o?o.props.id:null;if(y!==_||l!==g){if(y!==_){const T=i.find(w=>w.props.id===_);T&&u.unshift(T)}n.layerId=y,n.index=l,n.info=null}}const d=hD(t),h=new Map;return h.set(null,d),u.forEach(g=>{let _={...d};g===o&&(_.color=s,_.index=l,_.picked=!0),_=pD({layer:g,info:_,mode:r});const y=_.layer;g===o&&r==="hover"&&(n.info=_),h.set(y.id,_),r==="hover"&&y.updateAutoHighlight(_)}),h}function pD({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function OZ(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class PZ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new oD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(_=>_.id===o):null,d=l&&i.find(_=>_.id===l)||i[0],h=d&&d.unproject([e-d.x,n-d.y]);return{...s,...{x:e,y:n,viewport:d,coordinate:h,layer:u}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:d,onViewportActive:h,effects:g}){const _=this.device.canvasContext.cssToDeviceRatio(),y=this._getPickable(e);if(!y||r.length===0)return{result:[],emptyInfo:hD({viewports:r,x:i,y:s,pixelRatio:_})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],x=Math.round(o*_),{width:S,height:R}=this.pickingFBO,E=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:S,deviceHeight:R}),A={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let k;const O=[],j=new Set;for(let N=0;N<l;N++){let I;if(E){const q=this._drawAndSample({layers:y,views:n,viewports:r,onViewportActive:h,deviceRect:E,cullRect:A,effects:g,pass:`picking:${u}`});I=kZ({...q,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:E})}else I={pickedColor:null,pickedObjectIndex:-1};let M;if(I.pickedLayer&&d&&this.depthFBO){const{pickedColors:q}=this._drawAndSample({layers:[I.pickedLayer],views:n,viewports:r,onViewportActive:h,deviceRect:{x:I.pickedX,y:I.pickedY,width:1,height:1},cullRect:A,effects:g,pass:`picking:${u}:z`},!0);q[3]&&(M=q[0])}I.pickedLayer&&N+1<l&&(j.add(I.pickedLayer),I.pickedLayer.disablePickingIndex(I.pickedObjectIndex)),k=IZ({pickInfo:I,lastPickedInfo:this.lastPickedInfo,mode:u,layers:y,viewports:r,x:i,y:s,z:M,pixelRatio:_});for(const q of k.values())q.layer&&O.push(q);if(!I.pickedColor)break}for(const N of j)N.restorePickingColors();return{result:O,emptyInfo:k.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:d=null,onViewportActive:h,effects:g}){const _=this._getPickable(e);if(!_||r.length===0)return[];this._resizeBuffer();const y=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=T.x,x=T.y+T.height,S=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),R=S.x+S.width,E=S.y,A={x:w,y:E,width:R-w,height:x-E},k=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:h,deviceRect:A,cullRect:{x:i,y:s,width:o,height:l},effects:g,pass:`picking:${u}`}),O=MZ(k),j=new Map,N=[],I=Number.isFinite(d);for(let M=0;M<O.length&&!(I&&N.length>=d);M++){const q=O[M];let X={color:q.pickedColor,layer:null,index:q.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:y};X=pD({layer:q.pickedLayer,info:X,mode:u});const G=X.layer.id;j.has(G)||j.set(G,new Set);const L=j.get(G),J=X.object??X.index;L.has(J)||(L.add(J),N.push(X))}return N}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},d=!1){const h=d?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const R of l)R.useInPicking&&(g.preRenderStats[R.id]=R.preRender(g));const{decodePickingColor:_}=this.pickLayersPass.render(g),{x:y,y:T,width:w,height:x}=s,S=new(d?Float32Array:Uint8Array)(w*x*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:y,sourceY:T,sourceWidth:w,sourceHeight:x,target:S}),{pickedColors:S,decodePickingColor:_}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,n-r),u=Math.min(i,e+r+1)-o,d=Math.min(s,n+r+1)-l;return u<=0||d<=0?null:{x:o,y:l,width:u,height:d}}}const DZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},jZ="top-left",w4="__root";class BZ{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!xr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=jZ}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||w4;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,DZ[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===w4||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=r[l];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:n}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=hx[n.type];if(r)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}}const LZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class UZ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,LZ),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var $a;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})($a||($a={}));const V1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ut=(t,e,n)=>e?t.enable(n):t.disable(n),T4=(t,e,n)=>t.hint(n,e),Vn=(t,e,n)=>t.pixelStorei(n,e),S4=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},El=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function _0(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const FZ={3042:Ut,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ut,2885:(t,e)=>t.cullFace(e),2929:Ut,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ut,35723:T4,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:S4,36010:S4,34964:El,36662:El,36663:El,35053:El,35055:El,2886:(t,e)=>t.frontFace(e),33170:T4,2849:(t,e)=>t.lineWidth(e),32823:Ut,32824:"polygonOffset",10752:"polygonOffset",35977:Ut,32926:Ut,32928:Ut,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ut,3088:(t,e)=>t.scissor(...e),2960:Ut,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ut,10754:Ut,12288:Ut,12289:Ut,12290:Ut,12291:Ut,12292:Ut,12293:Ut,12294:Ut,12295:Ut,3333:Vn,3317:Vn,37440:Vn,37441:Vn,37443:Vn,3330:Vn,3332:Vn,3331:Vn,3314:Vn,32878:Vn,3316:Vn,3315:Vn,32877:Vn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=_0(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=_0(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,l)},stencilOp:(t,e)=>{e=_0(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,l)},viewport:(t,e)=>t.viewport(...e)};function Nt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const zZ={blendEquation:(t,e,n)=>t.blendEquationSeparate(Nt(32777,e,n),Nt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Nt(32969,e,n),Nt(32968,e,n),Nt(32971,e,n),Nt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Nt(32824,e,n),Nt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Nt(32938,e,n),Nt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Nt(2962,e,n),Nt(2967,e,n),Nt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Nt(34816,e,n),Nt(36003,e,n),Nt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Nt(2964,e,n),Nt(2965,e,n),Nt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Nt(34817,e,n),Nt(34818,e,n),Nt(34819,e,n))},E4={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Pr=(t,e)=>t.isEnabled(e),A4={3042:Pr,2884:Pr,2929:Pr,3024:Pr,32823:Pr,32926:Pr,32928:Pr,3089:Pr,2960:Pr,35977:Pr},VZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function bo(t,e){if($Z(e))return;const n={};for(const i in e){const s=Number(i),o=FZ[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=zZ[i];s(t,e,r)}}function gD(t,e=V1){if(typeof e=="number"){const i=e,s=A4[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=A4[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function qZ(t){bo(t,V1)}function $Z(t){for(const e in t)return!1;return!0}function HZ(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Ms{constructor(e,n){D(this,"gl");D(this,"program",null);D(this,"stateStack",[]);D(this,"enable",!0);D(this,"cache",null);D(this,"log");D(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];bo(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?gD(e):Object.assign({},V1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,XZ(e);for(const r in E4){const i=E4[r];WZ(e,r,i)}R4(e,"getParameter"),R4(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];HZ(o,l)||(n=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function R4(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||VZ.has(i))return n(i);const s=Ms.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function WZ(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=Ms.get(t),{valueChanged:l,oldValue:u}=n(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function XZ(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=Ms.get(t);i.program!==r&&(e(r),i.program=r)}}function YZ(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return t.addEventListener("webglcontextlost",u=>o(u),!1),t.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||(s.luma={}),s}function uo(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function GZ(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);uo(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||n,u=o||r,d=t.getParameter(7938),h=mD(l,u),g=KZ(l,u),_=ZZ(l,u);return{type:"webgl",gpu:h,gpuType:_,gpuBackend:g,vendor:l,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function mD(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function KZ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function ZZ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(mD(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function _D(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Bl="WEBGL_compressed_texture_s3tc",Ll="WEBGL_compressed_texture_s3tc_srgb",Ha="EXT_texture_compression_rgtc",Wa="EXT_texture_compression_bptc",QZ="WEBGL_compressed_texture_etc",JZ="WEBGL_compressed_texture_astc",eQ="WEBGL_compressed_texture_etc1",tQ="WEBGL_compressed_texture_pvrtc",nQ="WEBGL_compressed_texture_atc",C4="EXT_texture_norm16",N4="EXT_render_snorm",rQ="EXT_color_buffer_float",q1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[N4],"norm16-renderable-webgl":[C4],"snorm16-renderable-webgl":[C4,N4],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Bl,Ll,Ha,Wa],"texture-compression-bc5-webgl":[Ha],"texture-compression-bc7-webgl":[Wa],"texture-compression-etc2":[QZ],"texture-compression-astc":[JZ],"texture-compression-etc1-webgl":[eQ],"texture-compression-pvrtc-webgl":[tQ],"texture-compression-atc-webgl":[nQ]};function iQ(t){return t in q1}function sQ(t,e,n){return(q1[e]||[]).every(i=>uo(t,i,n))}const $1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:rQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Bl},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Ll},"bc1-rgba-unorm":{gl:33777,x:Bl},"bc1-rgba-unorm-srgb":{gl:35916,x:Ll},"bc2-rgba-unorm":{gl:33778,x:Bl},"bc2-rgba-unorm-srgb":{gl:35918,x:Ll},"bc3-rgba-unorm":{gl:33779,x:Bl},"bc3-rgba-unorm-srgb":{gl:35919,x:Ll},"bc4-r-unorm":{gl:36283,x:Ha},"bc4-r-snorm":{gl:36284,x:Ha},"bc5-rg-unorm":{gl:36285,x:Ha},"bc5-rg-snorm":{gl:36286,x:Ha},"bc6h-rgb-ufloat":{gl:36495,x:Wa},"bc6h-rgb-float":{gl:36494,x:Wa},"bc7-rgba-unorm":{gl:36492,x:Wa},"bc7-rgba-unorm-srgb":{gl:36493,x:Wa},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function aQ(t,e,n){let r=e.create;const i=$1[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!uo(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function vD(t){var i;const e=$1[t],n=cQ(t),r=A1(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||lQ(r.channels,r.integer,r.normalized,n),type:r.dataType?_D(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function oQ(t){switch(A1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function lQ(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cQ(t){const e=$1[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const k4={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class uQ extends rW{constructor(n,r,i){super([],i);D(this,"gl");D(this,"extensions");D(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,uo(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),iQ(n)&&sQ(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(k4),...Object.keys(q1)]}getWebGLFeature(n){const r=k4[n];return typeof r=="string"?!!uo(this.gl,r,this.extensions):!!r}}class fQ extends nW{constructor(n){super();D(this,"gl");D(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class $l extends Uf{constructor(n,r){super(n,r);D(this,"device");D(this,"gl");D(this,"handle");D(this,"colorAttachments",[]);D(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=oQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${hQ(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,l);break;case 34067:const u=dQ(l);i.framebufferTexture2D(36160,n,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function dQ(t){return t<34069?t+34069:t}function hQ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class pQ extends Z0{constructor(n,r){super(r);D(this,"device");D(this,"format","rgba8unorm");D(this,"depthStencilFormat","depth24plus");D(this,"presentationSize");D(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new $l(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function yD(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const gQ=1;let dt=null,M4=!1;const H1={debugSpectorJS:be.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function mQ(t){if(!globalThis.SPECTOR)try{await yD(t.debugSpectorJSUrl||H1.debugSpectorJSUrl)}catch(e){be.warn(String(e))}}function _Q(t){var e;if(t={...H1,...t},!t.debugSpectorJS)return null;if(!dt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){be.probe(gQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;dt=new n,globalThis.luma&&(globalThis.luma.spector=dt)}if(!dt)return null;if(M4||(M4=!0,dt.spyCanvases(),dt==null||dt.onCaptureStarted.add(n=>be.info("Spector capture started:",n)()),dt==null||dt.onCapture.add(n=>{be.info("Spector capture complete:",n)(),dt==null||dt.getResultUI(),dt==null||dt.resultView.display(),dt==null||dt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;dt==null||dt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{be.info("Spector capture stopped after 2 seconds")(),dt==null||dt.stopCapture()})}return dt}const vQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function bD(t){return t.luma=t.luma||{},t.luma}async function yQ(){Hs()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await yD(vQ))}function bQ(t,e={}){return e.debugWebGL||e.traceWebGL?wQ(t,e):xQ(t)}function xQ(t){const e=bD(t);return e.realContext?e.realContext:t}function wQ(t,e){if(!globalThis.WebGLDebugUtils)return be.warn("webgl-debug not loaded")(),t;const n=bD(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...$a,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,TQ.bind(null,e),SQ.bind(null,e));for(const o in $a)!(o in r)&&typeof $a[o]=="number"&&(r[o]=$a[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function I4(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function TQ(t,e,n,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;be.error(o)();debugger}function SQ(t,e,n){let r="";be.level>=1&&(r=I4(e,n),t.traceWebGL&&be.log(1,r)());for(const i of n)if(i===void 0){r=r||I4(e,n);debugger}}const v0={};function EQ(t="id"){v0[t]=v0[t]||1;const e=v0[t]++;return`${t}-${e}`}class Hl extends wt{constructor(n,r={}){super(n,r);D(this,"device");D(this,"gl");D(this,"handle");D(this,"glTarget");D(this,"glUsage");D(this,"glIndexType",5123);D(this,"byteLength");D(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=AQ(this.props.usage),this.glUsage=RQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function AQ(t){return t&wt.INDEX?34963:t&wt.VERTEX?34962:t&wt.UNIFORM?35345:34962}function RQ(t){return t&wt.INDEX||t&wt.VERTEX?35044:t&wt.UNIFORM?35048:35044}function CQ(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,_]=i;n.push({message:_.trim(),type:O4(g),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let d=parseInt(l,10);isNaN(d)&&(d=0);let h=parseInt(o,10);isNaN(h)&&(h=0),n.push({message:u.join(":").trim(),type:O4(s),lineNum:d,linePos:h})}return n}function O4(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class NQ extends Bf{constructor(n,r){super(n,r);D(this,"device");D(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?CQ(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}be.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),be.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function kQ(t,e,n,r){if(PQ(e))return r(t);const i=t;i.pushState();try{return MQ(t,e),bo(i.gl,n),r(t)}finally{i.popState()}}function MQ(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Is("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Is("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Is("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(OQ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(wx("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&be.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=wx("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=y0("stencilPassOperation",e.stencilPassOperation),s=y0("stencilFailOperation",e.stencilFailOperation),o=y0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=P4("blendColorOperation",e.blendColorOperation||"add"),s=P4("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=tf("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=tf("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=tf("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=tf("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,d)}}function wx(t,e){return Is(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function y0(t,e){return Is(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function P4(t,e){return Is(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function tf(t,e){return Is(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function IQ(t,e){return`Illegal parameter ${e} for ${t}`}function Is(t,e,n){if(!(e in n))throw new Error(IQ(t,e));return n[e]}function OQ(t,e){return e}function PQ(t){let e=!0;for(const n in t){e=!1;break}return e}function xD(t){const e={};return t.addressModeU&&(e[10242]=b0(t.addressModeU)),t.addressModeV&&(e[10243]=b0(t.addressModeV)),t.addressModeW&&(e[32882]=b0(t.addressModeW)),t.magFilter&&(e[10240]=Tx(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=DQ(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=wx("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function b0(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Tx(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function DQ(t,e="none"){if(!e)return Tx(t);switch(e){case"none":return Tx(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Sx extends Lf{constructor(n,r){super(n,r);D(this,"device");D(this,"handle");D(this,"parameters");this.device=n,this.parameters=xD(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class Xa extends jf{constructor(n,r){super(n,{...kt.defaultProps,...r});D(this,"device");D(this,"gl");D(this,"handle");D(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const jQ="Failed to deduce GL constant from typed array";function BQ(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(jQ)}}function LQ(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function wD(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function UQ(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function ed(t,e,n){if(FQ(e))return n(t);const{nocatch:r=!0}=e,i=Ms.get(t);i.push(),bo(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function FQ(t){for(const e in t)return!1;return!0}function zQ(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:l}=n,u=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,l,i,s,o);break;default:t.texStorage2D(u,e,l,i,s)}}function D4(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:d=0,y:h=0,z:g=0}=r,{glFormat:_,glType:y}=r,T=TD(r.glTarget,o,l),w=r.flipY?{37440:!0}:{};ed(t,w,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(T,e),t.texSubImage3D(T,u,d,h,g,i,s,l,_,y,n),t.bindTexture(T,null);break;case"2d":case"cube":t.bindTexture(T,e),t.texSubImage2D(T,u,d,h,i,s,_,y,n),t.bindTexture(T,null);break;default:throw new Error(o)}})}function j4(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=n,{x:d=0,y:h=0,z:g=0}=n,{glFormat:_,glType:y,compressed:T}=n,w=TD(n.glTarget,r,o);switch(r){case"2d-array":case"3d":T?t.compressedTexSubImage3D(w,l,d,h,g,i,s,o,_,e,u):t.texSubImage3D(w,l,d,h,g,i,s,o,_,y,e,u);break;case"2d":case"cube":T?t.compressedTexSubImage2D(w,l,d,h,i,s,_,e,u):t.texSubImage2D(w,l,d,h,i,s,_,y,e,u);break;default:throw new Error(r)}}function VQ(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function TD(t,e,n){return e==="cube"?34069+n:t}function qQ(t,e){var S;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:d,sourceType:h}=e||{};const{framebuffer:g,deleteFramebuffer:_}=SD(t),{gl:y,handle:T}=g;o||(o=g.width),l||(l=g.height);const w=(S=g.colorAttachments[i])==null?void 0:S.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);u=(w==null?void 0:w.depth)||1,d||(d=(w==null?void 0:w.glFormat)||6408),h||(h=(w==null?void 0:w.glType)||5121),s=WQ(s,h,d,o,l),h=h||BQ(s);const x=y.bindFramebuffer(36160,T);return y.readBuffer(36064+i),y.readPixels(n,r,o,l,d,h,s),y.readBuffer(36064),y.bindFramebuffer(36160,x||null),_&&g.destroy(),s}function $Q(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:h,deleteFramebuffer:g}=SD(t);l=l||h.width,u=u||h.height;const _=h;d=d||5121;let y=n;if(!y){const w=wD(s),x=UQ(d),S=o+l*u*w*x;y=_.device.createBuffer({byteLength:S})}const T=t.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:t,width:l,height:u,origin:[r,i],destinationBuffer:y,byteOffset:o}),T.destroy(),g&&h.destroy(),y}function SD(t){return t instanceof Uf?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:HQ(t),deleteFramebuffer:!0}}function HQ(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function WQ(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=LQ(e,{clamped:!1}),l=wD(n);return new o(r*i*l)}class Wl extends kt{constructor(n,r){super(n,r);D(this,"device");D(this,"gl");D(this,"handle");D(this,"sampler");D(this,"view");D(this,"mipmaps");D(this,"compressed");D(this,"glTarget");D(this,"glFormat");D(this,"glType");D(this,"glInternalFormat");D(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=VQ(this.props.dimension);const s=vD(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=kt.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new Xa(this.device,{...this.props,texture:this}),this.bind(),zQ(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new Xa(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof Sx?(this.sampler=n,r=n.props):(this.sampler=new Sx(this.device,n),r=n);const i=xD(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(be.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){be.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=kt.getExternalImageSize(n.image),i={...kt.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:l,x:u,y:d,z:h,flipY:g}=i;let{width:_,height:y}=i;const{dimension:T,glTarget:w,glFormat:x,glInternalFormat:S,glType:R}=this;if(_=Math.min(_,this.width-u),y=Math.min(y,this.height-d),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return D4(this.device.gl,this.handle,s,{dimension:T,mipLevel:l,x:u,y:d,z:h,width:_,height:y,depth:o,glFormat:x,glType:R,glTarget:w,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=kt.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&be.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),j4(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of kt.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&be.warn(`${this.id} has mipmap and multiple LODs.`)();const s=kt.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:l,format:u=6408,type:d=5121}=n,{gl:h}=this,g=o||l;this.bind(),g instanceof Promise?g.then(_=>this.setImageDataForFace(Object.assign({},n,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,u,i,s,0,u,d,g):h.texImage2D(r,0,u,u,d,g)}_getImageDataMap(n){for(let r=0;r<kt.CubeFaces.length;++r){const i=kt.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){be.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(kt.isExternalImage(i)){D4(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(kt.isTextureLevelData(i)){j4(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const XQ=[1,2,4,8];class YQ extends Q0{constructor(n,r){var o;super(n,r);D(this,"device");D(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:l,height:u}=r.framebuffer;i=[0,0,l,u]}else{const[l,u]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,l,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=XQ.map(i=>!!(i&n.colorMask))),this.glParameters=r,bo(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&ed(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){ed(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function GQ(t){return KQ.includes(t)}const KQ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],ED={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function AD(t){const e=ED[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function ZQ(t){const e=ED[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function QQ(t,e){const n={attributes:[],bindings:[]};n.attributes=JQ(t,e);const r=nJ(t,e);for(const l of r){const u=l.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));n.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=tJ(t,e);let s=0;for(const l of i)if(GQ(l.type)){const{viewDimension:u,sampleType:d}=iJ(l.type);n.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:d}),l.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=eJ(t,e);return o!=null&&o.length&&(n.varyings=o),n}function JQ(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=t.getAttribLocation(e,o);if(u>=0){const{attributeType:d}=ZQ(l),h=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:u,stepMode:h,type:d})}}return n.sort((i,s)=>i.location-s.location),n}function eJ(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:d,components:h}=AD(l),g={location:i,name:o,type:d,size:u*h};n.push(g)}return n.sort((i,s)=>i.location-s.location),n}function tJ(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:d,isArray:h}=sJ(o);let g=t.getUniformLocation(e,d);const _={location:g,name:d,size:l,type:u,isArray:h};if(n.push(_),_.size>1)for(let y=0;y<_.size;y++){const T=`${d}[${y}]`;g=t.getUniformLocation(e,T);const w={..._,name:T,location:g};n.push(w)}}return n}function nJ(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},l=n(s,35395)||[],u=t.getActiveUniforms(e,l,35383),d=t.getActiveUniforms(e,l,35384),h=t.getActiveUniforms(e,l,35387),g=t.getActiveUniforms(e,l,35388);for(let _=0;_<o.uniformCount;++_){const y=t.getActiveUniform(e,l[_]);if(!y)throw new Error("activeInfo");o.uniforms.push({name:y.name,format:AD(u[_]).format,type:u[_],arrayLength:d[_],byteOffset:h[_],byteStride:g[_]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const rJ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function iJ(t){const e=rJ[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function sJ(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function aJ(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function oJ(t){return rD(t)!==null||typeof t=="number"||typeof t=="boolean"}function lJ(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];oJ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function cJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function uJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const B4=4;class fJ extends no{constructor(n,r){super(n,r);D(this,"device");D(this,"handle");D(this,"vs");D(this,"fs");D(this,"introspectedLayout");D(this,"uniforms",{});D(this,"bindings",{});D(this,"varyings",null);D(this,"_uniformCount",0);D(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),be.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=QQ(this.device.gl,this.handle),be.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=dJ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||be.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||be.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Hl)&&!(s.buffer instanceof Hl))throw new Error("buffer value");break;case"texture":if(!(s instanceof Xa||s instanceof Wl||s instanceof $l))throw new Error("texture value");break;case"sampler":be.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var x;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:d=!1,firstVertex:h=0,transformFeedback:g}=n,_=cJ(s),y=!!o.indexBuffer,T=(x=o.indexBuffer)==null?void 0:x.glIndexType;if(this.linkStatus!=="success")return be.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return be.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return kQ(this.device,i,w.glParameters,()=>{y&&d?this.device.gl.drawElementsInstanced(_,l||0,T,h,u||0):y?this.device.gl.drawElements(_,l||0,T,h):d?this.device.gl.drawArraysInstanced(_,h,l||0,u||0):this.device.gl.drawArrays(_,h,l||0),g&&g.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=lJ(n);Object.keys(r).forEach(i=>{be.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),be.time(B4,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),be.timeEnd(B4,`linkProgram for ${this.id}`)(),be.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}be.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),be.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(be.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=n.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);n.uniformBlockBinding(this.handle,i,u),o instanceof Hl?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Xa||o instanceof Wl||o instanceof $l))throw new Error("texture");let d;if(o instanceof Xa)d=o.texture;else if(o instanceof Wl)d=o;else if(o instanceof $l&&o.colorAttachments[0]instanceof Xa)be.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,l=this.uniforms[r]??o;l!==void 0&&aJ(this.device.gl,i,s,l)}}}function dJ(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):be.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class hJ extends ex{constructor(n){super(n,{});D(this,"device");D(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":pJ(this.device,r.options);break;case"copy-buffer-to-texture":gJ(this.device,r.options);break;case"copy-texture-to-buffer":mJ(this.device,r.options);break;case"copy-texture-to-texture":_J(this.device,r.options);break;default:throw new Error(r.name)}}}function pJ(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function gJ(t,e){throw new Error("Not implemented")}function mJ(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:d,byteOffset:h=0,bytesPerRow:g,rowsPerImage:_}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||g||_)throw new Error("not implemented");const{framebuffer:y,destroyFramebuffer:T}=RD(n);let w;try{const x=d,S=s||y.width,R=o||y.height,E=vD(y.colorAttachments[0].texture.props.format),A=E.format,k=E.type;t.gl.bindBuffer(35051,x.handle),w=t.gl.bindFramebuffer(36160,y.handle),t.gl.readPixels(u[0],u[1],S,R,A,k,h)}finally{t.gl.bindBuffer(35051,null),w!==void 0&&t.gl.bindFramebuffer(36160,w),T&&y.destroy()}}function _J(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:h}=RD(n),[g,_]=i,[y,T,w]=s,x=t.gl.bindFramebuffer(36160,d.handle);let S=null,R;if(o instanceof Wl)S=o,l=Number.isFinite(l)?l:S.width,u=Number.isFinite(u)?u:S.height,S.bind(0),R=S.glTarget;else throw new Error("invalid destination");switch(R){case 3553:case 34067:t.gl.copyTexSubImage2D(R,r,y,T,g,_,l,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(R,r,y,T,w,g,_,l,u);break}S&&S.unbind(),t.gl.bindFramebuffer(36160,x),h&&d.destroy()}function RD(t){if(t instanceof kt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class vJ extends J0{constructor(n,r){super(n,r);D(this,"device");D(this,"commandBuffer");this.device=n,this.commandBuffer=new hJ(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function yJ(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=n[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return t.target}class W1 extends tx{constructor(n,r){super(n,r);D(this,"device");D(this,"handle");D(this,"buffer",null);D(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return WV()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:d,integer:h,divisor:g}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(n,s,o,l,u):this.device.gl.vertexAttribPointer(n,s,o,d,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,g||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=_D(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=W1.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=bJ(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!xJ(i,this.bufferValue),l){const u=IW(r.constructor,o);yJ({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function bJ(t){return Array.isArray(t)?new Float32Array(t):t}function xJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class wJ extends nx{constructor(n,r){super(n,r);D(this,"device");D(this,"gl");D(this,"handle");D(this,"layout");D(this,"buffers",{});D(this,"unusedBuffers",{});D(this,"bindOnUse",!0);D(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(uJ(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,be.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(n){if(L4(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Hl)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(L4(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function L4(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class TJ extends rx{constructor(n,r){super(n,r);D(this,"device");D(this,"handle");D(this,"target",null);D(this,"_queryPending",!1);D(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class Ya extends Qi{constructor(n){var g,_;super({...n,id:n.id||EQ("webgl-device")});D(this,"type","webgl");D(this,"handle");D(this,"features");D(this,"limits");D(this,"info");D(this,"canvasContext");D(this,"lost");D(this,"_resolveContextLost");D(this,"gl");D(this,"debug",!1);D(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});D(this,"_extensions",{});D(this,"_polyfilled",!1);D(this,"spectorJS");D(this,"renderPass",null);D(this,"_constants");const r=Qi._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(_=(g=r.canvas)==null?void 0:g.gl)==null?void 0:_.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new pQ(this,r),this.lost=new Promise(y=>{this._resolveContextLost=y});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const l=this.props._handle||YZ(this.canvasContext.canvas,{onContextLost:y=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:y=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(n._reuseDevices)return be.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=_Q({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=GZ(this.gl,this._extensions),this.limits=new fQ(this.gl),this.features=new uQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Ms(this.gl,{log:(...y)=>be.log(1,...y)()}).trackState(this.gl,{copyState:!1});const d=n.debugWebGL||n.debug,h=n.debugWebGL;d&&(this.gl=bQ(this.gl,{debugWebGL:d,traceWebGL:h}),be.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(be.level=Math.max(be.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new Hl(this,r)}createTexture(n){return new Wl(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Sx(this,n)}createShader(n){return new NQ(this,n)}createFramebuffer(n){return new $l(this,n)}createVertexArray(n){return new W1(this,n)}createTransformFeedback(n){return new wJ(this,n)}createQuerySet(n){return new TJ(this,n)}createRenderPipeline(n){return new fJ(this,n)}beginRenderPass(n){return new YQ(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new vJ(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return qQ(n,r)}readPixelsToBufferWebGL(n,r){return $Q(n,r)}setParametersWebGL(n){bo(this.gl,n)}getParametersWebGL(n){return gD(this.gl,n)}withParametersWebGL(n,r){return ed(this.gl,n,r)}resetWebGL(){be.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),qZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return aQ(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Ms.get(this.gl).push()}popState(){Ms.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&RJ(s,r)&&be.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:SJ(this,n,r);break;case Int32Array:EJ(this,n,r);break;case Uint32Array:AJ(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return uo(this.gl,n,this._extensions),this._extensions}}function SJ(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function EJ(t,e,n){t.gl.vertexAttribI4iv(e,n)}function AJ(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function RJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const CJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},NJ=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),kJ=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),MJ=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function IJ(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&OJ(i),i}return this.originalGetContext(n,r)}}function OJ(t){t.getExtension("EXT_color_buffer_float");const e={...CJ,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:NJ(t),OES_vertex_array_object:kJ(t),ANGLE_instanced_arrays:MJ(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const nf=1;class PJ extends lW{constructor(){super();D(this,"type","webgl");Qi.defaultProps={...Qi.defaultProps,...H1},Ya.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){IJ(n)}async attach(n){if(n instanceof Ya)return n;if((n==null?void 0:n.device)instanceof Qi)return n.device;if(!DJ(n))throw new Error("Invalid WebGL2RenderingContext");return new Ya({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){be.groupCollapsed(nf,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(yQ()),n.debugSpectorJS&&r.push(mQ(n));const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&be.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new Ya(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return be.probe(nf,o)(),be.table(nf,s.info)(),be.groupEnd(nf)(),s}}function DJ(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const U4=new PJ;function zi(){}const jJ=({isDragging:t})=>t?"grabbing":"grab",CD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:zi,onWebGLInitialized:zi,onResize:zi,onViewStateChange:zi,onInteractionStateChange:zi,onBeforeRender:zi,onAfterRender:zi,onLoad:zi,onError:t=>mt.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:jJ,getTooltip:null,debug:!1,drawPickingColors:!1};class X1{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=hx[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,d=u&&(u[i]||u.props[i]),h=this.props[i];let g=!1;d&&(g=d.call(u,l,r)),g||(h==null||h(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...CD,...e},e=this.props,e.viewState&&e.initialViewState&&mt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&mt.error("WebGL1 context not supported.")(),n=U4.attach(e.gl)),n||(n=K0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[U4],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&ac.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,l,u,d,h;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&mt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&mt.removed("onLayerClick","onClick")(),e.initialViewState&&!xr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return mn(this.viewManager),this.viewManager.views}getViewports(e){return mn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){mn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),mn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new zK({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new dD({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=l,d=!1;for(const h of o)u=h,d=((r=h.layer)==null?void 0:r.onHover(h,e.event))||d;d||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new nD;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new mG(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(s4).map(o=>{var y;const[l,u,d,h]=s4[o],g=(y=this.props.eventRecognizerOptions)==null?void 0:y[o],_={...u,...g,event:o};return{recognizer:new l(_),recognizeWith:d,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in hx)this.eventManager.on(o,this._onEvent);this.viewManager=new fZ({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new uZ(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new EZ({deck:this,device:this.device}),this.deckRenderer=new CZ(this.device),this.deckPicker=new PZ(this.device),this.widgetManager=new BZ({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new UZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),mt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=K0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}X1.defaultProps=CD;X1.VERSION=hH;function BJ(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return oP(t)}}const LJ=aP;function rf(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function Es(t){return t.stride||t.size*t.bytesPerElement}function UJ(t,e){return t.type===e.type&&t.size===e.size&&Es(t)===Es(e)&&(t.offset||0)===(e.offset||0)}function Ex(t,e){e.offset&&mt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Es(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function FJ(t,e){const n=Ex(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class zJ{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&n.isIndexed?l="uint32":l=i||"float32";let u=BJ(i||l);this.doublePrecision=s,s&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Es(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ac.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Ex(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:Es(r),attributes:i};if(this.doublePrecision){const o=FJ(r,n||{});i.push(rf(e,{...r,...o.high},this.device.type),rf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=Ex(r,n);i.push(rf(e,{...r,...o},this.device.type))}else i.push(rf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const h=n[u++];h<o[d]&&(o[d]=h),h>l[d]&&(l[d]=h)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof wt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=LJ(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=Es(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const l=Es(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=d0(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const d=s.byteLength+u+l*2;(!o||o.byteLength<d)&&(o=this._createBuffer(d)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?d0(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=ac.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),n&&i&&l.write(i instanceof Float64Array?d0(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&mt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?wt.INDEX:wt.VERTEX)|wt.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const F4=[],z4=[];function VJ(t,e=0,n=1/0){let r=F4;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(z4.length=t.length,r=z4):r=F4,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function ND(t){return t&&t[Symbol.asyncIterator]}function qJ(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,l=t.BYTES_PER_ELEMENT,u=r?r/l:n,d=i?i/l:0,h=Math.floor((t.length-d)/u);return(g,{index:_,target:y})=>{if(!s){const S=_*u+d;for(let R=0;R<n;R++)y[R]=t[S+R];return y}const T=s[_],w=s[_+1]||h;let x;if(o){x=new Array(w-T);for(let S=T;S<w;S++){const R=S*u+d;y=new Array(n);for(let E=0;E<n;E++)y[E]=t[R+E];x[S-T]=y}}else if(u===n)x=t.subarray(T*n+d,w*n+d);else{x=new t.constructor((w-T)*n);let S=0;for(let R=T;R<w;R++){const E=R*u+d;for(let A=0;A<n;A++)x[S++]=t[E+A]}}return x}}const $J=[],yf=[[0,1/0]];function HJ(t,e){if(t===yf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const WJ={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function kD(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...WJ[n],...e,...t,type:n}}class MD extends zJ{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:yf}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!UJ(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return kD(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=HJ(this.state.updateRanges,[r,i])}else this.state.updateRanges=yf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=$J}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==yf),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[d,h]of s)o.call(i,this,{data:n,startRow:d,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,h]of s){const g=Number.isFinite(d)?this.getVertexOffset(d):0,_=Number.isFinite(h)?this.getVertexOffset(h):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;mn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=qJ(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:d,size:h,startIndices:g}=e,{accessor:_,transform:y}=l;let T=u.binaryAccessor||(typeof _=="function"?_:s[_]);typeof T!="function"&&(T=()=>T),mn(typeof T=="function",`accessor "${_}" is not a function`);let w=e.getVertexOffset(r);const{iterable:x,objectInfo:S}=VJ(n,r,i);for(const R of x){S.index++;let E=T(R,S);if(y&&(E=y.call(this,E)),g){const A=(S.index<g.length-1?g[S.index+1]:o)-g[S.index];if(E&&Array.isArray(E[0])){let k=w;for(const O of E)e._normalizeValue(O,d,k),k+=h}else E&&E.length>h?d.set(E,w):(e._normalizeValue(E,S.target,0),sZ({target:d,source:S.target,start:w,count:A}));w+=A*h}else e._normalizeValue(E,d,w),w+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function x0(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,l=e.length,u=o-r;if(l>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!s)return;let d=l;for(;d<u;){const h=s(d,e);for(let g=0;g<i;g++)n[r+d]=h[g]||0,d++}}function XJ({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return x0({source:t,target:e,size:n,getData:r}),e;let o=0,l=0;const u=r&&((h,g)=>r(h+l,g)),d=Math.min(i.length,s.length);for(let h=1;h<d;h++){const g=i[h]*n,_=s[h]*n;x0({source:t.subarray(o,g),target:e,start:l,end:_,size:n,getData:u}),o=g,l=_}return l<e.length&&x0({source:[],target:e,start:l,size:n,getData:u}),e}function YJ(t){const{device:e,settings:n,value:r}=t,i=new MD(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function ID(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function OD(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function PD(t){t.push(t.shift())}function GJ(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=t.settings;if(u)for(const d of Object.values(u))l=Math.max(l,d.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function DD({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function jD({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*l,d=n.byteOffset,h=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,g=n.startIndices,_=s&&g,y=n.isConstant;if(!_&&e&&r>=i)return e;const T=n.value instanceof Float64Array?Float32Array:n.value.constructor,w=y?n.value:new T(n.getBuffer().readSyncWebGL(d,i*T.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!y){const E=o;o=(A,k)=>n.normalizeConstant(E(A,k))}const x=y?(E,A)=>o(w,A):(E,A)=>o(w.subarray(E+d,E+d+u),A),S=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),R=new Float32Array(i);return XJ({source:S,target:R,sourceStartIndices:s,targetStartIndices:g,size:u,getData:x}),(!e||e.byteLength<R.byteLength+h)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:R.byteLength+h,usage:35050})),e.write(R,h),e}class BD{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Jd(r),this.attribute=n,this.attributeInTransition=YJ(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=GJ(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class KJ extends BD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=eee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;PD(s),s[0]=jD({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=DD({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let d=Math.floor(this.currentLength/o.size);LD(o)&&(d/=2),u.setVertexCount(d),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ZJ=`uniform interpolationUniforms {
  float time;
} interpolation;
`,V4={name:"interpolation",vs:ZJ,uniformTypes:{time:"f32"}},QJ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,JJ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function LD(t){return t.doublePrecision&&t.value instanceof Float64Array}function eee(t,e){const n=e.size,r=ID(n),i=OD(n),s=e.getBufferLayout();return LD(e)?new oc(t,{vs:JJ,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[pY,V4],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new oc(t,{vs:QJ,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[V4],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class tee extends BD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=oee(e),this.framebuffer=lee(e,this.texture),this.transform=aee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=jD({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=DD({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),PD(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const nee=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,ree={name:"spring",vs:nee,uniformTypes:{damping:"f32",stiffness:"f32"}},iee=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,see=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function aee(t,e){const n=ID(e.size),r=OD(e.size);return new oc(t,{vs:iee,fs:see,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[ree],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function oee(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function lee(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const cee={interpolation:KJ,spring:tee};class uee{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=cee[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(mt.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const q4="attributeManager.invalidate",fee="attributeManager.updateStart",dee="attributeManager.updateEnd",hee="attribute.updateStart",pee="attribute.allocate",gee="attribute.updateEnd";class mee{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Sc(CK),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new uee(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);xn(q4,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);xn(q4,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;xn(fee,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const h=this.attributes[d],g=h.settings.accessor;h.startIndices=r,h.numInstances=n,s[d]&&mt.removed(`props.${d}`,`data.attributes.${d}`)(),h.setExternalBuffer(o[d])||h.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&h.setConstantValue(s[g])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:n,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&xn(dee,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new MD(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(xn(hee,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&xn(pee,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,xn(gee,n,r))}}class _ee extends Jd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Xf(n,r,o)}}const $4=1e-5;function H4(t,e,n,r,i){const s=e-t,l=(n-e)*i,u=-s*r;return l+u+s+e}function vee(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=H4(t[o],e[o],n[o],r,i);return s}return H4(t,e,n,r,i)}function W4(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class yee extends Jd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=vee(s,o,n,r,i);const u=W4(l,n),d=W4(l,o);u<$4&&d<$4&&(l=n,this.end()),this._prevValue=o,this._currValue=l}}const bee={interpolation:_ee,spring:yee};class xee{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;n=d,this.remove(e)}if(i=kD(i),!i)return;const o=bee[i.type];if(!o){mt.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:n,toValue:r}),s.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function wee(t){const e=t[ks];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function Tee(t,e){const n=UD({newProps:t,oldProps:e,propTypes:t[ks],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Eee(t,e);let i=!1;return r||(i=Aee(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:Ree(t,e),transitionsChanged:See(t,e)}}function See(t,e){if(!t.transitions)return!1;const n={},r=t[ks];let i=!1;for(const s in t.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&Ax(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function UD({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Ax(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Ax(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Ax(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function Eee(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function Aee(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&X4(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&X4(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function Ree(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function X4(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},UD({oldProps:i,newProps:r,triggerName:n})}const Cee="count(): argument not an object",Nee="count(): argument not a container";function kee(t){if(!Iee(t))throw new Error(Cee);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Mee(t))return Object.keys(t).length;throw new Error(Nee)}function Mee(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Iee(t){return t!==null&&typeof t=="object"}function Y4(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const Oee={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Rx={};function Pee(t,e,n,r){if(n instanceof kt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...Oee,...i,...r},mipmaps:!0});return Rx[s.id]=t,s}function Dee(t,e){!e||!(e instanceof kt)||Rx[e.id]===t&&(e.delete(),delete Rx[e.id])}const jee={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Cx(t)&&(t.length===3||t.length===4)},equal(t,e,n){return xr(t,e,1)}},accessor:{validate(t,e){const n=td(t);return n==="function"||n===td(e.value)},equal(t,e,n){return typeof e=="function"?!0:xr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Cx(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?xr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?xr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:Pee(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{Dee(n.id,t)}}};function Bee(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=Lee(i,s);e[i]=l,n[i]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function Lee(t,e){switch(td(e)){case"object":return Al(t,e);case"array":return Al(t,{type:"array",value:e,compare:!1});case"boolean":return Al(t,{type:"boolean",value:e});case"number":return Al(t,{type:"number",value:e});case"function":return Al(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Al(t,e){return"type"in e?{name:t,...jee[e.type],...e}:"value"in e?{name:t,type:td(e.value),...e}:{name:t,type:"object",value:e}}function Cx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function td(t){return Cx(t)?"array":t===null?"null":typeof t}function Uee(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=Nx(t.constructor,n),i=Object.create(r);i[Jf]=t,i[Bs]={},i[Zi]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const Fee="_mergedDefaultProps";function Nx(t,e){if(!(t instanceof eh.constructor))return{};let n=Fee;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=FD(t,n);return r||(t[n]=zee(t,e||[]))}function zee(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=Nx(r),s=FD(t,"defaultProps")||{},o=Bee(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[ks],o.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[m0],o.deprecatedProps);for(const h of e){const g=Nx(h.constructor);g&&(Object.assign(l,g),Object.assign(u,g[ks]),Object.assign(d,g[m0]))}return Vee(l,t),$ee(l,u),qee(l,d),l[ks]=u,l[m0]=d,e.length===0&&!Y1(t,"_propTypes")&&(t._propTypes=u),l}function Vee(t,e){const n=Wee(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function qee(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Y1(this,s)||(this[s]=r);mt.deprecated(i,e[n].join("/"))()}})}function $ee(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(n[o]=l,r[o]=Hee(o))}t[Qa]=n,t[Bs]={},Object.defineProperties(t,r)}function Hee(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||ND(e)?this[Bs][t]=e:this[Zi][t]=e},get(){if(this[Zi]){if(t in this[Zi])return this[Zi][t]||this[Qa][t];if(t in this[Bs]){const e=this[Jf]&&this[Jf].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Qa][t]}}return this[Qa][t]}}}function Y1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function FD(t,e){return Y1(t,e)&&t[e]}function Wee(t){const e=t.componentName;return e||mt.warn(`${t.name}.componentName not specified`)(),e||t.name}let Xee=0;class eh{constructor(...e){this.props=Uee(this,e),this.id=this.props.id,this.count=Xee++}clone(e){const{props:n}=this,r={};for(const i in n[Qa])i in n[Zi]?r[i]=n[Zi][i]:i in n[Bs]&&(r[i]=n[Bs][i]);return new this.constructor({...n,...r,...e})}}eh.componentName="Component";eh.defaultProps={};const Yee=Object.freeze({});class Gee{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Yee}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Jf]||this.component;const n=e[Zi]||{},r=e[Bs]||e,i=e[Qa]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(ND(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[ks];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class Kee extends Gee{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const Zee="layer.changeFlag",Qee="layer.initialize",Jee="layer.update",ete="layer.finalize",tte="layer.matched",G4=2**24-1,nte=Object.freeze([]),rte=Sc(({oldViewport:t,viewport:e})=>t.equals(e));let mr=new Uint8ClampedArray(0);const ite={data:{type:"data",value:nte,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:q0(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:u=>{var d;return(d=n.internalState)==null?void 0:d.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):q0(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:et.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ec extends eh{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Va.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){mn(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=tD(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=KP(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return mn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){mn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return PK(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===et.DEFAULT||e===et.LNGLAT||e===et.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){mn(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:kee(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Y4(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=Y4(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=n.attributes,d=l||u;d&&(o&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!o&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!rte({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(mr.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>G4&&mt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),mr=ac.allocate(mr,n,{size:4,copy:!0,maxCount:Math.max(n,G4)});const i=Math.floor(mr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),mr[o*4+0]=s[0],mr[o*4+1]=s[1],mr[o*4+2]=s[2],mr[o*4+3]=0}e.value=mr.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var l;if(!Object.keys(n).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),n=u.getAttributes()}const i=((l=e.userData)==null?void 0:l.excludeAttributes)||{},s={},o={};for(const u in n){if(i[u])continue;const d=n[u].getValue();for(const h in d){const g=d[h];g instanceof wt?n[u].settings.isIndexed?e.setIndexBuffer(g):s[h]=g:g&&(o[h]=g)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const h=s.getVertexOffset(d);l[h]===u[0]&&l[h+1]===u[1]&&l[h+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==mr.buffer&&(r.value=mr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){mn(!this.internalState),mn(Number.isFinite(this.props.coordinateSystem)),xn(Qee,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Kee({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(mt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new xee(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){xn(tte,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(xn(Jee,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const h of this.props.extensions)h.updateState.call(this,l,h);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(l,d)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){xn(ete,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof Ya&&o.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(o.device instanceof Ya)o.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=n[i];o&&Array.isArray(l)&&(n.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&xn(Zee,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=Tee(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){wee(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new mee(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(n||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ec.defaultProps=ite;Ec.layerName="Layer";const w0=Math.PI/180;function ste({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],l=n==="Z"?[0,-e,0]:[0,0,e],u=new Tr().lookAt({eye:l,up:o});u.rotateX(r*w0),n==="Z"?u.rotateZ(i*w0):u.rotateY(i*w0);const d=Math.pow(2,s)/t;return u.scale(d),u}class ate extends yo{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:l=0,rotationOrbit:u=0,zoom:d=0}=e,h=r?r[5]/2:U1(i);super({...e,longitude:void 0,viewMatrix:ste({height:n||1,focalDistance:h,orbitAxis:s,rotationX:l,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:h,position:o,zoom:d}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[l,u,d]=Zd([r,o,s],this.pixelUnprojectionMatrix);return[l,u,d]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class ote extends fD{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:l=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:h=-1/0,maxZoom:g=1/0,startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:l,minRotationX:u,maxRotationX:d,minZoom:h,maxZoom:g},{startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:l,height:u}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let d;if(e){let h=(e[0]-i[0])/l;const g=(e[1]-i[1])/u;(s<-90||s>90)&&(h*=-1),d={rotationX:s+g*180,rotationOrbit:o+h*180}}else d={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return Wn(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:l}=e;return e.zoom=Array.isArray(i)?[Wn(i[0],r,n),Wn(i[1],r,n)]:Wn(i,r,n),e.rotationX=Wn(e.rotationX,o,s),(l<-180||l>180)&&(e.rotationOrbit=SK(l+180,360)-180),e}}class lte extends uD{constructor(){super(...arguments),this.ControllerState=ote,this.transition={transitionDuration:300,transitionInterpolator:new z1({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class zD extends Ls{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return ate}get ControllerType(){return lte}}zD.displayName="OrbitView";const cte=typeof window<"u"?F.useLayoutEffect:F.useEffect;function nd(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const ute={position:"absolute",zIndex:-1};function VD(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>VD(n,e));if(th(t)){if(fte(t))return e.style=ute,F.cloneElement(t,e);if(dte(t))return F.cloneElement(t,e)}return t}function th(t){return t&&typeof t=="object"&&"type"in t||!1}function fte(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function dte(t){const e=t.type;return e&&e.deckGLViewProps}function kx(t){if(typeof t=="function")return F.createElement(Ls,{},t);if(Array.isArray(t))return t.map(kx);if(th(t)){if(t.type===F.Fragment)return kx(t.props.children);if(nd(t.type,Ls))return t}return t}function hte({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return F.Children.forEach(kx(t),o=>{if(th(o)){const l=o.type;if(nd(l,Ec)){const u=pte(l,o.props);i.push(u)}else r.push(o);if(nd(l,Ls)&&l!==Ls&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function pte(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const gte=F.createContext();function mte({children:t,deck:e,ContextProvider:n=gte.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let l=s,u=o;th(o)&&nd(o.type,Ls)&&(l=o.props.id||s,u=o.props.children);const d=r.getViewport(l),h=r.getViewState(l);if(d){h.padding=d.padding;const{x:g,y:_,width:y,height:T}=d;u=VD(u,{x:g,y:_,width:y,height:T,viewport:d,viewState:h}),i[l]||(i[l]={viewport:d,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:d,y:h,width:g,height:_}=l,y={position:"absolute",left:d,top:h,width:g,height:_},T=`view-${o}`,w=F.createElement("div",{key:T,id:T,style:y},...u),x={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:R=>{R.viewId=o,e._onViewStateChange(R)},widgets:[]},S=`view-${o}-context`;return F.createElement(n,{key:S,value:x},w)})}const _te={mixBlendMode:null};function vte({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in _te?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function yte(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function qD(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function bte(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:l=>{t.redrawReason=l;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():qD(t)}});return r}function xte(t,e){const[n,r]=F.useState(0),s=F.useRef({control:null,version:n,forceUpdate:()=>r(k=>k+1)}).current,o=F.useRef(null),l=F.useRef(null),u=F.useMemo(()=>hte(t),[t.layers,t.views,t.children]);let d=!0;const h=k=>{var O;return d&&t.viewState?(s.viewStateUpdateRequested=k,null):(s.viewStateUpdateRequested=null,(O=t.onViewStateChange)==null?void 0:O.call(t,k))},g=k=>{var O;d?s.interactionStateUpdateRequested=k:(s.interactionStateUpdateRequested=null,(O=t.onInteractionStateChange)==null||O.call(t,k))},_=F.useMemo(()=>{const k={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:g};return delete k._customRender,s.deck&&s.deck.setProps(k),k},[t]);F.useEffect(()=>{const k=t.Deck||X1;return s.deck=bte(s,k,{..._,parent:o.current,canvas:l.current}),()=>{var O;return(O=s.deck)==null?void 0:O.finalize()}},[]),cte(()=>{qD(s);const{viewStateUpdateRequested:k,interactionStateUpdateRequested:O}=s;k&&h(k),O&&g(O)}),F.useImperativeHandle(e,()=>yte(s),[]);const y=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:w="100%",height:x="100%",id:S,style:R}=t,{containerStyle:E,canvasStyle:A}=F.useMemo(()=>vte({width:w,height:x,style:R}),[w,x,R]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===y||s.version!==n){s.lastRenderedViewports=y,s.version=n;const k=mte({children:u.children,deck:s.deck,ContextProvider:T}),O=F.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:l,style:A});s.control=F.createElement("div",{id:`${S||"deckgl"}-wrapper`,ref:o,style:E},[O,k])}return d=!1,s.control}const wte=F.forwardRef(xte),Tte=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,K4=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Ste={name:"line",source:Tte,vs:K4,fs:K4,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Ete=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Ate=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Rte=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cte=[0,0,0,255],Nte={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Cte},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Xl extends Ec{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Ate,fs:Rte,source:Ete,modules:[XP,QP,Ste]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,u={widthUnits:js[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:u}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...u,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new aD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Xl.layerName="LineLayer";Xl.defaultProps=Nte;const Z4=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,kte={name:"scatterplot",vs:Z4,fs:Z4,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Mte=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Ite=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Ote=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Q4=[0,0,0,255],Pte={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Q4},getLineColor:{type:"accessor",value:Q4},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class G1 extends Ec{getShaders(){return super.getShaders({vs:Mte,fs:Ite,source:Ote,modules:[XP,QP,kte]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:d,lineWidthUnits:h,lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y}=this.props,T={stroked:o,filled:l,billboard:u,antialiasing:d,radiusUnits:js[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:js[h],lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y},w=this.state.model;w.shaderInputs.setProps({scatterplot:T}),w.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new aD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}G1.defaultProps=Pte;G1.layerName="ScatterplotLayer";function K1(t,e,n=160,r=[100,100,100,255],i=2){const s=[];if(!t||!t.coordinates)return s;const o=t.bounds||$D(t),[l,u,d,h]=o,g=(l+d)/2,_=(u+h)/2,y=Math.max(d-l,h-u)||1,T=(x,S)=>{const R=(x-g)/y*n,E=(S-_)/y*n;return[R,E]},w=x=>{for(let S=0;S<x.length-1;S++){const[R,E]=T(x[S][0],x[S][1]),[A,k]=T(x[S+1][0],x[S+1][1]);s.push({source:[R,E,e],target:[A,k,e],color:r,width:i})}};switch(t.type){case"Polygon":const x=t.coordinates;if(x.length>0){w(x[0]);for(let E=1;E<x.length;E++)w(x[E])}break;case"MultiPolygon":const S=t.coordinates;for(const E of S)if(E.length>0){w(E[0]);for(let A=1;A<E.length;A++)w(E[A])}break;case"LineString":Array.isArray(t.coordinates)&&t.coordinates.length>0&&Array.isArray(t.coordinates[0])&&typeof t.coordinates[0][0]=="number"&&w(t.coordinates);break;case"MultiLineString":const R=t.coordinates;for(const E of R)w(E);break;case"GeometryCollection":if("geometries"in t){const E=t.geometries;for(const A of E)A.type==="LineString"&&A.coordinates&&w(A.coordinates)}break;default:console.warn(`Unsupported geometry type: ${t.type}`)}return s}function $D(t){let e=1/0,n=1/0,r=-1/0,i=-1/0;const s=o=>{if(typeof o[0]=="number"){const[l,u]=o;e=Math.min(e,l),n=Math.min(n,u),r=Math.max(r,l),i=Math.max(i,u)}else for(const l of o)s(l)};if(t.coordinates&&s(t.coordinates),"geometries"in t){const o=t.geometries;for(const l of o)l.coordinates&&s(l.coordinates)}return[e,n,r,i]}function HD(t,e,n=12,r=160,i=[100,100,100],s){const o=[];if(!s||!t)return o;const l=(s[0]+s[1])/2,u=Array.from(new Set(e)).sort((T,w)=>T-w);new Map(u.map((T,w)=>[T,w]));let d=0;if(u.length>1){const T=u[0],w=u[u.length-1],x=Math.max(T,Math.min(w,l));let S=0,R=u.length-1;for(let E=0;E<u.length-1;E++)if(u[E]<=x&&u[E+1]>=x){S=E,R=E+1;break}if(S===R)d=S*n+.1;else{const E=u[S],A=u[R],k=(x-E)/(A-E);d=(S+k)*n+.1}}else u.length===1&&(d=.1);const h=120,g=2,_=[i[0],i[1],i[2],h],y=K1(t,d,r,_,g);return o.push(...y),o}function Mx(t=10,e=160){const n=[];for(let r=0;r<=t;r++){const i=r/t;n.push({type:"LineString",coordinates:[[i,0],[i,1]]})}for(let r=0;r<=t;r++){const i=r/t;n.push({type:"LineString",coordinates:[[0,i],[1,i]]})}return{type:"GeometryCollection",coordinates:[],crs:"unit_grid",name:`${t}x${t} Unit Grid`,bounds:[0,0,1,1],geometries:n}}const J4=Object.freeze(Object.defineProperty({__proto__:null,calculateShapeBounds:$D,convertShapeToLines3D:K1,createGeographicTemporalPlanes:HD,createUnitGridShape:Mx},Symbol.toStringTag,{value:"Module"}));function Dte(t,e,n){if(!t.location||!e.location||t.location.x!==e.location.x||t.location.y!==e.location.y)return!1;const r=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===t.id||d===t.id}),i=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===e.id||d===e.id});if(r.length!==i.length)return!1;const s=new Set,o=new Set;if(r.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==t.id&&s.add(u),d!==t.id&&s.add(d)}),i.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==e.id&&o.add(u),d!==e.id&&o.add(d)}),s.size!==o.size)return!1;for(const l of s)if(!o.has(l))return!1;return!0}function WD(t,e){const n=new Set,r=[],i=[],s=new Map;for(let l=0;l<t.length;l++){if(n.has(t[l].id))continue;const u=t[l],d=[u];if(u.is_sample){r.push(u),s.set(u.id,u.id),n.add(u.id);continue}for(let h=l+1;h<t.length;h++){const g=t[h];n.has(g.id)||g.is_sample||u.time===g.time&&u.is_sample===g.is_sample&&Dte(u,g,e)&&(d.push(g),n.add(g.id))}if(d.length>1){const h={...u,id:u.id,is_combined:!0,combined_nodes:d.map(g=>g.id)};r.push(h),d.forEach(g=>s.set(g.id,h.id))}else r.push(u),s.set(u.id,u.id);n.add(u.id)}const o=new Set;return e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id,h=s.get(u),g=s.get(d);if(h!==void 0&&g!==void 0&&h!==g){const _=`${Math.min(h,g)}-${Math.max(h,g)}`;o.has(_)||(o.add(_),i.push({...l,source:h,target:g}))}}),{nodes:r,edges:i}}const Ac=(t,e,n)=>{const r=n.some(s=>(typeof s.target=="number"?s.target:s.target.id)===t.id),i=n.some(s=>(typeof s.source=="number"?s.source:s.source.id)===t.id);return!r&&i},jte=(t,e,n)=>n?`Lat: ${e.toFixed(3)}, Lon: ${t.toFixed(3)}`:`(${t.toFixed(2)}, ${e.toFixed(2)})`,pt={AUTO_FIT_ZOOM:1.8,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,BASE_ELEVATION:.1,SELECTED_NODE_SCALE:1.5,TEMPORAL_FADE_OPACITY:.5,EDGE_FADE_OPACITY:.2,EDGE_PARTIAL_FADE_OPACITY:.5,REDUCED_OPACITY_MULTIPLIER:.3,GEOGRAPHIC_OPACITY_SCALE:2.5,GEOGRAPHIC_REDUCED_OPACITY:.3,TEMPORAL_OPACITY_SCALE:.3,GRID_EXTENSION:2,UNIT_GRID_SIZE:10},Ul={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},Wi={GEOGRAPHIC_ACTIVE:.5,GEOGRAPHIC_NORMAL:3,TIME_SLICE_ACTIVE:.5,TIME_SLICE_NORMAL:1.5,NODE_OUTLINE_SELECTED:2,NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4},Bte=t=>t*pt.JITTER_SCALE%pt.JITTER_RANGE-pt.JITTER_OFFSET,Lte=(t,e,n)=>t.is_sample?Ul.SAMPLE:t.is_combined?Ul.COMBINED:Ac(t,e,n)?Ul.ROOT:Ul.DEFAULT,Ute=(t,e,n,r)=>{if(n!=="planes"||!e)return r;const[i,s]=e;return t>=i&&t<=s?r:r*pt.TEMPORAL_FADE_OPACITY},Fte=(t,e,n,r,i)=>{if(r!=="planes"||!n)return i;const[s,o]=n,l=t.time>=s&&t.time<=o,u=e.time>=s&&e.time<=o;return!l&&!u?i*pt.EDGE_FADE_OPACITY:!l||!u?i*pt.EDGE_PARTIAL_FADE_OPACITY:i},eM=(t,e,n)=>t||(e==="unit_grid"?Mx(pt.UNIT_GRID_SIZE,n):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):Mx(pt.UNIT_GRID_SIZE,n)),zte=(t,e,n)=>{const{nodes:r}=WD(t,[]),i=r.filter(w=>{var x,S;return((x=w.location)==null?void 0:x.x)!==void 0&&((S=w.location)==null?void 0:S.y)!==void 0});if(i.length===0)return null;const s=i.map(w=>w.location.x),o=i.map(w=>w.location.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let g,_,y;if((e==="eastern_hemisphere"||e==="custom")&&(n==null?void 0:n.bounds)){const w=n.bounds,[x,S,R,E]=w;g=(x+R)/2,_=(S+E)/2,y=Math.max(R-x,E-S)||1}else g=(l+u)/2,_=(d+h)/2,y=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:g,centerY:_,maxScale:y,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}},Vte=t=>{const e=Array.from(new Set(t.map(n=>n.time))).sort((n,r)=>n-r);return new Map(e.map((n,r)=>[n,r]))},qte=(t,e,n,r,i,s,o)=>{const{centerX:l,centerY:u,maxScale:d}=e,h=Vte(t);return t.map(g=>{const _=(g.location.x-l)/d*r,y=(g.location.y-u)/d*r,T=h.get(g.time)||0,w=Bte(g.id),x=T*n+pt.BASE_ELEVATION+w,S=Lte(g,s,o);let R;return g.is_sample?R=i.nodeSample:g.is_combined?R=i.nodeCombined:Ac(g,s,o)?R=i.nodeRoot:R=i.nodeDefault,{...g,position:[_,y,x],color:R,size:S}})},$te=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=Fte(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),Hte=(t,e,n,r,i)=>{if(e&&t.id===e.id)return i.nodeSelected;const o=Ute(t.time,n,r,t.color[3]);return[t.color[0],t.color[1],t.color[2],o]},Wte=(t,e,n,r,i,s)=>{const o=e&&t.id===e.id,l=Ac(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]);let u=1;if(i==="planes"&&r){const[d,h]=r;t.time>=d&&t.time<=h||(u=pt.REDUCED_OPACITY_MULTIPLIER)}if(o)return s.nodeSelected;if(l)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*u];if(t.is_sample){const d=s.background==="#ffffff"?0:255;return[d,d,d,255*u]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},Xte=(t,e,n)=>{const r=e&&t.id===e.id,i=Ac(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]),o=(r?t.size*pt.SELECTED_NODE_SCALE:t.size)/Ul.DEFAULT;return r?Math.max(1,Wi.NODE_OUTLINE_SELECTED*o):i?Math.max(.8,Wi.NODE_OUTLINE_ROOT*o):t.is_sample?Math.max(.5,Wi.NODE_OUTLINE_SAMPLE*o):0},Yte=(t,e,n,r)=>{var s;let i="";return t.is_sample?i="Sample Node":t.is_combined?i=`Combined Node (contains: ${(s=t.combined_nodes)==null?void 0:s.join(", ")})`:Ac(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?i="Root Node":i="Internal Node",{html:`
      <div style="background: ${r.tooltipBackground}; color: ${r.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${i}<br/>
        ${t.location?`Location: ${jte(t.location.x,t.location.y,n==="eastern_hemisphere")}`:""}
      </div>
    `,style:{backgroundColor:"transparent",color:r.tooltipText}}},XD=Kl.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,selectedNode:s,temporalRange:o,showTemporalPlanes:l=!1,temporalFilterMode:u=null,temporalSpacing:d=12,spatialSpacing:h=160,geographicShape:g=null,geographicMode:_="unit_grid",temporalGridOpacity:y=30,geographicShapeOpacity:T=70,maxNodeRadius:w=25,onViewStateChange:x,externalViewState:S},R)=>{const E=F.useRef(null),{colors:A}=Vt(),[k,O]=F.useState({target:[0,0,0],zoom:pt.AUTO_FIT_ZOOM,minZoom:pt.MIN_ZOOM,maxZoom:pt.MAX_ZOOM,rotationX:30,rotationOrbit:0,orbitAxis:"Y"});Kl.useEffect(()=>{S&&O(L=>({...L,...S}))},[S]);const j=F.useMemo(()=>!t||!t.nodes.length?null:zte(t.nodes,_,g),[t,_,g==null?void 0:g.bounds]),{nodes3D:N,edges3D:I,bounds:M}=F.useMemo(()=>{if(!j)return{nodes3D:[],edges3D:[],bounds:null};const{nodes:L,edges:J}=WD(t.nodes,t.edges),V=qte(j.spatialNodes,j,d,h,A,L,J),$=new Map;V.forEach(P=>$.set(P.id,P));const Y=$te(J,$,o||null,u||null,A),ue={minX:Math.min(...V.map(P=>P.position[0])),maxX:Math.max(...V.map(P=>P.position[0])),minY:Math.min(...V.map(P=>P.position[1])),maxY:Math.max(...V.map(P=>P.position[1])),minZ:Math.min(...V.map(P=>P.position[2])),maxZ:Math.max(...V.map(P=>P.position[2]))};return{nodes3D:V,edges3D:Y,bounds:ue}},[j,d,h,u,o,A]),q=F.useMemo(()=>{if(!l||!o||!M)return[];const L=eM(g,_,h);if(!L)return[];const J=Array.from(new Set(N.map($=>$.time))),V=[A.temporalGrid[0],A.temporalGrid[1],A.temporalGrid[2]];return HD(L,J,d,h,V,o)},[l,o,M,N,d,h,A.textSecondary,g,_]),X=F.useMemo(()=>{if(!M||!N.length)return[];const L=eM(g,_,h);if(!L)return[];const J=l&&u==="planes",V=T??70,$=V>0?J?Math.max(V*pt.GEOGRAPHIC_REDUCED_OPACITY,8):V*pt.GEOGRAPHIC_OPACITY_SCALE:0,Y=J?Wi.GEOGRAPHIC_ACTIVE:Wi.GEOGRAPHIC_NORMAL,ue=[A.geographicGrid[0],A.geographicGrid[1],A.geographicGrid[2],$],H=[...$>0?K1(L,0,h,ue,Y):[]],ie=Array.from(new Set(N.map(ye=>ye.time))).sort((ye,Ae)=>ye-Ae),re=new Map(ie.map((ye,Ae)=>[ye,Ae])),U=y??30,Z=J?Math.min(U*pt.TEMPORAL_OPACITY_SCALE,8):U,oe=J?Wi.TIME_SLICE_ACTIVE:Wi.TIME_SLICE_NORMAL,_e=[A.temporalGrid[0],A.temporalGrid[1],A.temporalGrid[2],Z];return Z>0&&ie.forEach(ye=>{const Me=(re.get(ye)||0)*d;Me!==0&&(H.push({source:[M.minX-pt.GRID_EXTENSION,0,Me],target:[M.maxX+pt.GRID_EXTENSION,0,Me],color:_e,width:oe}),H.push({source:[0,M.minY-pt.GRID_EXTENSION,Me],target:[0,M.maxY+pt.GRID_EXTENSION,Me],color:_e,width:oe}))}),H},[M,A.textSecondary,N,d,h,g,_,l,u,y,T]),G=[...X.length>0?[new Xl({id:"geographic-lines",data:X,pickable:!1,getSourcePosition:L=>L.source,getTargetPosition:L=>L.target,getColor:L=>L.color,getWidth:L=>L.width||.5})]:[],...l&&q.length>0?[new Xl({id:"temporal-plane-lines",data:q,pickable:!1,getSourcePosition:L=>L.source,getTargetPosition:L=>L.target,getColor:L=>L.color,getWidth:L=>L.width})]:[],new Xl({id:"edges",data:I,pickable:!1,getSourcePosition:L=>L.source,getTargetPosition:L=>L.target,getColor:L=>L.color,getWidth:pt.EDGE_WIDTH}),new G1({id:"nodes",data:N,pickable:!0,opacity:pt.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:pt.NODE_RADIUS_SCALE,radiusMinPixels:pt.MIN_NODE_RADIUS,radiusMaxPixels:w,lineWidthMinPixels:pt.MIN_NODE_RADIUS,lineWidthMaxPixels:Wi.MAX_NODE_OUTLINE,getPosition:L=>L.position,getRadius:L=>s&&L.id===s.id?L.size*pt.SELECTED_NODE_SCALE:L.size,getFillColor:L=>Hte(L,s||null,o||null,u||null,A),getLineColor:L=>Wte(L,s||null,t,o||null,u||null,A),getLineWidth:L=>Xte(L,s||null,t),onClick:(L,J)=>{J.srcEvent.preventDefault(),L.object&&r&&r(L.object)},onHover:L=>{L.rightButton&&L.object&&i&&i(L.object)}})];return!t||N.length===0?m.jsx("div",{className:"flex items-center justify-center border rounded bg-sp-very-dark-blue text-sp-white border-sp-dark-blue",style:{width:e,height:n},children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-lg mb-2",children:"No spatial data available"}),m.jsx("p",{className:"text-sm text-sp-white/75",children:"This ARG does not contain 2D spatial information required for 3D visualization."})]})}):m.jsx("div",{style:{width:e,height:n},className:"relative bg-sp-very-dark-blue","data-3d-visualization":"true",ref:L=>{L&&typeof R=="function"?R(L):L&&R&&"current"in R&&(R.current=L),L&&(L.getExportData=()=>({nodes:N,edges:I,bounds:M,currentViewState:k}),L.setViewState=J=>{O(V=>({...V,...J}))})},onContextMenu:L=>{L.preventDefault();const J=L.currentTarget.getBoundingClientRect(),V=L.clientX-J.left,$=L.clientY-J.top;if(E.current){const Y=E.current.pickObject({x:V,y:$,radius:10});Y!=null&&Y.object&&i&&i(Y.object)}},children:m.jsx(wte,{ref:E,width:e,height:n,views:new zD,viewState:k,onViewStateChange:({viewState:L})=>{O(L),x==null||x(L)},controller:{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0},layers:G,getCursor:()=>"crosshair",style:{backgroundColor:A.background},getTooltip:({object:L})=>L?Yte(L,t,_,A):null})})});XD.displayName="SpatialArg3DVisualization";const Z1=({initialPosition:t={x:0,y:0},onPositionChange:e,dragHandleRef:n}={})=>{const[r,i]=F.useState({position:t,isDragging:!1,dragOffset:{x:0,y:0},hasMoved:!1,startTime:0}),s=F.useRef(null),o=F.useCallback(h=>{var T;if(n!=null&&n.current&&!n.current.contains(h.target))return;const g=(T=s.current)==null?void 0:T.getBoundingClientRect();if(!g)return;const _=r.position.x===0&&r.position.y===0?{x:g.left,y:g.top}:r.position,y={x:h.clientX-g.left,y:h.clientY-g.top};i(w=>({...w,position:_,isDragging:!0,dragOffset:y,hasMoved:!1,startTime:Date.now()})),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"},[n,r.position]),l=F.useCallback(h=>{var S;if(!r.isDragging)return;const g={x:h.clientX-r.dragOffset.x,y:h.clientY-r.dragOffset.y},_=window.innerWidth,y=window.innerHeight,T=(S=s.current)==null?void 0:S.getBoundingClientRect();T&&(g.x=Math.max(0,Math.min(_-T.width,g.x)),g.y=Math.max(0,Math.min(y-T.height,g.y)));const w=Date.now()-r.startTime>150,x=Math.abs(g.x-r.position.x)>3||Math.abs(g.y-r.position.y)>3;i(R=>({...R,position:g,hasMoved:R.hasMoved||w||x})),e==null||e(g)},[r.isDragging,r.dragOffset,r.startTime,r.position,e]),u=F.useCallback(()=>{i(h=>({...h,isDragging:!1})),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);F.useEffect(()=>{if(r.isDragging)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}},[r.isDragging,l,u]);const d=r.position.x!==0||r.position.y!==0;return{position:r.position,isDragging:r.isDragging,hasMoved:r.hasMoved,isRepositioned:d,elementRef:s,dragProps:{onMouseDown:o,style:d?{position:"fixed",left:r.position.x,top:r.position.y,cursor:r.isDragging?"grabbing":"grab",zIndex:r.isDragging?9999:void 0}:{cursor:"grab"}},setPosition:h=>{i(g=>({...g,position:h})),e==null||e(h)}}},Gte=({temporalSpacing:t,onTemporalSpacingChange:e,spatialSpacing:n,onSpatialSpacingChange:r,temporalGridOpacity:i,onTemporalGridOpacityChange:s,geographicShapeOpacity:o,onGeographicShapeOpacityChange:l,maxNodeRadius:u,onMaxNodeRadiusChange:d,geographicMode:h,onGeographicModeChange:g,customShapeFile:_,onCustomShapeFileChange:y,isLoadingGeographic:T,currentShape:w,showCrsWarning:x,crsDetection:S,onDismissCrsWarning:R})=>{const{colors:E}=Vt(),[A,k]=F.useState(!0),O=F.useRef(null),{elementRef:j,dragProps:N,hasMoved:I,isRepositioned:M}=Z1({initialPosition:{x:0,y:0},dragHandleRef:O}),q=G=>{g(G)},X=G=>{var J;const L=(J=G.target.files)==null?void 0:J[0];L&&y(L)};return m.jsxs("div",{ref:j,className:`border rounded-lg shadow-lg z-30 ${M?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${E.background}F0`,borderColor:E.border,color:E.text,...N.style},onMouseDown:N.onMouseDown,children:[m.jsxs("div",{ref:O,onClick:()=>!I&&k(!A),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:A?"transparent":`${E.containerBackground}80`},onMouseEnter:G=>{A||(G.currentTarget.style.backgroundColor=`${E.border}40`)},onMouseLeave:G=>{A||(G.currentTarget.style.backgroundColor=`${E.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:E.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"3D Visualization Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${A?"rotate-180":""}`,style:{color:E.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),A&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:E.text},children:"Geographic Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:E.accentPrimary},children:"Geographic Mode"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:E.containerBackground},children:[m.jsx("button",{onClick:()=>q("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:h==="unit_grid"?E.accentPrimary:E.containerBackground,color:h==="unit_grid"?E.background:E.text},children:"Unit Grid"}),m.jsx("button",{onClick:()=>q("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:h==="eastern_hemisphere"?E.accentPrimary:E.containerBackground,color:h==="eastern_hemisphere"?E.background:E.text},children:"Eastern Hemisphere"}),m.jsx("button",{onClick:()=>q("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:h==="custom"?E.accentPrimary:E.containerBackground,color:h==="custom"?E.background:E.text},children:"Custom"})]})]}),h==="custom"&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:E.accentPrimary},children:"Upload Shapefile (.zip)"}),m.jsx("input",{type:"file",accept:".zip",onChange:X,className:"w-full text-xs border rounded px-2 py-1 transition-colors",style:{color:E.text,backgroundColor:E.containerBackground,borderColor:`${E.accentPrimary}33`},onMouseEnter:G=>{G.currentTarget.style.borderColor=`${E.accentPrimary}66`},onMouseLeave:G=>{G.currentTarget.style.borderColor=`${E.accentPrimary}33`}}),_&&m.jsxs("p",{className:"text-xs",style:{color:E.accentPrimary},children:["Selected: ",_.name]})]}),T&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:E.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:E.text},children:"Loading geographic data..."})]}),w&&m.jsxs("div",{className:"text-xs",style:{color:`${E.text}B3`},children:[m.jsxs("div",{children:["Shape: ",w.name]}),w.bounds&&m.jsx("div",{children:"Shape loaded successfully"})]}),x&&S&&m.jsxs("div",{className:"border rounded p-3 space-y-2",style:{backgroundColor:`${E.background}33`,borderColor:`${E.accentPrimary}4D`},children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h5",{className:"text-xs font-bold",style:{color:E.accentPrimary},children:"Coordinate System Detected"}),m.jsx("button",{onClick:R,className:"text-xs",style:{color:`${E.accentPrimary}B3`},onMouseEnter:G=>{G.currentTarget.style.color=E.accentPrimary},onMouseLeave:G=>{G.currentTarget.style.color=`${E.accentPrimary}B3`},children:""})]}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:`${E.accentPrimary}E6`},children:[m.jsxs("div",{children:["CRS: ",S.crs]}),m.jsxs("div",{children:["Confidence: ",(S.confidence*100).toFixed(1),"%"]}),m.jsxs("div",{children:["Land coverage: ",(S.landPercentage*100).toFixed(1),"%"]}),m.jsx("div",{className:"italic",children:S.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:E.text},children:"Spacing"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:E.accentPrimary},children:["Temporal Spacing: ",t]}),m.jsx("input",{type:"range",min:5,max:50,step:1,value:t,onChange:G=>e(Number(G.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${E.accentPrimary} 0%, ${E.accentPrimary} ${(t-5)/45*100}%, ${E.border} ${(t-5)/45*100}%, ${E.border} 100%)`,accentColor:E.accentPrimary}})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:E.accentPrimary},children:["Spatial Spacing: ",n]}),m.jsx("input",{type:"range",min:50,max:500,step:10,value:n,onChange:G=>r(Number(G.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${E.accentPrimary} 0%, ${E.accentPrimary} ${(n-50)/450*100}%, ${E.border} ${(n-50)/450*100}%, ${E.border} 100%)`,accentColor:E.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:E.text},children:"Opacity"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:E.accentPrimary},children:["Temporal Grid: ",i,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:i,onChange:G=>s(Number(G.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${E.accentPrimary} 0%, ${E.accentPrimary} ${i}%, ${E.border} ${i}%, ${E.border} 100%)`,accentColor:E.accentPrimary}})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:E.accentPrimary},children:["Geographic Shape: ",o,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:o,onChange:G=>l(Number(G.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${E.accentPrimary} 0%, ${E.accentPrimary} ${o}%, ${E.border} ${o}%, ${E.border} 100%)`,accentColor:E.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:E.text},children:"Node Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:E.accentPrimary},children:["Max Node Radius: ",u,"px"]}),m.jsx("input",{type:"range",min:10,max:50,step:1,value:u,onChange:G=>d(Number(G.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${E.accentPrimary} 0%, ${E.accentPrimary} ${(u-10)/40*100}%, ${E.border} ${(u-10)/40*100}%, ${E.border} 100%)`,accentColor:E.accentPrimary}})]})]})]})]})},Kte=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,crsDetection:o})=>{const{colors:l}=Vt(),[u,d]=F.useState(!0),h=F.useRef(null),{elementRef:g,dragProps:_,hasMoved:y,isRepositioned:T}=Z1({initialPosition:{x:0,y:0},dragHandleRef:h}),w=t&&n?(n/t*100).toFixed(1):null,x=e&&r?(r/e*100).toFixed(1):null;return t||n||i||o?m.jsxs("div",{ref:g,className:`border rounded-lg shadow-lg z-10 ${T?"":"absolute top-4 right-4"}`,style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text,maxWidth:"280px",..._.style},onMouseDown:_.onMouseDown,children:[m.jsxs("div",{ref:h,onClick:()=>!y&&d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:R=>{u||(R.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:R=>{u||(R.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[(t||n||i)&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:l.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:l.text},children:[n.toLocaleString()," nodes (",w,"%), ",r.toLocaleString()," edges (",x,"%)"]})]}),i&&s&&(i!==n||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:l.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:l.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),o&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Coordinate System"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Detected CRS:"}),m.jsx("span",{style:{color:l.text},children:o.crs})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Confidence:"}),m.jsxs("span",{style:{color:l.text},children:[(o.confidence*100).toFixed(1),"%"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Land Coverage:"}),m.jsxs("span",{style:{color:l.text},children:[(o.landPercentage*100).toFixed(1),"%"]})]}),o.description&&m.jsxs("div",{className:"mt-2",children:[m.jsx("div",{className:"mb-1",style:{color:l.accentPrimary},children:"Description:"}),m.jsx("div",{className:"text-xs italic",style:{color:`${l.text}CC`},children:o.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[m.jsx("div",{children:" Drag: Rotate view"}),m.jsx("div",{children:" Shift+drag: Pan view"}),m.jsx("div",{children:" Scroll: Zoom in/out"}),m.jsx("div",{children:" Left click: Select node"}),m.jsx("div",{children:" Right click: Show ancestors"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${l.nodeSample[0]}, ${l.nodeSample[1]}, ${l.nodeSample[2]})`,borderColor:l.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:l.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeDefault[0]}, ${l.nodeDefault[1]}, ${l.nodeDefault[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeCombined[0]}, ${l.nodeCombined[1]}, ${l.nodeCombined[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${l.nodeRoot[0]}, ${l.nodeRoot[1]}, ${l.nodeRoot[2]})`,borderColor:`rgb(${l.nodeSelected[0]}, ${l.nodeSelected[1]}, ${l.nodeSelected[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Root Nodes"})]})]})]})]})]}):null},T0={FIT:1.8,MEDIUM:1.2,FAR:.8},Zte=({currentViewState:t,bounds:e,onViewStateChange:n})=>{const{colors:r}=Vt(),[i,s]=F.useState(!0),o=F.useRef(null),{elementRef:l,dragProps:u,hasMoved:d,isRepositioned:h}=Z1({initialPosition:{x:0,y:0},dragHandleRef:o}),g=()=>e?[(e.minX+e.maxX)/2,(e.minY+e.maxY)/2,(e.minZ+e.maxZ)/2]:[0,0,0],_=(S,R,E)=>{const A=g();n({target:A,rotationOrbit:S,rotationX:R,zoom:E})},y=()=>{const S=g();n({target:S})},T=[{value:T0.FIT,label:"Fit All",icon:""},{value:T0.MEDIUM,label:"Medium",icon:""},{value:T0.FAR,label:"Far",icon:""}],w=S=>{const R=S%360;_(R,t.rotationX,t.zoom)},x=S=>{const R=Math.max(0,Math.min(90,S));_(t.rotationOrbit,R,t.zoom)};return m.jsxs("div",{ref:l,className:`border rounded-lg shadow-lg z-20 ${h?"":"absolute"}`,style:{backgroundColor:`${r.background}F0`,borderColor:r.border,color:r.text,...h?{}:{top:16,right:300},...u.style},onMouseDown:u.onMouseDown,children:[m.jsxs("div",{ref:o,onClick:()=>!d&&s(!i),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:i?"transparent":`${r.containerBackground}80`},onMouseEnter:S=>{i||(S.currentTarget.style.backgroundColor=`${r.border}40`)},onMouseLeave:S=>{i||(S.currentTarget.style.backgroundColor=`${r.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:r.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Preset Views"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,style:{color:r.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsx("div",{className:"space-y-2",children:m.jsxs("button",{onClick:y,className:"w-full px-2 py-1.5 text-xs font-medium rounded transition-colors flex items-center justify-center gap-1",style:{backgroundColor:r.accentPrimary,color:r.background,border:`1px solid ${r.accentPrimary}`},onMouseEnter:S=>{S.currentTarget.style.opacity="0.8"},onMouseLeave:S=>{S.currentTarget.style.opacity="1"},children:[m.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v18m0 0l-4-4m4 4l4-4"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12h18m0 0l-4-4m4 4l-4 4"})]}),"Center ARG"]})}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Rotation"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationOrbit),""]}),m.jsx("input",{type:"range",min:0,max:360,step:1,value:t.rotationOrbit,onChange:S=>w(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationOrbit/360*100}%, ${r.border} ${t.rotationOrbit/360*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:360,value:Math.round(t.rotationOrbit),onChange:S=>w(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"View Angle"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationX),""]}),m.jsx("input",{type:"range",min:0,max:90,step:1,value:t.rotationX,onChange:S=>x(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationX/90*100}%, ${r.border} ${t.rotationX/90*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:90,value:Math.round(t.rotationX),onChange:S=>x(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Zoom Level"}),m.jsx("div",{className:"space-y-2",children:T.map(S=>m.jsxs("button",{onClick:()=>_(t.rotationOrbit,t.rotationX,S.value),className:"w-full px-3 py-2 text-xs font-medium rounded transition-colors flex items-center gap-2",style:{backgroundColor:Math.abs(t.zoom-S.value)<.1?r.accentPrimary:r.containerBackground,color:Math.abs(t.zoom-S.value)<.1?r.background:r.text,border:`1px solid ${r.border}`},title:`Set zoom to ${S.label}`,onMouseEnter:R=>{Math.abs(t.zoom-S.value)>=.1&&(R.currentTarget.style.backgroundColor=r.border)},onMouseLeave:R=>{Math.abs(t.zoom-S.value)>=.1&&(R.currentTarget.style.backgroundColor=r.containerBackground)},children:[m.jsx("span",{children:S.icon}),m.jsx("span",{children:S.label})]},S.value))})]}),m.jsxs("div",{className:"space-y-2 pt-2 border-t",style:{borderTopColor:r.border},children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Current View"}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:r.textSecondary},children:[m.jsxs("div",{children:["Rotation: ",Math.round(t.rotationOrbit),""]}),m.jsxs("div",{children:["Pan: ",Math.round(Math.abs(t.rotationX))," ",t.rotationX<0?"above":t.rotationX>0?"below":"level"]}),m.jsxs("div",{children:["Zoom: ",t.zoom.toFixed(2),"x"]})]})]})]})]})},Qte=({min:t,max:e,step:n=.001,value:r,onChange:i,formatValue:s=u=>u.toFixed(3),className:o="",height:l=400})=>{const{colors:u}=Vt(),[d,h]=F.useState(null),[g,_]=F.useState({y:0,startValue:[0,0]}),[y,T]=F.useState(!1),[w,x]=F.useState(null),S=F.useRef(null);F.useEffect(()=>{const I=q=>{if(q.key==="Shift"){if(T(!0),w===null){const X=Math.abs(r[1]-r[0]);x(Math.max(X,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},M=q=>{q.key==="Shift"&&(T(!1),x(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",I),document.addEventListener("keyup",M),()=>{document.removeEventListener("keydown",I),document.removeEventListener("keyup",M),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,w,n]);const R=F.useCallback(I=>{if(!S.current)return e;const M=S.current.getBoundingClientRect(),q=Math.max(0,Math.min(1,(M.bottom-I)/M.height)),X=t+q*(e-t);return Math.round(X/n)*n},[t,e,n]),E=F.useCallback(I=>(e-I)/(e-t)*100,[t,e]),A=F.useCallback((I,M)=>{I.preventDefault(),I.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",h(M),_({y:I.clientY,startValue:r})},[r]),k=F.useCallback(I=>{if(!d||!S.current)return;const M=R(I.clientY),[q,X]=r;if(d==="top"){const G=Math.max(t,Math.min(e,M));G<q?i([G,q]):i([q,G])}else if(d==="bottom"){const G=Math.max(t,Math.min(e,M));G>X?i([X,G]):i([G,X])}else if(d==="range"){const G=I.clientY-g.y,L=S.current.getBoundingClientRect(),J=-(G/L.height)*(e-t),[V,$]=g.startValue;let Y=Math.abs($-V);y&&w!==null&&(Y=w);const P=(V+$)/2+J;let H,ie;y&&w!==null?(H=P-Y/2,ie=P+Y/2):(H=V+J,ie=$+J),H<t&&(H=t,ie=t+Y),ie>e&&(ie=e,H=e-Y),i([Math.round(H/n)*n,Math.round(ie/n)*n])}},[d,r,i,R,t,e,n,g,y,w]),O=F.useCallback(()=>{h(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);F.useEffect(()=>{if(d)return document.addEventListener("mousemove",k),document.addEventListener("mouseup",O),()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",O)}},[d,k,O]);const j=E(r[1]),N=E(r[0]);return m.jsxs("div",{className:`flex items-center gap-3 ${o}`,style:{height:l,userSelect:"none"},children:[m.jsxs("div",{className:"flex flex-col justify-between text-xs",style:{color:u.text,height:l},children:[m.jsx("span",{children:s(e)}),m.jsx("span",{children:s(r[1])}),m.jsx("span",{className:"flex-1"}),m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(t)})]}),m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsxs("div",{ref:S,className:"relative w-4 rounded-full cursor-pointer",style:{height:l-40,backgroundColor:u.containerBackground},onMouseDown:I=>{const M=R(I.clientY),[q,X]=r,G=Math.abs(M-q),L=Math.abs(M-X);y||Math.abs(X-q)<n*2?A(I,"range"):G<L?A(I,"bottom"):A(I,"top")},children:[m.jsx("div",{className:`absolute w-full rounded-full transition-opacity ${y?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{top:`${j}%`,height:`${N-j}%`,backgroundColor:y?u.text:u.textSecondary,opacity:y?.8:1,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),A(I,"range")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${j}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),A(I,"top")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${N}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:I=>{I.preventDefault(),I.stopPropagation(),A(I,"bottom")}})]}),m.jsxs("div",{className:"mt-2 text-xs text-center",style:{color:u.text},children:[m.jsx("div",{children:"Temporal"}),m.jsx("div",{children:"Filter"}),m.jsx("div",{className:"mt-1 h-4 flex items-center justify-center",children:y?m.jsx("div",{className:"px-1 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:u.textSecondary,color:u.background,fontSize:"10px"},children:"Fixed"}):null})]})]})]})},qn={DEFAULT_DIMENSIONS:{width:800,height:600},DEBOUNCE_DELAY:500,GENOMIC_STEP_DIVISOR:1e3,PERCENTAGE_PRECISION:1,TIME_PRECISION:3,TEMPORAL_STEP_DIVISOR:1e3,TEMPORAL_SLIDER_HEIGHT:350,UNIT_GRID_SIZE:10},Jte={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,isFilterSectionCollapsed:!0},rd=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),tM=(t,e)=>(t/e*100).toFixed(qn.PERCENTAGE_PRECISION),ene=t=>t.map(([e,n,r])=>({index:e,left:n,right:r})),YD=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;if(n==="descendants"?u===o&&!i.has(d):d===o&&!i.has(u)){const g=n==="descendants"?d:u;r.add(g),s.push(g)}}))}return r},tne=(t,e)=>YD(t,e,"descendants"),nne=(t,e)=>YD(t,e,"ancestors"),nM=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,rne=t=>{if(!(t!=null&&t.length))return{minTime:0,maxTime:1,range:[0,1]};const e=t.map(i=>i.time),n=Math.min(...e),r=Math.max(...e);return{minTime:n,maxTime:r,range:[n,n]}},ine=(t,e,n)=>{const r={maxSamples:n};return t.mode==="genomic"&&(t.genomicRange[0]!==0||t.genomicRange[1]!==e.sequenceLength)?(r.genomicStart=t.genomicRange[0],r.genomicEnd=t.genomicRange[1]):t.mode==="tree"&&(t.treeRange[0]!==0||t.treeRange[1]!==e.treeIntervals.length-1)&&(r.treeStartIdx=t.treeRange[0],r.treeEndIdx=t.treeRange[1]),r},sne=(t,e,n)=>{if(!n)return t;const r=i=>{const s=t.nodes.filter(l=>i.has(l.id)),o=t.edges.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return i.has(u)&&i.has(d)});return{...t,nodes:s,edges:o,metadata:{...t.metadata,is_subset:!0}}};switch(e){case"subgraph":{const i=tne(n,t.edges);return i.add(n.id),r(i)}case"ancestors":{const i=nne(n,t.edges);return i.add(n.id),r(i)}default:return t}},ane=(t,e)=>{if(!e.isActive||e.mode!=="hide")return t;const[n,r]=e.range;if(n===e.minTime&&r===e.maxTime)return t;const s=t.nodes.filter(u=>u.time>=n&&u.time<=r),o=new Set(s.map(u=>u.id)),l=t.edges.filter(u=>{const d=typeof u.source=="number"?u.source:u.source.id,h=typeof u.target=="number"?u.target:u.target.id;return o.has(d)&&o.has(h)});return{...t,nodes:s,edges:l,metadata:{...t.metadata,is_subset:!0}}},one=(t,e,n,r)=>!t||!e||!n||!r?null:{originalNodes:e.metadata.original_num_nodes||r.num_nodes,originalEdges:e.metadata.original_num_edges||r.num_edges,subArgNodes:t.nodes.length,subArgEdges:t.edges.length,displayedNodes:n.nodes.length,displayedEdges:n.edges.length},lne=(t,e,n,r)=>{let i="";switch(t){case"subgraph":i=`3D SubARG at Root ${e==null?void 0:e.id}`;break;case"ancestors":i=`3D Parent ARG of Node ${e==null?void 0:e.id}`;break;default:i="3D Full ARG"}return n.isActive&&(r==null?void 0:r.metadata.genomic_start)!==void 0&&(r==null?void 0:r.metadata.genomic_end)!==void 0&&(i+=` (${rd(r.metadata.genomic_start)} - ${rd(r.metadata.genomic_end)})`),i},cne=({data:t,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:u,geographicShape:d,geographicMode:h,temporalGridOpacity:g,geographicShapeOpacity:_,maxNodeRadius:y,onViewStateChange:T,viewState:w})=>{const x=F.useRef(null),[S,R]=F.useState(qn.DEFAULT_DIMENSIONS);return F.useEffect(()=>{const E=()=>{if(x.current){const{clientWidth:k,clientHeight:O}=x.current;R({width:k||qn.DEFAULT_DIMENSIONS.width,height:O||qn.DEFAULT_DIMENSIONS.height})}};E(),window.addEventListener("resize",E);let A=null;return window.ResizeObserver&&x.current&&(A=new ResizeObserver(E),A.observe(x.current)),()=>{window.removeEventListener("resize",E),A&&A.disconnect()}},[]),m.jsx("div",{ref:x,className:"w-full h-full",children:m.jsx(XD,{data:t,width:S.width,height:S.height,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:u,geographicShape:d,geographicMode:h,temporalGridOpacity:g,geographicShapeOpacity:_,maxNodeRadius:y,onViewStateChange:T,externalViewState:w})})},une=({filename:t,max_samples:e})=>{const{colors:n}=Vt(),{treeSequence:r}=Fs(),[i,s]=F.useState(null),[o,l]=F.useState(null),[u,d]=F.useState(!0),[h,g]=F.useState(null),[_,y]=F.useState("full"),[T,w]=F.useState(null),[x,S]=F.useState({isActive:!1,mode:"genomic",genomicRange:[0,0],treeRange:[0,0]}),[R,E]=F.useState({isActive:!1,mode:"planes",range:[0,1],minTime:0,maxTime:1}),[A,k]=F.useState({sequenceLength:0,treeIntervals:[]}),[O,j]=F.useState(Jte),[N,I]=F.useState({target:[0,0,0],zoom:1.8,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[M,q]=F.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1}),X=F.useCallback(async()=>{try{if(q(U=>({...U,isLoading:!0})),M.mode==="unit_grid"){const{createUnitGridShape:U}=await ZN(async()=>{const{createUnitGridShape:oe}=await Promise.resolve().then(()=>J4);return{createUnitGridShape:oe}},void 0),Z=U(qn.UNIT_GRID_SIZE);q(oe=>({...oe,currentShape:Z}))}else if(M.mode==="custom"&&M.customShapeFile){const U=await xt.uploadShapefile(M.customShapeFile);console.log("Custom shapefile uploaded:",U.data)}else try{const U=await xt.getShapeData(M.mode);q(Z=>({...Z,currentShape:U.data}))}catch{console.warn(`Failed to load ${M.mode}, using fallback`);const{createUnitGridShape:Z}=await ZN(async()=>{const{createUnitGridShape:_e}=await Promise.resolve().then(()=>J4);return{createUnitGridShape:_e}},void 0),oe=Z(qn.UNIT_GRID_SIZE);q(_e=>({..._e,currentShape:oe}))}}catch(U){console.error("Error loading geographic data:",U)}finally{q(U=>({...U,isLoading:!1}))}},[M.mode,M.customShapeFile]);F.useEffect(()=>{X()},[X]),F.useEffect(()=>{(async()=>{var Z,oe;try{d(!0);const ye=(await xt.getGraphData(t,{maxSamples:e})).data;if(ye.metadata.sequence_length&&(k(Ae=>({...Ae,sequenceLength:ye.metadata.sequence_length})),S(Ae=>({...Ae,genomicRange:[0,ye.metadata.sequence_length]}))),(Z=ye.metadata.tree_intervals)!=null&&Z.length){const Ae=ene(ye.metadata.tree_intervals);k(Me=>({...Me,treeIntervals:Ae})),S(Me=>({...Me,treeRange:[0,Ae.length-1]}))}if((oe=ye.nodes)!=null&&oe.length){const Ae=rne(ye.nodes);E(Me=>({...Me,...Ae}))}if(!nM(ye))g("No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.");else if(s(ye),l(ye),H(ye),ye.metadata.suggested_geographic_mode){const Ae=ye.metadata.suggested_geographic_mode;q(Me=>({...Me,mode:Ae}))}}catch(_e){console.error("Error fetching 3D graph data:",_e),g(_e instanceof Error?_e.message:"Unknown error occurred")}finally{d(!1)}})()},[t,e]);const G=F.useRef(null);F.useEffect(()=>{if(!(!x.isActive||u))return G.current&&clearTimeout(G.current),G.current=setTimeout(async()=>{try{d(!0);const U=ine(x,A,e),oe=(await xt.getGraphData(t,U)).data;nM(oe)?(s(oe),g(null),H(oe)):g("No spatial data found in this range.")}catch(U){console.error("Error fetching filtered data:",U),g(U instanceof Error?U.message:"An error occurred while fetching graph data")}finally{d(!1)}},qn.DEBOUNCE_DELAY),()=>{G.current&&clearTimeout(G.current)}},[x,t,e,A.sequenceLength,A.treeIntervals.length]),F.useEffect(()=>{j(U=>({...U,isFilterSectionCollapsed:!x.isActive&&!R.isActive}))},[x.isActive,R.isActive]);const L=()=>{if(!i)return i;const U=ane(i,R);return sne(U,_,T)},J=U=>{_==="full"?(w(U),y("subgraph")):(T==null?void 0:T.id)===U.id?(y("full"),w(null)):(w(U),y("subgraph"))},V=U=>{w(U),y("ancestors")},$=()=>{y("full"),w(null)},Y=U=>{I(Z=>({...Z,...U}))},ue=U=>{I(Z=>({...Z,...U}))},P=U=>{if(!U||!U.nodes.length)return null;const Z=U.nodes.filter(Ye=>{var we,Re;return((we=Ye.location)==null?void 0:we.x)!==void 0&&((Re=Ye.location)==null?void 0:Re.y)!==void 0});if(Z.length===0)return null;const oe=Z.map(Ye=>Ye.location.x),_e=Z.map(Ye=>Ye.location.y),ye=Z.map(Ye=>Ye.time),Ae=Math.min(...oe),Me=Math.max(...oe),Ze=Math.min(..._e),It=Math.max(..._e),_t=(Ae+Me)/2,ut=(Ze+It)/2,De=Math.max(Me-Ae,It-Ze)||1,tn=(Ae-_t)/De*O.spatialSpacing,Ce=(Me-_t)/De*O.spatialSpacing,ln=(Ze-ut)/De*O.spatialSpacing,Gt=(It-ut)/De*O.spatialSpacing,On=Array.from(new Set(ye)).sort((Ye,we)=>Ye-we),_n=0,cn=(On.length-1)*O.temporalSpacing;return{minX:tn,maxX:Ce,minY:ln,maxY:Gt,minZ:_n,maxZ:cn}},H=U=>{const Z=P(U);if(Z){const oe=[(Z.minX+Z.maxX)/2,(Z.minY+Z.maxY)/2,(Z.minZ+Z.maxZ)/2];I(_e=>({..._e,target:oe}))}};if(u)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:n.accentPrimary}}),m.jsx("p",{style:{color:n.text},children:"Loading 3D spatial ARG visualization..."})]})});if(h)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:m.jsxs("div",{className:"text-center",style:{color:n.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:h})]})});const ie=L(),re=one(o,i,ie,r);return m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:n.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b px-4 py-2",style:{backgroundColor:n.background,borderBottomColor:n.border},children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:n.headerText},children:lne(_,T,x,i)}),(A.sequenceLength>0||A.treeIntervals.length>0)&&m.jsxs("div",{className:"flex items-center gap-4",children:[A.sequenceLength>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[m.jsx("input",{type:"checkbox",checked:x.isActive,onChange:()=>S(U=>({...U,isActive:!U.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Genomic Range"]}),m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[m.jsx("input",{type:"checkbox",checked:R.isActive,onChange:()=>E(U=>({...U,isActive:!U.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Temporal Range"]})]}),_!=="full"&&m.jsx("button",{onClick:$,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:U=>{U.currentTarget.style.borderColor=`${n.accentPrimary}66`,U.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:U=>{U.currentTarget.style.borderColor=`${n.accentPrimary}33`,U.currentTarget.style.backgroundColor=n.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[(x.isActive||R.isActive)&&m.jsxs("button",{onClick:()=>j(U=>({...U,isFilterSectionCollapsed:!U.isFilterSectionCollapsed})),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:n.accentPrimary,color:n.background},onMouseEnter:U=>{U.currentTarget.style.opacity="0.8"},onMouseLeave:U=>{U.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:O.isFilterSectionCollapsed?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${O.isFilterSectionCollapsed?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:n.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${n.nodeSample[0]}, ${n.nodeSample[1]}, ${n.nodeSample[2]})`,borderColor:n.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeDefault[0]}, ${n.nodeDefault[1]}, ${n.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeCombined[0]}, ${n.nodeCombined[1]}, ${n.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${n.nodeRoot[0]}, ${n.nodeRoot[1]}, ${n.nodeRoot[2]})`,borderColor:`rgb(${n.nodeSelected[0]}, ${n.nodeSelected[1]}, ${n.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:n.headerText,borderLeftColor:n.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})}),(x.isActive||R.isActive)&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:n.background,borderBottomColor:n.border},children:!O.isFilterSectionCollapsed&&m.jsxs("div",{className:"px-4 py-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:[x.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[m.jsx("button",{onClick:()=>S(U=>({...U,mode:"genomic"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="genomic"?n.accentPrimary:n.containerBackground,color:x.mode==="genomic"?n.background:n.text},children:"Genomic"}),A.treeIntervals.length>0&&m.jsx("button",{onClick:()=>S(U=>({...U,mode:"tree"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="tree"?n.accentPrimary:n.containerBackground,color:x.mode==="tree"?n.background:n.text},children:"Tree Index"})]})]}),R.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Temporal Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[m.jsx("button",{onClick:()=>E(U=>({...U,mode:"hide"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:R.mode==="hide"?n.accentPrimary:n.containerBackground,color:R.mode==="hide"?n.background:n.text},children:"Hide Others"}),m.jsx("button",{onClick:()=>E(U=>({...U,mode:"planes"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:R.mode==="planes"?n.accentPrimary:n.containerBackground,color:R.mode==="planes"?n.background:n.text},children:"Dim Others"})]})]})]}),x.isActive&&m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:x.mode==="genomic"&&A.sequenceLength>0?m.jsx(_O,{min:0,max:A.sequenceLength,step:Math.max(1,Math.floor(A.sequenceLength/qn.GENOMIC_STEP_DIVISOR)),value:x.genomicRange,onChange:U=>S(Z=>({...Z,genomicRange:U})),formatValue:rd,className:"w-full"}):x.mode==="tree"&&A.treeIntervals.length>0?m.jsx(vO,{treeIntervals:A.treeIntervals,value:x.treeRange,onChange:U=>S(Z=>({...Z,treeRange:U})),className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:n.text},children:[x.mode==="genomic"?m.jsxs("span",{children:[rd(x.genomicRange[1]-x.genomicRange[0])," bp (",tM(x.genomicRange[1]-x.genomicRange[0],A.sequenceLength),"%)",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",i.metadata.num_local_trees," trees"]})]}):x.mode==="tree"&&A.treeIntervals.length>0?m.jsxs("span",{children:["Trees ",x.treeRange[0],"-",x.treeRange[1]," (",x.treeRange[1]-x.treeRange[0]+1," of ",A.treeIntervals.length,")",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",i.metadata.expected_tree_count??i.metadata.num_local_trees," displayed"]}),(i==null?void 0:i.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:["  (actual: ",i.metadata.num_local_trees,")"]})]}):null,u&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})]})]}),R.isActive&&m.jsx("div",{className:"text-xs mt-3",style:{color:n.text},children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{children:["Temporal Range: ",R.range[0].toFixed(qn.TIME_PRECISION)," - ",R.range[1].toFixed(qn.TIME_PRECISION)," ","(",tM(R.range[1]-R.range[0],R.maxTime-R.minTime),"% of time range)  Hold Shift + drag to maintain window size"]}),u&&m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})})]})}),m.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[R.isActive&&!O.isFilterSectionCollapsed&&m.jsx("div",{className:"flex-shrink-0 border-r px-3 py-4 flex items-center justify-center",style:{backgroundColor:n.background,borderRightColor:n.border},children:m.jsx(Qte,{min:R.minTime,max:R.maxTime,step:(R.maxTime-R.minTime)/qn.TEMPORAL_STEP_DIVISOR,value:R.range,onChange:U=>E(Z=>({...Z,range:U})),formatValue:U=>U.toFixed(qn.TIME_PRECISION),height:qn.TEMPORAL_SLIDER_HEIGHT})}),m.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[m.jsx(cne,{data:ie,onNodeClick:J,onNodeRightClick:V,selectedNode:T,temporalRange:R.isActive?R.range:null,showTemporalPlanes:R.isActive&&R.mode==="planes",temporalFilterMode:R.isActive?R.mode:null,temporalSpacing:O.temporalSpacing,spatialSpacing:O.spatialSpacing,geographicShape:M.currentShape,geographicMode:M.mode,temporalGridOpacity:O.temporalGridOpacity,geographicShapeOpacity:O.geographicShapeOpacity,maxNodeRadius:O.maxNodeRadius,onViewStateChange:Y,viewState:N}),m.jsx(Zte,{currentViewState:N,bounds:P(ie),onViewStateChange:ue}),m.jsx(Gte,{temporalSpacing:O.temporalSpacing,onTemporalSpacingChange:U=>j(Z=>({...Z,temporalSpacing:U})),spatialSpacing:O.spatialSpacing,onSpatialSpacingChange:U=>j(Z=>({...Z,spatialSpacing:U})),temporalGridOpacity:O.temporalGridOpacity,onTemporalGridOpacityChange:U=>j(Z=>({...Z,temporalGridOpacity:U})),geographicShapeOpacity:O.geographicShapeOpacity,onGeographicShapeOpacityChange:U=>j(Z=>({...Z,geographicShapeOpacity:U})),maxNodeRadius:O.maxNodeRadius,onMaxNodeRadiusChange:U=>j(Z=>({...Z,maxNodeRadius:U})),geographicMode:M.mode,onGeographicModeChange:U=>q(Z=>({...Z,mode:U})),customShapeFile:M.customShapeFile,onCustomShapeFileChange:U=>q(Z=>({...Z,customShapeFile:U})),isLoadingGeographic:M.isLoading,currentShape:M.currentShape,showCrsWarning:M.showCrsWarning,crsDetection:i==null?void 0:i.metadata.coordinate_system_detection,onDismissCrsWarning:()=>q(U=>({...U,showCrsWarning:!1}))}),m.jsx(Kte,{originalNodeCount:re==null?void 0:re.originalNodes,originalEdgeCount:re==null?void 0:re.originalEdges,subargNodeCount:re==null?void 0:re.subArgNodes,subargEdgeCount:re==null?void 0:re.subArgEdges,displayedNodeCount:re==null?void 0:re.displayedNodes,displayedEdgeCount:re==null?void 0:re.displayedEdges,crsDetection:i!=null&&i.metadata.coordinate_system_detection?{crs:i.metadata.coordinate_system_detection.likely_crs,confidence:i.metadata.coordinate_system_detection.confidence,landPercentage:i.metadata.coordinate_system_detection.land_percentage,description:i.metadata.coordinate_system_detection.reasoning}:void 0,isTemporalSliderVisible:R.isActive})]})]})]})};function fne(){const{filename:t}=MM(),e=uc(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Fs(),{colors:s,setCurrentVisualizationType:o}=Vt(),l=F.useRef(null),[u,d]=F.useState(!1);if(F.useEffect(()=>{o("spatial-3d")},[o]),!t)return m.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"font-bold py-2 px-6 rounded-lg mt-4 transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=y=>{Se.user.action("switch-tree-sequence-spatial",{treeSequence:y},"SpatialArg3DVisualizationPage"),i(y),d(!1),e(`/visualize-spatial/${encodeURIComponent(y.filename)}`)},_=async()=>{if(l.current)try{const y=`${h.replace(/\.(trees|tsz)$/,"")}_3d_spatial_arg.png`,T={text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"},w=l.current.querySelector("[data-3d-visualization]");if(w!=null&&w.getExportData){const S=w.getExportData(),R=l.current.querySelector('[data-deck="true"]'),E=R?{current:R}:null;try{await PV(S,E,{filename:y,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("High-resolution 3D spatial ARG image exported successfully");return}catch(A){console.warn("High-quality export failed, falling back to canvas capture:",A)}}const x=l.current.querySelector("canvas");if(!x)throw new Error("No canvas found for export");await DV(x,{filename:y,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("3D spatial ARG image captured from canvas")}catch(y){console.error("Error downloading 3D spatial ARG image:",y)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.opacity="0.8"},onMouseLeave:y=>{y.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(fc,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"3D Spatial ARG"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(yO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download 3D visualization as PNG",children:"Download Image"}),r&&m.jsx(Fx,{filename:r.filename})]})]})]})}),m.jsx(zx,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:m.jsx("div",{ref:l,className:"w-full h-full",children:F.useMemo(()=>m.jsx(une,{filename:h,max_samples:n}),[h,n])})})]})}function dne(){return m.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 overflow-hidden pointer-events-none",children:m.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 1200 400",children:[m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.3s_both]",children:[m.jsx("line",{x1:"200",y1:"30",x2:"200",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.4s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"140",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.5s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"260",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.55s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.6s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"180",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.65s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"220",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.7s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"300",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.75s_both]"}),m.jsx("circle",{cx:"200",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_0.8s_both]"}),m.jsx("circle",{cx:"140",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.85s_both]"}),m.jsx("circle",{cx:"260",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.9s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.7s_both]",children:[m.jsx("line",{x1:"600",y1:"30",x2:"600",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.8s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"540",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.9s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"660",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.95s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"500",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"580",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.05s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"620",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.1s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"700",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.15s_both]"}),m.jsx("circle",{cx:"600",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.2s_both]"}),m.jsx("circle",{cx:"540",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.25s_both]"}),m.jsx("circle",{cx:"660",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.3s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_1.1s_both]",children:[m.jsx("line",{x1:"1000",y1:"30",x2:"1000",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_1.2s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"940",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.3s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"1060",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.35s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"900",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.4s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"980",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.45s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1020",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.5s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.55s_both]"}),m.jsx("circle",{cx:"1000",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.6s_both]"}),m.jsx("circle",{cx:"940",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.65s_both]"}),m.jsx("circle",{cx:"1060",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.7s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_1.5s_both]",children:[m.jsx("circle",{cx:"100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.7s_both]"}),m.jsx("circle",{cx:"180",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.75s_both]"}),m.jsx("circle",{cx:"220",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.8s_both]"}),m.jsx("circle",{cx:"300",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.85s_both]"}),m.jsx("circle",{cx:"500",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.9s_both]"}),m.jsx("circle",{cx:"580",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.95s_both]"}),m.jsx("circle",{cx:"620",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2s_both]"}),m.jsx("circle",{cx:"700",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.05s_both]"}),m.jsx("circle",{cx:"900",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.1s_both]"}),m.jsx("circle",{cx:"980",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.15s_both]"}),m.jsx("circle",{cx:"1020",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.2s_both]"}),m.jsx("circle",{cx:"1100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.25s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_2.3s_both]",children:[m.jsx("line",{x1:"400",y1:"20",x2:"400",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"}),m.jsx("line",{x1:"800",y1:"20",x2:"800",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"})]})]})})}function rM({onComplete:t,isTransitioning:e=!1}){const[n,r]=F.useState(!1),[i,s]=F.useState(!1);return F.useEffect(()=>{if(e){r(!0),s(!0);return}r(!0);const o=setTimeout(()=>{s(!0)},2300),l=setTimeout(()=>{t()},2600);return()=>{clearTimeout(o),clearTimeout(l)}},[t,e]),m.jsxs(m.Fragment,{children:[m.jsx("style",{children:`
        @keyframes drawLine {
          from { stroke-dasharray: 1000; stroke-dashoffset: 1000; }
          to { stroke-dasharray: 1000; stroke-dashoffset: 0; }
        }
        @keyframes drawPath {
          from { stroke-dasharray: 200; stroke-dashoffset: 200; }
          to { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInScale {
          from { opacity: 0; transform: scale(0); }
          to { opacity: 1; transform: scale(1); }
        }
      `}),m.jsxs("div",{className:`
        ${e?"absolute":"fixed"} inset-0 bg-sp-very-dark-blue flex items-center justify-center z-50
        transition-all duration-2000 ease-in-out
        ${i?"opacity-0":"opacity-100"}
      `,children:[m.jsx("div",{className:`
          transition-opacity duration-1000 ease-in-out
          ${e?"opacity-0":"opacity-100"}
        `,children:m.jsx(dne,{})}),m.jsxs("div",{className:`
          transform transition-all duration-2000 ease-in-out relative z-10
          ${e?"scale-50 -translate-y-32":n?"scale-100 opacity-100":"scale-75 opacity-0"}
        `,children:[m.jsxs("h1",{className:"text-[6rem] md:text-[8rem] lg:text-[10rem] font-extrabold tracking-tight text-center select-none",style:{letterSpacing:"-0.04em"},children:[m.jsx("span",{className:"text-white",children:"ARG"}),m.jsx("span",{className:"text-sp-pale-green",children:"scape"})]}),m.jsx("div",{className:`
            mt-8 text-center transition-opacity duration-1000 ease-in-out
            ${e?"opacity-0":"opacity-100"}
          `,children:m.jsx("div",{className:"text-sp-pale-green text-2xl md:text-3xl lg:text-4xl font-bold",children:"Visualizing Ancestral Recombination Graphs"})})]})]})]})}function iM({onOptionSelect:t,isTransitioning:e=!1}){const[n,r]=F.useState([]),[i,s]=F.useState(!0),[o,l]=F.useState(!e);F.useEffect(()=>{(async()=>{try{Se.data.processing("fetch-available-tree-sequences","LandingPage");const g=(await xt.getUploadedFiles()).data;r(g.uploaded_tree_sequences||[])}catch(h){Se.error("Failed to fetch available tree sequences",{component:"LandingPage",error:h instanceof Error?h:new Error(String(h))}),r([])}finally{s(!1)}})()},[]),F.useEffect(()=>{if(e){const d=setTimeout(()=>{l(!0)},100);return()=>clearTimeout(d)}else l(!0)},[e]);const u=d=>{d==="load"&&n.length===0||t(d)};return m.jsxs("div",{className:`
      text-sp-white min-h-screen flex flex-col items-center justify-center px-4 font-sans
      ${e?"absolute inset-0 z-40":""}
    `,children:[m.jsxs("div",{className:`
        text-center mb-12 transition-all duration-2000 ease-in-out
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx(fc,{size:"large",className:"mb-4"}),m.jsx("p",{className:"text-lg md:text-xl text-sp-white/70 mb-6",children:"Visualizing Ancestral Recombination Graphs"}),m.jsxs("a",{href:"/docs",className:"inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200 text-sm font-medium",children:[" View Documentation",m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),m.jsxs("div",{className:`
        w-full max-w-2xl space-y-4 transition-all duration-2000 ease-in-out delay-500
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx("button",{onClick:()=>u("upload"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Upload a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Upload your own .trees or .tsz file to visualize"})]})]})}),m.jsx("button",{onClick:()=>u("simulate"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Simulate a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Generate new data using msprime simulation"})]})]})}),m.jsx("button",{onClick:()=>u("load"),disabled:n.length===0,className:`w-full border rounded-xl p-6 text-left transition-all duration-200 group ${n.length===0?"bg-sp-dark-blue/50 border-sp-pale-green/10 cursor-not-allowed opacity-50":"bg-sp-dark-blue hover:bg-sp-dark-blue/80 border-sp-pale-green/20 hover:border-sp-pale-green/40"}`,children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors duration-200 ${n.length===0?"bg-sp-pale-green/5":"bg-sp-pale-green/10 group-hover:bg-sp-pale-green/20"}`,children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Load a tree sequence"}),m.jsxs("p",{className:"text-sp-white/60 text-sm",children:["Choose from existing uploaded sequences",i?m.jsx("span",{className:"ml-2",children:m.jsx("span",{className:"animate-pulse",children:"Loading..."})}):m.jsxs("span",{className:`ml-2 font-medium ${n.length===0?"text-red-400":"text-sp-pale-green"}`,children:["(",n.length," available)"]})]})]})]})})]}),m.jsx("div",{className:`
        bg-amber-900/15 border border-amber-700/25 rounded-lg p-3 mt-12 max-w-2xl mx-auto
        transition-all duration-2000 ease-in-out delay-1000
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:m.jsxs("p",{className:"text-amber-200 text-xs md:text-sm text-center leading-relaxed",children:[m.jsx("span",{className:"font-semibold",children:" Beta Notice:"})," Tree sequences are stored on a secure server for up to 24 hours. This is a beta application and data may be wiped during updates. Please download your results and respect our limited resources."]})}),m.jsx("div",{className:`
        mt-8 text-center
        transition-all duration-2000 ease-in-out delay-1200
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `})]})}var S0={exports:{}},E0,sM;function hne(){if(sM)return E0;sM=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return E0=t,E0}var A0,aM;function pne(){if(aM)return A0;aM=1;var t=hne();function e(){}function n(){}return n.resetWarningCache=e,A0=function(){function r(o,l,u,d,h,g){if(g!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:e};return s.PropTypes=s,s},A0}var oM;function gne(){return oM||(oM=1,S0.exports=pne()()),S0.exports}var mne=gne();const ht=Bx(mne);function Ys(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(h){try{d(r.next(h))}catch(g){o(g)}}function u(h){try{d(r.throw(h))}catch(g){o(g)}}function d(h){h.done?s(h.value):i(h.value).then(l,u)}d((r=r.apply(t,e||[])).next())})}const _ne=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function fo(t,e,n){const r=vne(t),{webkitRelativePath:i}=t,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${t.name}`;return typeof r.path!="string"&&lM(r,"path",s),lM(r,"relativePath",s),r}function vne(t){const{name:e}=t;if(e&&e.lastIndexOf(".")!==-1&&!t.type){const r=e.split(".").pop().toLowerCase(),i=_ne.get(r);i&&Object.defineProperty(t,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return t}function lM(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!0})}const yne=[".DS_Store","Thumbs.db"];function bne(t){return Ys(this,void 0,void 0,function*(){return id(t)&&xne(t.dataTransfer)?Ene(t.dataTransfer,t.type):wne(t)?Tne(t):Array.isArray(t)&&t.every(e=>"getFile"in e&&typeof e.getFile=="function")?Sne(t):[]})}function xne(t){return id(t)}function wne(t){return id(t)&&id(t.target)}function id(t){return typeof t=="object"&&t!==null}function Tne(t){return Ix(t.target.files).map(e=>fo(e))}function Sne(t){return Ys(this,void 0,void 0,function*(){return(yield Promise.all(t.map(n=>n.getFile()))).map(n=>fo(n))})}function Ene(t,e){return Ys(this,void 0,void 0,function*(){if(t.items){const n=Ix(t.items).filter(i=>i.kind==="file");if(e!=="drop")return n;const r=yield Promise.all(n.map(Ane));return cM(GD(r))}return cM(Ix(t.files).map(n=>fo(n)))})}function cM(t){return t.filter(e=>yne.indexOf(e.name)===-1)}function Ix(t){if(t===null)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];e.push(r)}return e}function Ane(t){if(typeof t.webkitGetAsEntry!="function")return uM(t);const e=t.webkitGetAsEntry();return e&&e.isDirectory?KD(e):uM(t,e)}function GD(t){return t.reduce((e,n)=>[...e,...Array.isArray(n)?GD(n):[n]],[])}function uM(t,e){return Ys(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof t.getAsFileSystemHandle=="function"){const s=yield t.getAsFileSystemHandle();if(s===null)throw new Error(`${t} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,fo(o)}}const r=t.getAsFile();if(!r)throw new Error(`${t} is not a File`);return fo(r,(n=e==null?void 0:e.fullPath)!==null&&n!==void 0?n:void 0)})}function Rne(t){return Ys(this,void 0,void 0,function*(){return t.isDirectory?KD(t):Cne(t)})}function KD(t){const e=t.createReader();return new Promise((n,r)=>{const i=[];function s(){e.readEntries(o=>Ys(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(Rne));i.push(l),s()}else try{const l=yield Promise.all(i);n(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function Cne(t){return Ys(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.file(r=>{const i=fo(r,t.fullPath);e(i)},r=>{n(r)})})})}var sf={},fM;function Nne(){return fM||(fM=1,sf.__esModule=!0,sf.default=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(",");if(n.length===0)return!0;var r=t.name||"",i=(t.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return n.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0}),sf}var kne=Nne();const R0=Bx(kne);function dM(t){return One(t)||Ine(t)||QD(t)||Mne()}function Mne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ine(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function One(t){if(Array.isArray(t))return Ox(t)}function hM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hM(Object(n),!0).forEach(function(r){ZD(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ZD(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function lc(t,e){return jne(t)||Dne(t,e)||QD(t,e)||Pne()}function Pne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QD(t,e){if(t){if(typeof t=="string")return Ox(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ox(t,e)}}function Ox(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Dne(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function jne(t){if(Array.isArray(t))return t}var Bne=typeof R0=="function"?R0:R0.default,Lne="file-invalid-type",Une="file-too-large",Fne="file-too-small",zne="too-many-files",Vne=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=e.split(","),r=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:Lne,message:"File type must be ".concat(r)}},gM=function(e){return{code:Une,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},mM=function(e){return{code:Fne,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},qne={code:zne,message:"Too many files"};function JD(t,e){var n=t.type==="application/x-moz-file"||Bne(t,e);return[n,n?null:Vne(e)]}function e6(t,e,n){if(ws(t.size))if(ws(e)&&ws(n)){if(t.size>n)return[!1,gM(n)];if(t.size<e)return[!1,mM(e)]}else{if(ws(e)&&t.size<e)return[!1,mM(e)];if(ws(n)&&t.size>n)return[!1,gM(n)]}return[!0,null]}function ws(t){return t!=null}function $ne(t){var e=t.files,n=t.accept,r=t.minSize,i=t.maxSize,s=t.multiple,o=t.maxFiles,l=t.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(u){var d=JD(u,n),h=lc(d,1),g=h[0],_=e6(u,r,i),y=lc(_,1),T=y[0],w=l?l(u):null;return g&&T&&!w})}function sd(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function af(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function _M(t){t.preventDefault()}function Hne(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function Wne(t){return t.indexOf("Edge/")!==-1}function Xne(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Hne(t)||Wne(t)}function Dr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!sd(r)&&l&&l.apply(void 0,[r].concat(s)),sd(r)})}}function Yne(){return"showOpenFilePicker"in window}function Gne(t){if(ws(t)){var e=Object.entries(t).filter(function(n){var r=lc(n,2),i=r[0],s=r[1],o=!0;return t6(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(n6))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(n,r){var i=lc(r,2),s=i[0],o=i[1];return pM(pM({},n),{},ZD({},s,o))},{});return[{description:"Files",accept:e}]}return t}function Kne(t){if(ws(t))return Object.entries(t).reduce(function(e,n){var r=lc(n,2),i=r[0],s=r[1];return[].concat(dM(e),[i],dM(s))},[]).filter(function(e){return t6(e)||n6(e)}).join(",")}function Zne(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function Qne(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}function t6(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||t==="application/*"||/\w+\/[-+.\w]+/g.test(t)}function n6(t){return/^.*\.[\w]+$/.test(t)}var Jne=["children"],ere=["open"],tre=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],nre=["refKey","onChange","onClick"];function rre(t){return are(t)||sre(t)||r6(t)||ire()}function ire(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function are(t){if(Array.isArray(t))return Px(t)}function C0(t,e){return cre(t)||lre(t,e)||r6(t,e)||ore()}function ore(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r6(t,e){if(t){if(typeof t=="string")return Px(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Px(t,e)}}function Px(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lre(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function cre(t){if(Array.isArray(t))return t}function vM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function At(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vM(Object(n),!0).forEach(function(r){Dx(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Dx(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ad(t,e){if(t==null)return{};var n=ure(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function ure(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var Q1=F.forwardRef(function(t,e){var n=t.children,r=ad(t,Jne),i=bf(r),s=i.open,o=ad(i,ere);return F.useImperativeHandle(e,function(){return{open:s}},[s]),Kl.createElement(F.Fragment,null,n(At(At({},o),{},{open:s})))});Q1.displayName="Dropzone";var i6={disabled:!1,getFilesFromEvent:bne,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Q1.defaultProps=i6;Q1.propTypes={children:ht.func,accept:ht.objectOf(ht.arrayOf(ht.string)),multiple:ht.bool,preventDropOnDocument:ht.bool,noClick:ht.bool,noKeyboard:ht.bool,noDrag:ht.bool,noDragEventsBubbling:ht.bool,minSize:ht.number,maxSize:ht.number,maxFiles:ht.number,disabled:ht.bool,getFilesFromEvent:ht.func,onFileDialogCancel:ht.func,onFileDialogOpen:ht.func,useFsAccessApi:ht.bool,autoFocus:ht.bool,onDragEnter:ht.func,onDragLeave:ht.func,onDragOver:ht.func,onDrop:ht.func,onDropAccepted:ht.func,onDropRejected:ht.func,onError:ht.func,validator:ht.func};var jx={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function bf(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=At(At({},i6),t),n=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,u=e.maxFiles,d=e.onDragEnter,h=e.onDragLeave,g=e.onDragOver,_=e.onDrop,y=e.onDropAccepted,T=e.onDropRejected,w=e.onFileDialogCancel,x=e.onFileDialogOpen,S=e.useFsAccessApi,R=e.autoFocus,E=e.preventDropOnDocument,A=e.noClick,k=e.noKeyboard,O=e.noDrag,j=e.noDragEventsBubbling,N=e.onError,I=e.validator,M=F.useMemo(function(){return Kne(n)},[n]),q=F.useMemo(function(){return Gne(n)},[n]),X=F.useMemo(function(){return typeof x=="function"?x:yM},[x]),G=F.useMemo(function(){return typeof w=="function"?w:yM},[w]),L=F.useRef(null),J=F.useRef(null),V=F.useReducer(fre,jx),$=C0(V,2),Y=$[0],ue=$[1],P=Y.isFocused,H=Y.isFileDialogActive,ie=F.useRef(typeof window<"u"&&window.isSecureContext&&S&&Yne()),re=function(){!ie.current&&H&&setTimeout(function(){if(J.current){var Re=J.current.files;Re.length||(ue({type:"closeDialog"}),G())}},300)};F.useEffect(function(){return window.addEventListener("focus",re,!1),function(){window.removeEventListener("focus",re,!1)}},[J,H,G,ie]);var U=F.useRef([]),Z=function(Re){L.current&&L.current.contains(Re.target)||(Re.preventDefault(),U.current=[])};F.useEffect(function(){return E&&(document.addEventListener("dragover",_M,!1),document.addEventListener("drop",Z,!1)),function(){E&&(document.removeEventListener("dragover",_M),document.removeEventListener("drop",Z))}},[L,E]),F.useEffect(function(){return!r&&R&&L.current&&L.current.focus(),function(){}},[L,R,r]);var oe=F.useCallback(function(we){N?N(we):console.error(we)},[N]),_e=F.useCallback(function(we){we.preventDefault(),we.persist(),On(we),U.current=[].concat(rre(U.current),[we.target]),af(we)&&Promise.resolve(i(we)).then(function(Re){if(!(sd(we)&&!j)){var We=Re.length,ze=We>0&&$ne({files:Re,accept:M,minSize:o,maxSize:s,multiple:l,maxFiles:u,validator:I}),Ge=We>0&&!ze;ue({isDragAccept:ze,isDragReject:Ge,isDragActive:!0,type:"setDraggedFiles"}),d&&d(we)}}).catch(function(Re){return oe(Re)})},[i,d,oe,j,M,o,s,l,u,I]),ye=F.useCallback(function(we){we.preventDefault(),we.persist(),On(we);var Re=af(we);if(Re&&we.dataTransfer)try{we.dataTransfer.dropEffect="copy"}catch{}return Re&&g&&g(we),!1},[g,j]),Ae=F.useCallback(function(we){we.preventDefault(),we.persist(),On(we);var Re=U.current.filter(function(ze){return L.current&&L.current.contains(ze)}),We=Re.indexOf(we.target);We!==-1&&Re.splice(We,1),U.current=Re,!(Re.length>0)&&(ue({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),af(we)&&h&&h(we))},[L,h,j]),Me=F.useCallback(function(we,Re){var We=[],ze=[];we.forEach(function(Ge){var vt=JD(Ge,M),En=C0(vt,2),Rr=En[0],dr=En[1],jt=e6(Ge,o,s),xe=C0(jt,2),Xe=xe[0],nt=xe[1],$e=I?I(Ge):null;if(Rr&&Xe&&!$e)We.push(Ge);else{var yt=[dr,nt];$e&&(yt=yt.concat($e)),ze.push({file:Ge,errors:yt.filter(function(qr){return qr})})}}),(!l&&We.length>1||l&&u>=1&&We.length>u)&&(We.forEach(function(Ge){ze.push({file:Ge,errors:[qne]})}),We.splice(0)),ue({acceptedFiles:We,fileRejections:ze,isDragReject:ze.length>0,type:"setFiles"}),_&&_(We,ze,Re),ze.length>0&&T&&T(ze,Re),We.length>0&&y&&y(We,Re)},[ue,l,M,o,s,u,_,y,T,I]),Ze=F.useCallback(function(we){we.preventDefault(),we.persist(),On(we),U.current=[],af(we)&&Promise.resolve(i(we)).then(function(Re){sd(we)&&!j||Me(Re,we)}).catch(function(Re){return oe(Re)}),ue({type:"reset"})},[i,Me,oe,j]),It=F.useCallback(function(){if(ie.current){ue({type:"openDialog"}),X();var we={multiple:l,types:q};window.showOpenFilePicker(we).then(function(Re){return i(Re)}).then(function(Re){Me(Re,null),ue({type:"closeDialog"})}).catch(function(Re){Zne(Re)?(G(Re),ue({type:"closeDialog"})):Qne(Re)?(ie.current=!1,J.current?(J.current.value=null,J.current.click()):oe(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):oe(Re)});return}J.current&&(ue({type:"openDialog"}),X(),J.current.value=null,J.current.click())},[ue,X,G,S,Me,oe,q,l]),_t=F.useCallback(function(we){!L.current||!L.current.isEqualNode(we.target)||(we.key===" "||we.key==="Enter"||we.keyCode===32||we.keyCode===13)&&(we.preventDefault(),It())},[L,It]),ut=F.useCallback(function(){ue({type:"focus"})},[]),De=F.useCallback(function(){ue({type:"blur"})},[]),tn=F.useCallback(function(){A||(Xne()?setTimeout(It,0):It())},[A,It]),Ce=function(Re){return r?null:Re},ln=function(Re){return k?null:Ce(Re)},Gt=function(Re){return O?null:Ce(Re)},On=function(Re){j&&Re.stopPropagation()},_n=F.useMemo(function(){return function(){var we=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=we.refKey,We=Re===void 0?"ref":Re,ze=we.role,Ge=we.onKeyDown,vt=we.onFocus,En=we.onBlur,Rr=we.onClick,dr=we.onDragEnter,jt=we.onDragOver,xe=we.onDragLeave,Xe=we.onDrop,nt=ad(we,tre);return At(At(Dx({onKeyDown:ln(Dr(Ge,_t)),onFocus:ln(Dr(vt,ut)),onBlur:ln(Dr(En,De)),onClick:Ce(Dr(Rr,tn)),onDragEnter:Gt(Dr(dr,_e)),onDragOver:Gt(Dr(jt,ye)),onDragLeave:Gt(Dr(xe,Ae)),onDrop:Gt(Dr(Xe,Ze)),role:typeof ze=="string"&&ze!==""?ze:"presentation"},We,L),!r&&!k?{tabIndex:0}:{}),nt)}},[L,_t,ut,De,tn,_e,ye,Ae,Ze,k,O,r]),cn=F.useCallback(function(we){we.stopPropagation()},[]),Ye=F.useMemo(function(){return function(){var we=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=we.refKey,We=Re===void 0?"ref":Re,ze=we.onChange,Ge=we.onClick,vt=ad(we,nre),En=Dx({accept:M,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Ce(Dr(ze,Ze)),onClick:Ce(Dr(Ge,cn)),tabIndex:-1},We,J);return At(At({},En),vt)}},[J,n,l,Ze,r]);return At(At({},Y),{},{isFocused:P&&!r,getRootProps:_n,getInputProps:Ye,rootRef:L,inputRef:J,open:Ce(It)})}function fre(t,e){switch(e.type){case"focus":return At(At({},t),{},{isFocused:!0});case"blur":return At(At({},t),{},{isFocused:!1});case"openDialog":return At(At({},jx),{},{isFileDialogActive:!0});case"closeDialog":return At(At({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":return At(At({},t),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return At(At({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return At({},jx);default:return t}}function yM(){}function dre({onUploadComplete:t,setLoading:e}){const[n,r]=F.useState(null),[i,s]=F.useState("none"),[o,l]=F.useState({sampleLocations:null,nodeLocations:null}),[u,d]=F.useState({}),h=F.useCallback(j=>{j.length>0&&(r(j[0]),s("none"),l({sampleLocations:null,nodeLocations:null}),d({}))},[]),{getRootProps:g,getInputProps:_,isDragActive:y}=bf({onDrop:h,multiple:!1,accept:bg.ACCEPTED_FORMATS}),T=F.useCallback(j=>{j.length>0&&l(N=>({...N,sampleLocations:j[0]}))},[]),w=bf({onDrop:T,multiple:!1,accept:bg.CSV_FORMATS}),x=F.useCallback(j=>{j.length>0&&l(N=>({...N,nodeLocations:j[0]}))},[]),S=bf({onDrop:x,multiple:!1,accept:bg.CSV_FORMATS}),R=async()=>{if(n){e(!0);try{Se.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone");const j=await xt.uploadTreeSequence(n);Se.info("File upload completed successfully",{component:"Dropzone",data:{filename:n.name,result:j}}),t&&t(j.data)}catch(j){Se.error("File upload failed",{component:"Dropzone",error:j instanceof Error?j:new Error(String(j)),data:{filename:n.name}}),alert(`Upload failed: ${j instanceof Error?j.message:"Unknown error"}`)}finally{e(!1)}}},E=()=>{s("add-locations")},A=async(j,N)=>{try{const I=await xt.uploadLocationCSV(j,N);return d(M=>({...M,[N]:I.data.filename})),I.data.filename}catch(I){throw Se.error("CSV upload failed",{component:"Dropzone",error:I instanceof Error?I:new Error(String(I)),data:{filename:j.name,csvType:N}}),I}},k=async()=>{if(!(!n||!o.sampleLocations||!o.nodeLocations)){e(!0);try{Se.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone"),await xt.uploadTreeSequence(n);let j=u.sample_locations,N=u.node_locations;if(!j&&o.sampleLocations&&(j=await A(o.sampleLocations,"sample_locations")),!N&&o.nodeLocations&&(N=await A(o.nodeLocations,"node_locations")),!j||!N)throw new Error("Failed to upload CSV files");console.log("Starting tree sequence update...");const I=await xt.updateTreeSequenceLocations({tree_sequence_filename:n.name,sample_locations_filename:j,node_locations_filename:N});console.log("Tree sequence update completed:",I),Se.info("Tree sequence updated with custom locations",{component:"Dropzone",data:{originalFilename:n.name,newFilename:I.data.new_filename}}),t&&(console.log("Calling onUploadComplete with:",I.data),t(I.data))}catch(j){Se.error("Tree sequence update failed",{component:"Dropzone",error:j instanceof Error?j:new Error(String(j)),data:{filename:n.name}}),alert(`Update failed: ${j instanceof Error?j.message:"Unknown error"}`)}finally{e(!1)}}},O=n&&o.sampleLocations&&o.nodeLocations;return m.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[m.jsxs("div",{...g(),className:`w-full h-48 border-2 border-dashed rounded-xl flex items-center justify-center text-xl transition-colors cursor-pointer select-none
          ${y?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{..._()}),n?m.jsx("span",{className:"truncate max-w-full px-2",children:n.name}):y?m.jsx("span",{children:"Drop the file here"}):m.jsxs("span",{className:"text-center",children:["Drag and drop to select a file",m.jsx("br",{}),m.jsx("span",{className:"text-base text-sp-pale-green",children:"or click to browse"}),m.jsx("br",{}),m.jsx("span",{className:"text-sm text-sp-very-pale-green mt-1",children:"Supported formats: .trees, .tsz"})]})]}),n&&i==="none"&&m.jsxs("div",{className:"w-full flex flex-col gap-3",children:[m.jsxs("button",{type:"button",onClick:R,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Load as-is"]}),m.jsxs("button",{type:"button",onClick:E,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Add locations"]})]}),i==="add-locations"&&m.jsxs("div",{className:"w-full space-y-4",children:[m.jsx("div",{className:"text-center text-sp-white/70 text-sm mb-4",children:"Upload CSV files with node locations (required columns: node_id, x, y, z)"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Sample Locations"}),m.jsxs("div",{...w.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${w.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...w.getInputProps()}),o.sampleLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.sampleLocations.name}):w.isDragActive?m.jsx("span",{children:"Drop CSV here"}):m.jsx("span",{children:"Click or drag CSV with sample locations"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Node Locations"}),m.jsxs("div",{...S.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${S.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...S.getInputProps()}),o.nodeLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.nodeLocations.name}):S.isDragActive?m.jsx("span",{children:"Drop CSV here"}):m.jsx("span",{children:"Click or drag CSV with node locations"})]})]}),m.jsxs("button",{type:"button",onClick:k,disabled:!O,className:`w-full font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 ${O?"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue transform hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Update Tree Sequence"]}),m.jsxs("button",{type:"button",onClick:()=>{s("none"),l({sampleLocations:null,nodeLocations:null}),d({})},className:"w-full bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}const za={num_samples:50,num_local_trees:10,max_time:20,model:"dtwf",filename_prefix:"simulated",crs:"EPSG:4326",ploidy:2},s6=t=>{switch(t){case"dtwf":return"dtwf";case"hudson":return"hud";case"smc":return"smc";case"smc_prime":return"smcp";default:return t.slice(0,4)}},a6=t=>{switch(t){case"EPSG:4326":return"4326";case"unit_grid":return"ug";case"EPSG:3857":return"3857";default:return t.replace(/[^a-zA-Z0-9]/g,"").slice(0,4)}},hre=t=>{const e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),r=String(t.getFullYear()).slice(-2),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}${n}${r}${i}${s}`},bM=(t,e,n=!1)=>{const r=s6(t.model),i=a6(t.crs||"EPSG:4326"),o=`r${e??Math.floor(Math.random()*1e3)}`;let l=`s${t.num_samples}_m${r}_t${t.num_local_trees}_g${t.max_time}_p${t.ploidy}_c${i}_${o}`;if(n){const d=hre(new Date);l+=`_d${d}`}return l};function pre({onSimulationComplete:t,setLoading:e}){var E;const[n,r]=F.useState(za),[i,s]=F.useState(!1),[o,l]=F.useState(!0),[u,d]=F.useState(!1),[h,g]=F.useState({num_samples:za.num_samples.toString(),num_local_trees:za.num_local_trees.toString(),max_time:za.max_time.toString(),ploidy:za.ploidy.toString(),random_seed:((E=za.random_seed)==null?void 0:E.toString())||"42"}),_=(A,k)=>{r(O=>({...O,[A]:k}))},y=(A,k)=>{g(O=>({...O,[A]:k}))},T=(A,k,O,j,N)=>{if(y(A,k),k==="")return;const I=parseInt(k);isNaN(I)||_(A,I)},w=(A,k,O,j,N)=>{const I=parseInt(k);let M=N;isNaN(I)||(M=Math.max(O,Math.min(j,I))),_(A,M),y(A,M.toString())},x=A=>{A.key==="Enter"&&(A.preventDefault(),R())},S=()=>o?bM(n,i?n.random_seed:void 0):n.filename_prefix,R=async()=>{e(!0);try{Se.user.action("simulate-start",{params:n},"TreeSequenceSimulator");const A={...n,population_size:n.num_samples*n.ploidy,random_seed:i?n.random_seed:void 0,filename_prefix:o?bM(n,i?n.random_seed:void 0,!0):n.filename_prefix},k=await xt.simulateTreeSequence(A);Se.info("Tree sequence simulation completed successfully",{component:"TreeSequenceSimulator",data:{params:A,result:k}}),t&&t(k.data)}catch(A){Se.error("Tree sequence simulation failed",{component:"TreeSequenceSimulator",error:A instanceof Error?A:new Error(String(A)),data:{params:n}}),alert(`Simulation failed: ${A instanceof Error?A.message:"Unknown error"}`)}finally{e(!1)}};return m.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Simulation Parameters"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Configure the tree sequence simulation settings"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sample individuals"}),m.jsx("input",{type:"number",min:"2",max:"500",value:h.num_samples,onChange:A=>T("num_samples",A.target.value),onBlur:A=>w("num_samples",A.target.value,2,500,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Range: 2-500"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Ploidy"}),m.jsx("input",{type:"number",min:"1",max:"10",value:h.ploidy,onChange:A=>T("ploidy",A.target.value),onBlur:A=>w("ploidy",A.target.value,1,10,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-10 (2=diploid)"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Local trees"}),m.jsx("input",{type:"number",min:"1",max:"1000",value:h.num_local_trees,onChange:A=>T("num_local_trees",A.target.value),onBlur:A=>w("num_local_trees",A.target.value,1,1e3,1),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Max generations"}),m.jsx("input",{type:"number",min:"1",max:"1000",value:h.max_time,onChange:A=>T("max_time",A.target.value),onBlur:A=>w("max_time",A.target.value,1,1e3,1),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Model"}),m.jsxs("select",{value:n.model,onChange:A=>_("model",A.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"dtwf",children:"Discrete Wright-Fisher"}),m.jsx("option",{value:"hudson",children:"Hudson"}),m.jsx("option",{value:"smc",children:"SMC"}),m.jsx("option",{value:"smc_prime",children:"SMC'"})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Coordinate System"}),m.jsxs("select",{value:n.crs||"EPSG:4326",onChange:A=>_("crs",A.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"EPSG:4326",children:"WGS84 Geographic"}),m.jsx("option",{value:"unit_grid",children:"Unit Grid (0-1)"}),m.jsx("option",{value:"EPSG:3857",children:"Web Mercator"})]}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Spatial coordinate system"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("div",{className:"bg-sp-pale-green/10 border border-sp-pale-green/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Population Summary"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{children:"Total haplotypes:"}),m.jsx("span",{className:"font-bold text-sp-pale-green",children:n.num_samples*n.ploidy})]}),m.jsxs("div",{className:"text-xs text-sp-white/60",children:[n.num_samples," individuals  ",n.ploidy," ploidy"]})]})]}),m.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Output Filename"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sp-pale-green break-all text-xs",children:S()}),m.jsx("div",{className:"text-xs text-sp-white/60",children:o?m.jsx("button",{onClick:()=>d(!0),className:"underline hover:text-sp-pale-green transition-colors cursor-pointer",children:"Auto-generated from parameters"}):"Custom filename"})]})]})]}),m.jsx("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl overflow-hidden",children:m.jsxs("details",{className:"group",children:[m.jsx("summary",{className:"px-5 py-3 cursor-pointer hover:bg-sp-pale-green/5 transition-colors duration-200 border-b border-sp-pale-green/10 group-open:border-b-0 list-none",children:m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green transition-transform duration-200 group-open:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),m.jsx("span",{className:"font-medium text-sp-white text-sm",children:"Advanced Options"})]})})}),m.jsxs("div",{className:"px-5 py-3 space-y-3 bg-sp-very-dark-blue/50",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useAutoFilename",checked:o,onChange:A=>l(A.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useAutoFilename",className:"text-sm font-medium text-sp-white",children:"Auto-generate filename"})]}),!o&&m.jsxs("div",{className:"ml-6",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1 block",children:"Custom filename prefix"}),m.jsx("input",{type:"text",value:n.filename_prefix,onChange:A=>_("filename_prefix",A.target.value),onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"simulated"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useCustomSeed",checked:i,onChange:A=>s(A.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useCustomSeed",className:"text-sm font-medium text-sp-white",children:"Use custom random seed"})]}),i?m.jsx("div",{className:"ml-6",children:m.jsx("input",{type:"number",value:h.random_seed,onChange:A=>{const k=A.target.value;if(y("random_seed",k),k!==""){const O=parseInt(k);isNaN(O)||_("random_seed",O)}},onBlur:A=>{const k=parseInt(A.target.value),O=isNaN(k)?42:k;_("random_seed",O),y("random_seed",O.toString())},onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"42"})}):m.jsx("div",{className:"ml-6 text-xs text-sp-white/60",children:"Random seed will be generated automatically"})]})]})]})}),m.jsx("div",{className:"flex justify-center pt-2",children:m.jsxs("button",{type:"button",onClick:R,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Simulate Tree Sequence"]})}),u&&m.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/30 rounded-xl p-5 max-w-lg w-full shadow-2xl",children:[m.jsxs("div",{className:"flex justify-between items-start mb-3",children:[m.jsx("h3",{className:"text-lg font-bold text-sp-white",children:"Filename Format Explained"}),m.jsx("button",{onClick:()=>d(!1),className:"text-sp-white/60 hover:text-sp-white transition-colors text-2xl leading-none",children:""})]}),m.jsxs("div",{className:"space-y-3 text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sm text-sp-pale-green bg-sp-dark-blue rounded-lg p-3 break-all",children:S()}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["s",n.num_samples]})," - Sample individuals (2-500)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["m",s6(n.model)]})," - Model (dtwf, hud, smc, smcp)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["t",n.num_local_trees]})," - Local trees (1-1000)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["g",n.max_time]})," - Max generations (1-1000)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["p",n.ploidy]})," - Ploidy (1-10)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["c",a6(n.crs||"EPSG:4326")]})," - Coordinate system"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"r###"})," - Random seed (0-999)"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"d##########"})," - Timestamp (MMDDYYHHMM)"]})]})]}),m.jsx("button",{onClick:()=>d(!1),className:"w-full mt-4 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white font-medium py-2.5 rounded-lg transition-colors duration-200",children:"Close"})]})})]})}function gre({selectedOption:t,onBack:e}){const n=uc(),[r,i]=F.useState(!1),[s,o]=F.useState(0),{setTreeSequence:l}=Fs();F.useEffect(()=>{if(r){const T=setInterval(()=>{o(w=>(w+1)%4)},NL.LOADING_DOTS_INTERVAL);return()=>clearInterval(T)}else o(0)},[r]);const u=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},d=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},h=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},g=()=>{switch(t){case"upload":return"Upload a Tree Sequence";case"simulate":return"Simulate a Tree Sequence";case"load":return"Load a Tree Sequence";default:return""}},_=()=>{switch(t){case"upload":return"Upload your own .trees file to visualize";case"simulate":return"Generate new data using msprime simulation";case"load":return"Choose from existing uploaded sequences";default:return""}},y=()=>{if(r)return m.jsxs("div",{className:"flex flex-col items-center text-xl text-sp-white space-y-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sp-pale-green"}),m.jsxs("span",{children:["Processing",Array(s+1).join(".")]})]});switch(t){case"upload":return m.jsx(dre,{onUploadComplete:u,setLoading:i});case"simulate":return m.jsx(pre,{onSimulationComplete:h,setLoading:i});case"load":return m.jsx(qM,{onSelect:d});default:return null}};return m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{onClick:e,className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to options"]}),m.jsx(fc,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:g()}),m.jsx("p",{className:"text-sp-white/70 text-lg",children:_()})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsx("div",{className:"p-8 min-h-[600px] flex items-start justify-center",children:y()})})})]})}const o6="argscape_first_visit",mre=()=>{try{return!sessionStorage.getItem(o6)}catch{return!0}},_re=()=>{try{sessionStorage.setItem(o6,"true")}catch{console.warn("Session storage not available")}};function of({children:t}){return m.jsxs(m.Fragment,{children:[m.jsx("main",{children:t}),m.jsx(VV,{})]})}function vre(){const t=cc(),[e,n]=F.useState("intro"),[r,i]=F.useState(null),[s,o]=F.useState(!1),[l,u]=F.useState([]),[d,h]=F.useState(!1),[g,_]=F.useState(!1),[y,T]=F.useState(!1);F.useEffect(()=>{d||(async()=>{var E;try{Se.data.processing("fetch-available-tree-sequences","Home");const k=(await xt.getUploadedFiles()).data;u(k.uploaded_tree_sequences||[]),Se.info(`Found ${((E=k.uploaded_tree_sequences)==null?void 0:E.length)||0} available tree sequences for animation logic`,{component:"Home"})}catch(A){Se.error("Failed to fetch available tree sequences",{component:"Home",error:A instanceof Error?A:new Error(String(A))}),u([])}finally{h(!0)}})()},[d]),F.useEffect(()=>{var j,N,I,M;if(!d)return;const R=(j=t.state)==null?void 0:j.fromInternal,E=(N=t.state)==null?void 0:N.fromResult,A=(I=t.state)==null?void 0:I.selectedOption,k=(M=t.state)==null?void 0:M.forceIntro;E&&A?(i(A),n("intermediate"),o(!1)):(l.length>0||E&&A||R?!1:(k||mre(),!0))?(o(!0),n("intro"),i(null),_re()):(n("landing"),o(!1),i(null))},[t.state,d,l.length]);const w=()=>{T(!0),n("transitioning"),setTimeout(()=>{n("landing"),o(!1),T(!1)},2e3)},x=R=>{i(R),n("intermediate")},S=()=>{i(null),n("landing")};return m.jsxs("div",{className:"bg-sp-very-dark-blue min-h-screen",children:[s&&e==="intro"&&m.jsx(rM,{onComplete:w}),e==="transitioning"&&m.jsxs("div",{className:"relative min-h-screen",children:[m.jsx(rM,{onComplete:w,isTransitioning:!0}),m.jsx(iM,{onOptionSelect:x,isTransitioning:!0})]}),e==="landing"&&m.jsx(iM,{onOptionSelect:x}),e==="intermediate"&&r&&m.jsx(gre,{selectedOption:r,onBack:S})]})}function yre(){return m.jsx(OL,{children:m.jsx(kL,{children:m.jsx(RL,{children:m.jsxs(SL,{children:[m.jsx(Rl,{path:"/",element:m.jsx(of,{children:m.jsx(vre,{})})}),m.jsx(Rl,{path:"/result",element:m.jsx(of,{children:m.jsx(BL,{})})}),m.jsx(Rl,{path:"/visualize/:filename",element:m.jsx(of,{children:m.jsx(zV,{})})}),m.jsx(Rl,{path:"/visualize-spatial/:filename",element:m.jsx(of,{children:m.jsx(fne,{})})})]})})})})}MB.createRoot(document.getElementById("root")).render(m.jsx(yre,{}));
