var wL=Object.defineProperty;var TL=(n,e,t)=>e in n?wL(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>TL(n,typeof e!="symbol"?e+"":e,t);function SL(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var zu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mg={exports:{}},xl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V3;function EL(){if(V3)return xl;V3=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:s}}return xl.Fragment=e,xl.jsx=t,xl.jsxs=t,xl}var q3;function AL(){return q3||(q3=1,mg.exports=EL()),mg.exports}var m=AL(),_g={exports:{}},wl={},vg={exports:{}},yg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $3;function RL(){return $3||($3=1,function(n){function e(z,te){var fe=z.length;z.push(te);e:for(;0<fe;){var K=fe-1>>>1,I=z[K];if(0<i(I,te))z[K]=te,z[fe]=I,fe=K;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var te=z[0],fe=z.pop();if(fe!==te){z[0]=fe;e:for(var K=0,I=z.length,q=I>>>1;K<q;){var ee=2*(K+1)-1,se=z[ee],B=ee+1,Y=z[B];if(0>i(se,fe))B<I&&0>i(Y,se)?(z[K]=Y,z[B]=fe,K=B):(z[K]=se,z[ee]=fe,K=ee);else if(B<I&&0>i(Y,fe))z[K]=Y,z[B]=fe,K=B;else break e}}return te}function i(z,te){var fe=z.sortIndex-te.sortIndex;return fe!==0?fe:z.id-te.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var u=[],d=[],h=1,g=null,_=3,y=!1,T=!1,w=!1,x=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E(z){for(var te=t(d);te!==null;){if(te.callback===null)r(d);else if(te.startTime<=z)r(d),te.sortIndex=te.expirationTime,e(u,te);else break;te=t(d)}}function C(z){if(w=!1,E(z),!T)if(t(u)!==null)T=!0,O||(O=!0,X());else{var te=t(d);te!==null&&H(C,te.startTime-z)}}var O=!1,D=-1,M=5,P=-1;function k(){return x?!0:!(n.unstable_now()-P<M)}function V(){if(x=!1,O){var z=n.unstable_now();P=z;var te=!0;try{e:{T=!1,w&&(w=!1,A(D),D=-1),y=!0;var fe=_;try{t:{for(E(z),g=t(u);g!==null&&!(g.expirationTime>z&&k());){var K=g.callback;if(typeof K=="function"){g.callback=null,_=g.priorityLevel;var I=K(g.expirationTime<=z);if(z=n.unstable_now(),typeof I=="function"){g.callback=I,E(z),te=!0;break t}g===t(u)&&r(u),E(z)}else r(u);g=t(u)}if(g!==null)te=!0;else{var q=t(d);q!==null&&H(C,q.startTime-z),te=!1}}break e}finally{g=null,_=fe,y=!1}te=void 0}}finally{te?X():O=!1}}}var X;if(typeof R=="function")X=function(){R(V)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,$=Z.port2;Z.port1.onmessage=V,X=function(){$.postMessage(null)}}else X=function(){S(V,0)};function H(z,te){D=S(function(){z(n.unstable_now())},te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return _},n.unstable_next=function(z){switch(_){case 1:case 2:case 3:var te=3;break;default:te=_}var fe=_;_=te;try{return z()}finally{_=fe}},n.unstable_requestPaint=function(){x=!0},n.unstable_runWithPriority=function(z,te){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var fe=_;_=z;try{return te()}finally{_=fe}},n.unstable_scheduleCallback=function(z,te,fe){var K=n.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?K+fe:K):fe=K,z){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=fe+I,z={id:h++,callback:te,priorityLevel:z,startTime:fe,expirationTime:I,sortIndex:-1},fe>K?(z.sortIndex=fe,e(d,z),t(u)===null&&z===t(d)&&(w?(A(D),D=-1):w=!0,H(C,fe-K))):(z.sortIndex=I,e(u,z),T||y||(T=!0,O||(O=!0,X()))),z},n.unstable_shouldYield=k,n.unstable_wrapCallback=function(z){var te=_;return function(){var fe=_;_=te;try{return z.apply(this,arguments)}finally{_=fe}}}}(yg)),yg}var H3;function CL(){return H3||(H3=1,vg.exports=RL()),vg.exports}var bg={exports:{}},Le={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W3;function NL(){if(W3)return Le;W3=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.iterator;function _(I){return I===null||typeof I!="object"?null:(I=g&&I[g]||I["@@iterator"],typeof I=="function"?I:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function x(I,q,ee){this.props=I,this.context=q,this.refs=w,this.updater=ee||y}x.prototype.isReactComponent={},x.prototype.setState=function(I,q){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,q,"setState")},x.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function S(){}S.prototype=x.prototype;function A(I,q,ee){this.props=I,this.context=q,this.refs=w,this.updater=ee||y}var R=A.prototype=new S;R.constructor=A,T(R,x.prototype),R.isPureReactComponent=!0;var E=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function D(I,q,ee,se,B,Y){return ee=Y.ref,{$$typeof:n,type:I,key:q,ref:ee!==void 0?ee:null,props:Y}}function M(I,q){return D(I.type,q,void 0,void 0,void 0,I.props)}function P(I){return typeof I=="object"&&I!==null&&I.$$typeof===n}function k(I){var q={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(ee){return q[ee]})}var V=/\/+/g;function X(I,q){return typeof I=="object"&&I!==null&&I.key!=null?k(""+I.key):q.toString(36)}function Z(){}function $(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(Z,Z):(I.status="pending",I.then(function(q){I.status==="pending"&&(I.status="fulfilled",I.value=q)},function(q){I.status==="pending"&&(I.status="rejected",I.reason=q)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function H(I,q,ee,se,B){var Y=typeof I;(Y==="undefined"||Y==="boolean")&&(I=null);var Q=!1;if(I===null)Q=!0;else switch(Y){case"bigint":case"string":case"number":Q=!0;break;case"object":switch(I.$$typeof){case n:case e:Q=!0;break;case h:return Q=I._init,H(Q(I._payload),q,ee,se,B)}}if(Q)return B=B(I),Q=se===""?"."+X(I,0):se,E(B)?(ee="",Q!=null&&(ee=Q.replace(V,"$&/")+"/"),H(B,q,ee,"",function(Ee){return Ee})):B!=null&&(P(B)&&(B=M(B,ee+(B.key==null||I&&I.key===B.key?"":(""+B.key).replace(V,"$&/")+"/")+Q)),q.push(B)),1;Q=0;var pe=se===""?".":se+":";if(E(I))for(var ye=0;ye<I.length;ye++)se=I[ye],Y=pe+X(se,ye),Q+=H(se,q,ee,Y,B);else if(ye=_(I),typeof ye=="function")for(I=ye.call(I),ye=0;!(se=I.next()).done;)se=se.value,Y=pe+X(se,ye++),Q+=H(se,q,ee,Y,B);else if(Y==="object"){if(typeof I.then=="function")return H($(I),q,ee,se,B);throw q=String(I),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Q}function z(I,q,ee){if(I==null)return I;var se=[],B=0;return H(I,se,"","",function(Y){return q.call(ee,Y,B++)}),se}function te(I){if(I._status===-1){var q=I._result;q=q(),q.then(function(ee){(I._status===0||I._status===-1)&&(I._status=1,I._result=ee)},function(ee){(I._status===0||I._status===-1)&&(I._status=2,I._result=ee)}),I._status===-1&&(I._status=0,I._result=q)}if(I._status===1)return I._result.default;throw I._result}var fe=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)};function K(){}return Le.Children={map:z,forEach:function(I,q,ee){z(I,function(){q.apply(this,arguments)},ee)},count:function(I){var q=0;return z(I,function(){q++}),q},toArray:function(I){return z(I,function(q){return q})||[]},only:function(I){if(!P(I))throw Error("React.Children.only expected to receive a single React element child.");return I}},Le.Component=x,Le.Fragment=t,Le.Profiler=i,Le.PureComponent=A,Le.StrictMode=r,Le.Suspense=u,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Le.__COMPILER_RUNTIME={__proto__:null,c:function(I){return C.H.useMemoCache(I)}},Le.cache=function(I){return function(){return I.apply(null,arguments)}},Le.cloneElement=function(I,q,ee){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var se=T({},I.props),B=I.key,Y=void 0;if(q!=null)for(Q in q.ref!==void 0&&(Y=void 0),q.key!==void 0&&(B=""+q.key),q)!O.call(q,Q)||Q==="key"||Q==="__self"||Q==="__source"||Q==="ref"&&q.ref===void 0||(se[Q]=q[Q]);var Q=arguments.length-2;if(Q===1)se.children=ee;else if(1<Q){for(var pe=Array(Q),ye=0;ye<Q;ye++)pe[ye]=arguments[ye+2];se.children=pe}return D(I.type,B,void 0,void 0,Y,se)},Le.createContext=function(I){return I={$$typeof:o,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:s,_context:I},I},Le.createElement=function(I,q,ee){var se,B={},Y=null;if(q!=null)for(se in q.key!==void 0&&(Y=""+q.key),q)O.call(q,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(B[se]=q[se]);var Q=arguments.length-2;if(Q===1)B.children=ee;else if(1<Q){for(var pe=Array(Q),ye=0;ye<Q;ye++)pe[ye]=arguments[ye+2];B.children=pe}if(I&&I.defaultProps)for(se in Q=I.defaultProps,Q)B[se]===void 0&&(B[se]=Q[se]);return D(I,Y,void 0,void 0,null,B)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(I){return{$$typeof:l,render:I}},Le.isValidElement=P,Le.lazy=function(I){return{$$typeof:h,_payload:{_status:-1,_result:I},_init:te}},Le.memo=function(I,q){return{$$typeof:d,type:I,compare:q===void 0?null:q}},Le.startTransition=function(I){var q=C.T,ee={};C.T=ee;try{var se=I(),B=C.S;B!==null&&B(ee,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(K,fe)}catch(Y){fe(Y)}finally{C.T=q}},Le.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},Le.use=function(I){return C.H.use(I)},Le.useActionState=function(I,q,ee){return C.H.useActionState(I,q,ee)},Le.useCallback=function(I,q){return C.H.useCallback(I,q)},Le.useContext=function(I){return C.H.useContext(I)},Le.useDebugValue=function(){},Le.useDeferredValue=function(I,q){return C.H.useDeferredValue(I,q)},Le.useEffect=function(I,q,ee){var se=C.H;if(typeof ee=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return se.useEffect(I,q)},Le.useId=function(){return C.H.useId()},Le.useImperativeHandle=function(I,q,ee){return C.H.useImperativeHandle(I,q,ee)},Le.useInsertionEffect=function(I,q){return C.H.useInsertionEffect(I,q)},Le.useLayoutEffect=function(I,q){return C.H.useLayoutEffect(I,q)},Le.useMemo=function(I,q){return C.H.useMemo(I,q)},Le.useOptimistic=function(I,q){return C.H.useOptimistic(I,q)},Le.useReducer=function(I,q,ee){return C.H.useReducer(I,q,ee)},Le.useRef=function(I){return C.H.useRef(I)},Le.useState=function(I){return C.H.useState(I)},Le.useSyncExternalStore=function(I,q,ee){return C.H.useSyncExternalStore(I,q,ee)},Le.useTransition=function(){return C.H.useTransition()},Le.version="19.1.0",Le}var X3;function zx(){return X3||(X3=1,bg.exports=NL()),bg.exports}var xg={exports:{}},pn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y3;function kL(){if(Y3)return pn;Y3=1;var n=zx();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:d,implementation:h}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return pn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,pn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},pn.flushSync=function(u){var d=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=d,r.p=h,r.d.f()}},pn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},pn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},pn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:y}):h==="script"&&r.d.X(u,{crossOrigin:g,integrity:_,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},pn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},pn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin);r.d.L(u,h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},pn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},pn.requestFormReset=function(u){r.d.r(u)},pn.unstable_batchedUpdates=function(u,d){return u(d)},pn.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},pn.useFormStatus=function(){return o.H.useHostTransitionStatus()},pn.version="19.1.0",pn}var G3;function SM(){if(G3)return xg.exports;G3=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),xg.exports=kL(),xg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K3;function ML(){if(K3)return wl;K3=1;var n=CL(),e=zx(),t=SM();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,p=c;;){var v=f.return;if(v===null)break;var b=v.alternate;if(b===null){if(p=v.return,p!==null){f=p;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===f)return l(v),a;if(b===p)return l(v),c;b=b.sibling}throw Error(r(188))}if(f.return!==p.return)f=v,p=b;else{for(var N=!1,L=v.child;L;){if(L===f){N=!0,f=v,p=b;break}if(L===p){N=!0,p=v,f=b;break}L=L.sibling}if(!N){for(L=b.child;L;){if(L===f){N=!0,f=b,p=v;break}if(L===p){N=!0,p=b,f=v;break}L=L.sibling}if(!N)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function d(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=d(a),c!==null)return c;a=a.sibling}return null}var h=Object.assign,g=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),k=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function X(a){return a===null||typeof a!="object"?null:(a=V&&a[V]||a["@@iterator"],typeof a=="function"?a:null)}var Z=Symbol.for("react.client.reference");function $(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Z?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case x:return"Profiler";case w:return"StrictMode";case C:return"Suspense";case O:return"SuspenseList";case P:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case R:return(a.displayName||"Context")+".Provider";case A:return(a._context.displayName||"Context")+".Consumer";case E:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case D:return c=a.displayName||null,c!==null?c:$(a.type)||"Memo";case M:c=a._payload,a=a._init;try{return $(a(c))}catch{}}return null}var H=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},K=[],I=-1;function q(a){return{current:a}}function ee(a){0>I||(a.current=K[I],K[I]=null,I--)}function se(a,c){I++,K[I]=a.current,a.current=c}var B=q(null),Y=q(null),Q=q(null),pe=q(null);function ye(a,c){switch(se(Q,c),se(Y,a),se(B,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?m3(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=m3(c),a=_3(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ee(B),se(B,a)}function Ee(){ee(B),ee(Y),ee(Q)}function Oe(a){a.memoizedState!==null&&se(pe,a);var c=B.current,f=_3(c,a.type);c!==f&&(se(Y,a),se(B,f))}function ze(a){Y.current===a&&(ee(B),ee(Y)),pe.current===a&&(ee(pe),ml._currentValue=fe)}var It=Object.prototype.hasOwnProperty,mt=n.unstable_scheduleCallback,ct=n.unstable_cancelCallback,De=n.unstable_shouldYield,cn=n.unstable_requestPaint,Ne=n.unstable_now,yn=n.unstable_getCurrentPriorityLevel,Wt=n.unstable_ImmediatePriority,Rn=n.unstable_UserBlockingPriority,jt=n.unstable_NormalPriority,un=n.unstable_LowPriority,We=n.unstable_IdlePriority,xe=n.log,Re=n.unstable_setDisableYieldValue,Qe=null,Ve=null;function Ye(a){if(typeof xe=="function"&&Re(a),Ve&&typeof Ve.setStrictMode=="function")try{Ve.setStrictMode(Qe,a)}catch{}}var _t=Math.clz32?Math.clz32:mr,fn=Math.log,Xr=Math.LN2;function mr(a){return a>>>=0,a===0?32:31-(fn(a)/Xr|0)|0}var Lt=256,Bt=4194304;function Cn(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function _r(a,c,f){var p=a.pendingLanes;if(p===0)return 0;var v=0,b=a.suspendedLanes,N=a.pingedLanes;a=a.warmLanes;var L=p&134217727;return L!==0?(p=L&~b,p!==0?v=Cn(p):(N&=L,N!==0?v=Cn(N):f||(f=L&~a,f!==0&&(v=Cn(f))))):(L=p&~b,L!==0?v=Cn(L):N!==0?v=Cn(N):f||(f=p&~a,f!==0&&(v=Cn(f)))),v===0?0:c!==0&&c!==v&&(c&b)===0&&(b=v&-v,f=c&-c,b>=f||b===32&&(f&4194048)!==0)?c:v}function Kn(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function we(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rt(){var a=Lt;return Lt<<=1,(Lt&4194048)===0&&(Lt=256),a}function St(){var a=Bt;return Bt<<=1,(Bt&62914560)===0&&(Bt=4194304),a}function Je(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function vt(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Js(a,c,f,p,v,b){var N=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var L=a.entanglements,G=a.expirationTimes,ue=a.hiddenUpdates;for(f=N&~f;0<f;){var ge=31-_t(f),ve=1<<ge;L[ge]=0,G[ge]=-1;var de=ue[ge];if(de!==null)for(ue[ge]=null,ge=0;ge<de.length;ge++){var he=de[ge];he!==null&&(he.lane&=-536870913)}f&=~ve}p!==0&&Ao(a,p,0),b!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=b&~(N&~c))}function Ao(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-_t(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|f&4194090}function n2(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var p=31-_t(f),v=1<<p;v&c|a[p]&c&&(a[p]|=c),f&=~v}}function ah(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function oh(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function r2(){var a=te.p;return a!==0?a:(a=window.event,a===void 0?32:j3(a.type))}function f6(a,c){var f=te.p;try{return te.p=a,c()}finally{te.p=f}}var yi=Math.random().toString(36).slice(2),dn="__reactFiber$"+yi,Nn="__reactProps$"+yi,ea="__reactContainer$"+yi,lh="__reactEvents$"+yi,d6="__reactListeners$"+yi,h6="__reactHandles$"+yi,i2="__reactResources$"+yi,Ro="__reactMarker$"+yi;function ch(a){delete a[dn],delete a[Nn],delete a[lh],delete a[d6],delete a[h6]}function ta(a){var c=a[dn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[ea]||f[dn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=x3(a);a!==null;){if(f=a[dn])return f;a=x3(a)}return c}a=f,f=a.parentNode}return null}function na(a){if(a=a[dn]||a[ea]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function Co(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function ra(a){var c=a[i2];return c||(c=a[i2]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Qt(a){a[Ro]=!0}var s2=new Set,a2={};function as(a,c){ia(a,c),ia(a+"Capture",c)}function ia(a,c){for(a2[a]=c,a=0;a<c.length;a++)s2.add(c[a])}var p6=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),o2={},l2={};function g6(a){return It.call(l2,a)?!0:It.call(o2,a)?!1:p6.test(a)?l2[a]=!0:(o2[a]=!0,!1)}function Mc(a,c,f){if(g6(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function Ic(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function Yr(a,c,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+p)}}var uh,c2;function sa(a){if(uh===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);uh=c&&c[1]||"",c2=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uh+a+c2}var fh=!1;function dh(a,c){if(!a||fh)return"";fh=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(he){var de=he}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(he){de=he}a.call(ve.prototype)}}else{try{throw Error()}catch(he){de=he}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(he){if(he&&de&&typeof he.stack=="string")return[he.stack,de.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=p.DetermineComponentFrameRoot(),N=b[0],L=b[1];if(N&&L){var G=N.split(`
`),ue=L.split(`
`);for(v=p=0;p<G.length&&!G[p].includes("DetermineComponentFrameRoot");)p++;for(;v<ue.length&&!ue[v].includes("DetermineComponentFrameRoot");)v++;if(p===G.length||v===ue.length)for(p=G.length-1,v=ue.length-1;1<=p&&0<=v&&G[p]!==ue[v];)v--;for(;1<=p&&0<=v;p--,v--)if(G[p]!==ue[v]){if(p!==1||v!==1)do if(p--,v--,0>v||G[p]!==ue[v]){var ge=`
`+G[p].replace(" at new "," at ");return a.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",a.displayName)),ge}while(1<=p&&0<=v);break}}}finally{fh=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?sa(f):""}function m6(a){switch(a.tag){case 26:case 27:case 5:return sa(a.type);case 16:return sa("Lazy");case 13:return sa("Suspense");case 19:return sa("SuspenseList");case 0:case 15:return dh(a.type,!1);case 11:return dh(a.type.render,!1);case 1:return dh(a.type,!0);case 31:return sa("Activity");default:return""}}function u2(a){try{var c="";do c+=m6(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Zn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function f2(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function _6(a){var c=f2(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),p=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,b=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(N){p=""+N,b.call(this,N)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(N){p=""+N},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Oc(a){a._valueTracker||(a._valueTracker=_6(a))}function d2(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return a&&(p=f2(a)?a.checked?"true":"false":a.value),a=p,a!==f?(c.setValue(a),!0):!1}function Pc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var v6=/[\n"\\]/g;function Qn(a){return a.replace(v6,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function hh(a,c,f,p,v,b,N,L){a.name="",N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?a.type=N:a.removeAttribute("type"),c!=null?N==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Zn(c)):a.value!==""+Zn(c)&&(a.value=""+Zn(c)):N!=="submit"&&N!=="reset"||a.removeAttribute("value"),c!=null?ph(a,N,Zn(c)):f!=null?ph(a,N,Zn(f)):p!=null&&a.removeAttribute("value"),v==null&&b!=null&&(a.defaultChecked=!!b),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?a.name=""+Zn(L):a.removeAttribute("name")}function h2(a,c,f,p,v,b,N,L){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),c!=null||f!=null){if(!(b!=="submit"&&b!=="reset"||c!=null))return;f=f!=null?""+Zn(f):"",c=c!=null?""+Zn(c):f,L||c===a.value||(a.value=c),a.defaultValue=c}p=p??v,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=L?a.checked:!!p,a.defaultChecked=!!p,N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(a.name=N)}function ph(a,c,f){c==="number"&&Pc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function aa(a,c,f,p){if(a=a.options,c){c={};for(var v=0;v<f.length;v++)c["$"+f[v]]=!0;for(f=0;f<a.length;f++)v=c.hasOwnProperty("$"+a[f].value),a[f].selected!==v&&(a[f].selected=v),v&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Zn(f),c=null,v=0;v<a.length;v++){if(a[v].value===f){a[v].selected=!0,p&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function p2(a,c,f){if(c!=null&&(c=""+Zn(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Zn(f):""}function g2(a,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(H(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Zn(c),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p)}function oa(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var y6=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function m2(a,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,f):typeof f!="number"||f===0||y6.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function _2(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var v in c)p=c[v],c.hasOwnProperty(v)&&f[v]!==p&&m2(a,v,p)}else for(var b in c)c.hasOwnProperty(b)&&m2(a,b,c[b])}function gh(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var b6=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),x6=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Dc(a){return x6.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var mh=null;function _h(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var la=null,ca=null;function v2(a){var c=na(a);if(c&&(a=c.stateNode)){var f=a[Nn]||null;e:switch(a=c.stateNode,c.type){case"input":if(hh(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Qn(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==a&&p.form===a.form){var v=p[Nn]||null;if(!v)throw Error(r(90));hh(p,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===a.form&&d2(p)}break e;case"textarea":p2(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&aa(a,!!f.multiple,c,!1)}}}var vh=!1;function y2(a,c,f){if(vh)return a(c,f);vh=!0;try{var p=a(c);return p}finally{if(vh=!1,(la!==null||ca!==null)&&(bu(),la&&(c=la,a=ca,ca=la=null,v2(c),a)))for(c=0;c<a.length;c++)v2(a[c])}}function No(a,c){var f=a.stateNode;if(f===null)return null;var p=f[Nn]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var Gr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yh=!1;if(Gr)try{var ko={};Object.defineProperty(ko,"passive",{get:function(){yh=!0}}),window.addEventListener("test",ko,ko),window.removeEventListener("test",ko,ko)}catch{yh=!1}var bi=null,bh=null,jc=null;function b2(){if(jc)return jc;var a,c=bh,f=c.length,p,v="value"in bi?bi.value:bi.textContent,b=v.length;for(a=0;a<f&&c[a]===v[a];a++);var N=f-a;for(p=1;p<=N&&c[f-p]===v[b-p];p++);return jc=v.slice(a,1<p?1-p:void 0)}function Lc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Bc(){return!0}function x2(){return!1}function kn(a){function c(f,p,v,b,N){this._reactName=f,this._targetInst=v,this.type=p,this.nativeEvent=b,this.target=N,this.currentTarget=null;for(var L in a)a.hasOwnProperty(L)&&(f=a[L],this[L]=f?f(b):b[L]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Bc:x2,this.isPropagationStopped=x2,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Bc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Bc)},persist:function(){},isPersistent:Bc}),c}var os={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uc=kn(os),Mo=h({},os,{view:0,detail:0}),w6=kn(Mo),xh,wh,Io,Fc=h({},Mo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Io&&(Io&&a.type==="mousemove"?(xh=a.screenX-Io.screenX,wh=a.screenY-Io.screenY):wh=xh=0,Io=a),xh)},movementY:function(a){return"movementY"in a?a.movementY:wh}}),w2=kn(Fc),T6=h({},Fc,{dataTransfer:0}),S6=kn(T6),E6=h({},Mo,{relatedTarget:0}),Th=kn(E6),A6=h({},os,{animationName:0,elapsedTime:0,pseudoElement:0}),R6=kn(A6),C6=h({},os,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),N6=kn(C6),k6=h({},os,{data:0}),T2=kn(k6),M6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},I6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P6(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=O6[a])?!!c[a]:!1}function Sh(){return P6}var D6=h({},Mo,{key:function(a){if(a.key){var c=M6[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Lc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?I6[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sh,charCode:function(a){return a.type==="keypress"?Lc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Lc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),j6=kn(D6),L6=h({},Fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),S2=kn(L6),B6=h({},Mo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sh}),U6=kn(B6),F6=h({},os,{propertyName:0,elapsedTime:0,pseudoElement:0}),z6=kn(F6),V6=h({},Fc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),q6=kn(V6),$6=h({},os,{newState:0,oldState:0}),H6=kn($6),W6=[9,13,27,32],Eh=Gr&&"CompositionEvent"in window,Oo=null;Gr&&"documentMode"in document&&(Oo=document.documentMode);var X6=Gr&&"TextEvent"in window&&!Oo,E2=Gr&&(!Eh||Oo&&8<Oo&&11>=Oo),A2=" ",R2=!1;function C2(a,c){switch(a){case"keyup":return W6.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function N2(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ua=!1;function Y6(a,c){switch(a){case"compositionend":return N2(c);case"keypress":return c.which!==32?null:(R2=!0,A2);case"textInput":return a=c.data,a===A2&&R2?null:a;default:return null}}function G6(a,c){if(ua)return a==="compositionend"||!Eh&&C2(a,c)?(a=b2(),jc=bh=bi=null,ua=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return E2&&c.locale!=="ko"?null:c.data;default:return null}}var K6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function k2(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!K6[a.type]:c==="textarea"}function M2(a,c,f,p){la?ca?ca.push(p):ca=[p]:la=p,c=Au(c,"onChange"),0<c.length&&(f=new Uc("onChange","change",null,f,p),a.push({event:f,listeners:c}))}var Po=null,Do=null;function Z6(a){f3(a,0)}function zc(a){var c=Co(a);if(d2(c))return a}function I2(a,c){if(a==="change")return c}var O2=!1;if(Gr){var Ah;if(Gr){var Rh="oninput"in document;if(!Rh){var P2=document.createElement("div");P2.setAttribute("oninput","return;"),Rh=typeof P2.oninput=="function"}Ah=Rh}else Ah=!1;O2=Ah&&(!document.documentMode||9<document.documentMode)}function D2(){Po&&(Po.detachEvent("onpropertychange",j2),Do=Po=null)}function j2(a){if(a.propertyName==="value"&&zc(Do)){var c=[];M2(c,Do,a,_h(a)),y2(Z6,c)}}function Q6(a,c,f){a==="focusin"?(D2(),Po=c,Do=f,Po.attachEvent("onpropertychange",j2)):a==="focusout"&&D2()}function J6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return zc(Do)}function ej(a,c){if(a==="click")return zc(c)}function tj(a,c){if(a==="input"||a==="change")return zc(c)}function nj(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var jn=typeof Object.is=="function"?Object.is:nj;function jo(a,c){if(jn(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var v=f[p];if(!It.call(c,v)||!jn(a[v],c[v]))return!1}return!0}function L2(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function B2(a,c){var f=L2(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=c&&p>=c)return{node:f,offset:c-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=L2(f)}}function U2(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?U2(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function F2(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Pc(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=Pc(a.document)}return c}function Ch(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var rj=Gr&&"documentMode"in document&&11>=document.documentMode,fa=null,Nh=null,Lo=null,kh=!1;function z2(a,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;kh||fa==null||fa!==Pc(p)||(p=fa,"selectionStart"in p&&Ch(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Lo&&jo(Lo,p)||(Lo=p,p=Au(Nh,"onSelect"),0<p.length&&(c=new Uc("onSelect","select",null,c,f),a.push({event:c,listeners:p}),c.target=fa)))}function ls(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var da={animationend:ls("Animation","AnimationEnd"),animationiteration:ls("Animation","AnimationIteration"),animationstart:ls("Animation","AnimationStart"),transitionrun:ls("Transition","TransitionRun"),transitionstart:ls("Transition","TransitionStart"),transitioncancel:ls("Transition","TransitionCancel"),transitionend:ls("Transition","TransitionEnd")},Mh={},V2={};Gr&&(V2=document.createElement("div").style,"AnimationEvent"in window||(delete da.animationend.animation,delete da.animationiteration.animation,delete da.animationstart.animation),"TransitionEvent"in window||delete da.transitionend.transition);function cs(a){if(Mh[a])return Mh[a];if(!da[a])return a;var c=da[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in V2)return Mh[a]=c[f];return a}var q2=cs("animationend"),$2=cs("animationiteration"),H2=cs("animationstart"),ij=cs("transitionrun"),sj=cs("transitionstart"),aj=cs("transitioncancel"),W2=cs("transitionend"),X2=new Map,Ih="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ih.push("scrollEnd");function vr(a,c){X2.set(a,c),as(c,[a])}var Y2=new WeakMap;function Jn(a,c){if(typeof a=="object"&&a!==null){var f=Y2.get(a);return f!==void 0?f:(c={value:a,source:c,stack:u2(c)},Y2.set(a,c),c)}return{value:a,source:c,stack:u2(c)}}var er=[],ha=0,Oh=0;function Vc(){for(var a=ha,c=Oh=ha=0;c<a;){var f=er[c];er[c++]=null;var p=er[c];er[c++]=null;var v=er[c];er[c++]=null;var b=er[c];if(er[c++]=null,p!==null&&v!==null){var N=p.pending;N===null?v.next=v:(v.next=N.next,N.next=v),p.pending=v}b!==0&&G2(f,v,b)}}function qc(a,c,f,p){er[ha++]=a,er[ha++]=c,er[ha++]=f,er[ha++]=p,Oh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function Ph(a,c,f,p){return qc(a,c,f,p),$c(a)}function pa(a,c){return qc(a,null,null,c),$c(a)}function G2(a,c,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var v=!1,b=a.return;b!==null;)b.childLanes|=f,p=b.alternate,p!==null&&(p.childLanes|=f),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(v=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,v&&c!==null&&(v=31-_t(f),a=b.hiddenUpdates,p=a[v],p===null?a[v]=[c]:p.push(c),c.lane=f|536870912),b):null}function $c(a){if(50<ll)throw ll=0,Fp=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var ga={};function oj(a,c,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ln(a,c,f,p){return new oj(a,c,f,p)}function Dh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Kr(a,c){var f=a.alternate;return f===null?(f=Ln(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function K2(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function Hc(a,c,f,p,v,b){var N=0;if(p=a,typeof a=="function")Dh(a)&&(N=1);else if(typeof a=="string")N=cL(a,f,B.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case P:return a=Ln(31,f,c,v),a.elementType=P,a.lanes=b,a;case T:return us(f.children,v,b,c);case w:N=8,v|=24;break;case x:return a=Ln(12,f,c,v|2),a.elementType=x,a.lanes=b,a;case C:return a=Ln(13,f,c,v),a.elementType=C,a.lanes=b,a;case O:return a=Ln(19,f,c,v),a.elementType=O,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case S:case R:N=10;break e;case A:N=9;break e;case E:N=11;break e;case D:N=14;break e;case M:N=16,p=null;break e}N=29,f=Error(r(130,a===null?"null":typeof a,"")),p=null}return c=Ln(N,f,c,v),c.elementType=a,c.type=p,c.lanes=b,c}function us(a,c,f,p){return a=Ln(7,a,p,c),a.lanes=f,a}function jh(a,c,f){return a=Ln(6,a,null,c),a.lanes=f,a}function Lh(a,c,f){return c=Ln(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var ma=[],_a=0,Wc=null,Xc=0,tr=[],nr=0,fs=null,Zr=1,Qr="";function ds(a,c){ma[_a++]=Xc,ma[_a++]=Wc,Wc=a,Xc=c}function Z2(a,c,f){tr[nr++]=Zr,tr[nr++]=Qr,tr[nr++]=fs,fs=a;var p=Zr;a=Qr;var v=32-_t(p)-1;p&=~(1<<v),f+=1;var b=32-_t(c)+v;if(30<b){var N=v-v%5;b=(p&(1<<N)-1).toString(32),p>>=N,v-=N,Zr=1<<32-_t(c)+v|f<<v|p,Qr=b+a}else Zr=1<<b|f<<v|p,Qr=a}function Bh(a){a.return!==null&&(ds(a,1),Z2(a,1,0))}function Uh(a){for(;a===Wc;)Wc=ma[--_a],ma[_a]=null,Xc=ma[--_a],ma[_a]=null;for(;a===fs;)fs=tr[--nr],tr[nr]=null,Qr=tr[--nr],tr[nr]=null,Zr=tr[--nr],tr[nr]=null}var bn=null,Rt=null,Ge=!1,hs=null,Ir=!1,Fh=Error(r(519));function ps(a){var c=Error(r(418,""));throw Fo(Jn(c,a)),Fh}function Q2(a){var c=a.stateNode,f=a.type,p=a.memoizedProps;switch(c[dn]=a,c[Nn]=p,f){case"dialog":$e("cancel",c),$e("close",c);break;case"iframe":case"object":case"embed":$e("load",c);break;case"video":case"audio":for(f=0;f<ul.length;f++)$e(ul[f],c);break;case"source":$e("error",c);break;case"img":case"image":case"link":$e("error",c),$e("load",c);break;case"details":$e("toggle",c);break;case"input":$e("invalid",c),h2(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Oc(c);break;case"select":$e("invalid",c);break;case"textarea":$e("invalid",c),g2(c,p.value,p.defaultValue,p.children),Oc(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||g3(c.textContent,f)?(p.popover!=null&&($e("beforetoggle",c),$e("toggle",c)),p.onScroll!=null&&$e("scroll",c),p.onScrollEnd!=null&&$e("scrollend",c),p.onClick!=null&&(c.onclick=Ru),c=!0):c=!1,c||ps(a)}function J2(a){for(bn=a.return;bn;)switch(bn.tag){case 5:case 13:Ir=!1;return;case 27:case 3:Ir=!0;return;default:bn=bn.return}}function Bo(a){if(a!==bn)return!1;if(!Ge)return J2(a),Ge=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||ng(a.type,a.memoizedProps)),f=!f),f&&Rt&&ps(a),J2(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){Rt=br(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}Rt=null}}else c===27?(c=Rt,ji(a.type)?(a=ag,ag=null,Rt=a):Rt=c):Rt=bn?br(a.stateNode.nextSibling):null;return!0}function Uo(){Rt=bn=null,Ge=!1}function ew(){var a=hs;return a!==null&&(On===null?On=a:On.push.apply(On,a),hs=null),a}function Fo(a){hs===null?hs=[a]:hs.push(a)}var zh=q(null),gs=null,Jr=null;function xi(a,c,f){se(zh,c._currentValue),c._currentValue=f}function ei(a){a._currentValue=zh.current,ee(zh)}function Vh(a,c,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===f)break;a=a.return}}function qh(a,c,f,p){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var b=v.dependencies;if(b!==null){var N=v.child;b=b.firstContext;e:for(;b!==null;){var L=b;b=v;for(var G=0;G<c.length;G++)if(L.context===c[G]){b.lanes|=f,L=b.alternate,L!==null&&(L.lanes|=f),Vh(b.return,f,a),p||(N=null);break e}b=L.next}}else if(v.tag===18){if(N=v.return,N===null)throw Error(r(341));N.lanes|=f,b=N.alternate,b!==null&&(b.lanes|=f),Vh(N,f,a),N=null}else N=v.child;if(N!==null)N.return=v;else for(N=v;N!==null;){if(N===a){N=null;break}if(v=N.sibling,v!==null){v.return=N.return,N=v;break}N=N.return}v=N}}function zo(a,c,f,p){a=null;for(var v=c,b=!1;v!==null;){if(!b){if((v.flags&524288)!==0)b=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var N=v.alternate;if(N===null)throw Error(r(387));if(N=N.memoizedProps,N!==null){var L=v.type;jn(v.pendingProps.value,N.value)||(a!==null?a.push(L):a=[L])}}else if(v===pe.current){if(N=v.alternate,N===null)throw Error(r(387));N.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(ml):a=[ml])}v=v.return}a!==null&&qh(c,a,f,p),c.flags|=262144}function Yc(a){for(a=a.firstContext;a!==null;){if(!jn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ms(a){gs=a,Jr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function hn(a){return tw(gs,a)}function Gc(a,c){return gs===null&&ms(a),tw(a,c)}function tw(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Jr===null){if(a===null)throw Error(r(308));Jr=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Jr=Jr.next=c;return f}var lj=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},cj=n.unstable_scheduleCallback,uj=n.unstable_NormalPriority,Xt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $h(){return{controller:new lj,data:new Map,refCount:0}}function Vo(a){a.refCount--,a.refCount===0&&cj(uj,function(){a.controller.abort()})}var qo=null,Hh=0,va=0,ya=null;function fj(a,c){if(qo===null){var f=qo=[];Hh=0,va=Xp(),ya={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Hh++,c.then(nw,nw),c}function nw(){if(--Hh===0&&qo!==null){ya!==null&&(ya.status="fulfilled");var a=qo;qo=null,va=0,ya=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function dj(a,c){var f=[],p={status:"pending",value:null,reason:null,then:function(v){f.push(v)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var v=0;v<f.length;v++)(0,f[v])(c)},function(v){for(p.status="rejected",p.reason=v,v=0;v<f.length;v++)(0,f[v])(void 0)}),p}var rw=z.S;z.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&fj(a,c),rw!==null&&rw(a,c)};var _s=q(null);function Wh(){var a=_s.current;return a!==null?a:pt.pooledCache}function Kc(a,c){c===null?se(_s,_s.current):se(_s,c.pool)}function iw(){var a=Wh();return a===null?null:{parent:Xt._currentValue,pool:a}}var $o=Error(r(460)),sw=Error(r(474)),Zc=Error(r(542)),Xh={then:function(){}};function aw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Qc(){}function ow(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(Qc,Qc),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,cw(a),a;default:if(typeof c.status=="string")c.then(Qc,Qc);else{if(a=pt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=p}},function(p){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,cw(a),a}throw Ho=c,$o}}var Ho=null;function lw(){if(Ho===null)throw Error(r(459));var a=Ho;return Ho=null,a}function cw(a){if(a===$o||a===Zc)throw Error(r(483))}var wi=!1;function Yh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gh(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ti(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Si(a,c,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(tt&2)!==0){var v=p.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),p.pending=c,c=$c(a),G2(a,null,f),c}return qc(a,p,c,f),$c(a)}function Wo(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,n2(a,f)}}function Kh(a,c){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var v=null,b=null;if(f=f.firstBaseUpdate,f!==null){do{var N={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};b===null?v=b=N:b=b.next=N,f=f.next}while(f!==null);b===null?v=b=c:b=b.next=c}else v=b=c;f={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var Zh=!1;function Xo(){if(Zh){var a=ya;if(a!==null)throw a}}function Yo(a,c,f,p){Zh=!1;var v=a.updateQueue;wi=!1;var b=v.firstBaseUpdate,N=v.lastBaseUpdate,L=v.shared.pending;if(L!==null){v.shared.pending=null;var G=L,ue=G.next;G.next=null,N===null?b=ue:N.next=ue,N=G;var ge=a.alternate;ge!==null&&(ge=ge.updateQueue,L=ge.lastBaseUpdate,L!==N&&(L===null?ge.firstBaseUpdate=ue:L.next=ue,ge.lastBaseUpdate=G))}if(b!==null){var ve=v.baseState;N=0,ge=ue=G=null,L=b;do{var de=L.lane&-536870913,he=de!==L.lane;if(he?(He&de)===de:(p&de)===de){de!==0&&de===va&&(Zh=!0),ge!==null&&(ge=ge.next={lane:0,tag:L.tag,payload:L.payload,callback:null,next:null});e:{var Pe=a,ke=L;de=c;var at=f;switch(ke.tag){case 1:if(Pe=ke.payload,typeof Pe=="function"){ve=Pe.call(at,ve,de);break e}ve=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=ke.payload,de=typeof Pe=="function"?Pe.call(at,ve,de):Pe,de==null)break e;ve=h({},ve,de);break e;case 2:wi=!0}}de=L.callback,de!==null&&(a.flags|=64,he&&(a.flags|=8192),he=v.callbacks,he===null?v.callbacks=[de]:he.push(de))}else he={lane:de,tag:L.tag,payload:L.payload,callback:L.callback,next:null},ge===null?(ue=ge=he,G=ve):ge=ge.next=he,N|=de;if(L=L.next,L===null){if(L=v.shared.pending,L===null)break;he=L,L=he.next,he.next=null,v.lastBaseUpdate=he,v.shared.pending=null}}while(!0);ge===null&&(G=ve),v.baseState=G,v.firstBaseUpdate=ue,v.lastBaseUpdate=ge,b===null&&(v.shared.lanes=0),Ii|=N,a.lanes=N,a.memoizedState=ve}}function uw(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function fw(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)uw(f[a],c)}var ba=q(null),Jc=q(0);function dw(a,c){a=oi,se(Jc,a),se(ba,c),oi=a|c.baseLanes}function Qh(){se(Jc,oi),se(ba,ba.current)}function Jh(){oi=Jc.current,ee(ba),ee(Jc)}var Ei=0,Ue=null,it=null,Ut=null,eu=!1,xa=!1,vs=!1,tu=0,Go=0,wa=null,hj=0;function Ot(){throw Error(r(321))}function ep(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!jn(a[f],c[f]))return!1;return!0}function tp(a,c,f,p,v,b){return Ei=b,Ue=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,z.H=a===null||a.memoizedState===null?Gw:Kw,vs=!1,b=f(p,v),vs=!1,xa&&(b=pw(c,f,p,v)),hw(a),b}function hw(a){z.H=ou;var c=it!==null&&it.next!==null;if(Ei=0,Ut=it=Ue=null,eu=!1,Go=0,wa=null,c)throw Error(r(300));a===null||Jt||(a=a.dependencies,a!==null&&Yc(a)&&(Jt=!0))}function pw(a,c,f,p){Ue=a;var v=0;do{if(xa&&(wa=null),Go=0,xa=!1,25<=v)throw Error(r(301));if(v+=1,Ut=it=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}z.H=bj,b=c(f,p)}while(xa);return b}function pj(){var a=z.H,c=a.useState()[0];return c=typeof c.then=="function"?Ko(c):c,a=a.useState()[0],(it!==null?it.memoizedState:null)!==a&&(Ue.flags|=1024),c}function np(){var a=tu!==0;return tu=0,a}function rp(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function ip(a){if(eu){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}eu=!1}Ei=0,Ut=it=Ue=null,xa=!1,Go=tu=0,wa=null}function Mn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?Ue.memoizedState=Ut=a:Ut=Ut.next=a,Ut}function Ft(){if(it===null){var a=Ue.alternate;a=a!==null?a.memoizedState:null}else a=it.next;var c=Ut===null?Ue.memoizedState:Ut.next;if(c!==null)Ut=c,it=a;else{if(a===null)throw Ue.alternate===null?Error(r(467)):Error(r(310));it=a,a={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},Ut===null?Ue.memoizedState=Ut=a:Ut=Ut.next=a}return Ut}function sp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ko(a){var c=Go;return Go+=1,wa===null&&(wa=[]),a=ow(wa,a,c),c=Ue,(Ut===null?c.memoizedState:Ut.next)===null&&(c=c.alternate,z.H=c===null||c.memoizedState===null?Gw:Kw),a}function nu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ko(a);if(a.$$typeof===R)return hn(a)}throw Error(r(438,String(a)))}function ap(a){var c=null,f=Ue.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=Ue.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=sp(),Ue.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),p=0;p<a;p++)f[p]=k;return c.index++,f}function ti(a,c){return typeof c=="function"?c(a):c}function ru(a){var c=Ft();return op(c,it,a)}function op(a,c,f){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var v=a.baseQueue,b=p.pending;if(b!==null){if(v!==null){var N=v.next;v.next=b.next,b.next=N}c.baseQueue=v=b,p.pending=null}if(b=a.baseState,v===null)a.memoizedState=b;else{c=v.next;var L=N=null,G=null,ue=c,ge=!1;do{var ve=ue.lane&-536870913;if(ve!==ue.lane?(He&ve)===ve:(Ei&ve)===ve){var de=ue.revertLane;if(de===0)G!==null&&(G=G.next={lane:0,revertLane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),ve===va&&(ge=!0);else if((Ei&de)===de){ue=ue.next,de===va&&(ge=!0);continue}else ve={lane:0,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(L=G=ve,N=b):G=G.next=ve,Ue.lanes|=de,Ii|=de;ve=ue.action,vs&&f(b,ve),b=ue.hasEagerState?ue.eagerState:f(b,ve)}else de={lane:ve,revertLane:ue.revertLane,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},G===null?(L=G=de,N=b):G=G.next=de,Ue.lanes|=ve,Ii|=ve;ue=ue.next}while(ue!==null&&ue!==c);if(G===null?N=b:G.next=L,!jn(b,a.memoizedState)&&(Jt=!0,ge&&(f=ya,f!==null)))throw f;a.memoizedState=b,a.baseState=N,a.baseQueue=G,p.lastRenderedState=b}return v===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function lp(a){var c=Ft(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var p=f.dispatch,v=f.pending,b=c.memoizedState;if(v!==null){f.pending=null;var N=v=v.next;do b=a(b,N.action),N=N.next;while(N!==v);jn(b,c.memoizedState)||(Jt=!0),c.memoizedState=b,c.baseQueue===null&&(c.baseState=b),f.lastRenderedState=b}return[b,p]}function gw(a,c,f){var p=Ue,v=Ft(),b=Ge;if(b){if(f===void 0)throw Error(r(407));f=f()}else f=c();var N=!jn((it||v).memoizedState,f);N&&(v.memoizedState=f,Jt=!0),v=v.queue;var L=vw.bind(null,p,v,a);if(Zo(2048,8,L,[a]),v.getSnapshot!==c||N||Ut!==null&&Ut.memoizedState.tag&1){if(p.flags|=2048,Ta(9,iu(),_w.bind(null,p,v,f,c),null),pt===null)throw Error(r(349));b||(Ei&124)!==0||mw(p,c,f)}return f}function mw(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=Ue.updateQueue,c===null?(c=sp(),Ue.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function _w(a,c,f,p){c.value=f,c.getSnapshot=p,yw(c)&&bw(a)}function vw(a,c,f){return f(function(){yw(c)&&bw(a)})}function yw(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!jn(a,f)}catch{return!0}}function bw(a){var c=pa(a,2);c!==null&&Vn(c,a,2)}function cp(a){var c=Mn();if(typeof a=="function"){var f=a;if(a=f(),vs){Ye(!0);try{f()}finally{Ye(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:a},c}function xw(a,c,f,p){return a.baseState=f,op(a,it,typeof p=="function"?p:ti)}function gj(a,c,f,p,v){if(au(a))throw Error(r(485));if(a=c.action,a!==null){var b={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(N){b.listeners.push(N)}};z.T!==null?f(!0):b.isTransition=!1,p(b),f=c.pending,f===null?(b.next=c.pending=b,ww(c,b)):(b.next=f.next,c.pending=f.next=b)}}function ww(a,c){var f=c.action,p=c.payload,v=a.state;if(c.isTransition){var b=z.T,N={};z.T=N;try{var L=f(v,p),G=z.S;G!==null&&G(N,L),Tw(a,c,L)}catch(ue){up(a,c,ue)}finally{z.T=b}}else try{b=f(v,p),Tw(a,c,b)}catch(ue){up(a,c,ue)}}function Tw(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){Sw(a,c,p)},function(p){return up(a,c,p)}):Sw(a,c,f)}function Sw(a,c,f){c.status="fulfilled",c.value=f,Ew(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,ww(a,f)))}function up(a,c,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,Ew(c),c=c.next;while(c!==p)}a.action=null}function Ew(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function Aw(a,c){return c}function Rw(a,c){if(Ge){var f=pt.formState;if(f!==null){e:{var p=Ue;if(Ge){if(Rt){t:{for(var v=Rt,b=Ir;v.nodeType!==8;){if(!b){v=null;break t}if(v=br(v.nextSibling),v===null){v=null;break t}}b=v.data,v=b==="F!"||b==="F"?v:null}if(v){Rt=br(v.nextSibling),p=v.data==="F!";break e}}ps(p)}p=!1}p&&(c=f[0])}}return f=Mn(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Aw,lastRenderedState:c},f.queue=p,f=Ww.bind(null,Ue,p),p.dispatch=f,p=cp(!1),b=gp.bind(null,Ue,!1,p.queue),p=Mn(),v={state:c,dispatch:null,action:a,pending:null},p.queue=v,f=gj.bind(null,Ue,v,b,f),v.dispatch=f,p.memoizedState=a,[c,f,!1]}function Cw(a){var c=Ft();return Nw(c,it,a)}function Nw(a,c,f){if(c=op(a,c,Aw)[0],a=ru(ti)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Ko(c)}catch(N){throw N===$o?Zc:N}else p=c;c=Ft();var v=c.queue,b=v.dispatch;return f!==c.memoizedState&&(Ue.flags|=2048,Ta(9,iu(),mj.bind(null,v,f),null)),[p,b,a]}function mj(a,c){a.action=c}function kw(a){var c=Ft(),f=it;if(f!==null)return Nw(c,f,a);Ft(),c=c.memoizedState,f=Ft();var p=f.queue.dispatch;return f.memoizedState=a,[c,p,!1]}function Ta(a,c,f,p){return a={tag:a,create:f,deps:p,inst:c,next:null},c=Ue.updateQueue,c===null&&(c=sp(),Ue.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,c.lastEffect=a),a}function iu(){return{destroy:void 0,resource:void 0}}function Mw(){return Ft().memoizedState}function su(a,c,f,p){var v=Mn();p=p===void 0?null:p,Ue.flags|=a,v.memoizedState=Ta(1|c,iu(),f,p)}function Zo(a,c,f,p){var v=Ft();p=p===void 0?null:p;var b=v.memoizedState.inst;it!==null&&p!==null&&ep(p,it.memoizedState.deps)?v.memoizedState=Ta(c,b,f,p):(Ue.flags|=a,v.memoizedState=Ta(1|c,b,f,p))}function Iw(a,c){su(8390656,8,a,c)}function Ow(a,c){Zo(2048,8,a,c)}function Pw(a,c){return Zo(4,2,a,c)}function Dw(a,c){return Zo(4,4,a,c)}function jw(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function Lw(a,c,f){f=f!=null?f.concat([a]):null,Zo(4,4,jw.bind(null,c,a),f)}function fp(){}function Bw(a,c){var f=Ft();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&ep(c,p[1])?p[0]:(f.memoizedState=[a,c],a)}function Uw(a,c){var f=Ft();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&ep(c,p[1]))return p[0];if(p=a(),vs){Ye(!0);try{a()}finally{Ye(!1)}}return f.memoizedState=[p,c],p}function dp(a,c,f){return f===void 0||(Ei&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=VT(),Ue.lanes|=a,Ii|=a,f)}function Fw(a,c,f,p){return jn(f,c)?f:ba.current!==null?(a=dp(a,f,p),jn(a,c)||(Jt=!0),a):(Ei&42)===0?(Jt=!0,a.memoizedState=f):(a=VT(),Ue.lanes|=a,Ii|=a,c)}function zw(a,c,f,p,v){var b=te.p;te.p=b!==0&&8>b?b:8;var N=z.T,L={};z.T=L,gp(a,!1,c,f);try{var G=v(),ue=z.S;if(ue!==null&&ue(L,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ge=dj(G,p);Qo(a,c,ge,zn(a))}else Qo(a,c,p,zn(a))}catch(ve){Qo(a,c,{then:function(){},status:"rejected",reason:ve},zn())}finally{te.p=b,z.T=N}}function _j(){}function hp(a,c,f,p){if(a.tag!==5)throw Error(r(476));var v=Vw(a).queue;zw(a,v,c,fe,f===null?_j:function(){return qw(a),f(p)})}function Vw(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:fe},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function qw(a){var c=Vw(a).next.queue;Qo(a,c,{},zn())}function pp(){return hn(ml)}function $w(){return Ft().memoizedState}function Hw(){return Ft().memoizedState}function vj(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=zn();a=Ti(f);var p=Si(c,a,f);p!==null&&(Vn(p,c,f),Wo(p,c,f)),c={cache:$h()},a.payload=c;return}c=c.return}}function yj(a,c,f){var p=zn();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},au(a)?Xw(c,f):(f=Ph(a,c,f,p),f!==null&&(Vn(f,a,p),Yw(f,c,p)))}function Ww(a,c,f){var p=zn();Qo(a,c,f,p)}function Qo(a,c,f,p){var v={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(au(a))Xw(c,v);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=c.lastRenderedReducer,b!==null))try{var N=c.lastRenderedState,L=b(N,f);if(v.hasEagerState=!0,v.eagerState=L,jn(L,N))return qc(a,c,v,0),pt===null&&Vc(),!1}catch{}finally{}if(f=Ph(a,c,v,p),f!==null)return Vn(f,a,p),Yw(f,c,p),!0}return!1}function gp(a,c,f,p){if(p={lane:2,revertLane:Xp(),action:p,hasEagerState:!1,eagerState:null,next:null},au(a)){if(c)throw Error(r(479))}else c=Ph(a,f,p,2),c!==null&&Vn(c,a,2)}function au(a){var c=a.alternate;return a===Ue||c!==null&&c===Ue}function Xw(a,c){xa=eu=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function Yw(a,c,f){if((f&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,n2(a,f)}}var ou={readContext:hn,use:nu,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useInsertionEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useSyncExternalStore:Ot,useId:Ot,useHostTransitionStatus:Ot,useFormState:Ot,useActionState:Ot,useOptimistic:Ot,useMemoCache:Ot,useCacheRefresh:Ot},Gw={readContext:hn,use:nu,useCallback:function(a,c){return Mn().memoizedState=[a,c===void 0?null:c],a},useContext:hn,useEffect:Iw,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,su(4194308,4,jw.bind(null,c,a),f)},useLayoutEffect:function(a,c){return su(4194308,4,a,c)},useInsertionEffect:function(a,c){su(4,2,a,c)},useMemo:function(a,c){var f=Mn();c=c===void 0?null:c;var p=a();if(vs){Ye(!0);try{a()}finally{Ye(!1)}}return f.memoizedState=[p,c],p},useReducer:function(a,c,f){var p=Mn();if(f!==void 0){var v=f(c);if(vs){Ye(!0);try{f(c)}finally{Ye(!1)}}}else v=c;return p.memoizedState=p.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},p.queue=a,a=a.dispatch=yj.bind(null,Ue,a),[p.memoizedState,a]},useRef:function(a){var c=Mn();return a={current:a},c.memoizedState=a},useState:function(a){a=cp(a);var c=a.queue,f=Ww.bind(null,Ue,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:fp,useDeferredValue:function(a,c){var f=Mn();return dp(f,a,c)},useTransition:function(){var a=cp(!1);return a=zw.bind(null,Ue,a.queue,!0,!1),Mn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var p=Ue,v=Mn();if(Ge){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),pt===null)throw Error(r(349));(He&124)!==0||mw(p,c,f)}v.memoizedState=f;var b={value:f,getSnapshot:c};return v.queue=b,Iw(vw.bind(null,p,b,a),[a]),p.flags|=2048,Ta(9,iu(),_w.bind(null,p,b,f,c),null),f},useId:function(){var a=Mn(),c=pt.identifierPrefix;if(Ge){var f=Qr,p=Zr;f=(p&~(1<<32-_t(p)-1)).toString(32)+f,c="«"+c+"R"+f,f=tu++,0<f&&(c+="H"+f.toString(32)),c+="»"}else f=hj++,c="«"+c+"r"+f.toString(32)+"»";return a.memoizedState=c},useHostTransitionStatus:pp,useFormState:Rw,useActionState:Rw,useOptimistic:function(a){var c=Mn();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=gp.bind(null,Ue,!0,f),f.dispatch=c,[a,c]},useMemoCache:ap,useCacheRefresh:function(){return Mn().memoizedState=vj.bind(null,Ue)}},Kw={readContext:hn,use:nu,useCallback:Bw,useContext:hn,useEffect:Ow,useImperativeHandle:Lw,useInsertionEffect:Pw,useLayoutEffect:Dw,useMemo:Uw,useReducer:ru,useRef:Mw,useState:function(){return ru(ti)},useDebugValue:fp,useDeferredValue:function(a,c){var f=Ft();return Fw(f,it.memoizedState,a,c)},useTransition:function(){var a=ru(ti)[0],c=Ft().memoizedState;return[typeof a=="boolean"?a:Ko(a),c]},useSyncExternalStore:gw,useId:$w,useHostTransitionStatus:pp,useFormState:Cw,useActionState:Cw,useOptimistic:function(a,c){var f=Ft();return xw(f,it,a,c)},useMemoCache:ap,useCacheRefresh:Hw},bj={readContext:hn,use:nu,useCallback:Bw,useContext:hn,useEffect:Ow,useImperativeHandle:Lw,useInsertionEffect:Pw,useLayoutEffect:Dw,useMemo:Uw,useReducer:lp,useRef:Mw,useState:function(){return lp(ti)},useDebugValue:fp,useDeferredValue:function(a,c){var f=Ft();return it===null?dp(f,a,c):Fw(f,it.memoizedState,a,c)},useTransition:function(){var a=lp(ti)[0],c=Ft().memoizedState;return[typeof a=="boolean"?a:Ko(a),c]},useSyncExternalStore:gw,useId:$w,useHostTransitionStatus:pp,useFormState:kw,useActionState:kw,useOptimistic:function(a,c){var f=Ft();return it!==null?xw(f,it,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:ap,useCacheRefresh:Hw},Sa=null,Jo=0;function lu(a){var c=Jo;return Jo+=1,Sa===null&&(Sa=[]),ow(Sa,a,c)}function el(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function cu(a,c){throw c.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function Zw(a){var c=a._init;return c(a._payload)}function Qw(a){function c(ae,J){if(a){var ce=ae.deletions;ce===null?(ae.deletions=[J],ae.flags|=16):ce.push(J)}}function f(ae,J){if(!a)return null;for(;J!==null;)c(ae,J),J=J.sibling;return null}function p(ae){for(var J=new Map;ae!==null;)ae.key!==null?J.set(ae.key,ae):J.set(ae.index,ae),ae=ae.sibling;return J}function v(ae,J){return ae=Kr(ae,J),ae.index=0,ae.sibling=null,ae}function b(ae,J,ce){return ae.index=ce,a?(ce=ae.alternate,ce!==null?(ce=ce.index,ce<J?(ae.flags|=67108866,J):ce):(ae.flags|=67108866,J)):(ae.flags|=1048576,J)}function N(ae){return a&&ae.alternate===null&&(ae.flags|=67108866),ae}function L(ae,J,ce,me){return J===null||J.tag!==6?(J=jh(ce,ae.mode,me),J.return=ae,J):(J=v(J,ce),J.return=ae,J)}function G(ae,J,ce,me){var Ae=ce.type;return Ae===T?ge(ae,J,ce.props.children,me,ce.key):J!==null&&(J.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===M&&Zw(Ae)===J.type)?(J=v(J,ce.props),el(J,ce),J.return=ae,J):(J=Hc(ce.type,ce.key,ce.props,null,ae.mode,me),el(J,ce),J.return=ae,J)}function ue(ae,J,ce,me){return J===null||J.tag!==4||J.stateNode.containerInfo!==ce.containerInfo||J.stateNode.implementation!==ce.implementation?(J=Lh(ce,ae.mode,me),J.return=ae,J):(J=v(J,ce.children||[]),J.return=ae,J)}function ge(ae,J,ce,me,Ae){return J===null||J.tag!==7?(J=us(ce,ae.mode,me,Ae),J.return=ae,J):(J=v(J,ce),J.return=ae,J)}function ve(ae,J,ce){if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return J=jh(""+J,ae.mode,ce),J.return=ae,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case _:return ce=Hc(J.type,J.key,J.props,null,ae.mode,ce),el(ce,J),ce.return=ae,ce;case y:return J=Lh(J,ae.mode,ce),J.return=ae,J;case M:var me=J._init;return J=me(J._payload),ve(ae,J,ce)}if(H(J)||X(J))return J=us(J,ae.mode,ce,null),J.return=ae,J;if(typeof J.then=="function")return ve(ae,lu(J),ce);if(J.$$typeof===R)return ve(ae,Gc(ae,J),ce);cu(ae,J)}return null}function de(ae,J,ce,me){var Ae=J!==null?J.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ae!==null?null:L(ae,J,""+ce,me);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:return ce.key===Ae?G(ae,J,ce,me):null;case y:return ce.key===Ae?ue(ae,J,ce,me):null;case M:return Ae=ce._init,ce=Ae(ce._payload),de(ae,J,ce,me)}if(H(ce)||X(ce))return Ae!==null?null:ge(ae,J,ce,me,null);if(typeof ce.then=="function")return de(ae,J,lu(ce),me);if(ce.$$typeof===R)return de(ae,J,Gc(ae,ce),me);cu(ae,ce)}return null}function he(ae,J,ce,me,Ae){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return ae=ae.get(ce)||null,L(J,ae,""+me,Ae);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return ae=ae.get(me.key===null?ce:me.key)||null,G(J,ae,me,Ae);case y:return ae=ae.get(me.key===null?ce:me.key)||null,ue(J,ae,me,Ae);case M:var Fe=me._init;return me=Fe(me._payload),he(ae,J,ce,me,Ae)}if(H(me)||X(me))return ae=ae.get(ce)||null,ge(J,ae,me,Ae,null);if(typeof me.then=="function")return he(ae,J,ce,lu(me),Ae);if(me.$$typeof===R)return he(ae,J,ce,Gc(J,me),Ae);cu(J,me)}return null}function Pe(ae,J,ce,me){for(var Ae=null,Fe=null,Ce=J,Me=J=0,tn=null;Ce!==null&&Me<ce.length;Me++){Ce.index>Me?(tn=Ce,Ce=null):tn=Ce.sibling;var Xe=de(ae,Ce,ce[Me],me);if(Xe===null){Ce===null&&(Ce=tn);break}a&&Ce&&Xe.alternate===null&&c(ae,Ce),J=b(Xe,J,Me),Fe===null?Ae=Xe:Fe.sibling=Xe,Fe=Xe,Ce=tn}if(Me===ce.length)return f(ae,Ce),Ge&&ds(ae,Me),Ae;if(Ce===null){for(;Me<ce.length;Me++)Ce=ve(ae,ce[Me],me),Ce!==null&&(J=b(Ce,J,Me),Fe===null?Ae=Ce:Fe.sibling=Ce,Fe=Ce);return Ge&&ds(ae,Me),Ae}for(Ce=p(Ce);Me<ce.length;Me++)tn=he(Ce,ae,Me,ce[Me],me),tn!==null&&(a&&tn.alternate!==null&&Ce.delete(tn.key===null?Me:tn.key),J=b(tn,J,Me),Fe===null?Ae=tn:Fe.sibling=tn,Fe=tn);return a&&Ce.forEach(function(zi){return c(ae,zi)}),Ge&&ds(ae,Me),Ae}function ke(ae,J,ce,me){if(ce==null)throw Error(r(151));for(var Ae=null,Fe=null,Ce=J,Me=J=0,tn=null,Xe=ce.next();Ce!==null&&!Xe.done;Me++,Xe=ce.next()){Ce.index>Me?(tn=Ce,Ce=null):tn=Ce.sibling;var zi=de(ae,Ce,Xe.value,me);if(zi===null){Ce===null&&(Ce=tn);break}a&&Ce&&zi.alternate===null&&c(ae,Ce),J=b(zi,J,Me),Fe===null?Ae=zi:Fe.sibling=zi,Fe=zi,Ce=tn}if(Xe.done)return f(ae,Ce),Ge&&ds(ae,Me),Ae;if(Ce===null){for(;!Xe.done;Me++,Xe=ce.next())Xe=ve(ae,Xe.value,me),Xe!==null&&(J=b(Xe,J,Me),Fe===null?Ae=Xe:Fe.sibling=Xe,Fe=Xe);return Ge&&ds(ae,Me),Ae}for(Ce=p(Ce);!Xe.done;Me++,Xe=ce.next())Xe=he(Ce,ae,Me,Xe.value,me),Xe!==null&&(a&&Xe.alternate!==null&&Ce.delete(Xe.key===null?Me:Xe.key),J=b(Xe,J,Me),Fe===null?Ae=Xe:Fe.sibling=Xe,Fe=Xe);return a&&Ce.forEach(function(xL){return c(ae,xL)}),Ge&&ds(ae,Me),Ae}function at(ae,J,ce,me){if(typeof ce=="object"&&ce!==null&&ce.type===T&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:e:{for(var Ae=ce.key;J!==null;){if(J.key===Ae){if(Ae=ce.type,Ae===T){if(J.tag===7){f(ae,J.sibling),me=v(J,ce.props.children),me.return=ae,ae=me;break e}}else if(J.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===M&&Zw(Ae)===J.type){f(ae,J.sibling),me=v(J,ce.props),el(me,ce),me.return=ae,ae=me;break e}f(ae,J);break}else c(ae,J);J=J.sibling}ce.type===T?(me=us(ce.props.children,ae.mode,me,ce.key),me.return=ae,ae=me):(me=Hc(ce.type,ce.key,ce.props,null,ae.mode,me),el(me,ce),me.return=ae,ae=me)}return N(ae);case y:e:{for(Ae=ce.key;J!==null;){if(J.key===Ae)if(J.tag===4&&J.stateNode.containerInfo===ce.containerInfo&&J.stateNode.implementation===ce.implementation){f(ae,J.sibling),me=v(J,ce.children||[]),me.return=ae,ae=me;break e}else{f(ae,J);break}else c(ae,J);J=J.sibling}me=Lh(ce,ae.mode,me),me.return=ae,ae=me}return N(ae);case M:return Ae=ce._init,ce=Ae(ce._payload),at(ae,J,ce,me)}if(H(ce))return Pe(ae,J,ce,me);if(X(ce)){if(Ae=X(ce),typeof Ae!="function")throw Error(r(150));return ce=Ae.call(ce),ke(ae,J,ce,me)}if(typeof ce.then=="function")return at(ae,J,lu(ce),me);if(ce.$$typeof===R)return at(ae,J,Gc(ae,ce),me);cu(ae,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,J!==null&&J.tag===6?(f(ae,J.sibling),me=v(J,ce),me.return=ae,ae=me):(f(ae,J),me=jh(ce,ae.mode,me),me.return=ae,ae=me),N(ae)):f(ae,J)}return function(ae,J,ce,me){try{Jo=0;var Ae=at(ae,J,ce,me);return Sa=null,Ae}catch(Ce){if(Ce===$o||Ce===Zc)throw Ce;var Fe=Ln(29,Ce,null,ae.mode);return Fe.lanes=me,Fe.return=ae,Fe}finally{}}}var Ea=Qw(!0),Jw=Qw(!1),rr=q(null),Or=null;function Ai(a){var c=a.alternate;se(Yt,Yt.current&1),se(rr,a),Or===null&&(c===null||ba.current!==null||c.memoizedState!==null)&&(Or=a)}function eT(a){if(a.tag===22){if(se(Yt,Yt.current),se(rr,a),Or===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Or=a)}}else Ri()}function Ri(){se(Yt,Yt.current),se(rr,rr.current)}function ni(a){ee(rr),Or===a&&(Or=null),ee(Yt)}var Yt=q(0);function uu(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||sg(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function mp(a,c,f,p){c=a.memoizedState,f=f(p,c),f=f==null?c:h({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var _p={enqueueSetState:function(a,c,f){a=a._reactInternals;var p=zn(),v=Ti(p);v.payload=c,f!=null&&(v.callback=f),c=Si(a,v,p),c!==null&&(Vn(c,a,p),Wo(c,a,p))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var p=zn(),v=Ti(p);v.tag=1,v.payload=c,f!=null&&(v.callback=f),c=Si(a,v,p),c!==null&&(Vn(c,a,p),Wo(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=zn(),p=Ti(f);p.tag=2,c!=null&&(p.callback=c),c=Si(a,p,f),c!==null&&(Vn(c,a,f),Wo(c,a,f))}};function tT(a,c,f,p,v,b,N){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,b,N):c.prototype&&c.prototype.isPureReactComponent?!jo(f,p)||!jo(v,b):!0}function nT(a,c,f,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==a&&_p.enqueueReplaceState(c,c.state,null)}function ys(a,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(a=a.defaultProps){f===c&&(f=h({},f));for(var v in a)f[v]===void 0&&(f[v]=a[v])}return f}var fu=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function rT(a){fu(a)}function iT(a){console.error(a)}function sT(a){fu(a)}function du(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function aT(a,c,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function vp(a,c,f){return f=Ti(f),f.tag=3,f.payload={element:null},f.callback=function(){du(a,c)},f}function oT(a){return a=Ti(a),a.tag=3,a}function lT(a,c,f,p){var v=f.type.getDerivedStateFromError;if(typeof v=="function"){var b=p.value;a.payload=function(){return v(b)},a.callback=function(){aT(c,f,p)}}var N=f.stateNode;N!==null&&typeof N.componentDidCatch=="function"&&(a.callback=function(){aT(c,f,p),typeof v!="function"&&(Oi===null?Oi=new Set([this]):Oi.add(this));var L=p.stack;this.componentDidCatch(p.value,{componentStack:L!==null?L:""})})}function xj(a,c,f,p,v){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&zo(c,f,v,!0),f=rr.current,f!==null){switch(f.tag){case 13:return Or===null?Vp():f.alternate===null&&Ct===0&&(Ct=3),f.flags&=-257,f.flags|=65536,f.lanes=v,p===Xh?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),$p(a,p,v)),!1;case 22:return f.flags|=65536,p===Xh?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),$p(a,p,v)),!1}throw Error(r(435,f.tag))}return $p(a,p,v),Vp(),!1}if(Ge)return c=rr.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,p!==Fh&&(a=Error(r(422),{cause:p}),Fo(Jn(a,f)))):(p!==Fh&&(c=Error(r(423),{cause:p}),Fo(Jn(c,f))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,p=Jn(p,f),v=vp(a.stateNode,p,v),Kh(a,v),Ct!==4&&(Ct=2)),!1;var b=Error(r(520),{cause:p});if(b=Jn(b,f),ol===null?ol=[b]:ol.push(b),Ct!==4&&(Ct=2),c===null)return!0;p=Jn(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=v&-v,f.lanes|=a,a=vp(f.stateNode,p,a),Kh(f,a),!1;case 1:if(c=f.type,b=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Oi===null||!Oi.has(b))))return f.flags|=65536,v&=-v,f.lanes|=v,v=oT(v),lT(v,a,f,p),Kh(f,v),!1}f=f.return}while(f!==null);return!1}var cT=Error(r(461)),Jt=!1;function rn(a,c,f,p){c.child=a===null?Jw(c,null,f,p):Ea(c,a.child,f,p)}function uT(a,c,f,p,v){f=f.render;var b=c.ref;if("ref"in p){var N={};for(var L in p)L!=="ref"&&(N[L]=p[L])}else N=p;return ms(c),p=tp(a,c,f,N,b,v),L=np(),a!==null&&!Jt?(rp(a,c,v),ri(a,c,v)):(Ge&&L&&Bh(c),c.flags|=1,rn(a,c,p,v),c.child)}function fT(a,c,f,p,v){if(a===null){var b=f.type;return typeof b=="function"&&!Dh(b)&&b.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=b,dT(a,c,b,p,v)):(a=Hc(f.type,null,p,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(b=a.child,!Ap(a,v)){var N=b.memoizedProps;if(f=f.compare,f=f!==null?f:jo,f(N,p)&&a.ref===c.ref)return ri(a,c,v)}return c.flags|=1,a=Kr(b,p),a.ref=c.ref,a.return=c,c.child=a}function dT(a,c,f,p,v){if(a!==null){var b=a.memoizedProps;if(jo(b,p)&&a.ref===c.ref)if(Jt=!1,c.pendingProps=p=b,Ap(a,v))(a.flags&131072)!==0&&(Jt=!0);else return c.lanes=a.lanes,ri(a,c,v)}return yp(a,c,f,p,v)}function hT(a,c,f){var p=c.pendingProps,v=p.children,b=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=b!==null?b.baseLanes|f:f,a!==null){for(v=c.child=a.child,b=0;v!==null;)b=b|v.lanes|v.childLanes,v=v.sibling;c.childLanes=b&~p}else c.childLanes=0,c.child=null;return pT(a,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&Kc(c,b!==null?b.cachePool:null),b!==null?dw(c,b):Qh(),eT(c);else return c.lanes=c.childLanes=536870912,pT(a,c,b!==null?b.baseLanes|f:f,f)}else b!==null?(Kc(c,b.cachePool),dw(c,b),Ri(),c.memoizedState=null):(a!==null&&Kc(c,null),Qh(),Ri());return rn(a,c,v,f),c.child}function pT(a,c,f,p){var v=Wh();return v=v===null?null:{parent:Xt._currentValue,pool:v},c.memoizedState={baseLanes:f,cachePool:v},a!==null&&Kc(c,null),Qh(),eT(c),a!==null&&zo(a,c,p,!0),null}function hu(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function yp(a,c,f,p,v){return ms(c),f=tp(a,c,f,p,void 0,v),p=np(),a!==null&&!Jt?(rp(a,c,v),ri(a,c,v)):(Ge&&p&&Bh(c),c.flags|=1,rn(a,c,f,v),c.child)}function gT(a,c,f,p,v,b){return ms(c),c.updateQueue=null,f=pw(c,p,f,v),hw(a),p=np(),a!==null&&!Jt?(rp(a,c,b),ri(a,c,b)):(Ge&&p&&Bh(c),c.flags|=1,rn(a,c,f,b),c.child)}function mT(a,c,f,p,v){if(ms(c),c.stateNode===null){var b=ga,N=f.contextType;typeof N=="object"&&N!==null&&(b=hn(N)),b=new f(p,b),c.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=_p,c.stateNode=b,b._reactInternals=c,b=c.stateNode,b.props=p,b.state=c.memoizedState,b.refs={},Yh(c),N=f.contextType,b.context=typeof N=="object"&&N!==null?hn(N):ga,b.state=c.memoizedState,N=f.getDerivedStateFromProps,typeof N=="function"&&(mp(c,f,N,p),b.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(N=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),N!==b.state&&_p.enqueueReplaceState(b,b.state,null),Yo(c,p,b,v),Xo(),b.state=c.memoizedState),typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){b=c.stateNode;var L=c.memoizedProps,G=ys(f,L);b.props=G;var ue=b.context,ge=f.contextType;N=ga,typeof ge=="object"&&ge!==null&&(N=hn(ge));var ve=f.getDerivedStateFromProps;ge=typeof ve=="function"||typeof b.getSnapshotBeforeUpdate=="function",L=c.pendingProps!==L,ge||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(L||ue!==N)&&nT(c,b,p,N),wi=!1;var de=c.memoizedState;b.state=de,Yo(c,p,b,v),Xo(),ue=c.memoizedState,L||de!==ue||wi?(typeof ve=="function"&&(mp(c,f,ve,p),ue=c.memoizedState),(G=wi||tT(c,f,G,p,de,ue,N))?(ge||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(c.flags|=4194308)):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=ue),b.props=p,b.state=ue,b.context=N,p=G):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{b=c.stateNode,Gh(a,c),N=c.memoizedProps,ge=ys(f,N),b.props=ge,ve=c.pendingProps,de=b.context,ue=f.contextType,G=ga,typeof ue=="object"&&ue!==null&&(G=hn(ue)),L=f.getDerivedStateFromProps,(ue=typeof L=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(N!==ve||de!==G)&&nT(c,b,p,G),wi=!1,de=c.memoizedState,b.state=de,Yo(c,p,b,v),Xo();var he=c.memoizedState;N!==ve||de!==he||wi||a!==null&&a.dependencies!==null&&Yc(a.dependencies)?(typeof L=="function"&&(mp(c,f,L,p),he=c.memoizedState),(ge=wi||tT(c,f,ge,p,de,he,G)||a!==null&&a.dependencies!==null&&Yc(a.dependencies))?(ue||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(p,he,G),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(p,he,G)),typeof b.componentDidUpdate=="function"&&(c.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof b.componentDidUpdate!="function"||N===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||N===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=he),b.props=p,b.state=he,b.context=G,p=ge):(typeof b.componentDidUpdate!="function"||N===a.memoizedProps&&de===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||N===a.memoizedProps&&de===a.memoizedState||(c.flags|=1024),p=!1)}return b=p,hu(a,c),p=(c.flags&128)!==0,b||p?(b=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:b.render(),c.flags|=1,a!==null&&p?(c.child=Ea(c,a.child,null,v),c.child=Ea(c,null,f,v)):rn(a,c,f,v),c.memoizedState=b.state,a=c.child):a=ri(a,c,v),a}function _T(a,c,f,p){return Uo(),c.flags|=256,rn(a,c,f,p),c.child}var bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xp(a){return{baseLanes:a,cachePool:iw()}}function wp(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=ir),a}function vT(a,c,f){var p=c.pendingProps,v=!1,b=(c.flags&128)!==0,N;if((N=b)||(N=a!==null&&a.memoizedState===null?!1:(Yt.current&2)!==0),N&&(v=!0,c.flags&=-129),N=(c.flags&32)!==0,c.flags&=-33,a===null){if(Ge){if(v?Ai(c):Ri(),Ge){var L=Rt,G;if(G=L){e:{for(G=L,L=Ir;G.nodeType!==8;){if(!L){L=null;break e}if(G=br(G.nextSibling),G===null){L=null;break e}}L=G}L!==null?(c.memoizedState={dehydrated:L,treeContext:fs!==null?{id:Zr,overflow:Qr}:null,retryLane:536870912,hydrationErrors:null},G=Ln(18,null,null,0),G.stateNode=L,G.return=c,c.child=G,bn=c,Rt=null,G=!0):G=!1}G||ps(c)}if(L=c.memoizedState,L!==null&&(L=L.dehydrated,L!==null))return sg(L)?c.lanes=32:c.lanes=536870912,null;ni(c)}return L=p.children,p=p.fallback,v?(Ri(),v=c.mode,L=pu({mode:"hidden",children:L},v),p=us(p,v,f,null),L.return=c,p.return=c,L.sibling=p,c.child=L,v=c.child,v.memoizedState=xp(f),v.childLanes=wp(a,N,f),c.memoizedState=bp,p):(Ai(c),Tp(c,L))}if(G=a.memoizedState,G!==null&&(L=G.dehydrated,L!==null)){if(b)c.flags&256?(Ai(c),c.flags&=-257,c=Sp(a,c,f)):c.memoizedState!==null?(Ri(),c.child=a.child,c.flags|=128,c=null):(Ri(),v=p.fallback,L=c.mode,p=pu({mode:"visible",children:p.children},L),v=us(v,L,f,null),v.flags|=2,p.return=c,v.return=c,p.sibling=v,c.child=p,Ea(c,a.child,null,f),p=c.child,p.memoizedState=xp(f),p.childLanes=wp(a,N,f),c.memoizedState=bp,c=v);else if(Ai(c),sg(L)){if(N=L.nextSibling&&L.nextSibling.dataset,N)var ue=N.dgst;N=ue,p=Error(r(419)),p.stack="",p.digest=N,Fo({value:p,source:null,stack:null}),c=Sp(a,c,f)}else if(Jt||zo(a,c,f,!1),N=(f&a.childLanes)!==0,Jt||N){if(N=pt,N!==null&&(p=f&-f,p=(p&42)!==0?1:ah(p),p=(p&(N.suspendedLanes|f))!==0?0:p,p!==0&&p!==G.retryLane))throw G.retryLane=p,pa(a,p),Vn(N,a,p),cT;L.data==="$?"||Vp(),c=Sp(a,c,f)}else L.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=G.treeContext,Rt=br(L.nextSibling),bn=c,Ge=!0,hs=null,Ir=!1,a!==null&&(tr[nr++]=Zr,tr[nr++]=Qr,tr[nr++]=fs,Zr=a.id,Qr=a.overflow,fs=c),c=Tp(c,p.children),c.flags|=4096);return c}return v?(Ri(),v=p.fallback,L=c.mode,G=a.child,ue=G.sibling,p=Kr(G,{mode:"hidden",children:p.children}),p.subtreeFlags=G.subtreeFlags&65011712,ue!==null?v=Kr(ue,v):(v=us(v,L,f,null),v.flags|=2),v.return=c,p.return=c,p.sibling=v,c.child=p,p=v,v=c.child,L=a.child.memoizedState,L===null?L=xp(f):(G=L.cachePool,G!==null?(ue=Xt._currentValue,G=G.parent!==ue?{parent:ue,pool:ue}:G):G=iw(),L={baseLanes:L.baseLanes|f,cachePool:G}),v.memoizedState=L,v.childLanes=wp(a,N,f),c.memoizedState=bp,p):(Ai(c),f=a.child,a=f.sibling,f=Kr(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,a!==null&&(N=c.deletions,N===null?(c.deletions=[a],c.flags|=16):N.push(a)),c.child=f,c.memoizedState=null,f)}function Tp(a,c){return c=pu({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function pu(a,c){return a=Ln(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Sp(a,c,f){return Ea(c,a.child,null,f),a=Tp(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function yT(a,c,f){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),Vh(a.return,c,f)}function Ep(a,c,f,p,v){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:v}:(b.isBackwards=c,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=f,b.tailMode=v)}function bT(a,c,f){var p=c.pendingProps,v=p.revealOrder,b=p.tail;if(rn(a,c,p.children,f),p=Yt.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&yT(a,f,c);else if(a.tag===19)yT(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(se(Yt,p),v){case"forwards":for(f=c.child,v=null;f!==null;)a=f.alternate,a!==null&&uu(a)===null&&(v=f),f=f.sibling;f=v,f===null?(v=c.child,c.child=null):(v=f.sibling,f.sibling=null),Ep(c,!1,v,f,b);break;case"backwards":for(f=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&uu(a)===null){c.child=v;break}a=v.sibling,v.sibling=f,f=v,v=a}Ep(c,!0,f,null,b);break;case"together":Ep(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ri(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Ii|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(zo(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=Kr(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=Kr(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Ap(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&Yc(a)))}function wj(a,c,f){switch(c.tag){case 3:ye(c,c.stateNode.containerInfo),xi(c,Xt,a.memoizedState.cache),Uo();break;case 27:case 5:Oe(c);break;case 4:ye(c,c.stateNode.containerInfo);break;case 10:xi(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(Ai(c),c.flags|=128,null):(f&c.child.childLanes)!==0?vT(a,c,f):(Ai(c),a=ri(a,c,f),a!==null?a.sibling:null);Ai(c);break;case 19:var v=(a.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(zo(a,c,f,!1),p=(f&c.childLanes)!==0),v){if(p)return bT(a,c,f);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),se(Yt,Yt.current),p)break;return null;case 22:case 23:return c.lanes=0,hT(a,c,f);case 24:xi(c,Xt,a.memoizedState.cache)}return ri(a,c,f)}function xT(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)Jt=!0;else{if(!Ap(a,f)&&(c.flags&128)===0)return Jt=!1,wj(a,c,f);Jt=(a.flags&131072)!==0}else Jt=!1,Ge&&(c.flags&1048576)!==0&&Z2(c,Xc,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var p=c.elementType,v=p._init;if(p=v(p._payload),c.type=p,typeof p=="function")Dh(p)?(a=ys(p,a),c.tag=1,c=mT(null,c,p,a,f)):(c.tag=0,c=yp(null,c,p,a,f));else{if(p!=null){if(v=p.$$typeof,v===E){c.tag=11,c=uT(null,c,p,a,f);break e}else if(v===D){c.tag=14,c=fT(null,c,p,a,f);break e}}throw c=$(p)||p,Error(r(306,c,""))}}return c;case 0:return yp(a,c,c.type,c.pendingProps,f);case 1:return p=c.type,v=ys(p,c.pendingProps),mT(a,c,p,v,f);case 3:e:{if(ye(c,c.stateNode.containerInfo),a===null)throw Error(r(387));p=c.pendingProps;var b=c.memoizedState;v=b.element,Gh(a,c),Yo(c,p,null,f);var N=c.memoizedState;if(p=N.cache,xi(c,Xt,p),p!==b.cache&&qh(c,[Xt],f,!0),Xo(),p=N.element,b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:N.cache},c.updateQueue.baseState=b,c.memoizedState=b,c.flags&256){c=_T(a,c,p,f);break e}else if(p!==v){v=Jn(Error(r(424)),c),Fo(v),c=_T(a,c,p,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Rt=br(a.firstChild),bn=c,Ge=!0,hs=null,Ir=!0,f=Jw(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(Uo(),p===v){c=ri(a,c,f);break e}rn(a,c,p,f)}c=c.child}return c;case 26:return hu(a,c),a===null?(f=E3(c.type,null,c.pendingProps,null))?c.memoizedState=f:Ge||(f=c.type,a=c.pendingProps,p=Cu(Q.current).createElement(f),p[dn]=c,p[Nn]=a,an(p,f,a),Qt(p),c.stateNode=p):c.memoizedState=E3(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Oe(c),a===null&&Ge&&(p=c.stateNode=w3(c.type,c.pendingProps,Q.current),bn=c,Ir=!0,v=Rt,ji(c.type)?(ag=v,Rt=br(p.firstChild)):Rt=v),rn(a,c,c.pendingProps.children,f),hu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Ge&&((v=p=Rt)&&(p=Kj(p,c.type,c.pendingProps,Ir),p!==null?(c.stateNode=p,bn=c,Rt=br(p.firstChild),Ir=!1,v=!0):v=!1),v||ps(c)),Oe(c),v=c.type,b=c.pendingProps,N=a!==null?a.memoizedProps:null,p=b.children,ng(v,b)?p=null:N!==null&&ng(v,N)&&(c.flags|=32),c.memoizedState!==null&&(v=tp(a,c,pj,null,null,f),ml._currentValue=v),hu(a,c),rn(a,c,p,f),c.child;case 6:return a===null&&Ge&&((a=f=Rt)&&(f=Zj(f,c.pendingProps,Ir),f!==null?(c.stateNode=f,bn=c,Rt=null,a=!0):a=!1),a||ps(c)),null;case 13:return vT(a,c,f);case 4:return ye(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=Ea(c,null,p,f):rn(a,c,p,f),c.child;case 11:return uT(a,c,c.type,c.pendingProps,f);case 7:return rn(a,c,c.pendingProps,f),c.child;case 8:return rn(a,c,c.pendingProps.children,f),c.child;case 12:return rn(a,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,xi(c,c.type,p.value),rn(a,c,p.children,f),c.child;case 9:return v=c.type._context,p=c.pendingProps.children,ms(c),v=hn(v),p=p(v),c.flags|=1,rn(a,c,p,f),c.child;case 14:return fT(a,c,c.type,c.pendingProps,f);case 15:return dT(a,c,c.type,c.pendingProps,f);case 19:return bT(a,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},a===null?(f=pu(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Kr(a.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return hT(a,c,f);case 24:return ms(c),p=hn(Xt),a===null?(v=Wh(),v===null&&(v=pt,b=$h(),v.pooledCache=b,b.refCount++,b!==null&&(v.pooledCacheLanes|=f),v=b),c.memoizedState={parent:p,cache:v},Yh(c),xi(c,Xt,v)):((a.lanes&f)!==0&&(Gh(a,c),Yo(c,null,null,f),Xo()),v=a.memoizedState,b=c.memoizedState,v.parent!==p?(v={parent:p,cache:p},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),xi(c,Xt,p)):(p=b.cache,xi(c,Xt,p),p!==v.cache&&qh(c,[Xt],f,!0))),rn(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function ii(a){a.flags|=4}function wT(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!k3(c)){if(c=rr.current,c!==null&&((He&4194048)===He?Or!==null:(He&62914560)!==He&&(He&536870912)===0||c!==Or))throw Ho=Xh,sw;a.flags|=8192}}function gu(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?St():536870912,a.lanes|=c,Na|=c)}function tl(a,c){if(!Ge)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function Et(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(c)for(var v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags&65011712,p|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=p,a.childLanes=f,c}function Tj(a,c,f){var p=c.pendingProps;switch(Uh(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(c),null;case 1:return Et(c),null;case 3:return f=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),ei(Xt),Ee(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Bo(c)?ii(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,ew())),Et(c),null;case 26:return f=c.memoizedState,a===null?(ii(c),f!==null?(Et(c),wT(c,f)):(Et(c),c.flags&=-16777217)):f?f!==a.memoizedState?(ii(c),Et(c),wT(c,f)):(Et(c),c.flags&=-16777217):(a.memoizedProps!==p&&ii(c),Et(c),c.flags&=-16777217),null;case 27:ze(c),f=Q.current;var v=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ii(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Et(c),null}a=B.current,Bo(c)?Q2(c):(a=w3(v,p,f),c.stateNode=a,ii(c))}return Et(c),null;case 5:if(ze(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&ii(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return Et(c),null}if(a=B.current,Bo(c))Q2(c);else{switch(v=Cu(Q.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?v.createElement("select",{is:p.is}):v.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?v.createElement(f,{is:p.is}):v.createElement(f)}}a[dn]=c,a[Nn]=p;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=a;e:switch(an(a,f,p),f){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&ii(c)}}return Et(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&ii(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(a=Q.current,Bo(c)){if(a=c.stateNode,f=c.memoizedProps,p=null,v=bn,v!==null)switch(v.tag){case 27:case 5:p=v.memoizedProps}a[dn]=c,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||g3(a.nodeValue,f)),a||ps(c)}else a=Cu(a).createTextNode(p),a[dn]=c,c.stateNode=a}return Et(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=Bo(c),p!==null&&p.dehydrated!==null){if(a===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[dn]=c}else Uo(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Et(c),v=!1}else v=ew(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(ni(c),c):(ni(c),null)}if(ni(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,a=a!==null&&a.memoizedState!==null,f){p=c.child,v=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(v=p.alternate.memoizedState.cachePool.pool);var b=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(b=p.memoizedState.cachePool.pool),b!==v&&(p.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),gu(c,c.updateQueue),Et(c),null;case 4:return Ee(),a===null&&Zp(c.stateNode.containerInfo),Et(c),null;case 10:return ei(c.type),Et(c),null;case 19:if(ee(Yt),v=c.memoizedState,v===null)return Et(c),null;if(p=(c.flags&128)!==0,b=v.rendering,b===null)if(p)tl(v,!1);else{if(Ct!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(b=uu(a),b!==null){for(c.flags|=128,tl(v,!1),a=b.updateQueue,c.updateQueue=a,gu(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)K2(f,a),f=f.sibling;return se(Yt,Yt.current&1|2),c.child}a=a.sibling}v.tail!==null&&Ne()>vu&&(c.flags|=128,p=!0,tl(v,!1),c.lanes=4194304)}else{if(!p)if(a=uu(b),a!==null){if(c.flags|=128,p=!0,a=a.updateQueue,c.updateQueue=a,gu(c,a),tl(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!Ge)return Et(c),null}else 2*Ne()-v.renderingStartTime>vu&&f!==536870912&&(c.flags|=128,p=!0,tl(v,!1),c.lanes=4194304);v.isBackwards?(b.sibling=c.child,c.child=b):(a=v.last,a!==null?a.sibling=b:c.child=b,v.last=b)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Ne(),c.sibling=null,a=Yt.current,se(Yt,p?a&1|2:a&1),c):(Et(c),null);case 22:case 23:return ni(c),Jh(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(Et(c),c.subtreeFlags&6&&(c.flags|=8192)):Et(c),f=c.updateQueue,f!==null&&gu(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),a!==null&&ee(_s),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),ei(Xt),Et(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function Sj(a,c){switch(Uh(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return ei(Xt),Ee(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return ze(c),null;case 13:if(ni(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));Uo()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return ee(Yt),null;case 4:return Ee(),null;case 10:return ei(c.type),null;case 22:case 23:return ni(c),Jh(),a!==null&&ee(_s),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return ei(Xt),null;case 25:return null;default:return null}}function TT(a,c){switch(Uh(c),c.tag){case 3:ei(Xt),Ee();break;case 26:case 27:case 5:ze(c);break;case 4:Ee();break;case 13:ni(c);break;case 19:ee(Yt);break;case 10:ei(c.type);break;case 22:case 23:ni(c),Jh(),a!==null&&ee(_s);break;case 24:ei(Xt)}}function nl(a,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var v=p.next;f=v;do{if((f.tag&a)===a){p=void 0;var b=f.create,N=f.inst;p=b(),N.destroy=p}f=f.next}while(f!==v)}}catch(L){ut(c,c.return,L)}}function Ci(a,c,f){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var b=v.next;p=b;do{if((p.tag&a)===a){var N=p.inst,L=N.destroy;if(L!==void 0){N.destroy=void 0,v=c;var G=f,ue=L;try{ue()}catch(ge){ut(v,G,ge)}}}p=p.next}while(p!==b)}}catch(ge){ut(c,c.return,ge)}}function ST(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{fw(c,f)}catch(p){ut(a,a.return,p)}}}function ET(a,c,f){f.props=ys(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){ut(a,c,p)}}function rl(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(v){ut(a,c,v)}}function Pr(a,c){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(v){ut(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(v){ut(a,c,v)}else f.current=null}function AT(a){var c=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(v){ut(a,a.return,v)}}function Rp(a,c,f){try{var p=a.stateNode;Hj(p,a.type,f,c),p[Nn]=c}catch(v){ut(a,a.return,v)}}function RT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&ji(a.type)||a.tag===4}function Cp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||RT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&ji(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Np(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Ru));else if(p!==4&&(p===27&&ji(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Np(a,c,f),a=a.sibling;a!==null;)Np(a,c,f),a=a.sibling}function mu(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(p!==4&&(p===27&&ji(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(mu(a,c,f),a=a.sibling;a!==null;)mu(a,c,f),a=a.sibling}function CT(a){var c=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);an(c,p,f),c[dn]=a,c[Nn]=f}catch(b){ut(a,a.return,b)}}var si=!1,Pt=!1,kp=!1,NT=typeof WeakSet=="function"?WeakSet:Set,en=null;function Ej(a,c){if(a=a.containerInfo,eg=Pu,a=F2(a),Ch(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var v=p.anchorOffset,b=p.focusNode;p=p.focusOffset;try{f.nodeType,b.nodeType}catch{f=null;break e}var N=0,L=-1,G=-1,ue=0,ge=0,ve=a,de=null;t:for(;;){for(var he;ve!==f||v!==0&&ve.nodeType!==3||(L=N+v),ve!==b||p!==0&&ve.nodeType!==3||(G=N+p),ve.nodeType===3&&(N+=ve.nodeValue.length),(he=ve.firstChild)!==null;)de=ve,ve=he;for(;;){if(ve===a)break t;if(de===f&&++ue===v&&(L=N),de===b&&++ge===p&&(G=N),(he=ve.nextSibling)!==null)break;ve=de,de=ve.parentNode}ve=he}f=L===-1||G===-1?null:{start:L,end:G}}else f=null}f=f||{start:0,end:0}}else f=null;for(tg={focusedElem:a,selectionRange:f},Pu=!1,en=c;en!==null;)if(c=en,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,en=a;else for(;en!==null;){switch(c=en,b=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,f=c,v=b.memoizedProps,b=b.memoizedState,p=f.stateNode;try{var Pe=ys(f.type,v,f.elementType===f.type);a=p.getSnapshotBeforeUpdate(Pe,b),p.__reactInternalSnapshotBeforeUpdate=a}catch(ke){ut(f,f.return,ke)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)ig(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":ig(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,en=a;break}en=c.return}}function kT(a,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:Ni(a,f),p&4&&nl(5,f);break;case 1:if(Ni(a,f),p&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(N){ut(f,f.return,N)}else{var v=ys(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(N){ut(f,f.return,N)}}p&64&&ST(f),p&512&&rl(f,f.return);break;case 3:if(Ni(a,f),p&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{fw(a,c)}catch(N){ut(f,f.return,N)}}break;case 27:c===null&&p&4&&CT(f);case 26:case 5:Ni(a,f),c===null&&p&4&&AT(f),p&512&&rl(f,f.return);break;case 12:Ni(a,f);break;case 13:Ni(a,f),p&4&&OT(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=Pj.bind(null,f),Qj(a,f))));break;case 22:if(p=f.memoizedState!==null||si,!p){c=c!==null&&c.memoizedState!==null||Pt,v=si;var b=Pt;si=p,(Pt=c)&&!b?ki(a,f,(f.subtreeFlags&8772)!==0):Ni(a,f),si=v,Pt=b}break;case 30:break;default:Ni(a,f)}}function MT(a){var c=a.alternate;c!==null&&(a.alternate=null,MT(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&ch(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var yt=null,In=!1;function ai(a,c,f){for(f=f.child;f!==null;)IT(a,c,f),f=f.sibling}function IT(a,c,f){if(Ve&&typeof Ve.onCommitFiberUnmount=="function")try{Ve.onCommitFiberUnmount(Qe,f)}catch{}switch(f.tag){case 26:Pt||Pr(f,c),ai(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Pt||Pr(f,c);var p=yt,v=In;ji(f.type)&&(yt=f.stateNode,In=!1),ai(a,c,f),dl(f.stateNode),yt=p,In=v;break;case 5:Pt||Pr(f,c);case 6:if(p=yt,v=In,yt=null,ai(a,c,f),yt=p,In=v,yt!==null)if(In)try{(yt.nodeType===9?yt.body:yt.nodeName==="HTML"?yt.ownerDocument.body:yt).removeChild(f.stateNode)}catch(b){ut(f,c,b)}else try{yt.removeChild(f.stateNode)}catch(b){ut(f,c,b)}break;case 18:yt!==null&&(In?(a=yt,b3(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),bl(a)):b3(yt,f.stateNode));break;case 4:p=yt,v=In,yt=f.stateNode.containerInfo,In=!0,ai(a,c,f),yt=p,In=v;break;case 0:case 11:case 14:case 15:Pt||Ci(2,f,c),Pt||Ci(4,f,c),ai(a,c,f);break;case 1:Pt||(Pr(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&ET(f,c,p)),ai(a,c,f);break;case 21:ai(a,c,f);break;case 22:Pt=(p=Pt)||f.memoizedState!==null,ai(a,c,f),Pt=p;break;default:ai(a,c,f)}}function OT(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{bl(a)}catch(f){ut(c,c.return,f)}}function Aj(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new NT),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new NT),c;default:throw Error(r(435,a.tag))}}function Mp(a,c){var f=Aj(a);c.forEach(function(p){var v=Dj.bind(null,a,p);f.has(p)||(f.add(p),p.then(v,v))})}function Bn(a,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var v=f[p],b=a,N=c,L=N;e:for(;L!==null;){switch(L.tag){case 27:if(ji(L.type)){yt=L.stateNode,In=!1;break e}break;case 5:yt=L.stateNode,In=!1;break e;case 3:case 4:yt=L.stateNode.containerInfo,In=!0;break e}L=L.return}if(yt===null)throw Error(r(160));IT(b,N,v),yt=null,In=!1,b=v.alternate,b!==null&&(b.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)PT(c,a),c=c.sibling}var yr=null;function PT(a,c){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Bn(c,a),Un(a),p&4&&(Ci(3,a,a.return),nl(3,a),Ci(5,a,a.return));break;case 1:Bn(c,a),Un(a),p&512&&(Pt||f===null||Pr(f,f.return)),p&64&&si&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var v=yr;if(Bn(c,a),Un(a),p&512&&(Pt||f===null||Pr(f,f.return)),p&4){var b=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,v=v.ownerDocument||v;t:switch(p){case"title":b=v.getElementsByTagName("title")[0],(!b||b[Ro]||b[dn]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=v.createElement(p),v.head.insertBefore(b,v.querySelector("head > title"))),an(b,p,f),b[dn]=a,Qt(b),p=b;break e;case"link":var N=C3("link","href",v).get(p+(f.href||""));if(N){for(var L=0;L<N.length;L++)if(b=N[L],b.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&b.getAttribute("rel")===(f.rel==null?null:f.rel)&&b.getAttribute("title")===(f.title==null?null:f.title)&&b.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){N.splice(L,1);break t}}b=v.createElement(p),an(b,p,f),v.head.appendChild(b);break;case"meta":if(N=C3("meta","content",v).get(p+(f.content||""))){for(L=0;L<N.length;L++)if(b=N[L],b.getAttribute("content")===(f.content==null?null:""+f.content)&&b.getAttribute("name")===(f.name==null?null:f.name)&&b.getAttribute("property")===(f.property==null?null:f.property)&&b.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&b.getAttribute("charset")===(f.charSet==null?null:f.charSet)){N.splice(L,1);break t}}b=v.createElement(p),an(b,p,f),v.head.appendChild(b);break;default:throw Error(r(468,p))}b[dn]=a,Qt(b),p=b}a.stateNode=p}else N3(v,a.type,a.stateNode);else a.stateNode=R3(v,p,a.memoizedProps);else b!==p?(b===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):b.count--,p===null?N3(v,a.type,a.stateNode):R3(v,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Rp(a,a.memoizedProps,f.memoizedProps)}break;case 27:Bn(c,a),Un(a),p&512&&(Pt||f===null||Pr(f,f.return)),f!==null&&p&4&&Rp(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Bn(c,a),Un(a),p&512&&(Pt||f===null||Pr(f,f.return)),a.flags&32){v=a.stateNode;try{oa(v,"")}catch(he){ut(a,a.return,he)}}p&4&&a.stateNode!=null&&(v=a.memoizedProps,Rp(a,v,f!==null?f.memoizedProps:v)),p&1024&&(kp=!0);break;case 6:if(Bn(c,a),Un(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(he){ut(a,a.return,he)}}break;case 3:if(Mu=null,v=yr,yr=Nu(c.containerInfo),Bn(c,a),yr=v,Un(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{bl(c.containerInfo)}catch(he){ut(a,a.return,he)}kp&&(kp=!1,DT(a));break;case 4:p=yr,yr=Nu(a.stateNode.containerInfo),Bn(c,a),Un(a),yr=p;break;case 12:Bn(c,a),Un(a);break;case 13:Bn(c,a),Un(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Lp=Ne()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Mp(a,p)));break;case 22:v=a.memoizedState!==null;var G=f!==null&&f.memoizedState!==null,ue=si,ge=Pt;if(si=ue||v,Pt=ge||G,Bn(c,a),Pt=ge,si=ue,Un(a),p&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(f===null||G||si||Pt||bs(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){G=f=c;try{if(b=G.stateNode,v)N=b.style,typeof N.setProperty=="function"?N.setProperty("display","none","important"):N.display="none";else{L=G.stateNode;var ve=G.memoizedProps.style,de=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;L.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(he){ut(G,G.return,he)}}}else if(c.tag===6){if(f===null){G=c;try{G.stateNode.nodeValue=v?"":G.memoizedProps}catch(he){ut(G,G.return,he)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,Mp(a,f))));break;case 19:Bn(c,a),Un(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Mp(a,p)));break;case 30:break;case 21:break;default:Bn(c,a),Un(a)}}function Un(a){var c=a.flags;if(c&2){try{for(var f,p=a.return;p!==null;){if(RT(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var v=f.stateNode,b=Cp(a);mu(a,b,v);break;case 5:var N=f.stateNode;f.flags&32&&(oa(N,""),f.flags&=-33);var L=Cp(a);mu(a,L,N);break;case 3:case 4:var G=f.stateNode.containerInfo,ue=Cp(a);Np(a,ue,G);break;default:throw Error(r(161))}}catch(ge){ut(a,a.return,ge)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function DT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;DT(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Ni(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)kT(a,c.alternate,c),c=c.sibling}function bs(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Ci(4,c,c.return),bs(c);break;case 1:Pr(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&ET(c,c.return,f),bs(c);break;case 27:dl(c.stateNode);case 26:case 5:Pr(c,c.return),bs(c);break;case 22:c.memoizedState===null&&bs(c);break;case 30:bs(c);break;default:bs(c)}a=a.sibling}}function ki(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,v=a,b=c,N=b.flags;switch(b.tag){case 0:case 11:case 15:ki(v,b,f),nl(4,b);break;case 1:if(ki(v,b,f),p=b,v=p.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(ue){ut(p,p.return,ue)}if(p=b,v=p.updateQueue,v!==null){var L=p.stateNode;try{var G=v.shared.hiddenCallbacks;if(G!==null)for(v.shared.hiddenCallbacks=null,v=0;v<G.length;v++)uw(G[v],L)}catch(ue){ut(p,p.return,ue)}}f&&N&64&&ST(b),rl(b,b.return);break;case 27:CT(b);case 26:case 5:ki(v,b,f),f&&p===null&&N&4&&AT(b),rl(b,b.return);break;case 12:ki(v,b,f);break;case 13:ki(v,b,f),f&&N&4&&OT(v,b);break;case 22:b.memoizedState===null&&ki(v,b,f),rl(b,b.return);break;case 30:break;default:ki(v,b,f)}c=c.sibling}}function Ip(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&Vo(f))}function Op(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Vo(a))}function Dr(a,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)jT(a,c,f,p),c=c.sibling}function jT(a,c,f,p){var v=c.flags;switch(c.tag){case 0:case 11:case 15:Dr(a,c,f,p),v&2048&&nl(9,c);break;case 1:Dr(a,c,f,p);break;case 3:Dr(a,c,f,p),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Vo(a)));break;case 12:if(v&2048){Dr(a,c,f,p),a=c.stateNode;try{var b=c.memoizedProps,N=b.id,L=b.onPostCommit;typeof L=="function"&&L(N,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(G){ut(c,c.return,G)}}else Dr(a,c,f,p);break;case 13:Dr(a,c,f,p);break;case 23:break;case 22:b=c.stateNode,N=c.alternate,c.memoizedState!==null?b._visibility&2?Dr(a,c,f,p):il(a,c):b._visibility&2?Dr(a,c,f,p):(b._visibility|=2,Aa(a,c,f,p,(c.subtreeFlags&10256)!==0)),v&2048&&Ip(N,c);break;case 24:Dr(a,c,f,p),v&2048&&Op(c.alternate,c);break;default:Dr(a,c,f,p)}}function Aa(a,c,f,p,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var b=a,N=c,L=f,G=p,ue=N.flags;switch(N.tag){case 0:case 11:case 15:Aa(b,N,L,G,v),nl(8,N);break;case 23:break;case 22:var ge=N.stateNode;N.memoizedState!==null?ge._visibility&2?Aa(b,N,L,G,v):il(b,N):(ge._visibility|=2,Aa(b,N,L,G,v)),v&&ue&2048&&Ip(N.alternate,N);break;case 24:Aa(b,N,L,G,v),v&&ue&2048&&Op(N.alternate,N);break;default:Aa(b,N,L,G,v)}c=c.sibling}}function il(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,p=c,v=p.flags;switch(p.tag){case 22:il(f,p),v&2048&&Ip(p.alternate,p);break;case 24:il(f,p),v&2048&&Op(p.alternate,p);break;default:il(f,p)}c=c.sibling}}var sl=8192;function Ra(a){if(a.subtreeFlags&sl)for(a=a.child;a!==null;)LT(a),a=a.sibling}function LT(a){switch(a.tag){case 26:Ra(a),a.flags&sl&&a.memoizedState!==null&&fL(yr,a.memoizedState,a.memoizedProps);break;case 5:Ra(a);break;case 3:case 4:var c=yr;yr=Nu(a.stateNode.containerInfo),Ra(a),yr=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=sl,sl=16777216,Ra(a),sl=c):Ra(a));break;default:Ra(a)}}function BT(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function al(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];en=p,FT(p,a)}BT(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)UT(a),a=a.sibling}function UT(a){switch(a.tag){case 0:case 11:case 15:al(a),a.flags&2048&&Ci(9,a,a.return);break;case 3:al(a);break;case 12:al(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,_u(a)):al(a);break;default:al(a)}}function _u(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];en=p,FT(p,a)}BT(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Ci(8,c,c.return),_u(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,_u(c));break;default:_u(c)}a=a.sibling}}function FT(a,c){for(;en!==null;){var f=en;switch(f.tag){case 0:case 11:case 15:Ci(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Vo(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,en=p;else e:for(f=a;en!==null;){p=en;var v=p.sibling,b=p.return;if(MT(p),p===f){en=null;break e}if(v!==null){v.return=b,en=v;break e}en=b}}}var Rj={getCacheForType:function(a){var c=hn(Xt),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},Cj=typeof WeakMap=="function"?WeakMap:Map,tt=0,pt=null,qe=null,He=0,nt=0,Fn=null,Mi=!1,Ca=!1,Pp=!1,oi=0,Ct=0,Ii=0,xs=0,Dp=0,ir=0,Na=0,ol=null,On=null,jp=!1,Lp=0,vu=1/0,yu=null,Oi=null,sn=0,Pi=null,ka=null,Ma=0,Bp=0,Up=null,zT=null,ll=0,Fp=null;function zn(){if((tt&2)!==0&&He!==0)return He&-He;if(z.T!==null){var a=va;return a!==0?a:Xp()}return r2()}function VT(){ir===0&&(ir=(He&536870912)===0||Ge?rt():536870912);var a=rr.current;return a!==null&&(a.flags|=32),ir}function Vn(a,c,f){(a===pt&&(nt===2||nt===9)||a.cancelPendingCommit!==null)&&(Ia(a,0),Di(a,He,ir,!1)),vt(a,f),((tt&2)===0||a!==pt)&&(a===pt&&((tt&2)===0&&(xs|=f),Ct===4&&Di(a,He,ir,!1)),jr(a))}function qT(a,c,f){if((tt&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&a.expiredLanes)===0||Kn(a,c),v=p?Mj(a,c):qp(a,c,!0),b=p;do{if(v===0){Ca&&!p&&Di(a,c,0,!1);break}else{if(f=a.current.alternate,b&&!Nj(f)){v=qp(a,c,!1),b=!1;continue}if(v===2){if(b=c,a.errorRecoveryDisabledLanes&b)var N=0;else N=a.pendingLanes&-536870913,N=N!==0?N:N&536870912?536870912:0;if(N!==0){c=N;e:{var L=a;v=ol;var G=L.current.memoizedState.isDehydrated;if(G&&(Ia(L,N).flags|=256),N=qp(L,N,!1),N!==2){if(Pp&&!G){L.errorRecoveryDisabledLanes|=b,xs|=b,v=4;break e}b=On,On=v,b!==null&&(On===null?On=b:On.push.apply(On,b))}v=N}if(b=!1,v!==2)continue}}if(v===1){Ia(a,0),Di(a,c,0,!0);break}e:{switch(p=a,b=v,b){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:Di(p,c,ir,!Mi);break e;case 2:On=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(v=Lp+300-Ne(),10<v)){if(Di(p,c,ir,!Mi),_r(p,0,!0)!==0)break e;p.timeoutHandle=v3($T.bind(null,p,f,On,yu,jp,c,ir,xs,Na,Mi,b,2,-0,0),v);break e}$T(p,f,On,yu,jp,c,ir,xs,Na,Mi,b,0,-0,0)}}break}while(!0);jr(a)}function $T(a,c,f,p,v,b,N,L,G,ue,ge,ve,de,he){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(gl={stylesheets:null,count:0,unsuspend:uL},LT(c),ve=dL(),ve!==null)){a.cancelPendingCommit=ve(ZT.bind(null,a,c,b,f,p,v,N,L,G,ge,1,de,he)),Di(a,b,N,!ue);return}ZT(a,c,b,f,p,v,N,L,G)}function Nj(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var v=f[p],b=v.getSnapshot;v=v.value;try{if(!jn(b(),v))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Di(a,c,f,p){c&=~Dp,c&=~xs,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var v=c;0<v;){var b=31-_t(v),N=1<<b;p[b]=-1,v&=~N}f!==0&&Ao(a,f,c)}function bu(){return(tt&6)===0?(cl(0),!1):!0}function zp(){if(qe!==null){if(nt===0)var a=qe.return;else a=qe,Jr=gs=null,ip(a),Sa=null,Jo=0,a=qe;for(;a!==null;)TT(a.alternate,a),a=a.return;qe=null}}function Ia(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,Xj(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),zp(),pt=a,qe=f=Kr(a.current,null),He=c,nt=0,Fn=null,Mi=!1,Ca=Kn(a,c),Pp=!1,Na=ir=Dp=xs=Ii=Ct=0,On=ol=null,jp=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var v=31-_t(p),b=1<<v;c|=a[v],p&=~b}return oi=c,Vc(),f}function HT(a,c){Ue=null,z.H=ou,c===$o||c===Zc?(c=lw(),nt=3):c===sw?(c=lw(),nt=4):nt=c===cT?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Fn=c,qe===null&&(Ct=1,du(a,Jn(c,a.current)))}function WT(){var a=z.H;return z.H=ou,a===null?ou:a}function XT(){var a=z.A;return z.A=Rj,a}function Vp(){Ct=4,Mi||(He&4194048)!==He&&rr.current!==null||(Ca=!0),(Ii&134217727)===0&&(xs&134217727)===0||pt===null||Di(pt,He,ir,!1)}function qp(a,c,f){var p=tt;tt|=2;var v=WT(),b=XT();(pt!==a||He!==c)&&(yu=null,Ia(a,c)),c=!1;var N=Ct;e:do try{if(nt!==0&&qe!==null){var L=qe,G=Fn;switch(nt){case 8:zp(),N=6;break e;case 3:case 2:case 9:case 6:rr.current===null&&(c=!0);var ue=nt;if(nt=0,Fn=null,Oa(a,L,G,ue),f&&Ca){N=0;break e}break;default:ue=nt,nt=0,Fn=null,Oa(a,L,G,ue)}}kj(),N=Ct;break}catch(ge){HT(a,ge)}while(!0);return c&&a.shellSuspendCounter++,Jr=gs=null,tt=p,z.H=v,z.A=b,qe===null&&(pt=null,He=0,Vc()),N}function kj(){for(;qe!==null;)YT(qe)}function Mj(a,c){var f=tt;tt|=2;var p=WT(),v=XT();pt!==a||He!==c?(yu=null,vu=Ne()+500,Ia(a,c)):Ca=Kn(a,c);e:do try{if(nt!==0&&qe!==null){c=qe;var b=Fn;t:switch(nt){case 1:nt=0,Fn=null,Oa(a,c,b,1);break;case 2:case 9:if(aw(b)){nt=0,Fn=null,GT(c);break}c=function(){nt!==2&&nt!==9||pt!==a||(nt=7),jr(a)},b.then(c,c);break e;case 3:nt=7;break e;case 4:nt=5;break e;case 7:aw(b)?(nt=0,Fn=null,GT(c)):(nt=0,Fn=null,Oa(a,c,b,7));break;case 5:var N=null;switch(qe.tag){case 26:N=qe.memoizedState;case 5:case 27:var L=qe;if(!N||k3(N)){nt=0,Fn=null;var G=L.sibling;if(G!==null)qe=G;else{var ue=L.return;ue!==null?(qe=ue,xu(ue)):qe=null}break t}}nt=0,Fn=null,Oa(a,c,b,5);break;case 6:nt=0,Fn=null,Oa(a,c,b,6);break;case 8:zp(),Ct=6;break e;default:throw Error(r(462))}}Ij();break}catch(ge){HT(a,ge)}while(!0);return Jr=gs=null,z.H=p,z.A=v,tt=f,qe!==null?0:(pt=null,He=0,Vc(),Ct)}function Ij(){for(;qe!==null&&!De();)YT(qe)}function YT(a){var c=xT(a.alternate,a,oi);a.memoizedProps=a.pendingProps,c===null?xu(a):qe=c}function GT(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=gT(f,c,c.pendingProps,c.type,void 0,He);break;case 11:c=gT(f,c,c.pendingProps,c.type.render,c.ref,He);break;case 5:ip(c);default:TT(f,c),c=qe=K2(c,oi),c=xT(f,c,oi)}a.memoizedProps=a.pendingProps,c===null?xu(a):qe=c}function Oa(a,c,f,p){Jr=gs=null,ip(c),Sa=null,Jo=0;var v=c.return;try{if(xj(a,v,c,f,He)){Ct=1,du(a,Jn(f,a.current)),qe=null;return}}catch(b){if(v!==null)throw qe=v,b;Ct=1,du(a,Jn(f,a.current)),qe=null;return}c.flags&32768?(Ge||p===1?a=!0:Ca||(He&536870912)!==0?a=!1:(Mi=a=!0,(p===2||p===9||p===3||p===6)&&(p=rr.current,p!==null&&p.tag===13&&(p.flags|=16384))),KT(c,a)):xu(c)}function xu(a){var c=a;do{if((c.flags&32768)!==0){KT(c,Mi);return}a=c.return;var f=Tj(c.alternate,c,oi);if(f!==null){qe=f;return}if(c=c.sibling,c!==null){qe=c;return}qe=c=a}while(c!==null);Ct===0&&(Ct=5)}function KT(a,c){do{var f=Sj(a.alternate,a);if(f!==null){f.flags&=32767,qe=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){qe=a;return}qe=a=f}while(a!==null);Ct=6,qe=null}function ZT(a,c,f,p,v,b,N,L,G){a.cancelPendingCommit=null;do wu();while(sn!==0);if((tt&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(b=c.lanes|c.childLanes,b|=Oh,Js(a,f,b,N,L,G),a===pt&&(qe=pt=null,He=0),ka=c,Pi=a,Ma=f,Bp=b,Up=v,zT=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,jj(jt,function(){return n3(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=z.T,z.T=null,v=te.p,te.p=2,N=tt,tt|=4;try{Ej(a,c,f)}finally{tt=N,te.p=v,z.T=p}}sn=1,QT(),JT(),e3()}}function QT(){if(sn===1){sn=0;var a=Pi,c=ka,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=z.T,z.T=null;var p=te.p;te.p=2;var v=tt;tt|=4;try{PT(c,a);var b=tg,N=F2(a.containerInfo),L=b.focusedElem,G=b.selectionRange;if(N!==L&&L&&L.ownerDocument&&U2(L.ownerDocument.documentElement,L)){if(G!==null&&Ch(L)){var ue=G.start,ge=G.end;if(ge===void 0&&(ge=ue),"selectionStart"in L)L.selectionStart=ue,L.selectionEnd=Math.min(ge,L.value.length);else{var ve=L.ownerDocument||document,de=ve&&ve.defaultView||window;if(de.getSelection){var he=de.getSelection(),Pe=L.textContent.length,ke=Math.min(G.start,Pe),at=G.end===void 0?ke:Math.min(G.end,Pe);!he.extend&&ke>at&&(N=at,at=ke,ke=N);var ae=B2(L,ke),J=B2(L,at);if(ae&&J&&(he.rangeCount!==1||he.anchorNode!==ae.node||he.anchorOffset!==ae.offset||he.focusNode!==J.node||he.focusOffset!==J.offset)){var ce=ve.createRange();ce.setStart(ae.node,ae.offset),he.removeAllRanges(),ke>at?(he.addRange(ce),he.extend(J.node,J.offset)):(ce.setEnd(J.node,J.offset),he.addRange(ce))}}}}for(ve=[],he=L;he=he.parentNode;)he.nodeType===1&&ve.push({element:he,left:he.scrollLeft,top:he.scrollTop});for(typeof L.focus=="function"&&L.focus(),L=0;L<ve.length;L++){var me=ve[L];me.element.scrollLeft=me.left,me.element.scrollTop=me.top}}Pu=!!eg,tg=eg=null}finally{tt=v,te.p=p,z.T=f}}a.current=c,sn=2}}function JT(){if(sn===2){sn=0;var a=Pi,c=ka,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=z.T,z.T=null;var p=te.p;te.p=2;var v=tt;tt|=4;try{kT(a,c.alternate,c)}finally{tt=v,te.p=p,z.T=f}}sn=3}}function e3(){if(sn===4||sn===3){sn=0,cn();var a=Pi,c=ka,f=Ma,p=zT;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?sn=5:(sn=0,ka=Pi=null,t3(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Oi=null),oh(f),c=c.stateNode,Ve&&typeof Ve.onCommitFiberRoot=="function")try{Ve.onCommitFiberRoot(Qe,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=z.T,v=te.p,te.p=2,z.T=null;try{for(var b=a.onRecoverableError,N=0;N<p.length;N++){var L=p[N];b(L.value,{componentStack:L.stack})}}finally{z.T=c,te.p=v}}(Ma&3)!==0&&wu(),jr(a),v=a.pendingLanes,(f&4194090)!==0&&(v&42)!==0?a===Fp?ll++:(ll=0,Fp=a):ll=0,cl(0)}}function t3(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Vo(c)))}function wu(a){return QT(),JT(),e3(),n3()}function n3(){if(sn!==5)return!1;var a=Pi,c=Bp;Bp=0;var f=oh(Ma),p=z.T,v=te.p;try{te.p=32>f?32:f,z.T=null,f=Up,Up=null;var b=Pi,N=Ma;if(sn=0,ka=Pi=null,Ma=0,(tt&6)!==0)throw Error(r(331));var L=tt;if(tt|=4,UT(b.current),jT(b,b.current,N,f),tt=L,cl(0,!1),Ve&&typeof Ve.onPostCommitFiberRoot=="function")try{Ve.onPostCommitFiberRoot(Qe,b)}catch{}return!0}finally{te.p=v,z.T=p,t3(a,c)}}function r3(a,c,f){c=Jn(f,c),c=vp(a.stateNode,c,2),a=Si(a,c,2),a!==null&&(vt(a,2),jr(a))}function ut(a,c,f){if(a.tag===3)r3(a,a,f);else for(;c!==null;){if(c.tag===3){r3(c,a,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Oi===null||!Oi.has(p))){a=Jn(f,a),f=oT(2),p=Si(c,f,2),p!==null&&(lT(f,p,c,a),vt(p,2),jr(p));break}}c=c.return}}function $p(a,c,f){var p=a.pingCache;if(p===null){p=a.pingCache=new Cj;var v=new Set;p.set(c,v)}else v=p.get(c),v===void 0&&(v=new Set,p.set(c,v));v.has(f)||(Pp=!0,v.add(f),a=Oj.bind(null,a,c,f),c.then(a,a))}function Oj(a,c,f){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,pt===a&&(He&f)===f&&(Ct===4||Ct===3&&(He&62914560)===He&&300>Ne()-Lp?(tt&2)===0&&Ia(a,0):Dp|=f,Na===He&&(Na=0)),jr(a)}function i3(a,c){c===0&&(c=St()),a=pa(a,c),a!==null&&(vt(a,c),jr(a))}function Pj(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),i3(a,f)}function Dj(a,c){var f=0;switch(a.tag){case 13:var p=a.stateNode,v=a.memoizedState;v!==null&&(f=v.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),i3(a,f)}function jj(a,c){return mt(a,c)}var Tu=null,Pa=null,Hp=!1,Su=!1,Wp=!1,ws=0;function jr(a){a!==Pa&&a.next===null&&(Pa===null?Tu=Pa=a:Pa=Pa.next=a),Su=!0,Hp||(Hp=!0,Bj())}function cl(a,c){if(!Wp&&Su){Wp=!0;do for(var f=!1,p=Tu;p!==null;){if(a!==0){var v=p.pendingLanes;if(v===0)var b=0;else{var N=p.suspendedLanes,L=p.pingedLanes;b=(1<<31-_t(42|a)+1)-1,b&=v&~(N&~L),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(f=!0,l3(p,b))}else b=He,b=_r(p,p===pt?b:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(b&3)===0||Kn(p,b)||(f=!0,l3(p,b));p=p.next}while(f);Wp=!1}}function Lj(){s3()}function s3(){Su=Hp=!1;var a=0;ws!==0&&(Wj()&&(a=ws),ws=0);for(var c=Ne(),f=null,p=Tu;p!==null;){var v=p.next,b=a3(p,c);b===0?(p.next=null,f===null?Tu=v:f.next=v,v===null&&(Pa=f)):(f=p,(a!==0||(b&3)!==0)&&(Su=!0)),p=v}cl(a)}function a3(a,c){for(var f=a.suspendedLanes,p=a.pingedLanes,v=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var N=31-_t(b),L=1<<N,G=v[N];G===-1?((L&f)===0||(L&p)!==0)&&(v[N]=we(L,c)):G<=c&&(a.expiredLanes|=L),b&=~L}if(c=pt,f=He,f=_r(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===c&&(nt===2||nt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&ct(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Kn(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(p!==null&&ct(p),oh(f)){case 2:case 8:f=Rn;break;case 32:f=jt;break;case 268435456:f=We;break;default:f=jt}return p=o3.bind(null,a),f=mt(f,p),a.callbackPriority=c,a.callbackNode=f,c}return p!==null&&p!==null&&ct(p),a.callbackPriority=2,a.callbackNode=null,2}function o3(a,c){if(sn!==0&&sn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(wu()&&a.callbackNode!==f)return null;var p=He;return p=_r(a,a===pt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(qT(a,p,c),a3(a,Ne()),a.callbackNode!=null&&a.callbackNode===f?o3.bind(null,a):null)}function l3(a,c){if(wu())return null;qT(a,c,!0)}function Bj(){Yj(function(){(tt&6)!==0?mt(Wt,Lj):s3()})}function Xp(){return ws===0&&(ws=rt()),ws}function c3(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Dc(""+a)}function u3(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function Uj(a,c,f,p,v){if(c==="submit"&&f&&f.stateNode===v){var b=c3((v[Nn]||null).action),N=p.submitter;N&&(c=(c=N[Nn]||null)?c3(c.formAction):N.getAttribute("formAction"),c!==null&&(b=c,N=null));var L=new Uc("action","action",null,p,v);a.push({event:L,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(ws!==0){var G=N?u3(v,N):new FormData(v);hp(f,{pending:!0,data:G,method:v.method,action:b},null,G)}}else typeof b=="function"&&(L.preventDefault(),G=N?u3(v,N):new FormData(v),hp(f,{pending:!0,data:G,method:v.method,action:b},b,G))},currentTarget:v}]})}}for(var Yp=0;Yp<Ih.length;Yp++){var Gp=Ih[Yp],Fj=Gp.toLowerCase(),zj=Gp[0].toUpperCase()+Gp.slice(1);vr(Fj,"on"+zj)}vr(q2,"onAnimationEnd"),vr($2,"onAnimationIteration"),vr(H2,"onAnimationStart"),vr("dblclick","onDoubleClick"),vr("focusin","onFocus"),vr("focusout","onBlur"),vr(ij,"onTransitionRun"),vr(sj,"onTransitionStart"),vr(aj,"onTransitionCancel"),vr(W2,"onTransitionEnd"),ia("onMouseEnter",["mouseout","mouseover"]),ia("onMouseLeave",["mouseout","mouseover"]),ia("onPointerEnter",["pointerout","pointerover"]),ia("onPointerLeave",["pointerout","pointerover"]),as("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),as("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),as("onBeforeInput",["compositionend","keypress","textInput","paste"]),as("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),as("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ul="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Vj=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ul));function f3(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],v=p.event;p=p.listeners;e:{var b=void 0;if(c)for(var N=p.length-1;0<=N;N--){var L=p[N],G=L.instance,ue=L.currentTarget;if(L=L.listener,G!==b&&v.isPropagationStopped())break e;b=L,v.currentTarget=ue;try{b(v)}catch(ge){fu(ge)}v.currentTarget=null,b=G}else for(N=0;N<p.length;N++){if(L=p[N],G=L.instance,ue=L.currentTarget,L=L.listener,G!==b&&v.isPropagationStopped())break e;b=L,v.currentTarget=ue;try{b(v)}catch(ge){fu(ge)}v.currentTarget=null,b=G}}}}function $e(a,c){var f=c[lh];f===void 0&&(f=c[lh]=new Set);var p=a+"__bubble";f.has(p)||(d3(c,a,2,!1),f.add(p))}function Kp(a,c,f){var p=0;c&&(p|=4),d3(f,a,p,c)}var Eu="_reactListening"+Math.random().toString(36).slice(2);function Zp(a){if(!a[Eu]){a[Eu]=!0,s2.forEach(function(f){f!=="selectionchange"&&(Vj.has(f)||Kp(f,!1,a),Kp(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Eu]||(c[Eu]=!0,Kp("selectionchange",!1,c))}}function d3(a,c,f,p){switch(j3(c)){case 2:var v=gL;break;case 8:v=mL;break;default:v=fg}f=v.bind(null,c,f,a),v=void 0,!yh||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),p?v!==void 0?a.addEventListener(c,f,{capture:!0,passive:v}):a.addEventListener(c,f,!0):v!==void 0?a.addEventListener(c,f,{passive:v}):a.addEventListener(c,f,!1)}function Qp(a,c,f,p,v){var b=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var N=p.tag;if(N===3||N===4){var L=p.stateNode.containerInfo;if(L===v)break;if(N===4)for(N=p.return;N!==null;){var G=N.tag;if((G===3||G===4)&&N.stateNode.containerInfo===v)return;N=N.return}for(;L!==null;){if(N=ta(L),N===null)return;if(G=N.tag,G===5||G===6||G===26||G===27){p=b=N;continue e}L=L.parentNode}}p=p.return}y2(function(){var ue=b,ge=_h(f),ve=[];e:{var de=X2.get(a);if(de!==void 0){var he=Uc,Pe=a;switch(a){case"keypress":if(Lc(f)===0)break e;case"keydown":case"keyup":he=j6;break;case"focusin":Pe="focus",he=Th;break;case"focusout":Pe="blur",he=Th;break;case"beforeblur":case"afterblur":he=Th;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=w2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=S6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=U6;break;case q2:case $2:case H2:he=R6;break;case W2:he=z6;break;case"scroll":case"scrollend":he=w6;break;case"wheel":he=q6;break;case"copy":case"cut":case"paste":he=N6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=S2;break;case"toggle":case"beforetoggle":he=H6}var ke=(c&4)!==0,at=!ke&&(a==="scroll"||a==="scrollend"),ae=ke?de!==null?de+"Capture":null:de;ke=[];for(var J=ue,ce;J!==null;){var me=J;if(ce=me.stateNode,me=me.tag,me!==5&&me!==26&&me!==27||ce===null||ae===null||(me=No(J,ae),me!=null&&ke.push(fl(J,me,ce))),at)break;J=J.return}0<ke.length&&(de=new he(de,Pe,null,f,ge),ve.push({event:de,listeners:ke}))}}if((c&7)===0){e:{if(de=a==="mouseover"||a==="pointerover",he=a==="mouseout"||a==="pointerout",de&&f!==mh&&(Pe=f.relatedTarget||f.fromElement)&&(ta(Pe)||Pe[ea]))break e;if((he||de)&&(de=ge.window===ge?ge:(de=ge.ownerDocument)?de.defaultView||de.parentWindow:window,he?(Pe=f.relatedTarget||f.toElement,he=ue,Pe=Pe?ta(Pe):null,Pe!==null&&(at=s(Pe),ke=Pe.tag,Pe!==at||ke!==5&&ke!==27&&ke!==6)&&(Pe=null)):(he=null,Pe=ue),he!==Pe)){if(ke=w2,me="onMouseLeave",ae="onMouseEnter",J="mouse",(a==="pointerout"||a==="pointerover")&&(ke=S2,me="onPointerLeave",ae="onPointerEnter",J="pointer"),at=he==null?de:Co(he),ce=Pe==null?de:Co(Pe),de=new ke(me,J+"leave",he,f,ge),de.target=at,de.relatedTarget=ce,me=null,ta(ge)===ue&&(ke=new ke(ae,J+"enter",Pe,f,ge),ke.target=ce,ke.relatedTarget=at,me=ke),at=me,he&&Pe)t:{for(ke=he,ae=Pe,J=0,ce=ke;ce;ce=Da(ce))J++;for(ce=0,me=ae;me;me=Da(me))ce++;for(;0<J-ce;)ke=Da(ke),J--;for(;0<ce-J;)ae=Da(ae),ce--;for(;J--;){if(ke===ae||ae!==null&&ke===ae.alternate)break t;ke=Da(ke),ae=Da(ae)}ke=null}else ke=null;he!==null&&h3(ve,de,he,ke,!1),Pe!==null&&at!==null&&h3(ve,at,Pe,ke,!0)}}e:{if(de=ue?Co(ue):window,he=de.nodeName&&de.nodeName.toLowerCase(),he==="select"||he==="input"&&de.type==="file")var Ae=I2;else if(k2(de))if(O2)Ae=tj;else{Ae=J6;var Fe=Q6}else he=de.nodeName,!he||he.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ue&&gh(ue.elementType)&&(Ae=I2):Ae=ej;if(Ae&&(Ae=Ae(a,ue))){M2(ve,Ae,f,ge);break e}Fe&&Fe(a,de,ue),a==="focusout"&&ue&&de.type==="number"&&ue.memoizedProps.value!=null&&ph(de,"number",de.value)}switch(Fe=ue?Co(ue):window,a){case"focusin":(k2(Fe)||Fe.contentEditable==="true")&&(fa=Fe,Nh=ue,Lo=null);break;case"focusout":Lo=Nh=fa=null;break;case"mousedown":kh=!0;break;case"contextmenu":case"mouseup":case"dragend":kh=!1,z2(ve,f,ge);break;case"selectionchange":if(rj)break;case"keydown":case"keyup":z2(ve,f,ge)}var Ce;if(Eh)e:{switch(a){case"compositionstart":var Me="onCompositionStart";break e;case"compositionend":Me="onCompositionEnd";break e;case"compositionupdate":Me="onCompositionUpdate";break e}Me=void 0}else ua?C2(a,f)&&(Me="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Me="onCompositionStart");Me&&(E2&&f.locale!=="ko"&&(ua||Me!=="onCompositionStart"?Me==="onCompositionEnd"&&ua&&(Ce=b2()):(bi=ge,bh="value"in bi?bi.value:bi.textContent,ua=!0)),Fe=Au(ue,Me),0<Fe.length&&(Me=new T2(Me,a,null,f,ge),ve.push({event:Me,listeners:Fe}),Ce?Me.data=Ce:(Ce=N2(f),Ce!==null&&(Me.data=Ce)))),(Ce=X6?Y6(a,f):G6(a,f))&&(Me=Au(ue,"onBeforeInput"),0<Me.length&&(Fe=new T2("onBeforeInput","beforeinput",null,f,ge),ve.push({event:Fe,listeners:Me}),Fe.data=Ce)),Uj(ve,a,ue,f,ge)}f3(ve,c)})}function fl(a,c,f){return{instance:a,listener:c,currentTarget:f}}function Au(a,c){for(var f=c+"Capture",p=[];a!==null;){var v=a,b=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||b===null||(v=No(a,f),v!=null&&p.unshift(fl(a,v,b)),v=No(a,c),v!=null&&p.push(fl(a,v,b))),a.tag===3)return p;a=a.return}return[]}function Da(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function h3(a,c,f,p,v){for(var b=c._reactName,N=[];f!==null&&f!==p;){var L=f,G=L.alternate,ue=L.stateNode;if(L=L.tag,G!==null&&G===p)break;L!==5&&L!==26&&L!==27||ue===null||(G=ue,v?(ue=No(f,b),ue!=null&&N.unshift(fl(f,ue,G))):v||(ue=No(f,b),ue!=null&&N.push(fl(f,ue,G)))),f=f.return}N.length!==0&&a.push({event:c,listeners:N})}var qj=/\r\n?/g,$j=/\u0000|\uFFFD/g;function p3(a){return(typeof a=="string"?a:""+a).replace(qj,`
`).replace($j,"")}function g3(a,c){return c=p3(c),p3(a)===c}function Ru(){}function st(a,c,f,p,v,b){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||oa(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&oa(a,""+p);break;case"className":Ic(a,"class",p);break;case"tabIndex":Ic(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Ic(a,f,p);break;case"style":_2(a,p,b);break;case"data":if(c!=="object"){Ic(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Dc(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(f==="formAction"?(c!=="input"&&st(a,c,"name",v.name,v,null),st(a,c,"formEncType",v.formEncType,v,null),st(a,c,"formMethod",v.formMethod,v,null),st(a,c,"formTarget",v.formTarget,v,null)):(st(a,c,"encType",v.encType,v,null),st(a,c,"method",v.method,v,null),st(a,c,"target",v.target,v,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Dc(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=Ru);break;case"onScroll":p!=null&&$e("scroll",a);break;case"onScrollEnd":p!=null&&$e("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Dc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":$e("beforetoggle",a),$e("toggle",a),Mc(a,"popover",p);break;case"xlinkActuate":Yr(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Yr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Yr(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Yr(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Yr(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Yr(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Yr(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Yr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Yr(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Mc(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=b6.get(f)||f,Mc(a,f,p))}}function Jp(a,c,f,p,v,b){switch(f){case"style":_2(a,p,b);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof p=="string"?oa(a,p):(typeof p=="number"||typeof p=="bigint")&&oa(a,""+p);break;case"onScroll":p!=null&&$e("scroll",a);break;case"onScrollEnd":p!=null&&$e("scrollend",a);break;case"onClick":p!=null&&(a.onclick=Ru);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!a2.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(v=f.endsWith("Capture"),c=f.slice(2,v?f.length-7:void 0),b=a[Nn]||null,b=b!=null?b[f]:null,typeof b=="function"&&a.removeEventListener(c,b,v),typeof p=="function")){typeof b!="function"&&b!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,p,v);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):Mc(a,f,p)}}}function an(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$e("error",a),$e("load",a);var p=!1,v=!1,b;for(b in f)if(f.hasOwnProperty(b)){var N=f[b];if(N!=null)switch(b){case"src":p=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:st(a,c,b,N,f,null)}}v&&st(a,c,"srcSet",f.srcSet,f,null),p&&st(a,c,"src",f.src,f,null);return;case"input":$e("invalid",a);var L=b=N=v=null,G=null,ue=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":v=ge;break;case"type":N=ge;break;case"checked":G=ge;break;case"defaultChecked":ue=ge;break;case"value":b=ge;break;case"defaultValue":L=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,c));break;default:st(a,c,p,ge,f,null)}}h2(a,b,L,G,ue,N,v,!1),Oc(a);return;case"select":$e("invalid",a),p=N=b=null;for(v in f)if(f.hasOwnProperty(v)&&(L=f[v],L!=null))switch(v){case"value":b=L;break;case"defaultValue":N=L;break;case"multiple":p=L;default:st(a,c,v,L,f,null)}c=b,f=N,a.multiple=!!p,c!=null?aa(a,!!p,c,!1):f!=null&&aa(a,!!p,f,!0);return;case"textarea":$e("invalid",a),b=v=p=null;for(N in f)if(f.hasOwnProperty(N)&&(L=f[N],L!=null))switch(N){case"value":p=L;break;case"defaultValue":v=L;break;case"children":b=L;break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(r(91));break;default:st(a,c,N,L,f,null)}g2(a,p,v,b),Oc(a);return;case"option":for(G in f)if(f.hasOwnProperty(G)&&(p=f[G],p!=null))switch(G){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:st(a,c,G,p,f,null)}return;case"dialog":$e("beforetoggle",a),$e("toggle",a),$e("cancel",a),$e("close",a);break;case"iframe":case"object":$e("load",a);break;case"video":case"audio":for(p=0;p<ul.length;p++)$e(ul[p],a);break;case"image":$e("error",a),$e("load",a);break;case"details":$e("toggle",a);break;case"embed":case"source":case"link":$e("error",a),$e("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in f)if(f.hasOwnProperty(ue)&&(p=f[ue],p!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:st(a,c,ue,p,f,null)}return;default:if(gh(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&Jp(a,c,ge,p,f,void 0));return}}for(L in f)f.hasOwnProperty(L)&&(p=f[L],p!=null&&st(a,c,L,p,f,null))}function Hj(a,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,b=null,N=null,L=null,G=null,ue=null,ge=null;for(he in f){var ve=f[he];if(f.hasOwnProperty(he)&&ve!=null)switch(he){case"checked":break;case"value":break;case"defaultValue":G=ve;default:p.hasOwnProperty(he)||st(a,c,he,null,p,ve)}}for(var de in p){var he=p[de];if(ve=f[de],p.hasOwnProperty(de)&&(he!=null||ve!=null))switch(de){case"type":b=he;break;case"name":v=he;break;case"checked":ue=he;break;case"defaultChecked":ge=he;break;case"value":N=he;break;case"defaultValue":L=he;break;case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:he!==ve&&st(a,c,de,he,p,ve)}}hh(a,N,L,G,ue,ge,b,v);return;case"select":he=N=L=de=null;for(b in f)if(G=f[b],f.hasOwnProperty(b)&&G!=null)switch(b){case"value":break;case"multiple":he=G;default:p.hasOwnProperty(b)||st(a,c,b,null,p,G)}for(v in p)if(b=p[v],G=f[v],p.hasOwnProperty(v)&&(b!=null||G!=null))switch(v){case"value":de=b;break;case"defaultValue":L=b;break;case"multiple":N=b;default:b!==G&&st(a,c,v,b,p,G)}c=L,f=N,p=he,de!=null?aa(a,!!f,de,!1):!!p!=!!f&&(c!=null?aa(a,!!f,c,!0):aa(a,!!f,f?[]:"",!1));return;case"textarea":he=de=null;for(L in f)if(v=f[L],f.hasOwnProperty(L)&&v!=null&&!p.hasOwnProperty(L))switch(L){case"value":break;case"children":break;default:st(a,c,L,null,p,v)}for(N in p)if(v=p[N],b=f[N],p.hasOwnProperty(N)&&(v!=null||b!=null))switch(N){case"value":de=v;break;case"defaultValue":he=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==b&&st(a,c,N,v,p,b)}p2(a,de,he);return;case"option":for(var Pe in f)if(de=f[Pe],f.hasOwnProperty(Pe)&&de!=null&&!p.hasOwnProperty(Pe))switch(Pe){case"selected":a.selected=!1;break;default:st(a,c,Pe,null,p,de)}for(G in p)if(de=p[G],he=f[G],p.hasOwnProperty(G)&&de!==he&&(de!=null||he!=null))switch(G){case"selected":a.selected=de&&typeof de!="function"&&typeof de!="symbol";break;default:st(a,c,G,de,p,he)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ke in f)de=f[ke],f.hasOwnProperty(ke)&&de!=null&&!p.hasOwnProperty(ke)&&st(a,c,ke,null,p,de);for(ue in p)if(de=p[ue],he=f[ue],p.hasOwnProperty(ue)&&de!==he&&(de!=null||he!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(r(137,c));break;default:st(a,c,ue,de,p,he)}return;default:if(gh(c)){for(var at in f)de=f[at],f.hasOwnProperty(at)&&de!==void 0&&!p.hasOwnProperty(at)&&Jp(a,c,at,void 0,p,de);for(ge in p)de=p[ge],he=f[ge],!p.hasOwnProperty(ge)||de===he||de===void 0&&he===void 0||Jp(a,c,ge,de,p,he);return}}for(var ae in f)de=f[ae],f.hasOwnProperty(ae)&&de!=null&&!p.hasOwnProperty(ae)&&st(a,c,ae,null,p,de);for(ve in p)de=p[ve],he=f[ve],!p.hasOwnProperty(ve)||de===he||de==null&&he==null||st(a,c,ve,de,p,he)}var eg=null,tg=null;function Cu(a){return a.nodeType===9?a:a.ownerDocument}function m3(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _3(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function ng(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var rg=null;function Wj(){var a=window.event;return a&&a.type==="popstate"?a===rg?!1:(rg=a,!0):(rg=null,!1)}var v3=typeof setTimeout=="function"?setTimeout:void 0,Xj=typeof clearTimeout=="function"?clearTimeout:void 0,y3=typeof Promise=="function"?Promise:void 0,Yj=typeof queueMicrotask=="function"?queueMicrotask:typeof y3<"u"?function(a){return y3.resolve(null).then(a).catch(Gj)}:v3;function Gj(a){setTimeout(function(){throw a})}function ji(a){return a==="head"}function b3(a,c){var f=c,p=0,v=0;do{var b=f.nextSibling;if(a.removeChild(f),b&&b.nodeType===8)if(f=b.data,f==="/$"){if(0<p&&8>p){f=p;var N=a.ownerDocument;if(f&1&&dl(N.documentElement),f&2&&dl(N.body),f&4)for(f=N.head,dl(f),N=f.firstChild;N;){var L=N.nextSibling,G=N.nodeName;N[Ro]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&N.rel.toLowerCase()==="stylesheet"||f.removeChild(N),N=L}}if(v===0){a.removeChild(b),bl(c);return}v--}else f==="$"||f==="$?"||f==="$!"?v++:p=f.charCodeAt(0)-48;else p=0;f=b}while(f);bl(c)}function ig(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":ig(f),ch(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function Kj(a,c,f,p){for(;a.nodeType===1;){var v=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[Ro])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var b=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=br(a.nextSibling),a===null)break}return null}function Zj(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=br(a.nextSibling),a===null))return null;return a}function sg(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function Qj(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function br(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var ag=null;function x3(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function w3(a,c,f){switch(c=Cu(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function dl(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);ch(a)}var sr=new Map,T3=new Set;function Nu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var li=te.d;te.d={f:Jj,r:eL,D:tL,C:nL,L:rL,m:iL,X:aL,S:sL,M:oL};function Jj(){var a=li.f(),c=bu();return a||c}function eL(a){var c=na(a);c!==null&&c.tag===5&&c.type==="form"?qw(c):li.r(a)}var ja=typeof document>"u"?null:document;function S3(a,c,f){var p=ja;if(p&&typeof c=="string"&&c){var v=Qn(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof f=="string"&&(v+='[crossorigin="'+f+'"]'),T3.has(v)||(T3.add(v),a={rel:a,crossOrigin:f,href:c},p.querySelector(v)===null&&(c=p.createElement("link"),an(c,"link",a),Qt(c),p.head.appendChild(c)))}}function tL(a){li.D(a),S3("dns-prefetch",a,null)}function nL(a,c){li.C(a,c),S3("preconnect",a,c)}function rL(a,c,f){li.L(a,c,f);var p=ja;if(p&&a&&c){var v='link[rel="preload"][as="'+Qn(c)+'"]';c==="image"&&f&&f.imageSrcSet?(v+='[imagesrcset="'+Qn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(v+='[imagesizes="'+Qn(f.imageSizes)+'"]')):v+='[href="'+Qn(a)+'"]';var b=v;switch(c){case"style":b=La(a);break;case"script":b=Ba(a)}sr.has(b)||(a=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),sr.set(b,a),p.querySelector(v)!==null||c==="style"&&p.querySelector(hl(b))||c==="script"&&p.querySelector(pl(b))||(c=p.createElement("link"),an(c,"link",a),Qt(c),p.head.appendChild(c)))}}function iL(a,c){li.m(a,c);var f=ja;if(f&&a){var p=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+Qn(p)+'"][href="'+Qn(a)+'"]',b=v;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Ba(a)}if(!sr.has(b)&&(a=h({rel:"modulepreload",href:a},c),sr.set(b,a),f.querySelector(v)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(pl(b)))return}p=f.createElement("link"),an(p,"link",a),Qt(p),f.head.appendChild(p)}}}function sL(a,c,f){li.S(a,c,f);var p=ja;if(p&&a){var v=ra(p).hoistableStyles,b=La(a);c=c||"default";var N=v.get(b);if(!N){var L={loading:0,preload:null};if(N=p.querySelector(hl(b)))L.loading=5;else{a=h({rel:"stylesheet",href:a,"data-precedence":c},f),(f=sr.get(b))&&og(a,f);var G=N=p.createElement("link");Qt(G),an(G,"link",a),G._p=new Promise(function(ue,ge){G.onload=ue,G.onerror=ge}),G.addEventListener("load",function(){L.loading|=1}),G.addEventListener("error",function(){L.loading|=2}),L.loading|=4,ku(N,c,p)}N={type:"stylesheet",instance:N,count:1,state:L},v.set(b,N)}}}function aL(a,c){li.X(a,c);var f=ja;if(f&&a){var p=ra(f).hoistableScripts,v=Ba(a),b=p.get(v);b||(b=f.querySelector(pl(v)),b||(a=h({src:a,async:!0},c),(c=sr.get(v))&&lg(a,c),b=f.createElement("script"),Qt(b),an(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function oL(a,c){li.M(a,c);var f=ja;if(f&&a){var p=ra(f).hoistableScripts,v=Ba(a),b=p.get(v);b||(b=f.querySelector(pl(v)),b||(a=h({src:a,async:!0,type:"module"},c),(c=sr.get(v))&&lg(a,c),b=f.createElement("script"),Qt(b),an(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function E3(a,c,f,p){var v=(v=Q.current)?Nu(v):null;if(!v)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=La(f.href),f=ra(v).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=La(f.href);var b=ra(v).hoistableStyles,N=b.get(a);if(N||(v=v.ownerDocument||v,N={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,N),(b=v.querySelector(hl(a)))&&!b._p&&(N.instance=b,N.state.loading=5),sr.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},sr.set(a,f),b||lL(v,a,f,N.state))),c&&p===null)throw Error(r(528,""));return N}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Ba(f),f=ra(v).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function La(a){return'href="'+Qn(a)+'"'}function hl(a){return'link[rel="stylesheet"]['+a+"]"}function A3(a){return h({},a,{"data-precedence":a.precedence,precedence:null})}function lL(a,c,f,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),an(c,"link",f),Qt(c),a.head.appendChild(c))}function Ba(a){return'[src="'+Qn(a)+'"]'}function pl(a){return"script[async]"+a}function R3(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+Qn(f.href)+'"]');if(p)return c.instance=p,Qt(p),p;var v=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),Qt(p),an(p,"style",v),ku(p,f.precedence,a),c.instance=p;case"stylesheet":v=La(f.href);var b=a.querySelector(hl(v));if(b)return c.state.loading|=4,c.instance=b,Qt(b),b;p=A3(f),(v=sr.get(v))&&og(p,v),b=(a.ownerDocument||a).createElement("link"),Qt(b);var N=b;return N._p=new Promise(function(L,G){N.onload=L,N.onerror=G}),an(b,"link",p),c.state.loading|=4,ku(b,f.precedence,a),c.instance=b;case"script":return b=Ba(f.src),(v=a.querySelector(pl(b)))?(c.instance=v,Qt(v),v):(p=f,(v=sr.get(b))&&(p=h({},f),lg(p,v)),a=a.ownerDocument||a,v=a.createElement("script"),Qt(v),an(v,"link",p),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,ku(p,f.precedence,a));return c.instance}function ku(a,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=p.length?p[p.length-1]:null,b=v,N=0;N<p.length;N++){var L=p[N];if(L.dataset.precedence===c)b=L;else if(b!==v)break}b?b.parentNode.insertBefore(a,b.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function og(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function lg(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Mu=null;function C3(a,c,f){if(Mu===null){var p=new Map,v=Mu=new Map;v.set(f,p)}else v=Mu,p=v.get(f),p||(p=new Map,v.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),v=0;v<f.length;v++){var b=f[v];if(!(b[Ro]||b[dn]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var N=b.getAttribute(c)||"";N=a+N;var L=p.get(N);L?L.push(b):p.set(N,[b])}}return p}function N3(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function cL(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function k3(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var gl=null;function uL(){}function fL(a,c,f){if(gl===null)throw Error(r(475));var p=gl;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=La(f.href),b=a.querySelector(hl(v));if(b){a=b._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=Iu.bind(p),a.then(p,p)),c.state.loading|=4,c.instance=b,Qt(b);return}b=a.ownerDocument||a,f=A3(f),(v=sr.get(v))&&og(f,v),b=b.createElement("link"),Qt(b);var N=b;N._p=new Promise(function(L,G){N.onload=L,N.onerror=G}),an(b,"link",f),c.instance=b}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=Iu.bind(p),a.addEventListener("load",c),a.addEventListener("error",c))}}function dL(){if(gl===null)throw Error(r(475));var a=gl;return a.stylesheets&&a.count===0&&cg(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&cg(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function Iu(){if(this.count--,this.count===0){if(this.stylesheets)cg(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Ou=null;function cg(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Ou=new Map,c.forEach(hL,a),Ou=null,Iu.call(a))}function hL(a,c){if(!(c.state.loading&4)){var f=Ou.get(a);if(f)var p=f.get(null);else{f=new Map,Ou.set(a,f);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<v.length;b++){var N=v[b];(N.nodeName==="LINK"||N.getAttribute("media")!=="not all")&&(f.set(N.dataset.precedence,N),p=N)}p&&f.set(null,p)}v=c.instance,N=v.getAttribute("data-precedence"),b=f.get(N)||p,b===p&&f.set(null,v),f.set(N,v),this.count++,p=Iu.bind(this),v.addEventListener("load",p),v.addEventListener("error",p),b?b.parentNode.insertBefore(v,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var ml={$$typeof:R,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function pL(a,c,f,p,v,b,N,L){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Je(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Je(0),this.hiddenUpdates=Je(null),this.identifierPrefix=p,this.onUncaughtError=v,this.onCaughtError=b,this.onRecoverableError=N,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function M3(a,c,f,p,v,b,N,L,G,ue,ge,ve){return a=new pL(a,c,f,N,L,G,ue,ve),c=1,b===!0&&(c|=24),b=Ln(3,null,null,c),a.current=b,b.stateNode=a,c=$h(),c.refCount++,a.pooledCache=c,c.refCount++,b.memoizedState={element:p,isDehydrated:f,cache:c},Yh(b),a}function I3(a){return a?(a=ga,a):ga}function O3(a,c,f,p,v,b){v=I3(v),p.context===null?p.context=v:p.pendingContext=v,p=Ti(c),p.payload={element:f},b=b===void 0?null:b,b!==null&&(p.callback=b),f=Si(a,p,c),f!==null&&(Vn(f,a,c),Wo(f,a,c))}function P3(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function ug(a,c){P3(a,c),(a=a.alternate)&&P3(a,c)}function D3(a){if(a.tag===13){var c=pa(a,67108864);c!==null&&Vn(c,a,67108864),ug(a,67108864)}}var Pu=!0;function gL(a,c,f,p){var v=z.T;z.T=null;var b=te.p;try{te.p=2,fg(a,c,f,p)}finally{te.p=b,z.T=v}}function mL(a,c,f,p){var v=z.T;z.T=null;var b=te.p;try{te.p=8,fg(a,c,f,p)}finally{te.p=b,z.T=v}}function fg(a,c,f,p){if(Pu){var v=dg(p);if(v===null)Qp(a,c,p,Du,f),L3(a,p);else if(vL(v,a,c,f,p))p.stopPropagation();else if(L3(a,p),c&4&&-1<_L.indexOf(a)){for(;v!==null;){var b=na(v);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var N=Cn(b.pendingLanes);if(N!==0){var L=b;for(L.pendingLanes|=2,L.entangledLanes|=2;N;){var G=1<<31-_t(N);L.entanglements[1]|=G,N&=~G}jr(b),(tt&6)===0&&(vu=Ne()+500,cl(0))}}break;case 13:L=pa(b,2),L!==null&&Vn(L,b,2),bu(),ug(b,2)}if(b=dg(p),b===null&&Qp(a,c,p,Du,f),b===v)break;v=b}v!==null&&p.stopPropagation()}else Qp(a,c,p,null,f)}}function dg(a){return a=_h(a),hg(a)}var Du=null;function hg(a){if(Du=null,a=ta(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Du=a,null}function j3(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(yn()){case Wt:return 2;case Rn:return 8;case jt:case un:return 32;case We:return 268435456;default:return 32}default:return 32}}var pg=!1,Li=null,Bi=null,Ui=null,_l=new Map,vl=new Map,Fi=[],_L="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function L3(a,c){switch(a){case"focusin":case"focusout":Li=null;break;case"dragenter":case"dragleave":Bi=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":_l.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":vl.delete(c.pointerId)}}function yl(a,c,f,p,v,b){return a===null||a.nativeEvent!==b?(a={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:b,targetContainers:[v]},c!==null&&(c=na(c),c!==null&&D3(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function vL(a,c,f,p,v){switch(c){case"focusin":return Li=yl(Li,a,c,f,p,v),!0;case"dragenter":return Bi=yl(Bi,a,c,f,p,v),!0;case"mouseover":return Ui=yl(Ui,a,c,f,p,v),!0;case"pointerover":var b=v.pointerId;return _l.set(b,yl(_l.get(b)||null,a,c,f,p,v)),!0;case"gotpointercapture":return b=v.pointerId,vl.set(b,yl(vl.get(b)||null,a,c,f,p,v)),!0}return!1}function B3(a){var c=ta(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,f6(a.priority,function(){if(f.tag===13){var p=zn();p=ah(p);var v=pa(f,p);v!==null&&Vn(v,f,p),ug(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function ju(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=dg(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);mh=p,f.target.dispatchEvent(p),mh=null}else return c=na(f),c!==null&&D3(c),a.blockedOn=f,!1;c.shift()}return!0}function U3(a,c,f){ju(a)&&f.delete(c)}function yL(){pg=!1,Li!==null&&ju(Li)&&(Li=null),Bi!==null&&ju(Bi)&&(Bi=null),Ui!==null&&ju(Ui)&&(Ui=null),_l.forEach(U3),vl.forEach(U3)}function Lu(a,c){a.blockedOn===c&&(a.blockedOn=null,pg||(pg=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,yL)))}var Bu=null;function F3(a){Bu!==a&&(Bu=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Bu===a&&(Bu=null);for(var c=0;c<a.length;c+=3){var f=a[c],p=a[c+1],v=a[c+2];if(typeof p!="function"){if(hg(p||f)===null)continue;break}var b=na(f);b!==null&&(a.splice(c,3),c-=3,hp(b,{pending:!0,data:v,method:f.method,action:p},p,v))}}))}function bl(a){function c(G){return Lu(G,a)}Li!==null&&Lu(Li,a),Bi!==null&&Lu(Bi,a),Ui!==null&&Lu(Ui,a),_l.forEach(c),vl.forEach(c);for(var f=0;f<Fi.length;f++){var p=Fi[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Fi.length&&(f=Fi[0],f.blockedOn===null);)B3(f),f.blockedOn===null&&Fi.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var v=f[p],b=f[p+1],N=v[Nn]||null;if(typeof b=="function")N||F3(f);else if(N){var L=null;if(b&&b.hasAttribute("formAction")){if(v=b,N=b[Nn]||null)L=N.formAction;else if(hg(v)!==null)continue}else L=N.action;typeof L=="function"?f[p+1]=L:(f.splice(p,3),p-=3),F3(f)}}}function gg(a){this._internalRoot=a}Uu.prototype.render=gg.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=zn();O3(f,p,a,c,null,null)},Uu.prototype.unmount=gg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;O3(a.current,2,null,a,null,null),bu(),c[ea]=null}};function Uu(a){this._internalRoot=a}Uu.prototype.unstable_scheduleHydration=function(a){if(a){var c=r2();a={blockedOn:null,target:a,priority:c};for(var f=0;f<Fi.length&&c!==0&&c<Fi[f].priority;f++);Fi.splice(f,0,a),f===0&&B3(a)}};var z3=e.version;if(z3!=="19.1.0")throw Error(r(527,z3,"19.1.0"));te.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var bL={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fu.isDisabled&&Fu.supportsFiber)try{Qe=Fu.inject(bL),Ve=Fu}catch{}}return wl.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,p="",v=rT,b=iT,N=sT,L=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(N=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(L=c.unstable_transitionCallbacks)),c=M3(a,1,!1,null,null,f,p,v,b,N,L,null),a[ea]=c.current,Zp(a),new gg(c)},wl.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var p=!1,v="",b=rT,N=iT,L=sT,G=null,ue=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(b=f.onUncaughtError),f.onCaughtError!==void 0&&(N=f.onCaughtError),f.onRecoverableError!==void 0&&(L=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(G=f.unstable_transitionCallbacks),f.formState!==void 0&&(ue=f.formState)),c=M3(a,1,!0,c,f??null,p,v,b,N,L,G,ue),c.context=I3(null),f=c.current,p=zn(),p=ah(p),v=Ti(p),v.callback=null,Si(f,v,p),f=p,c.current.lanes=f,vt(c,f),jr(c),a[ea]=c.current,Zp(a),new Uu(c)},wl.version="19.1.0",wl}var Z3;function IL(){if(Z3)return _g.exports;Z3=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),_g.exports=ML(),_g.exports}var OL=IL(),U=zx();const ec=Fx(U),PL=SL({__proto__:null,default:ec},[U]);SM();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tc(){return tc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tc.apply(this,arguments)}var Zi;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Zi||(Zi={}));const Q3="popstate";function DL(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return O0("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:AM(i)}return LL(e,t,null,n)}function Zt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function EM(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function jL(){return Math.random().toString(36).substr(2,8)}function J3(n,e){return{usr:n.state,key:n.key,idx:e}}function O0(n,e,t,r){return t===void 0&&(t=null),tc({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?vo(e):e,{state:t,key:e&&e.key||r||jL()})}function AM(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function vo(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function LL(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l=Zi.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(tc({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function g(){l=Zi.Pop;let x=h(),S=x==null?null:x-d;d=x,u&&u({action:l,location:w.location,delta:S})}function _(x,S){l=Zi.Push;let A=O0(w.location,x,S);d=h()+1;let R=J3(A,d),E=w.createHref(A);try{o.pushState(R,"",E)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(E)}s&&u&&u({action:l,location:w.location,delta:1})}function y(x,S){l=Zi.Replace;let A=O0(w.location,x,S);d=h();let R=J3(A,d),E=w.createHref(A);o.replaceState(R,"",E),s&&u&&u({action:l,location:w.location,delta:0})}function T(x){let S=i.location.origin!=="null"?i.location.origin:i.location.href,A=typeof x=="string"?x:AM(x);return A=A.replace(/ $/,"%20"),Zt(S,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,S)}let w={get action(){return l},get location(){return n(i,o)},listen(x){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(Q3,g),u=x,()=>{i.removeEventListener(Q3,g),u=null}},createHref(x){return e(i,x)},createURL:T,encodeLocation(x){let S=T(x);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:_,replace:y,go(x){return o.go(x)}};return w}var eS;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(eS||(eS={}));function BL(n,e,t){return t===void 0&&(t="/"),UL(n,e,t)}function UL(n,e,t,r){let i=typeof e=="string"?vo(e):e,s=NM(i.pathname||"/",t);if(s==null)return null;let o=RM(n);FL(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=QL(s);l=GL(o[u],d)}return l}function RM(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,o,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(Zt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=ks([r,u.relativePath]),h=t.concat(u);s.children&&s.children.length>0&&(Zt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),RM(s.children,e,h,d)),!(s.path==null&&!s.index)&&e.push({path:d,score:XL(d,s.index),routesMeta:h})};return n.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,o);else for(let u of CM(s.path))i(s,o,u)}),e}function CM(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=CM(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>n.startsWith("/")&&u===""?"/":u)}function FL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:YL(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const zL=/^:[\w-]+$/,VL=3,qL=2,$L=1,HL=10,WL=-2,tS=n=>n==="*";function XL(n,e){let t=n.split("/"),r=t.length;return t.some(tS)&&(r+=WL),e&&(r+=qL),t.filter(i=>!tS(i)).reduce((i,s)=>i+(zL.test(s)?VL:s===""?$L:HL),r)}function YL(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function GL(n,e,t){let{routesMeta:r}=n,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",g=KL({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),_=u.route;if(!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:ks([s,g.pathname]),pathnameBase:iB(ks([s,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(s=ks([s,g.pathnameBase]))}return o}function KL(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=ZL(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,h,g)=>{let{paramName:_,isOptional:y}=h;if(_==="*"){let w=l[g]||"";o=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const T=l[g];return y&&!T?d[_]=void 0:d[_]=(T||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:n}}function ZL(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),EM(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function QL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return EM(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function NM(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function JL(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?vo(n):n;return{pathname:t?t.startsWith("/")?t:eB(t,e):e,search:sB(r),hash:aB(i)}}function eB(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function wg(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tB(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function nB(n,e){let t=tB(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function rB(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=vo(n):(i=tc({},n),Zt(!i.pathname||!i.pathname.includes("?"),wg("?","pathname","search",i)),Zt(!i.pathname||!i.pathname.includes("#"),wg("#","pathname","hash",i)),Zt(!i.search||!i.search.includes("#"),wg("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=t;else{let g=e.length-1;if(!r&&o.startsWith("..")){let _=o.split("/");for(;_[0]==="..";)_.shift(),g-=1;i.pathname=_.join("/")}l=g>=0?e[g]:"/"}let u=JL(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const ks=n=>n.join("/").replace(/\/\/+/g,"/"),iB=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),sB=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,aB=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function oB(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const kM=["post","put","patch","delete"];new Set(kM);const lB=["get",...kM];new Set(lB);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nc(){return nc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},nc.apply(this,arguments)}const Vx=U.createContext(null),cB=U.createContext(null),Ad=U.createContext(null),Rd=U.createContext(null),qs=U.createContext({outlet:null,matches:[],isDataRoute:!1}),MM=U.createContext(null);function Cd(){return U.useContext(Rd)!=null}function hc(){return Cd()||Zt(!1),U.useContext(Rd).location}function IM(n){U.useContext(Ad).static||U.useLayoutEffect(n)}function pc(){let{isDataRoute:n}=U.useContext(qs);return n?wB():uB()}function uB(){Cd()||Zt(!1);let n=U.useContext(Vx),{basename:e,future:t,navigator:r}=U.useContext(Ad),{matches:i}=U.useContext(qs),{pathname:s}=hc(),o=JSON.stringify(nB(i,t.v7_relativeSplatPath)),l=U.useRef(!1);return IM(()=>{l.current=!0}),U.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let g=rB(d,JSON.parse(o),s,h.relative==="path");n==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:ks([e,g.pathname])),(h.replace?r.replace:r.push)(g,h.state,h)},[e,r,o,s,n])}function OM(){let{matches:n}=U.useContext(qs),e=n[n.length-1];return e?e.params:{}}function fB(n,e){return dB(n,e)}function dB(n,e,t,r){Cd()||Zt(!1);let{navigator:i}=U.useContext(Ad),{matches:s}=U.useContext(qs),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=hc(),h;if(e){var g;let x=typeof e=="string"?vo(e):e;u==="/"||(g=x.pathname)!=null&&g.startsWith(u)||Zt(!1),h=x}else h=d;let _=h.pathname||"/",y=_;if(u!=="/"){let x=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(x.length).join("/")}let T=BL(n,{pathname:y}),w=_B(T&&T.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:ks([u,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?u:ks([u,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),s,t,r);return e&&w?U.createElement(Rd.Provider,{value:{location:nc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Zi.Pop}},w):w}function hB(){let n=xB(),e=oB(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return U.createElement(U.Fragment,null,U.createElement("h2",null,"Unexpected Application Error!"),U.createElement("h3",{style:{fontStyle:"italic"}},e),t?U.createElement("pre",{style:i},t):null,null)}const pB=U.createElement(hB,null);class gB extends U.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?U.createElement(qs.Provider,{value:this.props.routeContext},U.createElement(MM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function mB(n){let{routeContext:e,match:t,children:r}=n,i=U.useContext(Vx);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),U.createElement(qs.Provider,{value:e},r)}function _B(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,l=(i=t)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(g=>g.route.id&&(l==null?void 0:l[g.route.id])!==void 0);h>=0||Zt(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(t&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let g=o[h];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=h),g.route.id){let{loaderData:_,errors:y}=t,T=g.route.loader&&_[g.route.id]===void 0&&(!y||y[g.route.id]===void 0);if(g.route.lazy||T){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,g,_)=>{let y,T=!1,w=null,x=null;t&&(y=l&&g.route.id?l[g.route.id]:void 0,w=g.route.errorElement||pB,u&&(d<0&&_===0?(TB("route-fallback"),T=!0,x=null):d===_&&(T=!0,x=g.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,_+1)),A=()=>{let R;return y?R=w:T?R=x:g.route.Component?R=U.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=h,U.createElement(mB,{match:g,routeContext:{outlet:h,matches:S,isDataRoute:t!=null},children:R})};return t&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?U.createElement(gB,{location:t.location,revalidation:t.revalidation,component:w,error:y,children:A(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):A()},null)}var PM=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(PM||{}),DM=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(DM||{});function vB(n){let e=U.useContext(Vx);return e||Zt(!1),e}function yB(n){let e=U.useContext(cB);return e||Zt(!1),e}function bB(n){let e=U.useContext(qs);return e||Zt(!1),e}function jM(n){let e=bB(),t=e.matches[e.matches.length-1];return t.route.id||Zt(!1),t.route.id}function xB(){var n;let e=U.useContext(MM),t=yB(),r=jM();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function wB(){let{router:n}=vB(PM.UseNavigateStable),e=jM(DM.UseNavigateStable),t=U.useRef(!1);return IM(()=>{t.current=!0}),U.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,nc({fromRouteId:e},s)))},[n,e])}const nS={};function TB(n,e,t){nS[n]||(nS[n]=!0)}function SB(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Ml(n){Zt(!1)}function EB(n){let{basename:e="/",children:t=null,location:r,navigationType:i=Zi.Pop,navigator:s,static:o=!1,future:l}=n;Cd()&&Zt(!1);let u=e.replace(/^\/*/,"/"),d=U.useMemo(()=>({basename:u,navigator:s,static:o,future:nc({v7_relativeSplatPath:!1},l)}),[u,l,s,o]);typeof r=="string"&&(r=vo(r));let{pathname:h="/",search:g="",hash:_="",state:y=null,key:T="default"}=r,w=U.useMemo(()=>{let x=NM(h,u);return x==null?null:{location:{pathname:x,search:g,hash:_,state:y,key:T},navigationType:i}},[u,h,g,_,y,T,i]);return w==null?null:U.createElement(Ad.Provider,{value:d},U.createElement(Rd.Provider,{children:t,value:w}))}function AB(n){let{children:e,location:t}=n;return fB(P0(e),t)}new Promise(()=>{});function P0(n,e){e===void 0&&(e=[]);let t=[];return U.Children.forEach(n,(r,i)=>{if(!U.isValidElement(r))return;let s=[...e,i];if(r.type===U.Fragment){t.push.apply(t,P0(r.props.children,s));return}r.type!==Ml&&Zt(!1),!r.props.index||!r.props.children||Zt(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=P0(r.props.children,s)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const RB="6";try{window.__reactRouterVersion=RB}catch{}const CB="startTransition",rS=PL[CB];function NB(n){let{basename:e,children:t,future:r,window:i}=n,s=U.useRef();s.current==null&&(s.current=DL({window:i,v5Compat:!0}));let o=s.current,[l,u]=U.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=U.useCallback(g=>{d&&rS?rS(()=>u(g)):u(g)},[u,d]);return U.useLayoutEffect(()=>o.listen(h),[o,h]),U.useEffect(()=>SB(r),[r]),U.createElement(EB,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:o,future:r})}var iS;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(iS||(iS={}));var sS;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(sS||(sS={}));const kB=()=>(console.log("Using default API base: /api"),"/api"),xn={BASE_URL:kB(),ENDPOINTS:{CREATE_SESSION:"/create-session",GET_SESSION:"/session",UPLOAD:"/upload-tree-sequence",UPLOADED_FILES:"/uploaded-files/",TREE_SEQUENCE_METADATA:"/tree-sequence-metadata",DELETE_TREE_SEQUENCE:"/tree-sequence",DOWNLOAD_TREE_SEQUENCE:"/download-tree-sequence",GRAPH_DATA:"/graph-data",INFER_LOCATIONS_FAST:"/infer-locations-fast",INFER_LOCATIONS_GAIA_QUADRATIC:"/infer-locations-gaia-quadratic",INFER_LOCATIONS_MIDPOINT:"/infer-locations-midpoint",INFER_LOCATIONS_SPARG:"/infer-locations-sparg",SIMULATE_TREE_SEQUENCE:"/simulate-tree-sequence/"}},MB={LOADING_DOTS_INTERVAL:420},Qi={DEFAULT_MAX_SAMPLES:25,MIN_SAMPLES:2,WARNING_THRESHOLD:25},Tg={ACCEPTED_FORMATS:{"application/octet-stream":[".trees",".tsz"],"application/x-trees":[".trees"],"application/x-tsz":[".tsz"]},CSV_FORMATS:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]}},Tl={UPLOAD_FAILED:"Upload failed",DOWNLOAD_FAILED:"Download failed",FETCH_FAILED:"Failed to fetch data",NO_SPATIAL_DATA:"No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.",NO_SPATIAL_RANGE:"No spatial data found in this genomic range.",UNKNOWN_ERROR:"Unknown error occurred"},LM=U.createContext(void 0);function IB({children:n}){const[e,t]=U.useState(null),[r,i]=U.useState(Qi.DEFAULT_MAX_SAMPLES),s=l=>{if(t(l),l!=null&&l.num_samples){const u=Math.min(Qi.DEFAULT_MAX_SAMPLES,l.num_samples);i(u)}},o=l=>{if(e!=null&&e.num_samples){const u=Math.max(Qi.MIN_SAMPLES,Math.min(l,e.num_samples));i(u)}else i(Math.min(l,Qi.DEFAULT_MAX_SAMPLES))};return m.jsx(LM.Provider,{value:{treeSequence:e,setTreeSequence:s,maxSamples:r,setMaxSamples:o},children:n})}function $s(){const n=U.useContext(LM);if(n===void 0)throw new Error("useTreeSequence must be used within a TreeSequenceProvider");return n}var BM=(n=>(n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR",n))(BM||{});class OB{constructor(){j(this,"logLevel");j(this,"isDevelopment");this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:2}shouldLog(e){return e>=this.logLevel}formatMessage(e,t,r){const i=new Date().toISOString(),s=r!=null&&r.component?`[${r.component}]`:"",o=r!=null&&r.action?`(${r.action})`:"";return`[${i}] ${e} ${s}${o} ${t}`}logToConsole(e,t,r,i){const s=BM[e],o=this.formatMessage(s,t,r);switch(e){case 0:console.debug(o,r==null?void 0:r.data);break;case 1:console.info(o,r==null?void 0:r.data);break;case 2:console.warn(o,r==null?void 0:r.data);break;case 3:console.error(o,i||(r==null?void 0:r.error),r==null?void 0:r.data);break}}debug(e,t){this.shouldLog(0)&&this.logToConsole(0,e,t)}info(e,t){this.shouldLog(1)&&this.logToConsole(1,e,t)}warn(e,t){this.shouldLog(2)&&this.logToConsole(2,e,t)}error(e,t){this.shouldLog(3)&&this.logToConsole(3,e,t,t==null?void 0:t.error)}apiCall(e,t="GET",r){this.debug(`API ${t} ${e}`,{action:"api-call",data:{endpoint:e,method:t,payload:r}})}apiSuccess(e,t="GET",r){this.info(`API ${t} ${e} succeeded`,{action:"api-success",data:{endpoint:e,method:t,response:r}})}apiError(e,t,r="GET"){this.error(`API ${r} ${e} failed`,{action:"api-error",error:t,data:{endpoint:e,method:r}})}componentMount(e,t){this.debug(`${e} mounted`,{component:e,action:"mount",data:t})}componentUnmount(e){this.debug(`${e} unmounted`,{component:e,action:"unmount"})}userAction(e,t,r){this.info(`User action: ${e}`,{component:r,action:"user-action",data:t})}dataProcessing(e,t,r,i){this.debug(`Data processing: ${e}`,{component:t,action:"data-processing",data:{operation:e,inputSize:r,outputSize:i}})}navigation(e,t){this.info(`Navigation: ${e} → ${t}`,{action:"navigation",data:{from:e,to:t}})}performance(e,t,r){this.info(`Performance: ${e} took ${t}ms`,{component:r,action:"performance",data:{operation:e,duration:t}})}}const qn=new OB,Se={debug:(n,e)=>qn.debug(n,e),info:(n,e)=>qn.info(n,e),warn:(n,e)=>qn.warn(n,e),error:(n,e)=>qn.error(n,e),api:{call:(n,e,t)=>qn.apiCall(n,e,t),success:(n,e,t)=>qn.apiSuccess(n,e,t),error:(n,e,t)=>qn.apiError(n,e,t)},component:{mount:(n,e)=>qn.componentMount(n,e),unmount:n=>qn.componentUnmount(n)},user:{action:(n,e,t)=>qn.userAction(n,e,t)},data:{processing:(n,e,t,r)=>qn.dataProcessing(n,e,t,r)},nav:(n,e)=>qn.navigation(n,e),perf:(n,e,t)=>qn.performance(n,e,t)};class PB{constructor(){j(this,"baseURL");this.baseURL=xn.BASE_URL}async request(e,t={}){const r=`${this.baseURL}${e}`,i=t.method||"GET";Se.api.call(e,i,t.body);try{const s=new AbortController,o=setTimeout(()=>s.abort(),6e4),l=await fetch(r,{...t,headers:{"Content-Type":"application/json",...t.headers},signal:s.signal});if(clearTimeout(o),!l.ok){const d=await l.json().catch(()=>null),h={message:`HTTP error! status: ${l.status}`,status:l.status,details:(d==null?void 0:d.detail)||"No details available"};throw Se.api.error(e,new Error(h.message),i),h}const u=await l.json();return Se.api.success(e,i,u),{data:u,status:l.status}}catch(s){if(s instanceof Error){if(s.name==="AbortError"){const l=new Error("Request timed out after 60 seconds");throw Se.api.error(e,l,i),l}throw Se.api.error(e,s,i),s}const o={message:Tl.UNKNOWN_ERROR,details:String(s)};throw Se.api.error(e,new Error(o.message),i),o}}async uploadFile(e,t){const r=`${this.baseURL}${e}`,i=new FormData;i.append("file",t),Se.api.call(e,"POST",{filename:t.name,size:t.size});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok)throw new Error(Tl.UPLOAD_FAILED);const o=await s.json();return Se.api.success(e,"POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:Tl.UPLOAD_FAILED;throw Se.api.error(e,new Error(o),"POST"),s}}async getCurrentSession(){return this.request(xn.ENDPOINTS.GET_SESSION)}async uploadTreeSequence(e){return this.uploadFile(xn.ENDPOINTS.UPLOAD,e)}async getUploadedFiles(){return this.request(xn.ENDPOINTS.UPLOADED_FILES)}async getTreeSequenceMetadata(e){return this.request(`${xn.ENDPOINTS.TREE_SEQUENCE_METADATA}/${encodeURIComponent(e)}`)}async deleteTreeSequence(e){return this.request(`${xn.ENDPOINTS.DELETE_TREE_SEQUENCE}/${encodeURIComponent(e)}`,{method:"DELETE"})}async downloadTreeSequence(e,t="trees"){const r=`${this.baseURL}${xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE}/${encodeURIComponent(e)}?format=${t}`;Se.api.call(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{filename:e,format:t});try{const i=await fetch(r);if(!i.ok)throw new Error(Tl.DOWNLOAD_FAILED);const s=await i.blob();return Se.api.success(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{size:s.size,format:t}),s}catch(i){const s=i instanceof Error?i.message:Tl.DOWNLOAD_FAILED;throw Se.api.error(xn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,new Error(s),"GET"),i}}async getGraphData(e,t={}){const r=new URLSearchParams;t.maxSamples&&r.append("max_samples",t.maxSamples.toString()),t.genomicStart!==void 0&&r.append("genomic_start",t.genomicStart.toString()),t.genomicEnd!==void 0&&r.append("genomic_end",t.genomicEnd.toString()),t.treeStartIdx!==void 0&&r.append("tree_start_idx",t.treeStartIdx.toString()),t.treeEndIdx!==void 0&&r.append("tree_end_idx",t.treeEndIdx.toString()),t.sampleOrder&&r.append("sample_order",t.sampleOrder);const i=`${xn.ENDPOINTS.GRAPH_DATA}/${encodeURIComponent(e)}?${r}`;return this.request(i)}async inferLocationsFast(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_FAST,{method:"POST",body:JSON.stringify(e)})}async inferLocationsSparg(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_SPARG,{method:"POST",body:JSON.stringify(e)})}async inferLocationsGaiaQuadratic(e){return this.request("/infer-locations-gaia-quadratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsGaiaLinear(e){return this.request("/infer-locations-gaia-linear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsMidpoint(e){return this.request(xn.ENDPOINTS.INFER_LOCATIONS_MIDPOINT,{method:"POST",body:JSON.stringify(e)})}async simulateTreeSequence(e){return this.request(xn.ENDPOINTS.SIMULATE_TREE_SEQUENCE,{method:"POST",body:JSON.stringify(e)})}async uploadLocationCSV(e,t){const r=`${this.baseURL}/upload-location-csv?csv_type=${t}`,i=new FormData;i.append("file",e),Se.api.call("/upload-location-csv","POST",{filename:e.name,csvType:t});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok){const l=await s.json().catch(()=>null);throw new Error((l==null?void 0:l.detail)||"Failed to upload CSV")}const o=await s.json();return Se.api.success("/upload-location-csv","POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:"Failed to upload CSV";throw Se.api.error("/upload-location-csv",new Error(o),"POST"),s}}async updateTreeSequenceLocations(e){return this.request("/update-tree-sequence-locations",{method:"POST",body:JSON.stringify(e)})}async getAvailableCRS(){return this.request("/geographic/crs")}async getAvailableShapes(){return this.request("/geographic/shapes")}async uploadShapefile(e){return this.uploadFile("/geographic/upload-shapefile",e)}async getShapeData(e){return this.request(`/geographic/shape/${encodeURIComponent(e)}`)}async transformCoordinates(e){return this.request("/geographic/transform-coordinates",{method:"POST",body:JSON.stringify(e)})}async validateSpatialData(e){return this.request("/geographic/validate-spatial",{method:"POST",body:JSON.stringify(e)})}}const Dt=new PB,bt={getCurrentSession:()=>Dt.getCurrentSession(),uploadTreeSequence:n=>Dt.uploadTreeSequence(n),getUploadedFiles:()=>Dt.getUploadedFiles(),getTreeSequenceMetadata:n=>Dt.getTreeSequenceMetadata(n),deleteTreeSequence:n=>Dt.deleteTreeSequence(n),downloadTreeSequence:(n,e="trees")=>Dt.downloadTreeSequence(n,e),getGraphData:(n,e)=>Dt.getGraphData(n,e),inferLocationsFast:n=>Dt.inferLocationsFast(n),inferLocationsSparg:n=>Dt.inferLocationsSparg(n),inferLocationsGaiaQuadratic:n=>Dt.inferLocationsGaiaQuadratic(n),inferLocationsGaiaLinear:n=>Dt.inferLocationsGaiaLinear(n),inferLocationsMidpoint:n=>Dt.inferLocationsMidpoint(n),simulateTreeSequence:n=>Dt.simulateTreeSequence(n),uploadLocationCSV:(n,e)=>Dt.uploadLocationCSV(n,e),updateTreeSequenceLocations:n=>Dt.updateTreeSequenceLocations(n),getAvailableCRS:()=>Dt.getAvailableCRS(),getAvailableShapes:()=>Dt.getAvailableShapes(),uploadShapefile:n=>Dt.uploadShapefile(n),getShapeData:n=>Dt.getShapeData(n),transformCoordinates:n=>Dt.transformCoordinates(n),validateSpatialData:n=>Dt.validateSpatialData(n)},aS={tskit:{background:"#03303E",containerBackground:"#0f1419",nodeDefault:[96,160,183,255],nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:[80,160,175,255],nodeSelected:[255,255,255,255],edgeDefault:[153,153,153,102],edgeHighlight:[255,255,255,200],text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"},grayscale:{background:"#ffffff",containerBackground:"#f8f9fa",nodeDefault:[100,100,100,255],nodeRoot:[50,50,50,255],nodeSample:[70,70,70,255],nodeCombined:[120,120,120,255],nodeSelected:[0,0,0,255],edgeDefault:[140,140,140,128],edgeHighlight:[40,40,40,200],text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",exportBackground:"#ffffff",accentPrimary:"#085167",accentSecondary:"#085167",geographicGrid:[140,140,140,102],temporalGrid:[140,140,140,77],tooltipBackground:"rgba(0, 0, 0, 0.9)",tooltipText:"#ffffff",headerText:"#212529",controlPanelText:"#212529",buttonText:"#212529"}},UM=U.createContext(void 0),Vu="argscape_custom_themes",Sg="argscape_selected_theme",Sl="argscape_selected_custom_theme",DB=({children:n})=>{const[e,t]=U.useState("tskit"),[r,i]=U.useState([]),[s,o]=U.useState(null),[l,u]=U.useState("any");U.useEffect(()=>{try{const x=localStorage.getItem(Vu);x&&i(JSON.parse(x));const S=localStorage.getItem(Sg);S&&(S==="tskit"||S==="grayscale"||S==="custom")&&t(S);const A=localStorage.getItem(Sl);A&&o(A)}catch(x){console.warn("Failed to load saved color themes:",x)}},[]);const d=U.useCallback(x=>{t(x),localStorage.setItem(Sg,x)},[]),h=U.useCallback(x=>{o(x),x?localStorage.setItem(Sl,x):localStorage.removeItem(Sl)},[]),g=U.useCallback((x,S)=>{const A=`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={id:A,name:x,colors:S};return i(E=>{const C=[...E,R];return localStorage.setItem(Vu,JSON.stringify(C)),C}),t("custom"),o(A),localStorage.setItem(Sg,"custom"),localStorage.setItem(Sl,A),A},[]),_=U.useCallback(x=>{i(S=>{const A=S.filter(R=>R.id!==x);return localStorage.setItem(Vu,JSON.stringify(A)),A}),s===x&&(o(null),localStorage.removeItem(Sl))},[s]),y=U.useCallback((x,S,A)=>{i(R=>{const E=R.map(C=>C.id===x?{...C,name:S,colors:A}:C);return localStorage.setItem(Vu,JSON.stringify(E)),E})},[]),T=ec.useMemo(()=>{if(e==="custom"&&s){const x=r.find(S=>S.id===s);if(x)return x.colors}return aS[e]||aS.tskit},[e,s,r]),w={theme:e,setTheme:d,colors:T,customThemes:r,selectedCustomTheme:s,setSelectedCustomTheme:h,saveCustomTheme:g,deleteCustomTheme:_,updateCustomTheme:y,currentVisualizationType:l,setCurrentVisualizationType:u};return m.jsx(UM.Provider,{value:w,children:n})},$t=()=>{const n=U.useContext(UM);if(n===void 0)throw new Error("useColorTheme must be used within a ColorThemeProvider");return n},FM=n=>{if(n.startsWith("#")){const t=n.slice(1),r=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),s=parseInt(t.substr(4,2),16);return[r,i,s,255]}const e=n.match(/rgba?\(([^)]+)\)/);if(e){const t=e[1].split(",").map(r=>parseFloat(r.trim()));return[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round((t[3]??1)*255)]}return[128,128,128,255]},zM=n=>{const e=["background","nodeSample","nodeRoot","nodeDefault","edgeDefault"];switch(n){case"force-directed":return e;case"spatial-3d":return[...e,"geographicGrid","temporalGrid"];case"any":default:return[...e,"geographicGrid","temporalGrid"]}},jB=n=>{const e=["background","containerBackground","nodeDefault","nodeRoot","nodeSample","nodeCombined","nodeSelected","edgeDefault","edgeHighlight","text","textSecondary","border","exportBackground","accentPrimary","accentSecondary","geographicGrid","temporalGrid","tooltipBackground","tooltipText","headerText","controlPanelText","buttonText"],t=zM(n);return e.filter(r=>!t.includes(r))},VM=n=>`#${n[0].toString(16).padStart(2,"0")}${n[1].toString(16).padStart(2,"0")}${n[2].toString(16).padStart(2,"0")}`;function gc({className:n="",style:e={},size:t="medium",showSubtext:r=!1}){const i=pc(),{colors:s}=$t(),o=()=>{i("/",{state:{forceIntro:!0}})},l=()=>{switch(t){case"small":return"text-xl md:text-2xl";case"medium":return"text-2xl md:text-3xl";case"large":return"text-[3rem] md:text-[4rem]";default:return"text-2xl md:text-3xl"}};return m.jsxs("div",{className:"cursor-pointer select-none",onClick:o,children:[m.jsxs("h1",{className:`${l()} font-extrabold tracking-tight ${n}`,style:{letterSpacing:"-0.04em",...e},children:["ARG",m.jsx("span",{style:{color:s.accentPrimary},children:"scape"})]}),r&&m.jsx("div",{className:"mt-2 text-center",children:m.jsx("div",{className:"text-sm font-medium",style:{color:s.accentPrimary},children:"Visualizing Ancestral Recombination Graphs"})})]})}function qM({isOpen:n,title:e,message:t,buttonText:r="OK",onClose:i,type:s="info"}){if(U.useEffect(()=>{const h=g=>{g.key==="Escape"&&i()};return n&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[n,i]),!n)return null;const o=()=>{switch(s){case"success":return{icon:m.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-green-500/10",buttonColor:"bg-green-600 hover:bg-green-500 text-white"};case"error":return{icon:m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-red-500/10",buttonColor:"bg-red-600 hover:bg-red-500 text-white"};default:return{icon:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-sp-pale-green/10",buttonColor:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}}},{icon:l,bgColor:u,buttonColor:d}=o();return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:i}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u}`,children:l}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("div",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:t}),m.jsx("div",{className:"flex justify-end",children:m.jsx("button",{onClick:i,className:`font-bold py-3 px-6 rounded-xl transition-all duration-200 ${d}`,children:r})})]})})]})}function qx({filename:n,onError:e}){const[t,r]=U.useState(!1),i=async s=>{try{const o=await bt.downloadTreeSequence(n,s),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const d=`${n.replace(/\.(trees|tsz)$/,"")}.${s}`;u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),Se.user.action("download-tree-sequence",{filename:n,format:s},"DownloadDropdown"),r(!1)}catch(o){Se.error("Download failed",{component:"DownloadDropdown",error:o instanceof Error?o:new Error(String(o)),data:{filename:n}}),e&&o instanceof Error&&e(o)}};return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>r(!t),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download",m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),t&&m.jsx("div",{className:"absolute z-50 w-48 mt-2 right-0 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsxs("div",{className:"py-2",children:[m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("trees"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download .trees"]}),m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("tsz"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Download .tsz"]})]})})]})}function $M({isOpen:n,title:e,message:t,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:s,onCancel:o,type:l="default"}){if(U.useEffect(()=>{const d=h=>{h.key==="Escape"&&o()};return n&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}},[n,o]),!n)return null;const u=l==="danger";return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u?"bg-red-500/10":"bg-sp-pale-green/10"}`,children:u?m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("p",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:t}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:o,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:i}),m.jsx("button",{onClick:s,className:`flex-1 font-bold py-3 px-4 rounded-xl transition-all duration-200 ${u?"bg-red-600 hover:bg-red-500 text-white":"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}`,children:r})]})]})})]})}function HM({onSelect:n,className:e=""}){const[t,r]=U.useState([]),[i,s]=U.useState({}),[o,l]=U.useState(!1),[u,d]=U.useState(""),[h,g]=U.useState(new Set),[_,y]=U.useState(-1),{treeSequence:T}=$s(),[w,x]=U.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default"}),[S,A]=U.useState({isOpen:!1,title:"",message:"",type:"info"}),R=async()=>{var k;l(!0);try{Se.data.processing("fetch-available-tree-sequences","TreeSequenceSelector");const X=(await bt.getUploadedFiles()).data;r(X.uploaded_tree_sequences||[]),Se.info(`Loaded ${((k=X.uploaded_tree_sequences)==null?void 0:k.length)||0} tree sequences`,{component:"TreeSequenceSelector",action:"fetch-available"})}catch(V){Se.error("Failed to fetch available tree sequences",{component:"TreeSequenceSelector",error:V instanceof Error?V:new Error(String(V))}),r([])}finally{l(!1)}},E=async k=>{try{Se.data.processing("fetch-metadata","TreeSequenceSelector",void 0,void 0);const X=(await bt.getTreeSequenceMetadata(k)).data;return Se.debug(`Retrieved metadata for ${k}`,{component:"TreeSequenceSelector",data:{filename:k,num_samples:X.num_samples,num_nodes:X.num_nodes}}),{filename:X.filename,num_samples:X.num_samples,num_nodes:X.num_nodes,num_edges:X.num_edges,num_trees:X.num_trees,has_temporal:X.has_temporal,has_sample_spatial:X.has_sample_spatial,has_all_spatial:X.has_all_spatial,spatial_status:X.spatial_status}}catch(V){return Se.error(`Failed to get metadata for ${k}`,{component:"TreeSequenceSelector",error:V instanceof Error?V:new Error(String(V)),data:{filename:k}}),null}};U.useEffect(()=>{R()},[]),U.useEffect(()=>{const k=async()=>{const V={};for(const X of t){const Z=await E(X);Z&&(V[X]=Z)}s(V)};t.length>0&&k()},[t]);const C=()=>{u&&i[u]&&n(i[u])},O=(k,V,X)=>{if((X.shiftKey||X.ctrlKey||X.metaKey)&&X.preventDefault(),X.shiftKey&&_!==-1){const Z=Math.min(_,V),$=Math.max(_,V),H=new Set;for(let z=Z;z<=$;z++)H.add(t[z]);g(H)}else if(X.ctrlKey||X.metaKey){const Z=new Set(h);Z.has(k)?Z.delete(k):Z.add(k),g(Z),y(V)}else d(k),g(new Set([k])),y(V)},D=async(k,V)=>{V.stopPropagation(),x({isOpen:!0,title:"Delete Tree Sequence",message:`Are you sure you want to delete "${k}"?`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{Se.user.action("delete-tree-sequence",{filename:k},"TreeSequenceSelector");const X=await bt.deleteTreeSequence(k);Se.info(`Successfully deleted tree sequence: ${k}`,{component:"TreeSequenceSelector",data:{filename:k}}),r(Z=>Z.filter($=>$!==k)),s(Z=>{const $={...Z};return delete $[k],$}),u===k&&d(""),g(Z=>{const $=new Set(Z);return $.delete(k),$})}catch(X){Se.error("Failed to delete tree sequence",{component:"TreeSequenceSelector",error:X instanceof Error?X:new Error(String(X)),data:{filename:k}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequence: ${X instanceof Error?X.message:"Unknown error"}`,type:"error"})}}})},M=async()=>{if(h.size===0)return;const k=Array.from(h),V=k.length===1?`Are you sure you want to delete "${k[0]}"?`:`Are you sure you want to delete ${k.length} tree sequences?`;x({isOpen:!0,title:"Delete Tree Sequences",message:V,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const X=k.map(Z=>bt.deleteTreeSequence(Z));await Promise.all(X),Se.info(`Successfully deleted ${k.length} tree sequences`,{component:"TreeSequenceSelector",data:{filenames:k}}),r(Z=>Z.filter($=>!k.includes($))),s(Z=>{const $={...Z};return k.forEach(H=>delete $[H]),$}),g(new Set),k.includes(u)&&d("")}catch(X){Se.error("Failed to delete selected tree sequences",{component:"TreeSequenceSelector",error:X instanceof Error?X:new Error(String(X)),data:{filenames:k}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequences: ${X instanceof Error?X.message:"Unknown error"}`,type:"error"})}}})},P=async()=>{t.length!==0&&x({isOpen:!0,title:"Clear All Tree Sequences",message:`Are you sure you want to delete ALL ${t.length} tree sequences? This action cannot be undone.`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const k=t.map(V=>bt.deleteTreeSequence(V));await Promise.all(k),Se.info(`Successfully cleared all ${t.length} tree sequences`,{component:"TreeSequenceSelector",data:{count:t.length}}),r([]),s({}),g(new Set),d("")}catch(k){Se.error("Failed to clear all tree sequences",{component:"TreeSequenceSelector",error:k instanceof Error?k:new Error(String(k))}),A({isOpen:!0,title:"Clear Failed",message:`Failed to clear all tree sequences: ${k instanceof Error?k.message:"Unknown error"}`,type:"error"}),R()}}})};return o?m.jsx("div",{className:`flex items-center justify-center p-8 ${e}`,children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sp-pale-green"})}):t.length===0?m.jsx("div",{className:e,children:m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-8 text-center",children:[m.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[m.jsx("div",{className:"w-10 h-10 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"No Existing Tree Sequences"})]}),m.jsx("p",{className:"text-sp-white/60 text-sm mb-6",children:"No previously uploaded sequences found. Upload or simulate a tree sequence first."}),m.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2 mx-auto",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}):m.jsxs("div",{className:e,children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5 mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Select Existing Tree Sequence"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Choose from previously uploaded sequences"})]}),h.size>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{className:"text-sm text-sp-white/70",children:[h.size," selected"]}),m.jsxs("button",{onClick:M,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-1",title:`Delete ${h.size} selected tree sequence${h.size>1?"s":""}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete"]})]})]}),m.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto select-none",children:t.map((k,V)=>{const X=i[k],Z=(T==null?void 0:T.filename)===k,$=u===k,H=h.has(k);return m.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${$?"border-sp-pale-green bg-sp-very-dark-blue shadow-lg":H?"border-blue-400 bg-sp-very-dark-blue shadow-md":"border-sp-pale-green/20 bg-sp-very-dark-blue hover:border-sp-pale-green/50 hover:shadow-md"} ${Z?"ring-2 ring-sp-pale-green ring-offset-2 ring-offset-sp-dark-blue":""}`,onClick:z=>O(k,V,z),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-shrink-0",children:m.jsx("input",{type:"checkbox",checked:H,onChange:()=>{},className:"w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"font-mono text-sp-pale-green text-sm font-medium truncate",title:k,children:k}),Z&&m.jsx("span",{className:"text-xs bg-sp-pale-green text-sp-very-dark-blue px-2 py-1 rounded-full font-medium",children:"Current"})]}),X?m.jsxs("div",{className:"text-xs text-sp-white/70 space-y-0.5",children:[m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[X.num_samples," samples"]}),m.jsxs("span",{children:[X.num_nodes," nodes"]})]}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[X.num_edges," edges"]}),m.jsxs("span",{children:[X.num_trees," trees"]})]})]}):m.jsx("div",{className:"text-xs text-sp-white/50",children:"Loading info..."})]})]}),m.jsx("button",{onClick:z=>D(k,z),className:"ml-3 text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-400/10 transition-all duration-200",title:"Delete tree sequence",children:m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},k)})}),m.jsx("div",{className:"mt-3 text-xs text-sp-white/60 text-center",children:"Click to select for loading • Ctrl+click to multi-select • Shift+click to select range"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{onClick:C,disabled:!u||!i[u],className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Load Selected"]}),m.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),m.jsxs("button",{onClick:P,disabled:t.length===0,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2",title:"Delete all tree sequences",children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Clear All"]})]}),m.jsx($M,{isOpen:w.isOpen,title:w.title,message:w.message,type:w.type,confirmText:"Delete",cancelText:"Cancel",onConfirm:w.onConfirm,onCancel:()=>x({...w,isOpen:!1})}),m.jsx(qM,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>A({...S,isOpen:!1})})]})}function $x({isOpen:n,onClose:e,onSelect:t}){const{colors:r}=$t();return n?m.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[m.jsx("div",{className:"fixed inset-0 transition-opacity",style:{backgroundColor:`${r.background}CC`},onClick:e}),m.jsx("div",{className:"flex items-start justify-center min-h-screen pt-16 px-4",children:m.jsxs("div",{className:"relative rounded-xl shadow-xl max-w-3xl w-full p-6 border",style:{backgroundColor:r.background,borderColor:r.border},children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h2",{className:"text-lg font-medium",style:{color:r.text},children:"Switch Tree Sequence"}),m.jsx("button",{className:"rounded-lg p-2 transition-colors",style:{color:r.text},onClick:e,onMouseEnter:i=>{i.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent"},children:m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.jsx(HM,{onSelect:t})]})})]}):null}const LB=[{id:"sparg",name:"sparg",description:"Spatial inference using Brownian motion on the full ancestral recombination graph. Modified to include node ID tracking. Best for small ARGs.",reference:"https://www.biorxiv.org/content/10.1101/2024.04.10.588900v2",github:"https://github.com/osmond-lab/sparg",github2:"",speed:1,enabled:!0},{id:"spacetrees",name:"spacetrees",description:"Spatial inference using genome-wide genealogies. Coming Soon!",reference:"https://elifesciences.org/articles/72177",github:"https://github.com/osmond-lab/spacetrees",github2:"",speed:2,enabled:!1},{id:"gaia_quadratic",name:"gaia quadratic",description:"High-accuracy spatial inference using quadratic parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"gaia_linear",name:"gaia linear",description:"High-accuracy spatial inference using linear parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"fastgaia",name:"fastgaia",description:"Fast spatial inference using a greedy algorithm. Best for large ARGs where GAIA is too slow.",reference:"",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/blueraleigh/gaia",speed:4,enabled:!0},{id:"midpoint",name:"Wohns midpoint",description:"Weighted midpoint-based spatial inference. Simple and fast for ARGs of all sizes.",reference:"https://doi.org/10.1126/science.abi8264",github:"https://github.com/awohns/unified_genealogy_paper/",github2:"",speed:5,enabled:!0}];function BB({selectedMethod:n,onMethodSelect:e,disabled:t,isInferring:r,data:i}){const[s,o]=U.useState(!1),[l,u]=U.useState(null),d=LB.map(_=>({..._,isReInference:(i==null?void 0:i.spatial_status)==="all"})),h=d.find(_=>_.enabled),g=d.find(_=>_.id===n)||h||d[0];return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 w-full ${t&&"opacity-50 cursor-not-allowed hover:transform-none"} ${r&&"opacity-75 cursor-not-allowed hover:transform-none"}`,onClick:()=>!t&&!r&&o(!s),disabled:t||r,children:[r&&m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),m.jsx("span",{children:r?"Inferring...":`${g.isReInference?"Re-infer":"Infer"} locations (${g.name})`}),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&m.jsx("div",{className:"absolute z-50 w-full mt-2 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsx("div",{className:"py-2",children:d.map(_=>m.jsxs("div",{className:"relative group",onMouseEnter:()=>u(_),onMouseLeave:y=>{const T=document.querySelector(`[data-tooltip-id="${_.id}"]`);T&&!T.contains(y.relatedTarget)&&u(null)},children:[m.jsx("button",{className:`w-full px-4 py-2 text-left transition-colors duration-200 ${_.enabled?n===_.id?"bg-sp-pale-green/10 hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"text-sp-white/50 cursor-not-allowed"}`,onClick:()=>{_.enabled&&(e(_),o(!1))},disabled:r||!_.enabled,children:m.jsxs("div",{className:"font-medium flex items-center justify-between",children:[m.jsx("span",{children:_.name}),!_.enabled&&m.jsx("span",{className:"text-xs text-sp-pale-green/50",children:"Coming Soon"})]})}),(l==null?void 0:l.id)===_.id&&m.jsxs("div",{"data-tooltip-id":_.id,className:"fixed z-50 w-72 p-4 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",style:{left:"var(--tooltip-x, 0)",top:"var(--tooltip-y, 0)"},ref:y=>{var T;if(y){const w=(T=y.parentElement)==null?void 0:T.getBoundingClientRect();if(w){const x=window.innerHeight-w.bottom,S=w.top,A=y.offsetHeight,R=w.left-y.offsetWidth-8;let E;x>=A?E=w.top:S>=A?E=w.bottom-A:E=Math.max(8,Math.min(window.innerHeight-A-8,w.top-(A-w.height)/2)),y.style.setProperty("--tooltip-x",`${R}px`),y.style.setProperty("--tooltip-y",`${E}px`)}}},onMouseEnter:()=>u(_),onMouseLeave:()=>u(null),children:[m.jsx("h4",{className:"font-bold text-sp-pale-green mb-2",children:l.name}),m.jsx("p",{className:"text-sm text-sp-white/80 mb-2",children:l.description}),m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx("span",{className:"text-xs text-sp-white/80",children:"Speed:"}),m.jsx("div",{className:"flex items-center gap-[2px]",children:[...Array(5)].map((y,T)=>m.jsx("div",{className:`w-3 h-5 rounded-sm transition-all ${T<l.speed?T===0?"bg-yellow-400":T===1?"bg-yellow-500":T===2?"bg-lime-500":T===3?"bg-green-400":"bg-green-500":"bg-gray-700"}`},T))})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[l.reference&&m.jsx("a",{href:l.reference,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View reference"}),l.id==="gaia_quadratic"||l.id==="gaia_linear"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaiapy on GitHub"})]}):l.id==="fastgaia"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View fastgaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"})]}):l.github&&m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View on GitHub"})]})]})]},_.id))})}),m.jsxs("div",{className:"absolute -right-8 top-1/2 transform -translate-y-1/2 group",children:[m.jsx("div",{className:"p-1 cursor-help",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("div",{className:"hidden group-hover:block absolute right-full mr-2 w-64 p-3 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg shadow-xl",children:m.jsx("p",{className:"text-xs text-sp-white/80",children:"Choose from different methods to infer ancestral locations in your ARG. Each method has its own strengths and is optimized for different scenarios."})})]})]})}function UB(){const n=pc(),e=hc(),{treeSequence:t,maxSamples:r,setMaxSamples:i,setTreeSequence:s}=$s(),[o,l]=U.useState(null),[u,d]=U.useState(!1),[h,g]=U.useState(!1),[_,y]=U.useState(!1),[T,w]=U.useState(!1),[x,S]=U.useState(!1),[A,R]=U.useState(!1),[E,C]=U.useState(r.toString()),[O,D]=U.useState("gaia_quadratic"),[M,P]=U.useState({isOpen:!1,title:"",message:"",type:"info"});U.useEffect(()=>{t!=null&&t.num_samples&&l(t.num_samples)},[t]),U.useEffect(()=>{C(r.toString())},[r]);const k=!(t!=null&&t.has_temporal),V=(t==null?void 0:t.spatial_status)==="sample_only"||(t==null?void 0:t.spatial_status)==="all",X=!!(t!=null&&t.has_temporal&&(t!=null&&t.has_all_spatial)),Z=async()=>{if(!(!(t!=null&&t.filename)||u)){d(!0);try{Se.user.action("fast-location-inference-start",{filename:t.filename},"ResultPage");const I=await bt.inferLocationsFast({filename:t.filename,weight_span:!0,weight_branch_length:!0});Se.info("Fast location inference completed successfully",{component:"ResultPage",data:{filename:t.filename,result:I.data}});const q=I.data,ee={...t,filename:q.new_filename,has_sample_spatial:q.has_sample_spatial,has_all_spatial:q.has_all_spatial,spatial_status:q.spatial_status};s(ee),P({isOpen:!0,title:"Success!",message:`Fast location inference completed successfully!
Inferred locations for ${q.num_inferred_locations} nodes.
New file: ${q.new_filename}`,type:"success"})}catch(I){Se.error("Fast location inference failed",{component:"ResultPage",error:I instanceof Error?I:new Error(String(I)),data:{filename:t.filename}}),P({isOpen:!0,title:"Error",message:`Fast location inference failed: ${I instanceof Error?I.message:"Unknown error"}`,type:"error"})}finally{d(!1)}}},$=async()=>{if(!(!(t!=null&&t.filename)||h)){g(!0);try{Se.user.action("gaia-quadratic-inference-start",{filename:t.filename},"ResultPage");const I=await bt.inferLocationsGaiaQuadratic({filename:t.filename});Se.info("GAIA quadratic inference completed successfully",{component:"ResultPage",data:{filename:t.filename,result:I.data}});const q=I.data,ee={...t,filename:q.new_filename,has_sample_spatial:q.has_sample_spatial,has_all_spatial:q.has_all_spatial,spatial_status:q.spatial_status};s(ee),P({isOpen:!0,title:"Success!",message:`GAIA quadratic inference completed successfully!
Inferred locations for ${q.num_inferred_locations} nodes.
New file: ${q.new_filename}`,type:"success"})}catch(I){Se.error("GAIA quadratic inference failed",{component:"ResultPage",error:I instanceof Error?I:new Error(String(I)),data:{filename:t.filename}}),P({isOpen:!0,title:"Error",message:`GAIA quadratic inference failed: ${I instanceof Error?I.message:"Unknown error"}`,type:"error"})}finally{g(!1)}}},H=I=>{Se.user.action("switch-tree-sequence",{treeSequence:I},"ResultPage"),s(I),R(!1)},z=()=>{var q;const I=(q=e.state)==null?void 0:q.fromIntermediate;I?I==="load"?(Se.nav("result","landing"),n("/",{state:{fromInternal:!0}})):(Se.nav("result","intermediate"),n("/",{state:{fromResult:!0,selectedOption:I}})):(Se.nav("result","landing"),n("/",{state:{fromInternal:!0}}))},te=()=>{var q;const I=(q=e.state)==null?void 0:q.fromIntermediate;if(I)switch(I){case"upload":return"Back to Upload";case"simulate":return"Back to Simulate";case"load":return"Back to options";default:return"Back"}return"Back"},fe=async I=>{if(t!=null&&t.filename)switch(I.id){case"fastgaia":await Z();break;case"gaia_quadratic":await $();break;case"gaia_linear":if(_)return;y(!0);try{Se.user.action("gaia-linear-inference-start",{filename:t.filename},"ResultPage");const q=await bt.inferLocationsGaiaLinear({filename:t.filename});Se.info("GAIA linear inference completed successfully",{component:"ResultPage",data:{filename:t.filename,result:q.data}});const ee=q.data,se={...t,filename:ee.new_filename,has_sample_spatial:ee.has_sample_spatial,has_all_spatial:ee.has_all_spatial,spatial_status:ee.spatial_status};s(se),P({isOpen:!0,title:"Success!",message:`GAIA linear inference completed successfully!
Inferred locations for ${ee.num_inferred_locations} nodes.
New file: ${ee.new_filename}`,type:"success"})}catch(q){Se.error("GAIA linear inference failed",{component:"ResultPage",error:q instanceof Error?q:new Error(String(q)),data:{filename:t.filename}}),P({isOpen:!0,title:"Error",message:`GAIA linear inference failed: ${q instanceof Error?q.message:"Unknown error"}`,type:"error"})}finally{y(!1)}break;case"sparg":if(x)return;S(!0);try{Se.user.action("sparg-inference-start",{filename:t.filename},"ResultPage");const q=await bt.inferLocationsSparg({filename:t.filename});Se.info("sparg inference completed successfully",{component:"ResultPage",data:{filename:t.filename,result:q.data}});const ee=q.data,se={...t,filename:ee.new_filename,has_sample_spatial:ee.has_sample_spatial,has_all_spatial:ee.has_all_spatial,spatial_status:ee.spatial_status};s(se),P({isOpen:!0,title:"Success!",message:`sparg inference completed successfully!
Inferred locations for ${ee.num_inferred_locations} nodes.
New file: ${ee.new_filename}`,type:"success"})}catch(q){Se.error("sparg inference failed",{component:"ResultPage",error:q instanceof Error?q:new Error(String(q)),data:{filename:t.filename}}),P({isOpen:!0,title:"Error",message:`sparg inference failed: ${q instanceof Error?q.message:"Unknown error"}`,type:"error"})}finally{S(!1)}break;case"midpoint":if(T)return;w(!0);try{Se.user.action("midpoint-inference-start",{filename:t.filename},"ResultPage");const q=await bt.inferLocationsMidpoint({filename:t.filename});Se.info("Midpoint inference completed successfully",{component:"ResultPage",data:{filename:t.filename,result:q.data}});const ee=q.data,se={...t,filename:ee.new_filename,has_sample_spatial:ee.has_sample_spatial,has_all_spatial:ee.has_all_spatial,spatial_status:ee.spatial_status};s(se),P({isOpen:!0,title:"Success!",message:`Midpoint inference completed successfully!
Inferred locations for ${ee.num_inferred_locations} nodes.
New file: ${ee.new_filename}`,type:"success"})}catch(q){Se.error("Midpoint inference failed",{component:"ResultPage",error:q instanceof Error?q:new Error(String(q)),data:{filename:t.filename}}),P({isOpen:!0,title:"Error",message:`Midpoint inference failed: ${q instanceof Error?q.message:"Unknown error"}`,type:"error"})}finally{w(!1)}break;default:P({isOpen:!0,title:"Not Implemented",message:`The ${I.name} inference method is not yet implemented.`,type:"info"})}},K=u||h||_||T||x;return t?m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",onClick:z,children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),te()]}),m.jsx(gc,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Tree Sequence Analysis"}),m.jsx("p",{className:"text-sp-white/70 text-lg font-mono break-all",children:t.filename})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-wrap gap-3",children:[m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${t.has_temporal?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${t.has_temporal?"text-sp-white":"text-red-400"}`,children:t.has_temporal?"✔️":"✖️"}),"Temporal"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${t.has_sample_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${t.has_sample_spatial?"text-sp-white":"text-red-400"}`,children:t.has_sample_spatial?"✔️":"✖️"}),"Sample Coords"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${t.has_all_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${t.has_all_spatial?"text-sp-white":"text-red-400"}`,children:t.has_all_spatial?"✔️":"✖️"}),"All Coords"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>R(!A),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),A?"Cancel":"Switch Tree Sequence"]}),m.jsx(qx,{filename:t.filename,onError:I=>{P({isOpen:!0,title:"Download Failed",message:`Failed to download tree sequence: ${I.message}`,type:"error"})}})]})]}),m.jsx($x,{isOpen:A,onClose:()=>R(!1),onSelect:H}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:t.num_samples}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Samples"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:t.num_nodes}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Nodes"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:t.num_edges}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Edges"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:t.num_trees}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Local Trees"})]})]}),(t.num_mutations!==void 0||t.num_sites!==void 0||t.num_recombination_nodes!==void 0)&&m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3",children:[m.jsx("h4",{className:"text-sm font-medium text-sp-white mb-2",children:"Additional Statistics"}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.num_mutations!==void 0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[t.num_mutations," mutations"]}),t.num_sites!==void 0&&t.num_sites>0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[t.num_sites," sites"]}),t.num_recombination_nodes!==void 0&&t.num_recombination_nodes>0&&m.jsxs("span",{className:"bg-sp-dark-blue text-sp-white px-2 py-1 rounded text-xs",children:[t.num_recombination_nodes," recombination nodes"]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 ${!k&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!k,onClick:()=>Se.user.action("infer-times-clicked",{filename:t.filename},"ResultPage"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Infer ages (tsdate)"]}),m.jsx(BB,{selectedMethod:O,onMethodSelect:I=>{D(I.id),fe(I)},disabled:!V,isInferring:K,data:t})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Visualization Sample Count"})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("input",{type:"range",id:"sample-slider",min:"2",max:o||Qi.DEFAULT_MAX_SAMPLES,value:Math.max(r,2),onChange:I=>i(parseInt(I.target.value)),className:"flex-1 h-2 bg-sp-dark-blue rounded-lg appearance-none cursor-pointer accent-sp-pale-green"}),m.jsxs("div",{className:"flex items-center gap-2 min-w-[8rem]",children:[m.jsx("input",{type:"number",value:E,onChange:I=>{const q=I.target.value;if(C(q),q!==""){const ee=parseInt(q);isNaN(ee)||i(ee)}},onBlur:I=>{const q=parseInt(I.target.value);let ee=2;isNaN(q)||(ee=Math.max(2,Math.min(q,o||Qi.DEFAULT_MAX_SAMPLES))),i(ee),C(ee.toString())},min:"2",max:o||Qi.DEFAULT_MAX_SAMPLES,className:"w-20 bg-sp-dark-blue border border-sp-pale-green/20 rounded px-2 py-1 text-sm text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green"}),m.jsxs("span",{className:"text-sm font-mono text-sp-white/70",children:["/ ",o||"?"]})]})]}),m.jsxs("div",{className:"mt-2",children:[m.jsx("p",{className:"text-xs text-sp-white/60",children:"Adjust before visualizing to control the number of samples shown (minimum: 2)"}),o&&o>Qi.WARNING_THRESHOLD&&m.jsx("p",{className:"text-xs text-sp-white/60 mt-1",children:"Note: Large sample numbers may affect visualization performance"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[m.jsxs("button",{className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 false",disabled:!1,onClick:()=>n(`/visualize/${encodeURIComponent(t.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Visualize ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"Interactive D3"})]})]}),m.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!X&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!X,onClick:()=>n(`/visualize-spatial/${encodeURIComponent(t.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Spatial ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"3D coordinates"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Pretty ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Pretty ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Huge ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Huge ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]})]})]})})}),m.jsx(qM,{isOpen:M.isOpen,title:M.title,message:M.message,type:M.type,onClose:()=>P({...M,isOpen:!1})})]}):m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-sp-very-dark-blue text-sp-white",children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No data loaded"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4",onClick:z,children:"Back to Home"})]})}var FB={value:()=>{}};function mc(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new df(t)}function df(n){this._=n}function zB(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}df.prototype=mc.prototype={constructor:df,on:function(n,e){var t=this._,r=zB(n+"",t),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(n=r[s]).type)&&(i=VB(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(n=r[s]).type)t[i]=oS(t[i],n.name,e);else if(e==null)for(i in t)t[i]=oS(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new df(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function VB(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function oS(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=FB,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var D0="http://www.w3.org/1999/xhtml";const lS={svg:"http://www.w3.org/2000/svg",xhtml:D0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Nd(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),lS.hasOwnProperty(e)?{space:lS[e],local:n}:n}function qB(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===D0&&e.documentElement.namespaceURI===D0?e.createElement(n):e.createElementNS(t,n)}}function $B(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function WM(n){var e=Nd(n);return(e.local?$B:qB)(e)}function HB(){}function Hx(n){return n==null?HB:function(){return this.querySelector(n)}}function WB(n){typeof n!="function"&&(n=Hx(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,l=r[i]=new Array(o),u,d,h=0;h<o;++h)(u=s[h])&&(d=n.call(u,u.__data__,h,s))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new Gn(r,this._parents)}function XB(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function YB(){return[]}function XM(n){return n==null?YB:function(){return this.querySelectorAll(n)}}function GB(n){return function(){return XB(n.apply(this,arguments))}}function KB(n){typeof n=="function"?n=GB(n):n=XM(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(n.call(u,u.__data__,d,o)),i.push(u));return new Gn(r,i)}function YM(n){return function(){return this.matches(n)}}function GM(n){return function(e){return e.matches(n)}}var ZB=Array.prototype.find;function QB(n){return function(){return ZB.call(this.children,n)}}function JB(){return this.firstElementChild}function eU(n){return this.select(n==null?JB:QB(typeof n=="function"?n:GM(n)))}var tU=Array.prototype.filter;function nU(){return Array.from(this.children)}function rU(n){return function(){return tU.call(this.children,n)}}function iU(n){return this.selectAll(n==null?nU:rU(typeof n=="function"?n:GM(n)))}function sU(n){typeof n!="function"&&(n=YM(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&n.call(u,u.__data__,d,s)&&l.push(u);return new Gn(r,this._parents)}function KM(n){return new Array(n.length)}function aU(){return new Gn(this._enter||this._groups.map(KM),this._parents)}function Ef(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Ef.prototype={constructor:Ef,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function oU(n){return function(){return n}}function lU(n,e,t,r,i,s){for(var o=0,l,u=e.length,d=s.length;o<d;++o)(l=e[o])?(l.__data__=s[o],r[o]=l):t[o]=new Ef(n,s[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function cU(n,e,t,r,i,s,o){var l,u,d=new Map,h=e.length,g=s.length,_=new Array(h),y;for(l=0;l<h;++l)(u=e[l])&&(_[l]=y=o.call(u,u.__data__,l,e)+"",d.has(y)?i[l]=u:d.set(y,u));for(l=0;l<g;++l)y=o.call(n,s[l],l,s)+"",(u=d.get(y))?(r[l]=u,u.__data__=s[l],d.delete(y)):t[l]=new Ef(n,s[l]);for(l=0;l<h;++l)(u=e[l])&&d.get(_[l])===u&&(i[l]=u)}function uU(n){return n.__data__}function fU(n,e){if(!arguments.length)return Array.from(this,uU);var t=e?cU:lU,r=this._parents,i=this._groups;typeof n!="function"&&(n=oU(n));for(var s=i.length,o=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var h=r[d],g=i[d],_=g.length,y=dU(n.call(h,h&&h.__data__,d,r)),T=y.length,w=l[d]=new Array(T),x=o[d]=new Array(T),S=u[d]=new Array(_);t(h,g,w,x,S,y,e);for(var A=0,R=0,E,C;A<T;++A)if(E=w[A]){for(A>=R&&(R=A+1);!(C=x[R])&&++R<T;);E._next=C||null}}return o=new Gn(o,r),o._enter=l,o._exit=u,o}function dU(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function hU(){return new Gn(this._exit||this._groups.map(KM),this._parents)}function pU(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function gU(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),l=new Array(i),u=0;u<o;++u)for(var d=t[u],h=r[u],g=d.length,_=l[u]=new Array(g),y,T=0;T<g;++T)(y=d[T]||h[T])&&(_[T]=y);for(;u<i;++u)l[u]=t[u];return new Gn(l,this._parents)}function mU(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function _U(n){n||(n=vU);function e(g,_){return g&&_?n(g.__data__,_.__data__):!g-!_}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],l=o.length,u=i[s]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(e)}return new Gn(i,this._parents).order()}function vU(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function yU(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function bU(){return Array.from(this)}function xU(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function wU(){let n=0;for(const e of this)++n;return n}function TU(){return!this.node()}function SU(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,l;s<o;++s)(l=i[s])&&n.call(l,l.__data__,s,i);return this}function EU(n){return function(){this.removeAttribute(n)}}function AU(n){return function(){this.removeAttributeNS(n.space,n.local)}}function RU(n,e){return function(){this.setAttribute(n,e)}}function CU(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function NU(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function kU(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function MU(n,e){var t=Nd(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?AU:EU:typeof e=="function"?t.local?kU:NU:t.local?CU:RU)(t,e))}function ZM(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function IU(n){return function(){this.style.removeProperty(n)}}function OU(n,e,t){return function(){this.style.setProperty(n,e,t)}}function PU(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function DU(n,e,t){return arguments.length>1?this.each((e==null?IU:typeof e=="function"?PU:OU)(n,e,t??"")):io(this.node(),n)}function io(n,e){return n.style.getPropertyValue(e)||ZM(n).getComputedStyle(n,null).getPropertyValue(e)}function jU(n){return function(){delete this[n]}}function LU(n,e){return function(){this[n]=e}}function BU(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function UU(n,e){return arguments.length>1?this.each((e==null?jU:typeof e=="function"?BU:LU)(n,e)):this.node()[n]}function QM(n){return n.trim().split(/^|\s+/)}function Wx(n){return n.classList||new JM(n)}function JM(n){this._node=n,this._names=QM(n.getAttribute("class")||"")}JM.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function eI(n,e){for(var t=Wx(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function tI(n,e){for(var t=Wx(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function FU(n){return function(){eI(this,n)}}function zU(n){return function(){tI(this,n)}}function VU(n,e){return function(){(e.apply(this,arguments)?eI:tI)(this,n)}}function qU(n,e){var t=QM(n+"");if(arguments.length<2){for(var r=Wx(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?VU:e?FU:zU)(t,e))}function $U(){this.textContent=""}function HU(n){return function(){this.textContent=n}}function WU(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function XU(n){return arguments.length?this.each(n==null?$U:(typeof n=="function"?WU:HU)(n)):this.node().textContent}function YU(){this.innerHTML=""}function GU(n){return function(){this.innerHTML=n}}function KU(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function ZU(n){return arguments.length?this.each(n==null?YU:(typeof n=="function"?KU:GU)(n)):this.node().innerHTML}function QU(){this.nextSibling&&this.parentNode.appendChild(this)}function JU(){return this.each(QU)}function e8(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function t8(){return this.each(e8)}function n8(n){var e=typeof n=="function"?n:WM(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function r8(){return null}function i8(n,e){var t=typeof n=="function"?n:WM(n),r=e==null?r8:typeof e=="function"?e:Hx(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function s8(){var n=this.parentNode;n&&n.removeChild(this)}function a8(){return this.each(s8)}function o8(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function l8(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function c8(n){return this.select(n?l8:o8)}function u8(n){return arguments.length?this.property("__data__",n):this.node().__data__}function f8(n){return function(e){n.call(this,e,this.__data__)}}function d8(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function h8(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function p8(n,e,t){return function(){var r=this.__on,i,s=f8(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function g8(n,e,t){var r=d8(n+""),i,s=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(i=0,h=l[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(l=e?p8:h8,i=0;i<s;++i)this.each(l(r[i],e,t));return this}function nI(n,e,t){var r=ZM(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function m8(n,e){return function(){return nI(this,n,e)}}function _8(n,e){return function(){return nI(this,n,e.apply(this,arguments))}}function v8(n,e){return this.each((typeof e=="function"?_8:m8)(n,e))}function*y8(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var rI=[null];function Gn(n,e){this._groups=n,this._parents=e}function _c(){return new Gn([[document.documentElement]],rI)}function b8(){return this}Gn.prototype=_c.prototype={constructor:Gn,select:WB,selectAll:KB,selectChild:eU,selectChildren:iU,filter:sU,data:fU,enter:aU,exit:hU,join:pU,merge:gU,selection:b8,order:mU,sort:_U,call:yU,nodes:bU,node:xU,size:wU,empty:TU,each:SU,attr:MU,style:DU,property:UU,classed:qU,text:XU,html:ZU,raise:JU,lower:t8,append:n8,insert:i8,remove:a8,clone:c8,datum:u8,on:g8,dispatch:v8,[Symbol.iterator]:y8};function or(n){return typeof n=="string"?new Gn([[document.querySelector(n)]],[document.documentElement]):new Gn([[n]],rI)}function x8(n){let e;for(;e=n.sourceEvent;)n=e;return n}function ui(n,e){if(n=x8(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}const w8={passive:!1},rc={capture:!0,passive:!1};function Eg(n){n.stopImmediatePropagation()}function eo(n){n.preventDefault(),n.stopImmediatePropagation()}function iI(n){var e=n.document.documentElement,t=or(n).on("dragstart.drag",eo,rc);"onselectstart"in e?t.on("selectstart.drag",eo,rc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function sI(n,e){var t=n.document.documentElement,r=or(n).on("dragstart.drag",null);e&&(r.on("click.drag",eo,rc),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const qu=n=>()=>n;function j0(n,{sourceEvent:e,subject:t,target:r,identifier:i,active:s,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}j0.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function T8(n){return!n.ctrlKey&&!n.button}function S8(){return this.parentNode}function E8(n,e){return e??{x:n.x,y:n.y}}function A8(){return navigator.maxTouchPoints||"ontouchstart"in this}function R8(){var n=T8,e=S8,t=E8,r=A8,i={},s=mc("start","drag","end"),o=0,l,u,d,h,g=0;function _(E){E.on("mousedown.drag",y).filter(r).on("touchstart.drag",x).on("touchmove.drag",S,w8).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(E,C){if(!(h||!n.call(this,E,C))){var O=R(this,e.call(this,E,C),E,C,"mouse");O&&(or(E.view).on("mousemove.drag",T,rc).on("mouseup.drag",w,rc),iI(E.view),Eg(E),d=!1,l=E.clientX,u=E.clientY,O("start",E))}}function T(E){if(eo(E),!d){var C=E.clientX-l,O=E.clientY-u;d=C*C+O*O>g}i.mouse("drag",E)}function w(E){or(E.view).on("mousemove.drag mouseup.drag",null),sI(E.view,d),eo(E),i.mouse("end",E)}function x(E,C){if(n.call(this,E,C)){var O=E.changedTouches,D=e.call(this,E,C),M=O.length,P,k;for(P=0;P<M;++P)(k=R(this,D,E,C,O[P].identifier,O[P]))&&(Eg(E),k("start",E,O[P]))}}function S(E){var C=E.changedTouches,O=C.length,D,M;for(D=0;D<O;++D)(M=i[C[D].identifier])&&(eo(E),M("drag",E,C[D]))}function A(E){var C=E.changedTouches,O=C.length,D,M;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),D=0;D<O;++D)(M=i[C[D].identifier])&&(Eg(E),M("end",E,C[D]))}function R(E,C,O,D,M,P){var k=s.copy(),V=ui(P||O,C),X,Z,$;if(($=t.call(E,new j0("beforestart",{sourceEvent:O,target:_,identifier:M,active:o,x:V[0],y:V[1],dx:0,dy:0,dispatch:k}),D))!=null)return X=$.x-V[0]||0,Z=$.y-V[1]||0,function H(z,te,fe){var K=V,I;switch(z){case"start":i[M]=H,I=o++;break;case"end":delete i[M],--o;case"drag":V=ui(fe||te,C),I=o;break}k.call(z,E,new j0(z,{sourceEvent:te,subject:$,target:_,identifier:M,active:I,x:V[0]+X,y:V[1]+Z,dx:V[0]-K[0],dy:V[1]-K[1],dispatch:k}),D)}}return _.filter=function(E){return arguments.length?(n=typeof E=="function"?E:qu(!!E),_):n},_.container=function(E){return arguments.length?(e=typeof E=="function"?E:qu(E),_):e},_.subject=function(E){return arguments.length?(t=typeof E=="function"?E:qu(E),_):t},_.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:qu(!!E),_):r},_.on=function(){var E=s.on.apply(s,arguments);return E===s?_:E},_.clickDistance=function(E){return arguments.length?(g=(E=+E)*E,_):Math.sqrt(g)},_}function Xx(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function aI(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function vc(){}var ic=.7,Af=1/ic,to="\\s*([+-]?\\d+)\\s*",sc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",C8=/^#([0-9a-f]{3,8})$/,N8=new RegExp(`^rgb\\(${to},${to},${to}\\)$`),k8=new RegExp(`^rgb\\(${qr},${qr},${qr}\\)$`),M8=new RegExp(`^rgba\\(${to},${to},${to},${sc}\\)$`),I8=new RegExp(`^rgba\\(${qr},${qr},${qr},${sc}\\)$`),O8=new RegExp(`^hsl\\(${sc},${qr},${qr}\\)$`),P8=new RegExp(`^hsla\\(${sc},${qr},${qr},${sc}\\)$`),cS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Xx(vc,ac,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:uS,formatHex:uS,formatHex8:D8,formatHsl:j8,formatRgb:fS,toString:fS});function uS(){return this.rgb().formatHex()}function D8(){return this.rgb().formatHex8()}function j8(){return oI(this).formatHsl()}function fS(){return this.rgb().formatRgb()}function ac(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=C8.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?dS(e):t===3?new Pn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?$u(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?$u(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=N8.exec(n))?new Pn(e[1],e[2],e[3],1):(e=k8.exec(n))?new Pn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=M8.exec(n))?$u(e[1],e[2],e[3],e[4]):(e=I8.exec(n))?$u(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=O8.exec(n))?gS(e[1],e[2]/100,e[3]/100,1):(e=P8.exec(n))?gS(e[1],e[2]/100,e[3]/100,e[4]):cS.hasOwnProperty(n)?dS(cS[n]):n==="transparent"?new Pn(NaN,NaN,NaN,0):null}function dS(n){return new Pn(n>>16&255,n>>8&255,n&255,1)}function $u(n,e,t,r){return r<=0&&(n=e=t=NaN),new Pn(n,e,t,r)}function L8(n){return n instanceof vc||(n=ac(n)),n?(n=n.rgb(),new Pn(n.r,n.g,n.b,n.opacity)):new Pn}function L0(n,e,t,r){return arguments.length===1?L8(n):new Pn(n,e,t,r??1)}function Pn(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}Xx(Pn,L0,aI(vc,{brighter(n){return n=n==null?Af:Math.pow(Af,n),new Pn(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?ic:Math.pow(ic,n),new Pn(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Pn(Ms(this.r),Ms(this.g),Ms(this.b),Rf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hS,formatHex:hS,formatHex8:B8,formatRgb:pS,toString:pS}));function hS(){return`#${Cs(this.r)}${Cs(this.g)}${Cs(this.b)}`}function B8(){return`#${Cs(this.r)}${Cs(this.g)}${Cs(this.b)}${Cs((isNaN(this.opacity)?1:this.opacity)*255)}`}function pS(){const n=Rf(this.opacity);return`${n===1?"rgb(":"rgba("}${Ms(this.r)}, ${Ms(this.g)}, ${Ms(this.b)}${n===1?")":`, ${n})`}`}function Rf(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Ms(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Cs(n){return n=Ms(n),(n<16?"0":"")+n.toString(16)}function gS(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Sr(n,e,t,r)}function oI(n){if(n instanceof Sr)return new Sr(n.h,n.s,n.l,n.opacity);if(n instanceof vc||(n=ac(n)),!n)return new Sr;if(n instanceof Sr)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,l=s-i,u=(s+i)/2;return l?(e===s?o=(t-r)/l+(t<r)*6:t===s?o=(r-e)/l+2:o=(e-t)/l+4,l/=u<.5?s+i:2-s-i,o*=60):l=u>0&&u<1?0:o,new Sr(o,l,u,n.opacity)}function U8(n,e,t,r){return arguments.length===1?oI(n):new Sr(n,e,t,r??1)}function Sr(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}Xx(Sr,U8,aI(vc,{brighter(n){return n=n==null?Af:Math.pow(Af,n),new Sr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?ic:Math.pow(ic,n),new Sr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Pn(Ag(n>=240?n-240:n+120,i,r),Ag(n,i,r),Ag(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Sr(mS(this.h),Hu(this.s),Hu(this.l),Rf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Rf(this.opacity);return`${n===1?"hsl(":"hsla("}${mS(this.h)}, ${Hu(this.s)*100}%, ${Hu(this.l)*100}%${n===1?")":`, ${n})`}`}}));function mS(n){return n=(n||0)%360,n<0?n+360:n}function Hu(n){return Math.max(0,Math.min(1,n||0))}function Ag(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const lI=n=>()=>n;function F8(n,e){return function(t){return n+t*e}}function z8(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function V8(n){return(n=+n)==1?cI:function(e,t){return t-e?z8(e,t,n):lI(isNaN(e)?t:e)}}function cI(n,e){var t=e-n;return t?F8(n,t):lI(isNaN(n)?e:n)}const _S=function n(e){var t=V8(e);function r(i,s){var o=t((i=L0(i)).r,(s=L0(s)).r),l=t(i.g,s.g),u=t(i.b,s.b),d=cI(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=l(h),i.b=u(h),i.opacity=d(h),i+""}}return r.gamma=n,r}(1);function Wi(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var B0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Rg=new RegExp(B0.source,"g");function q8(n){return function(){return n}}function $8(n){return function(e){return n(e)+""}}function H8(n,e){var t=B0.lastIndex=Rg.lastIndex=0,r,i,s,o=-1,l=[],u=[];for(n=n+"",e=e+"";(r=B0.exec(n))&&(i=Rg.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),l[o]?l[o]+=s:l[++o]=s),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:Wi(r,i)})),t=Rg.lastIndex;return t<e.length&&(s=e.slice(t),l[o]?l[o]+=s:l[++o]=s),l.length<2?u[0]?$8(u[0].x):q8(e):(e=u.length,function(d){for(var h=0,g;h<e;++h)l[(g=u[h]).i]=g.x(d);return l.join("")})}var vS=180/Math.PI,U0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function uI(n,e,t,r,i,s){var o,l,u;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(u=n*t+e*r)&&(t-=n*u,r-=e*u),(l=Math.sqrt(t*t+r*r))&&(t/=l,r/=l,u/=l),n*r<e*t&&(n=-n,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,n)*vS,skewX:Math.atan(u)*vS,scaleX:o,scaleY:l}}var Wu;function W8(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?U0:uI(e.a,e.b,e.c,e.d,e.e,e.f)}function X8(n){return n==null||(Wu||(Wu=document.createElementNS("http://www.w3.org/2000/svg","g")),Wu.setAttribute("transform",n),!(n=Wu.transform.baseVal.consolidate()))?U0:(n=n.matrix,uI(n.a,n.b,n.c,n.d,n.e,n.f))}function fI(n,e,t,r){function i(d){return d.length?d.pop()+" ":""}function s(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push("translate(",null,e,null,t);T.push({i:w-4,x:Wi(d,g)},{i:w-2,x:Wi(h,_)})}else(g||_)&&y.push("translate("+g+e+_+t)}function o(d,h,g,_){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),_.push({i:g.push(i(g)+"rotate(",null,r)-2,x:Wi(d,h)})):h&&g.push(i(g)+"rotate("+h+r)}function l(d,h,g,_){d!==h?_.push({i:g.push(i(g)+"skewX(",null,r)-2,x:Wi(d,h)}):h&&g.push(i(g)+"skewX("+h+r)}function u(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push(i(y)+"scale(",null,",",null,")");T.push({i:w-4,x:Wi(d,g)},{i:w-2,x:Wi(h,_)})}else(g!==1||_!==1)&&y.push(i(y)+"scale("+g+","+_+")")}return function(d,h){var g=[],_=[];return d=n(d),h=n(h),s(d.translateX,d.translateY,h.translateX,h.translateY,g,_),o(d.rotate,h.rotate,g,_),l(d.skewX,h.skewX,g,_),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,g,_),d=h=null,function(y){for(var T=-1,w=_.length,x;++T<w;)g[(x=_[T]).i]=x.x(y);return g.join("")}}}var Y8=fI(W8,"px, ","px)","deg)"),G8=fI(X8,", ",")",")"),K8=1e-12;function yS(n){return((n=Math.exp(n))+1/n)/2}function Z8(n){return((n=Math.exp(n))-1/n)/2}function Q8(n){return((n=Math.exp(2*n))-1)/(n+1)}const J8=function n(e,t,r){function i(s,o){var l=s[0],u=s[1],d=s[2],h=o[0],g=o[1],_=o[2],y=h-l,T=g-u,w=y*y+T*T,x,S;if(w<K8)S=Math.log(_/d)/e,x=function(D){return[l+D*y,u+D*T,d*Math.exp(e*D*S)]};else{var A=Math.sqrt(w),R=(_*_-d*d+r*w)/(2*d*t*A),E=(_*_-d*d-r*w)/(2*_*t*A),C=Math.log(Math.sqrt(R*R+1)-R),O=Math.log(Math.sqrt(E*E+1)-E);S=(O-C)/e,x=function(D){var M=D*S,P=yS(C),k=d/(t*A)*(P*Q8(e*M+C)-Z8(C));return[l+k*y,u+k*T,d*P/yS(e*M+C)]}}return x.duration=S*1e3*e/Math.SQRT2,x}return i.rho=function(s){var o=Math.max(.001,+s),l=o*o,u=l*l;return n(o,l,u)},i}(Math.SQRT2,2,4);var so=0,Il=0,El=0,dI=1e3,Cf,Ol,Nf=0,Ls=0,kd=0,oc=typeof performance=="object"&&performance.now?performance:Date,hI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Yx(){return Ls||(hI(eF),Ls=oc.now()+kd)}function eF(){Ls=0}function kf(){this._call=this._time=this._next=null}kf.prototype=Gx.prototype={constructor:kf,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?Yx():+t)+(e==null?0:+e),!this._next&&Ol!==this&&(Ol?Ol._next=this:Cf=this,Ol=this),this._call=n,this._time=t,F0()},stop:function(){this._call&&(this._call=null,this._time=1/0,F0())}};function Gx(n,e,t){var r=new kf;return r.restart(n,e,t),r}function tF(){Yx(),++so;for(var n=Cf,e;n;)(e=Ls-n._time)>=0&&n._call.call(void 0,e),n=n._next;--so}function bS(){Ls=(Nf=oc.now())+kd,so=Il=0;try{tF()}finally{so=0,rF(),Ls=0}}function nF(){var n=oc.now(),e=n-Nf;e>dI&&(kd-=e,Nf=n)}function rF(){for(var n,e=Cf,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Cf=t);Ol=n,F0(r)}function F0(n){if(!so){Il&&(Il=clearTimeout(Il));var e=n-Ls;e>24?(n<1/0&&(Il=setTimeout(bS,n-oc.now()-kd)),El&&(El=clearInterval(El))):(El||(Nf=oc.now(),El=setInterval(nF,dI)),so=1,hI(bS))}}function xS(n,e,t){var r=new kf;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}var iF=mc("start","end","cancel","interrupt"),sF=[],pI=0,wS=1,z0=2,hf=3,TS=4,V0=5,pf=6;function Md(n,e,t,r,i,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;aF(n,t,{name:e,index:r,group:i,on:iF,tween:sF,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:pI})}function Kx(n,e){var t=Nr(n,e);if(t.state>pI)throw new Error("too late; already scheduled");return t}function Hr(n,e){var t=Nr(n,e);if(t.state>hf)throw new Error("too late; already running");return t}function Nr(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function aF(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=Gx(s,0,t.time);function s(d){t.state=wS,t.timer.restart(o,t.delay,t.time),t.delay<=d&&o(d-t.delay)}function o(d){var h,g,_,y;if(t.state!==wS)return u();for(h in r)if(y=r[h],y.name===t.name){if(y.state===hf)return xS(o);y.state===TS?(y.state=pf,y.timer.stop(),y.on.call("interrupt",n,n.__data__,y.index,y.group),delete r[h]):+h<e&&(y.state=pf,y.timer.stop(),y.on.call("cancel",n,n.__data__,y.index,y.group),delete r[h])}if(xS(function(){t.state===hf&&(t.state=TS,t.timer.restart(l,t.delay,t.time),l(d))}),t.state=z0,t.on.call("start",n,n.__data__,t.index,t.group),t.state===z0){for(t.state=hf,i=new Array(_=t.tween.length),h=0,g=-1;h<_;++h)(y=t.tween[h].value.call(n,n.__data__,t.index,t.group))&&(i[++g]=y);i.length=g+1}}function l(d){for(var h=d<t.duration?t.ease.call(null,d/t.duration):(t.timer.restart(u),t.state=V0,1),g=-1,_=i.length;++g<_;)i[g].call(n,h);t.state===V0&&(t.on.call("end",n,n.__data__,t.index,t.group),u())}function u(){t.state=pf,t.timer.stop(),delete r[e];for(var d in r)return;delete n.__transition}}function gf(n,e){var t=n.__transition,r,i,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){s=!1;continue}i=r.state>z0&&r.state<V0,r.state=pf,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[o]}s&&delete n.__transition}}function oF(n){return this.each(function(){gf(this,n)})}function lF(n,e){var t,r;return function(){var i=Hr(this,n),s=i.tween;if(s!==t){r=t=s;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function cF(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var s=Hr(this,n),o=s.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:t},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}s.tween=i}}function uF(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=Nr(this.node(),t).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===n)return o.value;return null}return this.each((e==null?lF:cF)(t,n,e))}function Zx(n,e,t){var r=n._id;return n.each(function(){var i=Hr(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return Nr(i,r).value[e]}}function gI(n,e){var t;return(typeof e=="number"?Wi:e instanceof ac?_S:(t=ac(e))?(e=t,_S):H8)(n,e)}function fF(n){return function(){this.removeAttribute(n)}}function dF(n){return function(){this.removeAttributeNS(n.space,n.local)}}function hF(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttribute(n);return o===i?null:o===r?s:s=e(r=o,t)}}function pF(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===i?null:o===r?s:s=e(r=o,t)}}function gF(n,e,t){var r,i,s;return function(){var o,l=t(this),u;return l==null?void this.removeAttribute(n):(o=this.getAttribute(n),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function mF(n,e,t){var r,i,s;return function(){var o,l=t(this),u;return l==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function _F(n,e){var t=Nd(n),r=t==="transform"?G8:gI;return this.attrTween(n,typeof e=="function"?(t.local?mF:gF)(t,r,Zx(this,"attr."+n,e)):e==null?(t.local?dF:fF)(t):(t.local?pF:hF)(t,r,e))}function vF(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function yF(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function bF(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&yF(n,s)),t}return i._value=e,i}function xF(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&vF(n,s)),t}return i._value=e,i}function wF(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=Nd(n);return this.tween(t,(r.local?bF:xF)(r,e))}function TF(n,e){return function(){Kx(this,n).delay=+e.apply(this,arguments)}}function SF(n,e){return e=+e,function(){Kx(this,n).delay=e}}function EF(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?TF:SF)(e,n)):Nr(this.node(),e).delay}function AF(n,e){return function(){Hr(this,n).duration=+e.apply(this,arguments)}}function RF(n,e){return e=+e,function(){Hr(this,n).duration=e}}function CF(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?AF:RF)(e,n)):Nr(this.node(),e).duration}function NF(n,e){if(typeof e!="function")throw new Error;return function(){Hr(this,n).ease=e}}function kF(n){var e=this._id;return arguments.length?this.each(NF(e,n)):Nr(this.node(),e).ease}function MF(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Hr(this,n).ease=t}}function IF(n){if(typeof n!="function")throw new Error;return this.each(MF(this._id,n))}function OF(n){typeof n!="function"&&(n=YM(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&n.call(u,u.__data__,d,s)&&l.push(u);return new gi(r,this._parents,this._name,this._id)}function PF(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),o=new Array(r),l=0;l<s;++l)for(var u=e[l],d=t[l],h=u.length,g=o[l]=new Array(h),_,y=0;y<h;++y)(_=u[y]||d[y])&&(g[y]=_);for(;l<r;++l)o[l]=e[l];return new gi(o,this._parents,this._name,this._id)}function DF(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function jF(n,e,t){var r,i,s=DF(e)?Kx:Hr;return function(){var o=s(this,n),l=o.on;l!==r&&(i=(r=l).copy()).on(e,t),o.on=i}}function LF(n,e){var t=this._id;return arguments.length<2?Nr(this.node(),t).on.on(n):this.each(jF(t,n,e))}function BF(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function UF(){return this.on("end.remove",BF(this._id))}function FF(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Hx(n));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=s[o]=new Array(u),h,g,_=0;_<u;++_)(h=l[_])&&(g=n.call(h,h.__data__,_,l))&&("__data__"in h&&(g.__data__=h.__data__),d[_]=g,Md(d[_],e,t,_,d,Nr(h,t)));return new gi(s,this._parents,e,t)}function zF(n){var e=this._name,t=this._id;typeof n!="function"&&(n=XM(n));for(var r=this._groups,i=r.length,s=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,h,g=0;g<d;++g)if(h=u[g]){for(var _=n.call(h,h.__data__,g,u),y,T=Nr(h,t),w=0,x=_.length;w<x;++w)(y=_[w])&&Md(y,e,t,w,_,T);s.push(_),o.push(h)}return new gi(s,o,e,t)}var VF=_c.prototype.constructor;function qF(){return new VF(this._groups,this._parents)}function $F(n,e){var t,r,i;return function(){var s=io(this,n),o=(this.style.removeProperty(n),io(this,n));return s===o?null:s===t&&o===r?i:i=e(t=s,r=o)}}function mI(n){return function(){this.style.removeProperty(n)}}function HF(n,e,t){var r,i=t+"",s;return function(){var o=io(this,n);return o===i?null:o===r?s:s=e(r=o,t)}}function WF(n,e,t){var r,i,s;return function(){var o=io(this,n),l=t(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(n),io(this,n))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l))}}function XF(n,e){var t,r,i,s="style."+e,o="end."+s,l;return function(){var u=Hr(this,n),d=u.on,h=u.value[s]==null?l||(l=mI(e)):void 0;(d!==t||i!==h)&&(r=(t=d).copy()).on(o,i=h),u.on=r}}function YF(n,e,t){var r=(n+="")=="transform"?Y8:gI;return e==null?this.styleTween(n,$F(n,r)).on("end.style."+n,mI(n)):typeof e=="function"?this.styleTween(n,WF(n,r,Zx(this,"style."+n,e))).each(XF(this._id,n)):this.styleTween(n,HF(n,r,e),t).on("end.style."+n,null)}function GF(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function KF(n,e,t){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&GF(n,o,t)),r}return s._value=e,s}function ZF(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,KF(n,e,t??""))}function QF(n){return function(){this.textContent=n}}function JF(n){return function(){var e=n(this);this.textContent=e??""}}function e5(n){return this.tween("text",typeof n=="function"?JF(Zx(this,"text",n)):QF(n==null?"":n+""))}function t5(n){return function(e){this.textContent=n.call(this,e)}}function n5(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&t5(i)),e}return r._value=n,r}function r5(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,n5(n))}function i5(){for(var n=this._name,e=this._id,t=_I(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=Nr(u,e);Md(u,n,t,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new gi(r,this._parents,n,t)}function s5(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(s,o){var l={value:o},u={value:function(){--i===0&&s()}};t.each(function(){var d=Hr(this,r),h=d.on;h!==n&&(e=(n=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&s()})}var a5=0;function gi(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function _I(){return++a5}var ci=_c.prototype;gi.prototype={constructor:gi,select:FF,selectAll:zF,selectChild:ci.selectChild,selectChildren:ci.selectChildren,filter:OF,merge:PF,selection:qF,transition:i5,call:ci.call,nodes:ci.nodes,node:ci.node,size:ci.size,empty:ci.empty,each:ci.each,on:LF,attr:_F,attrTween:wF,style:YF,styleTween:ZF,text:e5,textTween:r5,remove:UF,tween:uF,delay:EF,duration:CF,ease:kF,easeVarying:IF,end:s5,[Symbol.iterator]:ci[Symbol.iterator]};function o5(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var l5={time:null,delay:0,duration:250,ease:o5};function c5(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function u5(n){var e,t;n instanceof gi?(e=n._id,n=n._name):(e=_I(),(t=l5).time=Yx(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&Md(u,n,e,d,o,t||c5(u,e));return new gi(r,this._parents,n,e)}_c.prototype.interrupt=oF;_c.prototype.transition=u5;function f5(n){const e=+this._x.call(null,n),t=+this._y.call(null,n);return vI(this.cover(e,t),e,t,n)}function vI(n,e,t,r){if(isNaN(e)||isNaN(t))return n;var i,s=n._root,o={data:r},l=n._x0,u=n._y0,d=n._x1,h=n._y1,g,_,y,T,w,x,S,A;if(!s)return n._root=o,n;for(;s.length;)if((w=e>=(g=(l+d)/2))?l=g:d=g,(x=t>=(_=(u+h)/2))?u=_:h=_,i=s,!(s=s[S=x<<1|w]))return i[S]=o,n;if(y=+n._x.call(null,s.data),T=+n._y.call(null,s.data),e===y&&t===T)return o.next=s,i?i[S]=o:n._root=o,n;do i=i?i[S]=new Array(4):n._root=new Array(4),(w=e>=(g=(l+d)/2))?l=g:d=g,(x=t>=(_=(u+h)/2))?u=_:h=_;while((S=x<<1|w)===(A=(T>=_)<<1|y>=g));return i[A]=s,i[S]=o,n}function d5(n){var e,t,r=n.length,i,s,o=new Array(r),l=new Array(r),u=1/0,d=1/0,h=-1/0,g=-1/0;for(t=0;t<r;++t)isNaN(i=+this._x.call(null,e=n[t]))||isNaN(s=+this._y.call(null,e))||(o[t]=i,l[t]=s,i<u&&(u=i),i>h&&(h=i),s<d&&(d=s),s>g&&(g=s));if(u>h||d>g)return this;for(this.cover(u,d).cover(h,g),t=0;t<r;++t)vI(this,o[t],l[t],n[t]);return this}function h5(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var t=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(t))i=(t=Math.floor(n))+1,s=(r=Math.floor(e))+1;else{for(var o=i-t||1,l=this._root,u,d;t>n||n>=i||r>e||e>=s;)switch(d=(e<r)<<1|n<t,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:i=t+o,s=r+o;break;case 1:t=i-o,s=r+o;break;case 2:i=t+o,r=s-o;break;case 3:t=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=t,this._y0=r,this._x1=i,this._y1=s,this}function p5(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function g5(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Sn(n,e,t,r,i){this.node=n,this.x0=e,this.y0=t,this.x1=r,this.y1=i}function m5(n,e,t){var r,i=this._x0,s=this._y0,o,l,u,d,h=this._x1,g=this._y1,_=[],y=this._root,T,w;for(y&&_.push(new Sn(y,i,s,h,g)),t==null?t=1/0:(i=n-t,s=e-t,h=n+t,g=e+t,t*=t);T=_.pop();)if(!(!(y=T.node)||(o=T.x0)>h||(l=T.y0)>g||(u=T.x1)<i||(d=T.y1)<s))if(y.length){var x=(o+u)/2,S=(l+d)/2;_.push(new Sn(y[3],x,S,u,d),new Sn(y[2],o,S,x,d),new Sn(y[1],x,l,u,S),new Sn(y[0],o,l,x,S)),(w=(e>=S)<<1|n>=x)&&(T=_[_.length-1],_[_.length-1]=_[_.length-1-w],_[_.length-1-w]=T)}else{var A=n-+this._x.call(null,y.data),R=e-+this._y.call(null,y.data),E=A*A+R*R;if(E<t){var C=Math.sqrt(t=E);i=n-C,s=e-C,h=n+C,g=e+C,r=y.data}}return r}function _5(n){if(isNaN(h=+this._x.call(null,n))||isNaN(g=+this._y.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,g,_,y,T,w,x,S;if(!t)return this;if(t.length)for(;;){if((T=h>=(_=(o+u)/2))?o=_:u=_,(w=g>=(y=(l+d)/2))?l=y:d=y,e=t,!(t=t[x=w<<1|T]))return this;if(!t.length)break;(e[x+1&3]||e[x+2&3]||e[x+3&3])&&(r=e,S=x)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[x]=s:delete e[x],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[S]=t:this._root=t),this):(this._root=s,this)}function v5(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function y5(){return this._root}function b5(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function x5(n){var e=[],t,r=this._root,i,s,o,l,u;for(r&&e.push(new Sn(r,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,l=t.x1,u=t.y1)&&r.length){var d=(s+l)/2,h=(o+u)/2;(i=r[3])&&e.push(new Sn(i,d,h,l,u)),(i=r[2])&&e.push(new Sn(i,s,h,d,u)),(i=r[1])&&e.push(new Sn(i,d,o,l,h)),(i=r[0])&&e.push(new Sn(i,s,o,d,h))}return this}function w5(n){var e=[],t=[],r;for(this._root&&e.push(new Sn(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,l=r.y0,u=r.x1,d=r.y1,h=(o+u)/2,g=(l+d)/2;(s=i[0])&&e.push(new Sn(s,o,l,h,g)),(s=i[1])&&e.push(new Sn(s,h,l,u,g)),(s=i[2])&&e.push(new Sn(s,o,g,h,d)),(s=i[3])&&e.push(new Sn(s,h,g,u,d))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function T5(n){return n[0]}function S5(n){return arguments.length?(this._x=n,this):this._x}function E5(n){return n[1]}function A5(n){return arguments.length?(this._y=n,this):this._y}function Qx(n,e,t){var r=new Jx(e??T5,t??E5,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function Jx(n,e,t,r,i,s){this._x=n,this._y=e,this._x0=t,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function SS(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var An=Qx.prototype=Jx.prototype;An.copy=function(){var n=new Jx(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=SS(e),n;for(t=[{source:e,target:n._root=new Array(4)}];e=t.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=SS(r));return n};An.add=f5;An.addAll=d5;An.cover=h5;An.data=p5;An.extent=g5;An.find=m5;An.remove=_5;An.removeAll=v5;An.root=y5;An.size=b5;An.visit=x5;An.visitAfter=w5;An.x=S5;An.y=A5;function En(n){return function(){return n}}function Ji(n){return(n()-.5)*1e-6}function R5(n){return n.x+n.vx}function C5(n){return n.y+n.vy}function N5(n){var e,t,r,i=1,s=1;typeof n!="function"&&(n=En(n==null?1:+n));function o(){for(var d,h=e.length,g,_,y,T,w,x,S=0;S<s;++S)for(g=Qx(e,R5,C5).visitAfter(l),d=0;d<h;++d)_=e[d],w=t[_.index],x=w*w,y=_.x+_.vx,T=_.y+_.vy,g.visit(A);function A(R,E,C,O,D){var M=R.data,P=R.r,k=w+P;if(M){if(M.index>_.index){var V=y-M.x-M.vx,X=T-M.y-M.vy,Z=V*V+X*X;Z<k*k&&(V===0&&(V=Ji(r),Z+=V*V),X===0&&(X=Ji(r),Z+=X*X),Z=(k-(Z=Math.sqrt(Z)))/Z*i,_.vx+=(V*=Z)*(k=(P*=P)/(x+P)),_.vy+=(X*=Z)*k,M.vx-=V*(k=1-k),M.vy-=X*k)}return}return E>y+k||O<y-k||C>T+k||D<T-k}}function l(d){if(d.data)return d.r=t[d.data.index];for(var h=d.r=0;h<4;++h)d[h]&&d[h].r>d.r&&(d.r=d[h].r)}function u(){if(e){var d,h=e.length,g;for(t=new Array(h),d=0;d<h;++d)g=e[d],t[g.index]=+n(g,d,e)}}return o.initialize=function(d,h){e=d,r=h,u()},o.iterations=function(d){return arguments.length?(s=+d,o):s},o.strength=function(d){return arguments.length?(i=+d,o):i},o.radius=function(d){return arguments.length?(n=typeof d=="function"?d:En(+d),u(),o):n},o}function k5(n){return n.index}function ES(n,e){var t=n.get(e);if(!t)throw new Error("node not found: "+e);return t}function M5(n){var e=k5,t=g,r,i=En(30),s,o,l,u,d,h=1;n==null&&(n=[]);function g(x){return 1/Math.min(l[x.source.index],l[x.target.index])}function _(x){for(var S=0,A=n.length;S<h;++S)for(var R=0,E,C,O,D,M,P,k;R<A;++R)E=n[R],C=E.source,O=E.target,D=O.x+O.vx-C.x-C.vx||Ji(d),M=O.y+O.vy-C.y-C.vy||Ji(d),P=Math.sqrt(D*D+M*M),P=(P-s[R])/P*x*r[R],D*=P,M*=P,O.vx-=D*(k=u[R]),O.vy-=M*k,C.vx+=D*(k=1-k),C.vy+=M*k}function y(){if(o){var x,S=o.length,A=n.length,R=new Map(o.map((C,O)=>[e(C,O,o),C])),E;for(x=0,l=new Array(S);x<A;++x)E=n[x],E.index=x,typeof E.source!="object"&&(E.source=ES(R,E.source)),typeof E.target!="object"&&(E.target=ES(R,E.target)),l[E.source.index]=(l[E.source.index]||0)+1,l[E.target.index]=(l[E.target.index]||0)+1;for(x=0,u=new Array(A);x<A;++x)E=n[x],u[x]=l[E.source.index]/(l[E.source.index]+l[E.target.index]);r=new Array(A),T(),s=new Array(A),w()}}function T(){if(o)for(var x=0,S=n.length;x<S;++x)r[x]=+t(n[x],x,n)}function w(){if(o)for(var x=0,S=n.length;x<S;++x)s[x]=+i(n[x],x,n)}return _.initialize=function(x,S){o=x,d=S,y()},_.links=function(x){return arguments.length?(n=x,y(),_):n},_.id=function(x){return arguments.length?(e=x,_):e},_.iterations=function(x){return arguments.length?(h=+x,_):h},_.strength=function(x){return arguments.length?(t=typeof x=="function"?x:En(+x),T(),_):t},_.distance=function(x){return arguments.length?(i=typeof x=="function"?x:En(+x),w(),_):i},_}const I5=1664525,O5=1013904223,AS=4294967296;function P5(){let n=1;return()=>(n=(I5*n+O5)%AS)/AS}function D5(n){return n.x}function j5(n){return n.y}var L5=10,B5=Math.PI*(3-Math.sqrt(5));function U5(n){var e,t=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,l=new Map,u=Gx(g),d=mc("tick","end"),h=P5();n==null&&(n=[]);function g(){_(),d.call("tick",e),t<r&&(u.stop(),d.call("end",e))}function _(w){var x,S=n.length,A;w===void 0&&(w=1);for(var R=0;R<w;++R)for(t+=(s-t)*i,l.forEach(function(E){E(t)}),x=0;x<S;++x)A=n[x],A.fx==null?A.x+=A.vx*=o:(A.x=A.fx,A.vx=0),A.fy==null?A.y+=A.vy*=o:(A.y=A.fy,A.vy=0);return e}function y(){for(var w=0,x=n.length,S;w<x;++w){if(S=n[w],S.index=w,S.fx!=null&&(S.x=S.fx),S.fy!=null&&(S.y=S.fy),isNaN(S.x)||isNaN(S.y)){var A=L5*Math.sqrt(.5+w),R=w*B5;S.x=A*Math.cos(R),S.y=A*Math.sin(R)}(isNaN(S.vx)||isNaN(S.vy))&&(S.vx=S.vy=0)}}function T(w){return w.initialize&&w.initialize(n,h),w}return y(),e={tick:_,restart:function(){return u.restart(g),e},stop:function(){return u.stop(),e},nodes:function(w){return arguments.length?(n=w,y(),l.forEach(T),e):n},alpha:function(w){return arguments.length?(t=+w,e):t},alphaMin:function(w){return arguments.length?(r=+w,e):r},alphaDecay:function(w){return arguments.length?(i=+w,e):+i},alphaTarget:function(w){return arguments.length?(s=+w,e):s},velocityDecay:function(w){return arguments.length?(o=1-w,e):1-o},randomSource:function(w){return arguments.length?(h=w,l.forEach(T),e):h},force:function(w,x){return arguments.length>1?(x==null?l.delete(w):l.set(w,T(x)),e):l.get(w)},find:function(w,x,S){var A=0,R=n.length,E,C,O,D,M;for(S==null?S=1/0:S*=S,A=0;A<R;++A)D=n[A],E=w-D.x,C=x-D.y,O=E*E+C*C,O<S&&(M=D,S=O);return M},on:function(w,x){return arguments.length>1?(d.on(w,x),e):d.on(w)}}}function F5(){var n,e,t,r,i=En(-30),s,o=1,l=1/0,u=.81;function d(y){var T,w=n.length,x=Qx(n,D5,j5).visitAfter(g);for(r=y,T=0;T<w;++T)e=n[T],x.visit(_)}function h(){if(n){var y,T=n.length,w;for(s=new Array(T),y=0;y<T;++y)w=n[y],s[w.index]=+i(w,y,n)}}function g(y){var T=0,w,x,S=0,A,R,E;if(y.length){for(A=R=E=0;E<4;++E)(w=y[E])&&(x=Math.abs(w.value))&&(T+=w.value,S+=x,A+=x*w.x,R+=x*w.y);y.x=A/S,y.y=R/S}else{w=y,w.x=w.data.x,w.y=w.data.y;do T+=s[w.data.index];while(w=w.next)}y.value=T}function _(y,T,w,x){if(!y.value)return!0;var S=y.x-e.x,A=y.y-e.y,R=x-T,E=S*S+A*A;if(R*R/u<E)return E<l&&(S===0&&(S=Ji(t),E+=S*S),A===0&&(A=Ji(t),E+=A*A),E<o&&(E=Math.sqrt(o*E)),e.vx+=S*y.value*r/E,e.vy+=A*y.value*r/E),!0;if(y.length||E>=l)return;(y.data!==e||y.next)&&(S===0&&(S=Ji(t),E+=S*S),A===0&&(A=Ji(t),E+=A*A),E<o&&(E=Math.sqrt(o*E)));do y.data!==e&&(R=s[y.data.index]*r/E,e.vx+=S*R,e.vy+=A*R);while(y=y.next)}return d.initialize=function(y,T){n=y,t=T,h()},d.strength=function(y){return arguments.length?(i=typeof y=="function"?y:En(+y),h(),d):i},d.distanceMin=function(y){return arguments.length?(o=y*y,d):Math.sqrt(o)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(u=y*y,d):Math.sqrt(u)},d}function z5(n){var e=En(.1),t,r,i;typeof n!="function"&&(n=En(n==null?0:+n));function s(l){for(var u=0,d=t.length,h;u<d;++u)h=t[u],h.vx+=(i[u]-h.x)*r[u]*l}function o(){if(t){var l,u=t.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+n(t[l],l,t))?0:+e(t[l],l,t)}}return s.initialize=function(l){t=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:En(+l),o(),s):e},s.x=function(l){return arguments.length?(n=typeof l=="function"?l:En(+l),o(),s):n},s}function V5(n){var e=En(.1),t,r,i;typeof n!="function"&&(n=En(n==null?0:+n));function s(l){for(var u=0,d=t.length,h;u<d;++u)h=t[u],h.vy+=(i[u]-h.y)*r[u]*l}function o(){if(t){var l,u=t.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+n(t[l],l,t))?0:+e(t[l],l,t)}}return s.initialize=function(l){t=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:En(+l),o(),s):e},s.y=function(l){return arguments.length?(n=typeof l=="function"?l:En(+l),o(),s):n},s}const Xu=n=>()=>n;function q5(n,{sourceEvent:e,target:t,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function pi(n,e,t){this.k=n,this.x=e,this.y=t}pi.prototype={constructor:pi,scale:function(n){return n===1?this:new pi(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new pi(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Id=new pi(1,0,0);pi.prototype;function Cg(n){n.stopImmediatePropagation()}function Al(n){n.preventDefault(),n.stopImmediatePropagation()}function $5(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function H5(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function RS(){return this.__zoom||Id}function W5(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function X5(){return navigator.maxTouchPoints||"ontouchstart"in this}function Y5(n,e,t){var r=n.invertX(e[0][0])-t[0][0],i=n.invertX(e[1][0])-t[1][0],s=n.invertY(e[0][1])-t[0][1],o=n.invertY(e[1][1])-t[1][1];return n.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function G5(){var n=$5,e=H5,t=Y5,r=W5,i=X5,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=J8,d=mc("start","zoom","end"),h,g,_,y=500,T=150,w=0,x=10;function S($){$.property("__zoom",RS).on("wheel.zoom",M,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",k).filter(i).on("touchstart.zoom",V).on("touchmove.zoom",X).on("touchend.zoom touchcancel.zoom",Z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}S.transform=function($,H,z,te){var fe=$.selection?$.selection():$;fe.property("__zoom",RS),$!==fe?C($,H,z,te):fe.interrupt().each(function(){O(this,arguments).event(te).start().zoom(null,typeof H=="function"?H.apply(this,arguments):H).end()})},S.scaleBy=function($,H,z,te){S.scaleTo($,function(){var fe=this.__zoom.k,K=typeof H=="function"?H.apply(this,arguments):H;return fe*K},z,te)},S.scaleTo=function($,H,z,te){S.transform($,function(){var fe=e.apply(this,arguments),K=this.__zoom,I=z==null?E(fe):typeof z=="function"?z.apply(this,arguments):z,q=K.invert(I),ee=typeof H=="function"?H.apply(this,arguments):H;return t(R(A(K,ee),I,q),fe,o)},z,te)},S.translateBy=function($,H,z,te){S.transform($,function(){return t(this.__zoom.translate(typeof H=="function"?H.apply(this,arguments):H,typeof z=="function"?z.apply(this,arguments):z),e.apply(this,arguments),o)},null,te)},S.translateTo=function($,H,z,te,fe){S.transform($,function(){var K=e.apply(this,arguments),I=this.__zoom,q=te==null?E(K):typeof te=="function"?te.apply(this,arguments):te;return t(Id.translate(q[0],q[1]).scale(I.k).translate(typeof H=="function"?-H.apply(this,arguments):-H,typeof z=="function"?-z.apply(this,arguments):-z),K,o)},te,fe)};function A($,H){return H=Math.max(s[0],Math.min(s[1],H)),H===$.k?$:new pi(H,$.x,$.y)}function R($,H,z){var te=H[0]-z[0]*$.k,fe=H[1]-z[1]*$.k;return te===$.x&&fe===$.y?$:new pi($.k,te,fe)}function E($){return[(+$[0][0]+ +$[1][0])/2,(+$[0][1]+ +$[1][1])/2]}function C($,H,z,te){$.on("start.zoom",function(){O(this,arguments).event(te).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(te).end()}).tween("zoom",function(){var fe=this,K=arguments,I=O(fe,K).event(te),q=e.apply(fe,K),ee=z==null?E(q):typeof z=="function"?z.apply(fe,K):z,se=Math.max(q[1][0]-q[0][0],q[1][1]-q[0][1]),B=fe.__zoom,Y=typeof H=="function"?H.apply(fe,K):H,Q=u(B.invert(ee).concat(se/B.k),Y.invert(ee).concat(se/Y.k));return function(pe){if(pe===1)pe=Y;else{var ye=Q(pe),Ee=se/ye[2];pe=new pi(Ee,ee[0]-ye[0]*Ee,ee[1]-ye[1]*Ee)}I.zoom(null,pe)}})}function O($,H,z){return!z&&$.__zooming||new D($,H)}function D($,H){this.that=$,this.args=H,this.active=0,this.sourceEvent=null,this.extent=e.apply($,H),this.taps=0}D.prototype={event:function($){return $&&(this.sourceEvent=$),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function($,H){return this.mouse&&$!=="mouse"&&(this.mouse[1]=H.invert(this.mouse[0])),this.touch0&&$!=="touch"&&(this.touch0[1]=H.invert(this.touch0[0])),this.touch1&&$!=="touch"&&(this.touch1[1]=H.invert(this.touch1[0])),this.that.__zoom=H,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function($){var H=or(this.that).datum();d.call($,this.that,new q5($,{sourceEvent:this.sourceEvent,target:S,transform:this.that.__zoom,dispatch:d}),H)}};function M($,...H){if(!n.apply(this,arguments))return;var z=O(this,H).event($),te=this.__zoom,fe=Math.max(s[0],Math.min(s[1],te.k*Math.pow(2,r.apply(this,arguments)))),K=ui($);if(z.wheel)(z.mouse[0][0]!==K[0]||z.mouse[0][1]!==K[1])&&(z.mouse[1]=te.invert(z.mouse[0]=K)),clearTimeout(z.wheel);else{if(te.k===fe)return;z.mouse=[K,te.invert(K)],gf(this),z.start()}Al($),z.wheel=setTimeout(I,T),z.zoom("mouse",t(R(A(te,fe),z.mouse[0],z.mouse[1]),z.extent,o));function I(){z.wheel=null,z.end()}}function P($,...H){if(_||!n.apply(this,arguments))return;var z=$.currentTarget,te=O(this,H,!0).event($),fe=or($.view).on("mousemove.zoom",ee,!0).on("mouseup.zoom",se,!0),K=ui($,z),I=$.clientX,q=$.clientY;iI($.view),Cg($),te.mouse=[K,this.__zoom.invert(K)],gf(this),te.start();function ee(B){if(Al(B),!te.moved){var Y=B.clientX-I,Q=B.clientY-q;te.moved=Y*Y+Q*Q>w}te.event(B).zoom("mouse",t(R(te.that.__zoom,te.mouse[0]=ui(B,z),te.mouse[1]),te.extent,o))}function se(B){fe.on("mousemove.zoom mouseup.zoom",null),sI(B.view,te.moved),Al(B),te.event(B).end()}}function k($,...H){if(n.apply(this,arguments)){var z=this.__zoom,te=ui($.changedTouches?$.changedTouches[0]:$,this),fe=z.invert(te),K=z.k*($.shiftKey?.5:2),I=t(R(A(z,K),te,fe),e.apply(this,H),o);Al($),l>0?or(this).transition().duration(l).call(C,I,te,$):or(this).call(S.transform,I,te,$)}}function V($,...H){if(n.apply(this,arguments)){var z=$.touches,te=z.length,fe=O(this,H,$.changedTouches.length===te).event($),K,I,q,ee;for(Cg($),I=0;I<te;++I)q=z[I],ee=ui(q,this),ee=[ee,this.__zoom.invert(ee),q.identifier],fe.touch0?!fe.touch1&&fe.touch0[2]!==ee[2]&&(fe.touch1=ee,fe.taps=0):(fe.touch0=ee,K=!0,fe.taps=1+!!h);h&&(h=clearTimeout(h)),K&&(fe.taps<2&&(g=ee[0],h=setTimeout(function(){h=null},y)),gf(this),fe.start())}}function X($,...H){if(this.__zooming){var z=O(this,H).event($),te=$.changedTouches,fe=te.length,K,I,q,ee;for(Al($),K=0;K<fe;++K)I=te[K],q=ui(I,this),z.touch0&&z.touch0[2]===I.identifier?z.touch0[0]=q:z.touch1&&z.touch1[2]===I.identifier&&(z.touch1[0]=q);if(I=z.that.__zoom,z.touch1){var se=z.touch0[0],B=z.touch0[1],Y=z.touch1[0],Q=z.touch1[1],pe=(pe=Y[0]-se[0])*pe+(pe=Y[1]-se[1])*pe,ye=(ye=Q[0]-B[0])*ye+(ye=Q[1]-B[1])*ye;I=A(I,Math.sqrt(pe/ye)),q=[(se[0]+Y[0])/2,(se[1]+Y[1])/2],ee=[(B[0]+Q[0])/2,(B[1]+Q[1])/2]}else if(z.touch0)q=z.touch0[0],ee=z.touch0[1];else return;z.zoom("touch",t(R(I,q,ee),z.extent,o))}}function Z($,...H){if(this.__zooming){var z=O(this,H).event($),te=$.changedTouches,fe=te.length,K,I;for(Cg($),_&&clearTimeout(_),_=setTimeout(function(){_=null},y),K=0;K<fe;++K)I=te[K],z.touch0&&z.touch0[2]===I.identifier?delete z.touch0:z.touch1&&z.touch1[2]===I.identifier&&delete z.touch1;if(z.touch1&&!z.touch0&&(z.touch0=z.touch1,delete z.touch1),z.touch0)z.touch0[1]=this.__zoom.invert(z.touch0[0]);else if(z.end(),z.taps===2&&(I=ui(I,this),Math.hypot(g[0]-I[0],g[1]-I[1])<x)){var q=or(this).on("dblclick.zoom");q&&q.apply(this,arguments)}}}return S.wheelDelta=function($){return arguments.length?(r=typeof $=="function"?$:Xu(+$),S):r},S.filter=function($){return arguments.length?(n=typeof $=="function"?$:Xu(!!$),S):n},S.touchable=function($){return arguments.length?(i=typeof $=="function"?$:Xu(!!$),S):i},S.extent=function($){return arguments.length?(e=typeof $=="function"?$:Xu([[+$[0][0],+$[0][1]],[+$[1][0],+$[1][1]]]),S):e},S.scaleExtent=function($){return arguments.length?(s[0]=+$[0],s[1]=+$[1],S):[s[0],s[1]]},S.translateExtent=function($){return arguments.length?(o[0][0]=+$[0][0],o[1][0]=+$[1][0],o[0][1]=+$[0][1],o[1][1]=+$[1][1],S):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},S.constrain=function($){return arguments.length?(t=$,S):t},S.duration=function($){return arguments.length?(l=+$,S):l},S.interpolate=function($){return arguments.length?(u=$,S):u},S.on=function(){var $=d.on.apply(d,arguments);return $===d?S:$},S.clickDistance=function($){return arguments.length?(w=($=+$)*$,S):Math.sqrt(w)},S.tapDistance=function($){return arguments.length?(x=+$,S):x},S}function e1(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ng,CS;function K5(){if(CS)return Ng;CS=1;function n(){this.__data__=[],this.size=0}return Ng=n,Ng}var kg,NS;function yo(){if(NS)return kg;NS=1;function n(e,t){return e===t||e!==e&&t!==t}return kg=n,kg}var Mg,kS;function Od(){if(kS)return Mg;kS=1;var n=yo();function e(t,r){for(var i=t.length;i--;)if(n(t[i][0],r))return i;return-1}return Mg=e,Mg}var Ig,MS;function Z5(){if(MS)return Ig;MS=1;var n=Od(),e=Array.prototype,t=e.splice;function r(i){var s=this.__data__,o=n(s,i);if(o<0)return!1;var l=s.length-1;return o==l?s.pop():t.call(s,o,1),--this.size,!0}return Ig=r,Ig}var Og,IS;function Q5(){if(IS)return Og;IS=1;var n=Od();function e(t){var r=this.__data__,i=n(r,t);return i<0?void 0:r[i][1]}return Og=e,Og}var Pg,OS;function J5(){if(OS)return Pg;OS=1;var n=Od();function e(t){return n(this.__data__,t)>-1}return Pg=e,Pg}var Dg,PS;function ez(){if(PS)return Dg;PS=1;var n=Od();function e(t,r){var i=this.__data__,s=n(i,t);return s<0?(++this.size,i.push([t,r])):i[s][1]=r,this}return Dg=e,Dg}var jg,DS;function Pd(){if(DS)return jg;DS=1;var n=K5(),e=Z5(),t=Q5(),r=J5(),i=ez();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=n,s.prototype.delete=e,s.prototype.get=t,s.prototype.has=r,s.prototype.set=i,jg=s,jg}var Lg,jS;function tz(){if(jS)return Lg;jS=1;var n=Pd();function e(){this.__data__=new n,this.size=0}return Lg=e,Lg}var Bg,LS;function nz(){if(LS)return Bg;LS=1;function n(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}return Bg=n,Bg}var Ug,BS;function rz(){if(BS)return Ug;BS=1;function n(e){return this.__data__.get(e)}return Ug=n,Ug}var Fg,US;function iz(){if(US)return Fg;US=1;function n(e){return this.__data__.has(e)}return Fg=n,Fg}var zg,FS;function yI(){if(FS)return zg;FS=1;var n=typeof zu=="object"&&zu&&zu.Object===Object&&zu;return zg=n,zg}var Vg,zS;function kr(){if(zS)return Vg;zS=1;var n=yI(),e=typeof self=="object"&&self&&self.Object===Object&&self,t=n||e||Function("return this")();return Vg=t,Vg}var qg,VS;function bo(){if(VS)return qg;VS=1;var n=kr(),e=n.Symbol;return qg=e,qg}var $g,qS;function sz(){if(qS)return $g;qS=1;var n=bo(),e=Object.prototype,t=e.hasOwnProperty,r=e.toString,i=n?n.toStringTag:void 0;function s(o){var l=t.call(o,i),u=o[i];try{o[i]=void 0;var d=!0}catch{}var h=r.call(o);return d&&(l?o[i]=u:delete o[i]),h}return $g=s,$g}var Hg,$S;function az(){if($S)return Hg;$S=1;var n=Object.prototype,e=n.toString;function t(r){return e.call(r)}return Hg=t,Hg}var Wg,HS;function Hs(){if(HS)return Wg;HS=1;var n=bo(),e=sz(),t=az(),r="[object Null]",i="[object Undefined]",s=n?n.toStringTag:void 0;function o(l){return l==null?l===void 0?i:r:s&&s in Object(l)?e(l):t(l)}return Wg=o,Wg}var Xg,WS;function hr(){if(WS)return Xg;WS=1;function n(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}return Xg=n,Xg}var Yg,XS;function yc(){if(XS)return Yg;XS=1;var n=Hs(),e=hr(),t="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function o(l){if(!e(l))return!1;var u=n(l);return u==r||u==i||u==t||u==s}return Yg=o,Yg}var Gg,YS;function oz(){if(YS)return Gg;YS=1;var n=kr(),e=n["__core-js_shared__"];return Gg=e,Gg}var Kg,GS;function lz(){if(GS)return Kg;GS=1;var n=oz(),e=function(){var r=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function t(r){return!!e&&e in r}return Kg=t,Kg}var Zg,KS;function bI(){if(KS)return Zg;KS=1;var n=Function.prototype,e=n.toString;function t(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return Zg=t,Zg}var Qg,ZS;function cz(){if(ZS)return Qg;ZS=1;var n=yc(),e=lz(),t=hr(),r=bI(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,u=o.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function g(_){if(!t(_)||e(_))return!1;var y=n(_)?h:s;return y.test(r(_))}return Qg=g,Qg}var Jg,QS;function uz(){if(QS)return Jg;QS=1;function n(e,t){return e==null?void 0:e[t]}return Jg=n,Jg}var em,JS;function Ws(){if(JS)return em;JS=1;var n=cz(),e=uz();function t(r,i){var s=e(r,i);return n(s)?s:void 0}return em=t,em}var tm,eE;function t1(){if(eE)return tm;eE=1;var n=Ws(),e=kr(),t=n(e,"Map");return tm=t,tm}var nm,tE;function Dd(){if(tE)return nm;tE=1;var n=Ws(),e=n(Object,"create");return nm=e,nm}var rm,nE;function fz(){if(nE)return rm;nE=1;var n=Dd();function e(){this.__data__=n?n(null):{},this.size=0}return rm=e,rm}var im,rE;function dz(){if(rE)return im;rE=1;function n(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}return im=n,im}var sm,iE;function hz(){if(iE)return sm;iE=1;var n=Dd(),e="__lodash_hash_undefined__",t=Object.prototype,r=t.hasOwnProperty;function i(s){var o=this.__data__;if(n){var l=o[s];return l===e?void 0:l}return r.call(o,s)?o[s]:void 0}return sm=i,sm}var am,sE;function pz(){if(sE)return am;sE=1;var n=Dd(),e=Object.prototype,t=e.hasOwnProperty;function r(i){var s=this.__data__;return n?s[i]!==void 0:t.call(s,i)}return am=r,am}var om,aE;function gz(){if(aE)return om;aE=1;var n=Dd(),e="__lodash_hash_undefined__";function t(r,i){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=n&&i===void 0?e:i,this}return om=t,om}var lm,oE;function mz(){if(oE)return lm;oE=1;var n=fz(),e=dz(),t=hz(),r=pz(),i=gz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=n,s.prototype.delete=e,s.prototype.get=t,s.prototype.has=r,s.prototype.set=i,lm=s,lm}var cm,lE;function _z(){if(lE)return cm;lE=1;var n=mz(),e=Pd(),t=t1();function r(){this.size=0,this.__data__={hash:new n,map:new(t||e),string:new n}}return cm=r,cm}var um,cE;function vz(){if(cE)return um;cE=1;function n(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}return um=n,um}var fm,uE;function jd(){if(uE)return fm;uE=1;var n=vz();function e(t,r){var i=t.__data__;return n(r)?i[typeof r=="string"?"string":"hash"]:i.map}return fm=e,fm}var dm,fE;function yz(){if(fE)return dm;fE=1;var n=jd();function e(t){var r=n(this,t).delete(t);return this.size-=r?1:0,r}return dm=e,dm}var hm,dE;function bz(){if(dE)return hm;dE=1;var n=jd();function e(t){return n(this,t).get(t)}return hm=e,hm}var pm,hE;function xz(){if(hE)return pm;hE=1;var n=jd();function e(t){return n(this,t).has(t)}return pm=e,pm}var gm,pE;function wz(){if(pE)return gm;pE=1;var n=jd();function e(t,r){var i=n(this,t),s=i.size;return i.set(t,r),this.size+=i.size==s?0:1,this}return gm=e,gm}var mm,gE;function n1(){if(gE)return mm;gE=1;var n=_z(),e=yz(),t=bz(),r=xz(),i=wz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=n,s.prototype.delete=e,s.prototype.get=t,s.prototype.has=r,s.prototype.set=i,mm=s,mm}var _m,mE;function Tz(){if(mE)return _m;mE=1;var n=Pd(),e=t1(),t=n1(),r=200;function i(s,o){var l=this.__data__;if(l instanceof n){var u=l.__data__;if(!e||u.length<r-1)return u.push([s,o]),this.size=++l.size,this;l=this.__data__=new t(u)}return l.set(s,o),this.size=l.size,this}return _m=i,_m}var vm,_E;function Ld(){if(_E)return vm;_E=1;var n=Pd(),e=tz(),t=nz(),r=rz(),i=iz(),s=Tz();function o(l){var u=this.__data__=new n(l);this.size=u.size}return o.prototype.clear=e,o.prototype.delete=t,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,vm=o,vm}var ym,vE;function r1(){if(vE)return ym;vE=1;function n(e,t){for(var r=-1,i=e==null?0:e.length;++r<i&&t(e[r],r,e)!==!1;);return e}return ym=n,ym}var bm,yE;function xI(){if(yE)return bm;yE=1;var n=Ws(),e=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch{}}();return bm=e,bm}var xm,bE;function Bd(){if(bE)return xm;bE=1;var n=xI();function e(t,r,i){r=="__proto__"&&n?n(t,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[r]=i}return xm=e,xm}var wm,xE;function Ud(){if(xE)return wm;xE=1;var n=Bd(),e=yo(),t=Object.prototype,r=t.hasOwnProperty;function i(s,o,l){var u=s[o];(!(r.call(s,o)&&e(u,l))||l===void 0&&!(o in s))&&n(s,o,l)}return wm=i,wm}var Tm,wE;function bc(){if(wE)return Tm;wE=1;var n=Ud(),e=Bd();function t(r,i,s,o){var l=!s;s||(s={});for(var u=-1,d=i.length;++u<d;){var h=i[u],g=o?o(s[h],r[h],h,s,r):void 0;g===void 0&&(g=r[h]),l?e(s,h,g):n(s,h,g)}return s}return Tm=t,Tm}var Sm,TE;function Sz(){if(TE)return Sm;TE=1;function n(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}return Sm=n,Sm}var Em,SE;function Wr(){if(SE)return Em;SE=1;function n(e){return e!=null&&typeof e=="object"}return Em=n,Em}var Am,EE;function Ez(){if(EE)return Am;EE=1;var n=Hs(),e=Wr(),t="[object Arguments]";function r(i){return e(i)&&n(i)==t}return Am=r,Am}var Rm,AE;function xc(){if(AE)return Rm;AE=1;var n=Ez(),e=Wr(),t=Object.prototype,r=t.hasOwnProperty,i=t.propertyIsEnumerable,s=n(function(){return arguments}())?n:function(o){return e(o)&&r.call(o,"callee")&&!i.call(o,"callee")};return Rm=s,Rm}var Cm,RE;function Ht(){if(RE)return Cm;RE=1;var n=Array.isArray;return Cm=n,Cm}var Pl={exports:{}},Nm,CE;function Az(){if(CE)return Nm;CE=1;function n(){return!1}return Nm=n,Nm}Pl.exports;var NE;function xo(){return NE||(NE=1,function(n,e){var t=kr(),r=Az(),i=e&&!e.nodeType&&e,s=i&&!0&&n&&!n.nodeType&&n,o=s&&s.exports===i,l=o?t.Buffer:void 0,u=l?l.isBuffer:void 0,d=u||r;n.exports=d}(Pl,Pl.exports)),Pl.exports}var km,kE;function Fd(){if(kE)return km;kE=1;var n=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function t(r,i){var s=typeof r;return i=i??n,!!i&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return km=t,km}var Mm,ME;function i1(){if(ME)return Mm;ME=1;var n=9007199254740991;function e(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=n}return Mm=e,Mm}var Im,IE;function Rz(){if(IE)return Im;IE=1;var n=Hs(),e=i1(),t=Wr(),r="[object Arguments]",i="[object Array]",s="[object Boolean]",o="[object Date]",l="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",g="[object Object]",_="[object RegExp]",y="[object Set]",T="[object String]",w="[object WeakMap]",x="[object ArrayBuffer]",S="[object DataView]",A="[object Float32Array]",R="[object Float64Array]",E="[object Int8Array]",C="[object Int16Array]",O="[object Int32Array]",D="[object Uint8Array]",M="[object Uint8ClampedArray]",P="[object Uint16Array]",k="[object Uint32Array]",V={};V[A]=V[R]=V[E]=V[C]=V[O]=V[D]=V[M]=V[P]=V[k]=!0,V[r]=V[i]=V[x]=V[s]=V[S]=V[o]=V[l]=V[u]=V[d]=V[h]=V[g]=V[_]=V[y]=V[T]=V[w]=!1;function X(Z){return t(Z)&&e(Z.length)&&!!V[n(Z)]}return Im=X,Im}var Om,OE;function zd(){if(OE)return Om;OE=1;function n(e){return function(t){return e(t)}}return Om=n,Om}var Dl={exports:{}};Dl.exports;var PE;function s1(){return PE||(PE=1,function(n,e){var t=yI(),r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&t.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();n.exports=l}(Dl,Dl.exports)),Dl.exports}var Pm,DE;function wc(){if(DE)return Pm;DE=1;var n=Rz(),e=zd(),t=s1(),r=t&&t.isTypedArray,i=r?e(r):n;return Pm=i,Pm}var Dm,jE;function wI(){if(jE)return Dm;jE=1;var n=Sz(),e=xc(),t=Ht(),r=xo(),i=Fd(),s=wc(),o=Object.prototype,l=o.hasOwnProperty;function u(d,h){var g=t(d),_=!g&&e(d),y=!g&&!_&&r(d),T=!g&&!_&&!y&&s(d),w=g||_||y||T,x=w?n(d.length,String):[],S=x.length;for(var A in d)(h||l.call(d,A))&&!(w&&(A=="length"||y&&(A=="offset"||A=="parent")||T&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||i(A,S)))&&x.push(A);return x}return Dm=u,Dm}var jm,LE;function Vd(){if(LE)return jm;LE=1;var n=Object.prototype;function e(t){var r=t&&t.constructor,i=typeof r=="function"&&r.prototype||n;return t===i}return jm=e,jm}var Lm,BE;function TI(){if(BE)return Lm;BE=1;function n(e,t){return function(r){return e(t(r))}}return Lm=n,Lm}var Bm,UE;function Cz(){if(UE)return Bm;UE=1;var n=TI(),e=n(Object.keys,Object);return Bm=e,Bm}var Um,FE;function a1(){if(FE)return Um;FE=1;var n=Vd(),e=Cz(),t=Object.prototype,r=t.hasOwnProperty;function i(s){if(!n(s))return e(s);var o=[];for(var l in Object(s))r.call(s,l)&&l!="constructor"&&o.push(l);return o}return Um=i,Um}var Fm,zE;function _i(){if(zE)return Fm;zE=1;var n=yc(),e=i1();function t(r){return r!=null&&e(r.length)&&!n(r)}return Fm=t,Fm}var zm,VE;function ss(){if(VE)return zm;VE=1;var n=wI(),e=a1(),t=_i();function r(i){return t(i)?n(i):e(i)}return zm=r,zm}var Vm,qE;function Nz(){if(qE)return Vm;qE=1;var n=bc(),e=ss();function t(r,i){return r&&n(i,e(i),r)}return Vm=t,Vm}var qm,$E;function kz(){if($E)return qm;$E=1;function n(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}return qm=n,qm}var $m,HE;function Mz(){if(HE)return $m;HE=1;var n=hr(),e=Vd(),t=kz(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!n(o))return t(o);var l=e(o),u=[];for(var d in o)d=="constructor"&&(l||!i.call(o,d))||u.push(d);return u}return $m=s,$m}var Hm,WE;function Xs(){if(WE)return Hm;WE=1;var n=wI(),e=Mz(),t=_i();function r(i){return t(i)?n(i,!0):e(i)}return Hm=r,Hm}var Wm,XE;function Iz(){if(XE)return Wm;XE=1;var n=bc(),e=Xs();function t(r,i){return r&&n(i,e(i),r)}return Wm=t,Wm}var jl={exports:{}};jl.exports;var YE;function SI(){return YE||(YE=1,function(n,e){var t=kr(),r=e&&!e.nodeType&&e,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s?t.Buffer:void 0,l=o?o.allocUnsafe:void 0;function u(d,h){if(h)return d.slice();var g=d.length,_=l?l(g):new d.constructor(g);return d.copy(_),_}n.exports=u}(jl,jl.exports)),jl.exports}var Xm,GE;function EI(){if(GE)return Xm;GE=1;function n(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}return Xm=n,Xm}var Ym,KE;function AI(){if(KE)return Ym;KE=1;function n(e,t){for(var r=-1,i=e==null?0:e.length,s=0,o=[];++r<i;){var l=e[r];t(l,r,e)&&(o[s++]=l)}return o}return Ym=n,Ym}var Gm,ZE;function RI(){if(ZE)return Gm;ZE=1;function n(){return[]}return Gm=n,Gm}var Km,QE;function o1(){if(QE)return Km;QE=1;var n=AI(),e=RI(),t=Object.prototype,r=t.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(o){return o==null?[]:(o=Object(o),n(i(o),function(l){return r.call(o,l)}))}:e;return Km=s,Km}var Zm,JE;function Oz(){if(JE)return Zm;JE=1;var n=bc(),e=o1();function t(r,i){return n(r,e(r),i)}return Zm=t,Zm}var Qm,eA;function l1(){if(eA)return Qm;eA=1;function n(e,t){for(var r=-1,i=t.length,s=e.length;++r<i;)e[s+r]=t[r];return e}return Qm=n,Qm}var Jm,tA;function qd(){if(tA)return Jm;tA=1;var n=TI(),e=n(Object.getPrototypeOf,Object);return Jm=e,Jm}var e_,nA;function CI(){if(nA)return e_;nA=1;var n=l1(),e=qd(),t=o1(),r=RI(),i=Object.getOwnPropertySymbols,s=i?function(o){for(var l=[];o;)n(l,t(o)),o=e(o);return l}:r;return e_=s,e_}var t_,rA;function Pz(){if(rA)return t_;rA=1;var n=bc(),e=CI();function t(r,i){return n(r,e(r),i)}return t_=t,t_}var n_,iA;function NI(){if(iA)return n_;iA=1;var n=l1(),e=Ht();function t(r,i,s){var o=i(r);return e(r)?o:n(o,s(r))}return n_=t,n_}var r_,sA;function kI(){if(sA)return r_;sA=1;var n=NI(),e=o1(),t=ss();function r(i){return n(i,t,e)}return r_=r,r_}var i_,aA;function Dz(){if(aA)return i_;aA=1;var n=NI(),e=CI(),t=Xs();function r(i){return n(i,t,e)}return i_=r,i_}var s_,oA;function jz(){if(oA)return s_;oA=1;var n=Ws(),e=kr(),t=n(e,"DataView");return s_=t,s_}var a_,lA;function Lz(){if(lA)return a_;lA=1;var n=Ws(),e=kr(),t=n(e,"Promise");return a_=t,a_}var o_,cA;function MI(){if(cA)return o_;cA=1;var n=Ws(),e=kr(),t=n(e,"Set");return o_=t,o_}var l_,uA;function Bz(){if(uA)return l_;uA=1;var n=Ws(),e=kr(),t=n(e,"WeakMap");return l_=t,l_}var c_,fA;function wo(){if(fA)return c_;fA=1;var n=jz(),e=t1(),t=Lz(),r=MI(),i=Bz(),s=Hs(),o=bI(),l="[object Map]",u="[object Object]",d="[object Promise]",h="[object Set]",g="[object WeakMap]",_="[object DataView]",y=o(n),T=o(e),w=o(t),x=o(r),S=o(i),A=s;return(n&&A(new n(new ArrayBuffer(1)))!=_||e&&A(new e)!=l||t&&A(t.resolve())!=d||r&&A(new r)!=h||i&&A(new i)!=g)&&(A=function(R){var E=s(R),C=E==u?R.constructor:void 0,O=C?o(C):"";if(O)switch(O){case y:return _;case T:return l;case w:return d;case x:return h;case S:return g}return E}),c_=A,c_}var u_,dA;function Uz(){if(dA)return u_;dA=1;var n=Object.prototype,e=n.hasOwnProperty;function t(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}return u_=t,u_}var f_,hA;function II(){if(hA)return f_;hA=1;var n=kr(),e=n.Uint8Array;return f_=e,f_}var d_,pA;function c1(){if(pA)return d_;pA=1;var n=II();function e(t){var r=new t.constructor(t.byteLength);return new n(r).set(new n(t)),r}return d_=e,d_}var h_,gA;function Fz(){if(gA)return h_;gA=1;var n=c1();function e(t,r){var i=r?n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}return h_=e,h_}var p_,mA;function zz(){if(mA)return p_;mA=1;var n=/\w*$/;function e(t){var r=new t.constructor(t.source,n.exec(t));return r.lastIndex=t.lastIndex,r}return p_=e,p_}var g_,_A;function Vz(){if(_A)return g_;_A=1;var n=bo(),e=n?n.prototype:void 0,t=e?e.valueOf:void 0;function r(i){return t?Object(t.call(i)):{}}return g_=r,g_}var m_,vA;function OI(){if(vA)return m_;vA=1;var n=c1();function e(t,r){var i=r?n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}return m_=e,m_}var __,yA;function qz(){if(yA)return __;yA=1;var n=c1(),e=Fz(),t=zz(),r=Vz(),i=OI(),s="[object Boolean]",o="[object Date]",l="[object Map]",u="[object Number]",d="[object RegExp]",h="[object Set]",g="[object String]",_="[object Symbol]",y="[object ArrayBuffer]",T="[object DataView]",w="[object Float32Array]",x="[object Float64Array]",S="[object Int8Array]",A="[object Int16Array]",R="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",O="[object Uint16Array]",D="[object Uint32Array]";function M(P,k,V){var X=P.constructor;switch(k){case y:return n(P);case s:case o:return new X(+P);case T:return e(P,V);case w:case x:case S:case A:case R:case E:case C:case O:case D:return i(P,V);case l:return new X;case u:case g:return new X(P);case d:return t(P);case h:return new X;case _:return r(P)}}return __=M,__}var v_,bA;function PI(){if(bA)return v_;bA=1;var n=hr(),e=Object.create,t=function(){function r(){}return function(i){if(!n(i))return{};if(e)return e(i);r.prototype=i;var s=new r;return r.prototype=void 0,s}}();return v_=t,v_}var y_,xA;function DI(){if(xA)return y_;xA=1;var n=PI(),e=qd(),t=Vd();function r(i){return typeof i.constructor=="function"&&!t(i)?n(e(i)):{}}return y_=r,y_}var b_,wA;function $z(){if(wA)return b_;wA=1;var n=wo(),e=Wr(),t="[object Map]";function r(i){return e(i)&&n(i)==t}return b_=r,b_}var x_,TA;function Hz(){if(TA)return x_;TA=1;var n=$z(),e=zd(),t=s1(),r=t&&t.isMap,i=r?e(r):n;return x_=i,x_}var w_,SA;function Wz(){if(SA)return w_;SA=1;var n=wo(),e=Wr(),t="[object Set]";function r(i){return e(i)&&n(i)==t}return w_=r,w_}var T_,EA;function Xz(){if(EA)return T_;EA=1;var n=Wz(),e=zd(),t=s1(),r=t&&t.isSet,i=r?e(r):n;return T_=i,T_}var S_,AA;function jI(){if(AA)return S_;AA=1;var n=Ld(),e=r1(),t=Ud(),r=Nz(),i=Iz(),s=SI(),o=EI(),l=Oz(),u=Pz(),d=kI(),h=Dz(),g=wo(),_=Uz(),y=qz(),T=DI(),w=Ht(),x=xo(),S=Hz(),A=hr(),R=Xz(),E=ss(),C=Xs(),O=1,D=2,M=4,P="[object Arguments]",k="[object Array]",V="[object Boolean]",X="[object Date]",Z="[object Error]",$="[object Function]",H="[object GeneratorFunction]",z="[object Map]",te="[object Number]",fe="[object Object]",K="[object RegExp]",I="[object Set]",q="[object String]",ee="[object Symbol]",se="[object WeakMap]",B="[object ArrayBuffer]",Y="[object DataView]",Q="[object Float32Array]",pe="[object Float64Array]",ye="[object Int8Array]",Ee="[object Int16Array]",Oe="[object Int32Array]",ze="[object Uint8Array]",It="[object Uint8ClampedArray]",mt="[object Uint16Array]",ct="[object Uint32Array]",De={};De[P]=De[k]=De[B]=De[Y]=De[V]=De[X]=De[Q]=De[pe]=De[ye]=De[Ee]=De[Oe]=De[z]=De[te]=De[fe]=De[K]=De[I]=De[q]=De[ee]=De[ze]=De[It]=De[mt]=De[ct]=!0,De[Z]=De[$]=De[se]=!1;function cn(Ne,yn,Wt,Rn,jt,un){var We,xe=yn&O,Re=yn&D,Qe=yn&M;if(Wt&&(We=jt?Wt(Ne,Rn,jt,un):Wt(Ne)),We!==void 0)return We;if(!A(Ne))return Ne;var Ve=w(Ne);if(Ve){if(We=_(Ne),!xe)return o(Ne,We)}else{var Ye=g(Ne),_t=Ye==$||Ye==H;if(x(Ne))return s(Ne,xe);if(Ye==fe||Ye==P||_t&&!jt){if(We=Re||_t?{}:T(Ne),!xe)return Re?u(Ne,i(We,Ne)):l(Ne,r(We,Ne))}else{if(!De[Ye])return jt?Ne:{};We=y(Ne,Ye,xe)}}un||(un=new n);var fn=un.get(Ne);if(fn)return fn;un.set(Ne,We),R(Ne)?Ne.forEach(function(Lt){We.add(cn(Lt,yn,Wt,Lt,Ne,un))}):S(Ne)&&Ne.forEach(function(Lt,Bt){We.set(Bt,cn(Lt,yn,Wt,Bt,Ne,un))});var Xr=Qe?Re?h:d:Re?C:E,mr=Ve?void 0:Xr(Ne);return e(mr||Ne,function(Lt,Bt){mr&&(Bt=Lt,Lt=Ne[Bt]),t(We,Bt,cn(Lt,yn,Wt,Bt,Ne,un))}),We}return S_=cn,S_}var E_,RA;function Yz(){if(RA)return E_;RA=1;var n=jI(),e=4;function t(r){return n(r,e)}return E_=t,E_}var A_,CA;function u1(){if(CA)return A_;CA=1;function n(e){return function(){return e}}return A_=n,A_}var R_,NA;function Gz(){if(NA)return R_;NA=1;function n(e){return function(t,r,i){for(var s=-1,o=Object(t),l=i(t),u=l.length;u--;){var d=l[e?u:++s];if(r(o[d],d,o)===!1)break}return t}}return R_=n,R_}var C_,kA;function f1(){if(kA)return C_;kA=1;var n=Gz(),e=n();return C_=e,C_}var N_,MA;function d1(){if(MA)return N_;MA=1;var n=f1(),e=ss();function t(r,i){return r&&n(r,i,e)}return N_=t,N_}var k_,IA;function Kz(){if(IA)return k_;IA=1;var n=_i();function e(t,r){return function(i,s){if(i==null)return i;if(!n(i))return t(i,s);for(var o=i.length,l=r?o:-1,u=Object(i);(r?l--:++l<o)&&s(u[l],l,u)!==!1;);return i}}return k_=e,k_}var M_,OA;function $d(){if(OA)return M_;OA=1;var n=d1(),e=Kz(),t=e(n);return M_=t,M_}var I_,PA;function Ys(){if(PA)return I_;PA=1;function n(e){return e}return I_=n,I_}var O_,DA;function LI(){if(DA)return O_;DA=1;var n=Ys();function e(t){return typeof t=="function"?t:n}return O_=e,O_}var P_,jA;function BI(){if(jA)return P_;jA=1;var n=r1(),e=$d(),t=LI(),r=Ht();function i(s,o){var l=r(s)?n:e;return l(s,t(o))}return P_=i,P_}var D_,LA;function UI(){return LA||(LA=1,D_=BI()),D_}var j_,BA;function Zz(){if(BA)return j_;BA=1;var n=$d();function e(t,r){var i=[];return n(t,function(s,o,l){r(s,o,l)&&i.push(s)}),i}return j_=e,j_}var L_,UA;function Qz(){if(UA)return L_;UA=1;var n="__lodash_hash_undefined__";function e(t){return this.__data__.set(t,n),this}return L_=e,L_}var B_,FA;function Jz(){if(FA)return B_;FA=1;function n(e){return this.__data__.has(e)}return B_=n,B_}var U_,zA;function FI(){if(zA)return U_;zA=1;var n=n1(),e=Qz(),t=Jz();function r(i){var s=-1,o=i==null?0:i.length;for(this.__data__=new n;++s<o;)this.add(i[s])}return r.prototype.add=r.prototype.push=e,r.prototype.has=t,U_=r,U_}var F_,VA;function e7(){if(VA)return F_;VA=1;function n(e,t){for(var r=-1,i=e==null?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}return F_=n,F_}var z_,qA;function zI(){if(qA)return z_;qA=1;function n(e,t){return e.has(t)}return z_=n,z_}var V_,$A;function VI(){if($A)return V_;$A=1;var n=FI(),e=e7(),t=zI(),r=1,i=2;function s(o,l,u,d,h,g){var _=u&r,y=o.length,T=l.length;if(y!=T&&!(_&&T>y))return!1;var w=g.get(o),x=g.get(l);if(w&&x)return w==l&&x==o;var S=-1,A=!0,R=u&i?new n:void 0;for(g.set(o,l),g.set(l,o);++S<y;){var E=o[S],C=l[S];if(d)var O=_?d(C,E,S,l,o,g):d(E,C,S,o,l,g);if(O!==void 0){if(O)continue;A=!1;break}if(R){if(!e(l,function(D,M){if(!t(R,M)&&(E===D||h(E,D,u,d,g)))return R.push(M)})){A=!1;break}}else if(!(E===C||h(E,C,u,d,g))){A=!1;break}}return g.delete(o),g.delete(l),A}return V_=s,V_}var q_,HA;function t7(){if(HA)return q_;HA=1;function n(e){var t=-1,r=Array(e.size);return e.forEach(function(i,s){r[++t]=[s,i]}),r}return q_=n,q_}var $_,WA;function h1(){if(WA)return $_;WA=1;function n(e){var t=-1,r=Array(e.size);return e.forEach(function(i){r[++t]=i}),r}return $_=n,$_}var H_,XA;function n7(){if(XA)return H_;XA=1;var n=bo(),e=II(),t=yo(),r=VI(),i=t7(),s=h1(),o=1,l=2,u="[object Boolean]",d="[object Date]",h="[object Error]",g="[object Map]",_="[object Number]",y="[object RegExp]",T="[object Set]",w="[object String]",x="[object Symbol]",S="[object ArrayBuffer]",A="[object DataView]",R=n?n.prototype:void 0,E=R?R.valueOf:void 0;function C(O,D,M,P,k,V,X){switch(M){case A:if(O.byteLength!=D.byteLength||O.byteOffset!=D.byteOffset)return!1;O=O.buffer,D=D.buffer;case S:return!(O.byteLength!=D.byteLength||!V(new e(O),new e(D)));case u:case d:case _:return t(+O,+D);case h:return O.name==D.name&&O.message==D.message;case y:case w:return O==D+"";case g:var Z=i;case T:var $=P&o;if(Z||(Z=s),O.size!=D.size&&!$)return!1;var H=X.get(O);if(H)return H==D;P|=l,X.set(O,D);var z=r(Z(O),Z(D),P,k,V,X);return X.delete(O),z;case x:if(E)return E.call(O)==E.call(D)}return!1}return H_=C,H_}var W_,YA;function r7(){if(YA)return W_;YA=1;var n=kI(),e=1,t=Object.prototype,r=t.hasOwnProperty;function i(s,o,l,u,d,h){var g=l&e,_=n(s),y=_.length,T=n(o),w=T.length;if(y!=w&&!g)return!1;for(var x=y;x--;){var S=_[x];if(!(g?S in o:r.call(o,S)))return!1}var A=h.get(s),R=h.get(o);if(A&&R)return A==o&&R==s;var E=!0;h.set(s,o),h.set(o,s);for(var C=g;++x<y;){S=_[x];var O=s[S],D=o[S];if(u)var M=g?u(D,O,S,o,s,h):u(O,D,S,s,o,h);if(!(M===void 0?O===D||d(O,D,l,u,h):M)){E=!1;break}C||(C=S=="constructor")}if(E&&!C){var P=s.constructor,k=o.constructor;P!=k&&"constructor"in s&&"constructor"in o&&!(typeof P=="function"&&P instanceof P&&typeof k=="function"&&k instanceof k)&&(E=!1)}return h.delete(s),h.delete(o),E}return W_=i,W_}var X_,GA;function i7(){if(GA)return X_;GA=1;var n=Ld(),e=VI(),t=n7(),r=r7(),i=wo(),s=Ht(),o=xo(),l=wc(),u=1,d="[object Arguments]",h="[object Array]",g="[object Object]",_=Object.prototype,y=_.hasOwnProperty;function T(w,x,S,A,R,E){var C=s(w),O=s(x),D=C?h:i(w),M=O?h:i(x);D=D==d?g:D,M=M==d?g:M;var P=D==g,k=M==g,V=D==M;if(V&&o(w)){if(!o(x))return!1;C=!0,P=!1}if(V&&!P)return E||(E=new n),C||l(w)?e(w,x,S,A,R,E):t(w,x,D,S,A,R,E);if(!(S&u)){var X=P&&y.call(w,"__wrapped__"),Z=k&&y.call(x,"__wrapped__");if(X||Z){var $=X?w.value():w,H=Z?x.value():x;return E||(E=new n),R($,H,S,A,E)}}return V?(E||(E=new n),r(w,x,S,A,R,E)):!1}return X_=T,X_}var Y_,KA;function qI(){if(KA)return Y_;KA=1;var n=i7(),e=Wr();function t(r,i,s,o,l){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:n(r,i,s,o,t,l)}return Y_=t,Y_}var G_,ZA;function s7(){if(ZA)return G_;ZA=1;var n=Ld(),e=qI(),t=1,r=2;function i(s,o,l,u){var d=l.length,h=d,g=!u;if(s==null)return!h;for(s=Object(s);d--;){var _=l[d];if(g&&_[2]?_[1]!==s[_[0]]:!(_[0]in s))return!1}for(;++d<h;){_=l[d];var y=_[0],T=s[y],w=_[1];if(g&&_[2]){if(T===void 0&&!(y in s))return!1}else{var x=new n;if(u)var S=u(T,w,y,s,o,x);if(!(S===void 0?e(w,T,t|r,u,x):S))return!1}}return!0}return G_=i,G_}var K_,QA;function $I(){if(QA)return K_;QA=1;var n=hr();function e(t){return t===t&&!n(t)}return K_=e,K_}var Z_,JA;function a7(){if(JA)return Z_;JA=1;var n=$I(),e=ss();function t(r){for(var i=e(r),s=i.length;s--;){var o=i[s],l=r[o];i[s]=[o,l,n(l)]}return i}return Z_=t,Z_}var Q_,eR;function HI(){if(eR)return Q_;eR=1;function n(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}return Q_=n,Q_}var J_,tR;function o7(){if(tR)return J_;tR=1;var n=s7(),e=a7(),t=HI();function r(i){var s=e(i);return s.length==1&&s[0][2]?t(s[0][0],s[0][1]):function(o){return o===i||n(o,i,s)}}return J_=r,J_}var ev,nR;function To(){if(nR)return ev;nR=1;var n=Hs(),e=Wr(),t="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&n(i)==t}return ev=r,ev}var tv,rR;function p1(){if(rR)return tv;rR=1;var n=Ht(),e=To(),t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){if(n(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||e(s)?!0:r.test(s)||!t.test(s)||o!=null&&s in Object(o)}return tv=i,tv}var nv,iR;function l7(){if(iR)return nv;iR=1;var n=n1(),e="Expected a function";function t(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var s=function(){var o=arguments,l=i?i.apply(this,o):o[0],u=s.cache;if(u.has(l))return u.get(l);var d=r.apply(this,o);return s.cache=u.set(l,d)||u,d};return s.cache=new(t.Cache||n),s}return t.Cache=n,nv=t,nv}var rv,sR;function c7(){if(sR)return rv;sR=1;var n=l7(),e=500;function t(r){var i=n(r,function(o){return s.size===e&&s.clear(),o}),s=i.cache;return i}return rv=t,rv}var iv,aR;function u7(){if(aR)return iv;aR=1;var n=c7(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,t=/\\(\\)?/g,r=n(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(e,function(o,l,u,d){s.push(u?d.replace(t,"$1"):l||o)}),s});return iv=r,iv}var sv,oR;function Hd(){if(oR)return sv;oR=1;function n(e,t){for(var r=-1,i=e==null?0:e.length,s=Array(i);++r<i;)s[r]=t(e[r],r,e);return s}return sv=n,sv}var av,lR;function f7(){if(lR)return av;lR=1;var n=bo(),e=Hd(),t=Ht(),r=To(),i=n?n.prototype:void 0,s=i?i.toString:void 0;function o(l){if(typeof l=="string")return l;if(t(l))return e(l,o)+"";if(r(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}return av=o,av}var ov,cR;function WI(){if(cR)return ov;cR=1;var n=f7();function e(t){return t==null?"":n(t)}return ov=e,ov}var lv,uR;function Wd(){if(uR)return lv;uR=1;var n=Ht(),e=p1(),t=u7(),r=WI();function i(s,o){return n(s)?s:e(s,o)?[s]:t(r(s))}return lv=i,lv}var cv,fR;function Tc(){if(fR)return cv;fR=1;var n=To();function e(t){if(typeof t=="string"||n(t))return t;var r=t+"";return r=="0"&&1/t==-1/0?"-0":r}return cv=e,cv}var uv,dR;function Xd(){if(dR)return uv;dR=1;var n=Wd(),e=Tc();function t(r,i){i=n(i,r);for(var s=0,o=i.length;r!=null&&s<o;)r=r[e(i[s++])];return s&&s==o?r:void 0}return uv=t,uv}var fv,hR;function d7(){if(hR)return fv;hR=1;var n=Xd();function e(t,r,i){var s=t==null?void 0:n(t,r);return s===void 0?i:s}return fv=e,fv}var dv,pR;function h7(){if(pR)return dv;pR=1;function n(e,t){return e!=null&&t in Object(e)}return dv=n,dv}var hv,gR;function XI(){if(gR)return hv;gR=1;var n=Wd(),e=xc(),t=Ht(),r=Fd(),i=i1(),s=Tc();function o(l,u,d){u=n(u,l);for(var h=-1,g=u.length,_=!1;++h<g;){var y=s(u[h]);if(!(_=l!=null&&d(l,y)))break;l=l[y]}return _||++h!=g?_:(g=l==null?0:l.length,!!g&&i(g)&&r(y,g)&&(t(l)||e(l)))}return hv=o,hv}var pv,mR;function YI(){if(mR)return pv;mR=1;var n=h7(),e=XI();function t(r,i){return r!=null&&e(r,i,n)}return pv=t,pv}var gv,_R;function p7(){if(_R)return gv;_R=1;var n=qI(),e=d7(),t=YI(),r=p1(),i=$I(),s=HI(),o=Tc(),l=1,u=2;function d(h,g){return r(h)&&i(g)?s(o(h),g):function(_){var y=e(_,h);return y===void 0&&y===g?t(_,h):n(g,y,l|u)}}return gv=d,gv}var mv,vR;function GI(){if(vR)return mv;vR=1;function n(e){return function(t){return t==null?void 0:t[e]}}return mv=n,mv}var _v,yR;function g7(){if(yR)return _v;yR=1;var n=Xd();function e(t){return function(r){return n(r,t)}}return _v=e,_v}var vv,bR;function m7(){if(bR)return vv;bR=1;var n=GI(),e=g7(),t=p1(),r=Tc();function i(s){return t(s)?n(r(s)):e(s)}return vv=i,vv}var yv,xR;function vi(){if(xR)return yv;xR=1;var n=o7(),e=p7(),t=Ys(),r=Ht(),i=m7();function s(o){return typeof o=="function"?o:o==null?t:typeof o=="object"?r(o)?e(o[0],o[1]):n(o):i(o)}return yv=s,yv}var bv,wR;function KI(){if(wR)return bv;wR=1;var n=AI(),e=Zz(),t=vi(),r=Ht();function i(s,o){var l=r(s)?n:e;return l(s,t(o,3))}return bv=i,bv}var xv,TR;function _7(){if(TR)return xv;TR=1;var n=Object.prototype,e=n.hasOwnProperty;function t(r,i){return r!=null&&e.call(r,i)}return xv=t,xv}var wv,SR;function ZI(){if(SR)return wv;SR=1;var n=_7(),e=XI();function t(r,i){return r!=null&&e(r,i,n)}return wv=t,wv}var Tv,ER;function v7(){if(ER)return Tv;ER=1;var n=a1(),e=wo(),t=xc(),r=Ht(),i=_i(),s=xo(),o=Vd(),l=wc(),u="[object Map]",d="[object Set]",h=Object.prototype,g=h.hasOwnProperty;function _(y){if(y==null)return!0;if(i(y)&&(r(y)||typeof y=="string"||typeof y.splice=="function"||s(y)||l(y)||t(y)))return!y.length;var T=e(y);if(T==u||T==d)return!y.size;if(o(y))return!n(y).length;for(var w in y)if(g.call(y,w))return!1;return!0}return Tv=_,Tv}var Sv,AR;function QI(){if(AR)return Sv;AR=1;function n(e){return e===void 0}return Sv=n,Sv}var Ev,RR;function JI(){if(RR)return Ev;RR=1;var n=$d(),e=_i();function t(r,i){var s=-1,o=e(r)?Array(r.length):[];return n(r,function(l,u,d){o[++s]=i(l,u,d)}),o}return Ev=t,Ev}var Av,CR;function eO(){if(CR)return Av;CR=1;var n=Hd(),e=vi(),t=JI(),r=Ht();function i(s,o){var l=r(s)?n:t;return l(s,e(o,3))}return Av=i,Av}var Rv,NR;function y7(){if(NR)return Rv;NR=1;function n(e,t,r,i){var s=-1,o=e==null?0:e.length;for(i&&o&&(r=e[++s]);++s<o;)r=t(r,e[s],s,e);return r}return Rv=n,Rv}var Cv,kR;function b7(){if(kR)return Cv;kR=1;function n(e,t,r,i,s){return s(e,function(o,l,u){r=i?(i=!1,o):t(r,o,l,u)}),r}return Cv=n,Cv}var Nv,MR;function tO(){if(MR)return Nv;MR=1;var n=y7(),e=$d(),t=vi(),r=b7(),i=Ht();function s(o,l,u){var d=i(o)?n:r,h=arguments.length<3;return d(o,t(l,4),u,h,e)}return Nv=s,Nv}var kv,IR;function x7(){if(IR)return kv;IR=1;var n=Hs(),e=Ht(),t=Wr(),r="[object String]";function i(s){return typeof s=="string"||!e(s)&&t(s)&&n(s)==r}return kv=i,kv}var Mv,OR;function w7(){if(OR)return Mv;OR=1;var n=GI(),e=n("length");return Mv=e,Mv}var Iv,PR;function T7(){if(PR)return Iv;PR=1;var n="\\ud800-\\udfff",e="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+t+r,s="\\ufe0e\\ufe0f",o="\\u200d",l=RegExp("["+o+n+i+s+"]");function u(d){return l.test(d)}return Iv=u,Iv}var Ov,DR;function S7(){if(DR)return Ov;DR=1;var n="\\ud800-\\udfff",e="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+t+r,s="\\ufe0e\\ufe0f",o="["+n+"]",l="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+u+")",h="[^"+n+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",y="\\u200d",T=d+"?",w="["+s+"]?",x="(?:"+y+"(?:"+[h,g,_].join("|")+")"+w+T+")*",S=w+T+x,A="(?:"+[h+l+"?",l,g,_,o].join("|")+")",R=RegExp(u+"(?="+u+")|"+A+S,"g");function E(C){for(var O=R.lastIndex=0;R.test(C);)++O;return O}return Ov=E,Ov}var Pv,jR;function E7(){if(jR)return Pv;jR=1;var n=w7(),e=T7(),t=S7();function r(i){return e(i)?t(i):n(i)}return Pv=r,Pv}var Dv,LR;function A7(){if(LR)return Dv;LR=1;var n=a1(),e=wo(),t=_i(),r=x7(),i=E7(),s="[object Map]",o="[object Set]";function l(u){if(u==null)return 0;if(t(u))return r(u)?i(u):u.length;var d=e(u);return d==s||d==o?u.size:n(u).length}return Dv=l,Dv}var jv,BR;function R7(){if(BR)return jv;BR=1;var n=r1(),e=PI(),t=d1(),r=vi(),i=qd(),s=Ht(),o=xo(),l=yc(),u=hr(),d=wc();function h(g,_,y){var T=s(g),w=T||o(g)||d(g);if(_=r(_,4),y==null){var x=g&&g.constructor;w?y=T?new x:[]:u(g)?y=l(x)?e(i(g)):{}:y={}}return(w?n:t)(g,function(S,A,R){return _(y,S,A,R)}),y}return jv=h,jv}var Lv,UR;function C7(){if(UR)return Lv;UR=1;var n=bo(),e=xc(),t=Ht(),r=n?n.isConcatSpreadable:void 0;function i(s){return t(s)||e(s)||!!(r&&s&&s[r])}return Lv=i,Lv}var Bv,FR;function g1(){if(FR)return Bv;FR=1;var n=l1(),e=C7();function t(r,i,s,o,l){var u=-1,d=r.length;for(s||(s=e),l||(l=[]);++u<d;){var h=r[u];i>0&&s(h)?i>1?t(h,i-1,s,o,l):n(l,h):o||(l[l.length]=h)}return l}return Bv=t,Bv}var Uv,zR;function N7(){if(zR)return Uv;zR=1;function n(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}return Uv=n,Uv}var Fv,VR;function nO(){if(VR)return Fv;VR=1;var n=N7(),e=Math.max;function t(r,i,s){return i=e(i===void 0?r.length-1:i,0),function(){for(var o=arguments,l=-1,u=e(o.length-i,0),d=Array(u);++l<u;)d[l]=o[i+l];l=-1;for(var h=Array(i+1);++l<i;)h[l]=o[l];return h[i]=s(d),n(r,this,h)}}return Fv=t,Fv}var zv,qR;function k7(){if(qR)return zv;qR=1;var n=u1(),e=xI(),t=Ys(),r=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:n(s),writable:!0})}:t;return zv=r,zv}var Vv,$R;function M7(){if($R)return Vv;$R=1;var n=800,e=16,t=Date.now;function r(i){var s=0,o=0;return function(){var l=t(),u=e-(l-o);if(o=l,u>0){if(++s>=n)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return Vv=r,Vv}var qv,HR;function rO(){if(HR)return qv;HR=1;var n=k7(),e=M7(),t=e(n);return qv=t,qv}var $v,WR;function Yd(){if(WR)return $v;WR=1;var n=Ys(),e=nO(),t=rO();function r(i,s){return t(e(i,s,n),i+"")}return $v=r,$v}var Hv,XR;function iO(){if(XR)return Hv;XR=1;function n(e,t,r,i){for(var s=e.length,o=r+(i?1:-1);i?o--:++o<s;)if(t(e[o],o,e))return o;return-1}return Hv=n,Hv}var Wv,YR;function I7(){if(YR)return Wv;YR=1;function n(e){return e!==e}return Wv=n,Wv}var Xv,GR;function O7(){if(GR)return Xv;GR=1;function n(e,t,r){for(var i=r-1,s=e.length;++i<s;)if(e[i]===t)return i;return-1}return Xv=n,Xv}var Yv,KR;function P7(){if(KR)return Yv;KR=1;var n=iO(),e=I7(),t=O7();function r(i,s,o){return s===s?t(i,s,o):n(i,e,o)}return Yv=r,Yv}var Gv,ZR;function D7(){if(ZR)return Gv;ZR=1;var n=P7();function e(t,r){var i=t==null?0:t.length;return!!i&&n(t,r,0)>-1}return Gv=e,Gv}var Kv,QR;function j7(){if(QR)return Kv;QR=1;function n(e,t,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(t,e[i]))return!0;return!1}return Kv=n,Kv}var Zv,JR;function L7(){if(JR)return Zv;JR=1;function n(){}return Zv=n,Zv}var Qv,eC;function B7(){if(eC)return Qv;eC=1;var n=MI(),e=L7(),t=h1(),r=1/0,i=n&&1/t(new n([,-0]))[1]==r?function(s){return new n(s)}:e;return Qv=i,Qv}var Jv,tC;function U7(){if(tC)return Jv;tC=1;var n=FI(),e=D7(),t=j7(),r=zI(),i=B7(),s=h1(),o=200;function l(u,d,h){var g=-1,_=e,y=u.length,T=!0,w=[],x=w;if(h)T=!1,_=t;else if(y>=o){var S=d?null:i(u);if(S)return s(S);T=!1,_=r,x=new n}else x=d?[]:w;e:for(;++g<y;){var A=u[g],R=d?d(A):A;if(A=h||A!==0?A:0,T&&R===R){for(var E=x.length;E--;)if(x[E]===R)continue e;d&&x.push(R),w.push(A)}else _(x,R,h)||(x!==w&&x.push(R),w.push(A))}return w}return Jv=l,Jv}var ey,nC;function sO(){if(nC)return ey;nC=1;var n=_i(),e=Wr();function t(r){return e(r)&&n(r)}return ey=t,ey}var ty,rC;function F7(){if(rC)return ty;rC=1;var n=g1(),e=Yd(),t=U7(),r=sO(),i=e(function(s){return t(n(s,1,r,!0))});return ty=i,ty}var ny,iC;function z7(){if(iC)return ny;iC=1;var n=Hd();function e(t,r){return n(r,function(i){return t[i]})}return ny=e,ny}var ry,sC;function aO(){if(sC)return ry;sC=1;var n=z7(),e=ss();function t(r){return r==null?[]:n(r,e(r))}return ry=t,ry}var iy,aC;function pr(){if(aC)return iy;aC=1;var n;if(typeof e1=="function")try{n={clone:Yz(),constant:u1(),each:UI(),filter:KI(),has:ZI(),isArray:Ht(),isEmpty:v7(),isFunction:yc(),isUndefined:QI(),keys:ss(),map:eO(),reduce:tO(),size:A7(),transform:R7(),union:F7(),values:aO()}}catch{}return n||(n=window._),iy=n,iy}var sy,oC;function m1(){if(oC)return sy;oC=1;var n=pr();sy=i;var e="\0",t="\0",r="";function i(h){this._isDirected=n.has(h,"directed")?h.directed:!0,this._isMultigraph=n.has(h,"multigraph")?h.multigraph:!1,this._isCompound=n.has(h,"compound")?h.compound:!1,this._label=void 0,this._defaultNodeLabelFn=n.constant(void 0),this._defaultEdgeLabelFn=n.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[t]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(h){return this._label=h,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(h){return n.isFunction(h)||(h=n.constant(h)),this._defaultNodeLabelFn=h,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return n.keys(this._nodes)},i.prototype.sources=function(){var h=this;return n.filter(this.nodes(),function(g){return n.isEmpty(h._in[g])})},i.prototype.sinks=function(){var h=this;return n.filter(this.nodes(),function(g){return n.isEmpty(h._out[g])})},i.prototype.setNodes=function(h,g){var _=arguments,y=this;return n.each(h,function(T){_.length>1?y.setNode(T,g):y.setNode(T)}),this},i.prototype.setNode=function(h,g){return n.has(this._nodes,h)?(arguments.length>1&&(this._nodes[h]=g),this):(this._nodes[h]=arguments.length>1?g:this._defaultNodeLabelFn(h),this._isCompound&&(this._parent[h]=t,this._children[h]={},this._children[t][h]=!0),this._in[h]={},this._preds[h]={},this._out[h]={},this._sucs[h]={},++this._nodeCount,this)},i.prototype.node=function(h){return this._nodes[h]},i.prototype.hasNode=function(h){return n.has(this._nodes,h)},i.prototype.removeNode=function(h){var g=this;if(n.has(this._nodes,h)){var _=function(y){g.removeEdge(g._edgeObjs[y])};delete this._nodes[h],this._isCompound&&(this._removeFromParentsChildList(h),delete this._parent[h],n.each(this.children(h),function(y){g.setParent(y)}),delete this._children[h]),n.each(n.keys(this._in[h]),_),delete this._in[h],delete this._preds[h],n.each(n.keys(this._out[h]),_),delete this._out[h],delete this._sucs[h],--this._nodeCount}return this},i.prototype.setParent=function(h,g){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(n.isUndefined(g))g=t;else{g+="";for(var _=g;!n.isUndefined(_);_=this.parent(_))if(_===h)throw new Error("Setting "+g+" as parent of "+h+" would create a cycle");this.setNode(g)}return this.setNode(h),this._removeFromParentsChildList(h),this._parent[h]=g,this._children[g][h]=!0,this},i.prototype._removeFromParentsChildList=function(h){delete this._children[this._parent[h]][h]},i.prototype.parent=function(h){if(this._isCompound){var g=this._parent[h];if(g!==t)return g}},i.prototype.children=function(h){if(n.isUndefined(h)&&(h=t),this._isCompound){var g=this._children[h];if(g)return n.keys(g)}else{if(h===t)return this.nodes();if(this.hasNode(h))return[]}},i.prototype.predecessors=function(h){var g=this._preds[h];if(g)return n.keys(g)},i.prototype.successors=function(h){var g=this._sucs[h];if(g)return n.keys(g)},i.prototype.neighbors=function(h){var g=this.predecessors(h);if(g)return n.union(g,this.successors(h))},i.prototype.isLeaf=function(h){var g;return this.isDirected()?g=this.successors(h):g=this.neighbors(h),g.length===0},i.prototype.filterNodes=function(h){var g=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});g.setGraph(this.graph());var _=this;n.each(this._nodes,function(w,x){h(x)&&g.setNode(x,w)}),n.each(this._edgeObjs,function(w){g.hasNode(w.v)&&g.hasNode(w.w)&&g.setEdge(w,_.edge(w))});var y={};function T(w){var x=_.parent(w);return x===void 0||g.hasNode(x)?(y[w]=x,x):x in y?y[x]:T(x)}return this._isCompound&&n.each(g.nodes(),function(w){g.setParent(w,T(w))}),g},i.prototype.setDefaultEdgeLabel=function(h){return n.isFunction(h)||(h=n.constant(h)),this._defaultEdgeLabelFn=h,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return n.values(this._edgeObjs)},i.prototype.setPath=function(h,g){var _=this,y=arguments;return n.reduce(h,function(T,w){return y.length>1?_.setEdge(T,w,g):_.setEdge(T,w),w}),this},i.prototype.setEdge=function(){var h,g,_,y,T=!1,w=arguments[0];typeof w=="object"&&w!==null&&"v"in w?(h=w.v,g=w.w,_=w.name,arguments.length===2&&(y=arguments[1],T=!0)):(h=w,g=arguments[1],_=arguments[3],arguments.length>2&&(y=arguments[2],T=!0)),h=""+h,g=""+g,n.isUndefined(_)||(_=""+_);var x=l(this._isDirected,h,g,_);if(n.has(this._edgeLabels,x))return T&&(this._edgeLabels[x]=y),this;if(!n.isUndefined(_)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(h),this.setNode(g),this._edgeLabels[x]=T?y:this._defaultEdgeLabelFn(h,g,_);var S=u(this._isDirected,h,g,_);return h=S.v,g=S.w,Object.freeze(S),this._edgeObjs[x]=S,s(this._preds[g],h),s(this._sucs[h],g),this._in[g][x]=S,this._out[h][x]=S,this._edgeCount++,this},i.prototype.edge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return this._edgeLabels[y]},i.prototype.hasEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return n.has(this._edgeLabels,y)},i.prototype.removeEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_),T=this._edgeObjs[y];return T&&(h=T.v,g=T.w,delete this._edgeLabels[y],delete this._edgeObjs[y],o(this._preds[g],h),o(this._sucs[h],g),delete this._in[g][y],delete this._out[h][y],this._edgeCount--),this},i.prototype.inEdges=function(h,g){var _=this._in[h];if(_){var y=n.values(_);return g?n.filter(y,function(T){return T.v===g}):y}},i.prototype.outEdges=function(h,g){var _=this._out[h];if(_){var y=n.values(_);return g?n.filter(y,function(T){return T.w===g}):y}},i.prototype.nodeEdges=function(h,g){var _=this.inEdges(h,g);if(_)return _.concat(this.outEdges(h,g))};function s(h,g){h[g]?h[g]++:h[g]=1}function o(h,g){--h[g]||delete h[g]}function l(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}return T+r+w+r+(n.isUndefined(y)?e:y)}function u(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}var S={v:T,w};return y&&(S.name=y),S}function d(h,g){return l(h,g.v,g.w,g.name)}return sy}var ay,lC;function V7(){return lC||(lC=1,ay="2.1.8"),ay}var oy,cC;function q7(){return cC||(cC=1,oy={Graph:m1(),version:V7()}),oy}var ly,uC;function $7(){if(uC)return ly;uC=1;var n=pr(),e=m1();ly={write:t,read:s};function t(o){var l={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:i(o)};return n.isUndefined(o.graph())||(l.value=n.clone(o.graph())),l}function r(o){return n.map(o.nodes(),function(l){var u=o.node(l),d=o.parent(l),h={v:l};return n.isUndefined(u)||(h.value=u),n.isUndefined(d)||(h.parent=d),h})}function i(o){return n.map(o.edges(),function(l){var u=o.edge(l),d={v:l.v,w:l.w};return n.isUndefined(l.name)||(d.name=l.name),n.isUndefined(u)||(d.value=u),d})}function s(o){var l=new e(o.options).setGraph(o.value);return n.each(o.nodes,function(u){l.setNode(u.v,u.value),u.parent&&l.setParent(u.v,u.parent)}),n.each(o.edges,function(u){l.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),l}return ly}var cy,fC;function H7(){if(fC)return cy;fC=1;var n=pr();cy=e;function e(t){var r={},i=[],s;function o(l){n.has(r,l)||(r[l]=!0,s.push(l),n.each(t.successors(l),o),n.each(t.predecessors(l),o))}return n.each(t.nodes(),function(l){s=[],o(l),s.length&&i.push(s)}),i}return cy}var uy,dC;function oO(){if(dC)return uy;dC=1;var n=pr();uy=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(t){return t.key})},e.prototype.has=function(t){return n.has(this._keyIndices,t)},e.prototype.priority=function(t){var r=this._keyIndices[t];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(t,r){var i=this._keyIndices;if(t=String(t),!n.has(i,t)){var s=this._arr,o=s.length;return i[t]=o,s.push({key:t,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},e.prototype.decrease=function(t,r){var i=this._keyIndices[t];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(t){var r=this._arr,i=2*t,s=i+1,o=t;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==t&&(this._swap(t,o),this._heapify(o)))},e.prototype._decrease=function(t){for(var r=this._arr,i=r[t].priority,s;t!==0&&(s=t>>1,!(r[s].priority<i));)this._swap(t,s),t=s},e.prototype._swap=function(t,r){var i=this._arr,s=this._keyIndices,o=i[t],l=i[r];i[t]=l,i[r]=o,s[l.key]=t,s[o.key]=r},uy}var fy,hC;function lO(){if(hC)return fy;hC=1;var n=pr(),e=oO();fy=r;var t=n.constant(1);function r(s,o,l,u){return i(s,String(o),l||t,u||function(d){return s.outEdges(d)})}function i(s,o,l,u){var d={},h=new e,g,_,y=function(T){var w=T.v!==g?T.v:T.w,x=d[w],S=l(T),A=_.distance+S;if(S<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+T+" Weight: "+S);A<x.distance&&(x.distance=A,x.predecessor=g,h.decrease(w,A))};for(s.nodes().forEach(function(T){var w=T===o?0:Number.POSITIVE_INFINITY;d[T]={distance:w},h.add(T,w)});h.size()>0&&(g=h.removeMin(),_=d[g],_.distance!==Number.POSITIVE_INFINITY);)u(g).forEach(y);return d}return fy}var dy,pC;function W7(){if(pC)return dy;pC=1;var n=lO(),e=pr();dy=t;function t(r,i,s){return e.transform(r.nodes(),function(o,l){o[l]=n(r,l,i,s)},{})}return dy}var hy,gC;function cO(){if(gC)return hy;gC=1;var n=pr();hy=e;function e(t){var r=0,i=[],s={},o=[];function l(u){var d=s[u]={onStack:!0,lowlink:r,index:r++};if(i.push(u),t.successors(u).forEach(function(_){n.has(s,_)?s[_].onStack&&(d.lowlink=Math.min(d.lowlink,s[_].index)):(l(_),d.lowlink=Math.min(d.lowlink,s[_].lowlink))}),d.lowlink===d.index){var h=[],g;do g=i.pop(),s[g].onStack=!1,h.push(g);while(u!==g);o.push(h)}}return t.nodes().forEach(function(u){n.has(s,u)||l(u)}),o}return hy}var py,mC;function X7(){if(mC)return py;mC=1;var n=pr(),e=cO();py=t;function t(r){return n.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return py}var gy,_C;function Y7(){if(_C)return gy;_C=1;var n=pr();gy=t;var e=n.constant(1);function t(i,s,o){return r(i,s||e,o||function(l){return i.outEdges(l)})}function r(i,s,o){var l={},u=i.nodes();return u.forEach(function(d){l[d]={},l[d][d]={distance:0},u.forEach(function(h){d!==h&&(l[d][h]={distance:Number.POSITIVE_INFINITY})}),o(d).forEach(function(h){var g=h.v===d?h.w:h.v,_=s(h);l[d][g]={distance:_,predecessor:d}})}),u.forEach(function(d){var h=l[d];u.forEach(function(g){var _=l[g];u.forEach(function(y){var T=_[d],w=h[y],x=_[y],S=T.distance+w.distance;S<x.distance&&(x.distance=S,x.predecessor=w.predecessor)})})}),l}return gy}var my,vC;function uO(){if(vC)return my;vC=1;var n=pr();my=e,e.CycleException=t;function e(r){var i={},s={},o=[];function l(u){if(n.has(s,u))throw new t;n.has(i,u)||(s[u]=!0,i[u]=!0,n.each(r.predecessors(u),l),delete s[u],o.push(u))}if(n.each(r.sinks(),l),n.size(i)!==r.nodeCount())throw new t;return o}function t(){}return t.prototype=new Error,my}var _y,yC;function G7(){if(yC)return _y;yC=1;var n=uO();_y=e;function e(t){try{n(t)}catch(r){if(r instanceof n.CycleException)return!1;throw r}return!0}return _y}var vy,bC;function fO(){if(bC)return vy;bC=1;var n=pr();vy=e;function e(r,i,s){n.isArray(i)||(i=[i]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),l=[],u={};return n.each(i,function(d){if(!r.hasNode(d))throw new Error("Graph does not have node: "+d);t(r,d,s==="post",u,o,l)}),l}function t(r,i,s,o,l,u){n.has(o,i)||(o[i]=!0,s||u.push(i),n.each(l(i),function(d){t(r,d,s,o,l,u)}),s&&u.push(i))}return vy}var yy,xC;function K7(){if(xC)return yy;xC=1;var n=fO();yy=e;function e(t,r){return n(t,r,"post")}return yy}var by,wC;function Z7(){if(wC)return by;wC=1;var n=fO();by=e;function e(t,r){return n(t,r,"pre")}return by}var xy,TC;function Q7(){if(TC)return xy;TC=1;var n=pr(),e=m1(),t=oO();xy=r;function r(i,s){var o=new e,l={},u=new t,d;function h(_){var y=_.v===d?_.w:_.v,T=u.priority(y);if(T!==void 0){var w=s(_);w<T&&(l[y]=d,u.decrease(y,w))}}if(i.nodeCount()===0)return o;n.each(i.nodes(),function(_){u.add(_,Number.POSITIVE_INFINITY),o.setNode(_)}),u.decrease(i.nodes()[0],0);for(var g=!1;u.size()>0;){if(d=u.removeMin(),n.has(l,d))o.setEdge(d,l[d]);else{if(g)throw new Error("Input graph is not connected: "+i);g=!0}i.nodeEdges(d).forEach(h)}return o}return xy}var wy,SC;function J7(){return SC||(SC=1,wy={components:H7(),dijkstra:lO(),dijkstraAll:W7(),findCycles:X7(),floydWarshall:Y7(),isAcyclic:G7(),postorder:K7(),preorder:Z7(),prim:Q7(),tarjan:cO(),topsort:uO()}),wy}var Ty,EC;function e9(){if(EC)return Ty;EC=1;var n=q7();return Ty={Graph:n.Graph,json:$7(),alg:J7(),version:n.version},Ty}var Sy,AC;function Rr(){if(AC)return Sy;AC=1;var n;if(typeof e1=="function")try{n=e9()}catch{}return n||(n=window.graphlib),Sy=n,Sy}var Ey,RC;function t9(){if(RC)return Ey;RC=1;var n=jI(),e=1,t=4;function r(i){return n(i,e|t)}return Ey=r,Ey}var Ay,CC;function Gd(){if(CC)return Ay;CC=1;var n=yo(),e=_i(),t=Fd(),r=hr();function i(s,o,l){if(!r(l))return!1;var u=typeof o;return(u=="number"?e(l)&&t(o,l.length):u=="string"&&o in l)?n(l[o],s):!1}return Ay=i,Ay}var Ry,NC;function n9(){if(NC)return Ry;NC=1;var n=Yd(),e=yo(),t=Gd(),r=Xs(),i=Object.prototype,s=i.hasOwnProperty,o=n(function(l,u){l=Object(l);var d=-1,h=u.length,g=h>2?u[2]:void 0;for(g&&t(u[0],u[1],g)&&(h=1);++d<h;)for(var _=u[d],y=r(_),T=-1,w=y.length;++T<w;){var x=y[T],S=l[x];(S===void 0||e(S,i[x])&&!s.call(l,x))&&(l[x]=_[x])}return l});return Ry=o,Ry}var Cy,kC;function r9(){if(kC)return Cy;kC=1;var n=vi(),e=_i(),t=ss();function r(i){return function(s,o,l){var u=Object(s);if(!e(s)){var d=n(o,3);s=t(s),o=function(g){return d(u[g],g,u)}}var h=i(s,o,l);return h>-1?u[d?s[h]:h]:void 0}}return Cy=r,Cy}var Ny,MC;function i9(){if(MC)return Ny;MC=1;var n=/\s/;function e(t){for(var r=t.length;r--&&n.test(t.charAt(r)););return r}return Ny=e,Ny}var ky,IC;function s9(){if(IC)return ky;IC=1;var n=i9(),e=/^\s+/;function t(r){return r&&r.slice(0,n(r)+1).replace(e,"")}return ky=t,ky}var My,OC;function a9(){if(OC)return My;OC=1;var n=s9(),e=hr(),t=To(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(t(d))return r;if(e(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=e(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=n(d);var g=s.test(d);return g||o.test(d)?l(d.slice(2),g?2:8):i.test(d)?r:+d}return My=u,My}var Iy,PC;function dO(){if(PC)return Iy;PC=1;var n=a9(),e=1/0,t=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=n(i),i===e||i===-1/0){var s=i<0?-1:1;return s*t}return i===i?i:0}return Iy=r,Iy}var Oy,DC;function o9(){if(DC)return Oy;DC=1;var n=dO();function e(t){var r=n(t),i=r%1;return r===r?i?r-i:r:0}return Oy=e,Oy}var Py,jC;function l9(){if(jC)return Py;jC=1;var n=iO(),e=vi(),t=o9(),r=Math.max;function i(s,o,l){var u=s==null?0:s.length;if(!u)return-1;var d=l==null?0:t(l);return d<0&&(d=r(u+d,0)),n(s,e(o,3),d)}return Py=i,Py}var Dy,LC;function c9(){if(LC)return Dy;LC=1;var n=r9(),e=l9(),t=n(e);return Dy=t,Dy}var jy,BC;function hO(){if(BC)return jy;BC=1;var n=g1();function e(t){var r=t==null?0:t.length;return r?n(t,1):[]}return jy=e,jy}var Ly,UC;function u9(){if(UC)return Ly;UC=1;var n=f1(),e=LI(),t=Xs();function r(i,s){return i==null?i:n(i,e(s),t)}return Ly=r,Ly}var By,FC;function f9(){if(FC)return By;FC=1;function n(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}return By=n,By}var Uy,zC;function d9(){if(zC)return Uy;zC=1;var n=Bd(),e=d1(),t=vi();function r(i,s){var o={};return s=t(s,3),e(i,function(l,u,d){n(o,u,s(l,u,d))}),o}return Uy=r,Uy}var Fy,VC;function _1(){if(VC)return Fy;VC=1;var n=To();function e(t,r,i){for(var s=-1,o=t.length;++s<o;){var l=t[s],u=r(l);if(u!=null&&(d===void 0?u===u&&!n(u):i(u,d)))var d=u,h=l}return h}return Fy=e,Fy}var zy,qC;function h9(){if(qC)return zy;qC=1;function n(e,t){return e>t}return zy=n,zy}var Vy,$C;function p9(){if($C)return Vy;$C=1;var n=_1(),e=h9(),t=Ys();function r(i){return i&&i.length?n(i,t,e):void 0}return Vy=r,Vy}var qy,HC;function pO(){if(HC)return qy;HC=1;var n=Bd(),e=yo();function t(r,i,s){(s!==void 0&&!e(r[i],s)||s===void 0&&!(i in r))&&n(r,i,s)}return qy=t,qy}var $y,WC;function g9(){if(WC)return $y;WC=1;var n=Hs(),e=qd(),t=Wr(),r="[object Object]",i=Function.prototype,s=Object.prototype,o=i.toString,l=s.hasOwnProperty,u=o.call(Object);function d(h){if(!t(h)||n(h)!=r)return!1;var g=e(h);if(g===null)return!0;var _=l.call(g,"constructor")&&g.constructor;return typeof _=="function"&&_ instanceof _&&o.call(_)==u}return $y=d,$y}var Hy,XC;function gO(){if(XC)return Hy;XC=1;function n(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}return Hy=n,Hy}var Wy,YC;function m9(){if(YC)return Wy;YC=1;var n=bc(),e=Xs();function t(r){return n(r,e(r))}return Wy=t,Wy}var Xy,GC;function _9(){if(GC)return Xy;GC=1;var n=pO(),e=SI(),t=OI(),r=EI(),i=DI(),s=xc(),o=Ht(),l=sO(),u=xo(),d=yc(),h=hr(),g=g9(),_=wc(),y=gO(),T=m9();function w(x,S,A,R,E,C,O){var D=y(x,A),M=y(S,A),P=O.get(M);if(P){n(x,A,P);return}var k=C?C(D,M,A+"",x,S,O):void 0,V=k===void 0;if(V){var X=o(M),Z=!X&&u(M),$=!X&&!Z&&_(M);k=M,X||Z||$?o(D)?k=D:l(D)?k=r(D):Z?(V=!1,k=e(M,!0)):$?(V=!1,k=t(M,!0)):k=[]:g(M)||s(M)?(k=D,s(D)?k=T(D):(!h(D)||d(D))&&(k=i(M))):V=!1}V&&(O.set(M,k),E(k,M,R,C,O),O.delete(M)),n(x,A,k)}return Xy=w,Xy}var Yy,KC;function v9(){if(KC)return Yy;KC=1;var n=Ld(),e=pO(),t=f1(),r=_9(),i=hr(),s=Xs(),o=gO();function l(u,d,h,g,_){u!==d&&t(d,function(y,T){if(_||(_=new n),i(y))r(u,d,T,h,l,g,_);else{var w=g?g(o(u,T),y,T+"",u,d,_):void 0;w===void 0&&(w=y),e(u,T,w)}},s)}return Yy=l,Yy}var Gy,ZC;function y9(){if(ZC)return Gy;ZC=1;var n=Yd(),e=Gd();function t(r){return n(function(i,s){var o=-1,l=s.length,u=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(s[0],s[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++o<l;){var h=s[o];h&&r(i,h,o,u)}return i})}return Gy=t,Gy}var Ky,QC;function b9(){if(QC)return Ky;QC=1;var n=v9(),e=y9(),t=e(function(r,i,s){n(r,i,s)});return Ky=t,Ky}var Zy,JC;function mO(){if(JC)return Zy;JC=1;function n(e,t){return e<t}return Zy=n,Zy}var Qy,eN;function x9(){if(eN)return Qy;eN=1;var n=_1(),e=mO(),t=Ys();function r(i){return i&&i.length?n(i,t,e):void 0}return Qy=r,Qy}var Jy,tN;function w9(){if(tN)return Jy;tN=1;var n=_1(),e=vi(),t=mO();function r(i,s){return i&&i.length?n(i,e(s,2),t):void 0}return Jy=r,Jy}var eb,nN;function T9(){if(nN)return eb;nN=1;var n=kr(),e=function(){return n.Date.now()};return eb=e,eb}var tb,rN;function S9(){if(rN)return tb;rN=1;var n=Ud(),e=Wd(),t=Fd(),r=hr(),i=Tc();function s(o,l,u,d){if(!r(o))return o;l=e(l,o);for(var h=-1,g=l.length,_=g-1,y=o;y!=null&&++h<g;){var T=i(l[h]),w=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(h!=_){var x=y[T];w=d?d(x,T,y):void 0,w===void 0&&(w=r(x)?x:t(l[h+1])?[]:{})}n(y,T,w),y=y[T]}return o}return tb=s,tb}var nb,iN;function E9(){if(iN)return nb;iN=1;var n=Xd(),e=S9(),t=Wd();function r(i,s,o){for(var l=-1,u=s.length,d={};++l<u;){var h=s[l],g=n(i,h);o(g,h)&&e(d,t(h,i),g)}return d}return nb=r,nb}var rb,sN;function A9(){if(sN)return rb;sN=1;var n=E9(),e=YI();function t(r,i){return n(r,i,function(s,o){return e(r,o)})}return rb=t,rb}var ib,aN;function R9(){if(aN)return ib;aN=1;var n=hO(),e=nO(),t=rO();function r(i){return t(e(i,void 0,n),i+"")}return ib=r,ib}var sb,oN;function C9(){if(oN)return sb;oN=1;var n=A9(),e=R9(),t=e(function(r,i){return r==null?{}:n(r,i)});return sb=t,sb}var ab,lN;function N9(){if(lN)return ab;lN=1;var n=Math.ceil,e=Math.max;function t(r,i,s,o){for(var l=-1,u=e(n((i-r)/(s||1)),0),d=Array(u);u--;)d[o?u:++l]=r,r+=s;return d}return ab=t,ab}var ob,cN;function k9(){if(cN)return ob;cN=1;var n=N9(),e=Gd(),t=dO();function r(i){return function(s,o,l){return l&&typeof l!="number"&&e(s,o,l)&&(o=l=void 0),s=t(s),o===void 0?(o=s,s=0):o=t(o),l=l===void 0?s<o?1:-1:t(l),n(s,o,l,i)}}return ob=r,ob}var lb,uN;function M9(){if(uN)return lb;uN=1;var n=k9(),e=n();return lb=e,lb}var cb,fN;function I9(){if(fN)return cb;fN=1;function n(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}return cb=n,cb}var ub,dN;function O9(){if(dN)return ub;dN=1;var n=To();function e(t,r){if(t!==r){var i=t!==void 0,s=t===null,o=t===t,l=n(t),u=r!==void 0,d=r===null,h=r===r,g=n(r);if(!d&&!g&&!l&&t>r||l&&u&&h&&!d&&!g||s&&u&&h||!i&&h||!o)return 1;if(!s&&!l&&!g&&t<r||g&&i&&o&&!s&&!l||d&&i&&o||!u&&o||!h)return-1}return 0}return ub=e,ub}var fb,hN;function P9(){if(hN)return fb;hN=1;var n=O9();function e(t,r,i){for(var s=-1,o=t.criteria,l=r.criteria,u=o.length,d=i.length;++s<u;){var h=n(o[s],l[s]);if(h){if(s>=d)return h;var g=i[s];return h*(g=="desc"?-1:1)}}return t.index-r.index}return fb=e,fb}var db,pN;function D9(){if(pN)return db;pN=1;var n=Hd(),e=Xd(),t=vi(),r=JI(),i=I9(),s=zd(),o=P9(),l=Ys(),u=Ht();function d(h,g,_){g.length?g=n(g,function(w){return u(w)?function(x){return e(x,w.length===1?w[0]:w)}:w}):g=[l];var y=-1;g=n(g,s(t));var T=r(h,function(w,x,S){var A=n(g,function(R){return R(w)});return{criteria:A,index:++y,value:w}});return i(T,function(w,x){return o(w,x,_)})}return db=d,db}var hb,gN;function j9(){if(gN)return hb;gN=1;var n=g1(),e=D9(),t=Yd(),r=Gd(),i=t(function(s,o){if(s==null)return[];var l=o.length;return l>1&&r(s,o[0],o[1])?o=[]:l>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(s,n(o,1),[])});return hb=i,hb}var pb,mN;function L9(){if(mN)return pb;mN=1;var n=WI(),e=0;function t(r){var i=++e;return n(r)+i}return pb=t,pb}var gb,_N;function B9(){if(_N)return gb;_N=1;function n(e,t,r){for(var i=-1,s=e.length,o=t.length,l={};++i<s;){var u=i<o?t[i]:void 0;r(l,e[i],u)}return l}return gb=n,gb}var mb,vN;function U9(){if(vN)return mb;vN=1;var n=Ud(),e=B9();function t(r,i){return e(r||[],i||[],n)}return mb=t,mb}var _b,yN;function wt(){if(yN)return _b;yN=1;var n;if(typeof e1=="function")try{n={cloneDeep:t9(),constant:u1(),defaults:n9(),each:UI(),filter:KI(),find:c9(),flatten:hO(),forEach:BI(),forIn:u9(),has:ZI(),isUndefined:QI(),last:f9(),map:eO(),mapValues:d9(),max:p9(),merge:b9(),min:x9(),minBy:w9(),now:T9(),pick:C9(),range:M9(),reduce:tO(),sortBy:j9(),uniqueId:L9(),values:aO(),zipObject:U9()}}catch{}return n||(n=window._),_b=n,_b}var vb,bN;function F9(){if(bN)return vb;bN=1,vb=n;function n(){var r={};r._next=r._prev=r,this._sentinel=r}n.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},n.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},n.prototype.toString=function(){for(var r=[],i=this._sentinel,s=i._prev;s!==i;)r.push(JSON.stringify(s,t)),s=s._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function t(r,i){if(r!=="_next"&&r!=="_prev")return i}return vb}var yb,xN;function z9(){if(xN)return yb;xN=1;var n=wt(),e=Rr().Graph,t=F9();yb=i;var r=n.constant(1);function i(d,h){if(d.nodeCount()<=1)return[];var g=l(d,h||r),_=s(g.graph,g.buckets,g.zeroIdx);return n.flatten(n.map(_,function(y){return d.outEdges(y.v,y.w)}),!0)}function s(d,h,g){for(var _=[],y=h[h.length-1],T=h[0],w;d.nodeCount();){for(;w=T.dequeue();)o(d,h,g,w);for(;w=y.dequeue();)o(d,h,g,w);if(d.nodeCount()){for(var x=h.length-2;x>0;--x)if(w=h[x].dequeue(),w){_=_.concat(o(d,h,g,w,!0));break}}}return _}function o(d,h,g,_,y){var T=y?[]:void 0;return n.forEach(d.inEdges(_.v),function(w){var x=d.edge(w),S=d.node(w.v);y&&T.push({v:w.v,w:w.w}),S.out-=x,u(h,g,S)}),n.forEach(d.outEdges(_.v),function(w){var x=d.edge(w),S=w.w,A=d.node(S);A.in-=x,u(h,g,A)}),d.removeNode(_.v),T}function l(d,h){var g=new e,_=0,y=0;n.forEach(d.nodes(),function(x){g.setNode(x,{v:x,in:0,out:0})}),n.forEach(d.edges(),function(x){var S=g.edge(x.v,x.w)||0,A=h(x),R=S+A;g.setEdge(x.v,x.w,R),y=Math.max(y,g.node(x.v).out+=A),_=Math.max(_,g.node(x.w).in+=A)});var T=n.range(y+_+3).map(function(){return new t}),w=_+1;return n.forEach(g.nodes(),function(x){u(T,w,g.node(x))}),{graph:g,buckets:T,zeroIdx:w}}function u(d,h,g){g.out?g.in?d[g.out-g.in+h].enqueue(g):d[d.length-1].enqueue(g):d[0].enqueue(g)}return yb}var bb,wN;function V9(){if(wN)return bb;wN=1;var n=wt(),e=z9();bb={run:t,undo:i};function t(s){var o=s.graph().acyclicer==="greedy"?e(s,l(s)):r(s);n.forEach(o,function(u){var d=s.edge(u);s.removeEdge(u),d.forwardName=u.name,d.reversed=!0,s.setEdge(u.w,u.v,d,n.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(s){var o=[],l={},u={};function d(h){n.has(u,h)||(u[h]=!0,l[h]=!0,n.forEach(s.outEdges(h),function(g){n.has(l,g.w)?o.push(g):d(g.w)}),delete l[h])}return n.forEach(s.nodes(),d),o}function i(s){n.forEach(s.edges(),function(o){var l=s.edge(o);if(l.reversed){s.removeEdge(o);var u=l.forwardName;delete l.reversed,delete l.forwardName,s.setEdge(o.w,o.v,l,u)}})}return bb}var xb,TN;function Dn(){if(TN)return xb;TN=1;var n=wt(),e=Rr().Graph;xb={addDummyNode:t,simplify:r,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:o,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:h,addBorderNode:g,maxRank:_,partition:y,time:T,notime:w};function t(x,S,A,R){var E;do E=n.uniqueId(R);while(x.hasNode(E));return A.dummy=S,x.setNode(E,A),E}function r(x){var S=new e().setGraph(x.graph());return n.forEach(x.nodes(),function(A){S.setNode(A,x.node(A))}),n.forEach(x.edges(),function(A){var R=S.edge(A.v,A.w)||{weight:0,minlen:1},E=x.edge(A);S.setEdge(A.v,A.w,{weight:R.weight+E.weight,minlen:Math.max(R.minlen,E.minlen)})}),S}function i(x){var S=new e({multigraph:x.isMultigraph()}).setGraph(x.graph());return n.forEach(x.nodes(),function(A){x.children(A).length||S.setNode(A,x.node(A))}),n.forEach(x.edges(),function(A){S.setEdge(A,x.edge(A))}),S}function s(x){var S=n.map(x.nodes(),function(A){var R={};return n.forEach(x.outEdges(A),function(E){R[E.w]=(R[E.w]||0)+x.edge(E).weight}),R});return n.zipObject(x.nodes(),S)}function o(x){var S=n.map(x.nodes(),function(A){var R={};return n.forEach(x.inEdges(A),function(E){R[E.v]=(R[E.v]||0)+x.edge(E).weight}),R});return n.zipObject(x.nodes(),S)}function l(x,S){var A=x.x,R=x.y,E=S.x-A,C=S.y-R,O=x.width/2,D=x.height/2;if(!E&&!C)throw new Error("Not possible to find intersection inside of the rectangle");var M,P;return Math.abs(C)*O>Math.abs(E)*D?(C<0&&(D=-D),M=D*E/C,P=D):(E<0&&(O=-O),M=O,P=O*C/E),{x:A+M,y:R+P}}function u(x){var S=n.map(n.range(_(x)+1),function(){return[]});return n.forEach(x.nodes(),function(A){var R=x.node(A),E=R.rank;n.isUndefined(E)||(S[E][R.order]=A)}),S}function d(x){var S=n.min(n.map(x.nodes(),function(A){return x.node(A).rank}));n.forEach(x.nodes(),function(A){var R=x.node(A);n.has(R,"rank")&&(R.rank-=S)})}function h(x){var S=n.min(n.map(x.nodes(),function(C){return x.node(C).rank})),A=[];n.forEach(x.nodes(),function(C){var O=x.node(C).rank-S;A[O]||(A[O]=[]),A[O].push(C)});var R=0,E=x.graph().nodeRankFactor;n.forEach(A,function(C,O){n.isUndefined(C)&&O%E!==0?--R:R&&n.forEach(C,function(D){x.node(D).rank+=R})})}function g(x,S,A,R){var E={width:0,height:0};return arguments.length>=4&&(E.rank=A,E.order=R),t(x,"border",E,S)}function _(x){return n.max(n.map(x.nodes(),function(S){var A=x.node(S).rank;if(!n.isUndefined(A))return A}))}function y(x,S){var A={lhs:[],rhs:[]};return n.forEach(x,function(R){S(R)?A.lhs.push(R):A.rhs.push(R)}),A}function T(x,S){var A=n.now();try{return S()}finally{console.log(x+" time: "+(n.now()-A)+"ms")}}function w(x,S){return S()}return xb}var wb,SN;function q9(){if(SN)return wb;SN=1;var n=wt(),e=Dn();wb={run:t,undo:i};function t(s){s.graph().dummyChains=[],n.forEach(s.edges(),function(o){r(s,o)})}function r(s,o){var l=o.v,u=s.node(l).rank,d=o.w,h=s.node(d).rank,g=o.name,_=s.edge(o),y=_.labelRank;if(h!==u+1){s.removeEdge(o);var T,w,x;for(x=0,++u;u<h;++x,++u)_.points=[],w={width:0,height:0,edgeLabel:_,edgeObj:o,rank:u},T=e.addDummyNode(s,"edge",w,"_d"),u===y&&(w.width=_.width,w.height=_.height,w.dummy="edge-label",w.labelpos=_.labelpos),s.setEdge(l,T,{weight:_.weight},g),x===0&&s.graph().dummyChains.push(T),l=T;s.setEdge(l,d,{weight:_.weight},g)}}function i(s){n.forEach(s.graph().dummyChains,function(o){var l=s.node(o),u=l.edgeLabel,d;for(s.setEdge(l.edgeObj,u);l.dummy;)d=s.successors(o)[0],s.removeNode(o),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),o=d,l=s.node(o)})}return wb}var Tb,EN;function Mf(){if(EN)return Tb;EN=1;var n=wt();Tb={longestPath:e,slack:t};function e(r){var i={};function s(o){var l=r.node(o);if(n.has(i,o))return l.rank;i[o]=!0;var u=n.min(n.map(r.outEdges(o),function(d){return s(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}n.forEach(r.sources(),s)}function t(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return Tb}var Sb,AN;function _O(){if(AN)return Sb;AN=1;var n=wt(),e=Rr().Graph,t=Mf().slack;Sb=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],h=l.nodeCount();u.setNode(d,{});for(var g,_;i(u,l)<h;)g=s(u,l),_=u.hasNode(g.v)?t(l,g):-t(l,g),o(u,l,_);return u}function i(l,u){function d(h){n.forEach(u.nodeEdges(h),function(g){var _=g.v,y=h===_?g.w:_;!l.hasNode(y)&&!t(u,g)&&(l.setNode(y,{}),l.setEdge(h,y,{}),d(y))})}return n.forEach(l.nodes(),d),l.nodeCount()}function s(l,u){return n.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return t(u,d)})}function o(l,u,d){n.forEach(l.nodes(),function(h){u.node(h).rank+=d})}return Sb}var Eb,RN;function $9(){if(RN)return Eb;RN=1;var n=wt(),e=_O(),t=Mf().slack,r=Mf().longestPath,i=Rr().alg.preorder,s=Rr().alg.postorder,o=Dn().simplify;Eb=l,l.initLowLimValues=g,l.initCutValues=u,l.calcCutValue=h,l.leaveEdge=y,l.enterEdge=T,l.exchangeEdges=w;function l(R){R=o(R),r(R);var E=e(R);g(E),u(E,R);for(var C,O;C=y(E);)O=T(E,R,C),w(E,R,C,O)}function u(R,E){var C=s(R,R.nodes());C=C.slice(0,C.length-1),n.forEach(C,function(O){d(R,E,O)})}function d(R,E,C){var O=R.node(C),D=O.parent;R.edge(C,D).cutvalue=h(R,E,C)}function h(R,E,C){var O=R.node(C),D=O.parent,M=!0,P=E.edge(C,D),k=0;return P||(M=!1,P=E.edge(D,C)),k=P.weight,n.forEach(E.nodeEdges(C),function(V){var X=V.v===C,Z=X?V.w:V.v;if(Z!==D){var $=X===M,H=E.edge(V).weight;if(k+=$?H:-H,S(R,C,Z)){var z=R.edge(C,Z).cutvalue;k+=$?-z:z}}}),k}function g(R,E){arguments.length<2&&(E=R.nodes()[0]),_(R,{},1,E)}function _(R,E,C,O,D){var M=C,P=R.node(O);return E[O]=!0,n.forEach(R.neighbors(O),function(k){n.has(E,k)||(C=_(R,E,C,k,O))}),P.low=M,P.lim=C++,D?P.parent=D:delete P.parent,C}function y(R){return n.find(R.edges(),function(E){return R.edge(E).cutvalue<0})}function T(R,E,C){var O=C.v,D=C.w;E.hasEdge(O,D)||(O=C.w,D=C.v);var M=R.node(O),P=R.node(D),k=M,V=!1;M.lim>P.lim&&(k=P,V=!0);var X=n.filter(E.edges(),function(Z){return V===A(R,R.node(Z.v),k)&&V!==A(R,R.node(Z.w),k)});return n.minBy(X,function(Z){return t(E,Z)})}function w(R,E,C,O){var D=C.v,M=C.w;R.removeEdge(D,M),R.setEdge(O.v,O.w,{}),g(R),u(R,E),x(R,E)}function x(R,E){var C=n.find(R.nodes(),function(D){return!E.node(D).parent}),O=i(R,C);O=O.slice(1),n.forEach(O,function(D){var M=R.node(D).parent,P=E.edge(D,M),k=!1;P||(P=E.edge(M,D),k=!0),E.node(D).rank=E.node(M).rank+(k?P.minlen:-P.minlen)})}function S(R,E,C){return R.hasEdge(E,C)}function A(R,E,C){return C.low<=E.lim&&E.lim<=C.lim}return Eb}var Ab,CN;function H9(){if(CN)return Ab;CN=1;var n=Mf(),e=n.longestPath,t=_O(),r=$9();Ab=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":o(u);break;case"longest-path":s(u);break;default:l(u)}}var s=e;function o(u){e(u),t(u)}function l(u){r(u)}return Ab}var Rb,NN;function W9(){if(NN)return Rb;NN=1;var n=wt();Rb=e;function e(i){var s=r(i);n.forEach(i.graph().dummyChains,function(o){for(var l=i.node(o),u=l.edgeObj,d=t(i,s,u.v,u.w),h=d.path,g=d.lca,_=0,y=h[_],T=!0;o!==u.w;){if(l=i.node(o),T){for(;(y=h[_])!==g&&i.node(y).maxRank<l.rank;)_++;y===g&&(T=!1)}if(!T){for(;_<h.length-1&&i.node(y=h[_+1]).minRank<=l.rank;)_++;y=h[_]}i.setParent(o,y),o=i.successors(o)[0]}})}function t(i,s,o,l){var u=[],d=[],h=Math.min(s[o].low,s[l].low),g=Math.max(s[o].lim,s[l].lim),_,y;_=o;do _=i.parent(_),u.push(_);while(_&&(s[_].low>h||g>s[_].lim));for(y=_,_=l;(_=i.parent(_))!==y;)d.push(_);return{path:u.concat(d.reverse()),lca:y}}function r(i){var s={},o=0;function l(u){var d=o;n.forEach(i.children(u),l),s[u]={low:d,lim:o++}}return n.forEach(i.children(),l),s}return Rb}var Cb,kN;function X9(){if(kN)return Cb;kN=1;var n=wt(),e=Dn();Cb={run:t,cleanup:o};function t(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),h=n.max(n.values(d))-1,g=2*h+1;l.graph().nestingRoot=u,n.forEach(l.edges(),function(y){l.edge(y).minlen*=g});var _=s(l)+1;n.forEach(l.children(),function(y){r(l,u,g,_,h,d,y)}),l.graph().nodeRankFactor=g}function r(l,u,d,h,g,_,y){var T=l.children(y);if(!T.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var w=e.addBorderNode(l,"_bt"),x=e.addBorderNode(l,"_bb"),S=l.node(y);l.setParent(w,y),S.borderTop=w,l.setParent(x,y),S.borderBottom=x,n.forEach(T,function(A){r(l,u,d,h,g,_,A);var R=l.node(A),E=R.borderTop?R.borderTop:A,C=R.borderBottom?R.borderBottom:A,O=R.borderTop?h:2*h,D=E!==C?1:g-_[y]+1;l.setEdge(w,E,{weight:O,minlen:D,nestingEdge:!0}),l.setEdge(C,x,{weight:O,minlen:D,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,w,{weight:0,minlen:g+_[y]})}function i(l){var u={};function d(h,g){var _=l.children(h);_&&_.length&&n.forEach(_,function(y){d(y,g+1)}),u[h]=g}return n.forEach(l.children(),function(h){d(h,1)}),u}function s(l){return n.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function o(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,n.forEach(l.edges(),function(d){var h=l.edge(d);h.nestingEdge&&l.removeEdge(d)})}return Cb}var Nb,MN;function Y9(){if(MN)return Nb;MN=1;var n=wt(),e=Dn();Nb=t;function t(i){function s(o){var l=i.children(o),u=i.node(o);if(l.length&&n.forEach(l,s),n.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,h=u.maxRank+1;d<h;++d)r(i,"borderLeft","_bl",o,u,d),r(i,"borderRight","_br",o,u,d)}}n.forEach(i.children(),s)}function r(i,s,o,l,u,d){var h={width:0,height:0,rank:d,borderType:s},g=u[s][d-1],_=e.addDummyNode(i,"border",h,o);u[s][d]=_,i.setParent(_,l),g&&i.setEdge(g,_,{weight:1})}return Nb}var kb,IN;function G9(){if(IN)return kb;IN=1;var n=wt();kb={adjust:e,undo:t};function e(d){var h=d.graph().rankdir.toLowerCase();(h==="lr"||h==="rl")&&r(d)}function t(d){var h=d.graph().rankdir.toLowerCase();(h==="bt"||h==="rl")&&s(d),(h==="lr"||h==="rl")&&(l(d),r(d))}function r(d){n.forEach(d.nodes(),function(h){i(d.node(h))}),n.forEach(d.edges(),function(h){i(d.edge(h))})}function i(d){var h=d.width;d.width=d.height,d.height=h}function s(d){n.forEach(d.nodes(),function(h){o(d.node(h))}),n.forEach(d.edges(),function(h){var g=d.edge(h);n.forEach(g.points,o),n.has(g,"y")&&o(g)})}function o(d){d.y=-d.y}function l(d){n.forEach(d.nodes(),function(h){u(d.node(h))}),n.forEach(d.edges(),function(h){var g=d.edge(h);n.forEach(g.points,u),n.has(g,"x")&&u(g)})}function u(d){var h=d.x;d.x=d.y,d.y=h}return kb}var Mb,ON;function K9(){if(ON)return Mb;ON=1;var n=wt();Mb=e;function e(t){var r={},i=n.filter(t.nodes(),function(d){return!t.children(d).length}),s=n.max(n.map(i,function(d){return t.node(d).rank})),o=n.map(n.range(s+1),function(){return[]});function l(d){if(!n.has(r,d)){r[d]=!0;var h=t.node(d);o[h.rank].push(d),n.forEach(t.successors(d),l)}}var u=n.sortBy(i,function(d){return t.node(d).rank});return n.forEach(u,l),o}return Mb}var Ib,PN;function Z9(){if(PN)return Ib;PN=1;var n=wt();Ib=e;function e(r,i){for(var s=0,o=1;o<i.length;++o)s+=t(r,i[o-1],i[o]);return s}function t(r,i,s){for(var o=n.zipObject(s,n.map(s,function(_,y){return y})),l=n.flatten(n.map(i,function(_){return n.sortBy(n.map(r.outEdges(_),function(y){return{pos:o[y.w],weight:r.edge(y).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var d=2*u-1;u-=1;var h=n.map(new Array(d),function(){return 0}),g=0;return n.forEach(l.forEach(function(_){var y=_.pos+u;h[y]+=_.weight;for(var T=0;y>0;)y%2&&(T+=h[y+1]),y=y-1>>1,h[y]+=_.weight;g+=_.weight*T})),g}return Ib}var Ob,DN;function Q9(){if(DN)return Ob;DN=1;var n=wt();Ob=e;function e(t,r){return n.map(r,function(i){var s=t.inEdges(i);if(s.length){var o=n.reduce(s,function(l,u){var d=t.edge(u),h=t.node(u.v);return{sum:l.sum+d.weight*h.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:i}})}return Ob}var Pb,jN;function J9(){if(jN)return Pb;jN=1;var n=wt();Pb=e;function e(i,s){var o={};n.forEach(i,function(u,d){var h=o[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};n.isUndefined(u.barycenter)||(h.barycenter=u.barycenter,h.weight=u.weight)}),n.forEach(s.edges(),function(u){var d=o[u.v],h=o[u.w];!n.isUndefined(d)&&!n.isUndefined(h)&&(h.indegree++,d.out.push(o[u.w]))});var l=n.filter(o,function(u){return!u.indegree});return t(l)}function t(i){var s=[];function o(d){return function(h){h.merged||(n.isUndefined(h.barycenter)||n.isUndefined(d.barycenter)||h.barycenter>=d.barycenter)&&r(d,h)}}function l(d){return function(h){h.in.push(d),--h.indegree===0&&i.push(h)}}for(;i.length;){var u=i.pop();s.push(u),n.forEach(u.in.reverse(),o(u)),n.forEach(u.out,l(u))}return n.map(n.filter(s,function(d){return!d.merged}),function(d){return n.pick(d,["vs","i","barycenter","weight"])})}function r(i,s){var o=0,l=0;i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),s.weight&&(o+=s.barycenter*s.weight,l+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=o/l,i.weight=l,i.i=Math.min(s.i,i.i),s.merged=!0}return Pb}var Db,LN;function eV(){if(LN)return Db;LN=1;var n=wt(),e=Dn();Db=t;function t(s,o){var l=e.partition(s,function(w){return n.has(w,"barycenter")}),u=l.lhs,d=n.sortBy(l.rhs,function(w){return-w.i}),h=[],g=0,_=0,y=0;u.sort(i(!!o)),y=r(h,d,y),n.forEach(u,function(w){y+=w.vs.length,h.push(w.vs),g+=w.barycenter*w.weight,_+=w.weight,y=r(h,d,y)});var T={vs:n.flatten(h,!0)};return _&&(T.barycenter=g/_,T.weight=_),T}function r(s,o,l){for(var u;o.length&&(u=n.last(o)).i<=l;)o.pop(),s.push(u.vs),l++;return l}function i(s){return function(o,l){return o.barycenter<l.barycenter?-1:o.barycenter>l.barycenter?1:s?l.i-o.i:o.i-l.i}}return Db}var jb,BN;function tV(){if(BN)return jb;BN=1;var n=wt(),e=Q9(),t=J9(),r=eV();jb=i;function i(l,u,d,h){var g=l.children(u),_=l.node(u),y=_?_.borderLeft:void 0,T=_?_.borderRight:void 0,w={};y&&(g=n.filter(g,function(C){return C!==y&&C!==T}));var x=e(l,g);n.forEach(x,function(C){if(l.children(C.v).length){var O=i(l,C.v,d,h);w[C.v]=O,n.has(O,"barycenter")&&o(C,O)}});var S=t(x,d);s(S,w);var A=r(S,h);if(y&&(A.vs=n.flatten([y,A.vs,T],!0),l.predecessors(y).length)){var R=l.node(l.predecessors(y)[0]),E=l.node(l.predecessors(T)[0]);n.has(A,"barycenter")||(A.barycenter=0,A.weight=0),A.barycenter=(A.barycenter*A.weight+R.order+E.order)/(A.weight+2),A.weight+=2}return A}function s(l,u){n.forEach(l,function(d){d.vs=n.flatten(d.vs.map(function(h){return u[h]?u[h].vs:h}),!0)})}function o(l,u){n.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return jb}var Lb,UN;function nV(){if(UN)return Lb;UN=1;var n=wt(),e=Rr().Graph;Lb=t;function t(i,s,o){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return n.forEach(i.nodes(),function(d){var h=i.node(d),g=i.parent(d);(h.rank===s||h.minRank<=s&&s<=h.maxRank)&&(u.setNode(d),u.setParent(d,g||l),n.forEach(i[o](d),function(_){var y=_.v===d?_.w:_.v,T=u.edge(y,d),w=n.isUndefined(T)?0:T.weight;u.setEdge(y,d,{weight:i.edge(_).weight+w})}),n.has(h,"minRank")&&u.setNode(d,{borderLeft:h.borderLeft[s],borderRight:h.borderRight[s]}))}),u}function r(i){for(var s;i.hasNode(s=n.uniqueId("_root")););return s}return Lb}var Bb,FN;function rV(){if(FN)return Bb;FN=1;var n=wt();Bb=e;function e(t,r,i){var s={},o;n.forEach(i,function(l){for(var u=t.parent(l),d,h;u;){if(d=t.parent(u),d?(h=s[d],s[d]=u):(h=o,o=u),h&&h!==u){r.setEdge(h,u);return}u=d}})}return Bb}var Ub,zN;function iV(){if(zN)return Ub;zN=1;var n=wt(),e=K9(),t=Z9(),r=tV(),i=nV(),s=rV(),o=Rr().Graph,l=Dn();Ub=u;function u(_){var y=l.maxRank(_),T=d(_,n.range(1,y+1),"inEdges"),w=d(_,n.range(y-1,-1,-1),"outEdges"),x=e(_);g(_,x);for(var S=Number.POSITIVE_INFINITY,A,R=0,E=0;E<4;++R,++E){h(R%2?T:w,R%4>=2),x=l.buildLayerMatrix(_);var C=t(_,x);C<S&&(E=0,A=n.cloneDeep(x),S=C)}g(_,A)}function d(_,y,T){return n.map(y,function(w){return i(_,w,T)})}function h(_,y){var T=new o;n.forEach(_,function(w){var x=w.graph().root,S=r(w,x,T,y);n.forEach(S.vs,function(A,R){w.node(A).order=R}),s(w,T,S.vs)})}function g(_,y){n.forEach(y,function(T){n.forEach(T,function(w,x){_.node(w).order=x})})}return Ub}var Fb,VN;function sV(){if(VN)return Fb;VN=1;var n=wt(),e=Rr().Graph,t=Dn();Fb={positionX:T,findType1Conflicts:r,findType2Conflicts:i,addConflict:o,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:_,findSmallestWidthAlignment:g,balance:y};function r(S,A){var R={};function E(C,O){var D=0,M=0,P=C.length,k=n.last(O);return n.forEach(O,function(V,X){var Z=s(S,V),$=Z?S.node(Z).order:P;(Z||V===k)&&(n.forEach(O.slice(M,X+1),function(H){n.forEach(S.predecessors(H),function(z){var te=S.node(z),fe=te.order;(fe<D||$<fe)&&!(te.dummy&&S.node(H).dummy)&&o(R,z,H)})}),M=X+1,D=$)}),O}return n.reduce(A,E),R}function i(S,A){var R={};function E(O,D,M,P,k){var V;n.forEach(n.range(D,M),function(X){V=O[X],S.node(V).dummy&&n.forEach(S.predecessors(V),function(Z){var $=S.node(Z);$.dummy&&($.order<P||$.order>k)&&o(R,Z,V)})})}function C(O,D){var M=-1,P,k=0;return n.forEach(D,function(V,X){if(S.node(V).dummy==="border"){var Z=S.predecessors(V);Z.length&&(P=S.node(Z[0]).order,E(D,k,X,M,P),k=X,M=P)}E(D,k,D.length,P,O.length)}),D}return n.reduce(A,C),R}function s(S,A){if(S.node(A).dummy)return n.find(S.predecessors(A),function(R){return S.node(R).dummy})}function o(S,A,R){if(A>R){var E=A;A=R,R=E}var C=S[A];C||(S[A]=C={}),C[R]=!0}function l(S,A,R){if(A>R){var E=A;A=R,R=E}return n.has(S[A],R)}function u(S,A,R,E){var C={},O={},D={};return n.forEach(A,function(M){n.forEach(M,function(P,k){C[P]=P,O[P]=P,D[P]=k})}),n.forEach(A,function(M){var P=-1;n.forEach(M,function(k){var V=E(k);if(V.length){V=n.sortBy(V,function(z){return D[z]});for(var X=(V.length-1)/2,Z=Math.floor(X),$=Math.ceil(X);Z<=$;++Z){var H=V[Z];O[k]===k&&P<D[H]&&!l(R,k,H)&&(O[H]=k,O[k]=C[k]=C[H],P=D[H])}}})}),{root:C,align:O}}function d(S,A,R,E,C){var O={},D=h(S,A,R,C),M=C?"borderLeft":"borderRight";function P(X,Z){for(var $=D.nodes(),H=$.pop(),z={};H;)z[H]?X(H):(z[H]=!0,$.push(H),$=$.concat(Z(H))),H=$.pop()}function k(X){O[X]=D.inEdges(X).reduce(function(Z,$){return Math.max(Z,O[$.v]+D.edge($))},0)}function V(X){var Z=D.outEdges(X).reduce(function(H,z){return Math.min(H,O[z.w]-D.edge(z))},Number.POSITIVE_INFINITY),$=S.node(X);Z!==Number.POSITIVE_INFINITY&&$.borderType!==M&&(O[X]=Math.max(O[X],Z))}return P(k,D.predecessors.bind(D)),P(V,D.successors.bind(D)),n.forEach(E,function(X){O[X]=O[R[X]]}),O}function h(S,A,R,E){var C=new e,O=S.graph(),D=w(O.nodesep,O.edgesep,E);return n.forEach(A,function(M){var P;n.forEach(M,function(k){var V=R[k];if(C.setNode(V),P){var X=R[P],Z=C.edge(X,V);C.setEdge(X,V,Math.max(D(S,k,P),Z||0))}P=k})}),C}function g(S,A){return n.minBy(n.values(A),function(R){var E=Number.NEGATIVE_INFINITY,C=Number.POSITIVE_INFINITY;return n.forIn(R,function(O,D){var M=x(S,D)/2;E=Math.max(O+M,E),C=Math.min(O-M,C)}),E-C})}function _(S,A){var R=n.values(A),E=n.min(R),C=n.max(R);n.forEach(["u","d"],function(O){n.forEach(["l","r"],function(D){var M=O+D,P=S[M],k;if(P!==A){var V=n.values(P);k=D==="l"?E-n.min(V):C-n.max(V),k&&(S[M]=n.mapValues(P,function(X){return X+k}))}})})}function y(S,A){return n.mapValues(S.ul,function(R,E){if(A)return S[A.toLowerCase()][E];var C=n.sortBy(n.map(S,E));return(C[1]+C[2])/2})}function T(S){var A=t.buildLayerMatrix(S),R=n.merge(r(S,A),i(S,A)),E={},C;n.forEach(["u","d"],function(D){C=D==="u"?A:n.values(A).reverse(),n.forEach(["l","r"],function(M){M==="r"&&(C=n.map(C,function(X){return n.values(X).reverse()}));var P=(D==="u"?S.predecessors:S.successors).bind(S),k=u(S,C,R,P),V=d(S,C,k.root,k.align,M==="r");M==="r"&&(V=n.mapValues(V,function(X){return-X})),E[D+M]=V})});var O=g(S,E);return _(E,O),y(E,S.graph().align)}function w(S,A,R){return function(E,C,O){var D=E.node(C),M=E.node(O),P=0,k;if(P+=D.width/2,n.has(D,"labelpos"))switch(D.labelpos.toLowerCase()){case"l":k=-D.width/2;break;case"r":k=D.width/2;break}if(k&&(P+=R?k:-k),k=0,P+=(D.dummy?A:S)/2,P+=(M.dummy?A:S)/2,P+=M.width/2,n.has(M,"labelpos"))switch(M.labelpos.toLowerCase()){case"l":k=M.width/2;break;case"r":k=-M.width/2;break}return k&&(P+=R?k:-k),k=0,P}}function x(S,A){return S.node(A).width}return Fb}var zb,qN;function aV(){if(qN)return zb;qN=1;var n=wt(),e=Dn(),t=sV().positionX;zb=r;function r(s){s=e.asNonCompoundGraph(s),i(s),n.forEach(t(s),function(o,l){s.node(l).x=o})}function i(s){var o=e.buildLayerMatrix(s),l=s.graph().ranksep,u=0;n.forEach(o,function(d){var h=n.max(n.map(d,function(g){return s.node(g).height}));n.forEach(d,function(g){s.node(g).y=u+h/2}),u+=h+l})}return zb}var Vb,$N;function oV(){if($N)return Vb;$N=1;var n=wt(),e=V9(),t=q9(),r=H9(),i=Dn().normalizeRanks,s=W9(),o=Dn().removeEmptyRanks,l=X9(),u=Y9(),d=G9(),h=iV(),g=aV(),_=Dn(),y=Rr().Graph;Vb=T;function T(B,Y){var Q=Y&&Y.debugTiming?_.time:_.notime;Q("layout",function(){var pe=Q("  buildLayoutGraph",function(){return P(B)});Q("  runLayout",function(){w(pe,Q)}),Q("  updateInputGraph",function(){x(B,pe)})})}function w(B,Y){Y("    makeSpaceForEdgeLabels",function(){k(B)}),Y("    removeSelfEdges",function(){K(B)}),Y("    acyclic",function(){e.run(B)}),Y("    nestingGraph.run",function(){l.run(B)}),Y("    rank",function(){r(_.asNonCompoundGraph(B))}),Y("    injectEdgeLabelProxies",function(){V(B)}),Y("    removeEmptyRanks",function(){o(B)}),Y("    nestingGraph.cleanup",function(){l.cleanup(B)}),Y("    normalizeRanks",function(){i(B)}),Y("    assignRankMinMax",function(){X(B)}),Y("    removeEdgeLabelProxies",function(){Z(B)}),Y("    normalize.run",function(){t.run(B)}),Y("    parentDummyChains",function(){s(B)}),Y("    addBorderSegments",function(){u(B)}),Y("    order",function(){h(B)}),Y("    insertSelfEdges",function(){I(B)}),Y("    adjustCoordinateSystem",function(){d.adjust(B)}),Y("    position",function(){g(B)}),Y("    positionSelfEdges",function(){q(B)}),Y("    removeBorderNodes",function(){fe(B)}),Y("    normalize.undo",function(){t.undo(B)}),Y("    fixupEdgeLabelCoords",function(){z(B)}),Y("    undoCoordinateSystem",function(){d.undo(B)}),Y("    translateGraph",function(){$(B)}),Y("    assignNodeIntersects",function(){H(B)}),Y("    reversePoints",function(){te(B)}),Y("    acyclic.undo",function(){e.undo(B)})}function x(B,Y){n.forEach(B.nodes(),function(Q){var pe=B.node(Q),ye=Y.node(Q);pe&&(pe.x=ye.x,pe.y=ye.y,Y.children(Q).length&&(pe.width=ye.width,pe.height=ye.height))}),n.forEach(B.edges(),function(Q){var pe=B.edge(Q),ye=Y.edge(Q);pe.points=ye.points,n.has(ye,"x")&&(pe.x=ye.x,pe.y=ye.y)}),B.graph().width=Y.graph().width,B.graph().height=Y.graph().height}var S=["nodesep","edgesep","ranksep","marginx","marginy"],A={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},R=["acyclicer","ranker","rankdir","align"],E=["width","height"],C={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],D={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},M=["labelpos"];function P(B){var Y=new y({multigraph:!0,compound:!0}),Q=se(B.graph());return Y.setGraph(n.merge({},A,ee(Q,S),n.pick(Q,R))),n.forEach(B.nodes(),function(pe){var ye=se(B.node(pe));Y.setNode(pe,n.defaults(ee(ye,E),C)),Y.setParent(pe,B.parent(pe))}),n.forEach(B.edges(),function(pe){var ye=se(B.edge(pe));Y.setEdge(pe,n.merge({},D,ee(ye,O),n.pick(ye,M)))}),Y}function k(B){var Y=B.graph();Y.ranksep/=2,n.forEach(B.edges(),function(Q){var pe=B.edge(Q);pe.minlen*=2,pe.labelpos.toLowerCase()!=="c"&&(Y.rankdir==="TB"||Y.rankdir==="BT"?pe.width+=pe.labeloffset:pe.height+=pe.labeloffset)})}function V(B){n.forEach(B.edges(),function(Y){var Q=B.edge(Y);if(Q.width&&Q.height){var pe=B.node(Y.v),ye=B.node(Y.w),Ee={rank:(ye.rank-pe.rank)/2+pe.rank,e:Y};_.addDummyNode(B,"edge-proxy",Ee,"_ep")}})}function X(B){var Y=0;n.forEach(B.nodes(),function(Q){var pe=B.node(Q);pe.borderTop&&(pe.minRank=B.node(pe.borderTop).rank,pe.maxRank=B.node(pe.borderBottom).rank,Y=n.max(Y,pe.maxRank))}),B.graph().maxRank=Y}function Z(B){n.forEach(B.nodes(),function(Y){var Q=B.node(Y);Q.dummy==="edge-proxy"&&(B.edge(Q.e).labelRank=Q.rank,B.removeNode(Y))})}function $(B){var Y=Number.POSITIVE_INFINITY,Q=0,pe=Number.POSITIVE_INFINITY,ye=0,Ee=B.graph(),Oe=Ee.marginx||0,ze=Ee.marginy||0;function It(mt){var ct=mt.x,De=mt.y,cn=mt.width,Ne=mt.height;Y=Math.min(Y,ct-cn/2),Q=Math.max(Q,ct+cn/2),pe=Math.min(pe,De-Ne/2),ye=Math.max(ye,De+Ne/2)}n.forEach(B.nodes(),function(mt){It(B.node(mt))}),n.forEach(B.edges(),function(mt){var ct=B.edge(mt);n.has(ct,"x")&&It(ct)}),Y-=Oe,pe-=ze,n.forEach(B.nodes(),function(mt){var ct=B.node(mt);ct.x-=Y,ct.y-=pe}),n.forEach(B.edges(),function(mt){var ct=B.edge(mt);n.forEach(ct.points,function(De){De.x-=Y,De.y-=pe}),n.has(ct,"x")&&(ct.x-=Y),n.has(ct,"y")&&(ct.y-=pe)}),Ee.width=Q-Y+Oe,Ee.height=ye-pe+ze}function H(B){n.forEach(B.edges(),function(Y){var Q=B.edge(Y),pe=B.node(Y.v),ye=B.node(Y.w),Ee,Oe;Q.points?(Ee=Q.points[0],Oe=Q.points[Q.points.length-1]):(Q.points=[],Ee=ye,Oe=pe),Q.points.unshift(_.intersectRect(pe,Ee)),Q.points.push(_.intersectRect(ye,Oe))})}function z(B){n.forEach(B.edges(),function(Y){var Q=B.edge(Y);if(n.has(Q,"x"))switch((Q.labelpos==="l"||Q.labelpos==="r")&&(Q.width-=Q.labeloffset),Q.labelpos){case"l":Q.x-=Q.width/2+Q.labeloffset;break;case"r":Q.x+=Q.width/2+Q.labeloffset;break}})}function te(B){n.forEach(B.edges(),function(Y){var Q=B.edge(Y);Q.reversed&&Q.points.reverse()})}function fe(B){n.forEach(B.nodes(),function(Y){if(B.children(Y).length){var Q=B.node(Y),pe=B.node(Q.borderTop),ye=B.node(Q.borderBottom),Ee=B.node(n.last(Q.borderLeft)),Oe=B.node(n.last(Q.borderRight));Q.width=Math.abs(Oe.x-Ee.x),Q.height=Math.abs(ye.y-pe.y),Q.x=Ee.x+Q.width/2,Q.y=pe.y+Q.height/2}}),n.forEach(B.nodes(),function(Y){B.node(Y).dummy==="border"&&B.removeNode(Y)})}function K(B){n.forEach(B.edges(),function(Y){if(Y.v===Y.w){var Q=B.node(Y.v);Q.selfEdges||(Q.selfEdges=[]),Q.selfEdges.push({e:Y,label:B.edge(Y)}),B.removeEdge(Y)}})}function I(B){var Y=_.buildLayerMatrix(B);n.forEach(Y,function(Q){var pe=0;n.forEach(Q,function(ye,Ee){var Oe=B.node(ye);Oe.order=Ee+pe,n.forEach(Oe.selfEdges,function(ze){_.addDummyNode(B,"selfedge",{width:ze.label.width,height:ze.label.height,rank:Oe.rank,order:Ee+ ++pe,e:ze.e,label:ze.label},"_se")}),delete Oe.selfEdges})})}function q(B){n.forEach(B.nodes(),function(Y){var Q=B.node(Y);if(Q.dummy==="selfedge"){var pe=B.node(Q.e.v),ye=pe.x+pe.width/2,Ee=pe.y,Oe=Q.x-ye,ze=pe.height/2;B.setEdge(Q.e,Q.label),B.removeNode(Y),Q.label.points=[{x:ye+2*Oe/3,y:Ee-ze},{x:ye+5*Oe/6,y:Ee-ze},{x:ye+Oe,y:Ee},{x:ye+5*Oe/6,y:Ee+ze},{x:ye+2*Oe/3,y:Ee+ze}],Q.label.x=Q.x,Q.label.y=Q.y}})}function ee(B,Y){return n.mapValues(n.pick(B,Y),Number)}function se(B){var Y={};return n.forEach(B,function(Q,pe){Y[pe.toLowerCase()]=Q}),Y}return Vb}var qb,HN;function lV(){if(HN)return qb;HN=1;var n=wt(),e=Dn(),t=Rr().Graph;qb={debugOrdering:r};function r(i){var s=e.buildLayerMatrix(i),o=new t({compound:!0,multigraph:!0}).setGraph({});return n.forEach(i.nodes(),function(l){o.setNode(l,{label:l}),o.setParent(l,"layer"+i.node(l).rank)}),n.forEach(i.edges(),function(l){o.setEdge(l.v,l.w,{},l.name)}),n.forEach(s,function(l,u){var d="layer"+u;o.setNode(d,{rank:"same"}),n.reduce(l,function(h,g){return o.setEdge(h,g,{style:"invis"}),g})}),o}return qb}var $b,WN;function cV(){return WN||(WN=1,$b="0.8.5"),$b}var Hb,XN;function uV(){return XN||(XN=1,Hb={graphlib:Rr(),layout:oV(),debug:lV(),util:{time:Dn().time,notime:Dn().notime},version:cV()}),Hb}var YN=uV();const fV={sample:8,root:6,other:5};function q0(n,e,t,r){return n.is_sample||Ll(n,t,r)?n.is_sample?e.sample:e.root:e.other}const Be={ROOT_NODE_STROKE_WIDTH:2,SAMPLE_NODE_STROKE_WIDTH:1,EDGE_STROKE_WIDTH:1,COLLISION_RADIUS:15,TOOLTIP_FONT_SIZE:"12px",PADDING_RATIO:.1,MAX_SIBLING_DISTANCE:50,FORCE_STRENGTH:{LINK_SIBLING:.9,LINK_SAMPLE:.8,LINK_DEFAULT:.3,CHARGE:-20,X_POSITION:.15,Y_POSITION:1,ALPHA_START:.8,ALPHA_DECAY:.05,VELOCITY_DECAY:.7},ZOOM:{MIN_SCALE:.1,MAX_SCALE:4,FOCUS_SCALE:1.5,GRAPH_FIT_SCALE_MIN:.2,GRAPH_FIT_SCALE_MAX:1.5,TRANSITION_DURATION:750,ALPHA_TARGET:.3},LAYOUT:{BOTTOM_MARGIN_RATIO:.15},PERFORMANCE:{ALPHA_THRESHOLD:.1}};function ao(n,e){const t=typeof n.source=="number"?e.find(i=>i.id===n.source)||null:n.source,r=typeof n.target=="number"?e.find(i=>i.id===n.target)||null:n.target;return{source:t,target:r}}function vO(n,e,t){const r=new Set,i=new Set,s=[n];for(;s.length>0;){const o=s.shift();if(i.has(o.id))continue;i.add(o.id),t.filter(u=>{const{source:d,target:h}=ao(u,e);return(d==null?void 0:d.id)===o.id&&h&&h.timeIndex>o.timeIndex}).forEach(u=>{const{target:d}=ao(u,e);d&&(d.is_sample?r.add(d):i.has(d.id)||s.push(d))})}return Array.from(r)}function mf(n,e,t){const r=vO(n,e,t);if(r.length===0)return null;const i=r.map(s=>s.x);return{min:Math.min(...i),max:Math.max(...i)}}function dV(n,e,t){const r=mf(n,e,t);r&&n.x!==void 0&&(n.x=Math.max(r.min,Math.min(r.max,n.x)))}function If(n,e,t){const r=t.find(s=>{const{source:o,target:l}=ao(s,e);return(l==null?void 0:l.id)===n.id&&o&&o.timeIndex<n.timeIndex});if(!r)return null;const{source:i}=ao(r,e);return i}function GN(n,e,t){const r=If(n,e,t);return r?e.filter(i=>{if(i.id===n.id||i.timeIndex<=r.timeIndex)return!1;const s=If(i,e,t);return(s==null?void 0:s.id)===r.id}):[]}function Wb(n,e,t,r,i,s,o=5){const l=Math.sqrt((n-t)**2+(e-r)**2),u=Math.sqrt((n-i)**2+(e-s)**2),d=Math.sqrt((i-t)**2+(s-r)**2);return Math.abs(l+u-d)<=o}function hV(n,e,t,r,i,s,o){const l=new Set(e.filter(g=>{const _=typeof g.source=="number"?g.source:g.source.id,y=typeof g.target=="number"?g.target:g.target.id;return _===n.id||y===n.id}).map(g=>`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`)),u=e.filter(g=>{const _=`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`;if(l.has(_))return!1;const y=typeof g.source=="number"?t.find(w=>w.id===g.source):g.source,T=typeof g.target=="number"?t.find(w=>w.id===g.target):g.target;return!y||!T?!1:Wb(n.x,n.y,y.x,y.y,T.x,T.y,r*2)});if(u.length===0)return{x:n.x,y:n.y};const d=30,h=5;for(let g=h;g<=d;g+=h){const _=Math.min(n.x+g,s);let y=!1;for(const x of u){const S=typeof x.source=="number"?t.find(R=>R.id===x.source):x.source,A=typeof x.target=="number"?t.find(R=>R.id===x.target):x.target;if(Wb(_,n.y,S.x,S.y,A.x,A.y,r*2)){y=!0;break}}if(!y)return{x:_,y:n.y};const T=Math.max(n.x-g,i);let w=!1;for(const x of u){const S=typeof x.source=="number"?t.find(R=>R.id===x.source):x.source,A=typeof x.target=="number"?t.find(R=>R.id===x.target):x.target;if(Wb(T,n.y,S.x,S.y,A.x,A.y,r*2)){w=!0;break}}if(!w)return{x:T,y:n.y}}return{x:n.x,y:n.y}}function pV(n,e){return e.filter(t=>{const r=typeof t.source=="number"?t.source:t.source.id,i=typeof t.target=="number"?t.target:t.target.id;return r===n.id||i===n.id})}function gV(n,e,t){const r=KN(n,t),i=KN(e,t);if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}function KN(n,e){const t=new Set;return pV(n,e).forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id;i!==n.id&&t.add(i),s!==n.id&&t.add(s)}),t}function mV(n,e){const t=new Set,r=[],i=new Map;for(let o=0;o<n.length;o++){if(t.has(n[o].id))continue;const l=n[o];if(l.is_sample){r.push(l),i.set(l.id,l.id),t.add(l.id);continue}const u=_V(l,n,e,t,o),d=vV(l,u);r.push(d),u.forEach(h=>{i.set(h.id,d.id),t.add(h.id)})}const s=yV(e,i);return{nodes:r,edges:s}}function _V(n,e,t,r,i){const s=[n];for(let o=i+1;o<e.length;o++){const l=e[o];r.has(l.id)||l.is_sample||n.time===l.time&&gV(n,l,t)&&s.push(l)}return s}function vV(n,e){return e.length===1?n:{...n,is_combined:!0,combined_nodes:e.map(t=>t.id)}}function yV(n,e){const t=[];return n.forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id,o=e.get(i),l=e.get(s);o!==void 0&&l!==void 0&&t.push({...r,source:o,target:l})}),t}function Ll(n,e,t){const r=t.some(s=>{const{target:o}=ao(s,e);return(o==null?void 0:o.id)===n.id}),i=t.some(s=>{const{source:o}=ao(s,e);return(o==null?void 0:o.id)===n.id});return!r&&i}function bV(n,e,t,r,i){return(s,o,l)=>{if(s)if(l.length===0){const u=o.find(y=>y.id===s.id);if(!u)return;const d=u.x??0,g=r*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO)-u.timeIndex*i,_=Id.translate(t/2,r/2).scale(Be.ZOOM.FOCUS_SCALE).translate(-d,-g);n.transition().duration(Be.ZOOM.TRANSITION_DURATION).call(e.transform,_)}else{const u=o.filter(g=>g.x!==void 0&&g.timeIndex!==void 0);if(u.length===0)return;const d=xV(u,r,i),h=wV(d,t,r);n.transition().duration(Be.ZOOM.TRANSITION_DURATION).call(e.transform,h)}}}function xV(n,e,t){const r=n.map(o=>o.x),i=e*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),s=n.map(o=>i-o.timeIndex*t);return{minX:Math.min(...r),maxX:Math.max(...r),minY:Math.min(...s),maxY:Math.max(...s)}}function wV(n,e,t){const r=(n.minX+n.maxX)/2,i=(n.minY+n.maxY)/2,s=n.maxX-n.minX,o=n.maxY-n.minY,l=50,u=(e-2*l)/(s||1),d=(t-2*l)/(o||1),h=Math.min(Math.max(Be.ZOOM.GRAPH_FIT_SCALE_MIN,Math.min(u,d)),Be.ZOOM.GRAPH_FIT_SCALE_MAX);return Id.translate(e/2,t/2).scale(h).translate(-r,-i)}function TV(n,e,t,r){const i=new Map;n.forEach(s=>{if(!s.is_sample){const o=Math.round(s.x*100)/100,l=i.get(o)||[];l.push(s),i.set(o,l)}}),i.forEach((s,o)=>{if(s.length>1){s.sort((l,u)=>l.y-u.y);for(let l=0;l<s.length;l++)for(let u=l+1;u<s.length;u++){const d=s[l],h=s[u];if(!e.some(_=>{const y=typeof _.source=="number"?_.source:_.source.id,T=typeof _.target=="number"?_.target:_.target.id;return y===d.id&&T===h.id||y===h.id&&T===d.id})){const T=((h.id*1e4+d.id)%1e3/1e3-.5)*15,w=Math.max(t,Math.min(r,h.x+T));h.x=w,h.fx=w}}}})}function ar(n,e,t,r){if(e.length<=1)return t/2;const i=e[0],s=e[e.length-1],o=s-i;let l;switch(r){case"log":const u=i===0?.1:i;l=(Math.log(n===0?.1:n)-Math.log(u))/(Math.log(s)-Math.log(u));break;case"linear":l=(n-i)/o;break;case"equal":default:l=e.indexOf(n)/(e.length-1);break}return t-l*t}function SV(n,e,t,r,i,s,o="equal"){const l=Array.from(new Set(n.map(y=>y.time))).sort((y,T)=>y-T),u=new Map(l.map((y,T)=>[y,T])),d=r*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h=d/(l.length-1||1),g=t*Be.PADDING_RATIO,_=t-2*g;if(n.forEach(y=>{y.timeIndex=u.get(y.time)??0}),i==="dagre"){console.log("Setting up dagre layout...");const y=new YN.graphlib.Graph;y.setGraph({rankdir:"TB",nodesep:50,ranksep:75,marginx:g,marginy:20,ranker:"network-simplex",acyclicer:"greedy",align:"UL"}),y.setDefaultEdgeLabel(()=>({})),n.forEach(P=>{y.setNode(P.id.toString(),{width:20,height:20,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:5})}),e.forEach(P=>{const k=typeof P.source=="number"?P.source:P.source.id,V=typeof P.target=="number"?P.target:P.target.id,X=n.find(H=>H.id===k),Z=n.find(H=>H.id===V);let $=1;X&&Z&&((X.is_sample||Z.is_sample)&&($=3),Math.abs(X.time-Z.time)===1&&($+=1)),y.setEdge(k.toString(),V.toString(),{weight:$})}),YN.layout(y);const T=n.filter(P=>P.is_sample);let w=1/0,x=-1/0;T.forEach(P=>{const k=y.node(P.id.toString());k&&(w=Math.min(w,k.x),x=Math.max(x,k.x))});const S=100,A=x-w,E=Math.min(A,S*(T.length-1))/A;n.forEach(P=>{const k=y.node(P.id.toString());if(k){const V=(k.x-w)*E+w;P.x=V,P.y=k.y,P.fx=P.x,P.fy=P.y}}),TV(n,e,w,x);const C=new Set;let O=!0;const D=3;let M=0;for(;O&&M<D;){O=!1,M++;const P=n.filter(k=>!C.has(k.id)).sort((k,V)=>{const X=e.filter($=>{const H=typeof $.source=="number"?$.source:$.source.id,z=typeof $.target=="number"?$.target:$.target.id;return H===k.id||z===k.id}).length;return e.filter($=>{const H=typeof $.source=="number"?$.source:$.source.id,z=typeof $.target=="number"?$.target:$.target.id;return H===V.id||z===V.id}).length-X});for(const k of P){if(k.is_sample){C.add(k.id);continue}const V=s?q0(k,s,n,e):5,X=hV(k,e,n,V,w,x);(X.x!==k.x||X.y!==k.y)&&(k.x=X.x,k.fx=X.x,k.y=X.y,k.fy=X.y,O=!0),C.add(k.id)}}console.log("Dagre layout complete. Node count:",n.length)}else{const y=n.filter(w=>w.is_sample),T=_/(y.length-1||1);y.sort((w,x)=>w.order_position!==void 0&&x.order_position!==void 0?w.order_position-x.order_position:w.order_position!==void 0?-1:x.order_position!==void 0?1:(x.degree??0)-(w.degree??0)),y.forEach((w,x)=>{w.x=g+x*T,w.fx=w.x,w.y=ar(w.time,l,d,o),w.fy=w.y}),n.filter(w=>!w.is_sample).forEach(w=>{w.fx=null,w.fy=null,w.y=ar(w.time,l,d,o)})}return{timeSpacing:h,uniqueTimes:l}}const EV=U.forwardRef(({data:n,width:e,height:t,onNodeClick:r,onNodeRightClick:i,onEdgeClick:s,focalNode:o,nodeSizes:l=fV,sampleOrder:u="degree",edgeThickness:d=Be.EDGE_STROKE_WIDTH,temporalSpacingMode:h="equal"},g)=>{const{colors:_}=$t(),y=U.useMemo(()=>n?`${n.nodes.length}-${n.edges.length}-${n.metadata.genomic_start||0}-${n.metadata.genomic_end||n.metadata.sequence_length}`:null,[n==null?void 0:n.nodes.length,n==null?void 0:n.edges.length,n==null?void 0:n.metadata.genomic_start,n==null?void 0:n.metadata.genomic_end,n==null?void 0:n.metadata.sequence_length]),T=U.useRef({data:null,key:null}),w=U.useMemo(()=>!n||!y?null:T.current.key===y&&T.current.data?T.current.data:(T.current={data:n,key:y},n),[n,y]);return U.useEffect(()=>{if(!g||typeof g=="function"||!g.current||!w)return;const x=g.current.getBoundingClientRect(),S=e||x.width||800,A=t||x.height||600,R=A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),{nodes:E,edges:C}=mV(w.nodes,w.edges);Array.from(new Set(E.map(K=>K.time))).sort((K,I)=>K-I),or(g.current).selectAll("*").remove();const O=or(g.current).attr("width",S).attr("height",A).attr("viewBox",[0,0,S,A]).attr("style","max-width: 100%; height: auto;"),D=O.append("g"),M=G5().scaleExtent([Be.ZOOM.MIN_SCALE,Be.ZOOM.MAX_SCALE]).on("zoom",K=>{D.attr("transform",K.transform)});O.call(M);const P=bV(O,M,S,A,0),{uniqueTimes:k}=SV(E,C,S,A,u,l,h);o&&P(o,E,C);const V=or("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color",_.tooltipBackground).style("color",_.tooltipText).style("border",`1px solid ${_.border}`).style("padding","8px").style("border-radius","4px").style("font-size",Be.TOOLTIP_FONT_SIZE).style("pointer-events","none"),X=U5(E).alpha(u==="dagre"?0:Be.FORCE_STRENGTH.ALPHA_START).alphaDecay(u==="dagre"?1:Be.FORCE_STRENGTH.ALPHA_DECAY).velocityDecay(u==="dagre"?1:Be.FORCE_STRENGTH.VELOCITY_DECAY).force("link",u==="dagre"?null:M5(C).id(K=>K.id).distance(50).strength(K=>{const I=typeof K.source=="number"?E.find(B=>B.id===K.source):K.source,q=typeof K.target=="number"?E.find(B=>B.id===K.target):K.target,ee=If(I,E,C),se=If(q,E,C);return ee&&se&&ee.id===se.id?Be.FORCE_STRENGTH.LINK_SIBLING:I!=null&&I.is_sample||q!=null&&q.is_sample?Be.FORCE_STRENGTH.LINK_SAMPLE:Be.FORCE_STRENGTH.LINK_DEFAULT})).force("charge",u==="dagre"?null:F5().strength(Be.FORCE_STRENGTH.CHARGE)).force("x",u==="dagre"?null:z5(K=>{if(K.is_sample)return K.x;const I=mf(K,E,C),q=GN(K,E,C);if(q.length>0){const ee=q.reduce((se,B)=>se+(B.x??0),0)/q.length;if(I){const se=(ee+(I.min+I.max)/2)/2;return Math.max(I.min,Math.min(I.max,se))}return ee}return I?(I.min+I.max)/2:K.x??S/2}).strength(Be.FORCE_STRENGTH.X_POSITION)).force("y",V5(K=>ar(K.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)).strength(u==="dagre"?1:Be.FORCE_STRENGTH.Y_POSITION)).force("collision",u==="dagre"?null:N5().radius(Be.COLLISION_RADIUS)),Z=D.append("g").selectAll("line").data(C).join("line").attr("stroke",`rgb(${_.edgeDefault[0]}, ${_.edgeDefault[1]}, ${_.edgeDefault[2]})`).attr("stroke-opacity",_.edgeDefault[3]/255).attr("stroke-width",d).attr("x1",K=>{const I=typeof K.source=="number"?E.find(q=>q.id===K.source):K.source;return(I==null?void 0:I.x)??0}).attr("y1",K=>{const I=typeof K.source=="number"?E.find(q=>q.id===K.source):K.source;return ar(I.time,k,R,h)}).attr("x2",K=>{const I=typeof K.target=="number"?E.find(q=>q.id===K.target):K.target;return(I==null?void 0:I.x)??0}).attr("y2",K=>{const I=typeof K.target=="number"?E.find(q=>q.id===K.target):K.target;return ar(I.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).on("click",(K,I)=>s==null?void 0:s(I));function $(K){K.active||X.alphaTarget(Be.ZOOM.ALPHA_TARGET).restart(),K.subject.fx=K.subject.x,K.subject.fy=ar(K.subject.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function H(K){if(!w)return;const I=mf(K.subject,E,C),q=GN(K.subject,E,C);let ee=K.x;if(I)ee=Math.max(I.min,Math.min(I.max,ee));else{const se=S*Be.PADDING_RATIO;ee=Math.max(se,Math.min(S-se,ee))}if(q.length>0){const se=q.reduce((B,Y)=>B+(Y.x??0),0)/q.length;ee=Math.max(se-Be.MAX_SIBLING_DISTANCE,Math.min(se+Be.MAX_SIBLING_DISTANCE,ee))}K.subject.fx=ee,K.subject.fy=ar(K.subject.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function z(K){K.active||X.alphaTarget(0),K.subject.fx=null;const I=mf(K.subject,E,C);let q=K.subject.x??0;if(I)q=Math.max(I.min,Math.min(I.max,q));else{const ee=S*Be.PADDING_RATIO;q=Math.max(ee,Math.min(S-ee,q))}K.subject.x=q,K.subject.fy=ar(K.subject.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}const te=D.append("g").selectAll("circle").data(E).join("circle").attr("r",K=>q0(K,l,E,C)).attr("fill",K=>K.is_sample?`rgb(${_.nodeSample[0]}, ${_.nodeSample[1]}, ${_.nodeSample[2]})`:K.is_combined?`rgb(${_.nodeCombined[0]}, ${_.nodeCombined[1]}, ${_.nodeCombined[2]})`:Ll(K,E,C)?`rgb(${_.nodeRoot[0]}, ${_.nodeRoot[1]}, ${_.nodeRoot[2]})`:`rgb(${_.nodeDefault[0]}, ${_.nodeDefault[1]}, ${_.nodeDefault[2]})`).attr("stroke",K=>Ll(K,E,C)?`rgb(${_.nodeSelected[0]}, ${_.nodeSelected[1]}, ${_.nodeSelected[2]})`:K.is_sample?_.background:"none").attr("stroke-width",K=>Ll(K,E,C)?Be.ROOT_NODE_STROKE_WIDTH:K.is_sample?Be.SAMPLE_NODE_STROKE_WIDTH:0).style("cursor","pointer").call(R8().on("start",$).on("drag",H).on("end",z)).on("click",(K,I)=>{K.preventDefault(),r==null||r(I)}).on("contextmenu",(K,I)=>{K.preventDefault(),i==null||i(I)}).on("mouseover",(K,I)=>{var ee;let q="";if(I.is_sample)q=`Sample node ${I.id}<br>Time: ${I.time}`;else if(I.is_combined)q=`Combined node ${I.id}<br>Contains nodes: ${(ee=I.combined_nodes)==null?void 0:ee.join(", ")}<br>Time: ${I.time}`;else if(Ll(I,E,C)){const se=[...new Set(C.filter(Y=>{const Q=typeof Y.source=="number"?E.find(pe=>pe.id===Y.source):Y.source;return(Q==null?void 0:Q.id)===I.id}).map(Y=>{const Q=typeof Y.target=="number"?E.find(pe=>pe.id===Y.target):Y.target;return Q==null?void 0:Q.id}).filter(Y=>Y!==void 0))].sort((Y,Q)=>Y-Q),B=vO(I,E,C).map(Y=>Y.id).sort((Y,Q)=>Y-Q);q=`Root node ${I.id}<br>Time: ${I.time}`,se.length>0&&(q+=`<br>Children: ${se.join(", ")}`),B.length>0&&(q+=`<br>Descendant samples: ${B.join(", ")}`)}else{const se=[...new Set(C.filter(Y=>{const Q=typeof Y.target=="number"?E.find(pe=>pe.id===Y.target):Y.target;return(Q==null?void 0:Q.id)===I.id}).map(Y=>{const Q=typeof Y.source=="number"?E.find(pe=>pe.id===Y.source):Y.source;return Q==null?void 0:Q.id}).filter(Y=>Y!==void 0))].sort((Y,Q)=>Y-Q),B=[...new Set(C.filter(Y=>{const Q=typeof Y.source=="number"?E.find(pe=>pe.id===Y.source):Y.source;return(Q==null?void 0:Q.id)===I.id}).map(Y=>{const Q=typeof Y.target=="number"?E.find(pe=>pe.id===Y.target):Y.target;return Q==null?void 0:Q.id}).filter(Y=>Y!==void 0))].sort((Y,Q)=>Y-Q);q=`Internal node ${I.id}<br>Time: ${I.time}`,se.length>0&&(q+=`<br>Parents: ${se.join(", ")}`),B.length>0&&(q+=`<br>Children: ${B.join(", ")}`)}if(I.individual!==void 0&&I.individual!==-1&&(q+=`<br>Individual: ${I.individual}`),I.location){const se=I.location,B=se.x>=-180&&se.x<=180&&se.y>=-90&&se.y<=90&&(se.x!==0||se.y!==0);se.z!==void 0?B?q+=`<br>Location: Lat: ${se.y.toFixed(3)}°, Lon: ${se.x.toFixed(3)}°, Z: ${se.z.toFixed(2)}`:q+=`<br>Location: (${se.x.toFixed(2)}, ${se.y.toFixed(2)}, ${se.z.toFixed(2)})`:B?q+=`<br>Location: Lat: ${se.y.toFixed(3)}°, Lon: ${se.x.toFixed(3)}°`:q+=`<br>Location: (${se.x.toFixed(2)}, ${se.y.toFixed(2)})`}V.style("visibility","visible").html(q).style("left",K.pageX+10+"px").style("top",K.pageY-10+"px")}).on("mousemove",K=>{V.style("left",K.pageX+10+"px").style("top",K.pageY-10+"px")}).on("mouseout",()=>{V.style("visibility","hidden")}),fe=D.append("g").selectAll("text").data(E.filter(K=>K.is_sample)).join("text").text(K=>K.id.toString()).attr("font-size",K=>`${l.sample*1.2}px`).attr("fill",_.text).attr("text-anchor","middle").attr("dx",0).attr("dy",K=>q0(K,l,E,C)+12);return X.on("tick",()=>{w&&(X.alpha()>Be.PERFORMANCE.ALPHA_THRESHOLD&&E.forEach(K=>{K.is_sample||dV(K,E,C)}),Z.attr("x1",K=>{const I=typeof K.source=="number"?E.find(q=>q.id===K.source):K.source;return(I==null?void 0:I.x)??0}).attr("y1",K=>{const I=typeof K.source=="number"?E.find(q=>q.id===K.source):K.source;return ar(I.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).attr("x2",K=>{const I=typeof K.target=="number"?E.find(q=>q.id===K.target):K.target;return(I==null?void 0:I.x)??0}).attr("y2",K=>{const I=typeof K.target=="number"?E.find(q=>q.id===K.target):K.target;return ar(I.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}),te.attr("cx",K=>K.x??0).attr("cy",K=>ar(K.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)),fe.attr("x",K=>K.x??0).attr("y",K=>ar(K.time,k,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)))}),()=>{X&&X.stop(),V&&V.remove()}},[w,e,t,r,i,s,o,l,g,u,d,h]),m.jsx("div",{className:"w-full h-full",children:m.jsx("svg",{ref:g,className:"w-full h-full"})})}),AV=({originalNodeCount:n,originalEdgeCount:e,subargNodeCount:t,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,genomicRange:o,sequenceLength:l,isFiltered:u=!1,isFilterSectionCollapsed:d=!0})=>{const{colors:h}=$t(),[g,_]=U.useState(!0),y=n&&t?(t/n*100).toFixed(1):null,T=e&&r?(r/e*100).toFixed(1):null;if(!(n||t||i))return null;const x=S=>S>=1e6?`${(S/1e6).toFixed(1)}M`:S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toString();return m.jsxs("div",{className:"absolute top-4 right-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${h.background}F0`,borderColor:h.border,color:h.text},children:[m.jsxs("div",{onClick:()=>_(!g),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:g?"transparent":`${h.containerBackground}80`},onMouseEnter:S=>{g||(S.currentTarget.style.backgroundColor=`${h.border}40`)},onMouseLeave:S=>{g||(S.currentTarget.style.backgroundColor=`${h.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:h.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-180":""}`,style:{color:h.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[n&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:h.text},children:[n.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),t&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:h.text},children:[t.toLocaleString()," nodes (",y,"%), ",r.toLocaleString()," edges (",T,"%)"]})]}),i&&s&&(i!==t||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:h.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&n&&i!==n&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:h.text},children:[((1-i/n)*100).toFixed(1),"% fewer nodes"]})]})]})]}),u&&o&&l&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Filter Information"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Range:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[0])," - ",x(o[1])]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Length:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[1]-o[0])," bp"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Coverage:"}),m.jsxs("span",{style:{color:h.text},children:[((o[1]-o[0])/l*100).toFixed(1),"% of sequence"]})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${h.text}CC`},children:[m.jsx("div",{children:"• Drag: Pan view"}),m.jsx("div",{children:"• Scroll: Zoom in/out"}),m.jsx("div",{children:"• Left click: Select node"}),m.jsx("div",{children:"• Right click: Show ancestors"}),m.jsx("div",{children:"• Drag nodes to reposition"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]})`,borderColor:h.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:h.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeCombined[0]}, ${h.nodeCombined[1]}, ${h.nodeCombined[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]})`,borderColor:`rgb(${h.nodeSelected[0]}, ${h.nodeSelected[1]}, ${h.nodeSelected[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Root Nodes"})]})]})]})]})]})},RV=[{value:"degree",label:"Degree",description:"Order by node connectivity (current default)"},{value:"center_minlex",label:"Center Tree",description:"Minlex postorder of tree at center genomic position"},{value:"first_tree",label:"First Tree",description:"Minlex postorder of first tree"},{value:"custom",label:"Consensus",description:"Majority vote across multiple trees"},{value:"numeric",label:"Numeric",description:"Simple numeric order (0, 1, 2, ...)"},{value:"dagre",label:"Layer-based",description:"Order nodes in each layer using dagre-d3 algorithm"}],CV=({value:n,onChange:e,className:t=""})=>{const{colors:r}=$t();return m.jsxs("div",{className:`flex items-center gap-2 ${t}`,children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Sample Order:"}),m.jsx("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:RV.map(i=>m.jsx("button",{onClick:()=>e(i.value),className:"px-3 py-1 text-xs font-medium transition-colors whitespace-nowrap",style:{backgroundColor:n===i.value?r.textSecondary:r.containerBackground,color:n===i.value?r.background:r.text},title:i.description,children:i.label},i.value))})]})},NV=({sampleOrder:n,onSampleOrderChange:e,nodeSizes:t,onNodeSizeChange:r,edgeThickness:i,onEdgeThicknessChange:s,temporalSpacing:o,onTemporalSpacingChange:l,temporalSpacingMode:u,onTemporalSpacingModeChange:d,isLoading:h=!1})=>{const{colors:g}=$t(),[_,y]=U.useState(!0);return m.jsxs("div",{className:"absolute top-4 left-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${g.background}F0`,borderColor:g.border,color:g.text},children:[m.jsxs("div",{onClick:()=>y(!_),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:_?"transparent":`${g.containerBackground}80`},onMouseEnter:T=>{_||(T.currentTarget.style.backgroundColor=`${g.border}40`)},onMouseLeave:T=>{_||(T.currentTarget.style.backgroundColor=`${g.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:g.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),"Graph Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${_?"rotate-180":""}`,style:{color:g.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Temporal Spacing"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:()=>d("equal"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="equal"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="equal"?g.accentPrimary:`${g.border}40`,color:u==="equal"?g.background:g.text},children:"Equal"}),m.jsx("button",{onClick:()=>d("log"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="log"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="log"?g.accentPrimary:`${g.border}40`,color:u==="log"?g.background:g.text},children:"Log"}),m.jsx("button",{onClick:()=>d("linear"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="linear"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="linear"?g.accentPrimary:`${g.border}40`,color:u==="linear"?g.background:g.text},children:"Linear"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("label",{className:"text-xs font-medium",style:{color:g.text},children:["Spacing: ",o]})}),m.jsx("input",{type:"range",min:5,max:50,step:1,value:o,onChange:T=>l(Number(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(o-5)/45*100}%, ${g.border} ${(o-5)/45*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"text-xs",style:{color:`${g.text}CC`},children:[u==="equal"&&m.jsx("div",{children:"• Time points are spaced equally"}),u==="log"&&m.jsx("div",{children:"• Time points are spaced logarithmically based on their actual values"}),u==="linear"&&m.jsx("div",{children:"• Time points are spaced according to their actual time values"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Sample Order"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(CV,{value:n,onChange:e}),h&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:g.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:g.text},children:"Updating sample order..."})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Node Sizes"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Sample Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[t.sample,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:t.sample,onChange:T=>r({...t,sample:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(t.sample-3)/12*100}%, ${g.border} ${(t.sample-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Root Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[t.root,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:t.root,onChange:T=>r({...t,root:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(t.root-3)/12*100}%, ${g.border} ${(t.root-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Internal & Combined"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[t.other,"px"]})]}),m.jsx("input",{type:"range",min:"2",max:"10",step:"1",value:t.other,onChange:T=>r({...t,other:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(t.other-2)/8*100}%, ${g.border} ${(t.other-2)/8*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Edge Thickness"}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Edge Width"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[i,"px"]})]}),m.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:i,onChange:T=>s(parseFloat(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(i-.5)/2.5*100}%, ${g.border} ${(i-.5)/2.5*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Graph Layout"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${g.text}CC`},children:[m.jsx("div",{children:"• Sample nodes are positioned based on the selected order"}),m.jsx("div",{children:"• Internal nodes position themselves relative to descendants"}),m.jsx("div",{children:"• Drag nodes to manually adjust positions"}),m.jsx("div",{children:"• Use zoom and pan to navigate the graph"})]})]})]})]})},yO=({min:n,max:e,step:t=1,value:r,onChange:i,formatValue:s=l=>l.toString(),className:o=""})=>{const{colors:l}=$t(),[u,d]=U.useState(null),[h,g]=U.useState({x:0,startValue:[0,0]}),[_,y]=U.useState(!1),[T,w]=U.useState(null),x=U.useRef(null);U.useEffect(()=>{const M=k=>{if(k.key==="Shift"){if(y(!0),T===null){const V=Math.abs(r[1]-r[0]);w(Math.max(V,t))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},P=k=>{k.key==="Shift"&&(y(!1),w(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",M),document.addEventListener("keyup",P),()=>{document.removeEventListener("keydown",M),document.removeEventListener("keyup",P),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,T,t]);const S=U.useCallback(M=>{if(!x.current)return n;const P=x.current.getBoundingClientRect(),k=Math.max(0,Math.min(1,(M-P.left)/P.width)),V=n+k*(e-n);return Math.round(V/t)*t},[n,e,t]),A=U.useCallback(M=>(M-n)/(e-n)*100,[n,e]),R=U.useCallback((M,P)=>{M.preventDefault(),M.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",d(P),g({x:M.clientX,startValue:r})},[r]),E=U.useCallback(M=>{if(!u||!x.current)return;const P=S(M.clientX),[k,V]=r;if(u==="left"){const X=Math.min(P,V-t);i([Math.max(n,X),V])}else if(u==="right"){const X=Math.max(P,k+t);i([k,Math.min(e,X)])}else if(u==="range"){const X=M.clientX-h.x,Z=x.current.getBoundingClientRect(),$=X/Z.width*(e-n),[H,z]=h.startValue;let te=Math.abs(z-H);_&&T!==null&&(te=T);const K=(H+z)/2+$;let I,q;_&&T!==null?(I=K-te/2,q=K+te/2):(I=H+$,q=z+$),I<n&&(I=n,q=n+te),q>e&&(q=e,I=e-te),i([Math.round(I/t)*t,Math.round(q/t)*t])}},[u,r,i,S,n,e,t,h,_,T]),C=U.useCallback(()=>{d(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(u)return document.addEventListener("mousemove",E),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",C)}},[u,E,C]);const O=A(r[0]),D=A(r[1]);return m.jsxs("div",{className:`relative w-full ${o}`,style:{userSelect:"none"},children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:l.text},children:[m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(r[1])})]}),m.jsxs("div",{ref:x,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:l.containerBackground},onMouseDown:M=>{const P=S(M.clientX),[k,V]=r,X=Math.abs(P-k),Z=Math.abs(P-V);_||Math.abs(V-k)<t*2?R(M,"range"):X<Z?R(M,"left"):R(M,"right")},children:[m.jsx("div",{className:`absolute h-full rounded-full transition-opacity ${_?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{left:`${O}%`,width:`${D-O}%`,backgroundColor:_?l.text:l.textSecondary,opacity:_?.8:1,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"range")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${O}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"left")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${D}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"right")}})]}),m.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs",style:{color:l.text},children:[m.jsx("span",{children:s(n)}),m.jsx("div",{className:"flex items-center justify-center",children:_&&m.jsx("div",{className:"px-2 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:l.textSecondary,color:l.background,fontSize:"10px"},children:"Fixed Size"})}),m.jsx("span",{children:s(e)})]})]})},bO=({treeIntervals:n,value:e,onChange:t,className:r=""})=>{const{colors:i}=$t(),[s,o]=U.useState(null),[l,u]=U.useState({x:0,startValue:[0,0]}),d=U.useRef(null);if(!n||n.length===0)return null;const h=0,g=n.length-1,_=n[g].right-n[0].left,y=U.useCallback(D=>{if(!d.current)return h;const M=d.current.getBoundingClientRect(),P=Math.max(0,Math.min(1,(D-M.left)/M.width)),k=n[0].left+P*_;for(let V=0;V<n.length;V++){const X=n[V],Z=(X.left+X.right)/2;if(V===n.length-1||k<=Z)return V}return g},[n,_]),T=U.useCallback(D=>{if(D<0||D>=n.length)return 0;const M=n[D];return((M.left+M.right)/2-n[0].left)/_*100},[n,_]),w=U.useCallback(D=>{if(D<0||D>=n.length)return"Invalid";const M=n[D];return`Tree ${D} (${M.left.toFixed(1)}-${M.right.toFixed(1)})`},[n]),x=U.useCallback((D,M)=>{if(D<0||M>=n.length||D>M)return"Invalid range";const P=n[D].left,k=n[M].right,V=k-P;return`${(Z=>Z>=1e6?`${(Z/1e6).toFixed(1)}M`:Z>=1e3?`${(Z/1e3).toFixed(1)}K`:Z.toFixed(1))(V)} bp (${P.toFixed(1)}-${k.toFixed(1)})`},[n]),S=U.useCallback((D,M)=>{D.preventDefault(),o(M),u({x:D.clientX,startValue:e})},[e]),A=U.useCallback(D=>{if(!s||!d.current)return;const M=y(D.clientX),[P,k]=e;if(s==="left")M<=k?t([Math.max(h,Math.min(g,M)),k]):t([k,Math.max(h,Math.min(g,M))]);else if(s==="right")M>=P?t([P,Math.max(h,Math.min(g,M))]):t([Math.max(h,Math.min(g,M)),P]);else if(s==="range"){const V=D.clientX-l.x,X=d.current.getBoundingClientRect(),$=V/X.width*_,[H,z]=l.startValue,te=(n[H].left+n[H].right)/2,fe=(n[z].left+n[z].right)/2,K=te+$,I=fe+$;let q=H,ee=z;for(let B=0;B<n.length;B++){const Y=(n[B].left+n[B].right)/2;if(K<=Y||B===n.length-1){q=B;break}}for(let B=0;B<n.length;B++){const Y=(n[B].left+n[B].right)/2;if(I<=Y||B===n.length-1){ee=B;break}}q=Math.max(h,Math.min(g,q)),ee=Math.max(h,Math.min(g,ee));const se=z-H;q!==ee&&Math.abs(ee-q)!==se&&(q+se<=g?ee=q+se:ee-se>=h&&(q=ee-se)),t([q,ee])}},[s,e,t,y,h,g,l,_,n]),R=U.useCallback(()=>{o(null)},[]);U.useEffect(()=>{if(s)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R)}},[s,A,R]);const E=T(e[0]),C=T(e[1]),O=e[1]-e[0]+1;return m.jsxs("div",{className:`relative w-full ${r}`,children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:i.text},children:[m.jsx("span",{children:w(e[0])}),m.jsx("span",{children:w(e[1])})]}),m.jsxs("div",{ref:d,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:i.containerBackground},onMouseDown:D=>{const M=y(D.clientX),[P,k]=e,V=Math.abs(M-P),X=Math.abs(M-k);V<X?S(D,"left"):S(D,"right")},children:[m.jsx("div",{className:"absolute h-full rounded-full cursor-grab active:cursor-grabbing",style:{left:`${E}%`,width:`${C-E}%`,backgroundColor:i.textSecondary},onMouseDown:D=>S(D,"range")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${E}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:D=>S(D,"left")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${C}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:D=>S(D,"right")})]}),m.jsxs("div",{className:"flex justify-between mt-1 text-xs",style:{color:i.text},children:[m.jsx("span",{children:"Tree 0"}),m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{children:[O," tree",O!==1?"s":""," selected"]}),m.jsx("div",{style:{color:i.textSecondary},children:x(e[0],e[1])})]}),m.jsxs("span",{children:["Tree ",g]})]})]})},kV=(n,e,t)=>{const r=new Set,i=new Set,s=[n.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),t.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u===o&&!i.has(d)&&(r.add(d),s.push(d))}))}return r},MV=(n,e,t)=>{const r=new Set,i=new Set,s=[n.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),t.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id;(typeof l.target=="number"?l.target:l.target.id)===o&&!i.has(u)&&(r.add(u),s.push(u))}))}return r},IV=1,OV={nodeSizes:{sample:8,root:6,other:5},edgeThickness:1,temporalSpacingMode:"equal"},PV=U.forwardRef(({filename:n,max_samples:e=25},t)=>{var mr,Lt,Bt,Cn,_r,Kn;const{colors:r}=$t(),{treeSequence:i}=$s(),[s,o]=U.useState(null),[l,u]=U.useState(null),[d,h]=U.useState(null),[g,_]=U.useState(!0),[y,T]=U.useState("full"),[w,x]=U.useState(null),[S,A]=U.useState([0,0]),[R,E]=U.useState(0),[C,O]=U.useState(!1),[D,M]=U.useState([0,0]),[P,k]=U.useState(!1),[V,X]=U.useState(!1),[Z,$]=U.useState("genomic"),[H,z]=U.useState([0,0]),[te,fe]=U.useState([0,0]),[K,I]=U.useState(!1),[q,ee]=U.useState([]),[se,B]=U.useState(!1),[Y,Q]=U.useState("degree"),[pe,ye]=U.useState(!0),[Ee,Oe]=U.useState({sample:8,root:6,other:5}),[ze,It]=U.useState(IV),[mt,ct]=U.useState(!1),[De,cn]=U.useState(OV),[Ne,yn]=U.useState(!1),Wt=U.useCallback(we=>we.map(([rt,St,Je])=>({index:rt,left:St,right:Je})),[]);U.useEffect(()=>{se&&Z==="genomic"&&k(!0);const we=setTimeout(()=>{M(S),k(!1)},500);return()=>clearTimeout(we)},[S,se,Z]),U.useEffect(()=>{se&&Z==="tree"&&I(!0);const we=setTimeout(()=>{fe(H),I(!1)},500);return()=>clearTimeout(we)},[H,se,Z]),U.useEffect(()=>{const we=async()=>{try{_(!0),console.log("Fetching initial graph data for file:",n,"with max_samples:",e);const St=(await bt.getGraphData(n,{maxSamples:e,sampleOrder:Y})).data;if(console.log("Received initial graph data:",St),St.metadata.sequence_length){E(St.metadata.sequence_length);const Je=[0,St.metadata.sequence_length];A(Je),M(Je)}if(St.metadata.tree_intervals&&St.metadata.tree_intervals.length>0){const Je=Wt(St.metadata.tree_intervals);ee(Je);const vt=[0,Je.length-1];z(vt),fe(vt)}X(!0),o(St),u(St),h(null)}catch(rt){console.error("Error fetching initial graph data:",rt),h(rt instanceof Error?rt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}};X(!1),B(!1),we()},[n,e,Wt]),U.useEffect(()=>{if(!V)return;let we=!1,rt=null,St=null;if(se&&(Z==="genomic"?D[0]===0&&D[1]===R||(we=!0,rt={genomic_start:D[0],genomic_end:D[1]}):Z==="tree"&&!(te[0]===0&&te[1]===q.length-1)&&q.length>0&&(we=!0,St={tree_start_idx:te[0],tree_end_idx:te[1]})),!we)if(!s||s.metadata.sample_order!==Y)we=!0,console.log("Making API call due to sample order change");else{console.log("Skipping API call - using existing data (full range or filter disabled)");return}(async()=>{try{_(!0);let vt={maxSamples:e,sampleOrder:Y};rt?(console.log("Fetching filtered graph data for genomic range:",D),vt.genomicStart=rt.genomic_start,vt.genomicEnd=rt.genomic_end):St?(console.log("Fetching filtered graph data for tree range:",te),vt.treeStartIdx=St.tree_start_idx,vt.treeEndIdx=St.tree_end_idx):console.log("Fetching unfiltered graph data");const Ao=(await bt.getGraphData(n,vt)).data;console.log("Received graph data:",Ao),o(Ao),h(null)}catch(vt){console.error("Error fetching graph data:",vt),h(vt instanceof Error?vt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}})()},[n,e,D,te,se,Z,V,R,q,Y]),U.useEffect(()=>{se||ye(!0)},[se]);const Rn=()=>{if(!s||!w)return s;switch(y){case"subgraph":{const we=kV(w,s.nodes,s.edges);we.add(w.id);const rt=s.nodes.filter(Je=>we.has(Je.id)),St=s.edges.filter(Je=>{const vt=typeof Je.source=="number"?Je.source:Je.source.id,Js=typeof Je.target=="number"?Je.target:Je.target.id;return we.has(vt)&&we.has(Js)});return{...s,nodes:rt,edges:St,metadata:{...s.metadata,is_subset:!0}}}case"ancestors":{const we=MV(w,s.nodes,s.edges);we.add(w.id);const rt=s.nodes.filter(Je=>we.has(Je.id)),St=s.edges.filter(Je=>{const vt=typeof Je.source=="number"?Je.source:Je.source.id,Js=typeof Je.target=="number"?Je.target:Je.target.id;return we.has(vt)&&we.has(Js)});return{...s,nodes:rt,edges:St,metadata:{...s.metadata,is_subset:!0}}}default:return s}},jt=()=>{if(!l||!s||!i)return null;const we=Rn();return we?{originalNodes:s.metadata.original_num_nodes||i.num_nodes,originalEdges:s.metadata.original_num_edges||i.num_edges,subArgNodes:l.nodes.length,subArgEdges:l.edges.length,displayedNodes:we.nodes.length,displayedEdges:we.edges.length}:null},un=we=>{y==="full"?(x(we),T("subgraph")):(w==null?void 0:w.id)===we.id?(T("full"),x(null)):(x(we),T("subgraph"))},We=we=>{x(we),T("ancestors")},xe=we=>{console.log("Edge clicked:",we)},Re=()=>{T("full"),x(null)},Qe=U.useCallback(we=>{(we[0]!==S[0]||we[1]!==S[1])&&A(we)},[S]),Ve=U.useCallback(we=>{(we[0]!==H[0]||we[1]!==H[1])&&z(we)},[H]),Ye=U.useCallback(()=>{const we=!se;if(B(we),we){if(Z==="genomic")A([0,R]),M([0,R]);else if(Z==="tree"&&q.length>0){const rt=[0,q.length-1];z(rt),fe(rt)}ye(!1)}else ye(!0)},[se,Z,R,q]),_t=U.useCallback(we=>{if($(we),we==="genomic")A([0,R]),M([0,R]);else if(we==="tree"&&q.length>0){const rt=[0,q.length-1];z(rt),fe(rt)}},[R,q]),fn=U.useCallback(we=>we>=1e6?`${(we/1e6).toFixed(1)}M`:we>=1e3?`${(we/1e3).toFixed(1)}K`:we.toString(),[]),Xr=()=>{let we="";switch(y){case"subgraph":we=`SubARG at Root ${w==null?void 0:w.id}`;break;case"ancestors":we=`Parent ARG of Node ${w==null?void 0:w.id}`;break;default:we="Full ARG"}return se&&(s==null?void 0:s.metadata.genomic_start)!==void 0&&(s==null?void 0:s.metadata.genomic_end)!==void 0&&(we+=` (${fn(s.metadata.genomic_start)} - ${fn(s.metadata.genomic_end)})`),we};return g?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:r.accentPrimary}}),m.jsx("p",{style:{color:r.text},children:"Loading force-directed ARG visualization..."})]})}):d?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",style:{color:r.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${r.text}B3`},children:d})]})}):m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:r.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:m.jsx("div",{className:"px-4 py-2",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:r.headerText},children:Xr()}),(R>0||q.length>0)&&m.jsx("div",{className:"flex items-center gap-4",children:R>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:r.headerText},children:[m.jsx("input",{type:"checkbox",checked:se,onChange:Ye,className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:r.accentPrimary}}),"Filter Genomic Range"]})}),y!=="full"&&m.jsx("button",{onClick:Re,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:r.containerBackground,color:r.text,borderColor:`${r.accentPrimary}33`},onMouseEnter:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}66`,we.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}33`,we.currentTarget.style.backgroundColor=r.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[se&&m.jsxs("button",{onClick:()=>ye(!pe),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:r.accentPrimary,color:r.background},onMouseEnter:we=>{we.currentTarget.style.opacity="0.8"},onMouseLeave:we=>{we.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:pe?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:r.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${r.nodeSample[0]}, ${r.nodeSample[1]}, ${r.nodeSample[2]})`,borderColor:r.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeDefault[0]}, ${r.nodeDefault[1]}, ${r.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeCombined[0]}, ${r.nodeCombined[1]}, ${r.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${r.nodeRoot[0]}, ${r.nodeRoot[1]}, ${r.nodeRoot[2]})`,borderColor:`rgb(${r.nodeSelected[0]}, ${r.nodeSelected[1]}, ${r.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:r.headerText,borderLeftColor:r.border},children:"Left click: Subgraph • Right click: Ancestors"})]})]})})}),se&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:!pe&&m.jsx("div",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsx("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:q.length>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:[m.jsx("button",{onClick:()=>_t("genomic"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="genomic"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="genomic"?r.accentPrimary:r.containerBackground,color:Z==="genomic"?r.background:r.text},children:"Genomic"}),m.jsx("button",{onClick:()=>_t("tree"),className:`px-3 py-1 text-xs font-medium transition-colors ${Z==="tree"?"":"hover:opacity-80"}`,style:{backgroundColor:Z==="tree"?r.accentPrimary:r.containerBackground,color:Z==="tree"?r.background:r.text},children:"Tree Index"})]})]})}),m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:Z==="genomic"&&R>0?m.jsx(yO,{min:0,max:R,step:Math.max(1,Math.floor(R/1e3)),value:S,onChange:Qe,formatValue:fn,className:"w-full"}):Z==="tree"&&q.length>0?m.jsx(bO,{treeIntervals:q,value:H,onChange:Ve,className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:r.text},children:[Z==="genomic"?m.jsxs("span",{children:[fn(S[1]-S[0])," bp (",((S[1]-S[0])/R*100).toFixed(1),"%)",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:[" • ",s.metadata.num_local_trees," trees"]})]}):Z==="tree"&&q.length>0?m.jsxs("span",{children:["Trees ",H[0],"-",H[1]," (",H[1]-H[0]+1," of ",q.length,")",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:[" • ",s.metadata.expected_tree_count??s.metadata.num_local_trees," displayed"]}),(s==null?void 0:s.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:[" ⚠️ (actual: ",s.metadata.num_local_trees,")"]})]}):null,g&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:r.accentPrimary}})]})]})]})})}),m.jsx("div",{className:"flex-1 overflow-hidden",children:m.jsxs("div",{className:"w-full h-full relative",children:[m.jsx(EV,{ref:t,data:Rn(),onNodeClick:un,onNodeRightClick:We,onEdgeClick:xe,focalNode:w,nodeSizes:Ee,sampleOrder:Y,edgeThickness:ze,temporalSpacingMode:De.temporalSpacingMode}),m.jsx(NV,{sampleOrder:Y,onSampleOrderChange:Q,nodeSizes:Ee,onNodeSizeChange:we=>Oe(we),edgeThickness:ze,onEdgeThicknessChange:we=>It(we),temporalSpacingMode:De.temporalSpacingMode,onTemporalSpacingModeChange:we=>cn(rt=>({...rt,temporalSpacingMode:we})),isLoading:Ne}),m.jsx(AV,{originalNodeCount:(mr=jt())==null?void 0:mr.originalNodes,originalEdgeCount:(Lt=jt())==null?void 0:Lt.originalEdges,subargNodeCount:(Bt=jt())==null?void 0:Bt.subArgNodes,subargEdgeCount:(Cn=jt())==null?void 0:Cn.subArgEdges,displayedNodeCount:(_r=jt())==null?void 0:_r.displayedNodes,displayedEdgeCount:(Kn=jt())==null?void 0:Kn.displayedEdges,genomicRange:se?S:void 0,sequenceLength:R,isFiltered:se,isFilterSectionCollapsed:pe})]})})]})});function DV(n){const e=n.querySelectorAll("circle, line, path, text, rect, ellipse, polygon, polyline");let t=1/0,r=-1/0,i=1/0,s=-1/0;if(e.forEach(u=>{try{const d=u.getBBox();d.width>0&&d.height>0&&(t=Math.min(t,d.x),r=Math.max(r,d.x+d.width),i=Math.min(i,d.y),s=Math.max(s,d.y+d.height))}catch(d){console.warn("Could not get bounding box for element:",u,d)}}),t===1/0){const u=n.viewBox.baseVal;t=u.x,i=u.y,r=u.x+u.width,s=u.y+u.height}const o=r-t,l=s-i;return{minX:t,maxX:r,minY:i,maxY:s,width:o,height:l,centerX:t+o/2,centerY:i+l/2}}async function jV(n,e){const{filename:t,padding:r=50,maxWidth:i=8192,maxHeight:s=8192,backgroundColor:o="#03303E",scale:l=3,watermark:u}=e;try{const d=DV(n),h=d.width+r*2,g=d.height+r*2,_=Math.min(i/h,s/g),y=Math.min(l,_),T=Math.round(h*y),w=Math.round(g*y),x=n.cloneNode(!0);x.removeAttribute("transform");const S=d.minX-r,A=d.minY-r;x.setAttribute("viewBox",`${S} ${A} ${h} ${g}`),x.setAttribute("width",T.toString()),x.setAttribute("height",w.toString()),x.setAttribute("shape-rendering","geometricPrecision"),x.setAttribute("text-rendering","geometricPrecision"),x.setAttribute("xmlns","http://www.w3.org/2000/svg"),x.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const R=document.createElementNS("http://www.w3.org/2000/svg","rect");R.setAttribute("x",S.toString()),R.setAttribute("y",A.toString()),R.setAttribute("width",h.toString()),R.setAttribute("height",g.toString()),R.setAttribute("fill",o),R.setAttribute("stroke","none"),x.insertBefore(R,x.firstChild),x.querySelectorAll("*").forEach(X=>{const Z=window.getComputedStyle(X),$=X.getAttribute("style")||"";["fill","stroke","stroke-width","stroke-opacity","fill-opacity","opacity"].forEach(z=>{const te=z.replace(/([A-Z])/g,"-$1").toLowerCase(),fe=Z.getPropertyValue(te);fe&&fe!=="none"&&!X.hasAttribute(te)&&X.setAttribute(te,fe)})});const C=new XMLSerializer().serializeToString(x),O=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),D=URL.createObjectURL(O),M=document.createElement("canvas");M.width=T,M.height=w;const P=M.getContext("2d",{alpha:!1});if(!P)throw new Error("Could not get canvas context");P.imageSmoothingEnabled=!0,P.imageSmoothingQuality="high",P.fillStyle=o,P.fillRect(0,0,T,w);const k=new Image,V=setTimeout(()=>{throw URL.revokeObjectURL(D),new Error("SVG loading timed out")},1e4);k.onload=()=>{clearTimeout(V);try{P.fillStyle=o,P.fillRect(0,0,T,w),P.globalCompositeOperation="source-over",P.drawImage(k,0,0,T,w),u&&y1(P,T,w,u),M.toBlob(X=>{if(!X)throw new Error("Failed to create image blob");v1(X,t)},"image/png",1),URL.revokeObjectURL(D)}catch(X){throw URL.revokeObjectURL(D),new Error(`Failed to draw SVG to canvas: ${X}`)}},k.onerror=X=>{throw clearTimeout(V),URL.revokeObjectURL(D),new Error(`Failed to load SVG image: ${X}`)},k.crossOrigin="anonymous",k.src=D}catch(d){throw console.error("Error exporting SVG image:",d),d}}async function LV(n,e,t){var d,h,g,_;const{filename:r,maxWidth:i=4096,maxHeight:s=4096,backgroundColor:o="#03303E",scale:l=2,watermark:u}=t;try{if(!e.current||!n.nodes.length)throw new Error("No 3D visualization data available for export");const{bounds:y,currentViewState:T}=n,w=(y.minX+y.maxX)/2,x=(y.minY+y.maxY)/2,S=(y.minZ+y.maxZ)/2,A=y.maxX-y.minX,R=y.maxY-y.minY,E=y.maxZ-y.minZ,C=Math.max(A,R,E),D=Math.max(.1,Math.min(3,1/(C*1.3)));let M=null;if((h=(d=e.current)==null?void 0:d.deck)!=null&&h.canvas)M=e.current.deck.canvas;else if((g=e.current)!=null&&g.canvas)M=e.current.canvas;else{const te=((_=e.current)==null?void 0:_.domElement)||e.current;te&&(M=te.querySelector("canvas"))}if(!M)throw new Error("Could not access DeckGL canvas - trying fallback method");const P={...T},k={...T,target:[w,x,S],zoom:D},V=M.width/M.height;let X=Math.min(i,2048*l),Z=Math.min(s,X/V);Z>s&&(Z=s,X=Z*V),X=Math.round(X),Z=Math.round(Z);const $=M.width,H=M.height,z={width:M.style.width,height:M.style.height};try{M.width=X,M.height=Z,M.style.width=`${X}px`,M.style.height=`${Z}px`,e.current.setProps({width:X,height:Z,viewState:k}),await new Promise(K=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(K,200)})})});const te=document.createElement("canvas");te.width=X,te.height=Z;const fe=te.getContext("2d");if(!fe)throw new Error("Could not get export canvas context");fe.imageSmoothingEnabled=!0,fe.imageSmoothingQuality="high",fe.fillStyle=o,fe.fillRect(0,0,X,Z),fe.drawImage(M,0,0),u&&y1(fe,X,Z,u),te.toBlob(K=>{if(!K)throw new Error("Failed to create image blob");v1(K,r)},"image/png",1)}finally{M.width=$,M.height=H,M.style.width=z.width,M.style.height=z.height,e.current.setProps({width:$,height:H,viewState:P}),await new Promise(te=>{requestAnimationFrame(()=>{requestAnimationFrame(te)})})}}catch(y){throw console.error("Error exporting 3D visualization image:",y),y}}async function BV(n,e){const{filename:t,maxWidth:r=4096,maxHeight:i=4096,backgroundColor:s="#03303E",scale:o=2,watermark:l}=e;try{await new Promise(_=>requestAnimationFrame(_));const u=Math.min(r,n.width*o),d=Math.min(i,n.height*o),h=document.createElement("canvas");h.width=u,h.height=d;const g=h.getContext("2d");if(!g)throw new Error("Could not get canvas context");g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.fillStyle=s,g.fillRect(0,0,u,d),g.drawImage(n,0,0,u,d),l&&y1(g,u,d,l),h.toBlob(_=>{if(!_)throw new Error("Failed to create image blob");v1(_,t)},"image/png",1)}catch(u){throw console.error("Error exporting canvas image:",u),u}}function v1(n,e){const t=URL.createObjectURL(n),r=document.createElement("a");r.href=t,r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}function y1(n,e,t,r){const{text:i,subtext:s,position:o="bottom-right",color:l="#14E2A8",backgroundColor:u="rgba(3, 48, 62, 0.8)",fontSize:d=24,fontFamily:h="Arial, sans-serif",opacity:g=.9}=r;n.save(),n.globalAlpha=g,n.font=`bold ${d}px ${h}`,n.textAlign="left",n.textBaseline="top";const _=n.measureText(i),y=s?n.measureText(s):{width:0},T=Math.max(_.width,y.width),w=d,x=4,S=s?w*2+x:w,A=16,R=12,E=T+A*2,C=S+R*2;let O,D;const M=20;switch(o){case"top-left":O=M,D=M;break;case"top-right":O=e-E-M,D=M;break;case"bottom-left":O=M,D=t-C-M;break;case"bottom-right":O=e-E-M,D=t-C-M;break;case"top-center":O=(e-E)/2,D=M;break;case"bottom-center":default:O=(e-E)/2,D=t-C-M;break}n.fillStyle=u,n.beginPath(),n.roundRect?n.roundRect(O,D,E,C,6):n.rect(O,D,E,C),n.fill(),n.fillStyle=l,n.fillText(i,O+A,D+R),s&&(n.font=`${Math.round(d*.7)}px ${h}`,n.fillStyle=l,n.fillText(s,O+A,D+R+w+x)),n.restore()}const Kd=(n,e)=>{const t=u=>{let d=u.replace("#","");if(d.length===3&&(d=d.split("").map(T=>T+T).join("")),d.length!==6)return console.warn("Invalid hex color:",u),0;const h=parseInt(d.substr(0,2),16)/255,g=parseInt(d.substr(2,2),16)/255,_=parseInt(d.substr(4,2),16)/255,y=T=>T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4);return .2126*y(h)+.7152*y(g)+.0722*y(_)};if(!n||!e)return console.warn("Missing colors for contrast check:",{color1:n,color2:e}),21;const r=t(n),i=t(e),s=Math.max(r,i),o=Math.min(r,i),l=(s+.05)/(o+.05);return n.toLowerCase()==="#ffffff"&&e.toLowerCase()==="#ffffff"&&console.log("White/white contrast check:",{color1:n,color2:e,lum1:r,lum2:i,ratio:l}),l},UV=({label:n,value:e,onChange:t,backgroundColor:r})=>{const i=r&&Kd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:n}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`compact-string-${n.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`compact-string-${n.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>t(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>t(s.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]})]})},FV=({label:n,value:e,onChange:t,backgroundColor:r})=>{const i=VM(e),s=e[3],o=d=>{const h=FM(d);t([h[0],h[1],h[2],s])},l=d=>{t([e[0],e[1],e[2],d])},u=r&&s>128&&Kd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:n}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`compact-node-${n.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`compact-node-${n.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70 flex-shrink-0",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"flex-1 min-w-0"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-10 text-right flex-shrink-0",children:[Math.round(s/255*100),"%"]})]})]})},zV=({label:n,value:e,onChange:t,backgroundColor:r})=>{const i=VM(e),s=e[3],o=d=>{const h=FM(d);t([h[0],h[1],h[2],s])},l=d=>{t([e[0],e[1],e[2],d])},u=r&&s>128&&Kd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:n}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`color-${n.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`color-${n.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"w-20"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-8 text-right",children:[Math.round(s/255*100),"%"]})]})]})})]})]})},VV=({label:n,value:e,onChange:t,backgroundColor:r})=>{const i=r&&Kd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:n}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`color-${n.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`color-${n.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>t(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>t(s.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"})]})]})},qV=({isOpen:n,onClose:e,editingTheme:t})=>{const{saveCustomTheme:r,updateCustomTheme:i,currentVisualizationType:s}=$t(),[o,l]=U.useState(""),[u,d]=U.useState(!1),[h,g]=U.useState(()=>{const M=[96,160,183,255],P=[153,153,153,102],k=[Math.min(255,Math.round(P[0]*1.5)),Math.min(255,Math.round(P[1]*1.5)),Math.min(255,Math.round(P[2]*1.5)),Math.min(255,Math.round(P[3]*1.3))];return{background:"#03303E",containerBackground:"#0f1419",nodeDefault:M,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:M,nodeSelected:[255,255,255,255],edgeDefault:P,edgeHighlight:k,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"}});U.useEffect(()=>{if(t)l(t.name),g(t.colors);else{l("");const M=[96,160,183,255],P=[153,153,153,102],k=[Math.min(255,Math.round(P[0]*1.5)),Math.min(255,Math.round(P[1]*1.5)),Math.min(255,Math.round(P[2]*1.5)),Math.min(255,Math.round(P[3]*1.3))];g({background:"#03303E",containerBackground:"#0f1419",nodeDefault:M,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:M,nodeSelected:[255,255,255,255],edgeDefault:P,edgeHighlight:k,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"})}},[t,n]),U.useEffect(()=>{const M=P=>{P.key==="Escape"&&e()};return n&&(document.addEventListener("keydown",M),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",M),document.body.style.overflow="unset"}},[n,e]);const _=()=>{if(!o.trim()){alert("Please enter a theme name");return}t?i(t.id,o.trim(),h):r(o.trim(),h),e()},y=M=>P=>{g(k=>({...k,[M]:P}))},T=M=>P=>{g(k=>({...k,[M]:P}))},w=M=>{const P=M.replace("#",""),k=parseInt(P.substr(0,2),16),V=parseInt(P.substr(2,2),16),X=parseInt(P.substr(4,2),16);return(.299*k+.587*V+.114*X)/255>.5?"#000000":"#ffffff"},x=M=>{const P=w(M);g(k=>({...k,background:M,headerText:P,controlPanelText:P,buttonText:P,text:P}))},S=M=>{const P=[Math.min(255,Math.round(M[0]*1.5)),Math.min(255,Math.round(M[1]*1.5)),Math.min(255,Math.round(M[2]*1.5)),Math.min(255,Math.round(M[3]*1.3))];g(k=>({...k,edgeDefault:M,edgeHighlight:P}))},A=M=>{g(P=>({...P,nodeDefault:M,nodeCombined:M}))},R=zM(s),E=jB(s),C=M=>M==="nodeDefault"?A:M==="edgeDefault"?S:y(M),O=M=>({background:"Visualization Background",containerBackground:"Container Background",nodeDefault:"Internal Nodes (combined nodes will match)",nodeRoot:"Root Nodes",nodeSample:"Sample Nodes",nodeCombined:"Combined Nodes",nodeSelected:"Selected Nodes",edgeDefault:"Edges (highlighted edges will be auto-brightened)",edgeHighlight:"Highlighted Edges",text:"Primary Text",textSecondary:"Secondary Text",border:"Borders",exportBackground:"Export Background",accentPrimary:"Primary Accent",accentSecondary:"Secondary Accent",geographicGrid:"Geographic Shapes & Grid",temporalGrid:"Temporal Grid Lines",tooltipBackground:"Tooltip Background",tooltipText:"Tooltip Text",headerText:"Header Text",controlPanelText:"Control Panel Text",buttonText:"Button Text"})[M]||M,D=M=>{const P=h[M];return typeof P=="string"?m.jsx(VV,{label:O(M),value:P,onChange:M==="background"?x:T(M),backgroundColor:M==="tooltipText"?h.tooltipBackground:void 0},M):m.jsx(zV,{label:O(M),value:P,onChange:C(M),backgroundColor:h.background},M)};return n?m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden transform transition-all",children:m.jsxs("div",{className:"p-6 overflow-y-auto max-h-[85vh] overflow-x-hidden",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[m.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-sp-pale-green/10",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:t?"Edit Custom Theme":"Create Custom Theme"})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-sp-white mb-2",children:"Theme Name"}),m.jsx("input",{type:"text",value:o,onChange:M=>l(M.target.value),className:"w-full px-3 py-2 rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"Enter theme name...",maxLength:50})]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsx("h4",{className:"text-base font-semibold text-sp-pale-green",children:"Main Colors"}),R.map(M=>D(M))]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsxs("button",{onClick:()=>d(!u),className:"flex items-center gap-2 text-base font-semibold text-sp-pale-green hover:text-sp-very-pale-green transition-colors",children:[m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Other Colors"]}),u&&m.jsx("div",{className:"space-y-6 pl-6 border-l-2 border-sp-pale-green/20",children:m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 min-w-0",children:E.map(M=>{try{const P=h[M];return P?typeof P=="string"?m.jsx(UV,{label:O(M),value:P,onChange:T(M),backgroundColor:M==="tooltipText"?h.tooltipBackground:h.background},M):m.jsx(FV,{label:O(M),value:P,onChange:y(M),backgroundColor:h.background},M):null}catch(P){return console.warn(`Error rendering color picker for ${M}:`,P),null}})})})]}),m.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-sp-pale-green/20 bg-sp-dark-blue/20",children:[m.jsx("h4",{className:"text-sm font-semibold text-sp-pale-green mb-3",children:"Preview"}),m.jsxs("div",{className:"p-4 rounded border text-sm",style:{backgroundColor:h.background,borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`,color:h.text},children:[m.jsx("div",{style:{color:h.headerText},className:"font-semibold mb-2",children:"3D ARG Visualization"}),m.jsx("div",{style:{color:h.controlPanelText},className:"mb-3",children:"Control panel text sample"}),m.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Background"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:`rgba(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]}, ${h.nodeSample[3]/255})`,borderColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]}, ${h.nodeRoot[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Root"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]}, ${h.nodeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Internal"})]})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeDefault[0]}, ${h.edgeDefault[1]}, ${h.edgeDefault[2]}, ${h.edgeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Edges"}),m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeHighlight[0]}, ${h.edgeHighlight[1]}, ${h.edgeHighlight[2]}, ${h.edgeHighlight[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Highlighted"})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 border-2 rounded",style:{borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Geographic Grid"}),m.jsx("div",{className:"w-6 h-1 rounded",style:{backgroundColor:`rgba(${h.temporalGrid[0]}, ${h.temporalGrid[1]}, ${h.temporalGrid[2]}, ${h.temporalGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Temporal Grid"})]}),m.jsx("div",{className:"text-xs inline-block px-2 py-1 rounded",style:{color:h.tooltipText,backgroundColor:h.tooltipBackground,border:`1px solid rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, 0.3)`},children:"Sample tooltip text"})]})]}),m.jsxs("div",{className:"flex gap-3 mt-6",children:[m.jsx("button",{onClick:e,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:"Cancel"}),m.jsx("button",{onClick:_,disabled:!o.trim(),className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-4 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:t?"Update Theme":"Save Theme"})]})]})})]}):null},ZN=[{value:"tskit",label:"tskit",icon:"🎨"},{value:"grayscale",label:"B&W",icon:"🌑"},{value:"custom",label:"Custom",icon:"🎭"}],xO=()=>{const{theme:n,setTheme:e,colors:t,customThemes:r,selectedCustomTheme:i,setSelectedCustomTheme:s,deleteCustomTheme:o}=$t(),[l,u]=U.useState(!1),[d,h]=U.useState(!1),[g,_]=U.useState(null),[y,T]=U.useState({isOpen:!1,themeId:"",themeName:""}),w=U.useRef(null),x=ZN.find(k=>k.value===n),S=n==="custom"&&i?r.find(k=>k.id===i):null;U.useEffect(()=>{const k=V=>{w.current&&!w.current.contains(V.target)&&u(!1)};return document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[]);const A=k=>{k==="custom"?r.length===0?(h(!0),_(null)):(e("custom"),i||s(r[0].id)):e(k),u(!1)},R=k=>{e("custom"),s(k),u(!1)},E=()=>{_(null),h(!0),u(!1)},C=k=>{const V=r.find(X=>X.id===k);V&&(_(V),h(!0)),u(!1)},O=k=>{const V=r.find(X=>X.id===k);V&&T({isOpen:!0,themeId:k,themeName:V.name}),u(!1)},D=()=>{o(y.themeId),T({isOpen:!1,themeId:"",themeName:""}),i===y.themeId&&r.length<=1&&e("tskit")},M=()=>n==="custom"&&S?S.name.length>12?`${S.name.slice(0,12)}...`:S.name:(x==null?void 0:x.label)||"Custom",P=()=>n==="custom"?"🎭":(x==null?void 0:x.icon)||"🎨";return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative",ref:w,children:[m.jsxs("button",{className:"font-medium px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1",style:{backgroundColor:t.containerBackground,color:t.text,border:`1px solid ${t.border}`},onMouseEnter:k=>{k.currentTarget.style.backgroundColor=t.border},onMouseLeave:k=>{k.currentTarget.style.backgroundColor=t.containerBackground},onClick:()=>u(!l),title:"Select color theme",children:[P()," ",M(),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&m.jsxs("div",{className:"absolute right-0 mt-1 py-1 rounded-md shadow-lg z-50 min-w-[160px] max-w-[250px]",style:{backgroundColor:t.containerBackground,border:`1px solid ${t.border}`},children:[ZN.filter(k=>k.value!=="custom").map(k=>m.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:n===k.value?t.textSecondary:t.text,backgroundColor:n===k.value?t.border:"transparent"},onMouseEnter:V=>{n!==k.value&&(V.currentTarget.style.backgroundColor=t.border)},onMouseLeave:V=>{n!==k.value&&(V.currentTarget.style.backgroundColor="transparent")},onClick:()=>A(k.value),children:[k.icon," ",k.label,n===k.value&&m.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},k.value)),m.jsx("div",{className:"h-px my-1",style:{backgroundColor:t.border}}),m.jsx("div",{className:"px-3 py-1",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-xs font-medium",style:{color:t.textSecondary},children:"Custom Themes"}),m.jsx("button",{onClick:E,className:"text-xs hover:underline",style:{color:t.textSecondary},title:"Create new custom theme",children:"+ New"})]})}),r.length===0?m.jsx("div",{className:"px-3 py-2 text-xs",style:{color:t.text+"80"},children:"No custom themes yet"}):r.map(k=>m.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors group",style:{backgroundColor:n==="custom"&&i===k.id?t.border:"transparent"},onMouseEnter:V=>{n==="custom"&&i===k.id||(V.currentTarget.style.backgroundColor=t.border)},onMouseLeave:V=>{n==="custom"&&i===k.id||(V.currentTarget.style.backgroundColor="transparent")},children:[m.jsxs("button",{onClick:()=>R(k.id),className:"flex-1 text-left flex items-center gap-2 min-w-0",style:{color:n==="custom"&&i===k.id?t.textSecondary:t.text},children:["🎭",m.jsx("span",{className:"truncate",children:k.name}),n==="custom"&&i===k.id&&m.jsx("svg",{className:"w-4 h-4 ml-auto flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),m.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[m.jsx("button",{onClick:()=>C(k.id),className:"p-1 rounded hover:bg-opacity-20",style:{color:t.textSecondary},title:"Edit theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),m.jsx("button",{onClick:()=>O(k.id),className:"p-1 rounded hover:bg-red-500 hover:bg-opacity-20",style:{color:"#ef4444"},title:"Delete theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},k.id)),r.length>0&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"h-px my-1",style:{backgroundColor:t.border}}),m.jsx("button",{onClick:E,className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:t.textSecondary},onMouseEnter:k=>{k.currentTarget.style.backgroundColor=t.border},onMouseLeave:k=>{k.currentTarget.style.backgroundColor="transparent"},children:"➕ Create New Theme"})]})]})]}),m.jsx(qV,{isOpen:d,onClose:()=>{h(!1),_(null)},editingTheme:g}),m.jsx($M,{isOpen:y.isOpen,title:"Delete Custom Theme",message:`Are you sure you want to delete the custom theme "${y.themeName}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",cancelText:"Cancel",onConfirm:D,onCancel:()=>T({isOpen:!1,themeId:"",themeName:""})})]})};function $V(){const{filename:n}=OM(),e=pc(),{maxSamples:t,treeSequence:r,setTreeSequence:i}=$s(),{colors:s,setCurrentVisualizationType:o}=$t(),l=U.useRef(null),[u,d]=U.useState(!1);if(U.useEffect(()=>{o("force-directed")},[o]),!n)return m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4 transition-colors",onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(n),g=y=>{Se.user.action("switch-tree-sequence-force-directed",{treeSequence:y},"ArgVisualizationPage"),i(y),d(!1),e(`/visualize/${encodeURIComponent(y.filename)}`)},_=async()=>{const y=l.current;if(y)try{const T=`${h.replace(/\.(trees|tsz)$/,"")}_arg.png`;await jV(y,{filename:T,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:3,watermark:{text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"}}),console.log("High-resolution ARG image downloaded successfully")}catch(T){console.error("Error downloading ARG image:",T)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.color=`${s.accentPrimary}CC`},onMouseLeave:y=>{y.currentTarget.style.color=s.accentPrimary},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(gc,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"ARG Visualization"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(xO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download ARG visualization as PNG",children:"Download Image"}),r&&m.jsx(qx,{filename:r.filename})]})]})]})}),m.jsx($x,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:U.useMemo(()=>m.jsx(PV,{ref:l,filename:h,max_samples:t}),[h,t])})]})}function HV(){const e=hc().pathname.startsWith("/visualize"),{colors:t,theme:r}=$t(),s=e&&!(e&&r==="custom")?t:null;return m.jsx("footer",{className:`fixed bottom-0 left-0 right-0 py-4 text-center text-sm backdrop-blur-sm border-t z-50 ${e?"":"text-sp-white bg-sp-very-dark-blue/90 border-t-sp-dark-blue/50"}`,style:e&&s?{color:s.text,backgroundColor:s.background+"E6",borderTopColor:s.border+"80"}:{},children:m.jsxs("div",{className:"flex flex-col items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("p",{children:["© ",new Date().getFullYear()," ",m.jsx("a",{href:"https://chris-a-talbot.com",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-pale-green hover:text-sp-white transition-colors",style:e&&s?{color:s.accentPrimary}:{},children:"Chris Talbot"}),". All rights reserved."]}),m.jsx("a",{href:"https://github.com/chris-a-talbot/argscape",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary}:{},title:"View source on GitHub",children:m.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[m.jsx("span",{className:e?"":"text-sp-white/70",style:e&&s?{color:s.textSecondary,opacity:.7}:{},children:"Resources:"}),m.jsx("a",{href:"https://tskit.dev/",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tskit"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),m.jsx("a",{href:"https://tskit.dev/msprime/docs/stable/intro.html",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"msprime"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:"•"}),m.jsx("a",{href:"https://github.com/chris-a-talbot/fastgaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"fastgaia"})]})]})})}const WV="modulepreload",XV=function(n){return"/"+n},QN={},JN=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(t.map(d=>{if(d=XV(d),d in QN)return;QN[d]=!0;const h=d.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":WV,h||(_.as="script"),_.crossOrigin="",_.href=d,u&&_.setAttribute("nonce",u),document.head.appendChild(_),h)return new Promise((y,T)=>{_.addEventListener("load",y),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};function Of(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const b1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ek=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ek&&parseFloat(ek[1]);const Yu=globalThis,Ua=globalThis.process||{},YV=globalThis.navigator||{};function wO(n){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Gs(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||wO()}function GV(n){return Gs()?wO()?"Electron":(YV.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const TO="4.1.0";function KV(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class ZV{constructor(e,t,r="sessionStorage"){this.storage=KV(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function QV(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function JV(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Pf;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Pf||(Pf={}));const eq=10;function tk(n){return typeof n!="string"?n:(n=n.toUpperCase(),Pf[n]||Pf.WHITE)}function tq(n,e,t){return!Gs&&typeof n=="string"&&(e&&(n=`\x1B[${tk(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${tk(t)+eq}m${n}\x1B[49m`)),n}function nq(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),i=n;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(n)))}}function x1(n,e){if(!n)throw new Error("Assertion failed")}function Fa(){var e,t,r;let n;if(Gs()&&Yu.performance)n=(t=(e=Yu==null?void 0:Yu.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ua){const i=(r=Ua==null?void 0:Ua.hrtime)==null?void 0:r.call(Ua);n=i[0]*1e3+i[1]/1e6}else n=Date.now();return n}const za={debug:Gs()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},rq={enabled:!0,level:0};function Va(){}const nk={},rk={once:!0};class Sc{constructor({id:e}={id:""}){this.VERSION=TO,this._startTs=Fa(),this._deltaTs=Fa(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new ZV(`__probe-${this.id}__`,rq),this.timeStamp(`${this.id} started`),nq(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Fa()-this._startTs).toPrecision(10))}getDelta(){return Number((Fa()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,za.warn,arguments,rk)}error(e){return this._getLogFunction(0,e,za.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,za.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,za.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,za.debug||za.info,arguments,rk)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Va,r&&[r],{tag:sq(t)}):Va}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Va)}group(e,t,r={collapsed:!1}){const i=ik({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Va)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=SO(e)}_getLogFunction(e,t,r,i,s){if(this._shouldLog(e)){s=ik({logLevel:e,message:t,args:i,opts:s}),r=r||s.method,x1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Fa();const o=s.tag||s.message;if(s.once&&o)if(!nk[o])nk[o]=Fa();else return Va;return t=iq(this.id,s.message,s),r.bind(console,t,...s.args)}return Va}}Sc.VERSION=TO;function SO(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return x1(Number.isFinite(e)&&e>=0),e}function ik(n){const{logLevel:e,message:t}=n;n.logLevel=SO(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return x1(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function iq(n,e,t){if(typeof e=="string"){const r=t.time?JV(QV(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=tq(e,t.color,t.background)}return e}function sq(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Xb="4.3.2",aq=Xb[0]>="0"&&Xb[0]<="9"?`v${Xb}`:"";function oq(){const n=new Sc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=aq,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const lq=oq();function cq(n,e){return EO(n||{},e)}function EO(n,e,t=0){if(t>3)return e;const r={...n};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=EO(r[i]||{},e[i],t+1):r[i]=e[i];return r}const uq="latest";function fq(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const dq=fq();function is(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Is=typeof process!="object"||String(process)!=="[object process]"||process.browser,hq=typeof window<"u"&&typeof window.orientation<"u",sk=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sk&&parseFloat(sk[1]);class pq{constructor(e,t){j(this,"name");j(this,"workerThread");j(this,"isRunning",!0);j(this,"result");j(this,"_resolve",()=>{});j(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){is(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){is(this.isRunning),this.isRunning=!1,this._reject(e)}}class Yb{terminate(){}}const Gb=new Map;function gq(n){is(n.source&&!n.url||!n.source&&n.url);let e=Gb.get(n.source||n.url);return e||(n.url&&(e=mq(n.url),Gb.set(n.url,e)),n.source&&(e=AO(n.source),Gb.set(n.source,e))),is(e),e}function mq(n){if(!n.startsWith("http"))return n;const e=_q(n);return AO(e)}function AO(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function _q(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function RO(n,e=!0,t){const r=t||new Set;if(n){if(ak(n))r.add(n);else if(ak(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)RO(n[i],e,r)}}return t===void 0?Array.from(r):[]}function ak(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Kb=()=>{};class $0{constructor(e){j(this,"name");j(this,"source");j(this,"url");j(this,"terminated",!1);j(this,"worker");j(this,"onMessage");j(this,"onError");j(this,"_loadableURL","");const{name:t,source:r,url:i}=e;is(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=Kb,this.onError=s=>console.log(s),this.worker=Is?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Is||typeof Yb<"u"&&!Is}destroy(){this.onMessage=Kb,this.onError=Kb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||RO(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=gq({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Yb(r,{eval:!1})}else if(this.source)e=new Yb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class vq{constructor(e){j(this,"name","unnamed");j(this,"source");j(this,"url");j(this,"maxConcurrency",1);j(this,"maxMobileConcurrency",1);j(this,"onDebug",()=>{});j(this,"reuseWorkers",!0);j(this,"props",{});j(this,"jobQueue",[]);j(this,"idleQueue",[]);j(this,"count",0);j(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return $0.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new pq(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Is||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return hq?this.maxMobileConcurrency:this.maxConcurrency}}const yq={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Yi=class Yi{constructor(e){j(this,"props");j(this,"workerPools",new Map);this.props={...yq},this.setProps(e),this.workerPools=new Map}static isSupported(){return $0.isSupported()}static getWorkerFarm(e={}){return Yi._workerFarm=Yi._workerFarm||new Yi({}),Yi._workerFarm.setProps(e),Yi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let s=this.workerPools.get(t);return s||(s=new vq({name:t,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};j(Yi,"_workerFarm");let Df=Yi;function bq(n,e={}){const t=e[n.id]||{},r=Is?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Is?i=`modules/${n.module}/dist/${r}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let s=n.version;s==="latest"&&(s=uq);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${r}`}return is(i),i}function xq(n,e=dq){is(n,"no worker provided");const t=n.version;return!(!e||!t)}function wq(n,e){return!Df.isSupported()||!Is&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function Tq(n,e,t,r,i){const s=n.id,o=bq(n,t),u=Df.getWorkerFarm(t).getWorkerPool({name:s,url:o});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",Sq.bind(null,i));return d.postMessage("process",{input:e,options:t,context:r}),await(await d.result).result}async function Sq(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await n(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Eq(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function Aq(...n){return Rq(n)}function Rq(n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function Cq(n){const e=[];for await(const t of n)e.push(t);return Aq(...e)}function ok(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class lk{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ok(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ok()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Zd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let i=this.stats[t];return i||(e instanceof lk?i=e:i=new lk(t,r),this.stats[t]=i),i}}let Nq="";const ck={};function kq(n){for(const e in ck)if(n.startsWith(e)){const t=ck[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${Nq}${n}`),n}function Mq(n){return n&&typeof n=="object"&&n.isBuffer}function CO(n){if(Mq(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function NO(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function Iq(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const Oq=n=>typeof n=="boolean",$l=n=>typeof n=="function",Ec=n=>n!==null&&typeof n=="object",uk=n=>Ec(n)&&n.constructor==={}.constructor,Pq=n=>!!n&&typeof n[Symbol.iterator]=="function",Dq=n=>n&&typeof n[Symbol.asyncIterator]=="function",Ks=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Zs=n=>typeof Blob<"u"&&n instanceof Blob,jq=n=>n&&typeof n=="object"&&n.isBuffer,Lq=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Ec(n)&&$l(n.tee)&&$l(n.cancel)&&$l(n.getReader),Bq=n=>Ec(n)&&$l(n.read)&&$l(n.pipe)&&Oq(n.readable),kO=n=>Lq(n)||Bq(n);class Uq extends Error{constructor(t,r){super(t);j(this,"reason");j(this,"url");j(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const Fq=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,zq=/^([-\w.]+\/[-\w.+]+)/;function fk(n,e){return n.toLowerCase()===e.toLowerCase()}function Vq(n){const e=zq.exec(n);return e?e[1]:n}function dk(n){const e=Fq.exec(n);return e?e[1]:""}const MO=/\?.*/;function qq(n){const e=n.match(MO);return e&&e[0]}function w1(n){return n.replace(MO,"")}function $q(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Qd(n){return Ks(n)?n.url:Zs(n)?n.name||"":typeof n=="string"?n:""}function T1(n){if(Ks(n)){const e=n,t=e.headers.get("content-type")||"",r=w1(e.url);return Vq(t)||dk(r)}return Zs(n)?n.type||"":typeof n=="string"?dk(n):""}function Hq(n){return Ks(n)?n.headers["content-length"]||-1:Zs(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function IO(n){if(Ks(n))return n;const e={},t=Hq(n);t>=0&&(e["content-length"]=String(t));const r=Qd(n),i=T1(n);i&&(e["content-type"]=i);const s=await Yq(n);s&&(e["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function Wq(n){if(!n.ok)throw await Xq(n)}async function Xq(n){const e=$q(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&(i!=null&&i.includes("application/json"))?await n.json():await n.text()}catch{}return new Uq(t,r)}async function Yq(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${Gq(t)}`}return null}function Gq(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function Kq(n){return!Zq(n)&&!Qq(n)}function Zq(n){return n.startsWith("http:")||n.startsWith("https:")}function Qq(n){return n.startsWith("data:")}async function hk(n,e){var t,r;if(typeof n=="string"){const i=kq(n);return Kq(i)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await IO(n)}const pk=new Sc({id:"loaders.gl"});class Jq{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class e${constructor(){j(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const OO={fetch:null,mimeType:void 0,nothrow:!1,log:new e$,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:b1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},t$={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function PO(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function DO(){const n=PO();return n.globalOptions=n.globalOptions||{...OO},n.globalOptions}function n$(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],r$(n,t),s$(e,n,r)}function r$(n,e){gk(n,null,OO,t$,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};gk(r,t.id,i,s,e)}}function gk(n,e,t,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in n){const u=!e&&Ec(n[l]),d=l==="baseUri"&&!e,h=l==="workerUrl"&&e;if(!(l in t)&&!d&&!h){if(l in r)pk.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const g=i$(l,i);pk.warn(`${s} loader option '${o}${l}' not recognized. ${g}`)()}}}}function i$(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(n===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(t.startsWith(o)||o.startsWith(t))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function s$(n,e,t){const i={...n.options||{}};return a$(i,t),i.log===null&&(i.log=new Jq),mk(i,DO()),mk(i,e),i}function mk(n,e){for(const t in e)if(t in e){const r=e[t];uk(r)&&uk(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function a$(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function S1(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function E1(n){Of(n,"null loader"),Of(S1(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const jO=()=>{const n=PO();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function o$(n){const e=jO();n=Array.isArray(n)?n:[n];for(const t of n){const r=E1(t);e.find(i=>r===i)||e.unshift(r)}}function l$(){return jO()}const c$=/\.([^.]+)$/;async function u$(n,e=[],t,r){if(!LO(n))return null;let i=_k(n,e,{...t,nothrow:!0},r);if(i)return i;if(Zs(n)&&(n=await n.slice(0,10).arrayBuffer(),i=_k(n,e,t,r)),!i&&!(t!=null&&t.nothrow))throw new Error(BO(n));return i}function _k(n,e=[],t,r){if(!LO(n))return null;if(e&&!Array.isArray(e))return E1(e);let i=[];e&&(i=i.concat(e)),t!=null&&t.ignoreRegisteredLoaders||i.push(...l$()),d$(i);const s=f$(n,i,t,r);if(!s&&!(t!=null&&t.nothrow))throw new Error(BO(n));return s}function f$(n,e,t,r){const i=Qd(n),s=T1(n),o=w1(i)||(r==null?void 0:r.url);let l=null,u="";return t!=null&&t.mimeType&&(l=Zb(e,t==null?void 0:t.mimeType),u=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),l=l||h$(e,o),u=u||(l?`matched url ${o}`:""),l=l||Zb(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||g$(e,n),u=u||(l?`matched initial data ${UO(n)}`:""),t!=null&&t.fallbackMimeType&&(l=l||Zb(e,t==null?void 0:t.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&lq.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${u}.`),l}function LO(n){return!(n instanceof Response&&n.status===204)}function BO(n){const e=Qd(n),t=T1(n);let r="No valid loader found (";r+=e?`${NO(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=n?UO(n):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function d$(n){for(const e of n)E1(e)}function h$(n,e){const t=e&&c$.exec(e),r=t&&t[1];return r?p$(n,r):null}function p$(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Zb(n,e){var t;for(const r of n)if((t=r.mimeTypes)!=null&&t.some(i=>fk(e,i))||fk(e,`application/x.${r.id}`))return r;return null}function g$(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(m$(e,t))return t}else if(ArrayBuffer.isView(e)){if(vk(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&vk(e,0,t))return t;return null}function m$(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function vk(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>_$(n,e,t,i))}function _$(n,e,t,r){if(r instanceof ArrayBuffer)return Eq(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const i=H0(n,e,r.length);return r===i;default:return!1}}function UO(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?H0(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?H0(n,0,e):""}function H0(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const v$=256*1024;function*y$(n,e){const t=(e==null?void 0:e.chunkSize)||v$;let r=0;const i=new TextEncoder;for(;r<n.length;){const s=Math.min(n.length-r,t),o=n.slice(r,r+s);r+=s,yield i.encode(o)}}const b$=256*1024;function*x$(n,e={}){const{chunkSize:t=b$}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),s=new ArrayBuffer(i),o=new Uint8Array(n,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const w$=1024*1024;async function*T$(n,e){const t=(e==null?void 0:e.chunkSize)||w$;let r=0;for(;r<n.size;){const i=r+t,s=await n.slice(r,i).arrayBuffer();r=i,yield s}}function yk(n,e){return b1?S$(n,e):E$(n)}async function*S$(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:s,value:o}=await i;if(s)return;yield CO(o)}}catch{t.releaseLock()}}async function*E$(n,e){for await(const t of n)yield CO(t)}function A$(n,e){if(typeof n=="string")return y$(n,e);if(n instanceof ArrayBuffer)return x$(n,e);if(Zs(n))return T$(n,e);if(kO(n))return yk(n,e);if(Ks(n))return yk(n.body,e);throw new Error("makeIterator")}const FO="Cannot convert supplied data type";function R$(n,e,t){if(e.text&&typeof n=="string")return n;if(jq(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(FO)}async function C$(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return R$(n,e);if(Zs(n)&&(n=await IO(n)),Ks(n)){const i=n;return await Wq(i),e.binary?await i.arrayBuffer():await i.text()}if(kO(n)&&(n=A$(n,t)),Pq(n)||Dq(n))return Cq(n);throw new Error(FO)}function zO(n,e){const t=DO(),r=n||t;return typeof r.fetch=="function"?r.fetch:Ec(r.fetch)?i=>hk(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:hk}function N$(n,e,t){if(t)return t;const r={fetch:zO(e,n),...n};if(r.url){const i=w1(r.url);r.baseUrl=i,r.queryString=qq(r.url),r.filename=NO(i),r.baseUrl=Iq(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function k$(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function jf(n,e,t,r){e&&!Array.isArray(e)&&!S1(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=Qd(n),o=k$(e,r),l=await u$(n,o,t);return l?(t=n$(t,l,o,i),r=N$({url:i,_parse:jf,loaders:o},t,r||null),await M$(l,n,t,r)):null}async function M$(n,e,t,r){if(xq(n),t=cq(n.options,t),Ks(e)){const s=e,{ok:o,redirected:l,status:u,statusText:d,type:h,url:g}=s,_=Object.fromEntries(s.headers.entries());r.response={headers:_,ok:o,redirected:l,status:u,statusText:d,type:h,url:g}}e=await C$(e,n,t);const i=n;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,r);if(wq(n,t))return await Tq(n,e,t,r,jf);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r);if(i.parse)return await i.parse(e,t,r);throw is(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function W0(n,e,t,r){let i,s;!Array.isArray(e)&&!S1(e)?(i=[],s=e):(i=e,s=t);const o=zO(s);let l=n;return typeof n=="string"&&(l=await o(n)),Zs(n)&&(l=await o(n)),Array.isArray(i)?await jf(l,i,s):await jf(l,i,s)}const I$="4.3.2";var TM;const O$=(TM=globalThis.loaders)==null?void 0:TM.parseImageNode,X0=typeof Image<"u",Y0=typeof ImageBitmap<"u",P$=!!O$,G0=b1?!0:P$;function D$(n){switch(n){case"auto":return Y0||X0||G0;case"imagebitmap":return Y0;case"image":return X0;case"data":return G0;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function j$(){if(Y0)return"imagebitmap";if(X0)return"image";if(G0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function L$(n){const e=U$(n);if(!e)throw new Error("Not an image");return e}function B$(n){switch(L$(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function U$(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const F$=/^data:image\/svg\+xml/,z$=/\.svg((\?|#).*)?$/;function A1(n){return n&&(F$.test(n)||z$.test(n))}function V$(n,e){if(A1(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return VO(n,e)}function VO(n,e){if(A1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function qO(n,e,t){const r=V$(n,t),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await q$(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function q$(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const $$={};let bk=!0;async function H$(n,e,t){let r;A1(t)?r=await qO(n,e,t):r=VO(n,t);const i=e&&e.imagebitmap;return await W$(r,i)}async function W$(n,e=null){if((X$(e)||!bk)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),bk=!1}return await createImageBitmap(n)}function X$(n){for(const e in n||$$)return!1;return!0}function Y$(n){return!Q$(n,"ftyp",4)||(n[8]&96)===0?null:G$(n)}function G$(n){switch(K$(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function K$(n,e,t){return String.fromCharCode(...n.slice(e,t))}function Z$(n){return[...n].map(e=>e.charCodeAt(0))}function Q$(n,e,t=0){const r=Z$(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const zr=!1,Hl=!0;function $O(n){const e=Ac(n);return eH(e)||rH(e)||tH(e)||nH(e)||J$(e)}function J$(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=Y$(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function eH(n){const e=Ac(n);return e.byteLength>=24&&e.getUint32(0,zr)===2303741511?{mimeType:"image/png",width:e.getUint32(16,zr),height:e.getUint32(20,zr)}:null}function tH(n){const e=Ac(n);return e.byteLength>=10&&e.getUint32(0,zr)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Hl),height:e.getUint16(8,Hl)}:null}function nH(n){const e=Ac(n);return e.byteLength>=14&&e.getUint16(0,zr)===16973&&e.getUint32(2,Hl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Hl),height:e.getUint32(22,Hl)}:null}function rH(n){const e=Ac(n);if(!(e.byteLength>=3&&e.getUint16(0,zr)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=iH();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,zr);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,zr),width:e.getUint16(s+7,zr)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,zr)}return null}function iH(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ac(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function sH(n,e){var i;const{mimeType:t}=$O(n)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Of(r),await r(n,t)}async function aH(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},o=oH(i);let l;switch(o){case"imagebitmap":l=await H$(n,e,s);break;case"image":l=await qO(n,e,s);break;case"data":l=await sH(n);break;default:Of(!1)}return i==="data"&&(l=B$(l)),l}function oH(n){switch(n){case"auto":case"data":return j$();default:return D$(n),n}}const lH=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],cH=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],uH={image:{type:"auto",decode:!0}},fH={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:I$,mimeTypes:cH,extensions:lH,parse:aH,tests:[n=>!!$O(new DataView(n))],options:uH},gt=new Sc({id:"deck"});let K0={};function dH(n){K0=n}function Tn(n,e,t,r){gt.level>0&&K0[n]&&K0[n].call(null,e,t,r)}function hH(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const pH={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:hH,parseTextSync:JSON.parse};function gH(){const n="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(gt.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:gt,_registerLoggers:dH},o$([pH,[fH,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const mH=gH();function R1(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Qb={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function _H(n){const e={};for(const[t,r]of Object.entries(n))e[t]=vH(r);return e}function vH(n){let e=xk(n);if(e!=="object")return{value:n,...Qb[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Qb[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=xk(n.value),{...n,...Qb[e],type:e}):{type:"object",value:null};throw new Error("props")}function xk(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const yH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,bH=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,xH={vertex:yH,fragment:bH},wk=/void\s+main\s*\([^)]*\)\s*\{\n?/,Tk=/}\n?[^{}]*$/,Jb=[],_f="__LUMA_INJECT_DECLARATIONS__";function wH(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const i=TH(t);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function TH(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Lf(n,e,t,r=!1){const i=e==="vertex";for(const s in t){const o=t[s];o.sort((u,d)=>u.order-d.order),Jb.length=o.length;for(let u=0,d=o.length;u<d;++u)Jb[u]=o[u].injection;const l=`${Jb.join(`
`)}
`;switch(s){case"vs:#decl":i&&(n=n.replace(_f,l));break;case"vs:#main-start":i&&(n=n.replace(wk,u=>u+l));break;case"vs:#main-end":i&&(n=n.replace(Tk,u=>l+u));break;case"fs:#decl":i||(n=n.replace(_f,l));break;case"fs:#main-start":i||(n=n.replace(wk,u=>u+l));break;case"fs:#main-end":i||(n=n.replace(Tk,u=>l+u));break;default:n=n.replace(s,u=>u+l)}}return n=n.replace(_f,""),r&&(n=n.replace(/\}\s*$/,s=>s+xH[e])),n}function Bf(n){n.map(e=>SH(e))}function SH(n){if(n.instance)return;Bf(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,i={normalizedInjections:wH(r),parsedDeprecations:EH(t)};e&&(i.propValidators=_H(e)),n.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const d=u==null?void 0:u.value;return d&&(o[l]=d),o},{})),n.defaultUniforms={...n.defaultUniforms,...s}}function HO(n,e,t){var r;(r=n.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function EH(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function C1(n){Bf(n);const e={},t={};WO({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return Bf(r),r}function WO(n){const{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&WO({modules:s.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function AH(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function RH(n,e){var r;if(Number(((r=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=Sk(n,CH),n;case"fragment":return n=Sk(n,NH),n;default:throw new Error(e)}}const XO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],CH=[...XO,[Z0("attribute"),"in $1"],[Z0("varying"),"out $1"]],NH=[...XO,[Z0("varying"),"in $1"]];function Sk(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function Z0(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function YO(n,e){let t="";for(const r in n){const i=n[r];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)t+=`  ${o.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function GO(n){const e={vertex:{},fragment:{}};for(const t of n){let r,i;typeof t!="string"?(r=t,i=r.hook):(r={},i=t),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function kH(n,e){return{name:MH(n,e),language:"glsl",version:IH(n)}}function MH(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function IH(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const KO=`

${_f}
`,OH=`precision highp float;
`;function PH(n){const e=C1(n.modules||[]);return{source:jH(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:ZO(e)}}function DH(n){const{vs:e,fs:t}=n,r=C1(n.modules||[]);return{vs:Ek(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:Ek(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:ZO(r)}}function jH(n,e){var w;const{source:t,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;R1(typeof t=="string","shader source must be a string");const u=t;let d="";const h=GO(s),g={},_={},y={};for(const x in o){const S=typeof o[x]=="string"?{injection:o[x],order:0}:o[x],A=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(A){const R=A[2],E=A[3];R?E==="decl"?_[x]=[S]:y[x]=[S]:g[x]=[S]}else y[x]=[S]}const T=i;for(const x of T){l&&HO(x,u,l);const S=QO(x,"wgsl");d+=S;const A=((w=x.injections)==null?void 0:w[r])||{};for(const R in A){const E=/^(v|f)s:#([\w-]+)$/.exec(R);if(E){const O=E[2]==="decl"?_:y;O[R]=O[R]||[],O[R].push(A[R])}else g[R]=g[R]||[],g[R].push(A[R])}}return d+=KO,d=Lf(d,r,_),d+=YO(h[r],g),d+=u,d=Lf(d,r,y),d}function Ek(n,e){var D;const{id:t,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:d={},prologue:h=!0,log:g}=e;R1(typeof r=="string","shader source must be a string");const _=s==="glsl"?kH(r).version:-1,y=n.shaderLanguageVersion,T=_===100?"#version 100":"#version 300 es",x=r.split(`
`).slice(1).join(`
`),S={};o.forEach(M=>{Object.assign(S,M.defines)}),Object.assign(S,l);let A="";switch(s){case"wgsl":break;case"glsl":A=h?`${T}

// ----- PROLOGUE -------------------------
${LH({id:t,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${AH(n)}
${i==="fragment"?OH:""}

// ----- APPLICATION DEFINES -------------------------

${BH(S)}

`:`${T}
`;break}const R=GO(u),E={},C={},O={};for(const M in d){const P=typeof d[M]=="string"?{injection:d[M],order:0}:d[M],k=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(k){const V=k[2],X=k[3];V?X==="decl"?C[M]=[P]:O[M]=[P]:E[M]=[P]}else O[M]=[P]}for(const M of o){g&&HO(M,x,g);const P=QO(M,i);A+=P;const k=((D=M.instance)==null?void 0:D.normalizedInjections[i])||{};for(const V in k){const X=/^(v|f)s:#([\w-]+)$/.exec(V);if(X){const $=X[2]==="decl"?C:O;$[V]=$[V]||[],$[V].push(k[V])}else E[V]=E[V]||[],E[V].push(k[V])}}return A+="// ----- MAIN SHADER SOURCE -------------------------",A+=KO,A=Lf(A,i,C),A+=YO(R[i],E),A+=x,A=Lf(A,i,O),s==="glsl"&&_!==y&&(A=RH(A,i)),A.trim()}function ZO(n){return function(t){var i;const r={};for(const s of n){const o=(i=s.getUniforms)==null?void 0:i.call(s,t,r);Object.assign(r,o)}return r}}function LH(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function BH(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function QO(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:R1(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${t}
`,i}const UH=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,FH=/^\s*\#\s*endif\s*$/;function zH(n,e){var o;const t=n.split(`
`),r=[];let i=!0,s=null;for(const l of t){const u=l.match(UH),d=l.match(FH);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):d?i=!0:i&&r.push(l)}return r.join(`
`)}const Rs=class Rs{constructor(){j(this,"_hookFunctions",[]);j(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Rs.defaultShaderAssembler=Rs.defaultShaderAssembler||new Rs,Rs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=PH({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?zH(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...DH({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;t[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(t[i++]=l,r[u]=!0)}return t.length=i,Bf(t),t}};j(Rs,"defaultShaderAssembler");let Uf=Rs;const VH=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,qH=`#version 300 es
${VH}`;function $H(n){const{input:e,inputChannels:t,output:r}={};if(!e)return qH;if(!t)throw new Error("inputChannels");const i=HH(t),s=WH(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function HH(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function WH(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class XH{constructor(){j(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Zd({id:e})),this.stats.get(e)}}const JO=new XH,be=new Sc({id:"luma.gl"}),e0={};function Jd(n="id"){e0[n]=e0[n]||1;const e=e0[n]++;return`${n}-${e}`}var I0;let lt=(I0=class{constructor(e,t,r){j(this,"id");j(this,"props");j(this,"userData",{});j(this,"_device");j(this,"destroyed",!1);j(this,"allocatedBytes",0);j(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=YH(t,r);const i=this.props.id!=="undefined"?this.props.id:Jd(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},j(I0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),I0);function YH(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}const on=class on extends lt{constructor(t,r){const i={...r};(r.usage||0)&on.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,on.defaultProps);j(this,"usage");j(this,"indexType");j(this,"updateTimestamp");j(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,i){const s=ArrayBuffer.isView(t)?t.buffer:t,o=Math.min(t?t.byteLength:i,on.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};j(on,"defaultProps",{...lt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),j(on,"MAP_READ",1),j(on,"MAP_WRITE",2),j(on,"COPY_SRC",4),j(on,"COPY_DST",8),j(on,"INDEX",16),j(on,"VERTEX",32),j(on,"UNIFORM",64),j(on,"STORAGE",128),j(on,"INDIRECT",256),j(on,"QUERY_RESOLVE",512),j(on,"DEBUG_DATA_MAX_LENGTH",32);let xt=on;function eP(n){const e=Ak[n],t=GH(e),r=n.includes("norm"),i=!r&&!n.startsWith("float"),s=n.startsWith("s");return{dataType:Ak[n],byteLength:t,integer:i,signed:s,normalized:r}}function GH(n){return KH[n]}const Ak={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},KH={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},gn="texture-compression-bc",ot="texture-compression-astc",Lr="texture-compression-etc2",ZH="texture-compression-etc1-webgl",Gu="texture-compression-pvrtc-webgl",t0="texture-compression-atc-webgl",Ku="float32-renderable-webgl",n0="float16-renderable-webgl",QH="rgb9e5ufloat-renderable-webgl",r0="snorm8-renderable-webgl",Rl="norm16-renderable-webgl",i0="snorm16-renderable-webgl",Zu="float32-filterable",Rk="float16-filterable-webgl";function tP(n){const e=JH[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const JH={r8unorm:{},r8snorm:{render:r0},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:r0},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:n0,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Rl},"r16snorm-webgl":{f:i0},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:r0},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:n0,filter:Rk},"rg16unorm-webgl":{render:Rl},"rg16snorm-webgl":{render:i0},r32uint:{},r32sint:{},r32float:{render:Ku,filter:Zu},rgb9e5ufloat:{channels:"rgb",packed:!0,render:QH},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Ku},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Rl},"rgb16snorm-webgl":{f:Rl},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Zu},rgba16uint:{},rgba16sint:{},rgba16float:{render:n0,filter:Rk},"rgba16unorm-webgl":{render:Rl},"rgba16snorm-webgl":{render:i0},"rgb32float-webgl":{render:Ku,filter:Zu},rgba32uint:{},rgba32sint:{},rgba32float:{render:Ku,filter:Zu},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:gn},"bc1-rgb-unorm-srgb-webgl":{f:gn},"bc1-rgba-unorm":{f:gn},"bc1-rgba-unorm-srgb":{f:gn},"bc2-rgba-unorm":{f:gn},"bc2-rgba-unorm-srgb":{f:gn},"bc3-rgba-unorm":{f:gn},"bc3-rgba-unorm-srgb":{f:gn},"bc4-r-unorm":{f:gn},"bc4-r-snorm":{f:gn},"bc5-rg-unorm":{f:gn},"bc5-rg-snorm":{f:gn},"bc6h-rgb-ufloat":{f:gn},"bc6h-rgb-float":{f:gn},"bc7-rgba-unorm":{f:gn},"bc7-rgba-unorm-srgb":{f:gn},"etc2-rgb8unorm":{f:Lr},"etc2-rgb8unorm-srgb":{f:Lr},"etc2-rgb8a1unorm":{f:Lr},"etc2-rgb8a1unorm-srgb":{f:Lr},"etc2-rgba8unorm":{f:Lr},"etc2-rgba8unorm-srgb":{f:Lr},"eac-r11unorm":{f:Lr},"eac-r11snorm":{f:Lr},"eac-rg11unorm":{f:Lr},"eac-rg11snorm":{f:Lr},"astc-4x4-unorm":{f:ot},"astc-4x4-unorm-srgb":{f:ot},"astc-5x4-unorm":{f:ot},"astc-5x4-unorm-srgb":{f:ot},"astc-5x5-unorm":{f:ot},"astc-5x5-unorm-srgb":{f:ot},"astc-6x5-unorm":{f:ot},"astc-6x5-unorm-srgb":{f:ot},"astc-6x6-unorm":{f:ot},"astc-6x6-unorm-srgb":{f:ot},"astc-8x5-unorm":{f:ot},"astc-8x5-unorm-srgb":{f:ot},"astc-8x6-unorm":{f:ot},"astc-8x6-unorm-srgb":{f:ot},"astc-8x8-unorm":{f:ot},"astc-8x8-unorm-srgb":{f:ot},"astc-10x5-unorm":{f:ot},"astc-10x5-unorm-srgb":{f:ot},"astc-10x6-unorm":{f:ot},"astc-10x6-unorm-srgb":{f:ot},"astc-10x8-unorm":{f:ot},"astc-10x8-unorm-srgb":{f:ot},"astc-10x10-unorm":{f:ot},"astc-10x10-unorm-srgb":{f:ot},"astc-12x10-unorm":{f:ot},"astc-12x10-unorm-srgb":{f:ot},"astc-12x12-unorm":{f:ot},"astc-12x12-unorm-srgb":{f:ot},"pvrtc-rgb4unorm-webgl":{f:Gu},"pvrtc-rgba4unorm-webgl":{f:Gu},"pvrtc-rbg2unorm-webgl":{f:Gu},"pvrtc-rgba2unorm-webgl":{f:Gu},"etc1-rbg-unorm-webgl":{f:ZH},"atc-rgb-unorm-webgl":{f:t0},"atc-rgba-unorm-webgl":{f:t0},"atc-rgbai-unorm-webgl":{f:t0}},eW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],tW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function nP(n){return eW.some(e=>n.startsWith(e))}function N1(n){let e=nW(n);if(nP(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=rW(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=tW.exec(n);if(t){const[,r,i,s,o,l]=t,u=`${s}${i}`,d=eP(u),h=d.byteLength*8,g=r.length,_=[h,g>=2?h:0,g>=3?h:0,g>=4?h:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:g,channels:r,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:_,bytesPerPixel:d.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function nW(n){var s;const e=tP(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function rW(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,i]=t;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function iW(n){const e=tP(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=N1(n),i=n.startsWith("depth")||n.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return t.render&&(t.render=!s),t.filter&&(t.filter=!i&&!s&&!o&&!l),t}class sW{}class aW{constructor(e=[],t){j(this,"features");j(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const fd=class fd{constructor(e){j(this,"id");j(this,"props");j(this,"userData",{});j(this,"statsManager",JO);j(this,"timestamp",0);j(this,"_reused",!1);j(this,"_lumaData",{});this.props={...fd.defaultProps,...e},this.id=this.props.id||Jd(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=iW(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(t.create),s={format:e,create:i,render:i&&r(t.render),filter:i&&r(t.filter),blend:i&&r(t.blend),store:i&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return nP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&xt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":be.warn("indices buffer content must be of integer type")()),t}};j(fd,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>be.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:be.get("debug")||void 0,debugShaders:be.get("debug-shaders")||void 0,debugFramebuffers:!!be.get("debug-framebuffers"),debugWebGL:!!be.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ns=fd;const oW=Gs()&&typeof document<"u",lW=()=>oW&&document.readyState==="complete",cW="set luma.log.level=1 (or higher) to trace rendering",Ck="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Gi=class Gi{constructor(){j(this,"stats",JO);j(this,"log",be);j(this,"VERSION","9.1.9");j(this,"spector");j(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw be.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),be.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");be.error("This version of luma.gl has already been initialized")()}be.log(1,`${this.VERSION} - ${cW}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const t=this.getAdapterMap(e);return(i=(r=t.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=t.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Gi.defaultProps,e)}async createDevice(e={}){var l;e={...Gi.defaultProps,...e},e.waitForPageLoad&&await Gi.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||t).get(r),o=await((l=s==null?void 0:s.create)==null?void 0:l.call(s,e));if(o)return o;throw new Error(Ck)}async attachDevice(e){var o;const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Gi.pageLoaded,e.handle===null&&(r="unknown");const i=t.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(Ck)}enforceWebGL2(e=!0,t=[]){var s;const i=this.getAdapterMap(t).get("webgl");i||be.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){be.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};j(Gi,"defaultProps",{...ns.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),j(Gi,"pageLoaded",uW().then(()=>{be.probe(2,"DOM is loaded")()}));let Q0=Gi;const J0=new Q0;function uW(){return lW()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class fW{}const dd=class dd{constructor(e){j(this,"id");j(this,"props");j(this,"canvas");j(this,"htmlCanvas");j(this,"offscreenCanvas");j(this,"type");j(this,"width",1);j(this,"height",1);j(this,"resizeObserver");j(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...dd.defaultProps,...e},e=this.props,!Gs()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=hW(e.canvas):this.canvas=e.canvas;else{const t=pW(e),r=dW((e==null?void 0:e.container)||null);r.insertBefore(t,r.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?t/r:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return gW(e,r,i,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!i)&&(be.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[h,g]=this.getDrawingBufferSize();(h!==l||g!==u)&&(o=Math.min(h/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),be.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};j(dd,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let ex=dd;function dW(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function hW(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function pW(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=Jd("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function gW(n,e,t,r,i){const s=n,o=Nk(s[0],e,t);let l=kk(s[1],e,r,i),u=Nk(s[0]+1,e,t);const d=u===t-1?u:u-1;u=kk(s[1]+1,e,r,i);let h;return i?(u=u===0?u:u+1,h=l,l=u):h=u===r-1?u:u-1,{x:o,y:l,width:Math.max(d-o+1,1),height:Math.max(h-l+1,1)}}function Nk(n,e,t){return Math.min(Math.round(n*e),t-1)}function kk(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const ln=class ln extends lt{constructor(t,r){r=ln.normalizeProps(t,r);super(t,r,ln.defaultProps);j(this,"dimension");j(this,"format");j(this,"width");j(this,"height");j(this,"depth");j(this,"mipLevels");j(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=ln.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?ln.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t==null?void 0:t.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return ln.getTextureDataSize(t[0]);if(ln.isExternalImage(t))return ln.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){var u,d;const i={...r},s=((d=(u=t==null?void 0:t.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:o,height:l}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}};j(ln,"COPY_SRC",1),j(ln,"COPY_DST",2),j(ln,"TEXTURE",4),j(ln,"STORAGE",8),j(ln,"RENDER_ATTACHMENT",16),j(ln,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),j(ln,"defaultProps",{...lt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),j(ln,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let kt=ln;const hd=class hd extends lt{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,hd.defaultProps)}};j(hd,"defaultProps",{...lt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Ff=hd;function mW(n,e,t){let r="";const i=e.split(/\r?\n/),s=n.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=rP(i[l-1],l,t);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=Mk(u,i,u.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const l of n)r+=Mk(l,i,l.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function Mk(n,e,t,r){if(r!=null&&r.inlineSource){const s=_W(e,t),o=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${s}${o}${n.type.toUpperCase()}: ${n.message}

`}const i=n.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function _W(n,e,t){let r="";for(let i=e-2;i<=e;i++){const s=n[i-1];s!==void 0&&(r+=rP(s,e,t))}return r}function rP(n,e,t){const r=t!=null&&t.html?yW(n):n;return`${vW(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function vW(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function yW(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const pd=class pd extends lt{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:bW(r),...r},pd.defaultProps);j(this,"stage");j(this,"source");j(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(t){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=iP(this.source),i=`${this.stage} ${r}`;let s=mW(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};j(pd,"defaultProps",{...lt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let zf=pd;function bW(n){return iP(n.source)||n.id||Jd(`unnamed ${n.stage}-shader`)}function iP(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}const Ql=class Ql extends lt{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Ql.normalizeProps(e,t),super(e,t,Ql.defaultProps)}static normalizeProps(e,t){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...t,...r}}};j(Ql,"defaultProps",{...lt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Vf=Ql;const gd=class gd extends lt{constructor(t,r={}){super(t,r,gd.defaultProps);j(this,"width");j(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(s=>s.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(t){let r=!t;if(t){const[i,s]=Array.isArray(t)?t:[t.width,t.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(be.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof kt?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof kt?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:kt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:kt.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};j(gd,"defaultProps",{...lt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let qf=gd;const md=class md extends lt{constructor(t,r){super(t,r,md.defaultProps);j(this,"shaderLayout");j(this,"bufferLayout");j(this,"linkStatus","pending");j(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};j(md,"defaultProps",{...lt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let oo=md;const Tr=class Tr extends lt{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Tr.normalizeProps(e,t),super(e,t,Tr.defaultProps)}static normalizeProps(e,t){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...t}}};j(Tr,"defaultClearColor",[0,0,0,1]),j(Tr,"defaultClearDepth",1),j(Tr,"defaultClearStencil",0),j(Tr,"defaultProps",{...lt.defaultProps,framebuffer:null,parameters:void 0,clearColor:Tr.defaultClearColor,clearColors:void 0,clearDepth:Tr.defaultClearDepth,clearStencil:Tr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let tx=Tr;const _d=class _d extends lt{constructor(t,r){super(t,r,_d.defaultProps);j(this,"hash","");j(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};j(_d,"defaultProps",{...lt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let $f=_d;const vd=class vd extends lt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,vd.defaultProps)}};j(vd,"defaultProps",{...lt.defaultProps,measureExecutionTime:void 0});let nx=vd;const yd=class yd extends lt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,yd.defaultProps)}};j(yd,"defaultProps",{...lt.defaultProps});let rx=yd;function xW(n){const[e,t]=TW[n],r=e==="i32"||e==="u32",i=e!=="u32",s=SW[e]*t,o=wW(e,t);return{dataType:e,components:t,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function wW(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const TW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},SW={f32:4,f16:2,i32:4,u32:4};function sP(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),i=t,s=r?parseInt(r):1,o=eP(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function aP(n,e){const t={};for(const r of n.attributes){const i=AW(n,e,r.name);i&&(t[r.name]=i)}return t}function EW(n,e,t=16){const r=aP(n,e),i=new Array(t).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function AW(n,e,t){const r=RW(n,t),i=CW(e,t);if(!r)return null;const s=xW(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,l=sP(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function RW(n,e){const t=n.attributes.find(r=>r.name===e);return t||be.warn(`shader layout attribute "${e}" not present in shader`),t||null}function CW(n,e){NW(n);let t=kW(n,e);return t||(t=MW(n,e),t)?t:(be.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function NW(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&be.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function kW(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function MW(n,e){var t;for(const r of n){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const l=sP(o.format);i+=l.byteLength}const s=(t=r.attributes)==null?void 0:t.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const bd=class bd extends lt{constructor(t,r){super(t,r,bd.defaultProps);j(this,"maxVertexAttributes");j(this,"attributeInfos");j(this,"indexBuffer",null);j(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=EW(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};j(bd,"defaultProps",{...lt.defaultProps,renderPipeline:null});let ix=bd;const xd=class xd extends lt{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,xd.defaultProps)}};j(xd,"defaultProps",{...lt.defaultProps,layout:void 0,buffers:{}});let sx=xd;const wd=class wd extends lt{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,wd.defaultProps)}};j(wd,"defaultProps",{...lt.defaultProps,type:void 0,count:void 0});let ax=wd;const IW={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function OW(n){return IW[n]}function PW(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let Qu;function oP(n){return(!Qu||Qu.byteLength<n)&&(Qu=new ArrayBuffer(n)),Qu}function DW(n,e){const t=oP(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function jW(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Hf(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":jW(n)}const Ik=1024;class LW{constructor(e){j(this,"layout",{});j(this,"byteLength");let t=0;for(const[i,s]of Object.entries(e)){const o=OW(s),{type:l,components:u}=o;t=PW(t,u);const d=t;t+=u,this.layout[i]={type:l,size:u,offset:d}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,Ik)}getData(e){const t=Math.max(this.byteLength,Ik),r=oP(t),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){be.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:h}=l,g=i[u];if(d===1){if(typeof o!="number"&&typeof o!="boolean"){be.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[h]=Number(o)}else{if(!Hf(o)){be.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function BW(n,e,t=16){if(n!==e)return!1;const r=n,i=e;if(!Hf(r))return!1;if(Hf(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function UW(n){return Hf(n)?n.slice():n}class FW{constructor(e){j(this,"name");j(this,"uniforms",{});j(this,"modifiedUniforms",{});j(this,"modified",!0);j(this,"bindingLayout",{});j(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){BW(this.uniforms[e],t)||(this.uniforms[e]=UW(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class zW{constructor(e){j(this,"uniformBlocks",new Map);j(this,"uniformBufferLayouts",new Map);j(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const i=t,s=new LW(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new FW({name:t});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[r,i]of Object.entries(e))(t=this.uniformBlocks.get(r))==null||t.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var r,i;const t=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:xt.UNIFORM|xt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return s.write(o),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:xt.UNIFORM|xt.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&be.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(t!=null&&t.needsRedraw)){i||(i=t.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const l=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();be.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return i}}function lP(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function cP(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function VW(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=lP(n);if(i==="uint8"&&t&&r===1)return"unorm8-webgl";if(i==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class s0{constructor(e){j(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const i of t){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&be.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function qW(n,e){const t=Object.fromEntries(n.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(h=>h.attribute):[i.name],l=s.attributes?s.attributes.map(h=>h.attribute):[s.name],u=Math.min(...o.map(h=>t[h])),d=Math.min(...l.map(h=>t[h]));return u-d}),r}class cr{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Ok{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class es extends cr{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class rs extends cr{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class ox extends cr{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Bs extends cr{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Xi;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Xi||(Xi={}));class Ju{constructor(e,t,r,i,s,o,l){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class $W{constructor(e,t){this.name=e,this.type=t}}class HW{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class Pk{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class WW{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class XW{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class YW{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class GW{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const uP=new Float32Array(1),KW=new Int32Array(uP.buffer),mn=new Uint16Array(1);function ZW(n){uP[0]=n;const e=KW[0],t=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return mn[0]=t<<15|31744|(i!==0?512:0),mn[0];if(r===0){if(i===0)return mn[0]=t<<15,mn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),mn[0]=t<<15|r<<10|i>>13,mn[0]):(mn[0]=t<<15,mn[0])}return r=r-127+15,r>=31?(mn[0]=t<<15|31744,mn[0]):r<=0?r<-10?(mn[0]=t<<15,mn[0]):(i=(8388608|i)>>1-r,mn[0]=t<<15|i>>13,mn[0]):(i>>=13,mn[0]=t<<15|r<<10|i,mn[0])}const k1=new Uint32Array(1),fP=new Float32Array(k1.buffer,0,1);function Dk(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return k1[0]=e,fP[0]}function QW(n,e,t,r,i,s,o,l,u){const d=r*(o>>=i)*(s>>=i)+t*o+e*l;switch(u){case"r8unorm":return[Ke(n,d,"8unorm",1)[0]];case"r8snorm":return[Ke(n,d,"8snorm",1)[0]];case"r8uint":return[Ke(n,d,"8uint",1)[0]];case"r8sint":return[Ke(n,d,"8sint",1)[0]];case"rg8unorm":{const h=Ke(n,d,"8unorm",2);return[h[0],h[1]]}case"rg8snorm":{const h=Ke(n,d,"8snorm",2);return[h[0],h[1]]}case"rg8uint":{const h=Ke(n,d,"8uint",2);return[h[0],h[1]]}case"rg8sint":{const h=Ke(n,d,"8sint",2);return[h[0],h[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const h=Ke(n,d,"8unorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8snorm":{const h=Ke(n,d,"8snorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8uint":{const h=Ke(n,d,"8uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba8sint":{const h=Ke(n,d,"8sint",4);return[h[0],h[1],h[2],h[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const h=Ke(n,d,"8unorm",4);return[h[2],h[1],h[0],h[3]]}case"r16uint":return[Ke(n,d,"16uint",1)[0]];case"r16sint":return[Ke(n,d,"16sint",1)[0]];case"r16float":return[Ke(n,d,"16float",1)[0]];case"rg16uint":{const h=Ke(n,d,"16uint",2);return[h[0],h[1]]}case"rg16sint":{const h=Ke(n,d,"16sint",2);return[h[0],h[1]]}case"rg16float":{const h=Ke(n,d,"16float",2);return[h[0],h[1]]}case"rgba16uint":{const h=Ke(n,d,"16uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16sint":{const h=Ke(n,d,"16sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16float":{const h=Ke(n,d,"16float",4);return[h[0],h[1],h[2],h[3]]}case"r32uint":return[Ke(n,d,"32uint",1)[0]];case"r32sint":return[Ke(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ke(n,d,"32float",1)[0]];case"rg32uint":{const h=Ke(n,d,"32uint",2);return[h[0],h[1]]}case"rg32sint":{const h=Ke(n,d,"32sint",2);return[h[0],h[1]]}case"rg32float":{const h=Ke(n,d,"32float",2);return[h[0],h[1]]}case"rgba32uint":{const h=Ke(n,d,"32uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32sint":{const h=Ke(n,d,"32sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32float":{const h=Ke(n,d,"32float",4);return[h[0],h[1],h[2],h[3]]}case"rg11b10ufloat":{const h=new Uint32Array(n.buffer,d,1)[0],g=(4192256&h)>>11,_=(4290772992&h)>>22;return[Dk(2047&h),Dk(g),function(y){const T=112+(y>>5&31)<<23|(31&y)<<18;return k1[0]=T,fP[0]}(_),1]}}return null}function Ke(n,e,t,r){const i=[0,0,0,0];for(let d=0;d<r;++d)switch(t){case"8unorm":i[d]=n[e]/255,e++;break;case"8snorm":i[d]=n[e]/255*2-1,e++;break;case"8uint":i[d]=n[e],e++;break;case"8sint":i[d]=n[e]-127,e++;break;case"16uint":i[d]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":i[d]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(s=n[e]|n[e+1]<<8,o=void 0,l=void 0,u=void 0,o=(32768&s)>>15,u=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):l==31?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+u/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(n.buffer,e,1)[0],e+=4}var s,o,l,u;return i}function et(n,e,t,r,i){for(let s=0;s<r;++s)switch(t){case"8unorm":n[e]=255*i[s],e++;break;case"8snorm":n[e]=.5*(i[s]+1)*255,e++;break;case"8uint":n[e]=i[s],e++;break;case"8sint":n[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=ZW(i[s]);new Uint16Array(n.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=i[s],e+=4}return i}const a0={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class gr{constructor(){this.id=gr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Wf.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(Xf.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}gr._id=0;class Wf extends gr{}Wf.instance=new Wf;class Xf extends gr{}Xf.instance=new Xf;const dP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Tt extends gr{constructor(){super()}}class lc extends Tt{constructor(e,t,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class JW extends Tt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class hP extends Tt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class lx extends Tt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class pP extends Tt{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class hi extends Tt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class M1 extends Tt{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Wl extends Tt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class vf extends Tt{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Ya,Bl,le,re;(n=>{n.increment="++",n.decrement="--"})(Ya||(Ya={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Ya||(Ya={}));class gP extends Tt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Bl||(Bl={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Bl||(Bl={}));class mP extends Tt{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class I1 extends Tt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return dP.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class _P extends Tt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class vP extends Tt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class yP extends Tt{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class bP extends Tt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class eX extends Tt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class tX extends Tt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class xP extends Tt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class O1 extends Tt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class nX extends Tt{constructor(){super()}get astNodeType(){return"discard"}}class wP extends Tt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class TP extends Tt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _e extends Tt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=_e._priority.get(t.name);_e._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?_e.i32:t}getTypeName(){return this.name}}_e.x32=new _e("x32"),_e.f32=new _e("f32"),_e.i32=new _e("i32"),_e.u32=new _e("u32"),_e.f16=new _e("f16"),_e.bool=new _e("bool"),_e.void=new _e("void"),_e._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class jk extends _e{constructor(e){super(e)}}class fi extends _e{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class oe extends _e{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}oe.vec2f=new oe("vec2",_e.f32,null),oe.vec3f=new oe("vec3",_e.f32,null),oe.vec4f=new oe("vec4",_e.f32,null),oe.vec2i=new oe("vec2",_e.i32,null),oe.vec3i=new oe("vec3",_e.i32,null),oe.vec4i=new oe("vec4",_e.i32,null),oe.vec2u=new oe("vec2",_e.u32,null),oe.vec3u=new oe("vec3",_e.u32,null),oe.vec4u=new oe("vec4",_e.u32,null),oe.vec2h=new oe("vec2",_e.f16,null),oe.vec3h=new oe("vec3",_e.f16,null),oe.vec4h=new oe("vec4",_e.f16,null),oe.vec2b=new oe("vec2",_e.bool,null),oe.vec3b=new oe("vec3",_e.bool,null),oe.vec4b=new oe("vec4",_e.bool,null),oe.mat2x2f=new oe("mat2x2",_e.f32,null),oe.mat2x3f=new oe("mat2x3",_e.f32,null),oe.mat2x4f=new oe("mat2x4",_e.f32,null),oe.mat3x2f=new oe("mat3x2",_e.f32,null),oe.mat3x3f=new oe("mat3x3",_e.f32,null),oe.mat3x4f=new oe("mat3x4",_e.f32,null),oe.mat4x2f=new oe("mat4x2",_e.f32,null),oe.mat4x3f=new oe("mat4x3",_e.f32,null),oe.mat4x4f=new oe("mat4x4",_e.f32,null),oe.mat2x2h=new oe("mat2x2",_e.f16,null),oe.mat2x3h=new oe("mat2x3",_e.f16,null),oe.mat2x4h=new oe("mat2x4",_e.f16,null),oe.mat3x2h=new oe("mat3x2",_e.f16,null),oe.mat3x3h=new oe("mat3x3",_e.f16,null),oe.mat3x4h=new oe("mat3x4",_e.f16,null),oe.mat4x2h=new oe("mat4x2",_e.f16,null),oe.mat4x3h=new oe("mat4x3",_e.f16,null),oe.mat4x4h=new oe("mat4x4",_e.f16,null),oe.mat2x2i=new oe("mat2x2",_e.i32,null),oe.mat2x3i=new oe("mat2x3",_e.i32,null),oe.mat2x4i=new oe("mat2x4",_e.i32,null),oe.mat3x2i=new oe("mat3x2",_e.i32,null),oe.mat3x3i=new oe("mat3x3",_e.i32,null),oe.mat3x4i=new oe("mat3x4",_e.i32,null),oe.mat4x2i=new oe("mat4x2",_e.i32,null),oe.mat4x3i=new oe("mat4x3",_e.i32,null),oe.mat4x4i=new oe("mat4x4",_e.i32,null),oe.mat2x2u=new oe("mat2x2",_e.u32,null),oe.mat2x3u=new oe("mat2x3",_e.u32,null),oe.mat2x4u=new oe("mat2x4",_e.u32,null),oe.mat3x2u=new oe("mat3x2",_e.u32,null),oe.mat3x3u=new oe("mat3x3",_e.u32,null),oe.mat3x4u=new oe("mat3x4",_e.u32,null),oe.mat4x2u=new oe("mat4x2",_e.u32,null),oe.mat4x3u=new oe("mat4x3",_e.u32,null),oe.mat4x4u=new oe("mat4x4",_e.u32,null);class yf extends _e{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Xl extends _e{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Ul extends _e{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Mr extends gr{constructor(){super(),this.postfix=null}}class Us extends Mr{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Fr extends Mr{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class P1 extends Mr{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return dP.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Xn extends Mr{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class SP extends Mr{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Gt extends Mr{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof ne}get isVector(){return this.value instanceof W||this.value instanceof Ie}get scalarValue(){return this.value instanceof ne?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof W||this.value instanceof Ie?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class EP extends Mr{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class lo extends Mr{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class AP extends Mr{constructor(){super()}}class Vt extends AP{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class wr extends AP{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?_e.f32:e.name==="u32"||t.name==="u32"?_e.u32:_e.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class RP extends gr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class bf extends Mr{constructor(){super()}get astNodeType(){return"default"}}class CP extends RP{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class NP extends RP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Lk extends gr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class rX extends gr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Bk extends gr{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class kP extends gr{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class dr{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=dr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}dr._id=0;class cx extends dr{constructor(){super(new cr("void",null),null)}toString(){return"void"}}cx.void=new cx;class qa extends dr{constructor(e){super(new ox("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class ne extends dr{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new ne(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ne(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ne(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof ne))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function iX(n,e,t){const r=e.length;return r===2?t==="f32"?new W(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new W(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new W(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new W(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new W(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new W(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new W(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new W(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new W(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new W(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new W(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new W(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class W extends dr{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new W(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new W(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new W(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof Us?console.error("TODO: Set vector postfix"):t instanceof W?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Bs)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof lo){const o=t.index;let l=-1;if(o instanceof Gt){if(!(o.value instanceof ne))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof ne))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ne(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ne(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ne(u,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof Us))return console.error("GetSubData: Unknown postfix",t),null;{const o=t.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ne(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ne(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new ne(d,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=iX(e,l,i.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ie extends dr{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Ie(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof Us?console.error("TODO: Set matrix postfix"):t instanceof Ie?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Bs)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof lo){const s=t.index;let o=-1;if(s instanceof Gt){if(!(s.value instanceof ne))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const d=e.evalExpression(s,r);if(!(d instanceof ne))return console.error("GetDataValue: Unknown index type",s),null;o=d.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new W(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return t.postfix?u.getSubData(e,t.postfix,r):u}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Mt extends dr{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Mt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof lo)if(o instanceof rs){const l=r.index;if(l instanceof Gt){if(!(l.value instanceof ne))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof ne))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Us))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof es){let u=!1;for(const d of o.members)if(d.name===l){s+=d.offset,o=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof cr){const u=o.getTypeName();let d=0;if(l==="x"||l==="r")d=0;else if(l==="y"||l==="g")d=1;else if(l==="z"||l==="b")d=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);d=3}if(!(t instanceof ne))return void console.error("SetDataValue: Invalid value",t);const h=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=h):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=h):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=h):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=h):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=h):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=h):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=h):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=h):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,t,o,s,i)}setData(e,t,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(t instanceof Mt){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,i,16);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11],l[12]=t.data[12],l[13]=t.data[13],l[14]=t.data[14],l[15]=t.data[15]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15])}else{const l=new Float32Array(this.buffer,i,12);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11])}else{const l=new Float32Array(this.buffer,i,8);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7])}else{const l=new Float32Array(this.buffer,i,12);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11])}else{const l=new Float32Array(this.buffer,i,9);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8])}else{const l=new Float32Array(this.buffer,i,6);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5])}else{const l=new Float32Array(this.buffer,i,8);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7])}else{const l=new Float32Array(this.buffer,i,6);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5])}else{const l=new Float32Array(this.buffer,i,4);t instanceof Ie?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,i,4);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,i,3);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Uint32Array(this.buffer,i,2);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Uint32Array(this.buffer,i,4);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Uint32Array(this.buffer,i,3);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Uint32Array(this.buffer,i,2);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Int32Array(this.buffer,i,4);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Int32Array(this.buffer,i,3);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Int32Array(this.buffer,i,2);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else{const l=new Float32Array(this.buffer,i,4);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3])}else{const l=new Float32Array(this.buffer,i,3);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2])}else{const l=new Float32Array(this.buffer,i,2);t instanceof W?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1])}else t instanceof ne&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof ne&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof ne&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof ne&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,s,o;if(t===null)return this;let l=this.offset,u=this.typeInfo;for(;t;){if(t instanceof lo){const h=t.index,g=h instanceof Mr?e.evalExpression(h,r):h;let _=0;if(g instanceof ne?_=g.value:typeof g=="number"?_=g:console.error("GetDataValue: Invalid index type",h),u instanceof rs)l+=_*u.stride,u=u.format;else{const y=u.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(l+=16*_,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(t instanceof Us))return console.error("GetDataValue: Unknown postfix type",t),null;{const h=t.value;if(u instanceof es){let g=!1;for(const _ of u.members)if(_.name===h){l+=_.offset,u=_.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${h} not found`),null}else if(u instanceof cr){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(h.length>0&&h.length<5){let _="f";const y=[];for(let T=0;T<h.length;++T){const w=h[T].toLowerCase();let x=0;if(w==="x"||w==="r")x=0;else if(w==="y"||w==="g")x=1;else if(w==="z"||w==="b")x=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${h}`),null;x=3}if(h.length===1){if(g.endsWith("f"))return this.buffer.byteLength<l+4*x+4?(console.log("Insufficient buffer data"),null):new ne(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new ne(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new ne(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new ne(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new ne(new Uint32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")y.push(new Float32Array(this.buffer,l,2)[x]);else if(g==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,l,3);y.push(S[x])}else if(g==="vec4f")y.push(new Float32Array(this.buffer,l,4)[x]);else if(g==="vec2i")_="i",y.push(new Int32Array(this.buffer,l,2)[x]);else if(g==="vec3i")_="i",y.push(new Int32Array(this.buffer,l,3)[x]);else if(g==="vec4i")_="i",y.push(new Int32Array(this.buffer,l,4)[x]);else if(g==="vec2u"){_="u";const S=new Uint32Array(this.buffer,l,2);y.push(S[x])}else g==="vec3u"?(_="u",y.push(new Uint32Array(this.buffer,l,3)[x])):g==="vec4u"&&(_="u",y.push(new Uint32Array(this.buffer,l,4)[x]))}return y.length===2?u=e.getTypeInfo(`vec2${_}`):y.length===3?u=e.getTypeInfo(`vec3${_}`):y.length===4?u=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new W(y,u,null)}return console.error(`GetDataValue: Unknown member ${h}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}t=t.postfix}const d=u.getTypeName();return d==="f32"?new ne(new Float32Array(this.buffer,l,1),u,this):d==="i32"?new ne(new Int32Array(this.buffer,l,1),u,this):d==="u32"?new ne(new Uint32Array(this.buffer,l,1),u,this):d==="vec2f"?new W(new Float32Array(this.buffer,l,2),u,this):d==="vec3f"?new W(new Float32Array(this.buffer,l,3),u,this):d==="vec4f"?new W(new Float32Array(this.buffer,l,4),u,this):d==="vec2i"?new W(new Int32Array(this.buffer,l,2),u,this):d==="vec3i"?new W(new Int32Array(this.buffer,l,3),u,this):d==="vec4i"?new W(new Int32Array(this.buffer,l,4),u,this):d==="vec2u"?new W(new Uint32Array(this.buffer,l,2),u,this):d==="vec3u"?new W(new Uint32Array(this.buffer,l,3),u,this):d==="vec4u"?new W(new Uint32Array(this.buffer,l,4),u,this):u instanceof Bs&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new ne(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new ne(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Mt(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof rs)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof es?e+="{...}":e="[...]";return e}}class di extends dr{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new di(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=a0[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=a0[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=a0[e],r=this.width;if(!e||r<=0||!t)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/t.blockWidth*(o==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return QW(new Uint8Array(u),e,t,r,i,l,o,s,this.format)}setPixel(e,t,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,d=this.data[i];(function(h,g,_,y,T,w,x,S,A,R){const E=y*(x>>=T)*(w>>=T)+_*x+g*S;switch(A){case"r8unorm":return void et(h,E,"8unorm",1,R);case"r8snorm":return void et(h,E,"8snorm",1,R);case"r8uint":return void et(h,E,"8uint",1,R);case"r8sint":return void et(h,E,"8sint",1,R);case"rg8unorm":return void et(h,E,"8unorm",2,R);case"rg8snorm":return void et(h,E,"8snorm",2,R);case"rg8uint":return void et(h,E,"8uint",2,R);case"rg8sint":return void et(h,E,"8sint",2,R);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void et(h,E,"8unorm",4,R);case"rgba8snorm":return void et(h,E,"8snorm",4,R);case"rgba8uint":return void et(h,E,"8uint",4,R);case"rgba8sint":return void et(h,E,"8sint",4,R);case"r16uint":return void et(h,E,"16uint",1,R);case"r16sint":return void et(h,E,"16sint",1,R);case"r16float":return void et(h,E,"16float",1,R);case"rg16uint":return void et(h,E,"16uint",2,R);case"rg16sint":return void et(h,E,"16sint",2,R);case"rg16float":return void et(h,E,"16float",2,R);case"rgba16uint":return void et(h,E,"16uint",4,R);case"rgba16sint":return void et(h,E,"16sint",4,R);case"rgba16float":return void et(h,E,"16float",4,R);case"r32uint":return void et(h,E,"32uint",1,R);case"r32sint":return void et(h,E,"32sint",1,R);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void et(h,E,"32float",1,R);case"rg32uint":return void et(h,E,"32uint",2,R);case"rg32sint":return void et(h,E,"32sint",2,R);case"rg32float":return void et(h,E,"32float",2,R);case"rgba32uint":return void et(h,E,"32uint",4,R);case"rgba32sint":return void et(h,E,"32sint",4,R);case"rgba32float":return void et(h,E,"32float",4,R);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,r,i,u,l,o,this.format,s)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(re||(re={}));class ie{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class F{}le=F,F.none=new ie("",re.reserved,""),F.eof=new ie("EOF",re.token,""),F.reserved={asm:new ie("asm",re.reserved,"asm"),bf16:new ie("bf16",re.reserved,"bf16"),do:new ie("do",re.reserved,"do"),enum:new ie("enum",re.reserved,"enum"),f16:new ie("f16",re.reserved,"f16"),f64:new ie("f64",re.reserved,"f64"),handle:new ie("handle",re.reserved,"handle"),i8:new ie("i8",re.reserved,"i8"),i16:new ie("i16",re.reserved,"i16"),i64:new ie("i64",re.reserved,"i64"),mat:new ie("mat",re.reserved,"mat"),premerge:new ie("premerge",re.reserved,"premerge"),regardless:new ie("regardless",re.reserved,"regardless"),typedef:new ie("typedef",re.reserved,"typedef"),u8:new ie("u8",re.reserved,"u8"),u16:new ie("u16",re.reserved,"u16"),u64:new ie("u64",re.reserved,"u64"),unless:new ie("unless",re.reserved,"unless"),using:new ie("using",re.reserved,"using"),vec:new ie("vec",re.reserved,"vec"),void:new ie("void",re.reserved,"void")},F.keywords={array:new ie("array",re.keyword,"array"),atomic:new ie("atomic",re.keyword,"atomic"),bool:new ie("bool",re.keyword,"bool"),f32:new ie("f32",re.keyword,"f32"),i32:new ie("i32",re.keyword,"i32"),mat2x2:new ie("mat2x2",re.keyword,"mat2x2"),mat2x3:new ie("mat2x3",re.keyword,"mat2x3"),mat2x4:new ie("mat2x4",re.keyword,"mat2x4"),mat3x2:new ie("mat3x2",re.keyword,"mat3x2"),mat3x3:new ie("mat3x3",re.keyword,"mat3x3"),mat3x4:new ie("mat3x4",re.keyword,"mat3x4"),mat4x2:new ie("mat4x2",re.keyword,"mat4x2"),mat4x3:new ie("mat4x3",re.keyword,"mat4x3"),mat4x4:new ie("mat4x4",re.keyword,"mat4x4"),ptr:new ie("ptr",re.keyword,"ptr"),sampler:new ie("sampler",re.keyword,"sampler"),sampler_comparison:new ie("sampler_comparison",re.keyword,"sampler_comparison"),struct:new ie("struct",re.keyword,"struct"),texture_1d:new ie("texture_1d",re.keyword,"texture_1d"),texture_2d:new ie("texture_2d",re.keyword,"texture_2d"),texture_2d_array:new ie("texture_2d_array",re.keyword,"texture_2d_array"),texture_3d:new ie("texture_3d",re.keyword,"texture_3d"),texture_cube:new ie("texture_cube",re.keyword,"texture_cube"),texture_cube_array:new ie("texture_cube_array",re.keyword,"texture_cube_array"),texture_multisampled_2d:new ie("texture_multisampled_2d",re.keyword,"texture_multisampled_2d"),texture_storage_1d:new ie("texture_storage_1d",re.keyword,"texture_storage_1d"),texture_storage_2d:new ie("texture_storage_2d",re.keyword,"texture_storage_2d"),texture_storage_2d_array:new ie("texture_storage_2d_array",re.keyword,"texture_storage_2d_array"),texture_storage_3d:new ie("texture_storage_3d",re.keyword,"texture_storage_3d"),texture_depth_2d:new ie("texture_depth_2d",re.keyword,"texture_depth_2d"),texture_depth_2d_array:new ie("texture_depth_2d_array",re.keyword,"texture_depth_2d_array"),texture_depth_cube:new ie("texture_depth_cube",re.keyword,"texture_depth_cube"),texture_depth_cube_array:new ie("texture_depth_cube_array",re.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ie("texture_depth_multisampled_2d",re.keyword,"texture_depth_multisampled_2d"),texture_external:new ie("texture_external",re.keyword,"texture_external"),u32:new ie("u32",re.keyword,"u32"),vec2:new ie("vec2",re.keyword,"vec2"),vec3:new ie("vec3",re.keyword,"vec3"),vec4:new ie("vec4",re.keyword,"vec4"),bitcast:new ie("bitcast",re.keyword,"bitcast"),block:new ie("block",re.keyword,"block"),break:new ie("break",re.keyword,"break"),case:new ie("case",re.keyword,"case"),continue:new ie("continue",re.keyword,"continue"),continuing:new ie("continuing",re.keyword,"continuing"),default:new ie("default",re.keyword,"default"),diagnostic:new ie("diagnostic",re.keyword,"diagnostic"),discard:new ie("discard",re.keyword,"discard"),else:new ie("else",re.keyword,"else"),enable:new ie("enable",re.keyword,"enable"),fallthrough:new ie("fallthrough",re.keyword,"fallthrough"),false:new ie("false",re.keyword,"false"),fn:new ie("fn",re.keyword,"fn"),for:new ie("for",re.keyword,"for"),function:new ie("function",re.keyword,"function"),if:new ie("if",re.keyword,"if"),let:new ie("let",re.keyword,"let"),const:new ie("const",re.keyword,"const"),loop:new ie("loop",re.keyword,"loop"),while:new ie("while",re.keyword,"while"),private:new ie("private",re.keyword,"private"),read:new ie("read",re.keyword,"read"),read_write:new ie("read_write",re.keyword,"read_write"),return:new ie("return",re.keyword,"return"),requires:new ie("requires",re.keyword,"requires"),storage:new ie("storage",re.keyword,"storage"),switch:new ie("switch",re.keyword,"switch"),true:new ie("true",re.keyword,"true"),alias:new ie("alias",re.keyword,"alias"),type:new ie("type",re.keyword,"type"),uniform:new ie("uniform",re.keyword,"uniform"),var:new ie("var",re.keyword,"var"),override:new ie("override",re.keyword,"override"),workgroup:new ie("workgroup",re.keyword,"workgroup"),write:new ie("write",re.keyword,"write"),r8unorm:new ie("r8unorm",re.keyword,"r8unorm"),r8snorm:new ie("r8snorm",re.keyword,"r8snorm"),r8uint:new ie("r8uint",re.keyword,"r8uint"),r8sint:new ie("r8sint",re.keyword,"r8sint"),r16uint:new ie("r16uint",re.keyword,"r16uint"),r16sint:new ie("r16sint",re.keyword,"r16sint"),r16float:new ie("r16float",re.keyword,"r16float"),rg8unorm:new ie("rg8unorm",re.keyword,"rg8unorm"),rg8snorm:new ie("rg8snorm",re.keyword,"rg8snorm"),rg8uint:new ie("rg8uint",re.keyword,"rg8uint"),rg8sint:new ie("rg8sint",re.keyword,"rg8sint"),r32uint:new ie("r32uint",re.keyword,"r32uint"),r32sint:new ie("r32sint",re.keyword,"r32sint"),r32float:new ie("r32float",re.keyword,"r32float"),rg16uint:new ie("rg16uint",re.keyword,"rg16uint"),rg16sint:new ie("rg16sint",re.keyword,"rg16sint"),rg16float:new ie("rg16float",re.keyword,"rg16float"),rgba8unorm:new ie("rgba8unorm",re.keyword,"rgba8unorm"),rgba8unorm_srgb:new ie("rgba8unorm_srgb",re.keyword,"rgba8unorm_srgb"),rgba8snorm:new ie("rgba8snorm",re.keyword,"rgba8snorm"),rgba8uint:new ie("rgba8uint",re.keyword,"rgba8uint"),rgba8sint:new ie("rgba8sint",re.keyword,"rgba8sint"),bgra8unorm:new ie("bgra8unorm",re.keyword,"bgra8unorm"),bgra8unorm_srgb:new ie("bgra8unorm_srgb",re.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ie("rgb10a2unorm",re.keyword,"rgb10a2unorm"),rg11b10float:new ie("rg11b10float",re.keyword,"rg11b10float"),rg32uint:new ie("rg32uint",re.keyword,"rg32uint"),rg32sint:new ie("rg32sint",re.keyword,"rg32sint"),rg32float:new ie("rg32float",re.keyword,"rg32float"),rgba16uint:new ie("rgba16uint",re.keyword,"rgba16uint"),rgba16sint:new ie("rgba16sint",re.keyword,"rgba16sint"),rgba16float:new ie("rgba16float",re.keyword,"rgba16float"),rgba32uint:new ie("rgba32uint",re.keyword,"rgba32uint"),rgba32sint:new ie("rgba32sint",re.keyword,"rgba32sint"),rgba32float:new ie("rgba32float",re.keyword,"rgba32float"),static_assert:new ie("static_assert",re.keyword,"static_assert")},F.tokens={decimal_float_literal:new ie("decimal_float_literal",re.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ie("hex_float_literal",re.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ie("int_literal",re.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ie("uint_literal",re.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ie("name",re.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ie("ident",re.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ie("and",re.token,"&"),and_and:new ie("and_and",re.token,"&&"),arrow:new ie("arrow ",re.token,"->"),attr:new ie("attr",re.token,"@"),forward_slash:new ie("forward_slash",re.token,"/"),bang:new ie("bang",re.token,"!"),bracket_left:new ie("bracket_left",re.token,"["),bracket_right:new ie("bracket_right",re.token,"]"),brace_left:new ie("brace_left",re.token,"{"),brace_right:new ie("brace_right",re.token,"}"),colon:new ie("colon",re.token,":"),comma:new ie("comma",re.token,","),equal:new ie("equal",re.token,"="),equal_equal:new ie("equal_equal",re.token,"=="),not_equal:new ie("not_equal",re.token,"!="),greater_than:new ie("greater_than",re.token,">"),greater_than_equal:new ie("greater_than_equal",re.token,">="),shift_right:new ie("shift_right",re.token,">>"),less_than:new ie("less_than",re.token,"<"),less_than_equal:new ie("less_than_equal",re.token,"<="),shift_left:new ie("shift_left",re.token,"<<"),modulo:new ie("modulo",re.token,"%"),minus:new ie("minus",re.token,"-"),minus_minus:new ie("minus_minus",re.token,"--"),period:new ie("period",re.token,"."),plus:new ie("plus",re.token,"+"),plus_plus:new ie("plus_plus",re.token,"++"),or:new ie("or",re.token,"|"),or_or:new ie("or_or",re.token,"||"),paren_left:new ie("paren_left",re.token,"("),paren_right:new ie("paren_right",re.token,")"),semicolon:new ie("semicolon",re.token,";"),star:new ie("star",re.token,"*"),tilde:new ie("tilde",re.token,"~"),underscore:new ie("underscore",re.token,"_"),xor:new ie("xor",re.token,"^"),plus_equal:new ie("plus_equal",re.token,"+="),minus_equal:new ie("minus_equal",re.token,"-="),times_equal:new ie("times_equal",re.token,"*="),division_equal:new ie("division_equal",re.token,"/="),modulo_equal:new ie("modulo_equal",re.token,"%="),and_equal:new ie("and_equal",re.token,"&="),or_equal:new ie("or_equal",re.token,"|="),xor_equal:new ie("xor_equal",re.token,"^="),shift_right_equal:new ie("shift_right_equal",re.token,">>="),shift_left_equal:new ie("shift_left_equal",re.token,"<<=")},F.simpleTokens={"@":le.tokens.attr,"{":le.tokens.brace_left,"}":le.tokens.brace_right,":":le.tokens.colon,",":le.tokens.comma,"(":le.tokens.paren_left,")":le.tokens.paren_right,";":le.tokens.semicolon},F.literalTokens={"&":le.tokens.and,"&&":le.tokens.and_and,"->":le.tokens.arrow,"/":le.tokens.forward_slash,"!":le.tokens.bang,"[":le.tokens.bracket_left,"]":le.tokens.bracket_right,"=":le.tokens.equal,"==":le.tokens.equal_equal,"!=":le.tokens.not_equal,">":le.tokens.greater_than,">=":le.tokens.greater_than_equal,">>":le.tokens.shift_right,"<":le.tokens.less_than,"<=":le.tokens.less_than_equal,"<<":le.tokens.shift_left,"%":le.tokens.modulo,"-":le.tokens.minus,"--":le.tokens.minus_minus,".":le.tokens.period,"+":le.tokens.plus,"++":le.tokens.plus_plus,"|":le.tokens.or,"||":le.tokens.or_or,"*":le.tokens.star,"~":le.tokens.tilde,_:le.tokens.underscore,"^":le.tokens.xor,"+=":le.tokens.plus_equal,"-=":le.tokens.minus_equal,"*=":le.tokens.times_equal,"/=":le.tokens.division_equal,"%=":le.tokens.modulo_equal,"&=":le.tokens.and_equal,"|=":le.tokens.or_equal,"^=":le.tokens.xor_equal,">>=":le.tokens.shift_right_equal,"<<=":le.tokens.shift_left_equal},F.regexTokens={decimal_float_literal:le.tokens.decimal_float_literal,hex_float_literal:le.tokens.hex_float_literal,int_literal:le.tokens.int_literal,uint_literal:le.tokens.uint_literal,ident:le.tokens.ident},F.storage_class=[le.keywords.function,le.keywords.private,le.keywords.workgroup,le.keywords.uniform,le.keywords.storage],F.access_mode=[le.keywords.read,le.keywords.write,le.keywords.read_write],F.sampler_type=[le.keywords.sampler,le.keywords.sampler_comparison],F.sampled_texture_type=[le.keywords.texture_1d,le.keywords.texture_2d,le.keywords.texture_2d_array,le.keywords.texture_3d,le.keywords.texture_cube,le.keywords.texture_cube_array],F.multisampled_texture_type=[le.keywords.texture_multisampled_2d],F.storage_texture_type=[le.keywords.texture_storage_1d,le.keywords.texture_storage_2d,le.keywords.texture_storage_2d_array,le.keywords.texture_storage_3d],F.depth_texture_type=[le.keywords.texture_depth_2d,le.keywords.texture_depth_2d_array,le.keywords.texture_depth_cube,le.keywords.texture_depth_cube_array,le.keywords.texture_depth_multisampled_2d],F.texture_external_type=[le.keywords.texture_external],F.any_texture_type=[...le.sampled_texture_type,...le.multisampled_texture_type,...le.storage_texture_type,...le.depth_texture_type,...le.texture_external_type],F.texel_format=[le.keywords.r8unorm,le.keywords.r8snorm,le.keywords.r8uint,le.keywords.r8sint,le.keywords.r16uint,le.keywords.r16sint,le.keywords.r16float,le.keywords.rg8unorm,le.keywords.rg8snorm,le.keywords.rg8uint,le.keywords.rg8sint,le.keywords.r32uint,le.keywords.r32sint,le.keywords.r32float,le.keywords.rg16uint,le.keywords.rg16sint,le.keywords.rg16float,le.keywords.rgba8unorm,le.keywords.rgba8unorm_srgb,le.keywords.rgba8snorm,le.keywords.rgba8uint,le.keywords.rgba8sint,le.keywords.bgra8unorm,le.keywords.bgra8unorm_srgb,le.keywords.rgb10a2unorm,le.keywords.rg11b10float,le.keywords.rg32uint,le.keywords.rg32sint,le.keywords.rg32float,le.keywords.rgba16uint,le.keywords.rgba16sint,le.keywords.rgba16float,le.keywords.rgba32uint,le.keywords.rgba32sint,le.keywords.rgba32float],F.const_literal=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.keywords.true,le.keywords.false],F.literal_or_ident=[le.tokens.ident,le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.tokens.name],F.element_count_expression=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.ident],F.template_types=[le.keywords.vec2,le.keywords.vec3,le.keywords.vec4,le.keywords.mat2x2,le.keywords.mat2x3,le.keywords.mat2x4,le.keywords.mat3x2,le.keywords.mat3x3,le.keywords.mat3x4,le.keywords.mat4x2,le.keywords.mat4x3,le.keywords.mat4x4,le.keywords.atomic,le.keywords.bitcast,...le.any_texture_type],F.attribute_name=[le.tokens.ident,le.keywords.block,le.keywords.diagnostic],F.assignment_operators=[le.tokens.equal,le.tokens.plus_equal,le.tokens.minus_equal,le.tokens.times_equal,le.tokens.division_equal,le.tokens.modulo_equal,le.tokens.and_equal,le.tokens.or_equal,le.tokens.xor_equal,le.tokens.shift_right_equal,le.tokens.shift_left_equal],F.increment_operators=[le.tokens.plus_plus,le.tokens.minus_minus];class Uk{constructor(e,t,r,i,s){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return F.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==F.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class sX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Uk(F.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const t=F.simpleTokens[e];if(t)return this._addToken(t),!0;let r=F.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=F.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(F.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(F.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(F.tokens.minus_minus),!0;const u=this._tokens.length-1;if((F.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==F.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,d=this._tokens.length-1;for(let h=0;h<5&&d>=0&&F.assignment_operators.indexOf(this._tokens[d].type)===-1;++h,--d)if(this._tokens[d].type===F.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===F.none){let u=e,d=0;const h=2;for(let g=0;g<h;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==F.none){d=g;break}if(o===F.none)return r!==F.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=d+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==F.none&&(this._addToken(r),!0)}_findType(e){for(const r in F.regexTokens){const i=F.regexTokens[r];if(this._match(e,i.rule))return i}return F.literalTokens[e]||F.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Uk(e,t,this._line,this._start,this._current))}}function Te(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const Yf=new Float32Array(1),aX=new Uint32Array(Yf.buffer),oX=new Uint32Array(Yf.buffer),Gf=new Int32Array(1),lX=new Float32Array(Gf.buffer),cX=new Uint32Array(Gf.buffer),Kf=new Uint32Array(1),uX=new Float32Array(Kf.buffer),fX=new Int32Array(Kf.buffer);function Fk(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Yf[0]=n,aX[0];if(t==="u32")return Yf[0]=n,oX[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Gf[0]=n,lX[0];if(t==="u32")return Gf[0]=n,cX[0]}else if(e==="u32"){if(t==="f32")return Kf[0]=n,uX[0];if(t==="i32"||t==="x32")return Kf[0]=n,fX[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class dX{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ef{constructor(e,t){this.align=e,this.size=t}}class Vr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new GW,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof lc&&this._functions.set(t.name,new dX(t));for(const t of e)if(t instanceof fi){const r=this.getTypeInfo(t,null);r instanceof es&&this.structs.push(r)}for(const t of e)if(t instanceof O1)this.aliases.push(this._getAliasInfo(t));else if(t instanceof M1){const r=t,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new WW(r.name,s,r.attributes,i))}else if(this._isUniformVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new Ju(r.name,o,i,s,r.attributes,Xi.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new Ju(r.name,o,i,s,r.attributes,l?Xi.StorageTexture:Xi.Storage,r.access);u.access||(u.access="read"),this.storage.push(u)}else if(this._isTextureVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new Ju(r.name,o,i,s,r.attributes,l?Xi.StorageTexture:Xi.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new Ju(r.name,o,i,s,r.attributes,Xi.Sampler,r.access);this.samplers.push(l)}for(const t of e)if(t instanceof lc){const r=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),o=r||i||s,l=new YW(t.name,o==null?void 0:o.name,t.attributes);l.attributes=t.attributes,l.startLine=t.startLine,l.endLine=t.endLine,this.functions.push(l),this._functions.get(t.name).info=l,o&&(this._functions.get(t.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(t,!!o),l.inputs=this._getInputs(t.args),l.outputs=this._getOutputs(t.returnType),this.entry[o.name].push(l)),l.arguments=t.args.map(u=>new XW(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var i,s,o;if(r instanceof kP){if(r.value)if(Te(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=t.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=t.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Xn)for(const l of this.overrides)r.name===l.name&&((o=t.info)===null||o===void 0||o.overrides.push(l))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&t.add(s)}}findResource(e,t,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Wf)s.push({});else if(o instanceof Xf)s.pop();else if(o instanceof hi){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Fr){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof Wl){const l=o;t&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Xn){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof P1){const l=o,u=i._functions.get(l.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}else if(o instanceof I1){const l=o,u=i._functions.get(l.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function t(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof fi)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof fi)this._getStructOutputs(r.type,t);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new Pk(r.name,s,i.name,o);t.push(l)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Pk("",r,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof fi)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof fi)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),o=new HW(e.name,i,t.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new $W(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof yf){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new ox(e.name,i,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Xl){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new rs(i.name,t);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof fi){const i=e,s=new es(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new Ok(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Ul){const i=e,s=i.format instanceof _e,o=i.format?s?this.getTypeInfo(i.format,null):new cr(i.format,null):null,l=new Bs(i.name,o,t,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof oe){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Bs(i.name,s,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new cr(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;const s=this._getTypeSize(e);if(e.size=(t=s==null?void 0:s.size)!==null&&t!==void 0?t:0,e instanceof rs&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof ox&&this._updateTypeInfo(e.format),e instanceof es&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const d=e.members[l],h=this._getTypeSize(d);if(!h)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const g=h.align,_=h.size;r=this._roundUp(g,r+i),i=_,s=r,o=Math.max(o,g),d.offset=r,d.size=_,this._updateTypeInfo(d.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var t,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ok&&(e=e.type),e instanceof cr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Vr._typeInfo[e.name];if(o!==void 0){const l=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new ef(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Vr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new ef(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof rs){let o=e,l=8,u=8;const d=this._getTypeSize(o.format);return d!==null&&(u=d.size,l=d.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new ef(Math.max(s,l),Math.max(i,u))}if(e instanceof es){let o=0,l=0,u=0,d=0,h=0;for(const g of e.members){const _=this._getTypeSize(g.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+d),d=_.size,h=u)}return l=this._roundUp(o,h+d),new ef(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof hi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof hi&&e.storage=="storage"}_isTextureVar(e){return e instanceof hi&&e.type!==null&&Vr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof hi&&e.type!==null&&Vr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}Vr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Vr._textureTypes=F.any_texture_type.map(n=>n.name),Vr._samplerTypes=F.sampler_type.map(n=>n.name);let D1=0;class j1{constructor(e,t,r){this.id=D1++,this.name=e,this.value=t,this.node=r}clone(){return new j1(this.name,this.value,this.node)}}class L1{constructor(e){this.id=D1++,this.name=e.name,this.node=e}clone(){return new L1(this.node)}}class B1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=D1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new j1(e,t,r??null))}setVariable(e,t,r){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new B1(this)}}class hX{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class pX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let i=!0;if(r instanceof W)return r.data.forEach(s=>{s||(i=!1)}),new ne(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W){const i=r.data.some(s=>s);return new ne(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof ne))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.evalExpression(r,t);if(i instanceof Mt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new ne(o,this.getTypeInfo("u32"))}return new ne(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new ne(Math.abs(i.value),i.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new ne(Math.acos(i.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new ne(Math.acosh(i.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new ne(Math.asin(i.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new ne(Math.asinh(i.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new ne(Math.atan(i.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new ne(Math.atanh(i.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ne(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new ne(Math.ceil(i.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((d,h)=>this._clamp(d,i.data[h],s.data[h])),r.typeInfo);const o=r,l=i,u=s;return new ne(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new ne(Math.cos(i.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new ne(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new ne(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new ne(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new ne(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new W([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof W?new W(r.data.map(s=>s*i),r.typeInfo):new ne(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Ie){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ne(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ne(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ne(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new ne(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new ne(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof W&&i instanceof W?new ne(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new ne(Math.exp(i.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new ne(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof W)return new W(r.data.map(d=>d>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new ne(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof W&&i instanceof W&&s instanceof W){const o=this._dot(i.data,s.data);return new W(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new ne(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new ne(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new ne(Math.floor(i.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof W&&i instanceof W&&s instanceof W)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new W(r.data.map((d,h)=>d*i.data[h]+s.data[h]),r.typeInfo);const o=r,l=i,u=s;return new ne(o.value*l.value+u.value,o.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new ne(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,d=~u;if(r instanceof W&&i instanceof W)return new W(r.data.map((_,y)=>_&d|i.data[y]<<l&u),r.typeInfo);const h=r.value,g=i.value;return new ne(h&d|g<<l&u,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new ne(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W){let s=0;return r.data.forEach(o=>{s+=o*o}),new ne(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new ne(Math.abs(i.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new ne(Math.log(i.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new ne(Math.log2(i.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ne(Math.max(s.value,o.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ne(Math.min(s.value,o.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof W&&i instanceof W&&s instanceof W)return new W(r.data.map((u,d)=>r.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),r.typeInfo);const o=i,l=s;return new ne(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W)return new W(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new ne(r.value%s.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W){const i=this.Length(e,t).value;return new W(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W)return new W(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new ne(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof W?new W(r.data.map(i=>i),r.typeInfo):new ne(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof W?new W(r.data.map(i=>i*Math.PI/180),r.typeInfo):new ne(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof W&&i instanceof W){const s=this._dot(r.data,i.data);return new W(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof W&&i instanceof W&&s instanceof ne){const o=this._dot(i.data,r.data);return new W(r.data.map((l,u)=>{const d=1-s.value*s.value*(1-o*o);if(d<0)return 0;const h=Math.sqrt(d);return s.value*l-(s.value*o+h)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new ne(Math.round(i.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new ne(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new ne(Math.sign(i.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new ne(Math.sin(i.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new ne(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,t,r){const i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof W&&r instanceof W&&i instanceof W)return new W(s.data.map((d,h)=>this._smoothstep(r.data[h],i.data[h],d)),s.typeInfo);const o=r,l=i,u=s;return new ne(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new ne(Math.sqrt(i.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof W&&r instanceof W)return new W(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new ne(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new ne(Math.tan(i.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new ne(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof Ie))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Ie([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Ie([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Ie([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Ie([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Ie([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Ie([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Ie([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Ie([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Ie([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof W)return new W(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new ne(Math.trunc(i.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof Xn){const s=r.name,o=t.getVariableValue(s);if(o instanceof di){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new ne(l[0],this.getTypeInfo("u32")):u==="3d"?new W(l,this.getTypeInfo("vec3u")):u==="2d"?new W(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Xn){const o=r.name,l=t.getVariableValue(o);if(l instanceof di){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=l.width||d<0||d>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const h=l.getPixel(u,d,0,s);return h===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new W(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof Xn){const i=r.name,s=t.getVariableValue(i);return s instanceof di?new ne(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof Xn){const i=r.name,s=t.getVariableValue(i);return s instanceof di?new ne(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof Xn){const i=r.name,s=t.getVariableValue(i);return s instanceof di?new ne(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof W)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Xn){const l=r.name,u=t.getVariableValue(l);if(u instanceof di){const d=u.getMipLevelSize(0),h=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return h<0||h>=d[0]||g<0||g>=d[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(h,g,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t);return u instanceof ne&&l instanceof ne&&(u.value=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value+=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicSub(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value-=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicMax(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=Math.max(u.value,l.value)),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicMin(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=Math.min(u.value,l.value)),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicAnd(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=u.value&l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicOr(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=u.value|l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicXor(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=u.value^l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicExchange(e,t){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,t),u=s.value.getSubData(this.exec,r.postfix,t),d=new ne(u.value,u.typeInfo);return u instanceof ne&&l instanceof ne&&(u.value=l.value),s.value instanceof Mt&&s.value.setDataValue(this.exec,u,r.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const o0={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},wn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class _n extends hX{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new Vr,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new B1,this.builtins=new pX(this),this.typeInfo={bool:this.getTypeInfo(_e.bool),i32:this.getTypeInfo(_e.i32),u32:this.getTypeInfo(_e.u32),f32:this.getTypeInfo(_e.f32),f16:this.getTypeInfo(_e.f16),vec2f:this.getTypeInfo(oe.vec2f),vec2u:this.getTypeInfo(oe.vec2u),vec2i:this.getTypeInfo(oe.vec2i),vec2h:this.getTypeInfo(oe.vec2h),vec3f:this.getTypeInfo(oe.vec3f),vec3u:this.getTypeInfo(oe.vec3u),vec3i:this.getTypeInfo(oe.vec3i),vec3h:this.getTypeInfo(oe.vec3h),vec4f:this.getTypeInfo(oe.vec4f),vec4u:this.getTypeInfo(oe.vec4u),vec4i:this.getTypeInfo(oe.vec4i),vec4h:this.getTypeInfo(oe.vec4h),mat2x2f:this.getTypeInfo(oe.mat2x2f),mat2x3f:this.getTypeInfo(oe.mat2x3f),mat2x4f:this.getTypeInfo(oe.mat2x4f),mat3x2f:this.getTypeInfo(oe.mat3x2f),mat3x3f:this.getTypeInfo(oe.mat3x3f),mat3x4f:this.getTypeInfo(oe.mat3x4f),mat4x2f:this.getTypeInfo(oe.mat4x2f),mat4x3f:this.getTypeInfo(oe.mat4x3f),mat4x4f:this.getTypeInfo(oe.mat4x4f)}}getVariableValue(e){var t,r;const i=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof ne)return i.value;if(i instanceof W||i instanceof Ie)return Array.from(i.data);if(i instanceof Mt&&i.typeInfo instanceof rs){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const l=t[0],u=t[1],d=t[2],h=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new W(t,h));for(const g in r)for(const _ in r[g]){const y=r[g][_];s.variables.forEach(T=>{var w;const x=T.node;if(x!=null&&x.attributes){let S=null,A=null;for(const R of x.attributes)R.name==="binding"?S=R.value:R.name==="group"&&(A=R.value);if(_==S&&g==A)if(y.texture!==void 0&&y.descriptor!==void 0){const R=new di(y.texture,this.getTypeInfo(x.type),y.descriptor,(w=y.texture.view)!==null&&w!==void 0?w:null);T.value=R}else y.uniform!==void 0?T.value=new Mt(y.uniform,this.getTypeInfo(x.type)):T.value=new Mt(y,this.getTypeInfo(x.type))}})}for(let g=0;g<d;++g)for(let _=0;_<u;++_)for(let y=0;y<l;++y)s.setVariable("@workgroup_id",new W([y,_,g],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,_,g],s)}execStatement(e,t){if(e instanceof bP)return this.evalExpression(e.value,t);if(e instanceof wP){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof ne))throw new Error("Invalid break-if condition");if(!r.value)return null}return _n._breakObj}if(e instanceof TP)return _n._continueObj;if(e instanceof Wl)this._let(e,t);else if(e instanceof hi)this._var(e,t);else if(e instanceof vf)this._const(e,t);else if(e instanceof lc)this._function(e,t);else{if(e instanceof yP)return this._if(e,t);if(e instanceof vP)return this._switch(e,t);if(e instanceof pP)return this._for(e,t);if(e instanceof hP)return this._while(e,t);if(e instanceof _P)return this._loop(e,t);if(e instanceof lx){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof mP)this._assign(e,t);else if(e instanceof gP)this._increment(e,t);else{if(e instanceof fi)return null;if(e instanceof M1){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new ne(0,this.getTypeInfo("u32")))}else if(e instanceof I1)this._call(e,t);else{if(e instanceof xP||e instanceof O1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof wr?this._evalBinaryOp(e,t):e instanceof Gt?this._evalLiteral(e,t):e instanceof Xn?this._evalVariable(e,t):e instanceof P1?this._evalCall(e,t):e instanceof Fr?this._evalCreate(e,t):e instanceof SP?this._evalConst(e,t):e instanceof EP?this._evalBitcast(e,t):e instanceof Vt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof _e){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(r,new ne(i,s.type)):s.type.name==="bool"?t.setVariable(r,new ne(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(r,new W(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const i=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const g=r.getVariableValue(h.value[0]);i[0]=g instanceof ne?g.value:parseInt(h.value[0])}if(h.value.length>1){const g=r.getVariableValue(h.value[1]);i[1]=g instanceof ne?g.value:parseInt(h.value[1])}if(h.value.length>2){const g=r.getVariableValue(h.value[2]);i[2]=g instanceof ne?g.value:parseInt(h.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new W(i,s));const l=i[0],u=i[1],d=i[2];for(let h=0,g=0;h<d;++h)for(let _=0;_<u;++_)for(let y=0;y<l;++y,++g){const T=[y,_,h],w=[y+t[0]*i[0],_+t[1]*i[1],h+t[2]*i[2]];r.setVariable("@local_invocation_id",new W(T,s)),r.setVariable("@global_invocation_id",new W(w,s)),r.setVariable("@local_invocation_index",new ne(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=t.getVariable(s);o!==void 0&&t.variables.set(r.name,o)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Vt;)e=e.right;return e instanceof Xn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const s=t.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,t);if(i)return i}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?e.operator==="++"?i.value instanceof ne?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof ne?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Xn){const r=this.getVariableName(e,t),i=t.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof Vt){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof qa?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new qa(r)}}return null}_assign(e,t){let r=null,i="<var>",s=null;if(e.variable instanceof Vt){const u=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),h=e.operator;if(h==="="){if(u instanceof ne||u instanceof W||u instanceof Ie){if(d instanceof ne||d instanceof W||d instanceof Ie&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Mt&&d instanceof Mt&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(h==="+=")return u instanceof ne||u instanceof W||u instanceof Ie?d instanceof ne||d instanceof W||d instanceof Ie?void u.data.set(d.data.map((g,_)=>u.data[_]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(h==="-=")return(u instanceof ne||u instanceof W||u instanceof Ie)&&(d instanceof ne||d instanceof W||d instanceof Ie)?void u.data.set(d.data.map((g,_)=>u.data[_]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Vt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const u=t.getVariable(i);if(!(u&&u.value instanceof qa))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let d=e.variable.postfix;if(!d){let h=e.variable.right;for(;h instanceof Vt;){if(h.postfix){d=h.postfix;break}h=h.right}}d&&(r=r.getSubData(this,d,t))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,t);const u=t.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof qa&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),l=e.operator;if(l==="=")if(r instanceof Mt)r.setDataValue(this,o,s,t);else if(s){if(!(r instanceof W||r instanceof Ie))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof lo){const u=this.evalExpression(s.index,t).value;if(r instanceof W){if(!(o instanceof ne))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Ie))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=r.typeInfo.getTypeName();if(h==="mat2x2"||h==="mat2x2f"||h==="mat2x2h"){if(!(d<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat2x3"||h==="mat2x3f"||h==="mat2x3h"){if(!(d<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat2x4"||h==="mat2x4f"||h==="mat2x4h"){if(!(d<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat3x2"||h==="mat3x2f"||h==="mat3x2h"){if(!(d<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat3x3"||h==="mat3x3f"||h==="mat3x3h"){if(!(d<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat3x4"||h==="mat3x4f"||h==="mat3x4h"){if(!(d<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat4x2"||h==="mat4x2f"||h==="mat4x2h"){if(!(d<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat4x3"||h==="mat4x3f"||h==="mat4x3h"){if(!(d<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else{if(h!=="mat4x4"&&h!=="mat4x4f"&&h!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}}}}}else if(s instanceof Us){const u=s.value;if(!(r instanceof W))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof ne){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof W))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const h=u[d];if(h==="x"||h==="r")r.data[0]=o.data[d];else if(h==="y"||h==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[d]}else if(h==="z"||h==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[d]}else{if(h!=="w"&&h!=="a")return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[d]}}}}}else r instanceof ne&&o instanceof ne?r.value=o.value:r instanceof W&&o instanceof W||r instanceof Ie&&o instanceof Ie?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const u=r.getSubData(this,s,t);if(u instanceof W&&o instanceof ne){const d=u.data,h=o.value;if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h;else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h;else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h;else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h;else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h;else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h;else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h;else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h;else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h;else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof W&&o instanceof W){const d=u.data,h=o.data;if(d.length!==h.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h[g];else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h[g];else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h[g];else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h[g];else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h[g];else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h[g];else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h[g];else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h[g];else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h[g];else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h[g];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof ne&&o instanceof ne))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}r instanceof Mt&&r.setDataValue(this,u,s,t)}}_function(e,t){const r=new L1(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Fr(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Xl||e.type instanceof fi||e.type instanceof oe){const s=new Fr(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof CP)for(const o of s.selectors){if(o instanceof bf){i=s;continue}const l=this.evalExpression(o,t);if(!(l instanceof ne))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,t)}else s instanceof NP&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof ne?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===_n._breakObj)break;if(r!==null&&r!==_n._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===_n._breakObj)break;if(r===_n._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===_n._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===_n._breakObj)break;if(r!==_n._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),i=e.type;if(r instanceof ne){const s=Fk(r.value,r.typeInfo.name,i.name);return new ne(s,this.getTypeInfo(i))}if(r instanceof W){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(h,g,_){if(g===_)return h;const y=new Array(h.length);for(let T=0;T<h.length;T++)y[T]=Fk(h[T],g,_);return y}(Array.from(r.data),o,u);return new W(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Fr){if(e.type===null)return cx.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Fr?e.type.name:e.name,s=e instanceof Fr?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Mt(new ArrayBuffer(s.size),s,0);if(s instanceof es){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],d=e.args[l],h=this.evalExpression(d,t);o.setData(this,h,u.type,u.offset,t)}}else if(s instanceof rs){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],h=this.evalExpression(d,t);s.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=h.typeInfo),o.setData(this,h,s.format,l,t),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Fr?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new ne(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=_n._priority.get(t.name);_n._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new qa(r);if(e.operator==="*")return r instanceof qa?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof ne?r.value:r instanceof W?Array.from(r.data):null;switch(e.operator){case"+":{if(Te(i)){const l=i.map((u,d)=>+u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ne(+s,o)}case"-":{if(Te(i)){const l=i.map((u,d)=>-u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ne(-s,o)}case"!":{if(Te(i)){const l=i.map((u,d)=>u?0:1);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ne(s?0:1,o)}case"~":{if(Te(i)){const l=i.map((u,d)=>~u);return new W(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new ne(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=r instanceof ne?r.value:r instanceof W||r instanceof Ie?Array.from(r.data):null,o=i instanceof ne?i.value:i instanceof W||i instanceof Ie?Array.from(i.data):null;switch(e.operator){case"+":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y+g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_+h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h+_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l+u,d)}case"-":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y-g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_-h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h-_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l-u,d)}case"*":{if(Te(s)&&Te(o)){const h=s,g=o;if(r instanceof Ie&&i instanceof Ie){const _=function(x,S,A,R){if(wn[S.name]===void 0||wn[R.name]===void 0)return null;const E=wn[S.name][0],C=wn[S.name][1],O=wn[R.name][0];if(E!==wn[R.name][1])return null;const D=new Array(O*C);for(let M=0;M<C;M++)for(let P=0;P<O;P++){let k=0;for(let V=0;V<E;V++)k+=x[V*C+M]*A[P*E+V];D[M*O+P]=k}return D}(h,r.typeInfo,g,i.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const y=wn[i.typeInfo.name][0],T=wn[r.typeInfo.name][1],w=this.getTypeInfo(`mat${y}x${T}f`);return new Ie(_,w)}if(r instanceof Ie&&i instanceof W){const _=function(y,T,w,x){if(wn[T.name]===void 0||o0[x.name]===void 0)return null;const S=wn[T.name][0],A=wn[T.name][1];if(S!==w.length)return null;const R=new Array(A);for(let E=0;E<A;E++){let C=0;for(let O=0;O<S;O++)C+=y[O*A+E]*w[O];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,i.typeInfo)}if(r instanceof W&&i instanceof Ie){const _=function(y,T,w,x){if(o0[T.name]===void 0||wn[x.name]===void 0)return null;const S=wn[x.name][0],A=wn[x.name][1];if(A!==y.length)return null;const R=[];for(let E=0;E<S;E++){let C=0;for(let O=0;O<A;O++)C+=y[O]*w[O*S+E];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new W(_,r.typeInfo)}{if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y*g[T]);return new W(_,r.typeInfo)}}if(Te(s)){const h=o,g=s.map((_,y)=>_*h);return r instanceof Ie?new Ie(g,r.typeInfo):new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h*_);return i instanceof Ie?new Ie(g,i.typeInfo):new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l*u,d)}case"%":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y%g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_%h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h%_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l%u,d)}case"/":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y/g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_/h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h/_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l/u,d)}case"&":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y&g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_&h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h&_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l&u,d)}case"|":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y|g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_|h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h|_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l|u,d)}case"^":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y^g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_^h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h^_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l^u,d)}case"<<":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y<<g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_<<h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h<<_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l<<u,d)}case">>":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y>>g[T]);return new W(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_>>h);return new W(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h>>_);return new W(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new ne(l>>u,d)}case">":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>d?1:0);return new W(u,i.typeInfo)}return new ne(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<d?1:0);return new W(u,i.typeInfo)}return new ne(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h===u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d==l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l==d?1:0);return new W(u,i.typeInfo)}return new ne(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h!==u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d!==l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l!==d?1:0);return new W(u,i.typeInfo)}return new ne(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>=u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>=l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>=d?1:0);return new W(u,i.typeInfo)}return new ne(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<=u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<=l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<=d?1:0);return new W(u,i.typeInfo)}return new ne(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h&&u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d&&l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l&&d?1:0);return new W(u,i.typeInfo)}return new ne(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h||u[g]?1:0);return new W(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d||l?1:0);return new W(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l||d?1:0);return new W(u,i.typeInfo)}return new ne(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const i=t.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new ne(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=o0[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Gt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,t);if(u instanceof W){const d=u.data;for(let h=0;h<d.length;++h){let g=d[h];o.push(g)}}else if(u instanceof ne){let d=u.value;o.push(d)}}if(e.type instanceof oe&&e.type.format===null&&(e.type.format=oe.f32),o.length===0){const l=new Array(s).fill(0);return new W(l,r).getSubData(this,e.postfix,t)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new W(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=wn[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Gt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,t);u instanceof W?o.push(...u.data):u instanceof ne?o.push(u.value):u instanceof Ie&&o.push(...u.data)}if(r instanceof Bs&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new Ie(l,r).getSubData(this,e.postfix,t)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ie(o,r).getSubData(this,e.postfix,t)}}_n._breakObj=new dr(new cr("BREAK",null),null),_n._continueObj=new dr(new cr("CONTINUE",null),null),_n._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class mX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new gX,this._exec=new _n,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Xn){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(i=>{i instanceof Bk||i instanceof yf?i.type=this._forwardType(i.type):i instanceof Xl?i.format=this._forwardType(i.format):i instanceof hi||i instanceof Wl||i instanceof vf?i.type=this._forwardType(i.type):i instanceof lc?i.returnType=this._forwardType(i.returnType):i instanceof Lk&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof jk){const t=this._getType(e.name);if(t)return t}else e instanceof yf?e.type=this._forwardType(e.type):e instanceof Xl&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new sX(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==F.eof}_match(e){if(e instanceof ie)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let i=!1;for(const s of e){if(r===s)return!0;s===F.tokens.name&&(i=!0)}if(i){const s=F.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===F.tokens.name){const r=F.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(F.tokens.semicolon)&&!this._isAtEnd(););if(this._match(F.keywords.alias)){const t=this._type_alias();return this._consume(F.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(F.keywords.diagnostic)){const t=this._diagnostic();return this._consume(F.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(F.keywords.requires)){const t=this._requires_directive();return this._consume(F.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(F.keywords.enable)){const t=this._enable_directive();return this._consume(F.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(F.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(F.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(F.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(F.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(F.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(F.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(F.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(F.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(F.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(F.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(F.keywords.fn))return null;const e=this._currentLine,t=this._consume(F.tokens.ident,"Expected function name.").toString();this._consume(F.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(F.tokens.paren_right))do{if(this._check(F.tokens.paren_right))break;const l=this._attribute(),u=this._consume(F.tokens.name,"Expected argument name.").toString();this._consume(F.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=d,r.push(this._updateNode(new Lk(u,h,l))))}while(this._match(F.tokens.comma));this._consume(F.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(F.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new lc(t,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(F.tokens.brace_left,"Expected '{' for block.");!this._check(F.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(F.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(F.tokens.semicolon)&&!this._isAtEnd(););if(this._check(F.tokens.attr)&&this._attribute(),this._check(F.keywords.if))return this._if_statement();if(this._check(F.keywords.switch))return this._switch_statement();if(this._check(F.keywords.loop))return this._loop_statement();if(this._check(F.keywords.for))return this._for_statement();if(this._check(F.keywords.while))return this._while_statement();if(this._check(F.keywords.continuing))return this._continuing_statement();if(this._check(F.keywords.static_assert))return this._static_assert_statement();if(this._check(F.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(F.keywords.return))e=this._return_statement();else if(this._check([F.keywords.var,F.keywords.let,F.keywords.const]))e=this._variable_statement();else if(this._match(F.keywords.discard))e=this._updateNode(new nX);else if(this._match(F.keywords.break)){const t=this._updateNode(new wP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(F.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(F.keywords.continue)){const t=this._updateNode(new TP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(F.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(F.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new JW(t),e)}_while_statement(){if(!this._match(F.keywords.while))return null;const e=this._updateNode(new hP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(F.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(F.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new lx(r,e),t)}_for_statement(){if(!this._match(F.keywords.for))return null;this._consume(F.tokens.paren_left,"Expected '('.");const e=this._updateNode(new pP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(F.tokens.semicolon)?null:this._for_init(),this._consume(F.tokens.semicolon,"Expected ';'."),e.condition=this._check(F.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(F.tokens.semicolon,"Expected ';'."),e.increment=this._check(F.tokens.paren_right)?null:this._for_increment(),this._consume(F.tokens.paren_right,"Expected ')'."),this._check(F.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(F.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(F.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new hi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(F.keywords.let)){const e=this._currentLine,t=this._consume(F.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(F.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(F.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Wl(t,r,null,null,i),e)}if(this._match(F.keywords.const)){const e=this._currentLine,t=this._consume(F.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(F.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(F.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Gt&&(r=i.type),this._updateNode(new vf(t,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(F.increment_operators))return this._current=e,null;const r=this._consume(F.increment_operators,"Expected increment operator");return this._updateNode(new gP(r.type===F.tokens.plus_plus?Ya.increment:Ya.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(F.tokens.brace_right))return null;let r=this._match(F.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(F.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new mP(Bl.parse(i.lexeme),e,s),t)}_func_call_statement(){if(!this._check(F.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(F.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new I1(r.lexeme,i),e)}_loop_statement(){if(!this._match(F.keywords.loop))return null;this._check(F.tokens.attr)&&this._attribute(),this._consume(F.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new _P([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof lx){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(F.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(F.keywords.switch))return null;const e=this._updateNode(new vP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(F.tokens.attr)&&this._attribute(),this._consume(F.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(F.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([F.keywords.default,F.keywords.case]);){if(this._match(F.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof bf){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(F.tokens.colon),this._check(F.tokens.attr)&&this._attribute(),this._consume(F.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(F.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new CP(r,i)))}if(this._match(F.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(F.tokens.colon),this._check(F.tokens.attr)&&this._attribute(),this._consume(F.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(F.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new NP(r)))}}return e}_case_selectors(){const e=[];for(this._match(F.keywords.default)?e.push(this._updateNode(new bf)):e.push(this._shift_expression());this._match(F.tokens.comma);)this._match(F.keywords.default)?e.push(this._updateNode(new bf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(F.keywords.fallthrough))return this._consume(F.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(F.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(F.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(F.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(F.keywords.else)&&(this._check(F.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new yP(t,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===F.keywords.else&&this._tokens[this._current+1].type===F.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new rX(t,r))),this._match_elseif()&&(this._check(F.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(F.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new bP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(F.tokens.or_or);)e=this._updateNode(new wr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(F.tokens.and_and);)e=this._updateNode(new wr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(F.tokens.or);)e=this._updateNode(new wr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(F.tokens.xor);)e=this._updateNode(new wr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(F.tokens.and);)e=this._updateNode(new wr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([F.tokens.equal_equal,F.tokens.not_equal])?this._updateNode(new wr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([F.tokens.less_than,F.tokens.greater_than,F.tokens.less_than_equal,F.tokens.greater_than_equal]);)e=this._updateNode(new wr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([F.tokens.shift_left,F.tokens.shift_right]);)e=this._updateNode(new wr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([F.tokens.plus,F.tokens.minus]);)e=this._updateNode(new wr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([F.tokens.star,F.tokens.forward_slash,F.tokens.modulo]);)e=this._updateNode(new wr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([F.tokens.minus,F.tokens.bang,F.tokens.tilde,F.tokens.star,F.tokens.and])?this._updateNode(new Vt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(F.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(F.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new lo(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(F.tokens.period)){const e=this._consume(F.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new Us(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return _e.void;case"bool":return _e.bool;case"i32":return _e.i32;case"u32":return _e.u32;case"f32":return _e.f32;case"f16":return _e.f16;case"vec2f":return oe.vec2f;case"vec3f":return oe.vec3f;case"vec4f":return oe.vec4f;case"vec2i":return oe.vec2i;case"vec3i":return oe.vec3i;case"vec4i":return oe.vec4i;case"vec2u":return oe.vec2u;case"vec3u":return oe.vec3u;case"vec4u":return oe.vec4u;case"vec2h":return oe.vec2h;case"vec3h":return oe.vec3h;case"vec4h":return oe.vec4h;case"mat2x2f":return oe.mat2x2f;case"mat2x3f":return oe.mat2x3f;case"mat2x4f":return oe.mat2x4f;case"mat3x2f":return oe.mat3x2f;case"mat3x3f":return oe.mat3x3f;case"mat3x4f":return oe.mat3x4f;case"mat4x2f":return oe.mat4x2f;case"mat4x3f":return oe.mat4x3f;case"mat4x4f":return oe.mat4x4f;case"mat2x2h":return oe.mat2x2h;case"mat2x3h":return oe.mat2x3h;case"mat2x4h":return oe.mat2x4h;case"mat3x2h":return oe.mat3x2h;case"mat3x3h":return oe.mat3x3h;case"mat3x4h":return oe.mat3x4h;case"mat4x2h":return oe.mat4x2h;case"mat4x3h":return oe.mat4x3h;case"mat4x4h":return oe.mat4x4h;case"mat2x2i":return oe.mat2x2i;case"mat2x3i":return oe.mat2x3i;case"mat2x4i":return oe.mat2x4i;case"mat3x2i":return oe.mat3x2i;case"mat3x3i":return oe.mat3x3i;case"mat3x4i":return oe.mat3x4i;case"mat4x2i":return oe.mat4x2i;case"mat4x3i":return oe.mat4x3i;case"mat4x4i":return oe.mat4x4i;case"mat2x2u":return oe.mat2x2u;case"mat2x3u":return oe.mat2x3u;case"mat2x4u":return oe.mat2x4u;case"mat3x2u":return oe.mat3x2u;case"mat3x3u":return oe.mat3x3u;case"mat3x4u":return oe.mat3x4u;case"mat4x2u":return oe.mat4x2u;case"mat4x3u":return oe.mat4x3u;case"mat4x4u":return oe.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(F.tokens.ident)){const r=this._previous().toString();if(this._check(F.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Fr(s,i)):this._updateNode(new P1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new SP(r,i.value))}return this._updateNode(new Xn(r))}if(this._match(F.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?_e.i32:r.endsWith("u")||r.endsWith("U")?_e.u32:_e.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Gt(new ne(s,this._exec.getTypeInfo(i)),i))}if(this._match(F.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_e.u32),this._updateNode(new Gt(new ne(r,this._exec.getTypeInfo(_e.u32)),_e.u32))}if(this._match([F.tokens.decimal_float_literal,F.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?_e.f16:_e.f32);const o=i?_e.f16:_e.f32;return this._updateNode(new Gt(new ne(s,this._exec.getTypeInfo(o)),o))}if(this._match([F.keywords.true,F.keywords.false])){let r=this._previous().toString()===F.keywords.true.rule;return this._updateNode(new Gt(new ne(r?1:0,this._exec.getTypeInfo(_e.bool)),_e.bool))}if(this._check(F.tokens.paren_left))return this._paren_expression();if(this._match(F.keywords.bitcast)){this._consume(F.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(F.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new EP(r,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Fr(e,t))}_argument_expression_list(){if(!this._match(F.tokens.paren_left))return null;const e=[];do{if(this._check(F.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(F.tokens.comma));return this._consume(F.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(F.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(F.tokens.paren_right),e}_paren_expression(){this._consume(F.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(F.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(F.keywords.struct))return null;const e=this._currentLine,t=this._consume(F.tokens.ident,"Expected name for struct.").toString();this._consume(F.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(F.tokens.brace_right);){const o=this._attribute(),l=this._consume(F.tokens.name,"Expected variable name.").toString();this._consume(F.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(F.tokens.brace_right)?this._match(F.tokens.comma):this._consume(F.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new Bk(l,d,o)))}this._consume(F.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new fi(t,r,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(F.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Gt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Gt&&(e.type=e.value.type.name==="x32"?_e.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(F.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(F.keywords.const))return null;const t=this._consume(F.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(F.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(F.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[_e.f32],d=o.constEvaluate(this._exec,u);d instanceof ne&&this._validateTypeRange(d.value,u[0]),u[0]instanceof oe&&u[0].format===null&&d.typeInfo instanceof Bs&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=_e.f16:d.typeInfo.format.name==="f32"?u[0].format=_e.f32:d.typeInfo.format.name==="i32"?u[0].format=_e.i32:d.typeInfo.format.name==="u32"?u[0].format=_e.u32:d.typeInfo.format.name==="bool"?u[0].format=_e.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new Gt(d,u[0])),this._exec.context.setVariable(t.toString(),d)}catch{s=o}if(i!==null&&s instanceof Gt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Gt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:_e.f32,i===_e.x32&&(i=_e.i32));const l=this._updateNode(new vf(t.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(F.keywords.let))return null;const e=this._currentLine,t=this._consume(F.tokens.name,"Expected variable name");let r=null;if(this._match(F.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(F.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Gt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Gt&&(r=i.type.name==="x32"?_e.i32:i.type);return i instanceof Gt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new Wl(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(F.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(F.tokens.less_than)&&(t=this._consume(F.storage_class,"Expected storage_class.").toString(),this._match(F.tokens.comma)&&(r=this._consume(F.access_mode,"Expected access_mode.").toString()),this._consume(F.tokens.greater_than,"Expected '>'."));const i=this._consume(F.tokens.name,"Expected variable name");let s=null;if(this._match(F.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new hi(i.toString(),s,t,r,null),e)}_override_decl(){if(!this._match(F.keywords.override))return null;const e=this._consume(F.tokens.name,"Expected variable name");let t=null;if(this._match(F.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new M1(e.toString(),t,null))}_diagnostic(){this._consume(F.tokens.paren_left,"Expected '('");const e=this._consume(F.tokens.ident,"Expected severity control name.");this._consume(F.tokens.comma,"Expected ','");let t=this._consume(F.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(F.tokens.period)&&(t+=`.${this._consume(F.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(F.tokens.paren_right,"Expected ')'"),this._updateNode(new xP(e.toString(),t))}_enable_directive(){const e=this._consume(F.tokens.ident,"identity expected.");return this._updateNode(new eX(e.toString()))}_requires_directive(){const e=[this._consume(F.tokens.ident,"identity expected.").toString()];for(;this._match(F.tokens.comma);){const t=this._consume(F.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new tX(e))}_type_alias(){const e=this._consume(F.tokens.ident,"identity expected.");this._consume(F.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new O1(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([F.tokens.ident,...F.texel_format,F.keywords.bool,F.keywords.f32,F.keywords.i32,F.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new jk(r));return this._forwardTypeCount++,i}return this._updateNode(new _e(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(F.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(F.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(F.tokens.comma)&&(s=this._consume(F.access_mode,"Expected access_mode for pointer").toString()),this._consume(F.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new oe(r,i,s))}if(this._match(F.keywords.ptr)){let r=this._previous().toString();this._consume(F.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(F.storage_class,"Expected storage_class for pointer");this._consume(F.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(F.tokens.comma)&&(o=this._consume(F.access_mode,"Expected access_mode for pointer").toString()),this._consume(F.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new yf(r,i.toString(),s,o))}const t=this._attribute();if(this._match(F.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(F.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(F.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(F.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new Xl(s.toString(),t,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(F.sampler_type))return this._updateNode(new Ul(this._previous().toString(),null,null));if(this._match(F.depth_texture_type))return this._updateNode(new Ul(this._previous().toString(),null,null));if(this._match(F.sampled_texture_type)||this._match(F.multisampled_texture_type)){const e=this._previous();this._consume(F.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(F.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ul(e.toString(),t,null))}if(this._match(F.storage_texture_type)){const e=this._previous();this._consume(F.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(F.texel_format,"Invalid texel format.").toString();this._consume(F.tokens.comma,"Expected ',' after texel format.");const r=this._consume(F.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(F.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ul(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(F.tokens.attr);){const t=this._consume(F.attribute_name,"Expected attribute name"),r=this._updateNode(new kP(t.toString(),null));if(this._match(F.tokens.paren_left)){if(r.value=this._consume(F.literal_or_ident,"Expected attribute value").toString(),this._check(F.tokens.comma)){this._advance();do{const i=this._consume(F.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(F.tokens.comma))}this._consume(F.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class _X extends Vr{constructor(e){super(),e&&this.update(e)}update(e){const t=new mX().parse(e);this.updateAST(t)}}function vX(n){var s;const e={attributes:[],bindings:[]};let t;try{t=yX(n)}catch(o){return be.error(o.message)(),e}for(const o of t.uniforms){const l=[];for(const u of((s=o.type)==null?void 0:s.members)||[])l.push({name:u.name,type:zk(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=t.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const l=r.inputs[o];if(l.locationType==="location"){const u=zk(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function zk(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function yX(n){try{return new _X(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const bX={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...bX}};const ur=globalThis.mathgl.config;function xX(n,{precision:e=ur.precision}={}){return n=wX(n),`${parseFloat(n.toPrecision(e))}`}function co(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Yn(n,e,t){return SX(n,r=>Math.max(e,Math.min(t,r)))}function Zf(n,e,t){return co(n)?n.map((r,i)=>Zf(r,e[i],t)):t*e+(1-t)*n}function cc(n,e,t){const r=ur.EPSILON;try{if(n===e)return!0;if(co(n)&&co(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!cc(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=ur.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{ur.EPSILON=r}}function wX(n){return Math.round(n/ur.EPSILON)*ur.EPSILON}function TX(n){return n.clone?n.clone():new Array(n.length)}function SX(n,e,t){if(co(n)){const r=n;t=t||TX(r);for(let i=0;i<t.length&&i<r.length;++i){const s=typeof n=="number"?n:n[i];t[i]=e(s,i,t)}return t}return e(n)}class MP extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:co(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ur)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+xX(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!cc(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof t=="number"?t:t[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ur.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function EX(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function Wn(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function l0(n,e,t=""){if(ur.debug&&!EX(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Vk(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class AX extends MP{get x(){return this[0]}set x(e){this[0]=Wn(e)}get y(){return this[1]}set y(e){this[1]=Wn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return Wn(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Wn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Vk(e>=0&&e<this.ELEMENTS,"index is out of range"),Wn(this[e])}setComponent(e,t){return Vk(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const xf=1e-6;let uo=typeof Float32Array<"u"?Float32Array:Array;function RX(){const n=new uo(2);return uo!=Float32Array&&(n[0]=0,n[1]=0),n}function qk(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function CX(n,e){return n[0]=-e[0],n[1]=-e[1],n}function IP(n,e,t,r){const i=e[0],s=e[1];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n}function NX(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){const n=RX();return function(e,t,r,i,s,o){let l,u;for(t||(t=2),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],s(n,n,o),e[l]=n[0],e[l+1]=n[1];return e}})();function kX(n,e,t){const r=e[0],i=e[1],s=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/s,n[1]=(t[1]*r+t[5]*i)/s,n}function OP(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[3]*r+t[7]*i+t[11]*s||1;return n[0]=(t[0]*r+t[4]*i+t[8]*s)/o,n[1]=(t[1]*r+t[5]*i+t[9]*s)/o,n[2]=(t[2]*r+t[6]*i+t[10]*s)/o,n}function MX(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function IX(){const n=new uo(3);return uo!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function OX(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function PX(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function DX(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function jX(n,e,t){const r=e[0],i=e[1],s=e[2],o=t[0],l=t[1],u=t[2];return n[0]=i*u-s*l,n[1]=s*o-r*u,n[2]=r*l-i*o,n}function PP(n,e,t){const r=e[0],i=e[1],s=e[2];let o=t[3]*r+t[7]*i+t[11]*s+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*i+t[8]*s+t[12])/o,n[1]=(t[1]*r+t[5]*i+t[9]*s+t[13])/o,n[2]=(t[2]*r+t[6]*i+t[10]*s+t[14])/o,n}function LX(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=r*t[0]+i*t[3]+s*t[6],n[1]=r*t[1]+i*t[4]+s*t[7],n[2]=r*t[2]+i*t[5]+s*t[8],n}function BX(n,e,t){const r=t[0],i=t[1],s=t[2],o=t[3],l=e[0],u=e[1],d=e[2];let h=i*d-s*u,g=s*l-r*d,_=r*u-i*l,y=i*_-s*g,T=s*h-r*_,w=r*g-i*h;const x=o*2;return h*=x,g*=x,_*=x,y*=2,T*=2,w*=2,n[0]=l+h+y,n[1]=u+g+T,n[2]=d+_+w,n}function UX(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function FX(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function zX(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function VX(n,e){const t=n[0],r=n[1],i=n[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((t*t+r*r+i*i)*(s*s+o*o+l*l)),d=u&&DX(n,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const qX=OX;(function(){const n=IX();return function(e,t,r,i,s,o){let l,u;for(t||(t=3),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],s(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2];return e}})();const c0=[0,0,0];let tf;class $r extends AX{static get ZERO(){return tf||(tf=new $r(0,0,0),Object.freeze(tf)),tf}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&co(e)?this.copy(e):(ur.debug&&(Wn(e),Wn(t),Wn(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ur.debug&&(Wn(e.x),Wn(e.y),Wn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Wn(e)}angle(e){return VX(this,e)}cross(e){return jX(this,this,e),this.check()}rotateX({radians:e,origin:t=c0}){return UX(this,this,t,e),this.check()}rotateY({radians:e,origin:t=c0}){return FX(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=c0}){return zX(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return PP(this,this,e),this.check()}transformAsVector(e){return OP(this,this,e),this.check()}transformByMatrix3(e){return LX(this,this,e),this.check()}transformByMatrix2(e){return MX(this,this,e),this.check()}transformByQuaternion(e){return BX(this,this,e),this.check()}}class $X extends MP{toString(){let e="[";if(ur.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Wn(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function HX(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function WX(n,e){if(n===e){const t=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=s,n[11]=e[14],n[12]=i,n[13]=o,n[14]=l}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function ux(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],d=e[7],h=e[8],g=e[9],_=e[10],y=e[11],T=e[12],w=e[13],x=e[14],S=e[15],A=t*l-r*o,R=t*u-i*o,E=t*d-s*o,C=r*u-i*l,O=r*d-s*l,D=i*d-s*u,M=h*w-g*T,P=h*x-_*T,k=h*S-y*T,V=g*x-_*w,X=g*S-y*w,Z=_*S-y*x;let $=A*Z-R*X+E*V+C*k-O*P+D*M;return $?($=1/$,n[0]=(l*Z-u*X+d*V)*$,n[1]=(i*X-r*Z-s*V)*$,n[2]=(w*D-x*O+S*C)*$,n[3]=(_*O-g*D-y*C)*$,n[4]=(u*k-o*Z-d*P)*$,n[5]=(t*Z-i*k+s*P)*$,n[6]=(x*E-T*D-S*R)*$,n[7]=(h*D-_*E+y*R)*$,n[8]=(o*X-l*k+d*M)*$,n[9]=(r*k-t*X-s*M)*$,n[10]=(T*O-w*E+S*A)*$,n[11]=(g*E-h*O-y*A)*$,n[12]=(l*P-o*V-u*M)*$,n[13]=(t*V-r*P+i*M)*$,n[14]=(w*R-T*C-x*A)*$,n[15]=(h*C-g*R+_*A)*$,n):null}function XX(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],o=n[5],l=n[6],u=n[7],d=n[8],h=n[9],g=n[10],_=n[11],y=n[12],T=n[13],w=n[14],x=n[15],S=e*o-t*s,A=e*l-r*s,R=t*l-r*o,E=d*T-h*y,C=d*w-g*y,O=h*w-g*T,D=e*O-t*C+r*E,M=s*O-o*C+l*E,P=d*R-h*A+g*S,k=y*R-T*A+w*S;return u*D-i*M+x*P-_*k}function Os(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],d=e[6],h=e[7],g=e[8],_=e[9],y=e[10],T=e[11],w=e[12],x=e[13],S=e[14],A=e[15];let R=t[0],E=t[1],C=t[2],O=t[3];return n[0]=R*r+E*l+C*g+O*w,n[1]=R*i+E*u+C*_+O*x,n[2]=R*s+E*d+C*y+O*S,n[3]=R*o+E*h+C*T+O*A,R=t[4],E=t[5],C=t[6],O=t[7],n[4]=R*r+E*l+C*g+O*w,n[5]=R*i+E*u+C*_+O*x,n[6]=R*s+E*d+C*y+O*S,n[7]=R*o+E*h+C*T+O*A,R=t[8],E=t[9],C=t[10],O=t[11],n[8]=R*r+E*l+C*g+O*w,n[9]=R*i+E*u+C*_+O*x,n[10]=R*s+E*d+C*y+O*S,n[11]=R*o+E*h+C*T+O*A,R=t[12],E=t[13],C=t[14],O=t[15],n[12]=R*r+E*l+C*g+O*w,n[13]=R*i+E*u+C*_+O*x,n[14]=R*s+E*d+C*y+O*S,n[15]=R*o+E*h+C*T+O*A,n}function Qf(n,e,t){const r=t[0],i=t[1],s=t[2];let o,l,u,d,h,g,_,y,T,w,x,S;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*s+e[12],n[13]=e[1]*r+e[5]*i+e[9]*s+e[13],n[14]=e[2]*r+e[6]*i+e[10]*s+e[14],n[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],d=e[3],h=e[4],g=e[5],_=e[6],y=e[7],T=e[8],w=e[9],x=e[10],S=e[11],n[0]=o,n[1]=l,n[2]=u,n[3]=d,n[4]=h,n[5]=g,n[6]=_,n[7]=y,n[8]=T,n[9]=w,n[10]=x,n[11]=S,n[12]=o*r+h*i+T*s+e[12],n[13]=l*r+g*i+w*s+e[13],n[14]=u*r+_*i+x*s+e[14],n[15]=d*r+y*i+S*s+e[15]),n}function U1(n,e,t){const r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function YX(n,e,t,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,d,h,g,_,y,T,w,x,S,A,R,E,C,O,D,M,P,k,V,X,Z,$,H;return l<xf?null:(l=1/l,i*=l,s*=l,o*=l,d=Math.sin(t),u=Math.cos(t),h=1-u,g=e[0],_=e[1],y=e[2],T=e[3],w=e[4],x=e[5],S=e[6],A=e[7],R=e[8],E=e[9],C=e[10],O=e[11],D=i*i*h+u,M=s*i*h+o*d,P=o*i*h-s*d,k=i*s*h-o*d,V=s*s*h+u,X=o*s*h+i*d,Z=i*o*h+s*d,$=s*o*h-i*d,H=o*o*h+u,n[0]=g*D+w*M+R*P,n[1]=_*D+x*M+E*P,n[2]=y*D+S*M+C*P,n[3]=T*D+A*M+O*P,n[4]=g*k+w*V+R*X,n[5]=_*k+x*V+E*X,n[6]=y*k+S*V+C*X,n[7]=T*k+A*V+O*X,n[8]=g*Z+w*$+R*H,n[9]=_*Z+x*$+E*H,n[10]=y*Z+S*$+C*H,n[11]=T*Z+A*$+O*H,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function DP(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],l=e[6],u=e[7],d=e[8],h=e[9],g=e[10],_=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=s*i+d*r,n[5]=o*i+h*r,n[6]=l*i+g*r,n[7]=u*i+_*r,n[8]=d*i-s*r,n[9]=h*i-o*r,n[10]=g*i-l*r,n[11]=_*i-u*r,n}function GX(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],l=e[2],u=e[3],d=e[8],h=e[9],g=e[10],_=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i-d*r,n[1]=o*i-h*r,n[2]=l*i-g*r,n[3]=u*i-_*r,n[8]=s*r+d*i,n[9]=o*r+h*i,n[10]=l*r+g*i,n[11]=u*r+_*i,n}function jP(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],l=e[2],u=e[3],d=e[4],h=e[5],g=e[6],_=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i+d*r,n[1]=o*i+h*r,n[2]=l*i+g*r,n[3]=u*i+_*r,n[4]=d*i-s*r,n[5]=h*i-o*r,n[6]=g*i-l*r,n[7]=_*i-u*r,n}function KX(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],o=t+t,l=r+r,u=i+i,d=t*o,h=r*o,g=r*l,_=i*o,y=i*l,T=i*u,w=s*o,x=s*l,S=s*u;return n[0]=1-g-T,n[1]=h+S,n[2]=_-x,n[3]=0,n[4]=h-S,n[5]=1-d-T,n[6]=y+w,n[7]=0,n[8]=_+x,n[9]=y-w,n[10]=1-d-g,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ZX(n,e,t,r,i,s,o){const l=1/(t-e),u=1/(i-r),d=1/(s-o);return n[0]=s*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*u,n[6]=0,n[7]=0,n[8]=(t+e)*l,n[9]=(i+r)*u,n[10]=(o+s)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*s*2*d,n[15]=0,n}function QX(n,e,t,r,i){const s=1/Math.tan(e/2);if(n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const o=1/(r-i);n[10]=(i+r)*o,n[14]=2*i*r*o}else n[10]=-1,n[14]=-2*r;return n}const JX=QX;function eY(n,e,t,r,i,s,o){const l=1/(e-t),u=1/(r-i),d=1/(s-o);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*l,n[13]=(i+r)*u,n[14]=(o+s)*d,n[15]=1,n}const tY=eY;function nY(n,e,t,r){let i,s,o,l,u,d,h,g,_,y;const T=e[0],w=e[1],x=e[2],S=r[0],A=r[1],R=r[2],E=t[0],C=t[1],O=t[2];return Math.abs(T-E)<xf&&Math.abs(w-C)<xf&&Math.abs(x-O)<xf?HX(n):(g=T-E,_=w-C,y=x-O,i=1/Math.sqrt(g*g+_*_+y*y),g*=i,_*=i,y*=i,s=A*y-R*_,o=R*g-S*y,l=S*_-A*g,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=_*l-y*o,d=y*s-g*l,h=g*o-_*s,i=Math.sqrt(u*u+d*d+h*h),i?(i=1/i,u*=i,d*=i,h*=i):(u=0,d=0,h=0),n[0]=s,n[1]=u,n[2]=g,n[3]=0,n[4]=o,n[5]=d,n[6]=_,n[7]=0,n[8]=l,n[9]=h,n[10]=y,n[11]=0,n[12]=-(s*T+o*w+l*x),n[13]=-(u*T+d*w+h*x),n[14]=-(g*T+_*w+y*x),n[15]=1,n)}function rY(){const n=new uo(4);return uo!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function iY(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Rc(n,e,t){const r=e[0],i=e[1],s=e[2],o=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*s+t[12]*o,n[1]=t[1]*r+t[5]*i+t[9]*s+t[13]*o,n[2]=t[2]*r+t[6]*i+t[10]*s+t[14]*o,n[3]=t[3]*r+t[7]*i+t[11]*s+t[15]*o,n}(function(){const n=rY();return function(e,t,r,i,s,o){let l,u;for(t||(t=4),r||(r=0),i?u=Math.min(i*t+r,e.length):u=e.length,l=r;l<u;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],s(n,n,o),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();var fx;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(fx||(fx={}));const sY=45*Math.PI/180,aY=1,u0=.1,f0=500,oY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Cr extends $X{static get IDENTITY(){return cY()}static get ZERO(){return lY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return fx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=d,this[9]=h,this[10]=g,this[11]=_,this[12]=y,this[13]=T,this[14]=w,this[15]=x,this.check()}setRowMajor(e,t,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=s,this[2]=d,this[3]=y,this[4]=t,this[5]=o,this[6]=h,this[7]=T,this[8]=r,this[9]=l,this[10]=g,this[11]=w,this[12]=i,this[13]=u,this[14]=_,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(oY)}fromObject(e){return this.check()}fromQuaternion(e){return KX(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:s,near:o=u0,far:l=f0}=e;return l===1/0?uY(this,t,r,i,s,o):ZX(this,t,r,i,s,o,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return nY(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:s,near:o=u0,far:l=f0}=e;return tY(this,t,r,i,s,o,l),this.check()}orthographic(e){const{fovy:t=sY,aspect:r=aY,focalDistance:i=1,near:s=u0,far:o=f0}=e;$k(t);const l=t/2,u=i*Math.tan(l),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return $k(t),JX(this,t,r,i,s),this.check()}determinant(){return XX(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return WX(this,this),this.check()}invert(){return ux(this,this),this.check()}multiplyLeft(e){return Os(this,e,this),this.check()}multiplyRight(e){return Os(this,this,e),this.check()}rotateX(e){return DP(this,this,e),this.check()}rotateY(e){return GX(this,this,e),this.check()}rotateZ(e){return jP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return YX(this,this,e,t),this.check()}scale(e){return U1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Qf(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Rc(t||[-0,-0,-0,-0],e,this),l0(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=NX(t||[-0,-0],e,this);break;case 3:i=PP(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return l0(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=kX(t||[-0,-0],e,this);break;case 3:r=OP(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return l0(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let nf,rf;function lY(){return nf||(nf=new Cr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(nf)),nf}function cY(){return rf||(rf=new Cr,Object.freeze(rf)),rf}function $k(n){if(n>Math.PI*2)throw Error("expected radians")}function uY(n,e,t,r,i,s){const o=2*s/(t-e),l=2*s/(i-r),u=(t+e)/(t-e),d=(i+r)/(i-r),h=-1,g=-1,_=-2*s;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=u,n[9]=d,n[10]=h,n[11]=g,n[12]=0,n[13]=0,n[14]=_,n[15]=0,n}function LP(n,e=[],t=0){const r=Math.fround(n),i=n-r;return e[t]=r,e[t+1]=i,e}function fY(n){return n-Math.fround(n)}function dY(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const i=t*4+r;LP(n[r*4+t],e,i*2)}return e}const hY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,pY={name:"fp32",vs:hY},gY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,mY={ONE:1},_Y={name:"fp64arithmetic",vs:gY,defaultUniforms:mY,uniformTypes:{ONE:"f32"},fp64ify:LP,fp64LowPart:fY,fp64ifyMatrix4:dY},vY=[0,1,1,1],yY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,bY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Hk={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:vY},vs:yY,fs:bY,getUniforms:xY};function xY(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Wk=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,wY={name:"layer",vs:Wk,fs:Wk,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},TY=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,BP="#define SMOOTH_EDGE_RADIUS 0.5",SY=`${BP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,EY=`${BP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,UP={name:"geometry",source:TY,vs:SY,fs:EY},AY=25;var qt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(qt||(qt={}));var Kt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Kt||(Kt={}));var je;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(je||(je={}));const RY="compute",CY="auto",dx="manipulation",wf="none",hx="pan-x",px="pan-y";function NY(n){if(n.includes(wf))return wf;const e=n.includes(hx),t=n.includes(px);return e&&t?wf:e||t?e?hx:px:n.includes(dx)?dx:CY}class kY{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===RY&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return NY(e.join(" "))}}function Jf(n){return n.trim().split(/\s+/g)}function d0(n,e,t){if(n)for(const r of Jf(e))n.addEventListener(r,t,!1)}function h0(n,e,t){if(n)for(const r of Jf(e))n.removeEventListener(r,t,!1)}function Xk(n){return(n.ownerDocument||n).defaultView}function MY(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function FP(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,i=0;for(;i<e;)t+=n[i].clientX,r+=n[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(r/e)}}function Yk(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:FP(e),deltaX:n.deltaX,deltaY:n.deltaY}}function zP(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function Gk(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function IY(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function Kk(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function VP(n,e){return n===e?Kt.None:Math.abs(n)>=Math.abs(e)?n<0?Kt.Left:Kt.Right:e<0?Kt.Up:Kt.Down}function OY(n,e){const t=e.center;let r=n.offsetDelta,i=n.prevDelta;const s=n.prevInput;return(e.eventType===qt.Start||(s==null?void 0:s.eventType)===qt.End)&&(i=n.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-r.x),deltaY:i.y+(t.y-r.y)}}function qP(n,e,t){return{x:e/n||0,y:t/n||0}}function PY(n,e){return Gk(e[0],e[1])/Gk(n[0],n[1])}function DY(n,e){return Kk(e[1],e[0])-Kk(n[1],n[0])}function jY(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let i,s,o,l;if(e.eventType!==qt.Cancel&&(r>AY||t.velocity===void 0)){const u=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,h=qP(r,u,d);s=h.x,o=h.y,i=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,l=VP(u,d),n.lastInterval=e}else i=t.velocity,s=t.velocityX,o=t.velocityY,l=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function LY(n,e){const{session:t}=n,{pointers:r}=e,{length:i}=r;t.firstInput||(t.firstInput=Yk(e)),i>1&&!t.firstMultiple?t.firstMultiple=Yk(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=t,l=o?o.center:s.center,u=e.center=FP(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=IY(l,u),e.distance=zP(l,u);const{deltaX:d,deltaY:h}=OY(t,e);e.deltaX=d,e.deltaY=h,e.offsetDirection=VP(e.deltaX,e.deltaY);const g=qP(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?PY(o.pointers,r):1,e.rotation=o?DY(o.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let _=n.element;return MY(e.srcEvent.target,_)&&(_=e.srcEvent.target),e.target=_,jY(t,e),e}function BY(n,e,t){const r=t.pointers.length,i=t.changedPointers.length,s=e&qt.Start&&r-i===0,o=e&(qt.End|qt.Cancel)&&r-i===0;t.isFirst=!!s,t.isFinal=!!o,s&&(n.session={}),t.eventType=e;const l=LY(n,t);n.emit("hammer.input",l),n.recognize(l),n.session.prevInput=l}let UY=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){BY(this.manager,e,t)}init(){d0(this.element,this.evEl,this.domHandler),d0(this.target,this.evTarget,this.domHandler),d0(Xk(this.element),this.evWin,this.domHandler)}destroy(){h0(this.element,this.evEl,this.domHandler),h0(this.target,this.evTarget,this.domHandler),h0(Xk(this.element),this.evWin,this.domHandler)}};const FY={pointerdown:qt.Start,pointermove:qt.Move,pointerup:qt.End,pointercancel:qt.Cancel,pointerout:qt.Cancel},zY="pointerdown",VY="pointermove pointerup pointercancel";class qY extends UY{constructor(e){super(e),this.evEl=zY,this.evWin=VY,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const i=FY[e.type],s=e.pointerType,o=s==="touch";let l=t.findIndex(u=>u.pointerId===e.pointerId);i&qt.Start&&(e.buttons||o)?l<0&&(t.push(e),l=t.length-1):i&(qt.End|qt.Cancel)&&(r=!0),!(l<0)&&(t[l]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&t.splice(l,1))}}const $Y=["","webkit","Moz","MS","ms","o"];function HY(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of $Y){const i=r?r+t:e;if(i in n)return i}}const WY=1,Zk=2,Qk={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class XY{constructor(e,t){this.options={...Qk,...t,cssProps:{...Qk.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new qY(this),this.touchAction=new kY(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Zk:WY}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&je.Recognized)&&(s=t.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],t.stopped!==Zk&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(je.Began|je.Changed|je.Ended)&&(s=t.curRecognizer=r),o++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const i of Jf(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const i of Jf(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,i]of Object.entries(this.options.cssProps)){const s=HY(t.style,r);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let YY=1;function GY(){return YY++}function Jk(n){return n&je.Cancelled?"cancel":n&je.Ended?"end":n&je.Changed?"move":n&je.Began?"start":""}class $P{constructor(e){this.options=e,this.id=GY(),this.state=je.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<je.Ended&&this.manager.emit(this.options.event+Jk(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=je.Ended&&this.manager.emit(this.options.event+Jk(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=je.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(je.Failed|je.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=je.Failed;return}this.state&(je.Recognized|je.Cancelled|je.Failed)&&(this.state=je.Possible),this.state=this.process(t),this.state&(je.Began|je.Changed|je.Ended|je.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class HP extends $P{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,i=t&(je.Began|je.Changed),s=this.attrTest(e);return i&&(r&qt.Cancel||!s)?t|je.Cancelled:i||s?r&qt.End?t|je.Ended:t&je.Began?t|je.Changed:je.Began:je.Failed}}class e4 extends $P{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[dx]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&qt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==qt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,l=!this.pCenter||zP(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=je.Recognized,this.tryEmit(this._input)},t.interval),je.Began):je.Recognized}return je.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=je.Failed},this.options.interval),je.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===je.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const KY=["","start","move","end","cancel","up","down","left","right"];class t4 extends HP{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Kt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Kt.Horizontal&&t.push(px),e&Kt.Vertical&&t.push(hx),t}getEventNames(){return KY.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&t.direction||(t.direction&Kt.Horizontal?(s=o===0?Kt.None:o<0?Kt.Left:Kt.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?Kt.None:l<0?Kt.Up:Kt.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&je.Began)||!(this.state&je.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Kt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const ZY=["","start","move","end","cancel","in","out"];class QY extends HP{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[wf]}getEventNames(){return ZY.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&je.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class eh{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const JY=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",eG=JY.indexOf("firefox")!==-1,n4=4.000244140625,tG=40,nG=.25;class rG extends eh{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(eG&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=tG)),s!==0&&s%n4===0&&(s=Math.floor(s/n4)),i.shiftKey&&s&&(s=s*nG),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const r4=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class iG extends eh{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,r4.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){r4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const i4=["keydown","keyup"];class sG extends eh{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",i4.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){i4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class aG extends eh{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const s4=1,gx=2,a4=4,oG={pointerdown:s4,pointermove:gx,pointerup:a4,mousedown:s4,mousemove:gx,mouseup:a4},lG=0,cG=1,uG=2,fG=1,dG=2,hG=4;function pG(n){const e=oG[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,s=!1,o=!1;return e===gx?(i=!!(t&fG),s=!!(t&hG),o=!!(t&dG)):(i=r===lG,s=r===cG,o=r===uG),{leftButton:i,middleButton:s,rightButton:o}}function gG(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/s};return{center:t,offsetCenter:o}}const mG={srcElement:"root",priority:0};class _G{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...mG,...r};let d=l.get(u.srcElement);d||(d=[],l.set(u.srcElement,d));const h={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let g=d.length-1;for(;g>=0&&!(d[g].priority>=h.priority);)g--;d.splice(g+1,0,h)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===t){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:d,handler:h,once:g}=r[u];if(h({...e,type:d,stopPropagation:s,stopImmediatePropagation:o}),g&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:d,handler:h}=l[u];this.remove(d,h)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...pG(e),...gG(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function vG(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),i=t.shift()||{};e=new r(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class yG{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new XY(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=vG(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new rG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new iG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new sG(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new aG(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var s,o,l,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,t),(o=this.moveInput)==null||o.enableEventType(e,t),(l=this.keyInput)==null||l.enableEventType(e,t),(u=this.contextmenuInput)==null||u.enableEventType(e,t)}_addEventHandler(e,t,r,i,s){if(typeof e!="string"){r=t;for(const[d,h]of Object.entries(e))this._addEventHandler(d,h,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new _G(this,d),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,t,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:t.options.event}}const Ze={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ze,"IDENTITY",{get:()=>(gt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const lr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Fs={common:0,meters:1,pixels:2},mx={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},o4={multipan:[t4,{threshold:10,direction:Kt.Vertical,pointers:2}],pinch:[QY,{},null,["multipan"]],pan:[t4,{threshold:1},["pinch"],["multipan"]],dblclick:[e4,{event:"dblclick",taps:2}],click:[e4,{event:"click"},null,["dblclick"]]};function bG(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function Cc(n){let e={},t;return r=>{for(const i in r)if(!bG(r[i],e[i])){t=n(r),e=r;break}return t}}const l4=[0,0,0,0],xG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],WP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wG=[0,0,0],XP=[0,0,0],TG=Cc(AG);function YP(n,e,t=XP){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,s=!0;switch(e===Ze.LNGLAT_OFFSETS||e===Ze.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case lr.WEB_MERCATOR:(e===Ze.LNGLAT||e===Ze.CARTESIAN)&&(i=[0,0,0],s=!1);break;case lr.WEB_MERCATOR_AUTO_OFFSET:e===Ze.LNGLAT?r=i:e===Ze.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case lr.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case lr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function SG(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:s,viewProjectionMatrix:o}=n,l=l4,u=l4,d=n.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:g,offsetMode:_}=YP(n,e,t);return _&&(u=n.projectPosition(h||g),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,l=Rc([],u,o),s=r||s,o=Os([],i,s),o=Os([],o,xG)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:g,geospatialOrigin:h}}function EG({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=Ze.DEFAULT,coordinateOrigin:i=XP,autoWrapLongitude:s=!1}){r===Ze.DEFAULT&&(r=n.isGeospatial?Ze.LNGLAT:Ze.CARTESIAN);const o=TG({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=t||WP,o}function AG({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:d}=SG(n,t,r),h=n.getDistanceScales(),g=[n.width*e,n.height*e],_=Rc([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,y={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!n._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:_,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:wG,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:WP,cameraPosition:l};if(d){const T=n.getDistanceScales(d);switch(t){case Ze.METER_OFFSETS:y.commonUnitsPerWorldUnit=T.unitsPerMeter,y.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case Ze.LNGLAT:case Ze.LNGLAT_OFFSETS:n._pseudoMeters||(y.commonUnitsPerMeter=T.unitsPerMeter),y.commonUnitsPerWorldUnit=T.unitsPerDegree,y.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case Ze.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return y}const RG=Object.keys(Ze).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ze[n]};`).join(""),CG=Object.keys(lr).map(n=>`const PROJECTION_MODE_${n}: i32 = ${lr[n]};`).join(""),NG=Object.keys(Fs).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Fs[n]};`).join(""),kG=`${RG}
${CG}
${NG}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,MG=`${kG}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,IG=Object.keys(Ze).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ze[n]};`).join(""),OG=Object.keys(lr).map(n=>`const int PROJECTION_MODE_${n} = ${lr[n]};`).join(""),PG=Object.keys(Fs).map(n=>`const int UNIT_${n.toUpperCase()} = ${Fs[n]};`).join(""),DG=`${IG}
${OG}
${PG}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,jG={};function LG(n=jG){return"viewport"in n?EG(n):{}}const F1={name:"project",dependencies:[pY,UP],source:MG,vs:DG,getUniforms:LG,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},BG=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,UG=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,GP={name:"project32",dependencies:[F1],source:BG,vs:UG};function FG(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function no(n,e){const t=Rc([],e,n);return iY(t,t,1/t[3]),t}function c4(n,e){const t=n%e;return t<0?e+t:t}function _x(n,e,t){return n<e?e:n>t?t:n}function zG(n){return Math.log(n)*Math.LOG2E}const z1=Math.log2||zG;function mi(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Er=Math.PI,KP=Er/4,fr=Er/180,vx=180/Er,fo=512,ed=4003e4,u4=85.051129,VG=1.5;function qG(n){return z1(n)}function td(n){const[e,t]=n;mi(Number.isFinite(e)),mi(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*fr,i=t*fr,s=fo*(r+Er)/(2*Er),o=fo*(Er+Math.log(Math.tan(KP+i*.5)))/(2*Er);return[s,o]}function ho(n){const[e,t]=n,r=e/fo*(2*Er)-Er,i=2*(Math.atan(Math.exp(t/fo*(2*Er)-Er))-KP);return[r*vx,i*vx]}function $G(n){const{latitude:e}=n;mi(Number.isFinite(e));const t=Math.cos(e*fr);return qG(ed*t)-9}function p0(n){const e=Math.cos(n*fr);return fo/ed/e}function yx(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;mi(Number.isFinite(e)&&Number.isFinite(t));const i=fo,s=Math.cos(e*fr),o=i/360,l=o/s,u=i/ed/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const h=fr*Math.tan(e*fr)/s,g=o*h/2,_=i/ed*h,y=_/l*u;d.unitsPerDegree2=[0,g,_],d.unitsPerMeter2=[y,0,y]}return d}function ZP(n,e){const[t,r,i]=n,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:d}=yx({longitude:t,latitude:r,highPrecision:!0}),h=td(n);h[0]+=s*(u[0]+d[0]*o),h[1]+=o*(u[1]+d[1]*o);const g=ho(h),_=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[g[0],g[1],_]:g}function HG(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:s,center:o}=n,l=FG();Qf(l,l,[0,0,-i]),DP(l,l,-t*fr),jP(l,l,r*fr);const u=s/e;return U1(l,l,[u,u,u]),o&&Qf(l,l,PX([],o)),l}function WG(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:d=1}=n;let{fovy:h=nd(VG)}=n;r!==void 0&&(h=nd(r));const g=h*fr,_=i*fr,y=V1(h);let T=y;o&&(T+=o[2]*l/Math.cos(_)/t);const w=g*(.5+(s?s[1]:0)/t),x=Math.sin(w)*T/Math.sin(_x(Math.PI/2-_-w,.01,Math.PI-.01)),S=Math.sin(_)*x+T,A=T*10,R=Math.min(S*d,A);return{fov:g,aspect:e/t,focalDistance:y,near:u,far:R}}function nd(n){return 2*Math.atan(.5/n)*vx}function V1(n){return .5/Math.tan(.5*n*fr)}function QP(n,e){const[t,r,i=0]=n;return mi(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),no(e,[t,r,i,1])}function th(n,e,t=0){const[r,i,s]=n;if(mi(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return no(e,[r,i,s,1]);const o=no(e,[r,i,0,1]),l=no(e,[r,i,1,1]),u=o[2],d=l[2],h=u===d?0:((t||0)-u)/(d-u);return IP([],o,l,h)}function XG(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=n,[[l,u],[d,h]]=r,g=YG(n.padding),_=td([l,_x(h,-85.051129,u4)]),y=td([d,_x(u,-85.051129,u4)]),T=[Math.max(Math.abs(y[0]-_[0]),i),Math.max(Math.abs(y[1]-_[1]),i)],w=[e-g.left-g.right-Math.abs(o[0])*2,t-g.top-g.bottom-Math.abs(o[1])*2];mi(w[0]>0&&w[1]>0);const x=w[0]/T[0],S=w[1]/T[1],A=(g.right-g.left)/2/x,R=(g.top-g.bottom)/2/S,E=[(y[0]+_[0])/2+A,(y[1]+_[1])/2+R],C=ho(E),O=Math.min(s,z1(Math.abs(Math.min(x,S))));return mi(Number.isFinite(O)),{longitude:C[0],latitude:C[1],zoom:O}}function YG(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(mi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const f4=Math.PI/180;function GG(n,e=0){const{width:t,height:r,unproject:i}=n,s={targetZ:e},o=i([0,r],s),l=i([t,r],s);let u,d;const h=n.fovy?.5*n.fovy*f4:Math.atan(.5/n.altitude),g=(90-n.pitch)*f4;return h>g-.01?(u=d4(n,0,e),d=d4(n,t,e)):(u=i([0,0],s),d=i([t,0],s)),[o,l,d,u]}function d4(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=no(r,[e,0,1,1]),s=no(r,[e,n.height,1,1]),l=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=IP([],i,s,l),d=ho(u);return d.push(t),d}const h4=512;function KG(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=n;(i<-180||i>180)&&(i=c4(i+180,360)-180),(l<-180||l>180)&&(l=c4(l+180,360)-180);const u=z1(t/h4);if(o<=u)o=u,s=0;else{const d=t/2/Math.pow(2,o),h=ho([0,d])[1];if(s<h)s=h;else{const g=ho([0,h4-d])[1];s>g&&(s=g)}}return{width:e,height:t,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const JP=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,ZG=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,QG=`
${JP}
${ZG}
`,JG=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,eK=`
${JP}
${JG}
`,tK=Cc(aK),nK=Cc(oK),rK=[0,0,0,1],iK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function sK(n,e){const[t,r,i]=n,s=th([t,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function aK({viewport:n,center:e}){return new Cr(n.viewProjectionMatrix).invert().transform(e)}function oK({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,s=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(o=>sK(o,r));for(const o of e){const l=o.clone().translate(new $r(n.center).negate()),u=s.map(h=>l.transform(h)),d=new Cr().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});t.push(d.multiplyRight(o))}return t}function lK(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=F1.getUniforms(t),i=tK({viewport:t.viewport,center:r.center}),s=[],o=nK({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let u=0;u<n.shadowMatrices.length;u++){const d=o[u],h=d.clone().translate(new $r(t.viewport.center).negate());r.coordinateSystem===Ze.LNGLAT&&r.projectionMode===lr.WEB_MERCATOR?(o[u]=h,s[u]=i):(o[u]=d.clone().multiplyRight(iK),s[u]=h.transform(i))}const l={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||rK,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=n.shadowMaps&&n.shadowMaps[u]||n.dummyShadowMap;return l}const p4={name:"shadow",dependencies:[F1],vs:QG,fs:eK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:lK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},eD={...Hk,defaultUniforms:{...Hk.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},cK=[UP],uK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],fK=[];function dK(n){const e=Uf.getDefaultShaderAssembler();for(const r of cK)e.addDefaultModule(r);const t=n==="glsl"?uK:fK;for(const r of t)e.addShaderHook(r);return e}const hK=[255,255,255],pK=1;let gK=0;class mK{constructor(e={}){this.type="ambient";const{color:t=hK}=e,{intensity:r=pK}=e;this.id=e.id||`ambient-${gK++}`,this.color=t,this.intensity=r}}const _K=[255,255,255],vK=1,yK=[0,0,-1];let bK=0;class g4{constructor(e={}){this.type="directional";const{color:t=_K}=e,{intensity:r=vK}=e,{direction:i=yK}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${bK++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new $r(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class xK{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class q1 extends xK{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,t,r]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(h,e)}finally{h.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const h of s){const g=o&&o[h.id];l==null||l(h);const _=this._getDrawLayerParams(h,t),y=h.subViewports||[h];for(const T of y){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:T,view:g,pass:t.pass,layers:t.layers},_);d.push(w)}}return d}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},d=!1){var T;const h=[],g=tD(this._lastRenderIndex+1),_={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},y={};for(let w=0;w<t.length;w++){const x=t[w],S=this._shouldDrawLayer(x,_,s,y),A={shouldDrawLayer:S};S&&!d&&(A.shouldDrawLayer=!0,A.layerRenderIndex=g(x,S),A.shaderModuleProps=this._getShaderModuleProps(x,l,r,u),A.layerParameters={...(T=x.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(x,w,e)}),h[w]=A}return h}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const d=wK(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const g=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const h={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let g=0;g<t.length;g++){const _=t[g],y=u[g],{shouldDrawLayer:T}=y;if(T&&_.props.pickable&&h.pickableCount++,_.isComposite&&h.compositeCount++,_.isDrawable&&y.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:x,layerParameters:S}=y;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),x.project&&(x.project.viewport=o),_.context.renderPass=e;try{_._drawLayer({renderPass:e,shaderModuleProps:x,uniforms:{layerIndex:w},parameters:S})}catch(A){_.raiseError(A,`drawing ${_} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(r){const l=t.layer.id;if(l in i||(i[l]=r(t)),!i[l])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const h of t)m4(l,(d=h.getShaderModuleProps)==null?void 0:d.call(h,e,l));return m4(l,this.getShaderModuleProps(e,t,l),i)}}function tD(n=0,e={}){const t={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in t){const h=t[u]=t[u]||tD(e[u],e);d=h(i,s),t[l]=h}else Number.isFinite(o)?(d=o+(e[u]||0),t[l]=null):d=n;return s&&d>=n&&(n=d+1),e[l]=d,d};return r}function wK(n,{shaderModuleProps:e,target:t,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,s]=n.canvasContext.getDrawingBufferSize(),o=t?t.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function m4(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class TK extends q1{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==t.width||o!==t.height)&&t.resize({width:s,height:o}),super.render({...e,clearColor:l,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const SK={color:[255,255,255],intensity:1},_4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],EK=[0,0,0,200/255];class nD{constructor(e={}){this.id="lighting-effect",this.shadowColor=EK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(p4),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(p4))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Cr().lookAt({eye:new $r(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new TK(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new mK(SK),this.directionalLights.push(new g4(_4[0]),new g4(_4[1])))}}class AK{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,h=t*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,h)}let g=1/0;u&&(g=u*r+s);const _=this._allocate(d,h,l,g);return e&&o?_.set(e):l||_.fill(0,0,4),this._release(e),_}release(e){this._release(e)}_allocate(e,t,r,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(d=>d.byteLength>=l);if(u>=0){const d=new e(o.splice(u,1)[0],0,s);return r&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,s=t.findIndex(o=>o.byteLength>=i);s<0?t.push(r):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,r),t.length>this.opts.poolSize&&t.shift()}}const uc=new AK;function Fl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function RK(n,e){const t=n%e;return t<0?e+t:t}function CK(n){return[n[12],n[13],n[14]]}function NK(n){return{left:$a(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:$a(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:$a(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:$a(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:$a(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:$a(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const v4=new $r;function $a(n,e,t,r){v4.set(n,e,t);const i=v4.len();return{distance:r/i,normal:new $r(-n/i,-e/i,-t/i)}}function kK(n){return n-Math.fround(n)}let Cl;function g0(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,s=(i-r)/t;Cl=uc.allocate(Cl,s,{type:Float32Array,size:t*2});let o=r,l=0;for(;o<i;){for(let u=0;u<t;u++){const d=n[o++];Cl[l+u]=d,Cl[l+u+t]=kK(d)}l+=t*2}return Cl.subarray(0,s*t*2)}function MK(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const IK=Math.PI/180,OK=Fl(),y4=[0,0,0],PK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function DK({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=n/e,d=t?new Cr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new Cr().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:h=0,right:g=0,top:_=0,bottom:y=0}=s,T=Yn((h+n-g)/2,0,n)-n/2,w=Yn((_+e-y)/2,0,e)-e/2;d[8]-=T*2/n,d[9]+=w*2/e}return d}class So{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||PK,this.focalDistance=e.focalDistance||1,this.position=e.position||y4,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?lr.WEB_MERCATOR:lr.WEB_MERCATOR_AUTO_OFFSET:lr.IDENTITY}equals(e){return e instanceof So?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&cc(e.projectionMatrix,this.projectionMatrix)&&cc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=QP(r,this.pixelProjectionMatrix),[s,o]=i,l=t?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,o]=e,l=t?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],d=th([i,l,o],this.pixelUnprojectionMatrix,u),[h,g,_]=this.unprojectPosition(d);return Number.isFinite(o)?[h,g,_]:Number.isFinite(r)?[h,g,r]:[h,g]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=td(e);return t[1]=Yn(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ho(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?yx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,NK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=$G({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||yx({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=y4;if(s&&(l=o?new Cr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([t,r,0]);this.center=new $r(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=OK,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:d=null,focalDistance:h=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Cr().multiplyRight(t).translate(new $r(this.center).negate()),this.projectionMatrix=r||DK({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*IK,focalDistance:h,padding:d,near:l,far:u});const g=Fl();Os(g,g,this.projectionMatrix),Os(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=ux([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=CK(this.viewMatrixInverse);const _=Fl(),y=Fl();U1(_,_,[this.width/2,-this.height/2,1]),Qf(_,_,[1,-1,0]),Os(y,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=ux(Fl(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||gt.warn("Pixel project matrix not invertible")()}}So.displayName="Viewport";class po extends So{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:d,farZ:h,orthographic:g=!1,projectionMatrix:_,repeat:y=!1,worldOffset:T=0,position:w,padding:x,legacyMeterSizes:S=!1}=e;let{width:A,height:R,altitude:E=1.5}=e;const C=Math.pow(2,i);A=A||1,R=R||1;let O,D=null;if(_)E=_[5]/2,O=nd(E);else{e.fovy?(O=e.fovy,E=V1(O)):O=nd(E);let P;if(x){const{top:k=0,bottom:V=0}=x;P=[0,Yn((k+R-V)/2,0,R)-R/2]}D=WG({width:A,height:R,scale:C,center:w&&[0,0,w[2]*p0(t)],offset:P,pitch:s,fovy:O,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(d)&&(D.near=d),Number.isFinite(h)&&(D.far=h)}let M=HG({height:R,pitch:s,bearing:o,scale:C,altitude:E});T&&(M=new Cr().translate([512*T,0,0]).multiplyLeft(M)),super({...e,width:A,height:R,viewMatrix:M,longitude:r,latitude:t,zoom:i,...D,fovy:O,focalDistance:E}),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=O,this.orthographic=g,this._subViewports=y?[]:null,this._pseudoMeters=S,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const s=i?new po({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*p0(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/p0(r);return[t,r,i]}addMetersToLngLat(e,t){return ZP(e,t)}panByPosition(e,t){const r=th(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=qk([],i,CX([],r)),o=qk([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const t=GG(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=XG({width:r,height:i,bounds:e,...t});return new po({width:r,height:i,longitude:s,latitude:o,zoom:l})}}po.displayName="WebMercatorViewport";const b4=[0,0,0];function m0(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof po){const[i,s,o=0]=n,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function jK(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=n;return i===Ze.DEFAULT&&(i=e.isGeospatial?Ze.LNGLAT:Ze.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function rD(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=n;switch(t&&([o,l,u]=Rc([],[o,l,u,1],t)),r){case Ze.LNGLAT:return m0([o,l,u],e,s);case Ze.LNGLAT_OFFSETS:return m0([o+i[0],l+i[1],u+(i[2]||0)],e,s);case Ze.METER_OFFSETS:return m0(ZP(i,[o,l,u]),e,s);case Ze.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function LK(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=jK(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=b4,shaderCoordinateOrigin:h=b4,offsetMode:g=!1}=u?YP(t,r,i):{},_=rD(n,{viewport:t,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:g});if(g){const y=t.projectPosition(d||h);qX(_,_,y)}return _}let BK=1,UK=1;class iD{constructor(){j(this,"time",0);j(this,"channels",new Map);j(this,"animations",new Map);j(this,"playing",!1);j(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=BK++,l={time:0,delay:t,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=UK++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function FK(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function zK(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let VK=0;const qK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:J0.stats.get(`animation-loop-${VK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class $K{constructor(e){j(this,"device",null);j(this,"canvas",null);j(this,"props");j(this,"animationProps",null);j(this,"timeline",null);j(this,"stats");j(this,"cpuTime");j(this,"gpuTime");j(this,"frameRate");j(this,"display");j(this,"needsRedraw","initialized");j(this,"_initialized",!1);j(this,"_running",!1);j(this,"_animationFrameId",null);j(this,"_nextFramePromise",null);j(this,"_resolveNextFrame",null);j(this,"_cpuStartTime",0);j(this,"_error",null);if(this.props={...qK,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Zd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=FK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(zK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,r;const e=(r=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){var s,o,l,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const _0={};function nh(n="id"){_0[n]=_0[n]||1;const e=_0[n]++;return`${n}-${e}`}class x4{constructor(e){j(this,"id");j(this,"userData",{});j(this,"topology");j(this,"bufferLayout",[]);j(this,"vertexCount");j(this,"indices");j(this,"attributes");if(this.id=e.id||nh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&xt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function HK(n,e){if(e instanceof x4)return e;const t=WK(n,e),{attributes:r,bufferLayout:i}=XK(n,e);return new x4({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:r})}function WK(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:xt.INDEX,data:t})}function XK(n,e){const t=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=n.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:d,normalized:h}=o;t.push({name:l,format:VW(u,d,h)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:i}}const Td=class Td{constructor(e){j(this,"device");j(this,"destroyPolicy");j(this,"_hashCounter",0);j(this,"_hashes",{});j(this,"_renderPipelineCache",{});j(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Td(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...oo.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...$f.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof $f?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};j(Td,"defaultProps",{...oo.defaultProps});let bx=Td;const Sd=class Sd{constructor(e){j(this,"device");j(this,"destroyPolicy");j(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Sd(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};j(Sd,"defaultProps",{...zf.defaultProps});let xx=Sd;function YK(n,e){var i;const t={},r="Values";if(n.attributes.length===0&&!((i=n.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of n.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;t[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const o=`${s.location} ${s.name}`;t[`out ${o}`]={[r]:JSON.stringify(s)}}return t}let nn=null,Ts=null;function GK(n,{id:e,minimap:t,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){nn||(nn=document.createElement("canvas"),nn.id=e,nn.title=e,nn.style.zIndex="100",nn.style.position="absolute",nn.style.top=i,nn.style.left=s,nn.style.border="blue 5px solid",nn.style.transform="scaleY(-1)",document.body.appendChild(nn),Ts=nn.getContext("2d")),(nn.width!==n.width||nn.height!==n.height)&&(nn.width=n.width/2,nn.height=n.height/2,nn.style.width="400px",nn.style.height="400px");const l=n.device.readPixelsToArrayWebGL(n),u=Ts==null?void 0:Ts.createImageData(n.width,n.height);if(u){for(let h=0;h<l.length;h+=4)u.data[0+h+0]=l[h+0]*o,u.data[0+h+1]=l[h+1]*o,u.data[0+h+2]=l[h+2]*o,u.data[0+h+3]=r?255:l[h+3]*o;Ts==null||Ts.putImageData(u,0,0)}}function wx(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!wx(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!wx(n[s],e[s],t-1))return!1;return!0}return!1}function KK(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ZK(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function sD(n){return KK(n)||ZK(n)}function QK(n){return sD(n)||typeof n=="number"||typeof n=="boolean"}function aD(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];QK(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class JK{constructor(e,t){j(this,"options",{disableWarnings:!1});j(this,"modules");j(this,"moduleUniforms");j(this,"moduleBindings");Object.assign(this.options,t);const r=C1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;be.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&be.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||be.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],d=((t=o.getUniforms)==null?void 0:t.call(o,s,l))||s,{uniforms:h,bindings:g}=aD(d);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...u,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[s],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let eZ="";async function tZ(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:eZ+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class v0{constructor(e,t){j(this,"device");j(this,"id");j(this,"texture");j(this,"sampler");j(this,"view");j(this,"ready");j(this,"isReady",!1);j(this,"destroyed",!1);j(this,"resolveReady",()=>{});j(this,"rejectReady",()=>{});this.device=e,this.id=t.id||nh("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:tZ(t.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let r;try{r=await oD(t)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function oD(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(oD));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=t[s];return i}return n}const Ss=2,nZ=1e4,Ed=class Ed{constructor(e,t){j(this,"device");j(this,"id");j(this,"source");j(this,"vs");j(this,"fs");j(this,"pipelineFactory");j(this,"shaderFactory");j(this,"userData",{});j(this,"parameters");j(this,"topology");j(this,"bufferLayout");j(this,"isInstanced");j(this,"instanceCount",0);j(this,"vertexCount");j(this,"indexBuffer",null);j(this,"bufferAttributes",{});j(this,"constantAttributes",{});j(this,"bindings",{});j(this,"uniforms",{});j(this,"vertexArray");j(this,"transformFeedback",null);j(this,"pipeline");j(this,"shaderInputs");j(this,"_uniformStore");j(this,"_attributeInfos",{});j(this,"_gpuGeometry",null);j(this,"_getModuleUniforms");j(this,"props");j(this,"_pipelineNeedsUpdate","newly created");j(this,"_needsRedraw","initializing");j(this,"_destroyed",!1);j(this,"_lastDrawTimestamp",-1);j(this,"_lastLogTime",0);j(this,"_logOpen",!1);j(this,"_drawCount",0);var u,d,h,g;this.props={...Ed.defaultProps,...t},t=this.props,this.id=t.id||nh("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(_=>[_.name,_]))||[]),i=t.shaderInputs||new JK(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=iZ(e),o=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(h=this.shaderInputs)==null?void 0:h.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=_,this._getModuleUniforms=y,(g=this.props).shaderLayout||(g.shaderLayout=vX(this.source))}else{const{vs:_,fs:y,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=_,this.fs=y,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||bx.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||xx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return be.info(Ss,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),Tx(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&HK(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new s0(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new s0(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){wx(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new zW(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(rZ(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&be.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=qW(this.pipeline.shaderLayout,this.bufferLayout);const i=new s0(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||be.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let d=!1;for(const h of u){const g=this._attributeInfos[h];if(g){const _=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(_,o),d=!0}}!d&&!r&&be.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||be.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Tx(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=aD(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof v0&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof v0?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Ff?e=Math.max(e,t.texture.updateTimestamp):t instanceof xt||t instanceof kt?e=Math.max(e,t.updateTimestamp):t instanceof v0?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Vf||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(be.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=aP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=be.level>3?0:nZ;be.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,be.group(Ss,`>>> DRAWING MODEL ${this.id}`,{collapsed:be.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=YK(this.pipeline.shaderLayout,this.id);be.table(Ss,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};be.table(Ss,t)();const r=this._getAttributeDebugTable();be.table(Ss,this._attributeInfos)(),be.table(Ss,r)(),be.groupEnd(Ss)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&GK(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=cP(t);return(e instanceof xt?new r(e.debugData):e).toString()}};j(Ed,"defaultProps",{...oo.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Uf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let go=Ed;function rZ(n){return!!(n.uniformTypes&&!Tx(n.uniformTypes))}function iZ(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Tx(n){for(const e in n)return!1;return!0}const Jl=class Jl{constructor(e,t=Jl.defaultProps){j(this,"device");j(this,"model");j(this,"transformFeedback");if(!Jl.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new go(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||$H(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof xt)return t.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=t;return r.readAsync(i,s)}};j(Jl,"defaultProps",{...go.defaultProps,outputs:void 0,feedbackBuffers:void 0});let fc=Jl;class lD{constructor(e){j(this,"id");j(this,"topology");j(this,"vertexCount");j(this,"indices");j(this,"attributes");j(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||nh("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(t)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const sZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class cD extends q1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:d,height:h},cullRect:g,effects:_,pass:y="picking",pickZ:T,shaderModuleProps:w}){this.pickZ=T;const x=this._resetColorEncoder(T),S=[l,u,d,h],A=super.render({target:o,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:_==null?void 0:_.filter(E=>E.useInPicking),pass:y,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:S});return this._colorEncoderState=null,{decodePickingColor:x&&oZ.bind(null,x),stats:A}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,sZ),i.blend=!0,i.blendColor=aZ(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function aZ(n,e,t){const{byLayer:r,byAlpha:i}=n;let s,o=r.get(e);return o?(o.viewports.push(t),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[t]},r.set(e,o),i[s]=o):(gt.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function oZ(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Xa={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},rd=Symbol.for("component"),Ps=Symbol.for("propTypes"),y0=Symbol.for("deprecatedProps"),ro=Symbol.for("asyncPropDefaults"),zs=Symbol.for("asyncPropOriginal"),ts=Symbol.for("asyncPropResolved");function uD(n,e=()=>!0){return Array.isArray(n)?fD(n,e,[]):e(n)?[n]:[]}function fD(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?fD(i,e,t):e(i)&&t.push(i)}return t}function lZ({target:n,source:e,start:t=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=t;o<i;o++)n[l++]=e[o];for(;o<s;)o<s-o?(n.copyWithin(t+o,t,t+o),o*=2):(n.copyWithin(t+o,t,t+s-o),o=s);return n}class cZ{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=W0(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class uZ{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,r):(s=new cZ(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[t];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[t]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const fZ="layerManager.setLayers",dZ="layerManager.activateViewport";class hZ{constructor(e,t){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Tn(dZ,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=t||{};this.layers=[],this.resourceManager=new uZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:dK(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[wY],renderPass:void 0,stats:i||new Zd({id:"deck.gl"}),viewport:s||new So({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new iD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Tn(fZ,this,t,e),this._lastRenderedLayers=e;const r=uD(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(i=>i.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const o of e)r[o.id]?gt.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&gt.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Xa.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Xa.MATCHED,t!==e&&(e.lifecycle=Xa.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Xa.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Xa.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Ar(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Ar(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Ar(n[s],e[s],t-1))return!1;return!0}return!1}class pZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=uD(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ar(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):gt.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,t,r,i){const s=e.controller;if(s&&r){const o={...t,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=t[s.id];const d=!!s.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const gZ=/([0-9]+\.?[0-9]*)(%|px)/;function Vi(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=gZ.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function qi(n,e){return n.relative?Math.round(n.position*e):n.position}class Vs{constructor(e){const{id:t,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Vi(r),this._y=Vi(i),this._width=Vi(s),this._height=Vi(o),this._padding=l&&{left:Vi(l.left||0),right:Vi(l.right||0),top:Vi(l.top||0),bottom:Vi(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ar(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:qi(this._x,e),y:qi(this._y,t),width:qi(this._width,e),height:qi(this._height,t)};return this._padding&&(r.padding={left:qi(this._padding.left,e),top:qi(this._padding.top,t),right:qi(this._padding.right,e),bottom:qi(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class rh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const w4=()=>{},Sx={BREAK:1,SNAP_TO_END:2,IGNORE:3},mZ=n=>n,_Z=Sx.BREAK;class vZ{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=t,d=u(r/l),h=i.interpolateProps(s,o,d);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new rh(e.timeline),this.onViewStateChange=e.onViewStateChange||w4,this.onStateChange=e.onStateChange||w4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Sx.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Sx.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),s=t.transitionInterpolator,o=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:t.transitionEasing||mZ,interpolator:s,interruption:t.transitionInterruption||_Z,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function vn(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class yZ{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!cc(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(r[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];vn(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const bZ=["longitude","latitude","zoom","bearing","pitch"],xZ=["longitude","latitude","zoom"];class $1 extends yZ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:bZ,required:xZ},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(t),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const s of this._propsToExtract)i[s]=Zf(e[s]||0,t[s]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,Zf(e.around,t.around,r)))}return i}}const $i={transitionDuration:0},wZ=300,sf=n=>1-(1-n)*(1-n),Ha={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Es={};class dD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new vZ({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?wZ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:d=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(Ha.WHEEL,h&&r),this.toggleEvents(Ha.PAN,h),this.toggleEvents(Ha.PINCH,h&&(l||u)),this.toggleEvents(Ha.MULTI_PAN,h&&u),this.toggleEvents(Ha.DOUBLE_CLICK,h&&o),this.toggleEvents(Ha.KEYBOARD,h&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,$i,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,$i,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sf},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,$i,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sf},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,$i,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,$i,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sf},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Es._startPinchRotation=e.rotation,Es._lastPinchEvent=e,this.updateViewport(r,$i,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:Es._startPinchRotation-r})}return this.updateViewport(t,$i,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Es._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=Es;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*t/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:sf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Es._startPinchRotation=null,Es._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),d.isZooming=!0;break;case"Equal":u=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":t?(u=l.rotateLeft(s),d.isRotating=!0):(u=l.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":t?(u=l.rotateRight(s),d.isRotating=!0):(u=l.moveRight(i),d.isPanning=!0);break;case"ArrowUp":t?(u=l.rotateUp(o),d.isRotating=!0):(u=l.moveUp(i),d.isPanning=!0);break;case"ArrowDown":t?(u=l.rotateDown(o),d.isRotating=!0):(u=l.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?$i:e?{...t,transitionInterpolator:new $1({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class hD{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const T4=5,TZ=1.2;class SZ extends hD{constructor(e){const{width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:d=1.5,position:h=[0,0,0],maxZoom:g=20,minZoom:_=0,maxPitch:y=60,minPitch:T=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E,normalize:C=!0}=e;vn(Number.isFinite(s)),vn(Number.isFinite(i)),vn(Number.isFinite(o)),super({width:t,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:d,maxZoom:g,minZoom:_,maxPitch:y,minPitch:T,normalize:C,position:h},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+t,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Yn(u,l,o);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=Yn(i,r,t);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Yn(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,KG(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const s=e[0]-t[0],o=e[1]-t[1],l=e[1],u=t[1],{width:d,height:h}=this.getViewportProps(),g=s/d;let _=0;o>0?Math.abs(h-u)>T4&&(_=o/(u-h)*TZ):o<0&&u>T4&&(_=1-l/u),_=Yn(_,-1,1);const{minPitch:y,maxPitch:T}=this.getViewportProps(),w=i+180*g;let x=r;return _>0?x=r+_*(T-r):_<0&&(x=r-_*(y-r)),{pitch:x,bearing:w}}}class EZ extends dD{constructor(){super(...arguments),this.ControllerState=SZ,this.transition={transitionDuration:300,transitionInterpolator:new $1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class pD extends Vs{constructor(e={}){super(e)}getViewportType(){return po}get ControllerType(){return EZ}}pD.displayName="MapView";const AZ=new nD;function RZ(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class CZ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>RZ(i,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ar(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const s=t[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof nD)||this._resolvedEffects.push(AZ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class NZ extends q1{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const kZ="deckRenderer.renderLayers";class MZ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new NZ(e),this.pickLayersPass=new cD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Tn(kZ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const IZ={pickedColor:null,pickedObjectIndex:-1};function OZ({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:d}=s;let h=i*i,g=-1,_=0;for(let y=0;y<d;y++){const T=y+l-r,w=T*T;if(w>h)_+=4*u;else for(let x=0;x<u;x++){if(n[_+3]-1>=0){const A=x+o-t,R=A*A+w;R<=h&&(h=R,g=_)}_+=4}}if(g>=0){const y=n.slice(g,g+4),T=e(y);if(T){const w=Math.floor(g/4/u),x=g/4-w*u;return{...T,pickedColor:y,pickedX:o+x,pickedY:l+w}}gt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return IZ}function PZ({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const s=n.slice(r,r+4),o=s.join(",");if(!t.has(o)){const l=e(s);l?t.set(o,{...l,color:s}):gt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function gD({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=jZ((n==null?void 0:n.pickedViewports)||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function DZ(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const g=t.index,_=t.layerId,y=o?o.props.id:null;if(y!==_||l!==g){if(y!==_){const T=i.find(w=>w.props.id===_);T&&u.unshift(T)}t.layerId=y,t.index=l,t.info=null}}const d=gD(n),h=new Map;return h.set(null,d),u.forEach(g=>{let _={...d};g===o&&(_.color=s,_.index=l,_.picked=!0),_=mD({layer:g,info:_,mode:r});const y=_.layer;g===o&&r==="hover"&&(t.info=_),h.set(y.id,_),r==="hover"&&y.updateAutoHighlight(_)}),h}function mD({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function jZ(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class LZ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new cD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(_=>_.id===o):null,d=l&&i.find(_=>_.id===l)||i[0],h=d&&d.unproject([e-d.x,t-d.y]);return{...s,...{x:e,y:t,viewport:d,coordinate:h,layer:u}}}_resizeBuffer(){var t,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:d,onViewportActive:h,effects:g}){const _=this.device.canvasContext.cssToDeviceRatio(),y=this._getPickable(e);if(!y||r.length===0)return{result:[],emptyInfo:gD({viewports:r,x:i,y:s,pixelRatio:_})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],x=Math.round(o*_),{width:S,height:A}=this.pickingFBO,R=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:S,deviceHeight:A}),E={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const O=[],D=new Set;for(let M=0;M<l;M++){let P;if(R){const V=this._drawAndSample({layers:y,views:t,viewports:r,onViewportActive:h,deviceRect:R,cullRect:E,effects:g,pass:`picking:${u}`});P=OZ({...V,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:R})}else P={pickedColor:null,pickedObjectIndex:-1};let k;if(P.pickedLayer&&d&&this.depthFBO){const{pickedColors:V}=this._drawAndSample({layers:[P.pickedLayer],views:t,viewports:r,onViewportActive:h,deviceRect:{x:P.pickedX,y:P.pickedY,width:1,height:1},cullRect:E,effects:g,pass:`picking:${u}:z`},!0);V[3]&&(k=V[0])}P.pickedLayer&&M+1<l&&(D.add(P.pickedLayer),P.pickedLayer.disablePickingIndex(P.pickedObjectIndex)),C=DZ({pickInfo:P,lastPickedInfo:this.lastPickedInfo,mode:u,layers:y,viewports:r,x:i,y:s,z:k,pixelRatio:_});for(const V of C.values())V.layer&&O.push(V);if(!P.pickedColor)break}for(const M of D)M.restorePickingColors();return{result:O,emptyInfo:C.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:d=null,onViewportActive:h,effects:g}){const _=this._getPickable(e);if(!_||r.length===0)return[];this._resizeBuffer();const y=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=T.x,x=T.y+T.height,S=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),A=S.x+S.width,R=S.y,E={x:w,y:R,width:A-w,height:x-R},C=this._drawAndSample({layers:_,views:t,viewports:r,onViewportActive:h,deviceRect:E,cullRect:{x:i,y:s,width:o,height:l},effects:g,pass:`picking:${u}`}),O=PZ(C),D=new Map,M=[],P=Number.isFinite(d);for(let k=0;k<O.length&&!(P&&M.length>=d);k++){const V=O[k];let X={color:V.pickedColor,layer:null,index:V.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:y};X=mD({layer:V.pickedLayer,info:X,mode:u});const Z=X.layer.id;D.has(Z)||D.set(Z,new Set);const $=D.get(Z),H=X.object??X.index;$.has(H)||($.add(H),M.push(X))}return M}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},d=!1){const h=d?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const A of l)A.useInPicking&&(g.preRenderStats[A.id]=A.preRender(g));const{decodePickingColor:_}=this.pickLayersPass.render(g),{x:y,y:T,width:w,height:x}=s,S=new(d?Float32Array:Uint8Array)(w*x*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:y,sourceY:T,sourceWidth:w,sourceHeight:x,target:S}),{pickedColors:S,decodePickingColor:_}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,t-r),u=Math.min(i,e+r+1)-o,d=Math.min(s,t+r+1)-l;return u<=0||d<=0?null:{x:o,y:l,width:u,height:d}}}const BZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},UZ="top-left",S4="__root";class FZ{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ar(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=t[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const i=t[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=UZ}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,r).append(i),e._element=i}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var o;const r=e||S4;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,BZ[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===S4||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){var i,s;const r=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=r[l];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:t}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,t))}}onEvent(e,t){var i,s;const r=mx[t.type];if(r)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,t))}}}const zZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class VZ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,zZ),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var Ga;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ga||(Ga={}));const H1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},zt=(n,e,t)=>e?n.enable(t):n.disable(t),E4=(n,e,t)=>n.hint(t,e),$n=(n,e,t)=>n.pixelStorei(t,e),A4=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},Nl=(n,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(i,e)};function b0(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const qZ={3042:zt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:zt,2885:(n,e)=>n.cullFace(e),2929:zt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:zt,35723:E4,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:A4,36010:A4,34964:Nl,36662:Nl,36663:Nl,35053:Nl,35055:Nl,2886:(n,e)=>n.frontFace(e),33170:E4,2849:(n,e)=>n.lineWidth(e),32823:zt,32824:"polygonOffset",10752:"polygonOffset",35977:zt,32926:zt,32928:zt,32938:"sampleCoverage",32939:"sampleCoverage",3089:zt,3088:(n,e)=>n.scissor(...e),2960:zt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:zt,10754:zt,12288:zt,12289:zt,12290:zt,12291:zt,12292:zt,12293:zt,12294:zt,12295:zt,3333:$n,3317:$n,37440:$n,37441:$n,37443:$n,3330:$n,3332:$n,3331:$n,3314:$n,32878:$n,3316:$n,3315:$n,32877:$n,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=b0(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=b0(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,l]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,s,o,l)},stencilOp:(n,e)=>{e=b0(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,o,l]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,s,o,l)},viewport:(n,e)=>n.viewport(...e)};function Nt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const $Z={blendEquation:(n,e,t)=>n.blendEquationSeparate(Nt(32777,e,t),Nt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(Nt(32969,e,t),Nt(32968,e,t),Nt(32971,e,t),Nt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(Nt(32824,e,t),Nt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(Nt(32938,e,t),Nt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,Nt(2962,e,t),Nt(2967,e,t),Nt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,Nt(34816,e,t),Nt(36003,e,t),Nt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,Nt(2964,e,t),Nt(2965,e,t),Nt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,Nt(34817,e,t),Nt(34818,e,t),Nt(34819,e,t))},R4={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},Br=(n,e)=>n.isEnabled(e),C4={3042:Br,2884:Br,2929:Br,3024:Br,32823:Br,32926:Br,32928:Br,3089:Br,2960:Br,35977:Br},HZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Eo(n,e){if(XZ(e))return;const t={};for(const i in e){const s=Number(i),o=qZ[i];o&&(typeof o=="string"?t[o]=!0:o(n,e[i],s))}const r=n.state&&n.state.cache;if(r)for(const i in t){const s=$Z[i];s(n,e,r)}}function _D(n,e=H1){if(typeof e=="number"){const i=e,s=C4[i];return s?s(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const s=C4[i];r[i]=s?s(n,Number(i)):n.getParameter(Number(i))}return r}function WZ(n){Eo(n,H1)}function XZ(n){for(const e in n)return!1;return!0}function YZ(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}class Ds{constructor(e,t){j(this,"gl");j(this,"program",null);j(this,"stateStack",[]);j(this,"enable",!0);j(this,"cache",null);j(this,"log");j(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Eo(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?_D(e):Object.assign({},H1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,KZ(e);for(const r in R4){const i=R4[r];GZ(e,r,i)}N4(e,"getParameter"),N4(e,"isEnabled")}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];YZ(o,l)||(t=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:t,oldValue:r}}}function N4(n,e){const t=n[e].bind(n);n[e]=function(i){if(i===void 0||HZ.has(i))return t(i);const s=Ds.get(n);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function GZ(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...s){const o=Ds.get(n),{valueChanged:l,oldValue:u}=t(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function KZ(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const i=Ds.get(n);i.program!==r&&(e(r),i.program=r)}}function ZZ(n,e,t){let r="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||(s=n.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=n.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=n.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return n.addEventListener("webglcontextlost",u=>o(u),!1),n.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||(s.luma={}),s}function mo(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function QZ(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);mo(n,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=n.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=n.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||t,u=o||r,d=n.getParameter(7938),h=vD(l,u),g=JZ(l,u),_=eQ(l,u);return{type:"webgl",gpu:h,gpuType:_,gpuBackend:g,vendor:l,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function vD(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function JZ(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function eQ(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(vD(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function yD(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const zl="WEBGL_compressed_texture_s3tc",Vl="WEBGL_compressed_texture_s3tc_srgb",Ka="EXT_texture_compression_rgtc",Za="EXT_texture_compression_bptc",tQ="WEBGL_compressed_texture_etc",nQ="WEBGL_compressed_texture_astc",rQ="WEBGL_compressed_texture_etc1",iQ="WEBGL_compressed_texture_pvrtc",sQ="WEBGL_compressed_texture_atc",k4="EXT_texture_norm16",M4="EXT_render_snorm",aQ="EXT_color_buffer_float",W1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[M4],"norm16-renderable-webgl":[k4],"snorm16-renderable-webgl":[k4,M4],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[zl,Vl,Ka,Za],"texture-compression-bc5-webgl":[Ka],"texture-compression-bc7-webgl":[Za],"texture-compression-etc2":[tQ],"texture-compression-astc":[nQ],"texture-compression-etc1-webgl":[rQ],"texture-compression-pvrtc-webgl":[iQ],"texture-compression-atc-webgl":[sQ]};function oQ(n){return n in W1}function lQ(n,e,t){return(W1[e]||[]).every(i=>mo(n,i,t))}const X1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:aQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:zl},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Vl},"bc1-rgba-unorm":{gl:33777,x:zl},"bc1-rgba-unorm-srgb":{gl:35916,x:Vl},"bc2-rgba-unorm":{gl:33778,x:zl},"bc2-rgba-unorm-srgb":{gl:35918,x:Vl},"bc3-rgba-unorm":{gl:33779,x:zl},"bc3-rgba-unorm-srgb":{gl:35919,x:Vl},"bc4-r-unorm":{gl:36283,x:Ka},"bc4-r-snorm":{gl:36284,x:Ka},"bc5-rg-unorm":{gl:36285,x:Ka},"bc5-rg-snorm":{gl:36286,x:Ka},"bc6h-rgb-ufloat":{gl:36495,x:Za},"bc6h-rgb-float":{gl:36494,x:Za},"bc7-rgba-unorm":{gl:36492,x:Za},"bc7-rgba-unorm-srgb":{gl:36493,x:Za},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function cQ(n,e,t){let r=e.create;const i=X1[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!mo(n,i.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function bD(n){var i;const e=X1[n],t=dQ(n),r=N1(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||fQ(r.channels,r.integer,r.normalized,t),type:r.dataType?yD(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function uQ(n){switch(N1(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function fQ(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function dQ(n){const e=X1[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const I4={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class hQ extends aW{constructor(t,r,i){super([],i);j(this,"gl");j(this,"extensions");j(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,mo(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){var r;return(r=this.disabledFeatures)!=null&&r[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),oQ(t)&&lQ(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(I4),...Object.keys(W1)]}getWebGLFeature(t){const r=I4[t];return typeof r=="string"?!!mo(this.gl,r,this.extensions):!!r}}class pQ extends sW{constructor(t){super();j(this,"gl");j(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Yl extends qf{constructor(t,r){super(t,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"colorAttachments",[]);j(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=uQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${mQ(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,s.handle,o,l);break;case 34067:const u=gQ(l);i.framebufferTexture2D(36160,t,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,t,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function gQ(n){return n<34069?n+34069:n}function mQ(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class _Q extends ex{constructor(t,r){super(r);j(this,"device");j(this,"format","rgba8unorm");j(this,"depthStencilFormat","depth24plus");j(this,"presentationSize");j(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Yl(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function xD(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${n}': ${o}`)),t.appendChild(r)})}const vQ=1;let ft=null,O4=!1;const Y1={debugSpectorJS:be.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function yQ(n){if(!globalThis.SPECTOR)try{await xD(n.debugSpectorJSUrl||Y1.debugSpectorJSUrl)}catch(e){be.warn(String(e))}}function bQ(n){var e;if(n={...Y1,...n},!n.debugSpectorJS)return null;if(!ft&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){be.probe(vQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;ft=new t,globalThis.luma&&(globalThis.luma.spector=ft)}if(!ft)return null;if(O4||(O4=!0,ft.spyCanvases(),ft==null||ft.onCaptureStarted.add(t=>be.info("Spector capture started:",t)()),ft==null||ft.onCapture.add(t=>{be.info("Spector capture complete:",t)(),ft==null||ft.getResultUI(),ft==null||ft.resultView.display(),ft==null||ft.resultView.addCapture(t)})),n.gl){const t=n.gl,r=t.device;ft==null||ft.startCapture(n.gl,500),t.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{be.info("Spector capture stopped after 2 seconds")(),ft==null||ft.stopCapture()})}return ft}const xQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function wD(n){return n.luma=n.luma||{},n.luma}async function wQ(){Gs()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await xD(xQ))}function TQ(n,e={}){return e.debugWebGL||e.traceWebGL?EQ(n,e):SQ(n)}function SQ(n){const e=wD(n);return e.realContext?e.realContext:n}function EQ(n,e){if(!globalThis.WebGLDebugUtils)return be.warn("webgl-debug not loaded")(),n;const t=wD(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Ga,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,AQ.bind(null,e),RQ.bind(null,e));for(const o in Ga)!(o in r)&&typeof Ga[o]=="number"&&(r[o]=Ga[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(i,r);const s=Object.create(i);return t.realContext=n,t.debugContext=s,s.debug=!0,s}function P4(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function AQ(n,e,t,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),o=`${i} in gl.${t}(${s})`;be.error(o)();debugger}function RQ(n,e,t){let r="";be.level>=1&&(r=P4(e,t),n.traceWebGL&&be.log(1,r)());for(const i of t)if(i===void 0){r=r||P4(e,t);debugger}}const x0={};function CQ(n="id"){x0[n]=x0[n]||1;const e=x0[n]++;return`${n}-${e}`}class Gl extends xt{constructor(t,r={}){super(t,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"glTarget");j(this,"glUsage");j(this,"glIndexType",5123);j(this,"byteLength");j(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=NQ(this.props.usage),this.glUsage=kQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,i=t.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,r),i}}function NQ(n){return n&xt.INDEX?34963:n&xt.VERTEX?34962:n&xt.UNIFORM?35345:34962}function kQ(n){return n&xt.INDEX||n&xt.VERTEX?35044:n&xt.UNIFORM?35048:35044}function MQ(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,_]=i;t.push({message:_.trim(),type:D4(g),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let d=parseInt(l,10);isNaN(d)&&(d=0);let h=parseInt(o,10);isNaN(h)&&(h=0),t.push({message:u.join(":").trim(),type:D4(s),lineNum:d,linePos:h})}return t}function D4(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class IQ extends zf{constructor(t,r){super(t,r);j(this,"device");j(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?MQ(t):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}be.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),be.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function OQ(n,e,t,r){if(LQ(e))return r(n);const i=n;i.pushState();try{return PQ(n,e),Eo(i.gl,t),r(n)}finally{i.popState()}}function PQ(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(js("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=js("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=js("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(jQ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Ex("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&be.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Ex("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=w0("stencilPassOperation",e.stencilPassOperation),s=w0("stencilFailOperation",e.stencilFailOperation),o=w0("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=j4("blendColorOperation",e.blendColorOperation||"add"),s=j4("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=af("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=af("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=af("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=af("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,d)}}function Ex(n,e){return js(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function w0(n,e){return js(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function j4(n,e){return js(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function af(n,e){return js(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function DQ(n,e){return`Illegal parameter ${e} for ${n}`}function js(n,e,t){if(!(e in t))throw new Error(DQ(n,e));return t[e]}function jQ(n,e){return e}function LQ(n){let e=!0;for(const t in n){e=!1;break}return e}function TD(n){const e={};return n.addressModeU&&(e[10242]=T0(n.addressModeU)),n.addressModeV&&(e[10243]=T0(n.addressModeV)),n.addressModeW&&(e[32882]=T0(n.addressModeW)),n.magFilter&&(e[10240]=Ax(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=BQ(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=Ex("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function T0(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ax(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function BQ(n,e="none"){if(!e)return Ax(n);switch(e){case"none":return Ax(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Rx extends Vf{constructor(t,r){super(t,r);j(this,"device");j(this,"handle");j(this,"parameters");this.device=t,this.parameters=TD(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,i]of Object.entries(t)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class Qa extends Ff{constructor(t,r){super(t,{...kt.defaultProps,...r});j(this,"device");j(this,"gl");j(this,"handle");j(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const UQ="Failed to deduce GL constant from typed array";function FQ(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(UQ)}}function zQ(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function SD(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function VQ(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function id(n,e,t){if(qQ(e))return t(n);const{nocatch:r=!0}=e,i=Ds.get(n);i.push(),Eo(n,e);let s;if(r)s=t(n),i.pop();else try{s=t(n)}finally{i.pop()}return s}function qQ(n){for(const e in n)return!1;return!0}function $Q(n,e,t){const{dimension:r,width:i,height:s,depth:o=0}=t,{glInternalFormat:l}=t,u=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(u,e,l,i,s,o);break;default:n.texStorage2D(u,e,l,i,s)}}function L4(n,e,t,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:d=0,y:h=0,z:g=0}=r,{glFormat:_,glType:y}=r,T=ED(r.glTarget,o,l),w=r.flipY?{37440:!0}:{};id(n,w,()=>{switch(o){case"2d-array":case"3d":n.bindTexture(T,e),n.texSubImage3D(T,u,d,h,g,i,s,l,_,y,t),n.bindTexture(T,null);break;case"2d":case"cube":n.bindTexture(T,e),n.texSubImage2D(T,u,d,h,i,s,_,y,t),n.bindTexture(T,null);break;default:throw new Error(o)}})}function B4(n,e,t){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=t,{x:d=0,y:h=0,z:g=0}=t,{glFormat:_,glType:y,compressed:T}=t,w=ED(t.glTarget,r,o);switch(r){case"2d-array":case"3d":T?n.compressedTexSubImage3D(w,l,d,h,g,i,s,o,_,e,u):n.texSubImage3D(w,l,d,h,g,i,s,o,_,y,e,u);break;case"2d":case"cube":T?n.compressedTexSubImage2D(w,l,d,h,i,s,_,e,u):n.texSubImage2D(w,l,d,h,i,s,_,y,e,u);break;default:throw new Error(r)}}function HQ(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function ED(n,e,t){return e==="cube"?34069+t:n}function WQ(n,e){var S;const{sourceX:t=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:d,sourceType:h}=e||{};const{framebuffer:g,deleteFramebuffer:_}=AD(n),{gl:y,handle:T}=g;o||(o=g.width),l||(l=g.height);const w=(S=g.colorAttachments[i])==null?void 0:S.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);u=(w==null?void 0:w.depth)||1,d||(d=(w==null?void 0:w.glFormat)||6408),h||(h=(w==null?void 0:w.glType)||5121),s=GQ(s,h,d,o,l),h=h||FQ(s);const x=y.bindFramebuffer(36160,T);return y.readBuffer(36064+i),y.readPixels(t,r,o,l,d,h,s),y.readBuffer(36064),y.bindFramebuffer(36160,x||null),_&&g.destroy(),s}function XQ(n,e){const{target:t,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:h,deleteFramebuffer:g}=AD(n);l=l||h.width,u=u||h.height;const _=h;d=d||5121;let y=t;if(!y){const w=SD(s),x=VQ(d),S=o+l*u*w*x;y=_.device.createBuffer({byteLength:S})}const T=n.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:n,width:l,height:u,origin:[r,i],destinationBuffer:y,byteOffset:o}),T.destroy(),g&&h.destroy(),y}function AD(n){return n instanceof qf?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:YQ(n),deleteFramebuffer:!0}}function YQ(n,e){const{device:t,width:r,height:i,id:s}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[n]})}function GQ(n,e,t,r,i,s){if(n)return n;e||(e=5121);const o=zQ(e,{clamped:!1}),l=SD(t);return new o(r*i*l)}class Kl extends kt{constructor(t,r){super(t,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"sampler");j(this,"view");j(this,"mipmaps");j(this,"compressed");j(this,"glTarget");j(this,"glFormat");j(this,"glType");j(this,"glInternalFormat");j(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=HQ(this.props.dimension);const s=bD(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:i}=t;if(!r||!i){const s=kt.getTextureDataSize(t.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Qa(this.device,{...this.props,texture:this}),this.bind(),$Q(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Qa(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof Rx?(this.sampler=t,r=t.props):(this.sampler=new Rx(this.device,t),r=t);const i=TD(r);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(be.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){be.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=kt.getExternalImageSize(t.image),i={...kt.defaultCopyExternalImageOptions,...r,...t},{image:s,depth:o,mipLevel:l,x:u,y:d,z:h,flipY:g}=i;let{width:_,height:y}=i;const{dimension:T,glTarget:w,glFormat:x,glInternalFormat:S,glType:A}=this;if(_=Math.min(_,this.width-u),y=Math.min(y,this.height-d),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return L4(this.device.gl,this.handle,s,{dimension:T,mipLevel:l,x:u,y:d,z:h,width:_,height:y,depth:o,glFormat:x,glType:A,glTarget:w,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const i=kt.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&be.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),B4(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of kt.CubeFaces)this.setTextureCubeFaceData(t[i],i)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,i=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&be.warn(`${this.id} has mipmap and multiple LODs.`)();const s=kt.CubeFaces.indexOf(r);this.setTexture2DData(t,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:i,height:s,pixels:o,data:l,format:u=6408,type:d=5121}=t,{gl:h}=this,g=o||l;this.bind(),g instanceof Promise?g.then(_=>this.setImageDataForFace(Object.assign({},t,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,u,i,s,0,u,d,g):h.texImage2D(r,0,u,u,d,g)}_getImageDataMap(t){for(let r=0;r<kt.CubeFaces.length;++r){const i=kt.CubeFaces[r];t[i]&&(t[34069+r]=t[i],delete t[i])}return t}_setSamplerParameters(t){be.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(t)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,i,s=this.glTarget){if(kt.isExternalImage(i)){L4(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(kt.isTextureLevelData(i)){B4(this.device.gl,i.data,{...this,depth:t,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const KQ=[1,2,4,8];class ZQ extends tx{constructor(t,r){var o;super(t,r);j(this,"device");j(this,"glParameters");this.device=t;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:l,height:u}=r.framebuffer;i=[0,0,l,u]}else{const[l,u]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,l,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=KQ.map(i=>!!(i&t.colorMask))),this.glParameters=r,Eo(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&id(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){id(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function QQ(n){return JQ.includes(n)}const JQ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],RD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function CD(n){const e=RD[n];if(!e)throw new Error("uniform");const[t,r,,i]=e;return{format:i,components:r,glType:t}}function eJ(n){const e=RD[n];if(!e)throw new Error("attribute");const[,t,,r,i]=e;return{attributeType:r,vertexFormat:i,components:t}}function tJ(n,e){const t={attributes:[],bindings:[]};t.attributes=nJ(n,e);const r=sJ(n,e);for(const l of r){const u=l.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=iJ(n,e);let s=0;for(const l of i)if(QQ(l.type)){const{viewDimension:u,sampleType:d}=oJ(l.type);t.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:d}),l.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const o=rJ(n,e);return o!=null&&o.length&&(t.varyings=o),t}function nJ(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=n.getAttribLocation(e,o);if(u>=0){const{attributeType:d}=eJ(l),h=/instance/i.test(o)?"instance":"vertex";t.push({name:o,location:u,stepMode:h,type:d})}}return t.sort((i,s)=>i.location-s.location),t}function rJ(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=n.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:d,components:h}=CD(l),g={location:i,name:o,type:d,size:u*h};t.push(g)}return t.sort((i,s)=>i.location-s.location),t}function iJ(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=n.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:d,isArray:h}=lJ(o);let g=n.getUniformLocation(e,d);const _={location:g,name:d,size:l,type:u,isArray:h};if(t.push(_),_.size>1)for(let y=0;y<_.size;y++){const T=`${d}[${y}]`;g=n.getUniformLocation(e,T);const w={..._,name:T,location:g};t.push(w)}}return t}function sJ(n,e){const t=(s,o)=>n.getActiveUniformBlockParameter(e,s,o),r=[],i=n.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:n.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},l=t(s,35395)||[],u=n.getActiveUniforms(e,l,35383),d=n.getActiveUniforms(e,l,35384),h=n.getActiveUniforms(e,l,35387),g=n.getActiveUniforms(e,l,35388);for(let _=0;_<o.uniformCount;++_){const y=n.getActiveUniform(e,l[_]);if(!y)throw new Error("activeInfo");o.uniforms.push({name:y.name,format:CD(u[_]).format,type:u[_],arrayLength:d[_],byteOffset:h[_],byteStride:g[_]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const aJ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function oJ(n){const e=aJ[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function lJ(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function cJ(n,e,t,r){const i=n;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,o);case 35664:return n.uniform2fv(e,o);case 35665:return n.uniform3fv(e,o);case 35666:return n.uniform4fv(e,o);case 5124:return n.uniform1iv(e,o);case 35667:return n.uniform2iv(e,o);case 35668:return n.uniform3iv(e,o);case 35669:return n.uniform4iv(e,o);case 35670:return n.uniform1iv(e,o);case 35671:return n.uniform2iv(e,o);case 35672:return n.uniform3iv(e,o);case 35673:return n.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return n.uniformMatrix2fv(e,!1,o);case 35675:return n.uniformMatrix3fv(e,!1,o);case 35676:return n.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function uJ(n){return sD(n)!==null||typeof n=="number"||typeof n=="boolean"}function fJ(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];uJ(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function dJ(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function hJ(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const U4=4;class pJ extends oo{constructor(t,r){super(t,r);j(this,"device");j(this,"handle");j(this,"vs");j(this,"fs");j(this,"introspectedLayout");j(this,"uniforms",{});j(this,"bindings",{});j(this,"varyings",null);j(this,"_uniformCount",0);j(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),be.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=tJ(this.device.gl,this.handle),be.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=gJ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[i,s]of Object.entries(t)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||be.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||be.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Gl)&&!(s.buffer instanceof Gl))throw new Error("buffer value");break;case"texture":if(!(s instanceof Qa||s instanceof Kl||s instanceof Yl))throw new Error("texture value");break;case"sampler":be.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(t){var x;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:d=!1,firstVertex:h=0,transformFeedback:g}=t,_=dJ(s),y=!!o.indexBuffer,T=(x=o.indexBuffer)==null?void 0:x.glIndexType;if(this.linkStatus!=="success")return be.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return be.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return OQ(this.device,i,w.glParameters,()=>{y&&d?this.device.gl.drawElementsInstanced(_,l||0,T,h,u||0):y?this.device.gl.drawElements(_,l||0,T,h):d?this.device.gl.drawArraysInstanced(_,h,l||0,u||0):this.device.gl.drawArrays(_,h,l||0),g&&g.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=fJ(t);Object.keys(r).forEach(i=>{be.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),be.time(U4,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),be.timeEnd(U4,`linkProgram for ${this.id}`)(),be.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}be.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),be.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){var r;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(be.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=t.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);t.uniformBlockBinding(this.handle,i,u),o instanceof Gl?t.bindBufferBase(35345,i,o.handle):t.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Qa||o instanceof Kl||o instanceof Yl))throw new Error("texture");let d;if(o instanceof Qa)d=o.texture;else if(o instanceof Kl)d=o;else if(o instanceof Yl&&o.colorAttachments[0]instanceof Qa)be.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=t,l=this.uniforms[r]??o;l!==void 0&&cJ(this.device.gl,i,s,l)}}}function gJ(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=t.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):be.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class mJ extends rx{constructor(t){super(t,{});j(this,"device");j(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":_J(this.device,r.options);break;case"copy-buffer-to-texture":vJ(this.device,r.options);break;case"copy-texture-to-buffer":yJ(this.device,r.options);break;case"copy-texture-to-texture":bJ(this.device,r.options);break;default:throw new Error(r.name)}}}function _J(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function vJ(n,e){throw new Error("Not implemented")}function yJ(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:d,byteOffset:h=0,bytesPerRow:g,rowsPerImage:_}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||g||_)throw new Error("not implemented");const{framebuffer:y,destroyFramebuffer:T}=ND(t);let w;try{const x=d,S=s||y.width,A=o||y.height,R=bD(y.colorAttachments[0].texture.props.format),E=R.format,C=R.type;n.gl.bindBuffer(35051,x.handle),w=n.gl.bindFramebuffer(36160,y.handle),n.gl.readPixels(u[0],u[1],S,A,E,C,h)}finally{n.gl.bindBuffer(35051,null),w!==void 0&&n.gl.bindFramebuffer(36160,w),T&&y.destroy()}}function bJ(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:h}=ND(t),[g,_]=i,[y,T,w]=s,x=n.gl.bindFramebuffer(36160,d.handle);let S=null,A;if(o instanceof Kl)S=o,l=Number.isFinite(l)?l:S.width,u=Number.isFinite(u)?u:S.height,S.bind(0),A=S.glTarget;else throw new Error("invalid destination");switch(A){case 3553:case 34067:n.gl.copyTexSubImage2D(A,r,y,T,g,_,l,u);break;case 35866:case 32879:n.gl.copyTexSubImage3D(A,r,y,T,w,g,_,l,u);break}S&&S.unbind(),n.gl.bindFramebuffer(36160,x),h&&d.destroy()}function ND(n){if(n instanceof kt){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class xJ extends nx{constructor(t,r){super(t,r);j(this,"device");j(this,"commandBuffer");this.device=t,this.commandBuffer=new mJ(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,i){}}function wJ(n){const{target:e,source:t,start:r=0,count:i=1}=n,s=t.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=t[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return n.target}class G1 extends ix{constructor(t,r){super(t,r);j(this,"device");j(this,"handle");j(this,"buffer",null);j(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return GV()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:d,integer:h,divisor:g}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(t,s,o,l,u):this.device.gl.vertexAttribPointer(t,s,o,d,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,g||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const i=yD(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const s=G1.isConstantAttributeZeroSupported(this.device)||t!==0;(r||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const i=TJ(r),s=i.byteLength*t,o=i.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!SJ(i,this.bufferValue),l){const u=DW(r.constructor,o);wJ({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function TJ(n){return Array.isArray(n)?new Float32Array(n):n}function SJ(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class EJ extends sx{constructor(t,r){super(t,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"layout");j(this,"buffers",{});j(this,"unusedBuffers",{});j(this,"bindOnUse",!0);j(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(hJ(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const i=this._getVaryingIndex(t),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(r);if(i<0){this.unusedBuffers[t]=s,be.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(t){if(F4(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Gl)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(t){if(F4(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,s,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,i,s)}}function F4(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class AJ extends ax{constructor(t,r){super(t,r);j(this,"device");j(this,"handle");j(this,"target",null);j(this,"_queryPending",!1);j(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class Ja extends ns{constructor(t){var g,_;super({...t,id:t.id||CQ("webgl-device")});j(this,"type","webgl");j(this,"handle");j(this,"features");j(this,"limits");j(this,"info");j(this,"canvasContext");j(this,"lost");j(this,"_resolveContextLost");j(this,"gl");j(this,"debug",!1);j(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});j(this,"_extensions",{});j(this,"_polyfilled",!1);j(this,"spectorJS");j(this,"renderPass",null);j(this,"_constants");const r=ns._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(_=(g=r.canvas)==null?void 0:g.gl)==null?void 0:_.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new _Q(this,r),this.lost=new Promise(y=>{this._resolveContextLost=y});const s={...t.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const l=this.props._handle||ZZ(this.canvasContext.canvas,{onContextLost:y=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:y=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(t._reuseDevices)return be.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=bQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=QZ(this.gl,this._extensions),this.limits=new pQ(this.gl),this.features=new hQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Ds(this.gl,{log:(...y)=>be.log(1,...y)()}).trackState(this.gl,{copyState:!1});const d=t.debugWebGL||t.debug,h=t.debugWebGL;d&&(this.gl=TQ(this.gl,{debugWebGL:d,traceWebGL:h}),be.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(be.level=Math.max(be.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new Gl(this,r)}createTexture(t){return new Kl(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Rx(this,t)}createShader(t){return new IQ(this,t)}createFramebuffer(t){return new Yl(this,t)}createVertexArray(t){return new G1(this,t)}createTransformFeedback(t){return new EJ(this,t)}createQuerySet(t){return new AJ(this,t)}createRenderPipeline(t){return new pJ(this,t)}beginRenderPass(t){return new ZQ(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new xJ(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return WQ(t,r)}readPixelsToBufferWebGL(t,r){return XQ(t,r)}setParametersWebGL(t){Eo(this.gl,t)}getParametersWebGL(t){return _D(this.gl,t)}withParametersWebGL(t,r){return id(this.gl,t,r)}resetWebGL(){be.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),WZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return cQ(this.gl,t,this._extensions)}loseDevice(){var s;let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Ds.get(this.gl).push()}popState(){Ds.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const i=Number(t);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(t,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[t];switch(s&&kJ(s,r)&&be.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:RJ(this,t,r);break;case Int32Array:CJ(this,t,r);break;case Uint32Array:NJ(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return mo(this.gl,t,this._extensions),this._extensions}}function RJ(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function CJ(n,e,t){n.gl.vertexAttribI4iv(e,t)}function NJ(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function kJ(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const MJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},IJ=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),OJ=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),PJ=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function DJ(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&jJ(i),i}return this.originalGetContext(t,r)}}function jJ(n){n.getExtension("EXT_color_buffer_float");const e={...MJ,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:IJ(n),OES_vertex_array_object:OJ(n),ANGLE_instanced_arrays:PJ(n)},t=n.getExtension;n.getExtension=function(i){const s=t.call(n,i);return s||(i in e?e[i]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){const i=r.apply(n)||[];return i==null?void 0:i.concat(Object.keys(e))}}const of=1;class LJ extends fW{constructor(){super();j(this,"type","webgl");ns.defaultProps={...ns.defaultProps,...Y1},Ja.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){DJ(t)}async attach(t){if(t instanceof Ja)return t;if((t==null?void 0:t.device)instanceof ns)return t.device;if(!BJ(t))throw new Error("Invalid WebGL2RenderingContext");return new Ja({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){be.groupCollapsed(of,"WebGLDevice created")();const r=[];(t.debugWebGL||t.debug)&&r.push(wQ()),t.debugSpectorJS&&r.push(yQ(t));const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&be.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new Ja(t),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return be.probe(of,o)(),be.table(of,s.info)(),be.groupEnd(of)(),s}}function BJ(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const z4=new LJ;function Hi(){}const UJ=({isDragging:n})=>n?"grabbing":"grab",kD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Hi,onWebGLInitialized:Hi,onResize:Hi,onViewStateChange:Hi,onInteractionStateChange:Hi,onBeforeRender:Hi,onAfterRender:Hi,onLoad:Hi,onError:n=>gt.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:UJ,getTooltip:null,debug:!1,drawPickingColors:!1};class K1{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Zd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=mx[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,d=u&&(u[i]||u.props[i]),h=this.props[i];let g=!1;d&&(g=d.call(u,l,r)),g||(h==null||h(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...kD,...e},e=this.props,e.viewState&&e.initialViewState&&gt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&gt.error("WebGL1 context not supported.")(),t=z4.attach(e.gl)),t||(t=J0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[z4],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&uc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,i,s,o,l,u,d,h;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&gt.removed("onLayerHover","onHover")(),"onLayerClick"in e&&gt.removed("onLayerClick","onClick")(),e.initialViewState&&!Ar(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||r||i||s||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return vn(this.viewManager),this.viewManager.views}getViewports(e){return vn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,r){vn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),vn(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,(i=this.viewManager)==null||i.setProps({width:t,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:i,useDevicePixels:s}=t;return new $K({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new pD({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,r,i,s;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=l,d=!1;for(const h of o)u=h,d=((r=h.layer)==null?void 0:r.onHover(h,e.event))||d;d||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new iD;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new yG(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(o4).map(o=>{var y;const[l,u,d,h]=o4[o],g=(y=this.props.eventRecognizerOptions)==null?void 0:y[o],_={...u,...g,event:o};return{recognizer:new l(_),recognizeWith:d,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in mx)this.eventManager.on(o,this._onEvent);this.viewManager=new pZ({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new hZ(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new CZ({deck:this,device:this.device}),this.deckRenderer=new MZ(this.device),this.deckPicker=new LZ(this.device),this.widgetManager=new FZ({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new VZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),gt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=J0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}K1.defaultProps=kD;K1.VERSION=mH;function FJ(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return cP(n)}}const zJ=lP;function lf(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ns(n){return n.stride||n.size*n.bytesPerElement}function VJ(n,e){return n.type===e.type&&n.size===e.size&&Ns(n)===Ns(e)&&(n.offset||0)===(e.offset||0)}function Cx(n,e){e.offset&&gt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Ns(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,s=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:s,stride:t}}function qJ(n,e){const t=Cx(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class $J{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&t.isIndexed?l="uint32":l=i||"float32";let u=FJ(i||l);this.doublePrecision=s,s&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ns(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),uc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const i=this.value;if(t){const s=Cx(this.getAccessor(),t),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:Ns(r),attributes:i};if(this.doublePrecision){const o=qJ(r,t||{});i.push(lf(e,{...r,...o.high},this.device.type),lf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(t){const o=Cx(r,t);i.push(lf(e,{...r,...o},this.device.type))}else i.push(lf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,s=r*i;if(t&&s&&t.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const h=t[u++];h<o[d]&&(o[d]=h),h>l[d]&&(l[d]=h)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof xt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=zJ(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=Ns(i)}if(t.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;t.externalBuffer=s,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:o}=this;const l=Ns(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=g0(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const d=s.byteLength+u+l*2;(!o||o.byteLength<d)&&(o=this._createBuffer(d)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?g0(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,s=uc.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),t&&i&&l.write(i instanceof Float64Array?g0(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&gt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let o=s;for(;--o>=0;)t[r+o]=i[o];return t}switch(s){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)t[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(t?xt.INDEX:xt.VERTEX)|xt.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const V4=[],q4=[];function HJ(n,e=0,t=1/0){let r=V4;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(q4.length=n.length,r=q4):r=V4,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function MD(n){return n&&n[Symbol.asyncIterator]}function WJ(n,e){const{size:t,stride:r,offset:i,startIndices:s,nested:o}=e,l=n.BYTES_PER_ELEMENT,u=r?r/l:t,d=i?i/l:0,h=Math.floor((n.length-d)/u);return(g,{index:_,target:y})=>{if(!s){const S=_*u+d;for(let A=0;A<t;A++)y[A]=n[S+A];return y}const T=s[_],w=s[_+1]||h;let x;if(o){x=new Array(w-T);for(let S=T;S<w;S++){const A=S*u+d;y=new Array(t);for(let R=0;R<t;R++)y[R]=n[A+R];x[S-T]=y}}else if(u===t)x=n.subarray(T*t+d,w*t+d);else{x=new n.constructor((w-T)*t);let S=0;for(let A=T;A<w;A++){const R=A*u+d;for(let E=0;E<t;E++)x[S++]=n[R+E]}}return x}}const XJ=[],Tf=[[0,1/0]];function YJ(n,e){if(n===Tf||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let s=0;s<r;s++){const o=n[s];o[1]<e[0]?(t.push(o),i=s+1):o[0]>e[1]?t.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return t.splice(i,0,e),t}const GJ={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function ID(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...GJ[t],...e,...n,type:t}}class OD extends $J{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Tf}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!VJ(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return ID(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=YJ(this.state.updateRanges,[r,i])}else this.state.updateRanges=Tf}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=XJ}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Tf),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[d,h]of s)o.call(i,this,{data:t,startRow:d,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,h]of s){const g=Number.isFinite(d)?this.getVertexOffset(d):0,_=Number.isFinite(h)?this.getVertexOffset(h):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;vn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=WJ(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(const s in t){const o=super._getBufferLayout(s,t[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:d,size:h,startIndices:g}=e,{accessor:_,transform:y}=l;let T=u.binaryAccessor||(typeof _=="function"?_:s[_]);typeof T!="function"&&(T=()=>T),vn(typeof T=="function",`accessor "${_}" is not a function`);let w=e.getVertexOffset(r);const{iterable:x,objectInfo:S}=HJ(t,r,i);for(const A of x){S.index++;let R=T(A,S);if(y&&(R=y.call(this,R)),g){const E=(S.index<g.length-1?g[S.index+1]:o)-g[S.index];if(R&&Array.isArray(R[0])){let C=w;for(const O of R)e._normalizeValue(O,d,C),C+=h}else R&&R.length>h?d.set(R,w):(e._normalizeValue(R,S.target,0),lZ({target:d,source:S.target,start:w,count:E}));w+=E*h}else e._normalizeValue(R,d,w),w+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function S0(n){const{source:e,target:t,start:r=0,size:i,getData:s}=n,o=n.end||t.length,l=e.length,u=o-r;if(l>u){t.set(e.subarray(0,u),r);return}if(t.set(e,r),!s)return;let d=l;for(;d<u;){const h=s(d,e);for(let g=0;g<i;g++)t[r+d]=h[g]||0,d++}}function KJ({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return S0({source:n,target:e,size:t,getData:r}),e;let o=0,l=0;const u=r&&((h,g)=>r(h+l,g)),d=Math.min(i.length,s.length);for(let h=1;h<d;h++){const g=i[h]*t,_=s[h]*t;S0({source:n.subarray(o,g),target:e,start:l,end:_,size:t,getData:u}),o=g,l=_}return l<e.length&&S0({source:[],target:e,start:l,size:t,getData:u}),e}function ZJ(n){const{device:e,settings:t,value:r}=n,i=new OD(e,t);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function PD(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function DD(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function jD(n){n.push(n.shift())}function QJ(n,e){const{doublePrecision:t,settings:r,value:i,size:s}=n,o=t&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=n.settings;if(u)for(const d of Object.values(u))l=Math.max(l,d.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function LD({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function BD({device:n,buffer:e,attribute:t,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*l,d=t.byteOffset,h=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,g=t.startIndices,_=s&&g,y=t.isConstant;if(!_&&e&&r>=i)return e;const T=t.value instanceof Float64Array?Float32Array:t.value.constructor,w=y?t.value:new T(t.getBuffer().readSyncWebGL(d,i*T.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!y){const R=o;o=(E,C)=>t.normalizeConstant(R(E,C))}const x=y?(R,E)=>o(w,E):(R,E)=>o(w.subarray(R+d,R+d+u),E),S=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),A=new Float32Array(i);return KJ({source:S,target:A,sourceStartIndices:s,targetStartIndices:g,size:u,getData:x}),(!e||e.byteLength<A.byteLength+h)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:A.byteLength+h,usage:35050})),e.write(A,h),e}class UD{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new rh(r),this.attribute=t,this.attributeInTransition=ZJ(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=QJ(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class JJ extends UD{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=ree(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;jD(s),s[0]=BD({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=LD({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let d=Math.floor(this.currentLength/o.size);FD(o)&&(d/=2),u.setVertexCount(d),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let i=r/e;t&&(i=t(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const eee=`uniform interpolationUniforms {
  float time;
} interpolation;
`,$4={name:"interpolation",vs:eee,uniformTypes:{time:"f32"}},tee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,nee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function FD(n){return n.doublePrecision&&n.value instanceof Float64Array}function ree(n,e){const t=e.size,r=PD(t),i=DD(t),s=e.getBufferLayout();return FD(e)?new fc(n,{vs:nee,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[_Y,$4],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new fc(n,{vs:tee,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[$4],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class iee extends UD{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=uee(e),this.framebuffer=fee(e,this.texture),this.transform=cee(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=BD({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=LD({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),jD(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const see=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,aee={name:"spring",vs:see,uniformTypes:{damping:"f32",stiffness:"f32"}},oee=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,lee=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function cee(n,e){const t=PD(e.size),r=DD(e.size);return new fc(n,{vs:oee,fs:lee,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[aee],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function uee(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function fee(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const dee={interpolation:JJ,spring:iee};class hee{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(t);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=dee[r.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(gt.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const H4="attributeManager.invalidate",pee="attributeManager.updateStart",gee="attributeManager.updateEnd",mee="attribute.updateStart",_ee="attribute.allocate",vee="attribute.updateEnd";class yee{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Cc(MK),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new hee(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Tn(H4,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Tn(H4,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;Tn(pee,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const h=this.attributes[d],g=h.settings.accessor;h.startIndices=r,h.numInstances=t,s[d]&&gt.removed(`props.${d}`,`data.attributes.${d}`)(),h.setExternalBuffer(o[d])||h.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&h.setConstantValue(s[g])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:t,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&Tn(gee,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in t){const o=t[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new OD(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Tn(mee,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Tn(_ee,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Tn(vee,t,r))}}class bee extends rh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Zf(t,r,o)}}const W4=1e-5;function X4(n,e,t,r,i){const s=e-n,l=(t-e)*i,u=-s*r;return l+u+s+e}function xee(n,e,t,r,i){if(Array.isArray(t)){const s=[];for(let o=0;o<t.length;o++)s[o]=X4(n[o],e[o],t[o],r,i);return s}return X4(n,e,t,r,i)}function Y4(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class wee extends rh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=xee(s,o,t,r,i);const u=Y4(l,t),d=Y4(l,o);u<W4&&d<W4&&(l=t,this.end()),this._prevValue=o,this._currValue=l}}const Tee={interpolation:bee,spring:wee};class See{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;t=d,this.remove(e)}if(i=ID(i),!i)return;const o=Tee[i.type];if(!o){gt.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:t,toValue:r}),s.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Eee(n){const e=n[Ps];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function Aee(n,e){const t=zD({newProps:n,oldProps:e,propTypes:n[Ps],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Cee(n,e);let i=!1;return r||(i=Nee(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:kee(n,e),transitionsChanged:Ree(n,e)}}function Ree(n,e){if(!n.transitions)return!1;const t={},r=n[Ps];let i=!1;for(const s in n.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&Nx(n[s],e[s],o)&&(t[s]=!0,i=!0)}return i?t:!1}function zD({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(n))if(!(s in t)){if(!(s in e))return`${i}.${s} added`;const o=Nx(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in t)){if(!(s in n))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(n,s)){const o=Nx(n[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Nx(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function Cee(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function Nee(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&G4(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&G4(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function kee(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function G4(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},zD({oldProps:i,newProps:r,triggerName:t})}const Mee="count(): argument not an object",Iee="count(): argument not a container";function Oee(n){if(!Dee(n))throw new Error(Mee);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(Pee(n))return Object.keys(n).length;throw new Error(Iee)}function Pee(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function Dee(n){return n!==null&&typeof n=="object"}function K4(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const jee={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},kx={};function Lee(n,e,t,r){if(t instanceof kt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...jee,...i,...r},mipmaps:!0});return kx[s.id]=n,s}function Bee(n,e){!e||!(e instanceof kt)||kx[e.id]===n&&(e.delete(),delete kx[e.id])}const Uee={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Mx(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Ar(n,e,1)}},accessor:{validate(n,e){const t=sd(n);return t==="function"||t===sd(e.value)},equal(n,e,t){return typeof e=="function"?!0:Ar(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Mx(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Ar(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?Ar(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:Lee(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{Bee(t.id,n)}}};function Fee(n){const e={},t={},r={};for(const[i,s]of Object.entries(n)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=zee(i,s);e[i]=l,t[i]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function zee(n,e){switch(sd(e)){case"object":return kl(n,e);case"array":return kl(n,{type:"array",value:e,compare:!1});case"boolean":return kl(n,{type:"boolean",value:e});case"number":return kl(n,{type:"number",value:e});case"function":return kl(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function kl(n,e){return"type"in e?{name:n,...Uee[e.type],...e}:"value"in e?{name:n,type:sd(e.value),...e}:{name:n,type:"object",value:e}}function Mx(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function sd(n){return Mx(n)?"array":n===null?"null":typeof n}function Vee(n,e){let t;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(t=o.extensions)}const r=Ix(n.constructor,t),i=Object.create(r);i[rd]=n,i[zs]={},i[ts]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const qee="_mergedDefaultProps";function Ix(n,e){if(!(n instanceof ih.constructor))return{};let t=qee;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const r=VD(n,t);return r||(n[t]=$ee(n,e||[]))}function $ee(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=Ix(r),s=VD(n,"defaultProps")||{},o=Fee(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[Ps],o.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[y0],o.deprecatedProps);for(const h of e){const g=Ix(h.constructor);g&&(Object.assign(l,g),Object.assign(u,g[Ps]),Object.assign(d,g[y0]))}return Hee(l,n),Xee(l,u),Wee(l,d),l[Ps]=u,l[y0]=d,e.length===0&&!Z1(n,"_propTypes")&&(n._propTypes=u),l}function Hee(n,e){const t=Gee(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function Wee(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i=`${this.id}: ${t}`;for(const s of e[t])Z1(this,s)||(this[s]=r);gt.deprecated(i,e[t].join("/"))()}})}function Xee(n,e){const t={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(t[o]=l,r[o]=Yee(o))}n[ro]=t,n[zs]={},Object.defineProperties(n,r)}function Yee(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||MD(e)?this[zs][n]=e:this[ts][n]=e},get(){if(this[ts]){if(n in this[ts])return this[ts][n]||this[ro][n];if(n in this[zs]){const e=this[rd]&&this[rd].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ro][n]}}return this[ro][n]}}}function Z1(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function VD(n,e){return Z1(n,e)&&n[e]}function Gee(n){const e=n.componentName;return e||gt.warn(`${n.name}.componentName not specified`)(),e||n.name}let Kee=0;class ih{constructor(...e){this.props=Vee(this,e),this.id=this.props.id,this.count=Kee++}clone(e){const{props:t}=this,r={};for(const i in t[ro])i in t[ts]?r[i]=t[ts][i]:i in t[zs]&&(r[i]=t[zs][i]);return new this.constructor({...t,...r,...e})}}ih.componentName="Component";ih.defaultProps={};const Zee=Object.freeze({});class Qee{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Zee}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[rd]||this.component;const t=e[ts]||{},r=e[zs]||e,i=e[ro]||{};for(const s in t){const o=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),t[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(MD(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Ps];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Jee extends Qee{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const ete="layer.changeFlag",tte="layer.initialize",nte="layer.update",rte="layer.finalize",ite="layer.matched",Z4=2**24-1,ste=Object.freeze([]),ate=Cc(({oldViewport:n,viewport:e})=>n.equals(e));let xr=new Uint8ClampedArray(0);const ote={data:{type:"data",value:ste,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=t.context;i=i||t.getLoadOptions(),r=r||t.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let l=o.contains(n);return!l&&!i&&(o.add({resourceId:n,data:W0(n,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:n,onChange:u=>{var d;return(d=t.internalState)==null?void 0:d.reloadAsyncProp(e,u)},consumerId:t.id,requestId:e}):W0(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ze.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Nc extends ih{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Xa.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){vn(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=rD(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=QP(r,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return vn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){vn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return LK(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ze.DEFAULT||e===Ze.LNGLAT||e===Ze.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){vn(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Oee(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=K4(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=K4(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=t.attributes,d=l||u;d&&(o&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!o&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){var r,i,s,o;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!ate({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(xr.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>Z4&&gt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),xr=uc.allocate(xr,t,{size:4,copy:!0,maxCount:Math.max(t,Z4)});const i=Math.floor(xr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),xr[o*4+0]=s[0],xr[o*4+1]=s[1],xr[o*4+2]=s[2],xr[o*4+3]=0}e.value=xr.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var l;if(!Object.keys(t).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const i=((l=e.userData)==null?void 0:l.excludeAttributes)||{},s={},o={};for(const u in t){if(i[u])continue;const d=t[u].getValue();for(const h in d){const g=d[h];g instanceof xt?t[u].settings.isIndexed?e.setIndexBuffer(g):s[h]=g:g&&(o[h]=g)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&t.attributes&&t.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const h=s.getVertexOffset(d);l[h]===u[0]&&l[h+1]===u[1]&&l[h+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==xr.buffer&&(r.value=xr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){vn(!this.internalState),vn(Number.isFinite(this.props.coordinateSystem)),Tn(tte,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Jee({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(gt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new See(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Tn(ite,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Tn(nte,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const h of this.props.extensions)h.updateState.call(this,l,h);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(l,d)}finally{r.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Tn(rte,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof Ja&&o.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(o.device instanceof Ja)o.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=t[i];o&&Array.isArray(l)&&(t.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&Tn(ete,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var i;const r=Aee(e,t);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){Eee(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new yee(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(t||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Nc.defaultProps=ote;Nc.layerName="Layer";const E0=Math.PI/180;function lte({height:n,focalDistance:e,orbitAxis:t,rotationX:r,rotationOrbit:i,zoom:s}){const o=t==="Z"?[0,0,1]:[0,1,0],l=t==="Z"?[0,-e,0]:[0,0,e],u=new Cr().lookAt({eye:l,up:o});u.rotateX(r*E0),t==="Z"?u.rotateZ(i*E0):u.rotateY(i*E0);const d=Math.pow(2,s)/n;return u.scale(d),u}class cte extends So{constructor(e){const{height:t,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:l=0,rotationOrbit:u=0,zoom:d=0}=e,h=r?r[5]/2:V1(i);super({...e,longitude:void 0,viewMatrix:lte({height:t||1,focalDistance:h,orbitAxis:s,rotationX:l,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:h,position:o,zoom:d}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:t=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=t?i:this.height-i,[l,u,d]=th([r,o,s],this.pixelUnprojectionMatrix);return[l,u,d]}panByPosition(e,t){const r=this.project(e),i=[this.width/2+r[0]-t[0],this.height/2+r[1]-t[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class ute extends hD{constructor(e){const{width:t,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:l=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:h=-1/0,maxZoom:g=1/0,startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}=e;super({width:t,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:l,minRotationX:u,maxRotationX:d,minZoom:h,maxZoom:g},{startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:t}){const r=this.getState().startPanPosition||t;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:l,height:u}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let d;if(e){let h=(e[0]-i[0])/l;const g=(e[1]-i[1])/u;(s<-90||s>90)&&(h*=-1),d={rotationX:s+g*180,rotationOrbit:o+h*180}}else d={rotationX:s+r,rotationOrbit:o+t};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-t.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:r,minZoom:i}=this.getViewportProps();t===void 0&&(t=this.getViewportProps().zoom);const s=t+Math.log2(e);return Yn(s,i,r)}_panFromCenter(e){const{width:t,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:l}=e;return e.zoom=Array.isArray(i)?[Yn(i[0],r,t),Yn(i[1],r,t)]:Yn(i,r,t),e.rotationX=Yn(e.rotationX,o,s),(l<-180||l>180)&&(e.rotationOrbit=RK(l+180,360)-180),e}}class fte extends dD{constructor(){super(...arguments),this.ControllerState=ute,this.transition={transitionDuration:300,transitionInterpolator:new $1({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class qD extends Vs{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return cte}get ControllerType(){return fte}}qD.displayName="OrbitView";const dte=typeof window<"u"?U.useLayoutEffect:U.useEffect;function ad(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const hte={position:"absolute",zIndex:-1};function $D(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>$D(t,e));if(sh(n)){if(pte(n))return e.style=hte,U.cloneElement(n,e);if(gte(n))return U.cloneElement(n,e)}return n}function sh(n){return n&&typeof n=="object"&&"type"in n||!1}function pte(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function gte(n){const e=n.type;return e&&e.deckGLViewProps}function Ox(n){if(typeof n=="function")return U.createElement(Vs,{},n);if(Array.isArray(n))return n.map(Ox);if(sh(n)){if(n.type===U.Fragment)return Ox(n.props.children);if(ad(n.type,Vs))return n}return n}function mte({children:n,layers:e=[],views:t=null}){const r=[],i=[],s={};return U.Children.forEach(Ox(n),o=>{if(sh(o)){const l=o.type;if(ad(l,Nc)){const u=_te(l,o.props);i.push(u)}else r.push(o);if(ad(l,Vs)&&l!==Vs&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(t)?t.forEach(o=>{s[o.id]=o}):t&&(s[t.id]=t),t=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:t}}function _te(n,e){const t={},r=n.defaultProps||{};for(const i in e)r[i]!==e[i]&&(t[i]=e[i]);return new n(t)}const vte=U.createContext();function yte({children:n,deck:e,ContextProvider:t=vte.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of n){let l=s,u=o;sh(o)&&ad(o.type,Vs)&&(l=o.props.id||s,u=o.props.children);const d=r.getViewport(l),h=r.getViewState(l);if(d){h.padding=d.padding;const{x:g,y:_,width:y,height:T}=d;u=$D(u,{x:g,y:_,width:y,height:T,viewport:d,viewState:h}),i[l]||(i[l]={viewport:d,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:d,y:h,width:g,height:_}=l,y={position:"absolute",left:d,top:h,width:g,height:_},T=`view-${o}`,w=U.createElement("div",{key:T,id:T,style:y},...u),x={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:A=>{A.viewId=o,e._onViewStateChange(A)},widgets:[]},S=`view-${o}-context`;return U.createElement(t,{key:S,value:x},w)})}const bte={mixBlendMode:null};function xte({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},i={left:0,top:0};if(t)for(const s in t)s in bte?i[s]=t[s]:r[s]=t[s];return{containerStyle:r,canvasStyle:i}}function wte(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function HD(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function Tte(n,e,t){var i,s,o;const r=new e({...t,_customRender:((o=(s=(i=t.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:l=>{n.redrawReason=l;const u=r.getViewports();n.lastRenderedViewports!==u?n.forceUpdate():HD(n)}});return r}function Ste(n,e){const[t,r]=U.useState(0),s=U.useRef({control:null,version:t,forceUpdate:()=>r(C=>C+1)}).current,o=U.useRef(null),l=U.useRef(null),u=U.useMemo(()=>mte(n),[n.layers,n.views,n.children]);let d=!0;const h=C=>{var O;return d&&n.viewState?(s.viewStateUpdateRequested=C,null):(s.viewStateUpdateRequested=null,(O=n.onViewStateChange)==null?void 0:O.call(n,C))},g=C=>{var O;d?s.interactionStateUpdateRequested=C:(s.interactionStateUpdateRequested=null,(O=n.onInteractionStateChange)==null||O.call(n,C))},_=U.useMemo(()=>{const C={widgets:[],...n,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:g};return delete C._customRender,s.deck&&s.deck.setProps(C),C},[n]);U.useEffect(()=>{const C=n.Deck||K1;return s.deck=Tte(s,C,{..._,parent:o.current,canvas:l.current}),()=>{var O;return(O=s.deck)==null?void 0:O.finalize()}},[]),dte(()=>{HD(s);const{viewStateUpdateRequested:C,interactionStateUpdateRequested:O}=s;C&&h(C),O&&g(O)}),U.useImperativeHandle(e,()=>wte(s),[]);const y=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:w="100%",height:x="100%",id:S,style:A}=n,{containerStyle:R,canvasStyle:E}=U.useMemo(()=>xte({width:w,height:x,style:A}),[w,x,A]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===y||s.version!==t){s.lastRenderedViewports=y,s.version=t;const C=yte({children:u.children,deck:s.deck,ContextProvider:T}),O=U.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:l,style:E});s.control=U.createElement("div",{id:`${S||"deckgl"}-wrapper`,ref:o,style:R},[O,C])}return d=!1,s.control}const Ete=U.forwardRef(Ste),Ate=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,Q4=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Rte={name:"line",source:Ate,vs:Q4,fs:Q4,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Cte=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90°: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Nte=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,kte=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mte=[0,0,0,255],Ite={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:Mte},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Zl extends Nc{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Nte,fs:kte,source:Cte,modules:[GP,eD,Rte]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,u={widthUnits:Fs[t],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:u}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...u,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new go(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Zl.layerName="LineLayer";Zl.defaultProps=Ite;const J4=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Ote={name:"scatterplot",vs:J4,fs:J4,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Pte=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Dte=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jte=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,eM=[0,0,0,255],Lte={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:eM},getLineColor:{type:"accessor",value:eM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Q1 extends Nc{getShaders(){return super.getShaders({vs:Pte,fs:Dte,source:jte,modules:[GP,eD,Ote]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:d,lineWidthUnits:h,lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y}=this.props,T={stroked:o,filled:l,billboard:u,antialiasing:d,radiusUnits:Fs[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Fs[h],lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y},w=this.state.model;w.shaderInputs.setProps({scatterplot:T}),w.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new go(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new lD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Q1.defaultProps=Lte;Q1.layerName="ScatterplotLayer";function J1(n,e,t=160,r=[100,100,100,255],i=2){const s=[];if(!n||!n.coordinates)return s;const o=n.bounds||WD(n),[l,u,d,h]=o,g=(l+d)/2,_=(u+h)/2,y=Math.max(d-l,h-u)||1,T=(x,S)=>{const A=(x-g)/y*t,R=(S-_)/y*t;return[A,R]},w=x=>{for(let S=0;S<x.length-1;S++){const[A,R]=T(x[S][0],x[S][1]),[E,C]=T(x[S+1][0],x[S+1][1]);s.push({source:[A,R,e],target:[E,C,e],color:r,width:i})}};switch(n.type){case"Polygon":const x=n.coordinates;if(x.length>0){w(x[0]);for(let R=1;R<x.length;R++)w(x[R])}break;case"MultiPolygon":const S=n.coordinates;for(const R of S)if(R.length>0){w(R[0]);for(let E=1;E<R.length;E++)w(R[E])}break;case"LineString":Array.isArray(n.coordinates)&&n.coordinates.length>0&&Array.isArray(n.coordinates[0])&&typeof n.coordinates[0][0]=="number"&&w(n.coordinates);break;case"MultiLineString":const A=n.coordinates;for(const R of A)w(R);break;case"GeometryCollection":if("geometries"in n){const R=n.geometries;for(const E of R)E.type==="LineString"&&E.coordinates&&w(E.coordinates)}break;default:console.warn(`Unsupported geometry type: ${n.type}`)}return s}function WD(n){let e=1/0,t=1/0,r=-1/0,i=-1/0;const s=o=>{if(typeof o[0]=="number"){const[l,u]=o;e=Math.min(e,l),t=Math.min(t,u),r=Math.max(r,l),i=Math.max(i,u)}else for(const l of o)s(l)};if(n.coordinates&&s(n.coordinates),"geometries"in n){const o=n.geometries;for(const l of o)l.coordinates&&s(l.coordinates)}return[e,t,r,i]}function XD(n,e,t=12,r=160,i=[100,100,100],s,o){const l=[];if(!s||!n)return l;const u=o??.1,d=120,h=2,g=[i[0],i[1],i[2],d],_=J1(n,u,r,g,h);return l.push(..._),l}function Px(n=10,e=160){const t=[];for(let r=0;r<=n;r++){const i=r/n;t.push({type:"LineString",coordinates:[[i,0],[i,1]]})}for(let r=0;r<=n;r++){const i=r/n;t.push({type:"LineString",coordinates:[[0,i],[1,i]]})}return{type:"GeometryCollection",coordinates:[],crs:"unit_grid",name:`${n}x${n} Unit Grid`,bounds:[0,0,1,1],geometries:t}}const tM=Object.freeze(Object.defineProperty({__proto__:null,calculateShapeBounds:WD,convertShapeToLines3D:J1,createGeographicTemporalPlanes:XD,createUnitGridShape:Px},Symbol.toStringTag,{value:"Module"}));function Bte(n,e,t){if(!n.location||!e.location||n.location.x!==e.location.x||n.location.y!==e.location.y)return!1;const r=t.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===n.id||d===n.id}),i=t.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===e.id||d===e.id});if(r.length!==i.length)return!1;const s=new Set,o=new Set;if(r.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==n.id&&s.add(u),d!==n.id&&s.add(d)}),i.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==e.id&&o.add(u),d!==e.id&&o.add(d)}),s.size!==o.size)return!1;for(const l of s)if(!o.has(l))return!1;return!0}function YD(n,e){const t=new Set,r=[],i=[],s=new Map;for(let l=0;l<n.length;l++){if(t.has(n[l].id))continue;const u=n[l],d=[u];if(u.is_sample){r.push(u),s.set(u.id,u.id),t.add(u.id);continue}for(let h=l+1;h<n.length;h++){const g=n[h];t.has(g.id)||g.is_sample||u.time===g.time&&u.is_sample===g.is_sample&&Bte(u,g,e)&&(d.push(g),t.add(g.id))}if(d.length>1){const h={...u,id:u.id,is_combined:!0,combined_nodes:d.map(g=>g.id)};r.push(h),d.forEach(g=>s.set(g.id,h.id))}else r.push(u),s.set(u.id,u.id);t.add(u.id)}const o=new Set;return e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id,h=s.get(u),g=s.get(d);if(h!==void 0&&g!==void 0&&h!==g){const _=`${Math.min(h,g)}-${Math.max(h,g)}`;o.has(_)||(o.add(_),i.push({...l,source:h,target:g}))}}),{nodes:r,edges:i}}const kc=(n,e,t)=>{const r=t.some(s=>(typeof s.target=="number"?s.target:s.target.id)===n.id),i=t.some(s=>(typeof s.source=="number"?s.source:s.source.id)===n.id);return!r&&i},Ute=(n,e,t)=>t?`Lat: ${e.toFixed(3)}°, Lon: ${n.toFixed(3)}°`:`(${n.toFixed(2)}, ${e.toFixed(2)})`,ht={AUTO_FIT_ZOOM:1.8,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,BASE_ELEVATION:.1,SELECTED_NODE_SCALE:1.5,TEMPORAL_FADE_OPACITY:.5,EDGE_FADE_OPACITY:.2,EDGE_PARTIAL_FADE_OPACITY:.5,REDUCED_OPACITY_MULTIPLIER:.3,GEOGRAPHIC_OPACITY_SCALE:2.5,GEOGRAPHIC_REDUCED_OPACITY:.3,TEMPORAL_OPACITY_SCALE:.3,GRID_EXTENSION:2,UNIT_GRID_SIZE:10},ql={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},Ki={GEOGRAPHIC_ACTIVE:.5,GEOGRAPHIC_NORMAL:3,TIME_SLICE_ACTIVE:.5,TIME_SLICE_NORMAL:1.5,NODE_OUTLINE_SELECTED:2,NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4},Fte=n=>n*ht.JITTER_SCALE%ht.JITTER_RANGE-ht.JITTER_OFFSET,zte=(n,e,t)=>n.is_sample?ql.SAMPLE:n.is_combined?ql.COMBINED:kc(n,e,t)?ql.ROOT:ql.DEFAULT,Vte=(n,e,t,r)=>{if(t!=="planes"||!e)return r;const[i,s]=e;return n>=i&&n<=s?r:r*ht.TEMPORAL_FADE_OPACITY},qte=(n,e,t,r,i)=>{if(r!=="planes"||!t)return i;const[s,o]=t,l=n.time>=s&&n.time<=o,u=e.time>=s&&e.time<=o;return!l&&!u?i*ht.EDGE_FADE_OPACITY:!l||!u?i*ht.EDGE_PARTIAL_FADE_OPACITY:i},nM=(n,e,t)=>n||(e==="unit_grid"?Px(ht.UNIT_GRID_SIZE,t):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):Px(ht.UNIT_GRID_SIZE,t)),$te=(n,e,t)=>{const{nodes:r}=YD(n,[]),i=r.filter(w=>{var x,S;return((x=w.location)==null?void 0:x.x)!==void 0&&((S=w.location)==null?void 0:S.y)!==void 0});if(i.length===0)return null;const s=i.map(w=>w.location.x),o=i.map(w=>w.location.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let g,_,y;if((e==="eastern_hemisphere"||e==="custom")&&(t==null?void 0:t.bounds)){const w=t.bounds,[x,S,A,R]=w;g=(x+A)/2,_=(S+R)/2,y=Math.max(A-x,R-S)||1}else g=(l+u)/2,_=(d+h)/2,y=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:g,centerY:_,maxScale:y,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}},Hte=n=>{const e=Array.from(new Set(n.map(t=>t.time))).sort((t,r)=>t-r);return new Map(e.map((t,r)=>[t,r]))};function GD(n,e,t,r){if(e.length<=1)return 0;switch(r){case"equal":return e.indexOf(n)*t;case"log":const s=Math.max(1e-4,e[0]),o=e[e.length-1],l=Math.log(s),u=Math.log(o);return(Math.log(Math.max(1e-4,n))-l)/(u-l)*(e.length-1)*t;case"linear":const g=e[0],_=e[e.length-1];return(n-g)/(_-g)*(e.length-1)*t}}const Wte=(n,e,t,r,i,s,o,l,u)=>{const{centerX:d,centerY:h,maxScale:g}=e,_=Hte(n);return n.map(y=>{const T=(y.location.x-d)/g*r,w=(y.location.y-h)/g*r;_.get(y.time);const x=Fte(y.id),S=GD(y.time,l,t,u)+ht.BASE_ELEVATION+x,A=zte(y,s,o);let R;return y.is_sample?R=i.nodeSample:y.is_combined?R=i.nodeCombined:kc(y,s,o)?R=i.nodeRoot:R=i.nodeDefault,{...y,position:[T,w,S],color:R,size:A}})},Xte=(n,e,t,r,i)=>n.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=qte(u,d,t,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),Yte=(n,e,t,r,i)=>{if(e&&n.id===e.id)return i.nodeSelected;const o=Vte(n.time,t,r,n.color[3]);return[n.color[0],n.color[1],n.color[2],o]},Gte=(n,e,t,r,i,s)=>{const o=e&&n.id===e.id,l=kc(n,(t==null?void 0:t.nodes)||[],(t==null?void 0:t.edges)||[]);let u=1;if(i==="planes"&&r){const[d,h]=r;n.time>=d&&n.time<=h||(u=ht.REDUCED_OPACITY_MULTIPLIER)}if(o)return s.nodeSelected;if(l)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*u];if(n.is_sample){const d=s.background==="#ffffff"?0:255;return[d,d,d,255*u]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},Kte=(n,e,t)=>{const r=e&&n.id===e.id,i=kc(n,(t==null?void 0:t.nodes)||[],(t==null?void 0:t.edges)||[]),o=(r?n.size*ht.SELECTED_NODE_SCALE:n.size)/ql.DEFAULT;return r?Math.max(1,Ki.NODE_OUTLINE_SELECTED*o):i?Math.max(.8,Ki.NODE_OUTLINE_ROOT*o):n.is_sample?Math.max(.5,Ki.NODE_OUTLINE_SAMPLE*o):0},Zte=(n,e,t,r)=>{var s;let i="";return n.is_sample?i="Sample Node":n.is_combined?i=`Combined Node (contains: ${(s=n.combined_nodes)==null?void 0:s.join(", ")})`:kc(n,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?i="Root Node":i="Internal Node",{html:`
      <div style="background: ${r.tooltipBackground}; color: ${r.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${n.id}</strong><br/>
        Time: ${n.time.toFixed(3)}<br/>
        ${i}<br/>
        ${n.location?`Location: ${Ute(n.location.x,n.location.y,t==="eastern_hemisphere")}`:""}
      </div>
    `,style:{backgroundColor:"transparent",color:r.tooltipText}}},KD=ec.forwardRef(({data:n,width:e,height:t,onNodeClick:r,onNodeRightClick:i,selectedNode:s,temporalRange:o,showTemporalPlanes:l=!1,temporalFilterMode:u=null,temporalSpacing:d=12,spatialSpacing:h=160,geographicShape:g=null,geographicMode:_="unit_grid",temporalGridOpacity:y=30,geographicShapeOpacity:T=70,maxNodeRadius:w=25,onViewStateChange:x,externalViewState:S,temporalSpacingMode:A="equal"},R)=>{const E=U.useRef(null),{colors:C}=$t(),[O,D]=U.useState({target:[0,0,0],zoom:ht.AUTO_FIT_ZOOM,minZoom:ht.MIN_ZOOM,maxZoom:ht.MAX_ZOOM,rotationX:30,rotationOrbit:0,orbitAxis:"Y"});ec.useEffect(()=>{S&&D(H=>({...H,...S}))},[S]);const M=U.useMemo(()=>!n||!n.nodes.length?null:$te(n.nodes,_,g),[n,_,g==null?void 0:g.bounds]),{nodes3D:P,edges3D:k,bounds:V}=U.useMemo(()=>{if(!M)return{nodes3D:[],edges3D:[],bounds:null};const{nodes:H,edges:z}=YD(n.nodes,n.edges),te=Array.from(new Set(H.map(ee=>ee.time))).sort((ee,se)=>ee-se),fe=Wte(M.spatialNodes,M,d,h,C,H,z,te,A),K=new Map;fe.forEach(ee=>K.set(ee.id,ee));const I=Xte(z,K,o||null,u||null,C),q={minX:Math.min(...fe.map(ee=>ee.position[0])),maxX:Math.max(...fe.map(ee=>ee.position[0])),minY:Math.min(...fe.map(ee=>ee.position[1])),maxY:Math.max(...fe.map(ee=>ee.position[1])),minZ:Math.min(...fe.map(ee=>ee.position[2])),maxZ:Math.max(...fe.map(ee=>ee.position[2]))};return{nodes3D:fe,edges3D:I,bounds:q}},[M,d,h,A,u,o,C]),X=U.useMemo(()=>{if(!l||!o||!V)return[];const H=nM(g,_,h);if(!H)return[];const z=Array.from(new Set(P.map(I=>I.time))).sort((I,q)=>I-q),te=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2]],fe=(o[0]+o[1])/2,K=GD(fe,z,d,A);return XD(H,z,d,h,te,o,K)},[l,o,V,P,d,A,h,C.textSecondary,g,_]),Z=U.useMemo(()=>{if(!V||!P.length)return[];const H=nM(g,_,h);if(!H)return[];const z=l&&u==="planes",te=T??70,fe=te>0?z?Math.max(te*ht.GEOGRAPHIC_REDUCED_OPACITY,8):te*ht.GEOGRAPHIC_OPACITY_SCALE:0,K=z?Ki.GEOGRAPHIC_ACTIVE:Ki.GEOGRAPHIC_NORMAL,I=[C.geographicGrid[0],C.geographicGrid[1],C.geographicGrid[2],fe],ee=[...fe>0?J1(H,0,h,I,K):[]],se=Array.from(new Set(P.map(Ee=>Ee.time))).sort((Ee,Oe)=>Ee-Oe),B=new Map(se.map((Ee,Oe)=>[Ee,Oe])),Y=y??30,Q=z?Math.min(Y*ht.TEMPORAL_OPACITY_SCALE,8):Y,pe=z?Ki.TIME_SLICE_ACTIVE:Ki.TIME_SLICE_NORMAL,ye=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2],Q];return Q>0&&se.forEach(Ee=>{const ze=(B.get(Ee)||0)*d;ze!==0&&(ee.push({source:[V.minX-ht.GRID_EXTENSION,0,ze],target:[V.maxX+ht.GRID_EXTENSION,0,ze],color:ye,width:pe}),ee.push({source:[0,V.minY-ht.GRID_EXTENSION,ze],target:[0,V.maxY+ht.GRID_EXTENSION,ze],color:ye,width:pe}))}),ee},[V,C.textSecondary,P,d,h,g,_,l,u,y,T]),$=[...Z.length>0?[new Zl({id:"geographic-lines",data:Z,pickable:!1,getSourcePosition:H=>H.source,getTargetPosition:H=>H.target,getColor:H=>H.color,getWidth:H=>H.width||.5})]:[],...l&&X.length>0?[new Zl({id:"temporal-plane-lines",data:X,pickable:!1,getSourcePosition:H=>H.source,getTargetPosition:H=>H.target,getColor:H=>H.color,getWidth:H=>H.width})]:[],new Zl({id:"edges",data:k,pickable:!1,getSourcePosition:H=>H.source,getTargetPosition:H=>H.target,getColor:H=>H.color,getWidth:ht.EDGE_WIDTH}),new Q1({id:"nodes",data:P,pickable:!0,opacity:ht.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:ht.NODE_RADIUS_SCALE,radiusMinPixels:ht.MIN_NODE_RADIUS,radiusMaxPixels:w,lineWidthMinPixels:ht.MIN_NODE_RADIUS,lineWidthMaxPixels:Ki.MAX_NODE_OUTLINE,getPosition:H=>H.position,getRadius:H=>s&&H.id===s.id?H.size*ht.SELECTED_NODE_SCALE:H.size,getFillColor:H=>Yte(H,s||null,o||null,u||null,C),getLineColor:H=>Gte(H,s||null,n,o||null,u||null,C),getLineWidth:H=>Kte(H,s||null,n),onClick:(H,z)=>{z.srcEvent.preventDefault(),H.object&&r&&r(H.object)},onHover:H=>{H.rightButton&&H.object&&i&&i(H.object)}})];return!n||P.length===0?m.jsx("div",{className:"flex items-center justify-center border rounded bg-sp-very-dark-blue text-sp-white border-sp-dark-blue",style:{width:e,height:t},children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-lg mb-2",children:"No spatial data available"}),m.jsx("p",{className:"text-sm text-sp-white/75",children:"This ARG does not contain 2D spatial information required for 3D visualization."})]})}):m.jsx("div",{style:{width:e,height:t},className:"relative bg-sp-very-dark-blue","data-3d-visualization":"true",ref:H=>{H&&typeof R=="function"?R(H):H&&R&&"current"in R&&(R.current=H),H&&(H.getExportData=()=>({nodes:P,edges:k,bounds:V,currentViewState:O}),H.setViewState=z=>{D(te=>({...te,...z}))})},onContextMenu:H=>{H.preventDefault();const z=H.currentTarget.getBoundingClientRect(),te=H.clientX-z.left,fe=H.clientY-z.top;if(E.current){const K=E.current.pickObject({x:te,y:fe,radius:10});K!=null&&K.object&&i&&i(K.object)}},children:m.jsx(Ete,{ref:E,width:e,height:t,views:new qD,viewState:O,onViewStateChange:({viewState:H})=>{D(H),x==null||x(H)},controller:{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0},layers:$,getCursor:()=>"crosshair",style:{backgroundColor:C.background},getTooltip:({object:H})=>H?Zte(H,n,_,C):null})})});KD.displayName="SpatialArg3DVisualization";const e2=({initialPosition:n={x:0,y:0},onPositionChange:e,dragHandleRef:t}={})=>{const[r,i]=U.useState({position:n,isDragging:!1,dragOffset:{x:0,y:0},hasMoved:!1,startTime:0}),s=U.useRef(null),o=U.useCallback(h=>{var T;if(t!=null&&t.current&&!t.current.contains(h.target))return;const g=(T=s.current)==null?void 0:T.getBoundingClientRect();if(!g)return;const _=r.position.x===0&&r.position.y===0?{x:g.left,y:g.top}:r.position,y={x:h.clientX-g.left,y:h.clientY-g.top};i(w=>({...w,position:_,isDragging:!0,dragOffset:y,hasMoved:!1,startTime:Date.now()})),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"},[t,r.position]),l=U.useCallback(h=>{var S;if(!r.isDragging)return;const g={x:h.clientX-r.dragOffset.x,y:h.clientY-r.dragOffset.y},_=window.innerWidth,y=window.innerHeight,T=(S=s.current)==null?void 0:S.getBoundingClientRect();T&&(g.x=Math.max(0,Math.min(_-T.width,g.x)),g.y=Math.max(0,Math.min(y-T.height,g.y)));const w=Date.now()-r.startTime>150,x=Math.abs(g.x-r.position.x)>3||Math.abs(g.y-r.position.y)>3;i(A=>({...A,position:g,hasMoved:A.hasMoved||w||x})),e==null||e(g)},[r.isDragging,r.dragOffset,r.startTime,r.position,e]),u=U.useCallback(()=>{i(h=>({...h,isDragging:!1})),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(r.isDragging)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}},[r.isDragging,l,u]);const d=r.position.x!==0||r.position.y!==0;return{position:r.position,isDragging:r.isDragging,hasMoved:r.hasMoved,isRepositioned:d,elementRef:s,dragProps:{onMouseDown:o,style:d?{position:"fixed",left:r.position.x,top:r.position.y,cursor:r.isDragging?"grabbing":"grab",zIndex:r.isDragging?9999:void 0}:{cursor:"grab"}},setPosition:h=>{i(g=>({...g,position:h})),e==null||e(h)}}},Qte=({temporalSpacing:n,onTemporalSpacingChange:e,temporalSpacingMode:t,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:g,geographicMode:_,onGeographicModeChange:y,customShapeFile:T,onCustomShapeFileChange:w,isLoadingGeographic:x,currentShape:S,showCrsWarning:A,crsDetection:R,onDismissCrsWarning:E})=>{const{colors:C}=$t(),[O,D]=U.useState(!0),M=U.useRef(null),{elementRef:P,dragProps:k,hasMoved:V,isRepositioned:X}=e2({initialPosition:{x:0,y:0},dragHandleRef:M}),Z=H=>{y(H)},$=H=>{var te;const z=(te=H.target.files)==null?void 0:te[0];z&&w(z)};return m.jsxs("div",{ref:P,className:`border rounded-lg shadow-lg z-30 ${X?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${C.background}F0`,borderColor:C.border,color:C.text,...k.style},onMouseDown:k.onMouseDown,children:[m.jsxs("div",{ref:M,onClick:()=>!V&&D(!O),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:O?"transparent":`${C.containerBackground}80`},onMouseEnter:H=>{O||(H.currentTarget.style.backgroundColor=`${C.border}40`)},onMouseLeave:H=>{O||(H.currentTarget.style.backgroundColor=`${C.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:C.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"3D Visualization Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${O?"rotate-180":""}`,style:{color:C.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),O&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Geographic Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Geographic Mode"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[m.jsx("button",{onClick:()=>Z("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="unit_grid"?C.accentPrimary:C.containerBackground,color:_==="unit_grid"?C.background:C.text},children:"Unit Grid"}),m.jsx("button",{onClick:()=>Z("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="eastern_hemisphere"?C.accentPrimary:C.containerBackground,color:_==="eastern_hemisphere"?C.background:C.text},children:"Eastern Hemisphere"}),m.jsx("button",{onClick:()=>Z("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="custom"?C.accentPrimary:C.containerBackground,color:_==="custom"?C.background:C.text},children:"Custom"})]})]}),_==="custom"&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Upload Shapefile (.zip)"}),m.jsx("input",{type:"file",accept:".zip",onChange:$,className:"w-full text-xs border rounded px-2 py-1 transition-colors",style:{color:C.text,backgroundColor:C.containerBackground,borderColor:`${C.accentPrimary}33`},onMouseEnter:H=>{H.currentTarget.style.borderColor=`${C.accentPrimary}66`},onMouseLeave:H=>{H.currentTarget.style.borderColor=`${C.accentPrimary}33`}}),T&&m.jsxs("p",{className:"text-xs",style:{color:C.accentPrimary},children:["Selected: ",T.name]})]}),x&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:C.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:C.text},children:"Loading geographic data..."})]}),S&&m.jsxs("div",{className:"text-xs",style:{color:`${C.text}B3`},children:[m.jsxs("div",{children:["Shape: ",S.name]}),S.bounds&&m.jsx("div",{children:"Shape loaded successfully"})]}),A&&R&&m.jsxs("div",{className:"border rounded p-3 space-y-2",style:{backgroundColor:`${C.background}33`,borderColor:`${C.accentPrimary}4D`},children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h5",{className:"text-xs font-bold",style:{color:C.accentPrimary},children:"Coordinate System Detected"}),m.jsx("button",{onClick:E,className:"text-xs",style:{color:`${C.accentPrimary}B3`},onMouseEnter:H=>{H.currentTarget.style.color=C.accentPrimary},onMouseLeave:H=>{H.currentTarget.style.color=`${C.accentPrimary}B3`},children:"✕"})]}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:`${C.accentPrimary}E6`},children:[m.jsxs("div",{children:["CRS: ",R.crs]}),m.jsxs("div",{children:["Confidence: ",(R.confidence*100).toFixed(1),"%"]}),m.jsxs("div",{children:["Land coverage: ",(R.landPercentage*100).toFixed(1),"%"]}),m.jsx("div",{className:"italic",children:R.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Temporal Spacing"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:C.text},children:"Spacing Mode"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[m.jsx("button",{onClick:()=>r("equal"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:t==="equal"?C.accentPrimary:C.containerBackground,color:t==="equal"?C.background:C.text},children:"Equal"}),m.jsx("button",{onClick:()=>r("log"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:t==="log"?C.accentPrimary:C.containerBackground,color:t==="log"?C.background:C.text},children:"Log"}),m.jsx("button",{onClick:()=>r("linear"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:t==="linear"?C.accentPrimary:C.containerBackground,color:t==="linear"?C.background:C.text},children:"Linear"})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("label",{className:"text-xs font-medium",style:{color:C.text},children:["Spacing: ",n]})}),m.jsx("input",{type:"range",min:5,max:50,step:1,value:n,onChange:H=>e(Number(H.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(n-5)/45*100}%, ${C.border} ${(n-5)/45*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),m.jsxs("div",{className:"text-xs",style:{color:`${C.text}CC`},children:[t==="equal"&&m.jsx("div",{children:"• Time points are spaced equally"}),t==="log"&&m.jsx("div",{children:"• Time points are spaced logarithmically based on their actual values"}),t==="linear"&&m.jsx("div",{children:"• Time points are spaced according to their actual time values"})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Spacing"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Spatial Spacing: ",i]}),m.jsx("input",{type:"range",min:50,max:500,step:10,value:i,onChange:H=>s(Number(H.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(i-50)/450*100}%, ${C.border} ${(i-50)/450*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Opacity"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Temporal Grid: ",o,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:o,onChange:H=>l(Number(H.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${o}%, ${C.border} ${o}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Geographic Shape: ",u,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:u,onChange:H=>d(Number(H.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${u}%, ${C.border} ${u}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Node Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Max Node Radius: ",h,"px"]}),m.jsx("input",{type:"range",min:10,max:50,step:1,value:h,onChange:H=>g(Number(H.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(h-10)/40*100}%, ${C.border} ${(h-10)/40*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]})]})]})},Jte=({originalNodeCount:n,originalEdgeCount:e,subargNodeCount:t,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,crsDetection:o})=>{const{colors:l}=$t(),[u,d]=U.useState(!0),h=U.useRef(null),{elementRef:g,dragProps:_,hasMoved:y,isRepositioned:T}=e2({initialPosition:{x:0,y:0},dragHandleRef:h}),w=n&&t?(t/n*100).toFixed(1):null,x=e&&r?(r/e*100).toFixed(1):null;return n||t||i||o?m.jsxs("div",{ref:g,className:`border rounded-lg shadow-lg z-10 ${T?"":"absolute top-4 right-4"}`,style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text,maxWidth:"280px",..._.style},onMouseDown:_.onMouseDown,children:[m.jsxs("div",{ref:h,onClick:()=>!y&&d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:A=>{u||(A.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:A=>{u||(A.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[(n||t||i)&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[n&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:l.text},children:[n.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),t&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:l.text},children:[t.toLocaleString()," nodes (",w,"%), ",r.toLocaleString()," edges (",x,"%)"]})]}),i&&s&&(i!==t||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:l.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&n&&i!==n&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:l.text},children:[((1-i/n)*100).toFixed(1),"% fewer nodes"]})]})]})]}),o&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Coordinate System"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Detected CRS:"}),m.jsx("span",{style:{color:l.text},children:o.crs})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Confidence:"}),m.jsxs("span",{style:{color:l.text},children:[(o.confidence*100).toFixed(1),"%"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Land Coverage:"}),m.jsxs("span",{style:{color:l.text},children:[(o.landPercentage*100).toFixed(1),"%"]})]}),o.description&&m.jsxs("div",{className:"mt-2",children:[m.jsx("div",{className:"mb-1",style:{color:l.accentPrimary},children:"Description:"}),m.jsx("div",{className:"text-xs italic",style:{color:`${l.text}CC`},children:o.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[m.jsx("div",{children:"• Drag: Rotate view"}),m.jsx("div",{children:"• Shift+drag: Pan view"}),m.jsx("div",{children:"• Scroll: Zoom in/out"}),m.jsx("div",{children:"• Left click: Select node"}),m.jsx("div",{children:"• Right click: Show ancestors"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${l.nodeSample[0]}, ${l.nodeSample[1]}, ${l.nodeSample[2]})`,borderColor:l.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:l.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeDefault[0]}, ${l.nodeDefault[1]}, ${l.nodeDefault[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeCombined[0]}, ${l.nodeCombined[1]}, ${l.nodeCombined[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${l.nodeRoot[0]}, ${l.nodeRoot[1]}, ${l.nodeRoot[2]})`,borderColor:`rgb(${l.nodeSelected[0]}, ${l.nodeSelected[1]}, ${l.nodeSelected[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Root Nodes"})]})]})]})]})]}):null},A0={FIT:1.8,MEDIUM:1.2,FAR:.8},ene=({currentViewState:n,bounds:e,onViewStateChange:t})=>{const{colors:r}=$t(),[i,s]=U.useState(!0),o=U.useRef(null),{elementRef:l,dragProps:u,hasMoved:d,isRepositioned:h}=e2({initialPosition:{x:0,y:0},dragHandleRef:o}),g=()=>e?[(e.minX+e.maxX)/2,(e.minY+e.maxY)/2,(e.minZ+e.maxZ)/2]:[0,0,0],_=(S,A,R)=>{const E=g();t({target:E,rotationOrbit:S,rotationX:A,zoom:R})},y=()=>{const S=g();t({target:S})},T=[{value:A0.FIT,label:"Fit All",icon:"🔍"},{value:A0.MEDIUM,label:"Medium",icon:"👁️"},{value:A0.FAR,label:"Far",icon:"🌐"}],w=S=>{const A=S%360;_(A,n.rotationX,n.zoom)},x=S=>{const A=Math.max(0,Math.min(90,S));_(n.rotationOrbit,A,n.zoom)};return m.jsxs("div",{ref:l,className:`border rounded-lg shadow-lg z-20 ${h?"":"absolute"}`,style:{backgroundColor:`${r.background}F0`,borderColor:r.border,color:r.text,...h?{}:{top:16,right:300},...u.style},onMouseDown:u.onMouseDown,children:[m.jsxs("div",{ref:o,onClick:()=>!d&&s(!i),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:i?"transparent":`${r.containerBackground}80`},onMouseEnter:S=>{i||(S.currentTarget.style.backgroundColor=`${r.border}40`)},onMouseLeave:S=>{i||(S.currentTarget.style.backgroundColor=`${r.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:r.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Preset Views"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,style:{color:r.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsx("div",{className:"space-y-2",children:m.jsxs("button",{onClick:y,className:"w-full px-2 py-1.5 text-xs font-medium rounded transition-colors flex items-center justify-center gap-1",style:{backgroundColor:r.accentPrimary,color:r.background,border:`1px solid ${r.accentPrimary}`},onMouseEnter:S=>{S.currentTarget.style.opacity="0.8"},onMouseLeave:S=>{S.currentTarget.style.opacity="1"},children:[m.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v18m0 0l-4-4m4 4l4-4"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12h18m0 0l-4-4m4 4l-4 4"})]}),"Center ARG"]})}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Rotation"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(n.rotationOrbit),"°"]}),m.jsx("input",{type:"range",min:0,max:360,step:1,value:n.rotationOrbit,onChange:S=>w(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${n.rotationOrbit/360*100}%, ${r.border} ${n.rotationOrbit/360*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:360,value:Math.round(n.rotationOrbit),onChange:S=>w(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"View Angle"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(n.rotationX),"°"]}),m.jsx("input",{type:"range",min:0,max:90,step:1,value:n.rotationX,onChange:S=>x(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${n.rotationX/90*100}%, ${r.border} ${n.rotationX/90*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:90,value:Math.round(n.rotationX),onChange:S=>x(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Zoom Level"}),m.jsx("div",{className:"space-y-2",children:T.map(S=>m.jsxs("button",{onClick:()=>_(n.rotationOrbit,n.rotationX,S.value),className:"w-full px-3 py-2 text-xs font-medium rounded transition-colors flex items-center gap-2",style:{backgroundColor:Math.abs(n.zoom-S.value)<.1?r.accentPrimary:r.containerBackground,color:Math.abs(n.zoom-S.value)<.1?r.background:r.text,border:`1px solid ${r.border}`},title:`Set zoom to ${S.label}`,onMouseEnter:A=>{Math.abs(n.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.border)},onMouseLeave:A=>{Math.abs(n.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.containerBackground)},children:[m.jsx("span",{children:S.icon}),m.jsx("span",{children:S.label})]},S.value))})]}),m.jsxs("div",{className:"space-y-2 pt-2 border-t",style:{borderTopColor:r.border},children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Current View"}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:r.textSecondary},children:[m.jsxs("div",{children:["Rotation: ",Math.round(n.rotationOrbit),"°"]}),m.jsxs("div",{children:["Pan: ",Math.round(Math.abs(n.rotationX)),"° ",n.rotationX<0?"above":n.rotationX>0?"below":"level"]}),m.jsxs("div",{children:["Zoom: ",n.zoom.toFixed(2),"x"]})]})]})]})]})},tne=({min:n,max:e,step:t=.001,value:r,onChange:i,formatValue:s=u=>u.toFixed(3),className:o="",height:l=400})=>{const{colors:u}=$t(),[d,h]=U.useState(null),[g,_]=U.useState({y:0,startValue:[0,0]}),[y,T]=U.useState(!1),[w,x]=U.useState(null),S=U.useRef(null);U.useEffect(()=>{const P=V=>{if(V.key==="Shift"){if(T(!0),w===null){const X=Math.abs(r[1]-r[0]);x(Math.max(X,t))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},k=V=>{V.key==="Shift"&&(T(!1),x(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",P),document.addEventListener("keyup",k),()=>{document.removeEventListener("keydown",P),document.removeEventListener("keyup",k),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,w,t]);const A=U.useCallback(P=>{if(!S.current)return e;const k=S.current.getBoundingClientRect(),V=Math.max(0,Math.min(1,(k.bottom-P)/k.height)),X=n+V*(e-n);return Math.round(X/t)*t},[n,e,t]),R=U.useCallback(P=>(e-P)/(e-n)*100,[n,e]),E=U.useCallback((P,k)=>{P.preventDefault(),P.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",h(k),_({y:P.clientY,startValue:r})},[r]),C=U.useCallback(P=>{if(!d||!S.current)return;const k=A(P.clientY),[V,X]=r;if(d==="top"){const Z=Math.max(n,Math.min(e,k));Z<V?i([Z,V]):i([V,Z])}else if(d==="bottom"){const Z=Math.max(n,Math.min(e,k));Z>X?i([X,Z]):i([Z,X])}else if(d==="range"){const Z=P.clientY-g.y,$=S.current.getBoundingClientRect(),H=-(Z/$.height)*(e-n),[z,te]=g.startValue;let fe=Math.abs(te-z);y&&w!==null&&(fe=w);const I=(z+te)/2+H;let q,ee;y&&w!==null?(q=I-fe/2,ee=I+fe/2):(q=z+H,ee=te+H),q<n&&(q=n,ee=n+fe),ee>e&&(ee=e,q=e-fe),i([Math.round(q/t)*t,Math.round(ee/t)*t])}},[d,r,i,A,n,e,t,g,y,w]),O=U.useCallback(()=>{h(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(d)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",O),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",O)}},[d,C,O]);const D=R(r[1]),M=R(r[0]);return m.jsxs("div",{className:`flex items-center gap-3 ${o}`,style:{height:l,userSelect:"none"},children:[m.jsxs("div",{className:"flex flex-col justify-between text-xs",style:{color:u.text,height:l},children:[m.jsx("span",{children:s(e)}),m.jsx("span",{children:s(r[1])}),m.jsx("span",{className:"flex-1"}),m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(n)})]}),m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsxs("div",{ref:S,className:"relative w-4 rounded-full cursor-pointer",style:{height:l-40,backgroundColor:u.containerBackground},onMouseDown:P=>{const k=A(P.clientY),[V,X]=r,Z=Math.abs(k-V),$=Math.abs(k-X);y||Math.abs(X-V)<t*2?E(P,"range"):Z<$?E(P,"bottom"):E(P,"top")},children:[m.jsx("div",{className:`absolute w-full rounded-full transition-opacity ${y?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{top:`${D}%`,height:`${M-D}%`,backgroundColor:y?u.text:u.textSecondary,opacity:y?.8:1,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"range")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${D}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"top")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${M}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"bottom")}})]}),m.jsxs("div",{className:"mt-2 text-xs text-center",style:{color:u.text},children:[m.jsx("div",{children:"Temporal"}),m.jsx("div",{children:"Filter"}),m.jsx("div",{className:"mt-1 h-4 flex items-center justify-center",children:y?m.jsx("div",{className:"px-1 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:u.textSecondary,color:u.background,fontSize:"10px"},children:"Fixed"}):null})]})]})]})},Hn={DEFAULT_DIMENSIONS:{width:800,height:600},DEBOUNCE_DELAY:500,GENOMIC_STEP_DIVISOR:1e3,PERCENTAGE_PRECISION:1,TIME_PRECISION:3,TEMPORAL_STEP_DIVISOR:1e3,TEMPORAL_SLIDER_HEIGHT:350,UNIT_GRID_SIZE:10},nne={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,isFilterSectionCollapsed:!0,temporalSpacingMode:"equal"},od=n=>n>=1e6?`${(n/1e6).toFixed(1)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString(),rM=(n,e)=>(n/e*100).toFixed(Hn.PERCENTAGE_PRECISION),rne=n=>n.map(([e,t,r])=>({index:e,left:t,right:r})),ZD=(n,e,t)=>{const r=new Set,i=new Set,s=[n.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;if(t==="descendants"?u===o&&!i.has(d):d===o&&!i.has(u)){const g=t==="descendants"?d:u;r.add(g),s.push(g)}}))}return r},ine=(n,e)=>ZD(n,e,"descendants"),sne=(n,e)=>ZD(n,e,"ancestors"),iM=n=>n.nodes.filter(t=>{var r,i;return((r=t.location)==null?void 0:r.x)!==void 0&&((i=t.location)==null?void 0:i.y)!==void 0}).length>0,ane=n=>{if(!(n!=null&&n.length))return{minTime:0,maxTime:1,range:[0,1]};const e=n.map(i=>i.time),t=Math.min(...e),r=Math.max(...e);return{minTime:t,maxTime:r,range:[t,t]}},one=(n,e,t)=>{const r={maxSamples:t};return n.mode==="genomic"&&(n.genomicRange[0]!==0||n.genomicRange[1]!==e.sequenceLength)?(r.genomicStart=n.genomicRange[0],r.genomicEnd=n.genomicRange[1]):n.mode==="tree"&&(n.treeRange[0]!==0||n.treeRange[1]!==e.treeIntervals.length-1)&&(r.treeStartIdx=n.treeRange[0],r.treeEndIdx=n.treeRange[1]),r},lne=(n,e,t)=>{if(!t)return n;const r=i=>{const s=n.nodes.filter(l=>i.has(l.id)),o=n.edges.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return i.has(u)&&i.has(d)});return{...n,nodes:s,edges:o,metadata:{...n.metadata,is_subset:!0}}};switch(e){case"subgraph":{const i=ine(t,n.edges);return i.add(t.id),r(i)}case"ancestors":{const i=sne(t,n.edges);return i.add(t.id),r(i)}default:return n}},cne=(n,e)=>{if(!e.isActive||e.mode!=="hide")return n;const[t,r]=e.range;if(t===e.minTime&&r===e.maxTime)return n;const s=n.nodes.filter(u=>u.time>=t&&u.time<=r),o=new Set(s.map(u=>u.id)),l=n.edges.filter(u=>{const d=typeof u.source=="number"?u.source:u.source.id,h=typeof u.target=="number"?u.target:u.target.id;return o.has(d)&&o.has(h)});return{...n,nodes:s,edges:l,metadata:{...n.metadata,is_subset:!0}}},une=(n,e,t,r)=>!n||!e||!t||!r?null:{originalNodes:e.metadata.original_num_nodes||r.num_nodes,originalEdges:e.metadata.original_num_edges||r.num_edges,subArgNodes:n.nodes.length,subArgEdges:n.edges.length,displayedNodes:t.nodes.length,displayedEdges:t.edges.length},fne=(n,e,t,r)=>{let i="";switch(n){case"subgraph":i=`3D SubARG at Root ${e==null?void 0:e.id}`;break;case"ancestors":i=`3D Parent ARG of Node ${e==null?void 0:e.id}`;break;default:i="3D Full ARG"}return t.isActive&&(r==null?void 0:r.metadata.genomic_start)!==void 0&&(r==null?void 0:r.metadata.genomic_end)!==void 0&&(i+=` (${od(r.metadata.genomic_start)} - ${od(r.metadata.genomic_end)})`),i},dne=({data:n,onNodeClick:e,onNodeRightClick:t,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,temporalSpacingMode:u,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,viewState:x})=>{const S=U.useRef(null),[A,R]=U.useState(Hn.DEFAULT_DIMENSIONS);return U.useEffect(()=>{const E=()=>{if(S.current){const{clientWidth:O,clientHeight:D}=S.current;R({width:O||Hn.DEFAULT_DIMENSIONS.width,height:D||Hn.DEFAULT_DIMENSIONS.height})}};E(),window.addEventListener("resize",E);let C=null;return window.ResizeObserver&&S.current&&(C=new ResizeObserver(E),C.observe(S.current)),()=>{window.removeEventListener("resize",E),C&&C.disconnect()}},[]),m.jsx("div",{ref:S,className:"w-full h-full",children:m.jsx(KD,{data:n,width:A.width,height:A.height,onNodeClick:e,onNodeRightClick:t,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,externalViewState:x,temporalSpacingMode:u})})},hne=({filename:n,max_samples:e})=>{const{colors:t}=$t(),{treeSequence:r}=$s(),[i,s]=U.useState(null),[o,l]=U.useState(null),[u,d]=U.useState(!0),[h,g]=U.useState(null),[_,y]=U.useState("full"),[T,w]=U.useState(null),[x,S]=U.useState({isActive:!1,mode:"genomic",genomicRange:[0,0],treeRange:[0,0]}),[A,R]=U.useState({isActive:!1,mode:"planes",range:[0,1],minTime:0,maxTime:1}),[E,C]=U.useState({sequenceLength:0,treeIntervals:[]}),[O,D]=U.useState(nne),[M,P]=U.useState({target:[0,0,0],zoom:1.8,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[k,V]=U.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1}),X=U.useCallback(async()=>{try{if(V(B=>({...B,isLoading:!0})),k.mode==="unit_grid"){const{createUnitGridShape:B}=await JN(async()=>{const{createUnitGridShape:Q}=await Promise.resolve().then(()=>tM);return{createUnitGridShape:Q}},void 0),Y=B(Hn.UNIT_GRID_SIZE);V(Q=>({...Q,currentShape:Y}))}else if(k.mode==="custom"&&k.customShapeFile){const B=await bt.uploadShapefile(k.customShapeFile);console.log("Custom shapefile uploaded:",B.data)}else try{const B=await bt.getShapeData(k.mode);V(Y=>({...Y,currentShape:B.data}))}catch{console.warn(`Failed to load ${k.mode}, using fallback`);const{createUnitGridShape:Y}=await JN(async()=>{const{createUnitGridShape:pe}=await Promise.resolve().then(()=>tM);return{createUnitGridShape:pe}},void 0),Q=Y(Hn.UNIT_GRID_SIZE);V(pe=>({...pe,currentShape:Q}))}}catch(B){console.error("Error loading geographic data:",B)}finally{V(B=>({...B,isLoading:!1}))}},[k.mode,k.customShapeFile]);U.useEffect(()=>{X()},[X]),U.useEffect(()=>{(async()=>{var Y,Q;try{d(!0);const ye=(await bt.getGraphData(n,{maxSamples:e})).data;if(ye.metadata.sequence_length&&(C(Ee=>({...Ee,sequenceLength:ye.metadata.sequence_length})),S(Ee=>({...Ee,genomicRange:[0,ye.metadata.sequence_length]}))),(Y=ye.metadata.tree_intervals)!=null&&Y.length){const Ee=rne(ye.metadata.tree_intervals);C(Oe=>({...Oe,treeIntervals:Ee})),S(Oe=>({...Oe,treeRange:[0,Ee.length-1]}))}if((Q=ye.nodes)!=null&&Q.length){const Ee=ane(ye.nodes);R(Oe=>({...Oe,...Ee}))}if(!iM(ye))g("No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.");else if(s(ye),l(ye),q(ye),ye.metadata.suggested_geographic_mode){const Ee=ye.metadata.suggested_geographic_mode;V(Oe=>({...Oe,mode:Ee}))}}catch(pe){console.error("Error fetching 3D graph data:",pe),g(pe instanceof Error?pe.message:"Unknown error occurred")}finally{d(!1)}})()},[n,e]);const Z=U.useRef(null);U.useEffect(()=>{if(!(!x.isActive||u))return Z.current&&clearTimeout(Z.current),Z.current=setTimeout(async()=>{try{d(!0);const B=one(x,E,e),Q=(await bt.getGraphData(n,B)).data;iM(Q)?(s(Q),g(null),q(Q)):g("No spatial data found in this range.")}catch(B){console.error("Error fetching filtered data:",B),g(B instanceof Error?B.message:"An error occurred while fetching graph data")}finally{d(!1)}},Hn.DEBOUNCE_DELAY),()=>{Z.current&&clearTimeout(Z.current)}},[x,n,e,E.sequenceLength,E.treeIntervals.length]),U.useEffect(()=>{D(B=>({...B,isFilterSectionCollapsed:!x.isActive&&!A.isActive}))},[x.isActive,A.isActive]);const $=()=>{if(!i)return i;const B=cne(i,A);return lne(B,_,T)},H=B=>{_==="full"?(w(B),y("subgraph")):(T==null?void 0:T.id)===B.id?(y("full"),w(null)):(w(B),y("subgraph"))},z=B=>{w(B),y("ancestors")},te=()=>{y("full"),w(null)},fe=B=>{P(Y=>({...Y,...B}))},K=B=>{P(Y=>({...Y,...B}))},I=B=>{if(!B||!B.nodes.length)return null;const Y=B.nodes.filter(We=>{var xe,Re;return((xe=We.location)==null?void 0:xe.x)!==void 0&&((Re=We.location)==null?void 0:Re.y)!==void 0});if(Y.length===0)return null;const Q=Y.map(We=>We.location.x),pe=Y.map(We=>We.location.y),ye=Y.map(We=>We.time),Ee=Math.min(...Q),Oe=Math.max(...Q),ze=Math.min(...pe),It=Math.max(...pe),mt=(Ee+Oe)/2,ct=(ze+It)/2,De=Math.max(Oe-Ee,It-ze)||1,cn=(Ee-mt)/De*O.spatialSpacing,Ne=(Oe-mt)/De*O.spatialSpacing,yn=(ze-ct)/De*O.spatialSpacing,Wt=(It-ct)/De*O.spatialSpacing,Rn=Array.from(new Set(ye)).sort((We,xe)=>We-xe),jt=0,un=(Rn.length-1)*O.temporalSpacing;return{minX:cn,maxX:Ne,minY:yn,maxY:Wt,minZ:jt,maxZ:un}},q=B=>{const Y=I(B);if(Y){const Q=[(Y.minX+Y.maxX)/2,(Y.minY+Y.maxY)/2,(Y.minZ+Y.maxZ)/2];P(pe=>({...pe,target:Q}))}};if(u)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:t.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:t.accentPrimary}}),m.jsx("p",{style:{color:t.text},children:"Loading 3D spatial ARG visualization..."})]})});if(h)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:t.background},children:m.jsxs("div",{className:"text-center",style:{color:t.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${t.text}B3`},children:h})]})});const ee=$(),se=une(o,i,ee,r);return m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:t.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b px-4 py-2",style:{backgroundColor:t.background,borderBottomColor:t.border},children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:t.headerText},children:fne(_,T,x,i)}),(E.sequenceLength>0||E.treeIntervals.length>0)&&m.jsxs("div",{className:"flex items-center gap-4",children:[E.sequenceLength>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:t.headerText},children:[m.jsx("input",{type:"checkbox",checked:x.isActive,onChange:()=>S(B=>({...B,isActive:!B.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:t.accentPrimary}}),"Filter Genomic Range"]}),m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:t.headerText},children:[m.jsx("input",{type:"checkbox",checked:A.isActive,onChange:()=>R(B=>({...B,isActive:!B.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:t.accentPrimary}}),"Filter Temporal Range"]})]}),_!=="full"&&m.jsx("button",{onClick:te,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:t.containerBackground,color:t.text,borderColor:`${t.accentPrimary}33`},onMouseEnter:B=>{B.currentTarget.style.borderColor=`${t.accentPrimary}66`,B.currentTarget.style.backgroundColor=`${t.containerBackground}CC`},onMouseLeave:B=>{B.currentTarget.style.borderColor=`${t.accentPrimary}33`,B.currentTarget.style.backgroundColor=t.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[(x.isActive||A.isActive)&&m.jsxs("button",{onClick:()=>D(B=>({...B,isFilterSectionCollapsed:!B.isFilterSectionCollapsed})),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:t.accentPrimary,color:t.background},onMouseEnter:B=>{B.currentTarget.style.opacity="0.8"},onMouseLeave:B=>{B.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:O.isFilterSectionCollapsed?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${O.isFilterSectionCollapsed?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:t.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${t.nodeSample[0]}, ${t.nodeSample[1]}, ${t.nodeSample[2]})`,borderColor:t.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${t.nodeDefault[0]}, ${t.nodeDefault[1]}, ${t.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${t.nodeCombined[0]}, ${t.nodeCombined[1]}, ${t.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${t.nodeRoot[0]}, ${t.nodeRoot[1]}, ${t.nodeRoot[2]})`,borderColor:`rgb(${t.nodeSelected[0]}, ${t.nodeSelected[1]}, ${t.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:t.headerText,borderLeftColor:t.border},children:"Left click: Subgraph • Right click: Ancestors"})]})]})}),(x.isActive||A.isActive)&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:t.background,borderBottomColor:t.border},children:!O.isFilterSectionCollapsed&&m.jsxs("div",{className:"px-4 py-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:[x.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:t.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:t.containerBackground},children:[m.jsx("button",{onClick:()=>S(B=>({...B,mode:"genomic"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="genomic"?t.accentPrimary:t.containerBackground,color:x.mode==="genomic"?t.background:t.text},children:"Genomic"}),E.treeIntervals.length>0&&m.jsx("button",{onClick:()=>S(B=>({...B,mode:"tree"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="tree"?t.accentPrimary:t.containerBackground,color:x.mode==="tree"?t.background:t.text},children:"Tree Index"})]})]}),A.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:t.text},children:"Temporal Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:t.containerBackground},children:[m.jsx("button",{onClick:()=>R(B=>({...B,mode:"hide"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="hide"?t.accentPrimary:t.containerBackground,color:A.mode==="hide"?t.background:t.text},children:"Hide Others"}),m.jsx("button",{onClick:()=>R(B=>({...B,mode:"planes"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="planes"?t.accentPrimary:t.containerBackground,color:A.mode==="planes"?t.background:t.text},children:"Dim Others"})]})]})]}),x.isActive&&m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:x.mode==="genomic"&&E.sequenceLength>0?m.jsx(yO,{min:0,max:E.sequenceLength,step:Math.max(1,Math.floor(E.sequenceLength/Hn.GENOMIC_STEP_DIVISOR)),value:x.genomicRange,onChange:B=>S(Y=>({...Y,genomicRange:B})),formatValue:od,className:"w-full"}):x.mode==="tree"&&E.treeIntervals.length>0?m.jsx(bO,{treeIntervals:E.treeIntervals,value:x.treeRange,onChange:B=>S(Y=>({...Y,treeRange:B})),className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:t.text},children:[x.mode==="genomic"?m.jsxs("span",{children:[od(x.genomicRange[1]-x.genomicRange[0])," bp (",rM(x.genomicRange[1]-x.genomicRange[0],E.sequenceLength),"%)",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:[" • ",i.metadata.num_local_trees," trees"]})]}):x.mode==="tree"&&E.treeIntervals.length>0?m.jsxs("span",{children:["Trees ",x.treeRange[0],"-",x.treeRange[1]," (",x.treeRange[1]-x.treeRange[0]+1," of ",E.treeIntervals.length,")",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:[" • ",i.metadata.expected_tree_count??i.metadata.num_local_trees," displayed"]}),(i==null?void 0:i.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:[" ⚠️ (actual: ",i.metadata.num_local_trees,")"]})]}):null,u&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:t.accentPrimary}})]})]})]}),A.isActive&&m.jsx("div",{className:"text-xs mt-3",style:{color:t.text},children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{children:["Temporal Range: ",A.range[0].toFixed(Hn.TIME_PRECISION)," - ",A.range[1].toFixed(Hn.TIME_PRECISION)," ","(",rM(A.range[1]-A.range[0],A.maxTime-A.minTime),"% of time range) • Hold Shift + drag to maintain window size"]}),u&&m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:t.accentPrimary}})]})})]})}),m.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[A.isActive&&!O.isFilterSectionCollapsed&&m.jsx("div",{className:"flex-shrink-0 border-r px-3 py-4 flex items-center justify-center",style:{backgroundColor:t.background,borderRightColor:t.border},children:m.jsx(tne,{min:A.minTime,max:A.maxTime,step:(A.maxTime-A.minTime)/Hn.TEMPORAL_STEP_DIVISOR,value:A.range,onChange:B=>R(Y=>({...Y,range:B})),formatValue:B=>B.toFixed(Hn.TIME_PRECISION),height:Hn.TEMPORAL_SLIDER_HEIGHT})}),m.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[m.jsx(dne,{data:ee,onNodeClick:H,onNodeRightClick:z,selectedNode:T,temporalRange:A.isActive?A.range:null,showTemporalPlanes:A.isActive&&A.mode==="planes",temporalFilterMode:A.isActive?A.mode:null,temporalSpacing:O.temporalSpacing,temporalSpacingMode:O.temporalSpacingMode,spatialSpacing:O.spatialSpacing,geographicShape:k.currentShape,geographicMode:k.mode,temporalGridOpacity:O.temporalGridOpacity,geographicShapeOpacity:O.geographicShapeOpacity,maxNodeRadius:O.maxNodeRadius,onViewStateChange:fe,viewState:M}),m.jsx(ene,{currentViewState:M,bounds:I(ee),onViewStateChange:K}),m.jsx(Qte,{temporalSpacing:O.temporalSpacing,onTemporalSpacingChange:B=>D(Y=>({...Y,temporalSpacing:B})),temporalSpacingMode:O.temporalSpacingMode,onTemporalSpacingModeChange:B=>D(Y=>({...Y,temporalSpacingMode:B})),spatialSpacing:O.spatialSpacing,onSpatialSpacingChange:B=>D(Y=>({...Y,spatialSpacing:B})),temporalGridOpacity:O.temporalGridOpacity,onTemporalGridOpacityChange:B=>D(Y=>({...Y,temporalGridOpacity:B})),geographicShapeOpacity:O.geographicShapeOpacity,onGeographicShapeOpacityChange:B=>D(Y=>({...Y,geographicShapeOpacity:B})),maxNodeRadius:O.maxNodeRadius,onMaxNodeRadiusChange:B=>D(Y=>({...Y,maxNodeRadius:B})),geographicMode:k.mode,onGeographicModeChange:B=>V(Y=>({...Y,mode:B})),customShapeFile:k.customShapeFile,onCustomShapeFileChange:B=>V(Y=>({...Y,customShapeFile:B})),isLoadingGeographic:k.isLoading,currentShape:k.currentShape,showCrsWarning:k.showCrsWarning,crsDetection:i==null?void 0:i.metadata.coordinate_system_detection,onDismissCrsWarning:()=>V(B=>({...B,showCrsWarning:!1}))}),m.jsx(Jte,{originalNodeCount:se==null?void 0:se.originalNodes,originalEdgeCount:se==null?void 0:se.originalEdges,subargNodeCount:se==null?void 0:se.subArgNodes,subargEdgeCount:se==null?void 0:se.subArgEdges,displayedNodeCount:se==null?void 0:se.displayedNodes,displayedEdgeCount:se==null?void 0:se.displayedEdges,crsDetection:i!=null&&i.metadata.coordinate_system_detection?{crs:i.metadata.coordinate_system_detection.likely_crs,confidence:i.metadata.coordinate_system_detection.confidence,landPercentage:i.metadata.coordinate_system_detection.land_percentage,description:i.metadata.coordinate_system_detection.reasoning}:void 0,isTemporalSliderVisible:A.isActive})]})]})]})};function pne(){const{filename:n}=OM(),e=pc(),{maxSamples:t,treeSequence:r,setTreeSequence:i}=$s(),{colors:s,setCurrentVisualizationType:o}=$t(),l=U.useRef(null),[u,d]=U.useState(!1);if(U.useEffect(()=>{o("spatial-3d")},[o]),!n)return m.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"font-bold py-2 px-6 rounded-lg mt-4 transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(n),g=y=>{Se.user.action("switch-tree-sequence-spatial",{treeSequence:y},"SpatialArg3DVisualizationPage"),i(y),d(!1),e(`/visualize-spatial/${encodeURIComponent(y.filename)}`)},_=async()=>{if(l.current)try{const y=`${h.replace(/\.(trees|tsz)$/,"")}_3d_spatial_arg.png`,T={text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"},w=l.current.querySelector("[data-3d-visualization]");if(w!=null&&w.getExportData){const S=w.getExportData(),A=l.current.querySelector('[data-deck="true"]'),R=A?{current:A}:null;try{await LV(S,R,{filename:y,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("High-resolution 3D spatial ARG image exported successfully");return}catch(E){console.warn("High-quality export failed, falling back to canvas capture:",E)}}const x=l.current.querySelector("canvas");if(!x)throw new Error("No canvas found for export");await BV(x,{filename:y,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("3D spatial ARG image captured from canvas")}catch(y){console.error("Error downloading 3D spatial ARG image:",y)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.opacity="0.8"},onMouseLeave:y=>{y.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(gc,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"3D Spatial ARG"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(xO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download 3D visualization as PNG",children:"Download Image"}),r&&m.jsx(qx,{filename:r.filename})]})]})]})}),m.jsx($x,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:m.jsx("div",{ref:l,className:"w-full h-full",children:U.useMemo(()=>m.jsx(hne,{filename:h,max_samples:t}),[h,t])})})]})}function gne(){return m.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 overflow-hidden pointer-events-none",children:m.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 1200 400",children:[m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.3s_both]",children:[m.jsx("line",{x1:"200",y1:"30",x2:"200",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.4s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"140",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.5s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"260",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.55s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.6s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"180",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.65s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"220",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.7s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"300",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.75s_both]"}),m.jsx("circle",{cx:"200",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_0.8s_both]"}),m.jsx("circle",{cx:"140",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.85s_both]"}),m.jsx("circle",{cx:"260",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.9s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.7s_both]",children:[m.jsx("line",{x1:"600",y1:"30",x2:"600",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.8s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"540",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.9s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"660",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.95s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"500",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"580",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.05s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"620",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.1s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"700",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.15s_both]"}),m.jsx("circle",{cx:"600",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.2s_both]"}),m.jsx("circle",{cx:"540",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.25s_both]"}),m.jsx("circle",{cx:"660",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.3s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_1.1s_both]",children:[m.jsx("line",{x1:"1000",y1:"30",x2:"1000",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_1.2s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"940",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.3s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"1060",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.35s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"900",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.4s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"980",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.45s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1020",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.5s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.55s_both]"}),m.jsx("circle",{cx:"1000",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.6s_both]"}),m.jsx("circle",{cx:"940",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.65s_both]"}),m.jsx("circle",{cx:"1060",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.7s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_1.5s_both]",children:[m.jsx("circle",{cx:"100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.7s_both]"}),m.jsx("circle",{cx:"180",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.75s_both]"}),m.jsx("circle",{cx:"220",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.8s_both]"}),m.jsx("circle",{cx:"300",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.85s_both]"}),m.jsx("circle",{cx:"500",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.9s_both]"}),m.jsx("circle",{cx:"580",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.95s_both]"}),m.jsx("circle",{cx:"620",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2s_both]"}),m.jsx("circle",{cx:"700",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.05s_both]"}),m.jsx("circle",{cx:"900",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.1s_both]"}),m.jsx("circle",{cx:"980",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.15s_both]"}),m.jsx("circle",{cx:"1020",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.2s_both]"}),m.jsx("circle",{cx:"1100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.25s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_2.3s_both]",children:[m.jsx("line",{x1:"400",y1:"20",x2:"400",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"}),m.jsx("line",{x1:"800",y1:"20",x2:"800",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"})]})]})})}function sM({onComplete:n,isTransitioning:e=!1}){const[t,r]=U.useState(!1),[i,s]=U.useState(!1);return U.useEffect(()=>{if(e){r(!0),s(!0);return}r(!0);const o=setTimeout(()=>{s(!0)},2300),l=setTimeout(()=>{n()},2600);return()=>{clearTimeout(o),clearTimeout(l)}},[n,e]),m.jsxs(m.Fragment,{children:[m.jsx("style",{children:`
        @keyframes drawLine {
          from { stroke-dasharray: 1000; stroke-dashoffset: 1000; }
          to { stroke-dasharray: 1000; stroke-dashoffset: 0; }
        }
        @keyframes drawPath {
          from { stroke-dasharray: 200; stroke-dashoffset: 200; }
          to { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInScale {
          from { opacity: 0; transform: scale(0); }
          to { opacity: 1; transform: scale(1); }
        }
      `}),m.jsxs("div",{className:`
        ${e?"absolute":"fixed"} inset-0 bg-sp-very-dark-blue flex items-center justify-center z-50
        transition-all duration-2000 ease-in-out
        ${i?"opacity-0":"opacity-100"}
      `,children:[m.jsx("div",{className:`
          transition-opacity duration-1000 ease-in-out
          ${e?"opacity-0":"opacity-100"}
        `,children:m.jsx(gne,{})}),m.jsxs("div",{className:`
          transform transition-all duration-2000 ease-in-out relative z-10
          ${e?"scale-50 -translate-y-32":t?"scale-100 opacity-100":"scale-75 opacity-0"}
        `,children:[m.jsxs("h1",{className:"text-[6rem] md:text-[8rem] lg:text-[10rem] font-extrabold tracking-tight text-center select-none",style:{letterSpacing:"-0.04em"},children:[m.jsx("span",{className:"text-white",children:"ARG"}),m.jsx("span",{className:"text-sp-pale-green",children:"scape"})]}),m.jsx("div",{className:`
            mt-8 text-center transition-opacity duration-1000 ease-in-out
            ${e?"opacity-0":"opacity-100"}
          `,children:m.jsx("div",{className:"text-sp-pale-green text-2xl md:text-3xl lg:text-4xl font-bold",children:"Visualizing Ancestral Recombination Graphs"})})]})]})]})}function aM({onOptionSelect:n,isTransitioning:e=!1}){const[t,r]=U.useState([]),[i,s]=U.useState(!0),[o,l]=U.useState(!e);U.useEffect(()=>{(async()=>{try{Se.data.processing("fetch-available-tree-sequences","LandingPage");const g=(await bt.getUploadedFiles()).data;r(g.uploaded_tree_sequences||[])}catch(h){Se.error("Failed to fetch available tree sequences",{component:"LandingPage",error:h instanceof Error?h:new Error(String(h))}),r([])}finally{s(!1)}})()},[]),U.useEffect(()=>{if(e){const d=setTimeout(()=>{l(!0)},100);return()=>clearTimeout(d)}else l(!0)},[e]);const u=d=>{d==="load"&&t.length===0||n(d)};return m.jsxs("div",{className:`
      text-sp-white min-h-screen flex flex-col items-center justify-center px-4 font-sans
      ${e?"absolute inset-0 z-40":""}
    `,children:[m.jsxs("div",{className:`
        text-center mb-12 transition-all duration-2000 ease-in-out
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx(gc,{size:"large",className:"mb-4"}),m.jsx("p",{className:"text-lg md:text-xl text-sp-white/70 mb-6",children:"Visualizing Ancestral Recombination Graphs"}),m.jsxs("a",{href:"/docs",className:"inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200 text-sm font-medium",children:["📖 View Documentation",m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),m.jsxs("div",{className:`
        w-full max-w-2xl space-y-4 transition-all duration-2000 ease-in-out delay-500
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx("button",{onClick:()=>u("upload"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Upload a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Upload your own .trees or .tsz file to visualize"})]})]})}),m.jsx("button",{onClick:()=>u("simulate"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Simulate a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Generate new data using msprime simulation"})]})]})}),m.jsx("button",{onClick:()=>u("load"),disabled:t.length===0,className:`w-full border rounded-xl p-6 text-left transition-all duration-200 group ${t.length===0?"bg-sp-dark-blue/50 border-sp-pale-green/10 cursor-not-allowed opacity-50":"bg-sp-dark-blue hover:bg-sp-dark-blue/80 border-sp-pale-green/20 hover:border-sp-pale-green/40"}`,children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors duration-200 ${t.length===0?"bg-sp-pale-green/5":"bg-sp-pale-green/10 group-hover:bg-sp-pale-green/20"}`,children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Load a tree sequence"}),m.jsxs("p",{className:"text-sp-white/60 text-sm",children:["Choose from existing uploaded sequences",i?m.jsx("span",{className:"ml-2",children:m.jsx("span",{className:"animate-pulse",children:"Loading..."})}):m.jsxs("span",{className:`ml-2 font-medium ${t.length===0?"text-red-400":"text-sp-pale-green"}`,children:["(",t.length," available)"]})]})]})]})})]}),m.jsx("div",{className:`
        bg-amber-900/15 border border-amber-700/25 rounded-lg p-3 mt-12 max-w-2xl mx-auto
        transition-all duration-2000 ease-in-out delay-1000
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:m.jsxs("p",{className:"text-amber-200 text-xs md:text-sm text-center leading-relaxed",children:[m.jsx("span",{className:"font-semibold",children:"⚠️ Beta Notice:"})," Tree sequences are stored on a secure server for up to 24 hours. This is a beta application and data may be wiped during updates. Please download your results and respect our limited resources."]})}),m.jsx("div",{className:`
        mt-8 text-center
        transition-all duration-2000 ease-in-out delay-1200
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `})]})}var R0={exports:{}},C0,oM;function mne(){if(oM)return C0;oM=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return C0=n,C0}var N0,lM;function _ne(){if(lM)return N0;lM=1;var n=mne();function e(){}function t(){}return t.resetWarningCache=e,N0=function(){function r(o,l,u,d,h,g){if(g!==n){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},N0}var cM;function vne(){return cM||(cM=1,R0.exports=_ne()()),R0.exports}var yne=vne();const dt=Fx(yne);function Qs(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function l(h){try{d(r.next(h))}catch(g){o(g)}}function u(h){try{d(r.throw(h))}catch(g){o(g)}}function d(h){h.done?s(h.value):i(h.value).then(l,u)}d((r=r.apply(n,e||[])).next())})}const bne=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function _o(n,e,t){const r=xne(n),{webkitRelativePath:i}=n,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof r.path!="string"&&uM(r,"path",s),uM(r,"relativePath",s),r}function xne(n){const{name:e}=n;if(e&&e.lastIndexOf(".")!==-1&&!n.type){const r=e.split(".").pop().toLowerCase(),i=bne.get(r);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function uM(n,e,t){Object.defineProperty(n,e,{value:t,writable:!1,configurable:!1,enumerable:!0})}const wne=[".DS_Store","Thumbs.db"];function Tne(n){return Qs(this,void 0,void 0,function*(){return ld(n)&&Sne(n.dataTransfer)?Cne(n.dataTransfer,n.type):Ene(n)?Ane(n):Array.isArray(n)&&n.every(e=>"getFile"in e&&typeof e.getFile=="function")?Rne(n):[]})}function Sne(n){return ld(n)}function Ene(n){return ld(n)&&ld(n.target)}function ld(n){return typeof n=="object"&&n!==null}function Ane(n){return Dx(n.target.files).map(e=>_o(e))}function Rne(n){return Qs(this,void 0,void 0,function*(){return(yield Promise.all(n.map(t=>t.getFile()))).map(t=>_o(t))})}function Cne(n,e){return Qs(this,void 0,void 0,function*(){if(n.items){const t=Dx(n.items).filter(i=>i.kind==="file");if(e!=="drop")return t;const r=yield Promise.all(t.map(Nne));return fM(QD(r))}return fM(Dx(n.files).map(t=>_o(t)))})}function fM(n){return n.filter(e=>wne.indexOf(e.name)===-1)}function Dx(n){if(n===null)return[];const e=[];for(let t=0;t<n.length;t++){const r=n[t];e.push(r)}return e}function Nne(n){if(typeof n.webkitGetAsEntry!="function")return dM(n);const e=n.webkitGetAsEntry();return e&&e.isDirectory?JD(e):dM(n,e)}function QD(n){return n.reduce((e,t)=>[...e,...Array.isArray(t)?QD(t):[t]],[])}function dM(n,e){return Qs(this,void 0,void 0,function*(){var t;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const s=yield n.getAsFileSystemHandle();if(s===null)throw new Error(`${n} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,_o(o)}}const r=n.getAsFile();if(!r)throw new Error(`${n} is not a File`);return _o(r,(t=e==null?void 0:e.fullPath)!==null&&t!==void 0?t:void 0)})}function kne(n){return Qs(this,void 0,void 0,function*(){return n.isDirectory?JD(n):Mne(n)})}function JD(n){const e=n.createReader();return new Promise((t,r)=>{const i=[];function s(){e.readEntries(o=>Qs(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(kne));i.push(l),s()}else try{const l=yield Promise.all(i);t(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function Mne(n){return Qs(this,void 0,void 0,function*(){return new Promise((e,t)=>{n.file(r=>{const i=_o(r,n.fullPath);e(i)},r=>{t(r)})})})}var cf={},hM;function Ine(){return hM||(hM=1,cf.__esModule=!0,cf.default=function(n,e){if(n&&e){var t=Array.isArray(e)?e:e.split(",");if(t.length===0)return!0;var r=n.name||"",i=(n.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return t.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0}),cf}var One=Ine();const k0=Fx(One);function pM(n){return jne(n)||Dne(n)||t6(n)||Pne()}function Pne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dne(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function jne(n){if(Array.isArray(n))return jx(n)}function gM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function mM(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gM(Object(t),!0).forEach(function(r){e6(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gM(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function e6(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function dc(n,e){return Une(n)||Bne(n,e)||t6(n,e)||Lne()}function Lne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function t6(n,e){if(n){if(typeof n=="string")return jx(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jx(n,e)}}function jx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function Bne(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,s=!1,o,l;try{for(t=t.call(n);!(i=(o=t.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw l}}return r}}function Une(n){if(Array.isArray(n))return n}var Fne=typeof k0=="function"?k0:k0.default,zne="file-invalid-type",Vne="file-too-large",qne="file-too-small",$ne="too-many-files",Hne=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=e.split(","),r=t.length>1?"one of ".concat(t.join(", ")):t[0];return{code:zne,message:"File type must be ".concat(r)}},_M=function(e){return{code:Vne,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},vM=function(e){return{code:qne,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Wne={code:$ne,message:"Too many files"};function n6(n,e){var t=n.type==="application/x-moz-file"||Fne(n,e);return[t,t?null:Hne(e)]}function r6(n,e,t){if(As(n.size))if(As(e)&&As(t)){if(n.size>t)return[!1,_M(t)];if(n.size<e)return[!1,vM(e)]}else{if(As(e)&&n.size<e)return[!1,vM(e)];if(As(t)&&n.size>t)return[!1,_M(t)]}return[!0,null]}function As(n){return n!=null}function Xne(n){var e=n.files,t=n.accept,r=n.minSize,i=n.maxSize,s=n.multiple,o=n.maxFiles,l=n.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(u){var d=n6(u,t),h=dc(d,1),g=h[0],_=r6(u,r,i),y=dc(_,1),T=y[0],w=l?l(u):null;return g&&T&&!w})}function cd(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function uf(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!n.target&&!!n.target.files}function yM(n){n.preventDefault()}function Yne(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Gne(n){return n.indexOf("Edge/")!==-1}function Kne(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Yne(n)||Gne(n)}function Ur(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!cd(r)&&l&&l.apply(void 0,[r].concat(s)),cd(r)})}}function Zne(){return"showOpenFilePicker"in window}function Qne(n){if(As(n)){var e=Object.entries(n).filter(function(t){var r=dc(t,2),i=r[0],s=r[1],o=!0;return i6(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(s6))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(t,r){var i=dc(r,2),s=i[0],o=i[1];return mM(mM({},t),{},e6({},s,o))},{});return[{description:"Files",accept:e}]}return n}function Jne(n){if(As(n))return Object.entries(n).reduce(function(e,t){var r=dc(t,2),i=r[0],s=r[1];return[].concat(pM(e),[i],pM(s))},[]).filter(function(e){return i6(e)||s6(e)}).join(",")}function ere(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function tre(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function i6(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function s6(n){return/^.*\.[\w]+$/.test(n)}var nre=["children"],rre=["open"],ire=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],sre=["refKey","onChange","onClick"];function are(n){return cre(n)||lre(n)||a6(n)||ore()}function ore(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lre(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function cre(n){if(Array.isArray(n))return Lx(n)}function M0(n,e){return dre(n)||fre(n,e)||a6(n,e)||ure()}function ure(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a6(n,e){if(n){if(typeof n=="string")return Lx(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Lx(n,e)}}function Lx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function fre(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,s=!1,o,l;try{for(t=t.call(n);!(i=(o=t.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw l}}return r}}function dre(n){if(Array.isArray(n))return n}function bM(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function At(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bM(Object(t),!0).forEach(function(r){Bx(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bM(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Bx(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ud(n,e){if(n==null)return{};var t=hre(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function hre(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var t2=U.forwardRef(function(n,e){var t=n.children,r=ud(n,nre),i=Sf(r),s=i.open,o=ud(i,rre);return U.useImperativeHandle(e,function(){return{open:s}},[s]),ec.createElement(U.Fragment,null,t(At(At({},o),{},{open:s})))});t2.displayName="Dropzone";var o6={disabled:!1,getFilesFromEvent:Tne,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};t2.defaultProps=o6;t2.propTypes={children:dt.func,accept:dt.objectOf(dt.arrayOf(dt.string)),multiple:dt.bool,preventDropOnDocument:dt.bool,noClick:dt.bool,noKeyboard:dt.bool,noDrag:dt.bool,noDragEventsBubbling:dt.bool,minSize:dt.number,maxSize:dt.number,maxFiles:dt.number,disabled:dt.bool,getFilesFromEvent:dt.func,onFileDialogCancel:dt.func,onFileDialogOpen:dt.func,useFsAccessApi:dt.bool,autoFocus:dt.bool,onDragEnter:dt.func,onDragLeave:dt.func,onDragOver:dt.func,onDrop:dt.func,onDropAccepted:dt.func,onDropRejected:dt.func,onError:dt.func,validator:dt.func};var Ux={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Sf(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=At(At({},o6),n),t=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,u=e.maxFiles,d=e.onDragEnter,h=e.onDragLeave,g=e.onDragOver,_=e.onDrop,y=e.onDropAccepted,T=e.onDropRejected,w=e.onFileDialogCancel,x=e.onFileDialogOpen,S=e.useFsAccessApi,A=e.autoFocus,R=e.preventDropOnDocument,E=e.noClick,C=e.noKeyboard,O=e.noDrag,D=e.noDragEventsBubbling,M=e.onError,P=e.validator,k=U.useMemo(function(){return Jne(t)},[t]),V=U.useMemo(function(){return Qne(t)},[t]),X=U.useMemo(function(){return typeof x=="function"?x:xM},[x]),Z=U.useMemo(function(){return typeof w=="function"?w:xM},[w]),$=U.useRef(null),H=U.useRef(null),z=U.useReducer(pre,Ux),te=M0(z,2),fe=te[0],K=te[1],I=fe.isFocused,q=fe.isFileDialogActive,ee=U.useRef(typeof window<"u"&&window.isSecureContext&&S&&Zne()),se=function(){!ee.current&&q&&setTimeout(function(){if(H.current){var Re=H.current.files;Re.length||(K({type:"closeDialog"}),Z())}},300)};U.useEffect(function(){return window.addEventListener("focus",se,!1),function(){window.removeEventListener("focus",se,!1)}},[H,q,Z,ee]);var B=U.useRef([]),Y=function(Re){$.current&&$.current.contains(Re.target)||(Re.preventDefault(),B.current=[])};U.useEffect(function(){return R&&(document.addEventListener("dragover",yM,!1),document.addEventListener("drop",Y,!1)),function(){R&&(document.removeEventListener("dragover",yM),document.removeEventListener("drop",Y))}},[$,R]),U.useEffect(function(){return!r&&A&&$.current&&$.current.focus(),function(){}},[$,A,r]);var Q=U.useCallback(function(xe){M?M(xe):console.error(xe)},[M]),pe=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Rn(xe),B.current=[].concat(are(B.current),[xe.target]),uf(xe)&&Promise.resolve(i(xe)).then(function(Re){if(!(cd(xe)&&!D)){var Qe=Re.length,Ve=Qe>0&&Xne({files:Re,accept:k,minSize:o,maxSize:s,multiple:l,maxFiles:u,validator:P}),Ye=Qe>0&&!Ve;K({isDragAccept:Ve,isDragReject:Ye,isDragActive:!0,type:"setDraggedFiles"}),d&&d(xe)}}).catch(function(Re){return Q(Re)})},[i,d,Q,D,k,o,s,l,u,P]),ye=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Rn(xe);var Re=uf(xe);if(Re&&xe.dataTransfer)try{xe.dataTransfer.dropEffect="copy"}catch{}return Re&&g&&g(xe),!1},[g,D]),Ee=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Rn(xe);var Re=B.current.filter(function(Ve){return $.current&&$.current.contains(Ve)}),Qe=Re.indexOf(xe.target);Qe!==-1&&Re.splice(Qe,1),B.current=Re,!(Re.length>0)&&(K({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),uf(xe)&&h&&h(xe))},[$,h,D]),Oe=U.useCallback(function(xe,Re){var Qe=[],Ve=[];xe.forEach(function(Ye){var _t=n6(Ye,k),fn=M0(_t,2),Xr=fn[0],mr=fn[1],Lt=r6(Ye,o,s),Bt=M0(Lt,2),Cn=Bt[0],_r=Bt[1],Kn=P?P(Ye):null;if(Xr&&Cn&&!Kn)Qe.push(Ye);else{var we=[mr,_r];Kn&&(we=we.concat(Kn)),Ve.push({file:Ye,errors:we.filter(function(rt){return rt})})}}),(!l&&Qe.length>1||l&&u>=1&&Qe.length>u)&&(Qe.forEach(function(Ye){Ve.push({file:Ye,errors:[Wne]})}),Qe.splice(0)),K({acceptedFiles:Qe,fileRejections:Ve,isDragReject:Ve.length>0,type:"setFiles"}),_&&_(Qe,Ve,Re),Ve.length>0&&T&&T(Ve,Re),Qe.length>0&&y&&y(Qe,Re)},[K,l,k,o,s,u,_,y,T,P]),ze=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Rn(xe),B.current=[],uf(xe)&&Promise.resolve(i(xe)).then(function(Re){cd(xe)&&!D||Oe(Re,xe)}).catch(function(Re){return Q(Re)}),K({type:"reset"})},[i,Oe,Q,D]),It=U.useCallback(function(){if(ee.current){K({type:"openDialog"}),X();var xe={multiple:l,types:V};window.showOpenFilePicker(xe).then(function(Re){return i(Re)}).then(function(Re){Oe(Re,null),K({type:"closeDialog"})}).catch(function(Re){ere(Re)?(Z(Re),K({type:"closeDialog"})):tre(Re)?(ee.current=!1,H.current?(H.current.value=null,H.current.click()):Q(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Q(Re)});return}H.current&&(K({type:"openDialog"}),X(),H.current.value=null,H.current.click())},[K,X,Z,S,Oe,Q,V,l]),mt=U.useCallback(function(xe){!$.current||!$.current.isEqualNode(xe.target)||(xe.key===" "||xe.key==="Enter"||xe.keyCode===32||xe.keyCode===13)&&(xe.preventDefault(),It())},[$,It]),ct=U.useCallback(function(){K({type:"focus"})},[]),De=U.useCallback(function(){K({type:"blur"})},[]),cn=U.useCallback(function(){E||(Kne()?setTimeout(It,0):It())},[E,It]),Ne=function(Re){return r?null:Re},yn=function(Re){return C?null:Ne(Re)},Wt=function(Re){return O?null:Ne(Re)},Rn=function(Re){D&&Re.stopPropagation()},jt=U.useMemo(function(){return function(){var xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=xe.refKey,Qe=Re===void 0?"ref":Re,Ve=xe.role,Ye=xe.onKeyDown,_t=xe.onFocus,fn=xe.onBlur,Xr=xe.onClick,mr=xe.onDragEnter,Lt=xe.onDragOver,Bt=xe.onDragLeave,Cn=xe.onDrop,_r=ud(xe,ire);return At(At(Bx({onKeyDown:yn(Ur(Ye,mt)),onFocus:yn(Ur(_t,ct)),onBlur:yn(Ur(fn,De)),onClick:Ne(Ur(Xr,cn)),onDragEnter:Wt(Ur(mr,pe)),onDragOver:Wt(Ur(Lt,ye)),onDragLeave:Wt(Ur(Bt,Ee)),onDrop:Wt(Ur(Cn,ze)),role:typeof Ve=="string"&&Ve!==""?Ve:"presentation"},Qe,$),!r&&!C?{tabIndex:0}:{}),_r)}},[$,mt,ct,De,cn,pe,ye,Ee,ze,C,O,r]),un=U.useCallback(function(xe){xe.stopPropagation()},[]),We=U.useMemo(function(){return function(){var xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=xe.refKey,Qe=Re===void 0?"ref":Re,Ve=xe.onChange,Ye=xe.onClick,_t=ud(xe,sre),fn=Bx({accept:k,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Ne(Ur(Ve,ze)),onClick:Ne(Ur(Ye,un)),tabIndex:-1},Qe,H);return At(At({},fn),_t)}},[H,t,l,ze,r]);return At(At({},fe),{},{isFocused:I&&!r,getRootProps:jt,getInputProps:We,rootRef:$,inputRef:H,open:Ne(It)})}function pre(n,e){switch(e.type){case"focus":return At(At({},n),{},{isFocused:!0});case"blur":return At(At({},n),{},{isFocused:!1});case"openDialog":return At(At({},Ux),{},{isFileDialogActive:!0});case"closeDialog":return At(At({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return At(At({},n),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return At(At({},n),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return At({},Ux);default:return n}}function xM(){}function gre({onUploadComplete:n,setLoading:e}){const[t,r]=U.useState(null),[i,s]=U.useState("none"),[o,l]=U.useState({sampleLocations:null,nodeLocations:null}),[u,d]=U.useState({}),h=U.useCallback(D=>{D.length>0&&(r(D[0]),s("none"),l({sampleLocations:null,nodeLocations:null}),d({}))},[]),{getRootProps:g,getInputProps:_,isDragActive:y}=Sf({onDrop:h,multiple:!1,accept:Tg.ACCEPTED_FORMATS}),T=U.useCallback(D=>{D.length>0&&l(M=>({...M,sampleLocations:D[0]}))},[]),w=Sf({onDrop:T,multiple:!1,accept:Tg.CSV_FORMATS}),x=U.useCallback(D=>{D.length>0&&l(M=>({...M,nodeLocations:D[0]}))},[]),S=Sf({onDrop:x,multiple:!1,accept:Tg.CSV_FORMATS}),A=async()=>{if(t){e(!0);try{Se.user.action("upload-start",{filename:t.name,size:t.size},"Dropzone");const D=await bt.uploadTreeSequence(t);Se.info("File upload completed successfully",{component:"Dropzone",data:{filename:t.name,result:D}}),n&&n(D.data)}catch(D){Se.error("File upload failed",{component:"Dropzone",error:D instanceof Error?D:new Error(String(D)),data:{filename:t.name}}),alert(`Upload failed: ${D instanceof Error?D.message:"Unknown error"}`)}finally{e(!1)}}},R=()=>{s("add-locations")},E=async(D,M)=>{try{const P=await bt.uploadLocationCSV(D,M);return d(k=>({...k,[M]:P.data.filename})),P.data.filename}catch(P){throw Se.error("CSV upload failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:D.name,csvType:M}}),P}},C=async()=>{if(!(!t||!o.sampleLocations||!o.nodeLocations)){e(!0);try{Se.user.action("upload-start",{filename:t.name,size:t.size},"Dropzone"),await bt.uploadTreeSequence(t);let D=u.sample_locations,M=u.node_locations;if(!D&&o.sampleLocations&&(D=await E(o.sampleLocations,"sample_locations")),!M&&o.nodeLocations&&(M=await E(o.nodeLocations,"node_locations")),!D||!M)throw new Error("Failed to upload CSV files");console.log("Starting tree sequence update...");const P=await bt.updateTreeSequenceLocations({tree_sequence_filename:t.name,sample_locations_filename:D,node_locations_filename:M});console.log("Tree sequence update completed:",P),Se.info("Tree sequence updated with custom locations",{component:"Dropzone",data:{originalFilename:t.name,newFilename:P.data.new_filename}}),n&&(console.log("Calling onUploadComplete with:",P.data),n(P.data))}catch(D){Se.error("Tree sequence update failed",{component:"Dropzone",error:D instanceof Error?D:new Error(String(D)),data:{filename:t.name}}),alert(`Update failed: ${D instanceof Error?D.message:"Unknown error"}`)}finally{e(!1)}}},O=t&&o.sampleLocations&&o.nodeLocations;return m.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[m.jsxs("div",{...g(),className:`w-full h-48 border-2 border-dashed rounded-xl flex items-center justify-center text-xl transition-colors cursor-pointer select-none
          ${y?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{..._()}),t?m.jsx("span",{className:"truncate max-w-full px-2",children:t.name}):y?m.jsx("span",{children:"Drop the file here…"}):m.jsxs("span",{className:"text-center",children:["Drag and drop to select a file",m.jsx("br",{}),m.jsx("span",{className:"text-base text-sp-pale-green",children:"or click to browse"}),m.jsx("br",{}),m.jsx("span",{className:"text-sm text-sp-very-pale-green mt-1",children:"Supported formats: .trees, .tsz"})]})]}),t&&i==="none"&&m.jsxs("div",{className:"w-full flex flex-col gap-3",children:[m.jsxs("button",{type:"button",onClick:A,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Load as-is"]}),m.jsxs("button",{type:"button",onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Add locations"]})]}),i==="add-locations"&&m.jsxs("div",{className:"w-full space-y-4",children:[m.jsx("div",{className:"text-center text-sp-white/70 text-sm mb-4",children:"Upload CSV files with node locations (required columns: node_id, x, y, z)"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Sample Locations"}),m.jsxs("div",{...w.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${w.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...w.getInputProps()}),o.sampleLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.sampleLocations.name}):w.isDragActive?m.jsx("span",{children:"Drop CSV here…"}):m.jsx("span",{children:"Click or drag CSV with sample locations"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Node Locations"}),m.jsxs("div",{...S.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${S.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...S.getInputProps()}),o.nodeLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.nodeLocations.name}):S.isDragActive?m.jsx("span",{children:"Drop CSV here…"}):m.jsx("span",{children:"Click or drag CSV with node locations"})]})]}),m.jsxs("button",{type:"button",onClick:C,disabled:!O,className:`w-full font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 ${O?"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue transform hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Update Tree Sequence"]}),m.jsxs("button",{type:"button",onClick:()=>{s("none"),l({sampleLocations:null,nodeLocations:null}),d({})},className:"w-full bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}const Wa={num_samples:50,num_local_trees:10,max_time:20,model:"dtwf",filename_prefix:"simulated",crs:"EPSG:4326",ploidy:2},l6=n=>{switch(n){case"dtwf":return"dtwf";case"hudson":return"hud";case"smc":return"smc";case"smc_prime":return"smcp";default:return n.slice(0,4)}},c6=n=>{switch(n){case"EPSG:4326":return"4326";case"unit_grid":return"ug";case"EPSG:3857":return"3857";default:return n.replace(/[^a-zA-Z0-9]/g,"").slice(0,4)}},mre=n=>{const e=String(n.getMonth()+1).padStart(2,"0"),t=String(n.getDate()).padStart(2,"0"),r=String(n.getFullYear()).slice(-2),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0");return`${e}${t}${r}${i}${s}`},wM=(n,e,t=!1)=>{const r=l6(n.model),i=c6(n.crs||"EPSG:4326"),o=`r${e??Math.floor(Math.random()*1e3)}`;let l=`s${n.num_samples}_m${r}_t${n.num_local_trees}_g${n.max_time}_p${n.ploidy}_c${i}_${o}`;if(t){const d=mre(new Date);l+=`_d${d}`}return l};function _re({onSimulationComplete:n,setLoading:e}){var R;const[t,r]=U.useState(Wa),[i,s]=U.useState(!1),[o,l]=U.useState(!0),[u,d]=U.useState(!1),[h,g]=U.useState({num_samples:Wa.num_samples.toString(),num_local_trees:Wa.num_local_trees.toString(),max_time:Wa.max_time.toString(),ploidy:Wa.ploidy.toString(),random_seed:((R=Wa.random_seed)==null?void 0:R.toString())||"42"}),_=(E,C)=>{r(O=>({...O,[E]:C}))},y=(E,C)=>{g(O=>({...O,[E]:C}))},T=(E,C,O,D,M)=>{if(y(E,C),C==="")return;const P=parseInt(C);isNaN(P)||_(E,P)},w=(E,C,O,D,M)=>{const P=parseInt(C);let k=M;isNaN(P)||(k=Math.max(O,Math.min(D,P))),_(E,k),y(E,k.toString())},x=E=>{E.key==="Enter"&&(E.preventDefault(),A())},S=()=>o?wM(t,i?t.random_seed:void 0):t.filename_prefix,A=async()=>{e(!0);try{Se.user.action("simulate-start",{params:t},"TreeSequenceSimulator");const E={...t,population_size:t.num_samples*t.ploidy,random_seed:i?t.random_seed:void 0,filename_prefix:o?wM(t,i?t.random_seed:void 0,!0):t.filename_prefix},C=await bt.simulateTreeSequence(E);Se.info("Tree sequence simulation completed successfully",{component:"TreeSequenceSimulator",data:{params:E,result:C}}),n&&n(C.data)}catch(E){Se.error("Tree sequence simulation failed",{component:"TreeSequenceSimulator",error:E instanceof Error?E:new Error(String(E)),data:{params:t}}),alert(`Simulation failed: ${E instanceof Error?E.message:"Unknown error"}`)}finally{e(!1)}};return m.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Simulation Parameters"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Configure the tree sequence simulation settings"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sample individuals"}),m.jsx("input",{type:"number",min:"2",max:"500",value:h.num_samples,onChange:E=>T("num_samples",E.target.value),onBlur:E=>w("num_samples",E.target.value,2,500,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Range: 2-500"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Ploidy"}),m.jsx("input",{type:"number",min:"1",max:"10",value:h.ploidy,onChange:E=>T("ploidy",E.target.value),onBlur:E=>w("ploidy",E.target.value,1,10,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-10 (2=diploid)"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Local trees"}),m.jsx("input",{type:"number",min:"1",max:"1000",value:h.num_local_trees,onChange:E=>T("num_local_trees",E.target.value),onBlur:E=>w("num_local_trees",E.target.value,1,1e3,1),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Max generations"}),m.jsx("input",{type:"number",min:"1",max:"1000",value:h.max_time,onChange:E=>T("max_time",E.target.value),onBlur:E=>w("max_time",E.target.value,1,1e3,1),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Model"}),m.jsxs("select",{value:t.model,onChange:E=>_("model",E.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"dtwf",children:"Discrete Wright-Fisher"}),m.jsx("option",{value:"hudson",children:"Hudson"}),m.jsx("option",{value:"smc",children:"SMC"}),m.jsx("option",{value:"smc_prime",children:"SMC'"})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Coordinate System"}),m.jsxs("select",{value:t.crs||"EPSG:4326",onChange:E=>_("crs",E.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"EPSG:4326",children:"WGS84 Geographic"}),m.jsx("option",{value:"unit_grid",children:"Unit Grid (0-1)"}),m.jsx("option",{value:"EPSG:3857",children:"Web Mercator"})]}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Spatial coordinate system"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("div",{className:"bg-sp-pale-green/10 border border-sp-pale-green/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Population Summary"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{children:"Total haplotypes:"}),m.jsx("span",{className:"font-bold text-sp-pale-green",children:t.num_samples*t.ploidy})]}),m.jsxs("div",{className:"text-xs text-sp-white/60",children:[t.num_samples," individuals × ",t.ploidy," ploidy"]})]})]}),m.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Output Filename"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sp-pale-green break-all text-xs",children:S()}),m.jsx("div",{className:"text-xs text-sp-white/60",children:o?m.jsx("button",{onClick:()=>d(!0),className:"underline hover:text-sp-pale-green transition-colors cursor-pointer",children:"Auto-generated from parameters"}):"Custom filename"})]})]})]}),m.jsx("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl overflow-hidden",children:m.jsxs("details",{className:"group",children:[m.jsx("summary",{className:"px-5 py-3 cursor-pointer hover:bg-sp-pale-green/5 transition-colors duration-200 border-b border-sp-pale-green/10 group-open:border-b-0 list-none",children:m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green transition-transform duration-200 group-open:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),m.jsx("span",{className:"font-medium text-sp-white text-sm",children:"Advanced Options"})]})})}),m.jsxs("div",{className:"px-5 py-3 space-y-3 bg-sp-very-dark-blue/50",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useAutoFilename",checked:o,onChange:E=>l(E.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useAutoFilename",className:"text-sm font-medium text-sp-white",children:"Auto-generate filename"})]}),!o&&m.jsxs("div",{className:"ml-6",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1 block",children:"Custom filename prefix"}),m.jsx("input",{type:"text",value:t.filename_prefix,onChange:E=>_("filename_prefix",E.target.value),onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"simulated"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useCustomSeed",checked:i,onChange:E=>s(E.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useCustomSeed",className:"text-sm font-medium text-sp-white",children:"Use custom random seed"})]}),i?m.jsx("div",{className:"ml-6",children:m.jsx("input",{type:"number",value:h.random_seed,onChange:E=>{const C=E.target.value;if(y("random_seed",C),C!==""){const O=parseInt(C);isNaN(O)||_("random_seed",O)}},onBlur:E=>{const C=parseInt(E.target.value),O=isNaN(C)?42:C;_("random_seed",O),y("random_seed",O.toString())},onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"42"})}):m.jsx("div",{className:"ml-6 text-xs text-sp-white/60",children:"Random seed will be generated automatically"})]})]})]})}),m.jsx("div",{className:"flex justify-center pt-2",children:m.jsxs("button",{type:"button",onClick:A,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Simulate Tree Sequence"]})}),u&&m.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/30 rounded-xl p-5 max-w-lg w-full shadow-2xl",children:[m.jsxs("div",{className:"flex justify-between items-start mb-3",children:[m.jsx("h3",{className:"text-lg font-bold text-sp-white",children:"Filename Format Explained"}),m.jsx("button",{onClick:()=>d(!1),className:"text-sp-white/60 hover:text-sp-white transition-colors text-2xl leading-none",children:"×"})]}),m.jsxs("div",{className:"space-y-3 text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sm text-sp-pale-green bg-sp-dark-blue rounded-lg p-3 break-all",children:S()}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["s",t.num_samples]})," - Sample individuals (2-500)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["m",l6(t.model)]})," - Model (dtwf, hud, smc, smcp)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["t",t.num_local_trees]})," - Local trees (1-1000)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["g",t.max_time]})," - Max generations (1-1000)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["p",t.ploidy]})," - Ploidy (1-10)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["c",c6(t.crs||"EPSG:4326")]})," - Coordinate system"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"r###"})," - Random seed (0-999)"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"d##########"})," - Timestamp (MMDDYYHHMM)"]})]})]}),m.jsx("button",{onClick:()=>d(!1),className:"w-full mt-4 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white font-medium py-2.5 rounded-lg transition-colors duration-200",children:"Close"})]})})]})}function vre({selectedOption:n,onBack:e}){const t=pc(),[r,i]=U.useState(!1),[s,o]=U.useState(0),{setTreeSequence:l}=$s();U.useEffect(()=>{if(r){const T=setInterval(()=>{o(w=>(w+1)%4)},MB.LOADING_DOTS_INTERVAL);return()=>clearInterval(T)}else o(0)},[r]);const u=T=>{l(T),t("/result",{state:{fromIntermediate:n}})},d=T=>{l(T),t("/result",{state:{fromIntermediate:n}})},h=T=>{l(T),t("/result",{state:{fromIntermediate:n}})},g=()=>{switch(n){case"upload":return"Upload a Tree Sequence";case"simulate":return"Simulate a Tree Sequence";case"load":return"Load a Tree Sequence";default:return""}},_=()=>{switch(n){case"upload":return"Upload your own .trees file to visualize";case"simulate":return"Generate new data using msprime simulation";case"load":return"Choose from existing uploaded sequences";default:return""}},y=()=>{if(r)return m.jsxs("div",{className:"flex flex-col items-center text-xl text-sp-white space-y-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sp-pale-green"}),m.jsxs("span",{children:["Processing",Array(s+1).join(".")]})]});switch(n){case"upload":return m.jsx(gre,{onUploadComplete:u,setLoading:i});case"simulate":return m.jsx(_re,{onSimulationComplete:h,setLoading:i});case"load":return m.jsx(HM,{onSelect:d});default:return null}};return m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{onClick:e,className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to options"]}),m.jsx(gc,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:g()}),m.jsx("p",{className:"text-sp-white/70 text-lg",children:_()})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsx("div",{className:"p-8 min-h-[600px] flex items-start justify-center",children:y()})})})]})}const u6="argscape_first_visit",yre=()=>{try{return!sessionStorage.getItem(u6)}catch{return!0}},bre=()=>{try{sessionStorage.setItem(u6,"true")}catch{console.warn("Session storage not available")}};function ff({children:n}){return m.jsxs(m.Fragment,{children:[m.jsx("main",{children:n}),m.jsx(HV,{})]})}function xre(){const n=hc(),[e,t]=U.useState("intro"),[r,i]=U.useState(null),[s,o]=U.useState(!1),[l,u]=U.useState([]),[d,h]=U.useState(!1),[g,_]=U.useState(!1),[y,T]=U.useState(!1);U.useEffect(()=>{d||(async()=>{var R;try{Se.data.processing("fetch-available-tree-sequences","Home");const C=(await bt.getUploadedFiles()).data;u(C.uploaded_tree_sequences||[]),Se.info(`Found ${((R=C.uploaded_tree_sequences)==null?void 0:R.length)||0} available tree sequences for animation logic`,{component:"Home"})}catch(E){Se.error("Failed to fetch available tree sequences",{component:"Home",error:E instanceof Error?E:new Error(String(E))}),u([])}finally{h(!0)}})()},[d]),U.useEffect(()=>{var D,M,P,k;if(!d)return;const A=(D=n.state)==null?void 0:D.fromInternal,R=(M=n.state)==null?void 0:M.fromResult,E=(P=n.state)==null?void 0:P.selectedOption,C=(k=n.state)==null?void 0:k.forceIntro;R&&E?(i(E),t("intermediate"),o(!1)):(l.length>0||R&&E||A?!1:(C||yre(),!0))?(o(!0),t("intro"),i(null),bre()):(t("landing"),o(!1),i(null))},[n.state,d,l.length]);const w=()=>{T(!0),t("transitioning"),setTimeout(()=>{t("landing"),o(!1),T(!1)},2e3)},x=A=>{i(A),t("intermediate")},S=()=>{i(null),t("landing")};return m.jsxs("div",{className:"bg-sp-very-dark-blue min-h-screen",children:[s&&e==="intro"&&m.jsx(sM,{onComplete:w}),e==="transitioning"&&m.jsxs("div",{className:"relative min-h-screen",children:[m.jsx(sM,{onComplete:w,isTransitioning:!0}),m.jsx(aM,{onOptionSelect:x,isTransitioning:!0})]}),e==="landing"&&m.jsx(aM,{onOptionSelect:x}),e==="intermediate"&&r&&m.jsx(vre,{selectedOption:r,onBack:S})]})}function wre(){return m.jsx(DB,{children:m.jsx(IB,{children:m.jsx(NB,{children:m.jsxs(AB,{children:[m.jsx(Ml,{path:"/",element:m.jsx(ff,{children:m.jsx(xre,{})})}),m.jsx(Ml,{path:"/result",element:m.jsx(ff,{children:m.jsx(UB,{})})}),m.jsx(Ml,{path:"/visualize/:filename",element:m.jsx(ff,{children:m.jsx($V,{})})}),m.jsx(Ml,{path:"/visualize-spatial/:filename",element:m.jsx(ff,{children:m.jsx(pne,{})})})]})})})})}OL.createRoot(document.getElementById("root")).render(m.jsx(wre,{}));
