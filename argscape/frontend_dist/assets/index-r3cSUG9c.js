var AL=Object.defineProperty;var RL=(t,e,n)=>e in t?AL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var j=(t,e,n)=>RL(t,typeof e!="symbol"?e+"":e,n);function CL(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Vu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vg={exports:{}},Tl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W3;function NL(){if(W3)return Tl;W3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return Tl.Fragment=e,Tl.jsx=n,Tl.jsxs=n,Tl}var X3;function kL(){return X3||(X3=1,vg.exports=NL()),vg.exports}var m=kL(),yg={exports:{}},Sl={},bg={exports:{}},xg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y3;function ML(){return Y3||(Y3=1,function(t){function e(q,ee){var de=q.length;q.push(ee);e:for(;0<de;){var Z=de-1>>>1,D=q[Z];if(0<i(D,ee))q[Z]=ee,q[de]=D,de=Z;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var ee=q[0],de=q.pop();if(de!==ee){q[0]=de;e:for(var Z=0,D=q.length,G=D>>>1;Z<G;){var oe=2*(Z+1)-1,ie=q[oe],F=oe+1,$=q[F];if(0>i(ie,de))F<D&&0>i($,ie)?(q[Z]=$,q[F]=de,Z=F):(q[Z]=ie,q[oe]=de,Z=oe);else if(F<D&&0>i($,de))q[Z]=$,q[F]=de,Z=F;else break e}}return ee}function i(q,ee){var de=q.sortIndex-ee.sortIndex;return de!==0?de:q.id-ee.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var u=[],d=[],h=1,g=null,_=3,y=!1,T=!1,w=!1,x=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E(q){for(var ee=n(d);ee!==null;){if(ee.callback===null)r(d);else if(ee.startTime<=q)r(d),ee.sortIndex=ee.expirationTime,e(u,ee);else break;ee=n(d)}}function C(q){if(w=!1,E(q),!T)if(n(u)!==null)T=!0,I||(I=!0,z());else{var ee=n(d);ee!==null&&W(C,ee.startTime-q)}}var I=!1,O=-1,M=5,P=-1;function N(){return x?!0:!(t.unstable_now()-P<M)}function B(){if(x=!1,I){var q=t.unstable_now();P=q;var ee=!0;try{e:{T=!1,w&&(w=!1,A(O),O=-1),y=!0;var de=_;try{t:{for(E(q),g=n(u);g!==null&&!(g.expirationTime>q&&N());){var Z=g.callback;if(typeof Z=="function"){g.callback=null,_=g.priorityLevel;var D=Z(g.expirationTime<=q);if(q=t.unstable_now(),typeof D=="function"){g.callback=D,E(q),ee=!0;break t}g===n(u)&&r(u),E(q)}else r(u);g=n(u)}if(g!==null)ee=!0;else{var G=n(d);G!==null&&W(C,G.startTime-q),ee=!1}}break e}finally{g=null,_=de,y=!1}ee=void 0}}finally{ee?z():I=!1}}}var z;if(typeof R=="function")z=function(){R(B)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,H=Q.port2;Q.port1.onmessage=B,z=function(){H.postMessage(null)}}else z=function(){S(B,0)};function W(q,ee){O=S(function(){q(t.unstable_now())},ee)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_next=function(q){switch(_){case 1:case 2:case 3:var ee=3;break;default:ee=_}var de=_;_=ee;try{return q()}finally{_=de}},t.unstable_requestPaint=function(){x=!0},t.unstable_runWithPriority=function(q,ee){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var de=_;_=q;try{return ee()}finally{_=de}},t.unstable_scheduleCallback=function(q,ee,de){var Z=t.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?Z+de:Z):de=Z,q){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=de+D,q={id:h++,callback:ee,priorityLevel:q,startTime:de,expirationTime:D,sortIndex:-1},de>Z?(q.sortIndex=de,e(d,q),n(u)===null&&q===n(d)&&(w?(A(O),O=-1):w=!0,W(C,de-Z))):(q.sortIndex=D,e(u,q),T||y||(T=!0,I||(I=!0,z()))),q},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(q){var ee=_;return function(){var de=_;_=ee;try{return q.apply(this,arguments)}finally{_=de}}}}(xg)),xg}var G3;function IL(){return G3||(G3=1,bg.exports=ML()),bg.exports}var wg={exports:{}},Le={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K3;function OL(){if(K3)return Le;K3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),g=Symbol.iterator;function _(D){return D===null||typeof D!="object"?null:(D=g&&D[g]||D["@@iterator"],typeof D=="function"?D:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,w={};function x(D,G,oe){this.props=D,this.context=G,this.refs=w,this.updater=oe||y}x.prototype.isReactComponent={},x.prototype.setState=function(D,G){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,G,"setState")},x.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function S(){}S.prototype=x.prototype;function A(D,G,oe){this.props=D,this.context=G,this.refs=w,this.updater=oe||y}var R=A.prototype=new S;R.constructor=A,T(R,x.prototype),R.isPureReactComponent=!0;var E=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},I=Object.prototype.hasOwnProperty;function O(D,G,oe,ie,F,$){return oe=$.ref,{$$typeof:t,type:D,key:G,ref:oe!==void 0?oe:null,props:$}}function M(D,G){return O(D.type,G,void 0,void 0,void 0,D.props)}function P(D){return typeof D=="object"&&D!==null&&D.$$typeof===t}function N(D){var G={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(oe){return G[oe]})}var B=/\/+/g;function z(D,G){return typeof D=="object"&&D!==null&&D.key!=null?N(""+D.key):G.toString(36)}function Q(){}function H(D){switch(D.status){case"fulfilled":return D.value;case"rejected":throw D.reason;default:switch(typeof D.status=="string"?D.then(Q,Q):(D.status="pending",D.then(function(G){D.status==="pending"&&(D.status="fulfilled",D.value=G)},function(G){D.status==="pending"&&(D.status="rejected",D.reason=G)})),D.status){case"fulfilled":return D.value;case"rejected":throw D.reason}}throw D}function W(D,G,oe,ie,F){var $=typeof D;($==="undefined"||$==="boolean")&&(D=null);var Y=!1;if(D===null)Y=!0;else switch($){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(D.$$typeof){case t:case e:Y=!0;break;case h:return Y=D._init,W(Y(D._payload),G,oe,ie,F)}}if(Y)return F=F(D),Y=ie===""?"."+z(D,0):ie,E(F)?(oe="",Y!=null&&(oe=Y.replace(B,"$&/")+"/"),W(F,G,oe,"",function(Se){return Se})):F!=null&&(P(F)&&(F=M(F,oe+(F.key==null||D&&D.key===F.key?"":(""+F.key).replace(B,"$&/")+"/")+Y)),G.push(F)),1;Y=0;var ue=ie===""?".":ie+":";if(E(D))for(var ye=0;ye<D.length;ye++)ie=D[ye],$=ue+z(ie,ye),Y+=W(ie,G,oe,$,F);else if(ye=_(D),typeof ye=="function")for(D=ye.call(D),ye=0;!(ie=D.next()).done;)ie=ie.value,$=ue+z(ie,ye++),Y+=W(ie,G,oe,$,F);else if($==="object"){if(typeof D.then=="function")return W(H(D),G,oe,ie,F);throw G=String(D),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return Y}function q(D,G,oe){if(D==null)return D;var ie=[],F=0;return W(D,ie,"","",function($){return G.call(oe,$,F++)}),ie}function ee(D){if(D._status===-1){var G=D._result;G=G(),G.then(function(oe){(D._status===0||D._status===-1)&&(D._status=1,D._result=oe)},function(oe){(D._status===0||D._status===-1)&&(D._status=2,D._result=oe)}),D._status===-1&&(D._status=0,D._result=G)}if(D._status===1)return D._result.default;throw D._result}var de=typeof reportError=="function"?reportError:function(D){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof D=="object"&&D!==null&&typeof D.message=="string"?String(D.message):String(D),error:D});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",D);return}console.error(D)};function Z(){}return Le.Children={map:q,forEach:function(D,G,oe){q(D,function(){G.apply(this,arguments)},oe)},count:function(D){var G=0;return q(D,function(){G++}),G},toArray:function(D){return q(D,function(G){return G})||[]},only:function(D){if(!P(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Le.Component=x,Le.Fragment=n,Le.Profiler=i,Le.PureComponent=A,Le.StrictMode=r,Le.Suspense=u,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Le.__COMPILER_RUNTIME={__proto__:null,c:function(D){return C.H.useMemoCache(D)}},Le.cache=function(D){return function(){return D.apply(null,arguments)}},Le.cloneElement=function(D,G,oe){if(D==null)throw Error("The argument must be a React element, but you passed "+D+".");var ie=T({},D.props),F=D.key,$=void 0;if(G!=null)for(Y in G.ref!==void 0&&($=void 0),G.key!==void 0&&(F=""+G.key),G)!I.call(G,Y)||Y==="key"||Y==="__self"||Y==="__source"||Y==="ref"&&G.ref===void 0||(ie[Y]=G[Y]);var Y=arguments.length-2;if(Y===1)ie.children=oe;else if(1<Y){for(var ue=Array(Y),ye=0;ye<Y;ye++)ue[ye]=arguments[ye+2];ie.children=ue}return O(D.type,F,void 0,void 0,$,ie)},Le.createContext=function(D){return D={$$typeof:o,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null},D.Provider=D,D.Consumer={$$typeof:s,_context:D},D},Le.createElement=function(D,G,oe){var ie,F={},$=null;if(G!=null)for(ie in G.key!==void 0&&($=""+G.key),G)I.call(G,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(F[ie]=G[ie]);var Y=arguments.length-2;if(Y===1)F.children=oe;else if(1<Y){for(var ue=Array(Y),ye=0;ye<Y;ye++)ue[ye]=arguments[ye+2];F.children=ue}if(D&&D.defaultProps)for(ie in Y=D.defaultProps,Y)F[ie]===void 0&&(F[ie]=Y[ie]);return O(D,$,void 0,void 0,null,F)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(D){return{$$typeof:l,render:D}},Le.isValidElement=P,Le.lazy=function(D){return{$$typeof:h,_payload:{_status:-1,_result:D},_init:ee}},Le.memo=function(D,G){return{$$typeof:d,type:D,compare:G===void 0?null:G}},Le.startTransition=function(D){var G=C.T,oe={};C.T=oe;try{var ie=D(),F=C.S;F!==null&&F(oe,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(Z,de)}catch($){de($)}finally{C.T=G}},Le.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},Le.use=function(D){return C.H.use(D)},Le.useActionState=function(D,G,oe){return C.H.useActionState(D,G,oe)},Le.useCallback=function(D,G){return C.H.useCallback(D,G)},Le.useContext=function(D){return C.H.useContext(D)},Le.useDebugValue=function(){},Le.useDeferredValue=function(D,G){return C.H.useDeferredValue(D,G)},Le.useEffect=function(D,G,oe){var ie=C.H;if(typeof oe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(D,G)},Le.useId=function(){return C.H.useId()},Le.useImperativeHandle=function(D,G,oe){return C.H.useImperativeHandle(D,G,oe)},Le.useInsertionEffect=function(D,G){return C.H.useInsertionEffect(D,G)},Le.useLayoutEffect=function(D,G){return C.H.useLayoutEffect(D,G)},Le.useMemo=function(D,G){return C.H.useMemo(D,G)},Le.useOptimistic=function(D,G){return C.H.useOptimistic(D,G)},Le.useReducer=function(D,G,oe){return C.H.useReducer(D,G,oe)},Le.useRef=function(D){return C.H.useRef(D)},Le.useState=function(D){return C.H.useState(D)},Le.useSyncExternalStore=function(D,G,oe){return C.H.useSyncExternalStore(D,G,oe)},Le.useTransition=function(){return C.H.useTransition()},Le.version="19.1.0",Le}var Z3;function H0(){return Z3||(Z3=1,wg.exports=OL()),wg.exports}var Tg={exports:{}},gn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q3;function PL(){if(Q3)return gn;Q3=1;var t=H0();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,d,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:u,containerInfo:d,implementation:h}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return gn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,gn.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},gn.flushSync=function(u){var d=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=d,r.p=h,r.d.f()}},gn.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,r.d.C(u,d))},gn.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},gn.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin),_=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?r.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:_,fetchPriority:y}):h==="script"&&r.d.X(u,{crossOrigin:g,integrity:_,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},gn.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&r.d.M(u)},gn.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,g=l(h,d.crossOrigin);r.d.L(u,h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},gn.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);r.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else r.d.m(u)},gn.requestFormReset=function(u){r.d.r(u)},gn.unstable_batchedUpdates=function(u,d){return u(d)},gn.useFormState=function(u,d,h){return o.H.useFormState(u,d,h)},gn.useFormStatus=function(){return o.H.useHostTransitionStatus()},gn.version="19.1.0",gn}var J3;function CM(){if(J3)return Tg.exports;J3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Tg.exports=PL(),Tg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eS;function DL(){if(eS)return Sl;eS=1;var t=IL(),e=H0(),n=CM();function r(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function s(a){var c=a,f=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(f=c.return),a=c.return;while(a)}return c.tag===3?f:null}function o(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function l(a){if(s(a)!==a)throw Error(r(188))}function u(a){var c=a.alternate;if(!c){if(c=s(a),c===null)throw Error(r(188));return c!==a?null:a}for(var f=a,p=c;;){var v=f.return;if(v===null)break;var b=v.alternate;if(b===null){if(p=v.return,p!==null){f=p;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===f)return l(v),a;if(b===p)return l(v),c;b=b.sibling}throw Error(r(188))}if(f.return!==p.return)f=v,p=b;else{for(var k=!1,L=v.child;L;){if(L===f){k=!0,f=v,p=b;break}if(L===p){k=!0,p=v,f=b;break}L=L.sibling}if(!k){for(L=b.child;L;){if(L===f){k=!0,f=b,p=v;break}if(L===p){k=!0,p=b,f=v;break}L=L.sibling}if(!k)throw Error(r(189))}}if(f.alternate!==p)throw Error(r(190))}if(f.tag!==3)throw Error(r(188));return f.stateNode.current===f?a:c}function d(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=d(a),c!==null)return c;a=a.sibling}return null}var h=Object.assign,g=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),A=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function z(a){return a===null||typeof a!="object"?null:(a=B&&a[B]||a["@@iterator"],typeof a=="function"?a:null)}var Q=Symbol.for("react.client.reference");function H(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Q?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case x:return"Profiler";case w:return"StrictMode";case C:return"Suspense";case I:return"SuspenseList";case P:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case y:return"Portal";case R:return(a.displayName||"Context")+".Provider";case A:return(a._context.displayName||"Context")+".Consumer";case E:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case O:return c=a.displayName||null,c!==null?c:H(a.type)||"Memo";case M:c=a._payload,a=a._init;try{return H(a(c))}catch{}}return null}var W=Array.isArray,q=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},Z=[],D=-1;function G(a){return{current:a}}function oe(a){0>D||(a.current=Z[D],Z[D]=null,D--)}function ie(a,c){D++,Z[D]=a.current,a.current=c}var F=G(null),$=G(null),Y=G(null),ue=G(null);function ye(a,c){switch(ie(Y,c),ie($,a),ie(F,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?b3(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=b3(c),a=x3(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}oe(F),ie(F,a)}function Se(){oe(F),oe($),oe(Y)}function ke(a){a.memoizedState!==null&&ie(ue,a);var c=F.current,f=x3(c,a.type);c!==f&&(ie($,a),ie(F,f))}function Ue(a){$.current===a&&(oe(F),oe($)),ue.current===a&&(oe(ue),vl._currentValue=de)}var yt=Object.prototype.hasOwnProperty,We=t.unstable_scheduleCallback,Fe=t.unstable_cancelCallback,De=t.unstable_shouldYield,Jt=t.unstable_requestPaint,Ne=t.unstable_now,xn=t.unstable_getCurrentPriorityLevel,Xt=t.unstable_ImmediatePriority,Cn=t.unstable_UserBlockingPriority,jt=t.unstable_NormalPriority,fn=t.unstable_LowPriority,Ye=t.unstable_IdlePriority,xe=t.log,Re=t.unstable_setDisableYieldValue,et=null,Ve=null;function Ke(a){if(typeof xe=="function"&&Re(a),Ve&&typeof Ve.setStrictMode=="function")try{Ve.setStrictMode(et,a)}catch{}}var vt=Math.clz32?Math.clz32:_r,dn=Math.log,Yr=Math.LN2;function _r(a){return a>>>=0,a===0?32:31-(dn(a)/Yr|0)|0}var Lt=256,Bt=4194304;function Nn(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function vr(a,c,f){var p=a.pendingLanes;if(p===0)return 0;var v=0,b=a.suspendedLanes,k=a.pingedLanes;a=a.warmLanes;var L=p&134217727;return L!==0?(p=L&~b,p!==0?v=Nn(p):(k&=L,k!==0?v=Nn(k):f||(f=L&~a,f!==0&&(v=Nn(f))))):(L=p&~b,L!==0?v=Nn(L):k!==0?v=Nn(k):f||(f=p&~a,f!==0&&(v=Nn(f)))),v===0?0:c!==0&&c!==v&&(c&b)===0&&(b=v&-v,f=c&-c,b>=f||b===32&&(f&4194048)!==0)?c:v}function Zn(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function we(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function st(){var a=Lt;return Lt<<=1,(Lt&4194048)===0&&(Lt=256),a}function Et(){var a=Bt;return Bt<<=1,(Bt&62914560)===0&&(Bt=4194304),a}function tt(a){for(var c=[],f=0;31>f;f++)c.push(a);return c}function bt(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function ea(a,c,f,p,v,b){var k=a.pendingLanes;a.pendingLanes=f,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=f,a.entangledLanes&=f,a.errorRecoveryDisabledLanes&=f,a.shellSuspendCounter=0;var L=a.entanglements,K=a.expirationTimes,fe=a.hiddenUpdates;for(f=k&~f;0<f;){var ge=31-vt(f),ve=1<<ge;L[ge]=0,K[ge]=-1;var he=fe[ge];if(he!==null)for(fe[ge]=null,ge=0;ge<he.length;ge++){var pe=he[ge];pe!==null&&(pe.lane&=-536870913)}f&=~ve}p!==0&&Co(a,p,0),b!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=b&~(k&~c))}function Co(a,c,f){a.pendingLanes|=c,a.suspendedLanes&=~c;var p=31-vt(c);a.entangledLanes|=c,a.entanglements[p]=a.entanglements[p]|1073741824|f&4194090}function a2(a,c){var f=a.entangledLanes|=c;for(a=a.entanglements;f;){var p=31-vt(f),v=1<<p;v&c|a[p]&c&&(a[p]|=c),f&=~v}}function lh(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function ch(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function o2(){var a=ee.p;return a!==0?a:(a=window.event,a===void 0?32:F3(a.type))}function gj(a,c){var f=ee.p;try{return ee.p=a,c()}finally{ee.p=f}}var bi=Math.random().toString(36).slice(2),hn="__reactFiber$"+bi,kn="__reactProps$"+bi,ta="__reactContainer$"+bi,uh="__reactEvents$"+bi,mj="__reactListeners$"+bi,_j="__reactHandles$"+bi,l2="__reactResources$"+bi,No="__reactMarker$"+bi;function fh(a){delete a[hn],delete a[kn],delete a[uh],delete a[mj],delete a[_j]}function na(a){var c=a[hn];if(c)return c;for(var f=a.parentNode;f;){if(c=f[ta]||f[hn]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(a=E3(a);a!==null;){if(f=a[hn])return f;a=E3(a)}return c}a=f,f=a.parentNode}return null}function ra(a){if(a=a[hn]||a[ta]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function ko(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(r(33))}function ia(a){var c=a[l2];return c||(c=a[l2]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function en(a){a[No]=!0}var c2=new Set,u2={};function os(a,c){sa(a,c),sa(a+"Capture",c)}function sa(a,c){for(u2[a]=c,a=0;a<c.length;a++)c2.add(c[a])}var vj=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),f2={},d2={};function yj(a){return yt.call(d2,a)?!0:yt.call(f2,a)?!1:vj.test(a)?d2[a]=!0:(f2[a]=!0,!1)}function Oc(a,c,f){if(yj(c))if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var p=c.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+f)}}function Pc(a,c,f){if(f===null)a.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+f)}}function Gr(a,c,f,p){if(p===null)a.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(f);return}a.setAttributeNS(c,f,""+p)}}var dh,h2;function aa(a){if(dh===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);dh=c&&c[1]||"",h2=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+dh+a+h2}var hh=!1;function ph(a,c){if(!a||hh)return"";hh=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(c){var ve=function(){throw Error()};if(Object.defineProperty(ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ve,[])}catch(pe){var he=pe}Reflect.construct(a,[],ve)}else{try{ve.call()}catch(pe){he=pe}a.call(ve.prototype)}}else{try{throw Error()}catch(pe){he=pe}(ve=a())&&typeof ve.catch=="function"&&ve.catch(function(){})}}catch(pe){if(pe&&he&&typeof pe.stack=="string")return[pe.stack,he.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=p.DetermineComponentFrameRoot(),k=b[0],L=b[1];if(k&&L){var K=k.split(`
`),fe=L.split(`
`);for(v=p=0;p<K.length&&!K[p].includes("DetermineComponentFrameRoot");)p++;for(;v<fe.length&&!fe[v].includes("DetermineComponentFrameRoot");)v++;if(p===K.length||v===fe.length)for(p=K.length-1,v=fe.length-1;1<=p&&0<=v&&K[p]!==fe[v];)v--;for(;1<=p&&0<=v;p--,v--)if(K[p]!==fe[v]){if(p!==1||v!==1)do if(p--,v--,0>v||K[p]!==fe[v]){var ge=`
`+K[p].replace(" at new "," at ");return a.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",a.displayName)),ge}while(1<=p&&0<=v);break}}}finally{hh=!1,Error.prepareStackTrace=f}return(f=a?a.displayName||a.name:"")?aa(f):""}function bj(a){switch(a.tag){case 26:case 27:case 5:return aa(a.type);case 16:return aa("Lazy");case 13:return aa("Suspense");case 19:return aa("SuspenseList");case 0:case 15:return ph(a.type,!1);case 11:return ph(a.type.render,!1);case 1:return ph(a.type,!0);case 31:return aa("Activity");default:return""}}function p2(a){try{var c="";do c+=bj(a),a=a.return;while(a);return c}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}function Qn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function g2(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function xj(a){var c=g2(a)?"checked":"value",f=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),p=""+a[c];if(!a.hasOwnProperty(c)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var v=f.get,b=f.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return v.call(this)},set:function(k){p=""+k,b.call(this,k)}}),Object.defineProperty(a,c,{enumerable:f.enumerable}),{getValue:function(){return p},setValue:function(k){p=""+k},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function Dc(a){a._valueTracker||(a._valueTracker=xj(a))}function m2(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var f=c.getValue(),p="";return a&&(p=g2(a)?a.checked?"true":"false":a.value),a=p,a!==f?(c.setValue(a),!0):!1}function jc(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var wj=/[\n"\\]/g;function Jn(a){return a.replace(wj,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function gh(a,c,f,p,v,b,k,L){a.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.type=k:a.removeAttribute("type"),c!=null?k==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Qn(c)):a.value!==""+Qn(c)&&(a.value=""+Qn(c)):k!=="submit"&&k!=="reset"||a.removeAttribute("value"),c!=null?mh(a,k,Qn(c)):f!=null?mh(a,k,Qn(f)):p!=null&&a.removeAttribute("value"),v==null&&b!=null&&(a.defaultChecked=!!b),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?a.name=""+Qn(L):a.removeAttribute("name")}function _2(a,c,f,p,v,b,k,L){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),c!=null||f!=null){if(!(b!=="submit"&&b!=="reset"||c!=null))return;f=f!=null?""+Qn(f):"",c=c!=null?""+Qn(c):f,L||c===a.value||(a.value=c),a.defaultValue=c}p=p??v,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=L?a.checked:!!p,a.defaultChecked=!!p,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.name=k)}function mh(a,c,f){c==="number"&&jc(a.ownerDocument)===a||a.defaultValue===""+f||(a.defaultValue=""+f)}function oa(a,c,f,p){if(a=a.options,c){c={};for(var v=0;v<f.length;v++)c["$"+f[v]]=!0;for(f=0;f<a.length;f++)v=c.hasOwnProperty("$"+a[f].value),a[f].selected!==v&&(a[f].selected=v),v&&p&&(a[f].defaultSelected=!0)}else{for(f=""+Qn(f),c=null,v=0;v<a.length;v++){if(a[v].value===f){a[v].selected=!0,p&&(a[v].defaultSelected=!0);return}c!==null||a[v].disabled||(c=a[v])}c!==null&&(c.selected=!0)}}function v2(a,c,f){if(c!=null&&(c=""+Qn(c),c!==a.value&&(a.value=c),f==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=f!=null?""+Qn(f):""}function y2(a,c,f,p){if(c==null){if(p!=null){if(f!=null)throw Error(r(92));if(W(p)){if(1<p.length)throw Error(r(93));p=p[0]}f=p}f==null&&(f=""),c=f}f=Qn(c),a.defaultValue=f,p=a.textContent,p===f&&p!==""&&p!==null&&(a.value=p)}function la(a,c){if(c){var f=a.firstChild;if(f&&f===a.lastChild&&f.nodeType===3){f.nodeValue=c;return}}a.textContent=c}var Tj=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function b2(a,c,f){var p=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?p?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":p?a.setProperty(c,f):typeof f!="number"||f===0||Tj.has(c)?c==="float"?a.cssFloat=f:a[c]=(""+f).trim():a[c]=f+"px"}function x2(a,c,f){if(c!=null&&typeof c!="object")throw Error(r(62));if(a=a.style,f!=null){for(var p in f)!f.hasOwnProperty(p)||c!=null&&c.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var v in c)p=c[v],c.hasOwnProperty(v)&&f[v]!==p&&b2(a,v,p)}else for(var b in c)c.hasOwnProperty(b)&&b2(a,b,c[b])}function _h(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sj=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ej=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lc(a){return Ej.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var vh=null;function yh(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ca=null,ua=null;function w2(a){var c=ra(a);if(c&&(a=c.stateNode)){var f=a[kn]||null;e:switch(a=c.stateNode,c.type){case"input":if(gh(a,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=a;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Jn(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var p=f[c];if(p!==a&&p.form===a.form){var v=p[kn]||null;if(!v)throw Error(r(90));gh(p,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(c=0;c<f.length;c++)p=f[c],p.form===a.form&&m2(p)}break e;case"textarea":v2(a,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&oa(a,!!f.multiple,c,!1)}}}var bh=!1;function T2(a,c,f){if(bh)return a(c,f);bh=!0;try{var p=a(c);return p}finally{if(bh=!1,(ca!==null||ua!==null)&&(wu(),ca&&(c=ca,a=ua,ua=ca=null,w2(c),a)))for(c=0;c<a.length;c++)w2(a[c])}}function Mo(a,c){var f=a.stateNode;if(f===null)return null;var p=f[kn]||null;if(p===null)return null;f=p[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(f&&typeof f!="function")throw Error(r(231,c,typeof f));return f}var Kr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xh=!1;if(Kr)try{var Io={};Object.defineProperty(Io,"passive",{get:function(){xh=!0}}),window.addEventListener("test",Io,Io),window.removeEventListener("test",Io,Io)}catch{xh=!1}var xi=null,wh=null,Bc=null;function S2(){if(Bc)return Bc;var a,c=wh,f=c.length,p,v="value"in xi?xi.value:xi.textContent,b=v.length;for(a=0;a<f&&c[a]===v[a];a++);var k=f-a;for(p=1;p<=k&&c[f-p]===v[b-p];p++);return Bc=v.slice(a,1<p?1-p:void 0)}function Uc(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function Fc(){return!0}function E2(){return!1}function Mn(a){function c(f,p,v,b,k){this._reactName=f,this._targetInst=v,this.type=p,this.nativeEvent=b,this.target=k,this.currentTarget=null;for(var L in a)a.hasOwnProperty(L)&&(f=a[L],this[L]=f?f(b):b[L]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Fc:E2,this.isPropagationStopped=E2,this}return h(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Fc)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Fc)},persist:function(){},isPersistent:Fc}),c}var ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zc=Mn(ls),Oo=h({},ls,{view:0,detail:0}),Aj=Mn(Oo),Th,Sh,Po,qc=h({},Oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ah,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Po&&(Po&&a.type==="mousemove"?(Th=a.screenX-Po.screenX,Sh=a.screenY-Po.screenY):Sh=Th=0,Po=a),Th)},movementY:function(a){return"movementY"in a?a.movementY:Sh}}),A2=Mn(qc),Rj=h({},qc,{dataTransfer:0}),Cj=Mn(Rj),Nj=h({},Oo,{relatedTarget:0}),Eh=Mn(Nj),kj=h({},ls,{animationName:0,elapsedTime:0,pseudoElement:0}),Mj=Mn(kj),Ij=h({},ls,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Oj=Mn(Ij),Pj=h({},ls,{data:0}),R2=Mn(Pj),Dj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Lj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bj(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=Lj[a])?!!c[a]:!1}function Ah(){return Bj}var Uj=h({},Oo,{key:function(a){if(a.key){var c=Dj[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=Uc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?jj[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ah,charCode:function(a){return a.type==="keypress"?Uc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Uc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Fj=Mn(Uj),zj=h({},qc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),C2=Mn(zj),qj=h({},Oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ah}),Vj=Mn(qj),$j=h({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hj=Mn($j),Wj=h({},qc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Xj=Mn(Wj),Yj=h({},ls,{newState:0,oldState:0}),Gj=Mn(Yj),Kj=[9,13,27,32],Rh=Kr&&"CompositionEvent"in window,Do=null;Kr&&"documentMode"in document&&(Do=document.documentMode);var Zj=Kr&&"TextEvent"in window&&!Do,N2=Kr&&(!Rh||Do&&8<Do&&11>=Do),k2=" ",M2=!1;function I2(a,c){switch(a){case"keyup":return Kj.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function O2(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var fa=!1;function Qj(a,c){switch(a){case"compositionend":return O2(c);case"keypress":return c.which!==32?null:(M2=!0,k2);case"textInput":return a=c.data,a===k2&&M2?null:a;default:return null}}function Jj(a,c){if(fa)return a==="compositionend"||!Rh&&I2(a,c)?(a=S2(),Bc=wh=xi=null,fa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return N2&&c.locale!=="ko"?null:c.data;default:return null}}var e6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function P2(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!e6[a.type]:c==="textarea"}function D2(a,c,f,p){ca?ua?ua.push(p):ua=[p]:ca=p,c=Cu(c,"onChange"),0<c.length&&(f=new zc("onChange","change",null,f,p),a.push({event:f,listeners:c}))}var jo=null,Lo=null;function t6(a){g3(a,0)}function Vc(a){var c=ko(a);if(m2(c))return a}function j2(a,c){if(a==="change")return c}var L2=!1;if(Kr){var Ch;if(Kr){var Nh="oninput"in document;if(!Nh){var B2=document.createElement("div");B2.setAttribute("oninput","return;"),Nh=typeof B2.oninput=="function"}Ch=Nh}else Ch=!1;L2=Ch&&(!document.documentMode||9<document.documentMode)}function U2(){jo&&(jo.detachEvent("onpropertychange",F2),Lo=jo=null)}function F2(a){if(a.propertyName==="value"&&Vc(Lo)){var c=[];D2(c,Lo,a,yh(a)),T2(t6,c)}}function n6(a,c,f){a==="focusin"?(U2(),jo=c,Lo=f,jo.attachEvent("onpropertychange",F2)):a==="focusout"&&U2()}function r6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Vc(Lo)}function i6(a,c){if(a==="click")return Vc(c)}function s6(a,c){if(a==="input"||a==="change")return Vc(c)}function a6(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var Ln=typeof Object.is=="function"?Object.is:a6;function Bo(a,c){if(Ln(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var f=Object.keys(a),p=Object.keys(c);if(f.length!==p.length)return!1;for(p=0;p<f.length;p++){var v=f[p];if(!yt.call(c,v)||!Ln(a[v],c[v]))return!1}return!0}function z2(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function q2(a,c){var f=z2(a);a=0;for(var p;f;){if(f.nodeType===3){if(p=a+f.textContent.length,a<=c&&p>=c)return{node:f,offset:c-a};a=p}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=z2(f)}}function V2(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?V2(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function $2(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=jc(a.document);c instanceof a.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)a=c.contentWindow;else break;c=jc(a.document)}return c}function kh(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var o6=Kr&&"documentMode"in document&&11>=document.documentMode,da=null,Mh=null,Uo=null,Ih=!1;function H2(a,c,f){var p=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;Ih||da==null||da!==jc(p)||(p=da,"selectionStart"in p&&kh(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Uo&&Bo(Uo,p)||(Uo=p,p=Cu(Mh,"onSelect"),0<p.length&&(c=new zc("onSelect","select",null,c,f),a.push({event:c,listeners:p}),c.target=da)))}function cs(a,c){var f={};return f[a.toLowerCase()]=c.toLowerCase(),f["Webkit"+a]="webkit"+c,f["Moz"+a]="moz"+c,f}var ha={animationend:cs("Animation","AnimationEnd"),animationiteration:cs("Animation","AnimationIteration"),animationstart:cs("Animation","AnimationStart"),transitionrun:cs("Transition","TransitionRun"),transitionstart:cs("Transition","TransitionStart"),transitioncancel:cs("Transition","TransitionCancel"),transitionend:cs("Transition","TransitionEnd")},Oh={},W2={};Kr&&(W2=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function us(a){if(Oh[a])return Oh[a];if(!ha[a])return a;var c=ha[a],f;for(f in c)if(c.hasOwnProperty(f)&&f in W2)return Oh[a]=c[f];return a}var X2=us("animationend"),Y2=us("animationiteration"),G2=us("animationstart"),l6=us("transitionrun"),c6=us("transitionstart"),u6=us("transitioncancel"),K2=us("transitionend"),Z2=new Map,Ph="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ph.push("scrollEnd");function yr(a,c){Z2.set(a,c),os(c,[a])}var Q2=new WeakMap;function er(a,c){if(typeof a=="object"&&a!==null){var f=Q2.get(a);return f!==void 0?f:(c={value:a,source:c,stack:p2(c)},Q2.set(a,c),c)}return{value:a,source:c,stack:p2(c)}}var tr=[],pa=0,Dh=0;function $c(){for(var a=pa,c=Dh=pa=0;c<a;){var f=tr[c];tr[c++]=null;var p=tr[c];tr[c++]=null;var v=tr[c];tr[c++]=null;var b=tr[c];if(tr[c++]=null,p!==null&&v!==null){var k=p.pending;k===null?v.next=v:(v.next=k.next,k.next=v),p.pending=v}b!==0&&J2(f,v,b)}}function Hc(a,c,f,p){tr[pa++]=a,tr[pa++]=c,tr[pa++]=f,tr[pa++]=p,Dh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function jh(a,c,f,p){return Hc(a,c,f,p),Wc(a)}function ga(a,c){return Hc(a,null,null,c),Wc(a)}function J2(a,c,f){a.lanes|=f;var p=a.alternate;p!==null&&(p.lanes|=f);for(var v=!1,b=a.return;b!==null;)b.childLanes|=f,p=b.alternate,p!==null&&(p.childLanes|=f),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(v=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,v&&c!==null&&(v=31-vt(f),a=b.hiddenUpdates,p=a[v],p===null?a[v]=[c]:p.push(c),c.lane=f|536870912),b):null}function Wc(a){if(50<ul)throw ul=0,qp=null,Error(r(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var ma={};function f6(a,c,f,p){this.tag=a,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bn(a,c,f,p){return new f6(a,c,f,p)}function Lh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Zr(a,c){var f=a.alternate;return f===null?(f=Bn(a.tag,c,a.key,a.mode),f.elementType=a.elementType,f.type=a.type,f.stateNode=a.stateNode,f.alternate=a,a.alternate=f):(f.pendingProps=c,f.type=a.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=a.flags&65011712,f.childLanes=a.childLanes,f.lanes=a.lanes,f.child=a.child,f.memoizedProps=a.memoizedProps,f.memoizedState=a.memoizedState,f.updateQueue=a.updateQueue,c=a.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=a.sibling,f.index=a.index,f.ref=a.ref,f.refCleanup=a.refCleanup,f}function ew(a,c){a.flags&=65011714;var f=a.alternate;return f===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=f.childLanes,a.lanes=f.lanes,a.child=f.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=f.memoizedProps,a.memoizedState=f.memoizedState,a.updateQueue=f.updateQueue,a.type=f.type,c=f.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function Xc(a,c,f,p,v,b){var k=0;if(p=a,typeof a=="function")Lh(a)&&(k=1);else if(typeof a=="string")k=hL(a,f,F.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case P:return a=Bn(31,f,c,v),a.elementType=P,a.lanes=b,a;case T:return fs(f.children,v,b,c);case w:k=8,v|=24;break;case x:return a=Bn(12,f,c,v|2),a.elementType=x,a.lanes=b,a;case C:return a=Bn(13,f,c,v),a.elementType=C,a.lanes=b,a;case I:return a=Bn(19,f,c,v),a.elementType=I,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case S:case R:k=10;break e;case A:k=9;break e;case E:k=11;break e;case O:k=14;break e;case M:k=16,p=null;break e}k=29,f=Error(r(130,a===null?"null":typeof a,"")),p=null}return c=Bn(k,f,c,v),c.elementType=a,c.type=p,c.lanes=b,c}function fs(a,c,f,p){return a=Bn(7,a,p,c),a.lanes=f,a}function Bh(a,c,f){return a=Bn(6,a,null,c),a.lanes=f,a}function Uh(a,c,f){return c=Bn(4,a.children!==null?a.children:[],a.key,c),c.lanes=f,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var _a=[],va=0,Yc=null,Gc=0,nr=[],rr=0,ds=null,Qr=1,Jr="";function hs(a,c){_a[va++]=Gc,_a[va++]=Yc,Yc=a,Gc=c}function tw(a,c,f){nr[rr++]=Qr,nr[rr++]=Jr,nr[rr++]=ds,ds=a;var p=Qr;a=Jr;var v=32-vt(p)-1;p&=~(1<<v),f+=1;var b=32-vt(c)+v;if(30<b){var k=v-v%5;b=(p&(1<<k)-1).toString(32),p>>=k,v-=k,Qr=1<<32-vt(c)+v|f<<v|p,Jr=b+a}else Qr=1<<b|f<<v|p,Jr=a}function Fh(a){a.return!==null&&(hs(a,1),tw(a,1,0))}function zh(a){for(;a===Yc;)Yc=_a[--va],_a[va]=null,Gc=_a[--va],_a[va]=null;for(;a===ds;)ds=nr[--rr],nr[rr]=null,Jr=nr[--rr],nr[rr]=null,Qr=nr[--rr],nr[rr]=null}var wn=null,Ct=null,Ze=!1,ps=null,Or=!1,qh=Error(r(519));function gs(a){var c=Error(r(418,""));throw qo(er(c,a)),qh}function nw(a){var c=a.stateNode,f=a.type,p=a.memoizedProps;switch(c[hn]=a,c[kn]=p,f){case"dialog":He("cancel",c),He("close",c);break;case"iframe":case"object":case"embed":He("load",c);break;case"video":case"audio":for(f=0;f<dl.length;f++)He(dl[f],c);break;case"source":He("error",c);break;case"img":case"image":case"link":He("error",c),He("load",c);break;case"details":He("toggle",c);break;case"input":He("invalid",c),_2(c,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Dc(c);break;case"select":He("invalid",c);break;case"textarea":He("invalid",c),y2(c,p.value,p.defaultValue,p.children),Dc(c)}f=p.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||p.suppressHydrationWarning===!0||y3(c.textContent,f)?(p.popover!=null&&(He("beforetoggle",c),He("toggle",c)),p.onScroll!=null&&He("scroll",c),p.onScrollEnd!=null&&He("scrollend",c),p.onClick!=null&&(c.onclick=Nu),c=!0):c=!1,c||gs(a)}function rw(a){for(wn=a.return;wn;)switch(wn.tag){case 5:case 13:Or=!1;return;case 27:case 3:Or=!0;return;default:wn=wn.return}}function Fo(a){if(a!==wn)return!1;if(!Ze)return rw(a),Ze=!0,!1;var c=a.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=a.type,f=!(f!=="form"&&f!=="button")||ig(a.type,a.memoizedProps)),f=!f),f&&Ct&&gs(a),rw(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(f=a.data,f==="/$"){if(c===0){Ct=xr(a.nextSibling);break e}c--}else f!=="$"&&f!=="$!"&&f!=="$?"||c++;a=a.nextSibling}Ct=null}}else c===27?(c=Ct,Li(a.type)?(a=lg,lg=null,Ct=a):Ct=c):Ct=wn?xr(a.stateNode.nextSibling):null;return!0}function zo(){Ct=wn=null,Ze=!1}function iw(){var a=ps;return a!==null&&(Pn===null?Pn=a:Pn.push.apply(Pn,a),ps=null),a}function qo(a){ps===null?ps=[a]:ps.push(a)}var Vh=G(null),ms=null,ei=null;function wi(a,c,f){ie(Vh,c._currentValue),c._currentValue=f}function ti(a){a._currentValue=Vh.current,oe(Vh)}function $h(a,c,f){for(;a!==null;){var p=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,p!==null&&(p.childLanes|=c)):p!==null&&(p.childLanes&c)!==c&&(p.childLanes|=c),a===f)break;a=a.return}}function Hh(a,c,f,p){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var b=v.dependencies;if(b!==null){var k=v.child;b=b.firstContext;e:for(;b!==null;){var L=b;b=v;for(var K=0;K<c.length;K++)if(L.context===c[K]){b.lanes|=f,L=b.alternate,L!==null&&(L.lanes|=f),$h(b.return,f,a),p||(k=null);break e}b=L.next}}else if(v.tag===18){if(k=v.return,k===null)throw Error(r(341));k.lanes|=f,b=k.alternate,b!==null&&(b.lanes|=f),$h(k,f,a),k=null}else k=v.child;if(k!==null)k.return=v;else for(k=v;k!==null;){if(k===a){k=null;break}if(v=k.sibling,v!==null){v.return=k.return,k=v;break}k=k.return}v=k}}function Vo(a,c,f,p){a=null;for(var v=c,b=!1;v!==null;){if(!b){if((v.flags&524288)!==0)b=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var k=v.alternate;if(k===null)throw Error(r(387));if(k=k.memoizedProps,k!==null){var L=v.type;Ln(v.pendingProps.value,k.value)||(a!==null?a.push(L):a=[L])}}else if(v===ue.current){if(k=v.alternate,k===null)throw Error(r(387));k.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(vl):a=[vl])}v=v.return}a!==null&&Hh(c,a,f,p),c.flags|=262144}function Kc(a){for(a=a.firstContext;a!==null;){if(!Ln(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function _s(a){ms=a,ei=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function pn(a){return sw(ms,a)}function Zc(a,c){return ms===null&&_s(a),sw(a,c)}function sw(a,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},ei===null){if(a===null)throw Error(r(308));ei=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else ei=ei.next=c;return f}var d6=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(f,p){a.push(p)}};this.abort=function(){c.aborted=!0,a.forEach(function(f){return f()})}},h6=t.unstable_scheduleCallback,p6=t.unstable_NormalPriority,Yt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wh(){return{controller:new d6,data:new Map,refCount:0}}function $o(a){a.refCount--,a.refCount===0&&h6(p6,function(){a.controller.abort()})}var Ho=null,Xh=0,ya=0,ba=null;function g6(a,c){if(Ho===null){var f=Ho=[];Xh=0,ya=Gp(),ba={status:"pending",value:void 0,then:function(p){f.push(p)}}}return Xh++,c.then(aw,aw),c}function aw(){if(--Xh===0&&Ho!==null){ba!==null&&(ba.status="fulfilled");var a=Ho;Ho=null,ya=0,ba=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function m6(a,c){var f=[],p={status:"pending",value:null,reason:null,then:function(v){f.push(v)}};return a.then(function(){p.status="fulfilled",p.value=c;for(var v=0;v<f.length;v++)(0,f[v])(c)},function(v){for(p.status="rejected",p.reason=v,v=0;v<f.length;v++)(0,f[v])(void 0)}),p}var ow=q.S;q.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&g6(a,c),ow!==null&&ow(a,c)};var vs=G(null);function Yh(){var a=vs.current;return a!==null?a:gt.pooledCache}function Qc(a,c){c===null?ie(vs,vs.current):ie(vs,c.pool)}function lw(){var a=Yh();return a===null?null:{parent:Yt._currentValue,pool:a}}var Wo=Error(r(460)),cw=Error(r(474)),Jc=Error(r(542)),Gh={then:function(){}};function uw(a){return a=a.status,a==="fulfilled"||a==="rejected"}function eu(){}function fw(a,c,f){switch(f=a[f],f===void 0?a.push(c):f!==c&&(c.then(eu,eu),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,hw(a),a;default:if(typeof c.status=="string")c.then(eu,eu);else{if(a=gt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=c,a.status="pending",a.then(function(p){if(c.status==="pending"){var v=c;v.status="fulfilled",v.value=p}},function(p){if(c.status==="pending"){var v=c;v.status="rejected",v.reason=p}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,hw(a),a}throw Xo=c,Wo}}var Xo=null;function dw(){if(Xo===null)throw Error(r(459));var a=Xo;return Xo=null,a}function hw(a){if(a===Wo||a===Jc)throw Error(r(483))}var Ti=!1;function Kh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Zh(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Si(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ei(a,c,f){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(rt&2)!==0){var v=p.pending;return v===null?c.next=c:(c.next=v.next,v.next=c),p.pending=c,c=Wc(a),J2(a,null,f),c}return Hc(a,p,c,f),Wc(a)}function Yo(a,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,a2(a,f)}}function Qh(a,c){var f=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,f===p)){var v=null,b=null;if(f=f.firstBaseUpdate,f!==null){do{var k={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};b===null?v=b=k:b=b.next=k,f=f.next}while(f!==null);b===null?v=b=c:b=b.next=c}else v=b=c;f={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:p.shared,callbacks:p.callbacks},a.updateQueue=f;return}a=f.lastBaseUpdate,a===null?f.firstBaseUpdate=c:a.next=c,f.lastBaseUpdate=c}var Jh=!1;function Go(){if(Jh){var a=ba;if(a!==null)throw a}}function Ko(a,c,f,p){Jh=!1;var v=a.updateQueue;Ti=!1;var b=v.firstBaseUpdate,k=v.lastBaseUpdate,L=v.shared.pending;if(L!==null){v.shared.pending=null;var K=L,fe=K.next;K.next=null,k===null?b=fe:k.next=fe,k=K;var ge=a.alternate;ge!==null&&(ge=ge.updateQueue,L=ge.lastBaseUpdate,L!==k&&(L===null?ge.firstBaseUpdate=fe:L.next=fe,ge.lastBaseUpdate=K))}if(b!==null){var ve=v.baseState;k=0,ge=fe=K=null,L=b;do{var he=L.lane&-536870913,pe=he!==L.lane;if(pe?(Xe&he)===he:(p&he)===he){he!==0&&he===ya&&(Jh=!0),ge!==null&&(ge=ge.next={lane:0,tag:L.tag,payload:L.payload,callback:null,next:null});e:{var Pe=a,Me=L;he=c;var lt=f;switch(Me.tag){case 1:if(Pe=Me.payload,typeof Pe=="function"){ve=Pe.call(lt,ve,he);break e}ve=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=Me.payload,he=typeof Pe=="function"?Pe.call(lt,ve,he):Pe,he==null)break e;ve=h({},ve,he);break e;case 2:Ti=!0}}he=L.callback,he!==null&&(a.flags|=64,pe&&(a.flags|=8192),pe=v.callbacks,pe===null?v.callbacks=[he]:pe.push(he))}else pe={lane:he,tag:L.tag,payload:L.payload,callback:L.callback,next:null},ge===null?(fe=ge=pe,K=ve):ge=ge.next=pe,k|=he;if(L=L.next,L===null){if(L=v.shared.pending,L===null)break;pe=L,L=pe.next,pe.next=null,v.lastBaseUpdate=pe,v.shared.pending=null}}while(!0);ge===null&&(K=ve),v.baseState=K,v.firstBaseUpdate=fe,v.lastBaseUpdate=ge,b===null&&(v.shared.lanes=0),Oi|=k,a.lanes=k,a.memoizedState=ve}}function pw(a,c){if(typeof a!="function")throw Error(r(191,a));a.call(c)}function gw(a,c){var f=a.callbacks;if(f!==null)for(a.callbacks=null,a=0;a<f.length;a++)pw(f[a],c)}var xa=G(null),tu=G(0);function mw(a,c){a=li,ie(tu,a),ie(xa,c),li=a|c.baseLanes}function ep(){ie(tu,li),ie(xa,xa.current)}function tp(){li=tu.current,oe(xa),oe(tu)}var Ai=0,ze=null,at=null,Ut=null,nu=!1,wa=!1,ys=!1,ru=0,Zo=0,Ta=null,_6=0;function Pt(){throw Error(r(321))}function np(a,c){if(c===null)return!1;for(var f=0;f<c.length&&f<a.length;f++)if(!Ln(a[f],c[f]))return!1;return!0}function rp(a,c,f,p,v,b){return Ai=b,ze=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,q.H=a===null||a.memoizedState===null?Jw:eT,ys=!1,b=f(p,v),ys=!1,wa&&(b=vw(c,f,p,v)),_w(a),b}function _w(a){q.H=cu;var c=at!==null&&at.next!==null;if(Ai=0,Ut=at=ze=null,nu=!1,Zo=0,Ta=null,c)throw Error(r(300));a===null||tn||(a=a.dependencies,a!==null&&Kc(a)&&(tn=!0))}function vw(a,c,f,p){ze=a;var v=0;do{if(wa&&(Ta=null),Zo=0,wa=!1,25<=v)throw Error(r(301));if(v+=1,Ut=at=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}q.H=S6,b=c(f,p)}while(wa);return b}function v6(){var a=q.H,c=a.useState()[0];return c=typeof c.then=="function"?Qo(c):c,a=a.useState()[0],(at!==null?at.memoizedState:null)!==a&&(ze.flags|=1024),c}function ip(){var a=ru!==0;return ru=0,a}function sp(a,c,f){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~f}function ap(a){if(nu){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}nu=!1}Ai=0,Ut=at=ze=null,wa=!1,Zo=ru=0,Ta=null}function In(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?ze.memoizedState=Ut=a:Ut=Ut.next=a,Ut}function Ft(){if(at===null){var a=ze.alternate;a=a!==null?a.memoizedState:null}else a=at.next;var c=Ut===null?ze.memoizedState:Ut.next;if(c!==null)Ut=c,at=a;else{if(a===null)throw ze.alternate===null?Error(r(467)):Error(r(310));at=a,a={memoizedState:at.memoizedState,baseState:at.baseState,baseQueue:at.baseQueue,queue:at.queue,next:null},Ut===null?ze.memoizedState=Ut=a:Ut=Ut.next=a}return Ut}function op(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qo(a){var c=Zo;return Zo+=1,Ta===null&&(Ta=[]),a=fw(Ta,a,c),c=ze,(Ut===null?c.memoizedState:Ut.next)===null&&(c=c.alternate,q.H=c===null||c.memoizedState===null?Jw:eT),a}function iu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Qo(a);if(a.$$typeof===R)return pn(a)}throw Error(r(438,String(a)))}function lp(a){var c=null,f=ze.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var p=ze.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(c={data:p.data.map(function(v){return v.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=op(),ze.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(a),p=0;p<a;p++)f[p]=N;return c.index++,f}function ni(a,c){return typeof c=="function"?c(a):c}function su(a){var c=Ft();return cp(c,at,a)}function cp(a,c,f){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=f;var v=a.baseQueue,b=p.pending;if(b!==null){if(v!==null){var k=v.next;v.next=b.next,b.next=k}c.baseQueue=v=b,p.pending=null}if(b=a.baseState,v===null)a.memoizedState=b;else{c=v.next;var L=k=null,K=null,fe=c,ge=!1;do{var ve=fe.lane&-536870913;if(ve!==fe.lane?(Xe&ve)===ve:(Ai&ve)===ve){var he=fe.revertLane;if(he===0)K!==null&&(K=K.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),ve===ya&&(ge=!0);else if((Ai&he)===he){fe=fe.next,he===ya&&(ge=!0);continue}else ve={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(L=K=ve,k=b):K=K.next=ve,ze.lanes|=he,Oi|=he;ve=fe.action,ys&&f(b,ve),b=fe.hasEagerState?fe.eagerState:f(b,ve)}else he={lane:ve,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},K===null?(L=K=he,k=b):K=K.next=he,ze.lanes|=ve,Oi|=ve;fe=fe.next}while(fe!==null&&fe!==c);if(K===null?k=b:K.next=L,!Ln(b,a.memoizedState)&&(tn=!0,ge&&(f=ba,f!==null)))throw f;a.memoizedState=b,a.baseState=k,a.baseQueue=K,p.lastRenderedState=b}return v===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function up(a){var c=Ft(),f=c.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=a;var p=f.dispatch,v=f.pending,b=c.memoizedState;if(v!==null){f.pending=null;var k=v=v.next;do b=a(b,k.action),k=k.next;while(k!==v);Ln(b,c.memoizedState)||(tn=!0),c.memoizedState=b,c.baseQueue===null&&(c.baseState=b),f.lastRenderedState=b}return[b,p]}function yw(a,c,f){var p=ze,v=Ft(),b=Ze;if(b){if(f===void 0)throw Error(r(407));f=f()}else f=c();var k=!Ln((at||v).memoizedState,f);k&&(v.memoizedState=f,tn=!0),v=v.queue;var L=ww.bind(null,p,v,a);if(Jo(2048,8,L,[a]),v.getSnapshot!==c||k||Ut!==null&&Ut.memoizedState.tag&1){if(p.flags|=2048,Sa(9,au(),xw.bind(null,p,v,f,c),null),gt===null)throw Error(r(349));b||(Ai&124)!==0||bw(p,c,f)}return f}function bw(a,c,f){a.flags|=16384,a={getSnapshot:c,value:f},c=ze.updateQueue,c===null?(c=op(),ze.updateQueue=c,c.stores=[a]):(f=c.stores,f===null?c.stores=[a]:f.push(a))}function xw(a,c,f,p){c.value=f,c.getSnapshot=p,Tw(c)&&Sw(a)}function ww(a,c,f){return f(function(){Tw(c)&&Sw(a)})}function Tw(a){var c=a.getSnapshot;a=a.value;try{var f=c();return!Ln(a,f)}catch{return!0}}function Sw(a){var c=ga(a,2);c!==null&&Vn(c,a,2)}function fp(a){var c=In();if(typeof a=="function"){var f=a;if(a=f(),ys){Ke(!0);try{f()}finally{Ke(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:a},c}function Ew(a,c,f,p){return a.baseState=f,cp(a,at,typeof p=="function"?p:ni)}function y6(a,c,f,p,v){if(lu(a))throw Error(r(485));if(a=c.action,a!==null){var b={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){b.listeners.push(k)}};q.T!==null?f(!0):b.isTransition=!1,p(b),f=c.pending,f===null?(b.next=c.pending=b,Aw(c,b)):(b.next=f.next,c.pending=f.next=b)}}function Aw(a,c){var f=c.action,p=c.payload,v=a.state;if(c.isTransition){var b=q.T,k={};q.T=k;try{var L=f(v,p),K=q.S;K!==null&&K(k,L),Rw(a,c,L)}catch(fe){dp(a,c,fe)}finally{q.T=b}}else try{b=f(v,p),Rw(a,c,b)}catch(fe){dp(a,c,fe)}}function Rw(a,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(p){Cw(a,c,p)},function(p){return dp(a,c,p)}):Cw(a,c,f)}function Cw(a,c,f){c.status="fulfilled",c.value=f,Nw(c),a.state=f,c=a.pending,c!==null&&(f=c.next,f===c?a.pending=null:(f=f.next,c.next=f,Aw(a,f)))}function dp(a,c,f){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do c.status="rejected",c.reason=f,Nw(c),c=c.next;while(c!==p)}a.action=null}function Nw(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function kw(a,c){return c}function Mw(a,c){if(Ze){var f=gt.formState;if(f!==null){e:{var p=ze;if(Ze){if(Ct){t:{for(var v=Ct,b=Or;v.nodeType!==8;){if(!b){v=null;break t}if(v=xr(v.nextSibling),v===null){v=null;break t}}b=v.data,v=b==="F!"||b==="F"?v:null}if(v){Ct=xr(v.nextSibling),p=v.data==="F!";break e}}gs(p)}p=!1}p&&(c=f[0])}}return f=In(),f.memoizedState=f.baseState=c,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kw,lastRenderedState:c},f.queue=p,f=Kw.bind(null,ze,p),p.dispatch=f,p=fp(!1),b=_p.bind(null,ze,!1,p.queue),p=In(),v={state:c,dispatch:null,action:a,pending:null},p.queue=v,f=y6.bind(null,ze,v,b,f),v.dispatch=f,p.memoizedState=a,[c,f,!1]}function Iw(a){var c=Ft();return Ow(c,at,a)}function Ow(a,c,f){if(c=cp(a,c,kw)[0],a=su(ni)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var p=Qo(c)}catch(k){throw k===Wo?Jc:k}else p=c;c=Ft();var v=c.queue,b=v.dispatch;return f!==c.memoizedState&&(ze.flags|=2048,Sa(9,au(),b6.bind(null,v,f),null)),[p,b,a]}function b6(a,c){a.action=c}function Pw(a){var c=Ft(),f=at;if(f!==null)return Ow(c,f,a);Ft(),c=c.memoizedState,f=Ft();var p=f.queue.dispatch;return f.memoizedState=a,[c,p,!1]}function Sa(a,c,f,p){return a={tag:a,create:f,deps:p,inst:c,next:null},c=ze.updateQueue,c===null&&(c=op(),ze.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=a.next=a:(p=f.next,f.next=a,a.next=p,c.lastEffect=a),a}function au(){return{destroy:void 0,resource:void 0}}function Dw(){return Ft().memoizedState}function ou(a,c,f,p){var v=In();p=p===void 0?null:p,ze.flags|=a,v.memoizedState=Sa(1|c,au(),f,p)}function Jo(a,c,f,p){var v=Ft();p=p===void 0?null:p;var b=v.memoizedState.inst;at!==null&&p!==null&&np(p,at.memoizedState.deps)?v.memoizedState=Sa(c,b,f,p):(ze.flags|=a,v.memoizedState=Sa(1|c,b,f,p))}function jw(a,c){ou(8390656,8,a,c)}function Lw(a,c){Jo(2048,8,a,c)}function Bw(a,c){return Jo(4,2,a,c)}function Uw(a,c){return Jo(4,4,a,c)}function Fw(a,c){if(typeof c=="function"){a=a();var f=c(a);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function zw(a,c,f){f=f!=null?f.concat([a]):null,Jo(4,4,Fw.bind(null,c,a),f)}function hp(){}function qw(a,c){var f=Ft();c=c===void 0?null:c;var p=f.memoizedState;return c!==null&&np(c,p[1])?p[0]:(f.memoizedState=[a,c],a)}function Vw(a,c){var f=Ft();c=c===void 0?null:c;var p=f.memoizedState;if(c!==null&&np(c,p[1]))return p[0];if(p=a(),ys){Ke(!0);try{a()}finally{Ke(!1)}}return f.memoizedState=[p,c],p}function pp(a,c,f){return f===void 0||(Ai&1073741824)!==0?a.memoizedState=c:(a.memoizedState=f,a=WT(),ze.lanes|=a,Oi|=a,f)}function $w(a,c,f,p){return Ln(f,c)?f:xa.current!==null?(a=pp(a,f,p),Ln(a,c)||(tn=!0),a):(Ai&42)===0?(tn=!0,a.memoizedState=f):(a=WT(),ze.lanes|=a,Oi|=a,c)}function Hw(a,c,f,p,v){var b=ee.p;ee.p=b!==0&&8>b?b:8;var k=q.T,L={};q.T=L,_p(a,!1,c,f);try{var K=v(),fe=q.S;if(fe!==null&&fe(L,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var ge=m6(K,p);el(a,c,ge,qn(a))}else el(a,c,p,qn(a))}catch(ve){el(a,c,{then:function(){},status:"rejected",reason:ve},qn())}finally{ee.p=b,q.T=k}}function x6(){}function gp(a,c,f,p){if(a.tag!==5)throw Error(r(476));var v=Ww(a).queue;Hw(a,v,c,de,f===null?x6:function(){return Xw(a),f(p)})}function Ww(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:de},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ni,lastRenderedState:f},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function Xw(a){var c=Ww(a).next.queue;el(a,c,{},qn())}function mp(){return pn(vl)}function Yw(){return Ft().memoizedState}function Gw(){return Ft().memoizedState}function w6(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var f=qn();a=Si(f);var p=Ei(c,a,f);p!==null&&(Vn(p,c,f),Yo(p,c,f)),c={cache:Wh()},a.payload=c;return}c=c.return}}function T6(a,c,f){var p=qn();f={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null},lu(a)?Zw(c,f):(f=jh(a,c,f,p),f!==null&&(Vn(f,a,p),Qw(f,c,p)))}function Kw(a,c,f){var p=qn();el(a,c,f,p)}function el(a,c,f,p){var v={lane:p,revertLane:0,action:f,hasEagerState:!1,eagerState:null,next:null};if(lu(a))Zw(c,v);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=c.lastRenderedReducer,b!==null))try{var k=c.lastRenderedState,L=b(k,f);if(v.hasEagerState=!0,v.eagerState=L,Ln(L,k))return Hc(a,c,v,0),gt===null&&$c(),!1}catch{}finally{}if(f=jh(a,c,v,p),f!==null)return Vn(f,a,p),Qw(f,c,p),!0}return!1}function _p(a,c,f,p){if(p={lane:2,revertLane:Gp(),action:p,hasEagerState:!1,eagerState:null,next:null},lu(a)){if(c)throw Error(r(479))}else c=jh(a,f,p,2),c!==null&&Vn(c,a,2)}function lu(a){var c=a.alternate;return a===ze||c!==null&&c===ze}function Zw(a,c){wa=nu=!0;var f=a.pending;f===null?c.next=c:(c.next=f.next,f.next=c),a.pending=c}function Qw(a,c,f){if((f&4194048)!==0){var p=c.lanes;p&=a.pendingLanes,f|=p,c.lanes=f,a2(a,f)}}var cu={readContext:pn,use:iu,useCallback:Pt,useContext:Pt,useEffect:Pt,useImperativeHandle:Pt,useLayoutEffect:Pt,useInsertionEffect:Pt,useMemo:Pt,useReducer:Pt,useRef:Pt,useState:Pt,useDebugValue:Pt,useDeferredValue:Pt,useTransition:Pt,useSyncExternalStore:Pt,useId:Pt,useHostTransitionStatus:Pt,useFormState:Pt,useActionState:Pt,useOptimistic:Pt,useMemoCache:Pt,useCacheRefresh:Pt},Jw={readContext:pn,use:iu,useCallback:function(a,c){return In().memoizedState=[a,c===void 0?null:c],a},useContext:pn,useEffect:jw,useImperativeHandle:function(a,c,f){f=f!=null?f.concat([a]):null,ou(4194308,4,Fw.bind(null,c,a),f)},useLayoutEffect:function(a,c){return ou(4194308,4,a,c)},useInsertionEffect:function(a,c){ou(4,2,a,c)},useMemo:function(a,c){var f=In();c=c===void 0?null:c;var p=a();if(ys){Ke(!0);try{a()}finally{Ke(!1)}}return f.memoizedState=[p,c],p},useReducer:function(a,c,f){var p=In();if(f!==void 0){var v=f(c);if(ys){Ke(!0);try{f(c)}finally{Ke(!1)}}}else v=c;return p.memoizedState=p.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},p.queue=a,a=a.dispatch=T6.bind(null,ze,a),[p.memoizedState,a]},useRef:function(a){var c=In();return a={current:a},c.memoizedState=a},useState:function(a){a=fp(a);var c=a.queue,f=Kw.bind(null,ze,c);return c.dispatch=f,[a.memoizedState,f]},useDebugValue:hp,useDeferredValue:function(a,c){var f=In();return pp(f,a,c)},useTransition:function(){var a=fp(!1);return a=Hw.bind(null,ze,a.queue,!0,!1),In().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,f){var p=ze,v=In();if(Ze){if(f===void 0)throw Error(r(407));f=f()}else{if(f=c(),gt===null)throw Error(r(349));(Xe&124)!==0||bw(p,c,f)}v.memoizedState=f;var b={value:f,getSnapshot:c};return v.queue=b,jw(ww.bind(null,p,b,a),[a]),p.flags|=2048,Sa(9,au(),xw.bind(null,p,b,f,c),null),f},useId:function(){var a=In(),c=gt.identifierPrefix;if(Ze){var f=Jr,p=Qr;f=(p&~(1<<32-vt(p)-1)).toString(32)+f,c=""+c+"R"+f,f=ru++,0<f&&(c+="H"+f.toString(32)),c+=""}else f=_6++,c=""+c+"r"+f.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:mp,useFormState:Mw,useActionState:Mw,useOptimistic:function(a){var c=In();c.memoizedState=c.baseState=a;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=_p.bind(null,ze,!0,f),f.dispatch=c,[a,c]},useMemoCache:lp,useCacheRefresh:function(){return In().memoizedState=w6.bind(null,ze)}},eT={readContext:pn,use:iu,useCallback:qw,useContext:pn,useEffect:Lw,useImperativeHandle:zw,useInsertionEffect:Bw,useLayoutEffect:Uw,useMemo:Vw,useReducer:su,useRef:Dw,useState:function(){return su(ni)},useDebugValue:hp,useDeferredValue:function(a,c){var f=Ft();return $w(f,at.memoizedState,a,c)},useTransition:function(){var a=su(ni)[0],c=Ft().memoizedState;return[typeof a=="boolean"?a:Qo(a),c]},useSyncExternalStore:yw,useId:Yw,useHostTransitionStatus:mp,useFormState:Iw,useActionState:Iw,useOptimistic:function(a,c){var f=Ft();return Ew(f,at,a,c)},useMemoCache:lp,useCacheRefresh:Gw},S6={readContext:pn,use:iu,useCallback:qw,useContext:pn,useEffect:Lw,useImperativeHandle:zw,useInsertionEffect:Bw,useLayoutEffect:Uw,useMemo:Vw,useReducer:up,useRef:Dw,useState:function(){return up(ni)},useDebugValue:hp,useDeferredValue:function(a,c){var f=Ft();return at===null?pp(f,a,c):$w(f,at.memoizedState,a,c)},useTransition:function(){var a=up(ni)[0],c=Ft().memoizedState;return[typeof a=="boolean"?a:Qo(a),c]},useSyncExternalStore:yw,useId:Yw,useHostTransitionStatus:mp,useFormState:Pw,useActionState:Pw,useOptimistic:function(a,c){var f=Ft();return at!==null?Ew(f,at,a,c):(f.baseState=a,[a,f.queue.dispatch])},useMemoCache:lp,useCacheRefresh:Gw},Ea=null,tl=0;function uu(a){var c=tl;return tl+=1,Ea===null&&(Ea=[]),fw(Ea,a,c)}function nl(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function fu(a,c){throw c.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(c),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function tT(a){var c=a._init;return c(a._payload)}function nT(a){function c(se,J){if(a){var ce=se.deletions;ce===null?(se.deletions=[J],se.flags|=16):ce.push(J)}}function f(se,J){if(!a)return null;for(;J!==null;)c(se,J),J=J.sibling;return null}function p(se){for(var J=new Map;se!==null;)se.key!==null?J.set(se.key,se):J.set(se.index,se),se=se.sibling;return J}function v(se,J){return se=Zr(se,J),se.index=0,se.sibling=null,se}function b(se,J,ce){return se.index=ce,a?(ce=se.alternate,ce!==null?(ce=ce.index,ce<J?(se.flags|=67108866,J):ce):(se.flags|=67108866,J)):(se.flags|=1048576,J)}function k(se){return a&&se.alternate===null&&(se.flags|=67108866),se}function L(se,J,ce,me){return J===null||J.tag!==6?(J=Bh(ce,se.mode,me),J.return=se,J):(J=v(J,ce),J.return=se,J)}function K(se,J,ce,me){var Ae=ce.type;return Ae===T?ge(se,J,ce.props.children,me,ce.key):J!==null&&(J.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===M&&tT(Ae)===J.type)?(J=v(J,ce.props),nl(J,ce),J.return=se,J):(J=Xc(ce.type,ce.key,ce.props,null,se.mode,me),nl(J,ce),J.return=se,J)}function fe(se,J,ce,me){return J===null||J.tag!==4||J.stateNode.containerInfo!==ce.containerInfo||J.stateNode.implementation!==ce.implementation?(J=Uh(ce,se.mode,me),J.return=se,J):(J=v(J,ce.children||[]),J.return=se,J)}function ge(se,J,ce,me,Ae){return J===null||J.tag!==7?(J=fs(ce,se.mode,me,Ae),J.return=se,J):(J=v(J,ce),J.return=se,J)}function ve(se,J,ce){if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return J=Bh(""+J,se.mode,ce),J.return=se,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case _:return ce=Xc(J.type,J.key,J.props,null,se.mode,ce),nl(ce,J),ce.return=se,ce;case y:return J=Uh(J,se.mode,ce),J.return=se,J;case M:var me=J._init;return J=me(J._payload),ve(se,J,ce)}if(W(J)||z(J))return J=fs(J,se.mode,ce,null),J.return=se,J;if(typeof J.then=="function")return ve(se,uu(J),ce);if(J.$$typeof===R)return ve(se,Zc(se,J),ce);fu(se,J)}return null}function he(se,J,ce,me){var Ae=J!==null?J.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return Ae!==null?null:L(se,J,""+ce,me);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:return ce.key===Ae?K(se,J,ce,me):null;case y:return ce.key===Ae?fe(se,J,ce,me):null;case M:return Ae=ce._init,ce=Ae(ce._payload),he(se,J,ce,me)}if(W(ce)||z(ce))return Ae!==null?null:ge(se,J,ce,me,null);if(typeof ce.then=="function")return he(se,J,uu(ce),me);if(ce.$$typeof===R)return he(se,J,Zc(se,ce),me);fu(se,ce)}return null}function pe(se,J,ce,me,Ae){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return se=se.get(ce)||null,L(J,se,""+me,Ae);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case _:return se=se.get(me.key===null?ce:me.key)||null,K(J,se,me,Ae);case y:return se=se.get(me.key===null?ce:me.key)||null,fe(J,se,me,Ae);case M:var qe=me._init;return me=qe(me._payload),pe(se,J,ce,me,Ae)}if(W(me)||z(me))return se=se.get(ce)||null,ge(J,se,me,Ae,null);if(typeof me.then=="function")return pe(se,J,ce,uu(me),Ae);if(me.$$typeof===R)return pe(se,J,ce,Zc(J,me),Ae);fu(J,me)}return null}function Pe(se,J,ce,me){for(var Ae=null,qe=null,Ce=J,Ie=J=0,rn=null;Ce!==null&&Ie<ce.length;Ie++){Ce.index>Ie?(rn=Ce,Ce=null):rn=Ce.sibling;var Ge=he(se,Ce,ce[Ie],me);if(Ge===null){Ce===null&&(Ce=rn);break}a&&Ce&&Ge.alternate===null&&c(se,Ce),J=b(Ge,J,Ie),qe===null?Ae=Ge:qe.sibling=Ge,qe=Ge,Ce=rn}if(Ie===ce.length)return f(se,Ce),Ze&&hs(se,Ie),Ae;if(Ce===null){for(;Ie<ce.length;Ie++)Ce=ve(se,ce[Ie],me),Ce!==null&&(J=b(Ce,J,Ie),qe===null?Ae=Ce:qe.sibling=Ce,qe=Ce);return Ze&&hs(se,Ie),Ae}for(Ce=p(Ce);Ie<ce.length;Ie++)rn=pe(Ce,se,Ie,ce[Ie],me),rn!==null&&(a&&rn.alternate!==null&&Ce.delete(rn.key===null?Ie:rn.key),J=b(rn,J,Ie),qe===null?Ae=rn:qe.sibling=rn,qe=rn);return a&&Ce.forEach(function(qi){return c(se,qi)}),Ze&&hs(se,Ie),Ae}function Me(se,J,ce,me){if(ce==null)throw Error(r(151));for(var Ae=null,qe=null,Ce=J,Ie=J=0,rn=null,Ge=ce.next();Ce!==null&&!Ge.done;Ie++,Ge=ce.next()){Ce.index>Ie?(rn=Ce,Ce=null):rn=Ce.sibling;var qi=he(se,Ce,Ge.value,me);if(qi===null){Ce===null&&(Ce=rn);break}a&&Ce&&qi.alternate===null&&c(se,Ce),J=b(qi,J,Ie),qe===null?Ae=qi:qe.sibling=qi,qe=qi,Ce=rn}if(Ge.done)return f(se,Ce),Ze&&hs(se,Ie),Ae;if(Ce===null){for(;!Ge.done;Ie++,Ge=ce.next())Ge=ve(se,Ge.value,me),Ge!==null&&(J=b(Ge,J,Ie),qe===null?Ae=Ge:qe.sibling=Ge,qe=Ge);return Ze&&hs(se,Ie),Ae}for(Ce=p(Ce);!Ge.done;Ie++,Ge=ce.next())Ge=pe(Ce,se,Ie,Ge.value,me),Ge!==null&&(a&&Ge.alternate!==null&&Ce.delete(Ge.key===null?Ie:Ge.key),J=b(Ge,J,Ie),qe===null?Ae=Ge:qe.sibling=Ge,qe=Ge);return a&&Ce.forEach(function(EL){return c(se,EL)}),Ze&&hs(se,Ie),Ae}function lt(se,J,ce,me){if(typeof ce=="object"&&ce!==null&&ce.type===T&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case _:e:{for(var Ae=ce.key;J!==null;){if(J.key===Ae){if(Ae=ce.type,Ae===T){if(J.tag===7){f(se,J.sibling),me=v(J,ce.props.children),me.return=se,se=me;break e}}else if(J.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===M&&tT(Ae)===J.type){f(se,J.sibling),me=v(J,ce.props),nl(me,ce),me.return=se,se=me;break e}f(se,J);break}else c(se,J);J=J.sibling}ce.type===T?(me=fs(ce.props.children,se.mode,me,ce.key),me.return=se,se=me):(me=Xc(ce.type,ce.key,ce.props,null,se.mode,me),nl(me,ce),me.return=se,se=me)}return k(se);case y:e:{for(Ae=ce.key;J!==null;){if(J.key===Ae)if(J.tag===4&&J.stateNode.containerInfo===ce.containerInfo&&J.stateNode.implementation===ce.implementation){f(se,J.sibling),me=v(J,ce.children||[]),me.return=se,se=me;break e}else{f(se,J);break}else c(se,J);J=J.sibling}me=Uh(ce,se.mode,me),me.return=se,se=me}return k(se);case M:return Ae=ce._init,ce=Ae(ce._payload),lt(se,J,ce,me)}if(W(ce))return Pe(se,J,ce,me);if(z(ce)){if(Ae=z(ce),typeof Ae!="function")throw Error(r(150));return ce=Ae.call(ce),Me(se,J,ce,me)}if(typeof ce.then=="function")return lt(se,J,uu(ce),me);if(ce.$$typeof===R)return lt(se,J,Zc(se,ce),me);fu(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,J!==null&&J.tag===6?(f(se,J.sibling),me=v(J,ce),me.return=se,se=me):(f(se,J),me=Bh(ce,se.mode,me),me.return=se,se=me),k(se)):f(se,J)}return function(se,J,ce,me){try{tl=0;var Ae=lt(se,J,ce,me);return Ea=null,Ae}catch(Ce){if(Ce===Wo||Ce===Jc)throw Ce;var qe=Bn(29,Ce,null,se.mode);return qe.lanes=me,qe.return=se,qe}finally{}}}var Aa=nT(!0),rT=nT(!1),ir=G(null),Pr=null;function Ri(a){var c=a.alternate;ie(Gt,Gt.current&1),ie(ir,a),Pr===null&&(c===null||xa.current!==null||c.memoizedState!==null)&&(Pr=a)}function iT(a){if(a.tag===22){if(ie(Gt,Gt.current),ie(ir,a),Pr===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&(Pr=a)}}else Ci()}function Ci(){ie(Gt,Gt.current),ie(ir,ir.current)}function ri(a){oe(ir),Pr===a&&(Pr=null),oe(Gt)}var Gt=G(0);function du(a){for(var c=a;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||og(f)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function vp(a,c,f,p){c=a.memoizedState,f=f(p,c),f=f==null?c:h({},c,f),a.memoizedState=f,a.lanes===0&&(a.updateQueue.baseState=f)}var yp={enqueueSetState:function(a,c,f){a=a._reactInternals;var p=qn(),v=Si(p);v.payload=c,f!=null&&(v.callback=f),c=Ei(a,v,p),c!==null&&(Vn(c,a,p),Yo(c,a,p))},enqueueReplaceState:function(a,c,f){a=a._reactInternals;var p=qn(),v=Si(p);v.tag=1,v.payload=c,f!=null&&(v.callback=f),c=Ei(a,v,p),c!==null&&(Vn(c,a,p),Yo(c,a,p))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var f=qn(),p=Si(f);p.tag=2,c!=null&&(p.callback=c),c=Ei(a,p,f),c!==null&&(Vn(c,a,f),Yo(c,a,f))}};function sT(a,c,f,p,v,b,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,b,k):c.prototype&&c.prototype.isPureReactComponent?!Bo(f,p)||!Bo(v,b):!0}function aT(a,c,f,p){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,p),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,p),c.state!==a&&yp.enqueueReplaceState(c,c.state,null)}function bs(a,c){var f=c;if("ref"in c){f={};for(var p in c)p!=="ref"&&(f[p]=c[p])}if(a=a.defaultProps){f===c&&(f=h({},f));for(var v in a)f[v]===void 0&&(f[v]=a[v])}return f}var hu=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function oT(a){hu(a)}function lT(a){console.error(a)}function cT(a){hu(a)}function pu(a,c){try{var f=a.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(p){setTimeout(function(){throw p})}}function uT(a,c,f){try{var p=a.onCaughtError;p(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function bp(a,c,f){return f=Si(f),f.tag=3,f.payload={element:null},f.callback=function(){pu(a,c)},f}function fT(a){return a=Si(a),a.tag=3,a}function dT(a,c,f,p){var v=f.type.getDerivedStateFromError;if(typeof v=="function"){var b=p.value;a.payload=function(){return v(b)},a.callback=function(){uT(c,f,p)}}var k=f.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(a.callback=function(){uT(c,f,p),typeof v!="function"&&(Pi===null?Pi=new Set([this]):Pi.add(this));var L=p.stack;this.componentDidCatch(p.value,{componentStack:L!==null?L:""})})}function E6(a,c,f,p,v){if(f.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(c=f.alternate,c!==null&&Vo(c,f,v,!0),f=ir.current,f!==null){switch(f.tag){case 13:return Pr===null?$p():f.alternate===null&&Nt===0&&(Nt=3),f.flags&=-257,f.flags|=65536,f.lanes=v,p===Gh?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([p]):c.add(p),Wp(a,p,v)),!1;case 22:return f.flags|=65536,p===Gh?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([p])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([p]):f.add(p)),Wp(a,p,v)),!1}throw Error(r(435,f.tag))}return Wp(a,p,v),$p(),!1}if(Ze)return c=ir.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=v,p!==qh&&(a=Error(r(422),{cause:p}),qo(er(a,f)))):(p!==qh&&(c=Error(r(423),{cause:p}),qo(er(c,f))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,p=er(p,f),v=bp(a.stateNode,p,v),Qh(a,v),Nt!==4&&(Nt=2)),!1;var b=Error(r(520),{cause:p});if(b=er(b,f),cl===null?cl=[b]:cl.push(b),Nt!==4&&(Nt=2),c===null)return!0;p=er(p,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,a=v&-v,f.lanes|=a,a=bp(f.stateNode,p,a),Qh(f,a),!1;case 1:if(c=f.type,b=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Pi===null||!Pi.has(b))))return f.flags|=65536,v&=-v,f.lanes|=v,v=fT(v),dT(v,a,f,p),Qh(f,v),!1}f=f.return}while(f!==null);return!1}var hT=Error(r(461)),tn=!1;function an(a,c,f,p){c.child=a===null?rT(c,null,f,p):Aa(c,a.child,f,p)}function pT(a,c,f,p,v){f=f.render;var b=c.ref;if("ref"in p){var k={};for(var L in p)L!=="ref"&&(k[L]=p[L])}else k=p;return _s(c),p=rp(a,c,f,k,b,v),L=ip(),a!==null&&!tn?(sp(a,c,v),ii(a,c,v)):(Ze&&L&&Fh(c),c.flags|=1,an(a,c,p,v),c.child)}function gT(a,c,f,p,v){if(a===null){var b=f.type;return typeof b=="function"&&!Lh(b)&&b.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=b,mT(a,c,b,p,v)):(a=Xc(f.type,null,p,c,c.mode,v),a.ref=c.ref,a.return=c,c.child=a)}if(b=a.child,!Cp(a,v)){var k=b.memoizedProps;if(f=f.compare,f=f!==null?f:Bo,f(k,p)&&a.ref===c.ref)return ii(a,c,v)}return c.flags|=1,a=Zr(b,p),a.ref=c.ref,a.return=c,c.child=a}function mT(a,c,f,p,v){if(a!==null){var b=a.memoizedProps;if(Bo(b,p)&&a.ref===c.ref)if(tn=!1,c.pendingProps=p=b,Cp(a,v))(a.flags&131072)!==0&&(tn=!0);else return c.lanes=a.lanes,ii(a,c,v)}return xp(a,c,f,p,v)}function _T(a,c,f){var p=c.pendingProps,v=p.children,b=a!==null?a.memoizedState:null;if(p.mode==="hidden"){if((c.flags&128)!==0){if(p=b!==null?b.baseLanes|f:f,a!==null){for(v=c.child=a.child,b=0;v!==null;)b=b|v.lanes|v.childLanes,v=v.sibling;c.childLanes=b&~p}else c.childLanes=0,c.child=null;return vT(a,c,p,f)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&Qc(c,b!==null?b.cachePool:null),b!==null?mw(c,b):ep(),iT(c);else return c.lanes=c.childLanes=536870912,vT(a,c,b!==null?b.baseLanes|f:f,f)}else b!==null?(Qc(c,b.cachePool),mw(c,b),Ci(),c.memoizedState=null):(a!==null&&Qc(c,null),ep(),Ci());return an(a,c,v,f),c.child}function vT(a,c,f,p){var v=Yh();return v=v===null?null:{parent:Yt._currentValue,pool:v},c.memoizedState={baseLanes:f,cachePool:v},a!==null&&Qc(c,null),ep(),iT(c),a!==null&&Vo(a,c,p,!0),null}function gu(a,c){var f=c.ref;if(f===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(r(284));(a===null||a.ref!==f)&&(c.flags|=4194816)}}function xp(a,c,f,p,v){return _s(c),f=rp(a,c,f,p,void 0,v),p=ip(),a!==null&&!tn?(sp(a,c,v),ii(a,c,v)):(Ze&&p&&Fh(c),c.flags|=1,an(a,c,f,v),c.child)}function yT(a,c,f,p,v,b){return _s(c),c.updateQueue=null,f=vw(c,p,f,v),_w(a),p=ip(),a!==null&&!tn?(sp(a,c,b),ii(a,c,b)):(Ze&&p&&Fh(c),c.flags|=1,an(a,c,f,b),c.child)}function bT(a,c,f,p,v){if(_s(c),c.stateNode===null){var b=ma,k=f.contextType;typeof k=="object"&&k!==null&&(b=pn(k)),b=new f(p,b),c.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=yp,c.stateNode=b,b._reactInternals=c,b=c.stateNode,b.props=p,b.state=c.memoizedState,b.refs={},Kh(c),k=f.contextType,b.context=typeof k=="object"&&k!==null?pn(k):ma,b.state=c.memoizedState,k=f.getDerivedStateFromProps,typeof k=="function"&&(vp(c,f,k,p),b.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(k=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),k!==b.state&&yp.enqueueReplaceState(b,b.state,null),Ko(c,p,b,v),Go(),b.state=c.memoizedState),typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!0}else if(a===null){b=c.stateNode;var L=c.memoizedProps,K=bs(f,L);b.props=K;var fe=b.context,ge=f.contextType;k=ma,typeof ge=="object"&&ge!==null&&(k=pn(ge));var ve=f.getDerivedStateFromProps;ge=typeof ve=="function"||typeof b.getSnapshotBeforeUpdate=="function",L=c.pendingProps!==L,ge||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(L||fe!==k)&&aT(c,b,p,k),Ti=!1;var he=c.memoizedState;b.state=he,Ko(c,p,b,v),Go(),fe=c.memoizedState,L||he!==fe||Ti?(typeof ve=="function"&&(vp(c,f,ve,p),fe=c.memoizedState),(K=Ti||sT(c,f,K,p,he,fe,k))?(ge||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(c.flags|=4194308)):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=p,c.memoizedState=fe),b.props=p,b.state=fe,b.context=k,p=K):(typeof b.componentDidMount=="function"&&(c.flags|=4194308),p=!1)}else{b=c.stateNode,Zh(a,c),k=c.memoizedProps,ge=bs(f,k),b.props=ge,ve=c.pendingProps,he=b.context,fe=f.contextType,K=ma,typeof fe=="object"&&fe!==null&&(K=pn(fe)),L=f.getDerivedStateFromProps,(fe=typeof L=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(k!==ve||he!==K)&&aT(c,b,p,K),Ti=!1,he=c.memoizedState,b.state=he,Ko(c,p,b,v),Go();var pe=c.memoizedState;k!==ve||he!==pe||Ti||a!==null&&a.dependencies!==null&&Kc(a.dependencies)?(typeof L=="function"&&(vp(c,f,L,p),pe=c.memoizedState),(ge=Ti||sT(c,f,ge,p,he,pe,K)||a!==null&&a.dependencies!==null&&Kc(a.dependencies))?(fe||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(p,pe,K),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(p,pe,K)),typeof b.componentDidUpdate=="function"&&(c.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof b.componentDidUpdate!="function"||k===a.memoizedProps&&he===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&he===a.memoizedState||(c.flags|=1024),c.memoizedProps=p,c.memoizedState=pe),b.props=p,b.state=pe,b.context=K,p=ge):(typeof b.componentDidUpdate!="function"||k===a.memoizedProps&&he===a.memoizedState||(c.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&he===a.memoizedState||(c.flags|=1024),p=!1)}return b=p,gu(a,c),p=(c.flags&128)!==0,b||p?(b=c.stateNode,f=p&&typeof f.getDerivedStateFromError!="function"?null:b.render(),c.flags|=1,a!==null&&p?(c.child=Aa(c,a.child,null,v),c.child=Aa(c,null,f,v)):an(a,c,f,v),c.memoizedState=b.state,a=c.child):a=ii(a,c,v),a}function xT(a,c,f,p){return zo(),c.flags|=256,an(a,c,f,p),c.child}var wp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Tp(a){return{baseLanes:a,cachePool:lw()}}function Sp(a,c,f){return a=a!==null?a.childLanes&~f:0,c&&(a|=sr),a}function wT(a,c,f){var p=c.pendingProps,v=!1,b=(c.flags&128)!==0,k;if((k=b)||(k=a!==null&&a.memoizedState===null?!1:(Gt.current&2)!==0),k&&(v=!0,c.flags&=-129),k=(c.flags&32)!==0,c.flags&=-33,a===null){if(Ze){if(v?Ri(c):Ci(),Ze){var L=Ct,K;if(K=L){e:{for(K=L,L=Or;K.nodeType!==8;){if(!L){L=null;break e}if(K=xr(K.nextSibling),K===null){L=null;break e}}L=K}L!==null?(c.memoizedState={dehydrated:L,treeContext:ds!==null?{id:Qr,overflow:Jr}:null,retryLane:536870912,hydrationErrors:null},K=Bn(18,null,null,0),K.stateNode=L,K.return=c,c.child=K,wn=c,Ct=null,K=!0):K=!1}K||gs(c)}if(L=c.memoizedState,L!==null&&(L=L.dehydrated,L!==null))return og(L)?c.lanes=32:c.lanes=536870912,null;ri(c)}return L=p.children,p=p.fallback,v?(Ci(),v=c.mode,L=mu({mode:"hidden",children:L},v),p=fs(p,v,f,null),L.return=c,p.return=c,L.sibling=p,c.child=L,v=c.child,v.memoizedState=Tp(f),v.childLanes=Sp(a,k,f),c.memoizedState=wp,p):(Ri(c),Ep(c,L))}if(K=a.memoizedState,K!==null&&(L=K.dehydrated,L!==null)){if(b)c.flags&256?(Ri(c),c.flags&=-257,c=Ap(a,c,f)):c.memoizedState!==null?(Ci(),c.child=a.child,c.flags|=128,c=null):(Ci(),v=p.fallback,L=c.mode,p=mu({mode:"visible",children:p.children},L),v=fs(v,L,f,null),v.flags|=2,p.return=c,v.return=c,p.sibling=v,c.child=p,Aa(c,a.child,null,f),p=c.child,p.memoizedState=Tp(f),p.childLanes=Sp(a,k,f),c.memoizedState=wp,c=v);else if(Ri(c),og(L)){if(k=L.nextSibling&&L.nextSibling.dataset,k)var fe=k.dgst;k=fe,p=Error(r(419)),p.stack="",p.digest=k,qo({value:p,source:null,stack:null}),c=Ap(a,c,f)}else if(tn||Vo(a,c,f,!1),k=(f&a.childLanes)!==0,tn||k){if(k=gt,k!==null&&(p=f&-f,p=(p&42)!==0?1:lh(p),p=(p&(k.suspendedLanes|f))!==0?0:p,p!==0&&p!==K.retryLane))throw K.retryLane=p,ga(a,p),Vn(k,a,p),hT;L.data==="$?"||$p(),c=Ap(a,c,f)}else L.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=K.treeContext,Ct=xr(L.nextSibling),wn=c,Ze=!0,ps=null,Or=!1,a!==null&&(nr[rr++]=Qr,nr[rr++]=Jr,nr[rr++]=ds,Qr=a.id,Jr=a.overflow,ds=c),c=Ep(c,p.children),c.flags|=4096);return c}return v?(Ci(),v=p.fallback,L=c.mode,K=a.child,fe=K.sibling,p=Zr(K,{mode:"hidden",children:p.children}),p.subtreeFlags=K.subtreeFlags&65011712,fe!==null?v=Zr(fe,v):(v=fs(v,L,f,null),v.flags|=2),v.return=c,p.return=c,p.sibling=v,c.child=p,p=v,v=c.child,L=a.child.memoizedState,L===null?L=Tp(f):(K=L.cachePool,K!==null?(fe=Yt._currentValue,K=K.parent!==fe?{parent:fe,pool:fe}:K):K=lw(),L={baseLanes:L.baseLanes|f,cachePool:K}),v.memoizedState=L,v.childLanes=Sp(a,k,f),c.memoizedState=wp,p):(Ri(c),f=a.child,a=f.sibling,f=Zr(f,{mode:"visible",children:p.children}),f.return=c,f.sibling=null,a!==null&&(k=c.deletions,k===null?(c.deletions=[a],c.flags|=16):k.push(a)),c.child=f,c.memoizedState=null,f)}function Ep(a,c){return c=mu({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function mu(a,c){return a=Bn(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Ap(a,c,f){return Aa(c,a.child,null,f),a=Ep(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function TT(a,c,f){a.lanes|=c;var p=a.alternate;p!==null&&(p.lanes|=c),$h(a.return,c,f)}function Rp(a,c,f,p,v){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:p,tail:f,tailMode:v}:(b.isBackwards=c,b.rendering=null,b.renderingStartTime=0,b.last=p,b.tail=f,b.tailMode=v)}function ST(a,c,f){var p=c.pendingProps,v=p.revealOrder,b=p.tail;if(an(a,c,p.children,f),p=Gt.current,(p&2)!==0)p=p&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&TT(a,f,c);else if(a.tag===19)TT(a,f,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}p&=1}switch(ie(Gt,p),v){case"forwards":for(f=c.child,v=null;f!==null;)a=f.alternate,a!==null&&du(a)===null&&(v=f),f=f.sibling;f=v,f===null?(v=c.child,c.child=null):(v=f.sibling,f.sibling=null),Rp(c,!1,v,f,b);break;case"backwards":for(f=null,v=c.child,c.child=null;v!==null;){if(a=v.alternate,a!==null&&du(a)===null){c.child=v;break}a=v.sibling,v.sibling=f,f=v,v=a}Rp(c,!0,f,null,b);break;case"together":Rp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function ii(a,c,f){if(a!==null&&(c.dependencies=a.dependencies),Oi|=c.lanes,(f&c.childLanes)===0)if(a!==null){if(Vo(a,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(r(153));if(c.child!==null){for(a=c.child,f=Zr(a,a.pendingProps),c.child=f,f.return=c;a.sibling!==null;)a=a.sibling,f=f.sibling=Zr(a,a.pendingProps),f.return=c;f.sibling=null}return c.child}function Cp(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&Kc(a)))}function A6(a,c,f){switch(c.tag){case 3:ye(c,c.stateNode.containerInfo),wi(c,Yt,a.memoizedState.cache),zo();break;case 27:case 5:ke(c);break;case 4:ye(c,c.stateNode.containerInfo);break;case 10:wi(c,c.type,c.memoizedProps.value);break;case 13:var p=c.memoizedState;if(p!==null)return p.dehydrated!==null?(Ri(c),c.flags|=128,null):(f&c.child.childLanes)!==0?wT(a,c,f):(Ri(c),a=ii(a,c,f),a!==null?a.sibling:null);Ri(c);break;case 19:var v=(a.flags&128)!==0;if(p=(f&c.childLanes)!==0,p||(Vo(a,c,f,!1),p=(f&c.childLanes)!==0),v){if(p)return ST(a,c,f);c.flags|=128}if(v=c.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),ie(Gt,Gt.current),p)break;return null;case 22:case 23:return c.lanes=0,_T(a,c,f);case 24:wi(c,Yt,a.memoizedState.cache)}return ii(a,c,f)}function ET(a,c,f){if(a!==null)if(a.memoizedProps!==c.pendingProps)tn=!0;else{if(!Cp(a,f)&&(c.flags&128)===0)return tn=!1,A6(a,c,f);tn=(a.flags&131072)!==0}else tn=!1,Ze&&(c.flags&1048576)!==0&&tw(c,Gc,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var p=c.elementType,v=p._init;if(p=v(p._payload),c.type=p,typeof p=="function")Lh(p)?(a=bs(p,a),c.tag=1,c=bT(null,c,p,a,f)):(c.tag=0,c=xp(null,c,p,a,f));else{if(p!=null){if(v=p.$$typeof,v===E){c.tag=11,c=pT(null,c,p,a,f);break e}else if(v===O){c.tag=14,c=gT(null,c,p,a,f);break e}}throw c=H(p)||p,Error(r(306,c,""))}}return c;case 0:return xp(a,c,c.type,c.pendingProps,f);case 1:return p=c.type,v=bs(p,c.pendingProps),bT(a,c,p,v,f);case 3:e:{if(ye(c,c.stateNode.containerInfo),a===null)throw Error(r(387));p=c.pendingProps;var b=c.memoizedState;v=b.element,Zh(a,c),Ko(c,p,null,f);var k=c.memoizedState;if(p=k.cache,wi(c,Yt,p),p!==b.cache&&Hh(c,[Yt],f,!0),Go(),p=k.element,b.isDehydrated)if(b={element:p,isDehydrated:!1,cache:k.cache},c.updateQueue.baseState=b,c.memoizedState=b,c.flags&256){c=xT(a,c,p,f);break e}else if(p!==v){v=er(Error(r(424)),c),qo(v),c=xT(a,c,p,f);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Ct=xr(a.firstChild),wn=c,Ze=!0,ps=null,Or=!0,f=rT(c,null,p,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling}else{if(zo(),p===v){c=ii(a,c,f);break e}an(a,c,p,f)}c=c.child}return c;case 26:return gu(a,c),a===null?(f=N3(c.type,null,c.pendingProps,null))?c.memoizedState=f:Ze||(f=c.type,a=c.pendingProps,p=ku(Y.current).createElement(f),p[hn]=c,p[kn]=a,ln(p,f,a),en(p),c.stateNode=p):c.memoizedState=N3(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return ke(c),a===null&&Ze&&(p=c.stateNode=A3(c.type,c.pendingProps,Y.current),wn=c,Or=!0,v=Ct,Li(c.type)?(lg=v,Ct=xr(p.firstChild)):Ct=v),an(a,c,c.pendingProps.children,f),gu(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Ze&&((v=p=Ct)&&(p=eL(p,c.type,c.pendingProps,Or),p!==null?(c.stateNode=p,wn=c,Ct=xr(p.firstChild),Or=!1,v=!0):v=!1),v||gs(c)),ke(c),v=c.type,b=c.pendingProps,k=a!==null?a.memoizedProps:null,p=b.children,ig(v,b)?p=null:k!==null&&ig(v,k)&&(c.flags|=32),c.memoizedState!==null&&(v=rp(a,c,v6,null,null,f),vl._currentValue=v),gu(a,c),an(a,c,p,f),c.child;case 6:return a===null&&Ze&&((a=f=Ct)&&(f=tL(f,c.pendingProps,Or),f!==null?(c.stateNode=f,wn=c,Ct=null,a=!0):a=!1),a||gs(c)),null;case 13:return wT(a,c,f);case 4:return ye(c,c.stateNode.containerInfo),p=c.pendingProps,a===null?c.child=Aa(c,null,p,f):an(a,c,p,f),c.child;case 11:return pT(a,c,c.type,c.pendingProps,f);case 7:return an(a,c,c.pendingProps,f),c.child;case 8:return an(a,c,c.pendingProps.children,f),c.child;case 12:return an(a,c,c.pendingProps.children,f),c.child;case 10:return p=c.pendingProps,wi(c,c.type,p.value),an(a,c,p.children,f),c.child;case 9:return v=c.type._context,p=c.pendingProps.children,_s(c),v=pn(v),p=p(v),c.flags|=1,an(a,c,p,f),c.child;case 14:return gT(a,c,c.type,c.pendingProps,f);case 15:return mT(a,c,c.type,c.pendingProps,f);case 19:return ST(a,c,f);case 31:return p=c.pendingProps,f=c.mode,p={mode:p.mode,children:p.children},a===null?(f=mu(p,f),f.ref=c.ref,c.child=f,f.return=c,c=f):(f=Zr(a.child,p),f.ref=c.ref,c.child=f,f.return=c,c=f),c;case 22:return _T(a,c,f);case 24:return _s(c),p=pn(Yt),a===null?(v=Yh(),v===null&&(v=gt,b=Wh(),v.pooledCache=b,b.refCount++,b!==null&&(v.pooledCacheLanes|=f),v=b),c.memoizedState={parent:p,cache:v},Kh(c),wi(c,Yt,v)):((a.lanes&f)!==0&&(Zh(a,c),Ko(c,null,null,f),Go()),v=a.memoizedState,b=c.memoizedState,v.parent!==p?(v={parent:p,cache:p},c.memoizedState=v,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=v),wi(c,Yt,p)):(p=b.cache,wi(c,Yt,p),p!==v.cache&&Hh(c,[Yt],f,!0))),an(a,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function si(a){a.flags|=4}function AT(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!P3(c)){if(c=ir.current,c!==null&&((Xe&4194048)===Xe?Pr!==null:(Xe&62914560)!==Xe&&(Xe&536870912)===0||c!==Pr))throw Xo=Gh,cw;a.flags|=8192}}function _u(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Et():536870912,a.lanes|=c,ka|=c)}function rl(a,c){if(!Ze)switch(a.tailMode){case"hidden":c=a.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?a.tail=null:f.sibling=null;break;case"collapsed":f=a.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function At(a){var c=a.alternate!==null&&a.alternate.child===a.child,f=0,p=0;if(c)for(var v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags&65011712,p|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)f|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=p,a.childLanes=f,c}function R6(a,c,f){var p=c.pendingProps;switch(zh(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(c),null;case 1:return At(c),null;case 3:return f=c.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),ti(Yt),Se(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(a===null||a.child===null)&&(Fo(c)?si(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,iw())),At(c),null;case 26:return f=c.memoizedState,a===null?(si(c),f!==null?(At(c),AT(c,f)):(At(c),c.flags&=-16777217)):f?f!==a.memoizedState?(si(c),At(c),AT(c,f)):(At(c),c.flags&=-16777217):(a.memoizedProps!==p&&si(c),At(c),c.flags&=-16777217),null;case 27:Ue(c),f=Y.current;var v=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==p&&si(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return At(c),null}a=F.current,Fo(c)?nw(c):(a=A3(v,p,f),c.stateNode=a,si(c))}return At(c),null;case 5:if(Ue(c),f=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==p&&si(c);else{if(!p){if(c.stateNode===null)throw Error(r(166));return At(c),null}if(a=F.current,Fo(c))nw(c);else{switch(v=ku(Y.current),a){case 1:a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":a=v.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":a=v.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":a=v.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof p.is=="string"?v.createElement("select",{is:p.is}):v.createElement("select"),p.multiple?a.multiple=!0:p.size&&(a.size=p.size);break;default:a=typeof p.is=="string"?v.createElement(f,{is:p.is}):v.createElement(f)}}a[hn]=c,a[kn]=p;e:for(v=c.child;v!==null;){if(v.tag===5||v.tag===6)a.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===c)break e;for(;v.sibling===null;){if(v.return===null||v.return===c)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}c.stateNode=a;e:switch(ln(a,f,p),f){case"button":case"input":case"select":case"textarea":a=!!p.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&si(c)}}return At(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==p&&si(c);else{if(typeof p!="string"&&c.stateNode===null)throw Error(r(166));if(a=Y.current,Fo(c)){if(a=c.stateNode,f=c.memoizedProps,p=null,v=wn,v!==null)switch(v.tag){case 27:case 5:p=v.memoizedProps}a[hn]=c,a=!!(a.nodeValue===f||p!==null&&p.suppressHydrationWarning===!0||y3(a.nodeValue,f)),a||gs(c)}else a=ku(a).createTextNode(p),a[hn]=c,c.stateNode=a}return At(c),null;case 13:if(p=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=Fo(c),p!==null&&p.dehydrated!==null){if(a===null){if(!v)throw Error(r(318));if(v=c.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[hn]=c}else zo(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;At(c),v=!1}else v=iw(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return c.flags&256?(ri(c),c):(ri(c),null)}if(ri(c),(c.flags&128)!==0)return c.lanes=f,c;if(f=p!==null,a=a!==null&&a.memoizedState!==null,f){p=c.child,v=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(v=p.alternate.memoizedState.cachePool.pool);var b=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(b=p.memoizedState.cachePool.pool),b!==v&&(p.flags|=2048)}return f!==a&&f&&(c.child.flags|=8192),_u(c,c.updateQueue),At(c),null;case 4:return Se(),a===null&&Jp(c.stateNode.containerInfo),At(c),null;case 10:return ti(c.type),At(c),null;case 19:if(oe(Gt),v=c.memoizedState,v===null)return At(c),null;if(p=(c.flags&128)!==0,b=v.rendering,b===null)if(p)rl(v,!1);else{if(Nt!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(b=du(a),b!==null){for(c.flags|=128,rl(v,!1),a=b.updateQueue,c.updateQueue=a,_u(c,a),c.subtreeFlags=0,a=f,f=c.child;f!==null;)ew(f,a),f=f.sibling;return ie(Gt,Gt.current&1|2),c.child}a=a.sibling}v.tail!==null&&Ne()>bu&&(c.flags|=128,p=!0,rl(v,!1),c.lanes=4194304)}else{if(!p)if(a=du(b),a!==null){if(c.flags|=128,p=!0,a=a.updateQueue,c.updateQueue=a,_u(c,a),rl(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!Ze)return At(c),null}else 2*Ne()-v.renderingStartTime>bu&&f!==536870912&&(c.flags|=128,p=!0,rl(v,!1),c.lanes=4194304);v.isBackwards?(b.sibling=c.child,c.child=b):(a=v.last,a!==null?a.sibling=b:c.child=b,v.last=b)}return v.tail!==null?(c=v.tail,v.rendering=c,v.tail=c.sibling,v.renderingStartTime=Ne(),c.sibling=null,a=Gt.current,ie(Gt,p?a&1|2:a&1),c):(At(c),null);case 22:case 23:return ri(c),tp(),p=c.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(c.flags|=8192):p&&(c.flags|=8192),p?(f&536870912)!==0&&(c.flags&128)===0&&(At(c),c.subtreeFlags&6&&(c.flags|=8192)):At(c),f=c.updateQueue,f!==null&&_u(c,f.retryQueue),f=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),p=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),p!==f&&(c.flags|=2048),a!==null&&oe(vs),null;case 24:return f=null,a!==null&&(f=a.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),ti(Yt),At(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function C6(a,c){switch(zh(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return ti(Yt),Se(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return Ue(c),null;case 13:if(ri(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(r(340));zo()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return oe(Gt),null;case 4:return Se(),null;case 10:return ti(c.type),null;case 22:case 23:return ri(c),tp(),a!==null&&oe(vs),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return ti(Yt),null;case 25:return null;default:return null}}function RT(a,c){switch(zh(c),c.tag){case 3:ti(Yt),Se();break;case 26:case 27:case 5:Ue(c);break;case 4:Se();break;case 13:ri(c);break;case 19:oe(Gt);break;case 10:ti(c.type);break;case 22:case 23:ri(c),tp(),a!==null&&oe(vs);break;case 24:ti(Yt)}}function il(a,c){try{var f=c.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var v=p.next;f=v;do{if((f.tag&a)===a){p=void 0;var b=f.create,k=f.inst;p=b(),k.destroy=p}f=f.next}while(f!==v)}}catch(L){ft(c,c.return,L)}}function Ni(a,c,f){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var b=v.next;p=b;do{if((p.tag&a)===a){var k=p.inst,L=k.destroy;if(L!==void 0){k.destroy=void 0,v=c;var K=f,fe=L;try{fe()}catch(ge){ft(v,K,ge)}}}p=p.next}while(p!==b)}}catch(ge){ft(c,c.return,ge)}}function CT(a){var c=a.updateQueue;if(c!==null){var f=a.stateNode;try{gw(c,f)}catch(p){ft(a,a.return,p)}}}function NT(a,c,f){f.props=bs(a.type,a.memoizedProps),f.state=a.memoizedState;try{f.componentWillUnmount()}catch(p){ft(a,c,p)}}function sl(a,c){try{var f=a.ref;if(f!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof f=="function"?a.refCleanup=f(p):f.current=p}}catch(v){ft(a,c,v)}}function Dr(a,c){var f=a.ref,p=a.refCleanup;if(f!==null)if(typeof p=="function")try{p()}catch(v){ft(a,c,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(v){ft(a,c,v)}else f.current=null}function kT(a){var c=a.type,f=a.memoizedProps,p=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&p.focus();break e;case"img":f.src?p.src=f.src:f.srcSet&&(p.srcset=f.srcSet)}}catch(v){ft(a,a.return,v)}}function Np(a,c,f){try{var p=a.stateNode;G6(p,a.type,f,c),p[kn]=c}catch(v){ft(a,a.return,v)}}function MT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Li(a.type)||a.tag===4}function kp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||MT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Li(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Mp(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(a,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(a),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Nu));else if(p!==4&&(p===27&&Li(a.type)&&(f=a.stateNode,c=null),a=a.child,a!==null))for(Mp(a,c,f),a=a.sibling;a!==null;)Mp(a,c,f),a=a.sibling}function vu(a,c,f){var p=a.tag;if(p===5||p===6)a=a.stateNode,c?f.insertBefore(a,c):f.appendChild(a);else if(p!==4&&(p===27&&Li(a.type)&&(f=a.stateNode),a=a.child,a!==null))for(vu(a,c,f),a=a.sibling;a!==null;)vu(a,c,f),a=a.sibling}function IT(a){var c=a.stateNode,f=a.memoizedProps;try{for(var p=a.type,v=c.attributes;v.length;)c.removeAttributeNode(v[0]);ln(c,p,f),c[hn]=a,c[kn]=f}catch(b){ft(a,a.return,b)}}var ai=!1,Dt=!1,Ip=!1,OT=typeof WeakSet=="function"?WeakSet:Set,nn=null;function N6(a,c){if(a=a.containerInfo,ng=ju,a=$2(a),kh(a)){if("selectionStart"in a)var f={start:a.selectionStart,end:a.selectionEnd};else e:{f=(f=a.ownerDocument)&&f.defaultView||window;var p=f.getSelection&&f.getSelection();if(p&&p.rangeCount!==0){f=p.anchorNode;var v=p.anchorOffset,b=p.focusNode;p=p.focusOffset;try{f.nodeType,b.nodeType}catch{f=null;break e}var k=0,L=-1,K=-1,fe=0,ge=0,ve=a,he=null;t:for(;;){for(var pe;ve!==f||v!==0&&ve.nodeType!==3||(L=k+v),ve!==b||p!==0&&ve.nodeType!==3||(K=k+p),ve.nodeType===3&&(k+=ve.nodeValue.length),(pe=ve.firstChild)!==null;)he=ve,ve=pe;for(;;){if(ve===a)break t;if(he===f&&++fe===v&&(L=k),he===b&&++ge===p&&(K=k),(pe=ve.nextSibling)!==null)break;ve=he,he=ve.parentNode}ve=pe}f=L===-1||K===-1?null:{start:L,end:K}}else f=null}f=f||{start:0,end:0}}else f=null;for(rg={focusedElem:a,selectionRange:f},ju=!1,nn=c;nn!==null;)if(c=nn,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,nn=a;else for(;nn!==null;){switch(c=nn,b=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,f=c,v=b.memoizedProps,b=b.memoizedState,p=f.stateNode;try{var Pe=bs(f.type,v,f.elementType===f.type);a=p.getSnapshotBeforeUpdate(Pe,b),p.__reactInternalSnapshotBeforeUpdate=a}catch(Me){ft(f,f.return,Me)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,f=a.nodeType,f===9)ag(a);else if(f===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":ag(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=c.sibling,a!==null){a.return=c.return,nn=a;break}nn=c.return}}function PT(a,c,f){var p=f.flags;switch(f.tag){case 0:case 11:case 15:ki(a,f),p&4&&il(5,f);break;case 1:if(ki(a,f),p&4)if(a=f.stateNode,c===null)try{a.componentDidMount()}catch(k){ft(f,f.return,k)}else{var v=bs(f.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(v,c,a.__reactInternalSnapshotBeforeUpdate)}catch(k){ft(f,f.return,k)}}p&64&&CT(f),p&512&&sl(f,f.return);break;case 3:if(ki(a,f),p&64&&(a=f.updateQueue,a!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{gw(a,c)}catch(k){ft(f,f.return,k)}}break;case 27:c===null&&p&4&&IT(f);case 26:case 5:ki(a,f),c===null&&p&4&&kT(f),p&512&&sl(f,f.return);break;case 12:ki(a,f);break;case 13:ki(a,f),p&4&&LT(a,f),p&64&&(a=f.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(f=B6.bind(null,f),nL(a,f))));break;case 22:if(p=f.memoizedState!==null||ai,!p){c=c!==null&&c.memoizedState!==null||Dt,v=ai;var b=Dt;ai=p,(Dt=c)&&!b?Mi(a,f,(f.subtreeFlags&8772)!==0):ki(a,f),ai=v,Dt=b}break;case 30:break;default:ki(a,f)}}function DT(a){var c=a.alternate;c!==null&&(a.alternate=null,DT(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&fh(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var xt=null,On=!1;function oi(a,c,f){for(f=f.child;f!==null;)jT(a,c,f),f=f.sibling}function jT(a,c,f){if(Ve&&typeof Ve.onCommitFiberUnmount=="function")try{Ve.onCommitFiberUnmount(et,f)}catch{}switch(f.tag){case 26:Dt||Dr(f,c),oi(a,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:Dt||Dr(f,c);var p=xt,v=On;Li(f.type)&&(xt=f.stateNode,On=!1),oi(a,c,f),pl(f.stateNode),xt=p,On=v;break;case 5:Dt||Dr(f,c);case 6:if(p=xt,v=On,xt=null,oi(a,c,f),xt=p,On=v,xt!==null)if(On)try{(xt.nodeType===9?xt.body:xt.nodeName==="HTML"?xt.ownerDocument.body:xt).removeChild(f.stateNode)}catch(b){ft(f,c,b)}else try{xt.removeChild(f.stateNode)}catch(b){ft(f,c,b)}break;case 18:xt!==null&&(On?(a=xt,S3(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,f.stateNode),wl(a)):S3(xt,f.stateNode));break;case 4:p=xt,v=On,xt=f.stateNode.containerInfo,On=!0,oi(a,c,f),xt=p,On=v;break;case 0:case 11:case 14:case 15:Dt||Ni(2,f,c),Dt||Ni(4,f,c),oi(a,c,f);break;case 1:Dt||(Dr(f,c),p=f.stateNode,typeof p.componentWillUnmount=="function"&&NT(f,c,p)),oi(a,c,f);break;case 21:oi(a,c,f);break;case 22:Dt=(p=Dt)||f.memoizedState!==null,oi(a,c,f),Dt=p;break;default:oi(a,c,f)}}function LT(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{wl(a)}catch(f){ft(c,c.return,f)}}function k6(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new OT),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new OT),c;default:throw Error(r(435,a.tag))}}function Op(a,c){var f=k6(a);c.forEach(function(p){var v=U6.bind(null,a,p);f.has(p)||(f.add(p),p.then(v,v))})}function Un(a,c){var f=c.deletions;if(f!==null)for(var p=0;p<f.length;p++){var v=f[p],b=a,k=c,L=k;e:for(;L!==null;){switch(L.tag){case 27:if(Li(L.type)){xt=L.stateNode,On=!1;break e}break;case 5:xt=L.stateNode,On=!1;break e;case 3:case 4:xt=L.stateNode.containerInfo,On=!0;break e}L=L.return}if(xt===null)throw Error(r(160));jT(b,k,v),xt=null,On=!1,b=v.alternate,b!==null&&(b.return=null),v.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)BT(c,a),c=c.sibling}var br=null;function BT(a,c){var f=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Un(c,a),Fn(a),p&4&&(Ni(3,a,a.return),il(3,a),Ni(5,a,a.return));break;case 1:Un(c,a),Fn(a),p&512&&(Dt||f===null||Dr(f,f.return)),p&64&&ai&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(f=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=f===null?p:f.concat(p))));break;case 26:var v=br;if(Un(c,a),Fn(a),p&512&&(Dt||f===null||Dr(f,f.return)),p&4){var b=f!==null?f.memoizedState:null;if(p=a.memoizedState,f===null)if(p===null)if(a.stateNode===null){e:{p=a.type,f=a.memoizedProps,v=v.ownerDocument||v;t:switch(p){case"title":b=v.getElementsByTagName("title")[0],(!b||b[No]||b[hn]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=v.createElement(p),v.head.insertBefore(b,v.querySelector("head > title"))),ln(b,p,f),b[hn]=a,en(b),p=b;break e;case"link":var k=I3("link","href",v).get(p+(f.href||""));if(k){for(var L=0;L<k.length;L++)if(b=k[L],b.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&b.getAttribute("rel")===(f.rel==null?null:f.rel)&&b.getAttribute("title")===(f.title==null?null:f.title)&&b.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){k.splice(L,1);break t}}b=v.createElement(p),ln(b,p,f),v.head.appendChild(b);break;case"meta":if(k=I3("meta","content",v).get(p+(f.content||""))){for(L=0;L<k.length;L++)if(b=k[L],b.getAttribute("content")===(f.content==null?null:""+f.content)&&b.getAttribute("name")===(f.name==null?null:f.name)&&b.getAttribute("property")===(f.property==null?null:f.property)&&b.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&b.getAttribute("charset")===(f.charSet==null?null:f.charSet)){k.splice(L,1);break t}}b=v.createElement(p),ln(b,p,f),v.head.appendChild(b);break;default:throw Error(r(468,p))}b[hn]=a,en(b),p=b}a.stateNode=p}else O3(v,a.type,a.stateNode);else a.stateNode=M3(v,p,a.memoizedProps);else b!==p?(b===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):b.count--,p===null?O3(v,a.type,a.stateNode):M3(v,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Np(a,a.memoizedProps,f.memoizedProps)}break;case 27:Un(c,a),Fn(a),p&512&&(Dt||f===null||Dr(f,f.return)),f!==null&&p&4&&Np(a,a.memoizedProps,f.memoizedProps);break;case 5:if(Un(c,a),Fn(a),p&512&&(Dt||f===null||Dr(f,f.return)),a.flags&32){v=a.stateNode;try{la(v,"")}catch(pe){ft(a,a.return,pe)}}p&4&&a.stateNode!=null&&(v=a.memoizedProps,Np(a,v,f!==null?f.memoizedProps:v)),p&1024&&(Ip=!0);break;case 6:if(Un(c,a),Fn(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,f=a.stateNode;try{f.nodeValue=p}catch(pe){ft(a,a.return,pe)}}break;case 3:if(Ou=null,v=br,br=Mu(c.containerInfo),Un(c,a),br=v,Fn(a),p&4&&f!==null&&f.memoizedState.isDehydrated)try{wl(c.containerInfo)}catch(pe){ft(a,a.return,pe)}Ip&&(Ip=!1,UT(a));break;case 4:p=br,br=Mu(a.stateNode.containerInfo),Un(c,a),Fn(a),br=p;break;case 12:Un(c,a),Fn(a);break;case 13:Un(c,a),Fn(a),a.child.flags&8192&&a.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Up=Ne()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Op(a,p)));break;case 22:v=a.memoizedState!==null;var K=f!==null&&f.memoizedState!==null,fe=ai,ge=Dt;if(ai=fe||v,Dt=ge||K,Un(c,a),Dt=ge,ai=fe,Fn(a),p&8192)e:for(c=a.stateNode,c._visibility=v?c._visibility&-2:c._visibility|1,v&&(f===null||K||ai||Dt||xs(a)),f=null,c=a;;){if(c.tag===5||c.tag===26){if(f===null){K=f=c;try{if(b=K.stateNode,v)k=b.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{L=K.stateNode;var ve=K.memoizedProps.style,he=ve!=null&&ve.hasOwnProperty("display")?ve.display:null;L.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(pe){ft(K,K.return,pe)}}}else if(c.tag===6){if(f===null){K=c;try{K.stateNode.nodeValue=v?"":K.memoizedProps}catch(pe){ft(K,K.return,pe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}p&4&&(p=a.updateQueue,p!==null&&(f=p.retryQueue,f!==null&&(p.retryQueue=null,Op(a,f))));break;case 19:Un(c,a),Fn(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,Op(a,p)));break;case 30:break;case 21:break;default:Un(c,a),Fn(a)}}function Fn(a){var c=a.flags;if(c&2){try{for(var f,p=a.return;p!==null;){if(MT(p)){f=p;break}p=p.return}if(f==null)throw Error(r(160));switch(f.tag){case 27:var v=f.stateNode,b=kp(a);vu(a,b,v);break;case 5:var k=f.stateNode;f.flags&32&&(la(k,""),f.flags&=-33);var L=kp(a);vu(a,L,k);break;case 3:case 4:var K=f.stateNode.containerInfo,fe=kp(a);Mp(a,fe,K);break;default:throw Error(r(161))}}catch(ge){ft(a,a.return,ge)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function UT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;UT(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function ki(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)PT(a,c.alternate,c),c=c.sibling}function xs(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:Ni(4,c,c.return),xs(c);break;case 1:Dr(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&NT(c,c.return,f),xs(c);break;case 27:pl(c.stateNode);case 26:case 5:Dr(c,c.return),xs(c);break;case 22:c.memoizedState===null&&xs(c);break;case 30:xs(c);break;default:xs(c)}a=a.sibling}}function Mi(a,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var p=c.alternate,v=a,b=c,k=b.flags;switch(b.tag){case 0:case 11:case 15:Mi(v,b,f),il(4,b);break;case 1:if(Mi(v,b,f),p=b,v=p.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(fe){ft(p,p.return,fe)}if(p=b,v=p.updateQueue,v!==null){var L=p.stateNode;try{var K=v.shared.hiddenCallbacks;if(K!==null)for(v.shared.hiddenCallbacks=null,v=0;v<K.length;v++)pw(K[v],L)}catch(fe){ft(p,p.return,fe)}}f&&k&64&&CT(b),sl(b,b.return);break;case 27:IT(b);case 26:case 5:Mi(v,b,f),f&&p===null&&k&4&&kT(b),sl(b,b.return);break;case 12:Mi(v,b,f);break;case 13:Mi(v,b,f),f&&k&4&&LT(v,b);break;case 22:b.memoizedState===null&&Mi(v,b,f),sl(b,b.return);break;case 30:break;default:Mi(v,b,f)}c=c.sibling}}function Pp(a,c){var f=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==f&&(a!=null&&a.refCount++,f!=null&&$o(f))}function Dp(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&$o(a))}function jr(a,c,f,p){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)FT(a,c,f,p),c=c.sibling}function FT(a,c,f,p){var v=c.flags;switch(c.tag){case 0:case 11:case 15:jr(a,c,f,p),v&2048&&il(9,c);break;case 1:jr(a,c,f,p);break;case 3:jr(a,c,f,p),v&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&$o(a)));break;case 12:if(v&2048){jr(a,c,f,p),a=c.stateNode;try{var b=c.memoizedProps,k=b.id,L=b.onPostCommit;typeof L=="function"&&L(k,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(K){ft(c,c.return,K)}}else jr(a,c,f,p);break;case 13:jr(a,c,f,p);break;case 23:break;case 22:b=c.stateNode,k=c.alternate,c.memoizedState!==null?b._visibility&2?jr(a,c,f,p):al(a,c):b._visibility&2?jr(a,c,f,p):(b._visibility|=2,Ra(a,c,f,p,(c.subtreeFlags&10256)!==0)),v&2048&&Pp(k,c);break;case 24:jr(a,c,f,p),v&2048&&Dp(c.alternate,c);break;default:jr(a,c,f,p)}}function Ra(a,c,f,p,v){for(v=v&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var b=a,k=c,L=f,K=p,fe=k.flags;switch(k.tag){case 0:case 11:case 15:Ra(b,k,L,K,v),il(8,k);break;case 23:break;case 22:var ge=k.stateNode;k.memoizedState!==null?ge._visibility&2?Ra(b,k,L,K,v):al(b,k):(ge._visibility|=2,Ra(b,k,L,K,v)),v&&fe&2048&&Pp(k.alternate,k);break;case 24:Ra(b,k,L,K,v),v&&fe&2048&&Dp(k.alternate,k);break;default:Ra(b,k,L,K,v)}c=c.sibling}}function al(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=a,p=c,v=p.flags;switch(p.tag){case 22:al(f,p),v&2048&&Pp(p.alternate,p);break;case 24:al(f,p),v&2048&&Dp(p.alternate,p);break;default:al(f,p)}c=c.sibling}}var ol=8192;function Ca(a){if(a.subtreeFlags&ol)for(a=a.child;a!==null;)zT(a),a=a.sibling}function zT(a){switch(a.tag){case 26:Ca(a),a.flags&ol&&a.memoizedState!==null&&gL(br,a.memoizedState,a.memoizedProps);break;case 5:Ca(a);break;case 3:case 4:var c=br;br=Mu(a.stateNode.containerInfo),Ca(a),br=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=ol,ol=16777216,Ca(a),ol=c):Ca(a));break;default:Ca(a)}}function qT(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function ll(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];nn=p,$T(p,a)}qT(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)VT(a),a=a.sibling}function VT(a){switch(a.tag){case 0:case 11:case 15:ll(a),a.flags&2048&&Ni(9,a,a.return);break;case 3:ll(a);break;case 12:ll(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,yu(a)):ll(a);break;default:ll(a)}}function yu(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var p=c[f];nn=p,$T(p,a)}qT(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:Ni(8,c,c.return),yu(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,yu(c));break;default:yu(c)}a=a.sibling}}function $T(a,c){for(;nn!==null;){var f=nn;switch(f.tag){case 0:case 11:case 15:Ni(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var p=f.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:$o(f.memoizedState.cache)}if(p=f.child,p!==null)p.return=f,nn=p;else e:for(f=a;nn!==null;){p=nn;var v=p.sibling,b=p.return;if(DT(p),p===f){nn=null;break e}if(v!==null){v.return=b,nn=v;break e}nn=b}}}var M6={getCacheForType:function(a){var c=pn(Yt),f=c.data.get(a);return f===void 0&&(f=a(),c.data.set(a,f)),f}},I6=typeof WeakMap=="function"?WeakMap:Map,rt=0,gt=null,$e=null,Xe=0,it=0,zn=null,Ii=!1,Na=!1,jp=!1,li=0,Nt=0,Oi=0,ws=0,Lp=0,sr=0,ka=0,cl=null,Pn=null,Bp=!1,Up=0,bu=1/0,xu=null,Pi=null,on=0,Di=null,Ma=null,Ia=0,Fp=0,zp=null,HT=null,ul=0,qp=null;function qn(){if((rt&2)!==0&&Xe!==0)return Xe&-Xe;if(q.T!==null){var a=ya;return a!==0?a:Gp()}return o2()}function WT(){sr===0&&(sr=(Xe&536870912)===0||Ze?st():536870912);var a=ir.current;return a!==null&&(a.flags|=32),sr}function Vn(a,c,f){(a===gt&&(it===2||it===9)||a.cancelPendingCommit!==null)&&(Oa(a,0),ji(a,Xe,sr,!1)),bt(a,f),((rt&2)===0||a!==gt)&&(a===gt&&((rt&2)===0&&(ws|=f),Nt===4&&ji(a,Xe,sr,!1)),Lr(a))}function XT(a,c,f){if((rt&6)!==0)throw Error(r(327));var p=!f&&(c&124)===0&&(c&a.expiredLanes)===0||Zn(a,c),v=p?D6(a,c):Hp(a,c,!0),b=p;do{if(v===0){Na&&!p&&ji(a,c,0,!1);break}else{if(f=a.current.alternate,b&&!O6(f)){v=Hp(a,c,!1),b=!1;continue}if(v===2){if(b=c,a.errorRecoveryDisabledLanes&b)var k=0;else k=a.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){c=k;e:{var L=a;v=cl;var K=L.current.memoizedState.isDehydrated;if(K&&(Oa(L,k).flags|=256),k=Hp(L,k,!1),k!==2){if(jp&&!K){L.errorRecoveryDisabledLanes|=b,ws|=b,v=4;break e}b=Pn,Pn=v,b!==null&&(Pn===null?Pn=b:Pn.push.apply(Pn,b))}v=k}if(b=!1,v!==2)continue}}if(v===1){Oa(a,0),ji(a,c,0,!0);break}e:{switch(p=a,b=v,b){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:ji(p,c,sr,!Ii);break e;case 2:Pn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(v=Up+300-Ne(),10<v)){if(ji(p,c,sr,!Ii),vr(p,0,!0)!==0)break e;p.timeoutHandle=w3(YT.bind(null,p,f,Pn,xu,Bp,c,sr,ws,ka,Ii,b,2,-0,0),v);break e}YT(p,f,Pn,xu,Bp,c,sr,ws,ka,Ii,b,0,-0,0)}}break}while(!0);Lr(a)}function YT(a,c,f,p,v,b,k,L,K,fe,ge,ve,he,pe){if(a.timeoutHandle=-1,ve=c.subtreeFlags,(ve&8192||(ve&16785408)===16785408)&&(_l={stylesheets:null,count:0,unsuspend:pL},zT(c),ve=mL(),ve!==null)){a.cancelPendingCommit=ve(t3.bind(null,a,c,b,f,p,v,k,L,K,ge,1,he,pe)),ji(a,b,k,!fe);return}t3(a,c,b,f,p,v,k,L,K)}function O6(a){for(var c=a;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var p=0;p<f.length;p++){var v=f[p],b=v.getSnapshot;v=v.value;try{if(!Ln(b(),v))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function ji(a,c,f,p){c&=~Lp,c&=~ws,a.suspendedLanes|=c,a.pingedLanes&=~c,p&&(a.warmLanes|=c),p=a.expirationTimes;for(var v=c;0<v;){var b=31-vt(v),k=1<<b;p[b]=-1,v&=~k}f!==0&&Co(a,f,c)}function wu(){return(rt&6)===0?(fl(0),!1):!0}function Vp(){if($e!==null){if(it===0)var a=$e.return;else a=$e,ei=ms=null,ap(a),Ea=null,tl=0,a=$e;for(;a!==null;)RT(a.alternate,a),a=a.return;$e=null}}function Oa(a,c){var f=a.timeoutHandle;f!==-1&&(a.timeoutHandle=-1,Z6(f)),f=a.cancelPendingCommit,f!==null&&(a.cancelPendingCommit=null,f()),Vp(),gt=a,$e=f=Zr(a.current,null),Xe=c,it=0,zn=null,Ii=!1,Na=Zn(a,c),jp=!1,ka=sr=Lp=ws=Oi=Nt=0,Pn=cl=null,Bp=!1,(c&8)!==0&&(c|=c&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=c;0<p;){var v=31-vt(p),b=1<<v;c|=a[v],p&=~b}return li=c,$c(),f}function GT(a,c){ze=null,q.H=cu,c===Wo||c===Jc?(c=dw(),it=3):c===cw?(c=dw(),it=4):it=c===hT?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,zn=c,$e===null&&(Nt=1,pu(a,er(c,a.current)))}function KT(){var a=q.H;return q.H=cu,a===null?cu:a}function ZT(){var a=q.A;return q.A=M6,a}function $p(){Nt=4,Ii||(Xe&4194048)!==Xe&&ir.current!==null||(Na=!0),(Oi&134217727)===0&&(ws&134217727)===0||gt===null||ji(gt,Xe,sr,!1)}function Hp(a,c,f){var p=rt;rt|=2;var v=KT(),b=ZT();(gt!==a||Xe!==c)&&(xu=null,Oa(a,c)),c=!1;var k=Nt;e:do try{if(it!==0&&$e!==null){var L=$e,K=zn;switch(it){case 8:Vp(),k=6;break e;case 3:case 2:case 9:case 6:ir.current===null&&(c=!0);var fe=it;if(it=0,zn=null,Pa(a,L,K,fe),f&&Na){k=0;break e}break;default:fe=it,it=0,zn=null,Pa(a,L,K,fe)}}P6(),k=Nt;break}catch(ge){GT(a,ge)}while(!0);return c&&a.shellSuspendCounter++,ei=ms=null,rt=p,q.H=v,q.A=b,$e===null&&(gt=null,Xe=0,$c()),k}function P6(){for(;$e!==null;)QT($e)}function D6(a,c){var f=rt;rt|=2;var p=KT(),v=ZT();gt!==a||Xe!==c?(xu=null,bu=Ne()+500,Oa(a,c)):Na=Zn(a,c);e:do try{if(it!==0&&$e!==null){c=$e;var b=zn;t:switch(it){case 1:it=0,zn=null,Pa(a,c,b,1);break;case 2:case 9:if(uw(b)){it=0,zn=null,JT(c);break}c=function(){it!==2&&it!==9||gt!==a||(it=7),Lr(a)},b.then(c,c);break e;case 3:it=7;break e;case 4:it=5;break e;case 7:uw(b)?(it=0,zn=null,JT(c)):(it=0,zn=null,Pa(a,c,b,7));break;case 5:var k=null;switch($e.tag){case 26:k=$e.memoizedState;case 5:case 27:var L=$e;if(!k||P3(k)){it=0,zn=null;var K=L.sibling;if(K!==null)$e=K;else{var fe=L.return;fe!==null?($e=fe,Tu(fe)):$e=null}break t}}it=0,zn=null,Pa(a,c,b,5);break;case 6:it=0,zn=null,Pa(a,c,b,6);break;case 8:Vp(),Nt=6;break e;default:throw Error(r(462))}}j6();break}catch(ge){GT(a,ge)}while(!0);return ei=ms=null,q.H=p,q.A=v,rt=f,$e!==null?0:(gt=null,Xe=0,$c(),Nt)}function j6(){for(;$e!==null&&!De();)QT($e)}function QT(a){var c=ET(a.alternate,a,li);a.memoizedProps=a.pendingProps,c===null?Tu(a):$e=c}function JT(a){var c=a,f=c.alternate;switch(c.tag){case 15:case 0:c=yT(f,c,c.pendingProps,c.type,void 0,Xe);break;case 11:c=yT(f,c,c.pendingProps,c.type.render,c.ref,Xe);break;case 5:ap(c);default:RT(f,c),c=$e=ew(c,li),c=ET(f,c,li)}a.memoizedProps=a.pendingProps,c===null?Tu(a):$e=c}function Pa(a,c,f,p){ei=ms=null,ap(c),Ea=null,tl=0;var v=c.return;try{if(E6(a,v,c,f,Xe)){Nt=1,pu(a,er(f,a.current)),$e=null;return}}catch(b){if(v!==null)throw $e=v,b;Nt=1,pu(a,er(f,a.current)),$e=null;return}c.flags&32768?(Ze||p===1?a=!0:Na||(Xe&536870912)!==0?a=!1:(Ii=a=!0,(p===2||p===9||p===3||p===6)&&(p=ir.current,p!==null&&p.tag===13&&(p.flags|=16384))),e3(c,a)):Tu(c)}function Tu(a){var c=a;do{if((c.flags&32768)!==0){e3(c,Ii);return}a=c.return;var f=R6(c.alternate,c,li);if(f!==null){$e=f;return}if(c=c.sibling,c!==null){$e=c;return}$e=c=a}while(c!==null);Nt===0&&(Nt=5)}function e3(a,c){do{var f=C6(a.alternate,a);if(f!==null){f.flags&=32767,$e=f;return}if(f=a.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(a=a.sibling,a!==null)){$e=a;return}$e=a=f}while(a!==null);Nt=6,$e=null}function t3(a,c,f,p,v,b,k,L,K){a.cancelPendingCommit=null;do Su();while(on!==0);if((rt&6)!==0)throw Error(r(327));if(c!==null){if(c===a.current)throw Error(r(177));if(b=c.lanes|c.childLanes,b|=Dh,ea(a,f,b,k,L,K),a===gt&&($e=gt=null,Xe=0),Ma=c,Di=a,Ia=f,Fp=b,zp=v,HT=p,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,F6(jt,function(){return a3(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||p){p=q.T,q.T=null,v=ee.p,ee.p=2,k=rt,rt|=4;try{N6(a,c,f)}finally{rt=k,ee.p=v,q.T=p}}on=1,n3(),r3(),i3()}}function n3(){if(on===1){on=0;var a=Di,c=Ma,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=q.T,q.T=null;var p=ee.p;ee.p=2;var v=rt;rt|=4;try{BT(c,a);var b=rg,k=$2(a.containerInfo),L=b.focusedElem,K=b.selectionRange;if(k!==L&&L&&L.ownerDocument&&V2(L.ownerDocument.documentElement,L)){if(K!==null&&kh(L)){var fe=K.start,ge=K.end;if(ge===void 0&&(ge=fe),"selectionStart"in L)L.selectionStart=fe,L.selectionEnd=Math.min(ge,L.value.length);else{var ve=L.ownerDocument||document,he=ve&&ve.defaultView||window;if(he.getSelection){var pe=he.getSelection(),Pe=L.textContent.length,Me=Math.min(K.start,Pe),lt=K.end===void 0?Me:Math.min(K.end,Pe);!pe.extend&&Me>lt&&(k=lt,lt=Me,Me=k);var se=q2(L,Me),J=q2(L,lt);if(se&&J&&(pe.rangeCount!==1||pe.anchorNode!==se.node||pe.anchorOffset!==se.offset||pe.focusNode!==J.node||pe.focusOffset!==J.offset)){var ce=ve.createRange();ce.setStart(se.node,se.offset),pe.removeAllRanges(),Me>lt?(pe.addRange(ce),pe.extend(J.node,J.offset)):(ce.setEnd(J.node,J.offset),pe.addRange(ce))}}}}for(ve=[],pe=L;pe=pe.parentNode;)pe.nodeType===1&&ve.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof L.focus=="function"&&L.focus(),L=0;L<ve.length;L++){var me=ve[L];me.element.scrollLeft=me.left,me.element.scrollTop=me.top}}ju=!!ng,rg=ng=null}finally{rt=v,ee.p=p,q.T=f}}a.current=c,on=2}}function r3(){if(on===2){on=0;var a=Di,c=Ma,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=q.T,q.T=null;var p=ee.p;ee.p=2;var v=rt;rt|=4;try{PT(a,c.alternate,c)}finally{rt=v,ee.p=p,q.T=f}}on=3}}function i3(){if(on===4||on===3){on=0,Jt();var a=Di,c=Ma,f=Ia,p=HT;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?on=5:(on=0,Ma=Di=null,s3(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(Pi=null),ch(f),c=c.stateNode,Ve&&typeof Ve.onCommitFiberRoot=="function")try{Ve.onCommitFiberRoot(et,c,void 0,(c.current.flags&128)===128)}catch{}if(p!==null){c=q.T,v=ee.p,ee.p=2,q.T=null;try{for(var b=a.onRecoverableError,k=0;k<p.length;k++){var L=p[k];b(L.value,{componentStack:L.stack})}}finally{q.T=c,ee.p=v}}(Ia&3)!==0&&Su(),Lr(a),v=a.pendingLanes,(f&4194090)!==0&&(v&42)!==0?a===qp?ul++:(ul=0,qp=a):ul=0,fl(0)}}function s3(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,$o(c)))}function Su(a){return n3(),r3(),i3(),a3()}function a3(){if(on!==5)return!1;var a=Di,c=Fp;Fp=0;var f=ch(Ia),p=q.T,v=ee.p;try{ee.p=32>f?32:f,q.T=null,f=zp,zp=null;var b=Di,k=Ia;if(on=0,Ma=Di=null,Ia=0,(rt&6)!==0)throw Error(r(331));var L=rt;if(rt|=4,VT(b.current),FT(b,b.current,k,f),rt=L,fl(0,!1),Ve&&typeof Ve.onPostCommitFiberRoot=="function")try{Ve.onPostCommitFiberRoot(et,b)}catch{}return!0}finally{ee.p=v,q.T=p,s3(a,c)}}function o3(a,c,f){c=er(f,c),c=bp(a.stateNode,c,2),a=Ei(a,c,2),a!==null&&(bt(a,2),Lr(a))}function ft(a,c,f){if(a.tag===3)o3(a,a,f);else for(;c!==null;){if(c.tag===3){o3(c,a,f);break}else if(c.tag===1){var p=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Pi===null||!Pi.has(p))){a=er(f,a),f=fT(2),p=Ei(c,f,2),p!==null&&(dT(f,p,c,a),bt(p,2),Lr(p));break}}c=c.return}}function Wp(a,c,f){var p=a.pingCache;if(p===null){p=a.pingCache=new I6;var v=new Set;p.set(c,v)}else v=p.get(c),v===void 0&&(v=new Set,p.set(c,v));v.has(f)||(jp=!0,v.add(f),a=L6.bind(null,a,c,f),c.then(a,a))}function L6(a,c,f){var p=a.pingCache;p!==null&&p.delete(c),a.pingedLanes|=a.suspendedLanes&f,a.warmLanes&=~f,gt===a&&(Xe&f)===f&&(Nt===4||Nt===3&&(Xe&62914560)===Xe&&300>Ne()-Up?(rt&2)===0&&Oa(a,0):Lp|=f,ka===Xe&&(ka=0)),Lr(a)}function l3(a,c){c===0&&(c=Et()),a=ga(a,c),a!==null&&(bt(a,c),Lr(a))}function B6(a){var c=a.memoizedState,f=0;c!==null&&(f=c.retryLane),l3(a,f)}function U6(a,c){var f=0;switch(a.tag){case 13:var p=a.stateNode,v=a.memoizedState;v!==null&&(f=v.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(c),l3(a,f)}function F6(a,c){return We(a,c)}var Eu=null,Da=null,Xp=!1,Au=!1,Yp=!1,Ts=0;function Lr(a){a!==Da&&a.next===null&&(Da===null?Eu=Da=a:Da=Da.next=a),Au=!0,Xp||(Xp=!0,q6())}function fl(a,c){if(!Yp&&Au){Yp=!0;do for(var f=!1,p=Eu;p!==null;){if(a!==0){var v=p.pendingLanes;if(v===0)var b=0;else{var k=p.suspendedLanes,L=p.pingedLanes;b=(1<<31-vt(42|a)+1)-1,b&=v&~(k&~L),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(f=!0,d3(p,b))}else b=Xe,b=vr(p,p===gt?b:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(b&3)===0||Zn(p,b)||(f=!0,d3(p,b));p=p.next}while(f);Yp=!1}}function z6(){c3()}function c3(){Au=Xp=!1;var a=0;Ts!==0&&(K6()&&(a=Ts),Ts=0);for(var c=Ne(),f=null,p=Eu;p!==null;){var v=p.next,b=u3(p,c);b===0?(p.next=null,f===null?Eu=v:f.next=v,v===null&&(Da=f)):(f=p,(a!==0||(b&3)!==0)&&(Au=!0)),p=v}fl(a)}function u3(a,c){for(var f=a.suspendedLanes,p=a.pingedLanes,v=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var k=31-vt(b),L=1<<k,K=v[k];K===-1?((L&f)===0||(L&p)!==0)&&(v[k]=we(L,c)):K<=c&&(a.expiredLanes|=L),b&=~L}if(c=gt,f=Xe,f=vr(a,a===c?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,f===0||a===c&&(it===2||it===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&Fe(p),a.callbackNode=null,a.callbackPriority=0;if((f&3)===0||Zn(a,f)){if(c=f&-f,c===a.callbackPriority)return c;switch(p!==null&&Fe(p),ch(f)){case 2:case 8:f=Cn;break;case 32:f=jt;break;case 268435456:f=Ye;break;default:f=jt}return p=f3.bind(null,a),f=We(f,p),a.callbackPriority=c,a.callbackNode=f,c}return p!==null&&p!==null&&Fe(p),a.callbackPriority=2,a.callbackNode=null,2}function f3(a,c){if(on!==0&&on!==5)return a.callbackNode=null,a.callbackPriority=0,null;var f=a.callbackNode;if(Su()&&a.callbackNode!==f)return null;var p=Xe;return p=vr(a,a===gt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(XT(a,p,c),u3(a,Ne()),a.callbackNode!=null&&a.callbackNode===f?f3.bind(null,a):null)}function d3(a,c){if(Su())return null;XT(a,c,!0)}function q6(){Q6(function(){(rt&6)!==0?We(Xt,z6):c3()})}function Gp(){return Ts===0&&(Ts=st()),Ts}function h3(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Lc(""+a)}function p3(a,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,a.id&&f.setAttribute("form",a.id),c.parentNode.insertBefore(f,c),a=new FormData(a),f.parentNode.removeChild(f),a}function V6(a,c,f,p,v){if(c==="submit"&&f&&f.stateNode===v){var b=h3((v[kn]||null).action),k=p.submitter;k&&(c=(c=k[kn]||null)?h3(c.formAction):k.getAttribute("formAction"),c!==null&&(b=c,k=null));var L=new zc("action","action",null,p,v);a.push({event:L,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ts!==0){var K=k?p3(v,k):new FormData(v);gp(f,{pending:!0,data:K,method:v.method,action:b},null,K)}}else typeof b=="function"&&(L.preventDefault(),K=k?p3(v,k):new FormData(v),gp(f,{pending:!0,data:K,method:v.method,action:b},b,K))},currentTarget:v}]})}}for(var Kp=0;Kp<Ph.length;Kp++){var Zp=Ph[Kp],$6=Zp.toLowerCase(),H6=Zp[0].toUpperCase()+Zp.slice(1);yr($6,"on"+H6)}yr(X2,"onAnimationEnd"),yr(Y2,"onAnimationIteration"),yr(G2,"onAnimationStart"),yr("dblclick","onDoubleClick"),yr("focusin","onFocus"),yr("focusout","onBlur"),yr(l6,"onTransitionRun"),yr(c6,"onTransitionStart"),yr(u6,"onTransitionCancel"),yr(K2,"onTransitionEnd"),sa("onMouseEnter",["mouseout","mouseover"]),sa("onMouseLeave",["mouseout","mouseover"]),sa("onPointerEnter",["pointerout","pointerover"]),sa("onPointerLeave",["pointerout","pointerover"]),os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),os("onBeforeInput",["compositionend","keypress","textInput","paste"]),os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W6=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(dl));function g3(a,c){c=(c&4)!==0;for(var f=0;f<a.length;f++){var p=a[f],v=p.event;p=p.listeners;e:{var b=void 0;if(c)for(var k=p.length-1;0<=k;k--){var L=p[k],K=L.instance,fe=L.currentTarget;if(L=L.listener,K!==b&&v.isPropagationStopped())break e;b=L,v.currentTarget=fe;try{b(v)}catch(ge){hu(ge)}v.currentTarget=null,b=K}else for(k=0;k<p.length;k++){if(L=p[k],K=L.instance,fe=L.currentTarget,L=L.listener,K!==b&&v.isPropagationStopped())break e;b=L,v.currentTarget=fe;try{b(v)}catch(ge){hu(ge)}v.currentTarget=null,b=K}}}}function He(a,c){var f=c[uh];f===void 0&&(f=c[uh]=new Set);var p=a+"__bubble";f.has(p)||(m3(c,a,2,!1),f.add(p))}function Qp(a,c,f){var p=0;c&&(p|=4),m3(f,a,p,c)}var Ru="_reactListening"+Math.random().toString(36).slice(2);function Jp(a){if(!a[Ru]){a[Ru]=!0,c2.forEach(function(f){f!=="selectionchange"&&(W6.has(f)||Qp(f,!1,a),Qp(f,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Ru]||(c[Ru]=!0,Qp("selectionchange",!1,c))}}function m3(a,c,f,p){switch(F3(c)){case 2:var v=yL;break;case 8:v=bL;break;default:v=hg}f=v.bind(null,c,f,a),v=void 0,!xh||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(v=!0),p?v!==void 0?a.addEventListener(c,f,{capture:!0,passive:v}):a.addEventListener(c,f,!0):v!==void 0?a.addEventListener(c,f,{passive:v}):a.addEventListener(c,f,!1)}function eg(a,c,f,p,v){var b=p;if((c&1)===0&&(c&2)===0&&p!==null)e:for(;;){if(p===null)return;var k=p.tag;if(k===3||k===4){var L=p.stateNode.containerInfo;if(L===v)break;if(k===4)for(k=p.return;k!==null;){var K=k.tag;if((K===3||K===4)&&k.stateNode.containerInfo===v)return;k=k.return}for(;L!==null;){if(k=na(L),k===null)return;if(K=k.tag,K===5||K===6||K===26||K===27){p=b=k;continue e}L=L.parentNode}}p=p.return}T2(function(){var fe=b,ge=yh(f),ve=[];e:{var he=Z2.get(a);if(he!==void 0){var pe=zc,Pe=a;switch(a){case"keypress":if(Uc(f)===0)break e;case"keydown":case"keyup":pe=Fj;break;case"focusin":Pe="focus",pe=Eh;break;case"focusout":Pe="blur",pe=Eh;break;case"beforeblur":case"afterblur":pe=Eh;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=A2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=Cj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=Vj;break;case X2:case Y2:case G2:pe=Mj;break;case K2:pe=Hj;break;case"scroll":case"scrollend":pe=Aj;break;case"wheel":pe=Xj;break;case"copy":case"cut":case"paste":pe=Oj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=C2;break;case"toggle":case"beforetoggle":pe=Gj}var Me=(c&4)!==0,lt=!Me&&(a==="scroll"||a==="scrollend"),se=Me?he!==null?he+"Capture":null:he;Me=[];for(var J=fe,ce;J!==null;){var me=J;if(ce=me.stateNode,me=me.tag,me!==5&&me!==26&&me!==27||ce===null||se===null||(me=Mo(J,se),me!=null&&Me.push(hl(J,me,ce))),lt)break;J=J.return}0<Me.length&&(he=new pe(he,Pe,null,f,ge),ve.push({event:he,listeners:Me}))}}if((c&7)===0){e:{if(he=a==="mouseover"||a==="pointerover",pe=a==="mouseout"||a==="pointerout",he&&f!==vh&&(Pe=f.relatedTarget||f.fromElement)&&(na(Pe)||Pe[ta]))break e;if((pe||he)&&(he=ge.window===ge?ge:(he=ge.ownerDocument)?he.defaultView||he.parentWindow:window,pe?(Pe=f.relatedTarget||f.toElement,pe=fe,Pe=Pe?na(Pe):null,Pe!==null&&(lt=s(Pe),Me=Pe.tag,Pe!==lt||Me!==5&&Me!==27&&Me!==6)&&(Pe=null)):(pe=null,Pe=fe),pe!==Pe)){if(Me=A2,me="onMouseLeave",se="onMouseEnter",J="mouse",(a==="pointerout"||a==="pointerover")&&(Me=C2,me="onPointerLeave",se="onPointerEnter",J="pointer"),lt=pe==null?he:ko(pe),ce=Pe==null?he:ko(Pe),he=new Me(me,J+"leave",pe,f,ge),he.target=lt,he.relatedTarget=ce,me=null,na(ge)===fe&&(Me=new Me(se,J+"enter",Pe,f,ge),Me.target=ce,Me.relatedTarget=lt,me=Me),lt=me,pe&&Pe)t:{for(Me=pe,se=Pe,J=0,ce=Me;ce;ce=ja(ce))J++;for(ce=0,me=se;me;me=ja(me))ce++;for(;0<J-ce;)Me=ja(Me),J--;for(;0<ce-J;)se=ja(se),ce--;for(;J--;){if(Me===se||se!==null&&Me===se.alternate)break t;Me=ja(Me),se=ja(se)}Me=null}else Me=null;pe!==null&&_3(ve,he,pe,Me,!1),Pe!==null&&lt!==null&&_3(ve,lt,Pe,Me,!0)}}e:{if(he=fe?ko(fe):window,pe=he.nodeName&&he.nodeName.toLowerCase(),pe==="select"||pe==="input"&&he.type==="file")var Ae=j2;else if(P2(he))if(L2)Ae=s6;else{Ae=r6;var qe=n6}else pe=he.nodeName,!pe||pe.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?fe&&_h(fe.elementType)&&(Ae=j2):Ae=i6;if(Ae&&(Ae=Ae(a,fe))){D2(ve,Ae,f,ge);break e}qe&&qe(a,he,fe),a==="focusout"&&fe&&he.type==="number"&&fe.memoizedProps.value!=null&&mh(he,"number",he.value)}switch(qe=fe?ko(fe):window,a){case"focusin":(P2(qe)||qe.contentEditable==="true")&&(da=qe,Mh=fe,Uo=null);break;case"focusout":Uo=Mh=da=null;break;case"mousedown":Ih=!0;break;case"contextmenu":case"mouseup":case"dragend":Ih=!1,H2(ve,f,ge);break;case"selectionchange":if(o6)break;case"keydown":case"keyup":H2(ve,f,ge)}var Ce;if(Rh)e:{switch(a){case"compositionstart":var Ie="onCompositionStart";break e;case"compositionend":Ie="onCompositionEnd";break e;case"compositionupdate":Ie="onCompositionUpdate";break e}Ie=void 0}else fa?I2(a,f)&&(Ie="onCompositionEnd"):a==="keydown"&&f.keyCode===229&&(Ie="onCompositionStart");Ie&&(N2&&f.locale!=="ko"&&(fa||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&fa&&(Ce=S2()):(xi=ge,wh="value"in xi?xi.value:xi.textContent,fa=!0)),qe=Cu(fe,Ie),0<qe.length&&(Ie=new R2(Ie,a,null,f,ge),ve.push({event:Ie,listeners:qe}),Ce?Ie.data=Ce:(Ce=O2(f),Ce!==null&&(Ie.data=Ce)))),(Ce=Zj?Qj(a,f):Jj(a,f))&&(Ie=Cu(fe,"onBeforeInput"),0<Ie.length&&(qe=new R2("onBeforeInput","beforeinput",null,f,ge),ve.push({event:qe,listeners:Ie}),qe.data=Ce)),V6(ve,a,fe,f,ge)}g3(ve,c)})}function hl(a,c,f){return{instance:a,listener:c,currentTarget:f}}function Cu(a,c){for(var f=c+"Capture",p=[];a!==null;){var v=a,b=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||b===null||(v=Mo(a,f),v!=null&&p.unshift(hl(a,v,b)),v=Mo(a,c),v!=null&&p.push(hl(a,v,b))),a.tag===3)return p;a=a.return}return[]}function ja(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function _3(a,c,f,p,v){for(var b=c._reactName,k=[];f!==null&&f!==p;){var L=f,K=L.alternate,fe=L.stateNode;if(L=L.tag,K!==null&&K===p)break;L!==5&&L!==26&&L!==27||fe===null||(K=fe,v?(fe=Mo(f,b),fe!=null&&k.unshift(hl(f,fe,K))):v||(fe=Mo(f,b),fe!=null&&k.push(hl(f,fe,K)))),f=f.return}k.length!==0&&a.push({event:c,listeners:k})}var X6=/\r\n?/g,Y6=/\u0000|\uFFFD/g;function v3(a){return(typeof a=="string"?a:""+a).replace(X6,`
`).replace(Y6,"")}function y3(a,c){return c=v3(c),v3(a)===c}function Nu(){}function ot(a,c,f,p,v,b){switch(f){case"children":typeof p=="string"?c==="body"||c==="textarea"&&p===""||la(a,p):(typeof p=="number"||typeof p=="bigint")&&c!=="body"&&la(a,""+p);break;case"className":Pc(a,"class",p);break;case"tabIndex":Pc(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Pc(a,f,p);break;case"style":x2(a,p,b);break;case"data":if(c!=="object"){Pc(a,"data",p);break}case"src":case"href":if(p===""&&(c!=="a"||f!=="href")){a.removeAttribute(f);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Lc(""+p),a.setAttribute(f,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(f==="formAction"?(c!=="input"&&ot(a,c,"name",v.name,v,null),ot(a,c,"formEncType",v.formEncType,v,null),ot(a,c,"formMethod",v.formMethod,v,null),ot(a,c,"formTarget",v.formTarget,v,null)):(ot(a,c,"encType",v.encType,v,null),ot(a,c,"method",v.method,v,null),ot(a,c,"target",v.target,v,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(f);break}p=Lc(""+p),a.setAttribute(f,p);break;case"onClick":p!=null&&(a.onclick=Nu);break;case"onScroll":p!=null&&He("scroll",a);break;case"onScrollEnd":p!=null&&He("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}f=Lc(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""+p):a.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,""):a.removeAttribute(f);break;case"capture":case"download":p===!0?a.setAttribute(f,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(f,p):a.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(f,p):a.removeAttribute(f);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(f):a.setAttribute(f,p);break;case"popover":He("beforetoggle",a),He("toggle",a),Oc(a,"popover",p);break;case"xlinkActuate":Gr(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Gr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Gr(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Gr(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Gr(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Gr(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Gr(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Gr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Gr(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Oc(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=Sj.get(f)||f,Oc(a,f,p))}}function tg(a,c,f,p,v,b){switch(f){case"style":x2(a,p,b);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(f=p.__html,f!=null){if(v.children!=null)throw Error(r(60));a.innerHTML=f}}break;case"children":typeof p=="string"?la(a,p):(typeof p=="number"||typeof p=="bigint")&&la(a,""+p);break;case"onScroll":p!=null&&He("scroll",a);break;case"onScrollEnd":p!=null&&He("scrollend",a);break;case"onClick":p!=null&&(a.onclick=Nu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!u2.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(v=f.endsWith("Capture"),c=f.slice(2,v?f.length-7:void 0),b=a[kn]||null,b=b!=null?b[f]:null,typeof b=="function"&&a.removeEventListener(c,b,v),typeof p=="function")){typeof b!="function"&&b!==null&&(f in a?a[f]=null:a.hasAttribute(f)&&a.removeAttribute(f)),a.addEventListener(c,p,v);break e}f in a?a[f]=p:p===!0?a.setAttribute(f,""):Oc(a,f,p)}}}function ln(a,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",a),He("load",a);var p=!1,v=!1,b;for(b in f)if(f.hasOwnProperty(b)){var k=f[b];if(k!=null)switch(b){case"src":p=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ot(a,c,b,k,f,null)}}v&&ot(a,c,"srcSet",f.srcSet,f,null),p&&ot(a,c,"src",f.src,f,null);return;case"input":He("invalid",a);var L=b=k=v=null,K=null,fe=null;for(p in f)if(f.hasOwnProperty(p)){var ge=f[p];if(ge!=null)switch(p){case"name":v=ge;break;case"type":k=ge;break;case"checked":K=ge;break;case"defaultChecked":fe=ge;break;case"value":b=ge;break;case"defaultValue":L=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,c));break;default:ot(a,c,p,ge,f,null)}}_2(a,b,L,K,fe,k,v,!1),Dc(a);return;case"select":He("invalid",a),p=k=b=null;for(v in f)if(f.hasOwnProperty(v)&&(L=f[v],L!=null))switch(v){case"value":b=L;break;case"defaultValue":k=L;break;case"multiple":p=L;default:ot(a,c,v,L,f,null)}c=b,f=k,a.multiple=!!p,c!=null?oa(a,!!p,c,!1):f!=null&&oa(a,!!p,f,!0);return;case"textarea":He("invalid",a),b=v=p=null;for(k in f)if(f.hasOwnProperty(k)&&(L=f[k],L!=null))switch(k){case"value":p=L;break;case"defaultValue":v=L;break;case"children":b=L;break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(r(91));break;default:ot(a,c,k,L,f,null)}y2(a,p,v,b),Dc(a);return;case"option":for(K in f)if(f.hasOwnProperty(K)&&(p=f[K],p!=null))switch(K){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:ot(a,c,K,p,f,null)}return;case"dialog":He("beforetoggle",a),He("toggle",a),He("cancel",a),He("close",a);break;case"iframe":case"object":He("load",a);break;case"video":case"audio":for(p=0;p<dl.length;p++)He(dl[p],a);break;case"image":He("error",a),He("load",a);break;case"details":He("toggle",a);break;case"embed":case"source":case"link":He("error",a),He("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in f)if(f.hasOwnProperty(fe)&&(p=f[fe],p!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ot(a,c,fe,p,f,null)}return;default:if(_h(c)){for(ge in f)f.hasOwnProperty(ge)&&(p=f[ge],p!==void 0&&tg(a,c,ge,p,f,void 0));return}}for(L in f)f.hasOwnProperty(L)&&(p=f[L],p!=null&&ot(a,c,L,p,f,null))}function G6(a,c,f,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,b=null,k=null,L=null,K=null,fe=null,ge=null;for(pe in f){var ve=f[pe];if(f.hasOwnProperty(pe)&&ve!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":K=ve;default:p.hasOwnProperty(pe)||ot(a,c,pe,null,p,ve)}}for(var he in p){var pe=p[he];if(ve=f[he],p.hasOwnProperty(he)&&(pe!=null||ve!=null))switch(he){case"type":b=pe;break;case"name":v=pe;break;case"checked":fe=pe;break;case"defaultChecked":ge=pe;break;case"value":k=pe;break;case"defaultValue":L=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(r(137,c));break;default:pe!==ve&&ot(a,c,he,pe,p,ve)}}gh(a,k,L,K,fe,ge,b,v);return;case"select":pe=k=L=he=null;for(b in f)if(K=f[b],f.hasOwnProperty(b)&&K!=null)switch(b){case"value":break;case"multiple":pe=K;default:p.hasOwnProperty(b)||ot(a,c,b,null,p,K)}for(v in p)if(b=p[v],K=f[v],p.hasOwnProperty(v)&&(b!=null||K!=null))switch(v){case"value":he=b;break;case"defaultValue":L=b;break;case"multiple":k=b;default:b!==K&&ot(a,c,v,b,p,K)}c=L,f=k,p=pe,he!=null?oa(a,!!f,he,!1):!!p!=!!f&&(c!=null?oa(a,!!f,c,!0):oa(a,!!f,f?[]:"",!1));return;case"textarea":pe=he=null;for(L in f)if(v=f[L],f.hasOwnProperty(L)&&v!=null&&!p.hasOwnProperty(L))switch(L){case"value":break;case"children":break;default:ot(a,c,L,null,p,v)}for(k in p)if(v=p[k],b=f[k],p.hasOwnProperty(k)&&(v!=null||b!=null))switch(k){case"value":he=v;break;case"defaultValue":pe=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==b&&ot(a,c,k,v,p,b)}v2(a,he,pe);return;case"option":for(var Pe in f)if(he=f[Pe],f.hasOwnProperty(Pe)&&he!=null&&!p.hasOwnProperty(Pe))switch(Pe){case"selected":a.selected=!1;break;default:ot(a,c,Pe,null,p,he)}for(K in p)if(he=p[K],pe=f[K],p.hasOwnProperty(K)&&he!==pe&&(he!=null||pe!=null))switch(K){case"selected":a.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:ot(a,c,K,he,p,pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Me in f)he=f[Me],f.hasOwnProperty(Me)&&he!=null&&!p.hasOwnProperty(Me)&&ot(a,c,Me,null,p,he);for(fe in p)if(he=p[fe],pe=f[fe],p.hasOwnProperty(fe)&&he!==pe&&(he!=null||pe!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(r(137,c));break;default:ot(a,c,fe,he,p,pe)}return;default:if(_h(c)){for(var lt in f)he=f[lt],f.hasOwnProperty(lt)&&he!==void 0&&!p.hasOwnProperty(lt)&&tg(a,c,lt,void 0,p,he);for(ge in p)he=p[ge],pe=f[ge],!p.hasOwnProperty(ge)||he===pe||he===void 0&&pe===void 0||tg(a,c,ge,he,p,pe);return}}for(var se in f)he=f[se],f.hasOwnProperty(se)&&he!=null&&!p.hasOwnProperty(se)&&ot(a,c,se,null,p,he);for(ve in p)he=p[ve],pe=f[ve],!p.hasOwnProperty(ve)||he===pe||he==null&&pe==null||ot(a,c,ve,he,p,pe)}var ng=null,rg=null;function ku(a){return a.nodeType===9?a:a.ownerDocument}function b3(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function x3(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function ig(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var sg=null;function K6(){var a=window.event;return a&&a.type==="popstate"?a===sg?!1:(sg=a,!0):(sg=null,!1)}var w3=typeof setTimeout=="function"?setTimeout:void 0,Z6=typeof clearTimeout=="function"?clearTimeout:void 0,T3=typeof Promise=="function"?Promise:void 0,Q6=typeof queueMicrotask=="function"?queueMicrotask:typeof T3<"u"?function(a){return T3.resolve(null).then(a).catch(J6)}:w3;function J6(a){setTimeout(function(){throw a})}function Li(a){return a==="head"}function S3(a,c){var f=c,p=0,v=0;do{var b=f.nextSibling;if(a.removeChild(f),b&&b.nodeType===8)if(f=b.data,f==="/$"){if(0<p&&8>p){f=p;var k=a.ownerDocument;if(f&1&&pl(k.documentElement),f&2&&pl(k.body),f&4)for(f=k.head,pl(f),k=f.firstChild;k;){var L=k.nextSibling,K=k.nodeName;k[No]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&k.rel.toLowerCase()==="stylesheet"||f.removeChild(k),k=L}}if(v===0){a.removeChild(b),wl(c);return}v--}else f==="$"||f==="$?"||f==="$!"?v++:p=f.charCodeAt(0)-48;else p=0;f=b}while(f);wl(c)}function ag(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":ag(f),fh(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}a.removeChild(f)}}function eL(a,c,f,p){for(;a.nodeType===1;){var v=f;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[No])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var b=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=xr(a.nextSibling),a===null)break}return null}function tL(a,c,f){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!f||(a=xr(a.nextSibling),a===null))return null;return a}function og(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function nL(a,c){var f=a.ownerDocument;if(a.data!=="$?"||f.readyState==="complete")c();else{var p=function(){c(),f.removeEventListener("DOMContentLoaded",p)};f.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function xr(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var lg=null;function E3(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var f=a.data;if(f==="$"||f==="$!"||f==="$?"){if(c===0)return a;c--}else f==="/$"&&c++}a=a.previousSibling}return null}function A3(a,c,f){switch(c=ku(f),a){case"html":if(a=c.documentElement,!a)throw Error(r(452));return a;case"head":if(a=c.head,!a)throw Error(r(453));return a;case"body":if(a=c.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function pl(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);fh(a)}var ar=new Map,R3=new Set;function Mu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ci=ee.d;ee.d={f:rL,r:iL,D:sL,C:aL,L:oL,m:lL,X:uL,S:cL,M:fL};function rL(){var a=ci.f(),c=wu();return a||c}function iL(a){var c=ra(a);c!==null&&c.tag===5&&c.type==="form"?Xw(c):ci.r(a)}var La=typeof document>"u"?null:document;function C3(a,c,f){var p=La;if(p&&typeof c=="string"&&c){var v=Jn(c);v='link[rel="'+a+'"][href="'+v+'"]',typeof f=="string"&&(v+='[crossorigin="'+f+'"]'),R3.has(v)||(R3.add(v),a={rel:a,crossOrigin:f,href:c},p.querySelector(v)===null&&(c=p.createElement("link"),ln(c,"link",a),en(c),p.head.appendChild(c)))}}function sL(a){ci.D(a),C3("dns-prefetch",a,null)}function aL(a,c){ci.C(a,c),C3("preconnect",a,c)}function oL(a,c,f){ci.L(a,c,f);var p=La;if(p&&a&&c){var v='link[rel="preload"][as="'+Jn(c)+'"]';c==="image"&&f&&f.imageSrcSet?(v+='[imagesrcset="'+Jn(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(v+='[imagesizes="'+Jn(f.imageSizes)+'"]')):v+='[href="'+Jn(a)+'"]';var b=v;switch(c){case"style":b=Ba(a);break;case"script":b=Ua(a)}ar.has(b)||(a=h({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:a,as:c},f),ar.set(b,a),p.querySelector(v)!==null||c==="style"&&p.querySelector(gl(b))||c==="script"&&p.querySelector(ml(b))||(c=p.createElement("link"),ln(c,"link",a),en(c),p.head.appendChild(c)))}}function lL(a,c){ci.m(a,c);var f=La;if(f&&a){var p=c&&typeof c.as=="string"?c.as:"script",v='link[rel="modulepreload"][as="'+Jn(p)+'"][href="'+Jn(a)+'"]',b=v;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Ua(a)}if(!ar.has(b)&&(a=h({rel:"modulepreload",href:a},c),ar.set(b,a),f.querySelector(v)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(ml(b)))return}p=f.createElement("link"),ln(p,"link",a),en(p),f.head.appendChild(p)}}}function cL(a,c,f){ci.S(a,c,f);var p=La;if(p&&a){var v=ia(p).hoistableStyles,b=Ba(a);c=c||"default";var k=v.get(b);if(!k){var L={loading:0,preload:null};if(k=p.querySelector(gl(b)))L.loading=5;else{a=h({rel:"stylesheet",href:a,"data-precedence":c},f),(f=ar.get(b))&&cg(a,f);var K=k=p.createElement("link");en(K),ln(K,"link",a),K._p=new Promise(function(fe,ge){K.onload=fe,K.onerror=ge}),K.addEventListener("load",function(){L.loading|=1}),K.addEventListener("error",function(){L.loading|=2}),L.loading|=4,Iu(k,c,p)}k={type:"stylesheet",instance:k,count:1,state:L},v.set(b,k)}}}function uL(a,c){ci.X(a,c);var f=La;if(f&&a){var p=ia(f).hoistableScripts,v=Ua(a),b=p.get(v);b||(b=f.querySelector(ml(v)),b||(a=h({src:a,async:!0},c),(c=ar.get(v))&&ug(a,c),b=f.createElement("script"),en(b),ln(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function fL(a,c){ci.M(a,c);var f=La;if(f&&a){var p=ia(f).hoistableScripts,v=Ua(a),b=p.get(v);b||(b=f.querySelector(ml(v)),b||(a=h({src:a,async:!0,type:"module"},c),(c=ar.get(v))&&ug(a,c),b=f.createElement("script"),en(b),ln(b,"link",a),f.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},p.set(v,b))}}function N3(a,c,f,p){var v=(v=Y.current)?Mu(v):null;if(!v)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Ba(f.href),f=ia(v).hoistableStyles,p=f.get(c),p||(p={type:"style",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){a=Ba(f.href);var b=ia(v).hoistableStyles,k=b.get(a);if(k||(v=v.ownerDocument||v,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,k),(b=v.querySelector(gl(a)))&&!b._p&&(k.instance=b,k.state.loading=5),ar.has(a)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ar.set(a,f),b||dL(v,a,f,k.state))),c&&p===null)throw Error(r(528,""));return k}if(c&&p!==null)throw Error(r(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Ua(f),f=ia(v).hoistableScripts,p=f.get(c),p||(p={type:"script",instance:null,count:0,state:null},f.set(c,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function Ba(a){return'href="'+Jn(a)+'"'}function gl(a){return'link[rel="stylesheet"]['+a+"]"}function k3(a){return h({},a,{"data-precedence":a.precedence,precedence:null})}function dL(a,c,f,p){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?p.loading=1:(c=a.createElement("link"),p.preload=c,c.addEventListener("load",function(){return p.loading|=1}),c.addEventListener("error",function(){return p.loading|=2}),ln(c,"link",f),en(c),a.head.appendChild(c))}function Ua(a){return'[src="'+Jn(a)+'"]'}function ml(a){return"script[async]"+a}function M3(a,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var p=a.querySelector('style[data-href~="'+Jn(f.href)+'"]');if(p)return c.instance=p,en(p),p;var v=h({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),en(p),ln(p,"style",v),Iu(p,f.precedence,a),c.instance=p;case"stylesheet":v=Ba(f.href);var b=a.querySelector(gl(v));if(b)return c.state.loading|=4,c.instance=b,en(b),b;p=k3(f),(v=ar.get(v))&&cg(p,v),b=(a.ownerDocument||a).createElement("link"),en(b);var k=b;return k._p=new Promise(function(L,K){k.onload=L,k.onerror=K}),ln(b,"link",p),c.state.loading|=4,Iu(b,f.precedence,a),c.instance=b;case"script":return b=Ua(f.src),(v=a.querySelector(ml(b)))?(c.instance=v,en(v),v):(p=f,(v=ar.get(b))&&(p=h({},f),ug(p,v)),a=a.ownerDocument||a,v=a.createElement("script"),en(v),ln(v,"link",p),a.head.appendChild(v),c.instance=v);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(p=c.instance,c.state.loading|=4,Iu(p,f.precedence,a));return c.instance}function Iu(a,c,f){for(var p=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=p.length?p[p.length-1]:null,b=v,k=0;k<p.length;k++){var L=p[k];if(L.dataset.precedence===c)b=L;else if(b!==v)break}b?b.parentNode.insertBefore(a,b.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(a,c.firstChild))}function cg(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function ug(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var Ou=null;function I3(a,c,f){if(Ou===null){var p=new Map,v=Ou=new Map;v.set(f,p)}else v=Ou,p=v.get(f),p||(p=new Map,v.set(f,p));if(p.has(a))return p;for(p.set(a,null),f=f.getElementsByTagName(a),v=0;v<f.length;v++){var b=f[v];if(!(b[No]||b[hn]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var k=b.getAttribute(c)||"";k=a+k;var L=p.get(k);L?L.push(b):p.set(k,[b])}}return p}function O3(a,c,f){a=a.ownerDocument||a,a.head.insertBefore(f,c==="title"?a.querySelector("head > title"):null)}function hL(a,c,f){if(f===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function P3(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var _l=null;function pL(){}function gL(a,c,f){if(_l===null)throw Error(r(475));var p=_l;if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var v=Ba(f.href),b=a.querySelector(gl(v));if(b){a=b._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(p.count++,p=Pu.bind(p),a.then(p,p)),c.state.loading|=4,c.instance=b,en(b);return}b=a.ownerDocument||a,f=k3(f),(v=ar.get(v))&&cg(f,v),b=b.createElement("link"),en(b);var k=b;k._p=new Promise(function(L,K){k.onload=L,k.onerror=K}),ln(b,"link",f),c.instance=b}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(p.count++,c=Pu.bind(p),a.addEventListener("load",c),a.addEventListener("error",c))}}function mL(){if(_l===null)throw Error(r(475));var a=_l;return a.stylesheets&&a.count===0&&fg(a,a.stylesheets),0<a.count?function(c){var f=setTimeout(function(){if(a.stylesheets&&fg(a,a.stylesheets),a.unsuspend){var p=a.unsuspend;a.unsuspend=null,p()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(f)}}:null}function Pu(){if(this.count--,this.count===0){if(this.stylesheets)fg(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Du=null;function fg(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Du=new Map,c.forEach(_L,a),Du=null,Pu.call(a))}function _L(a,c){if(!(c.state.loading&4)){var f=Du.get(a);if(f)var p=f.get(null);else{f=new Map,Du.set(a,f);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<v.length;b++){var k=v[b];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(f.set(k.dataset.precedence,k),p=k)}p&&f.set(null,p)}v=c.instance,k=v.getAttribute("data-precedence"),b=f.get(k)||p,b===p&&f.set(null,v),f.set(k,v),this.count++,p=Pu.bind(this),v.addEventListener("load",p),v.addEventListener("error",p),b?b.parentNode.insertBefore(v,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),c.state.loading|=4}}var vl={$$typeof:R,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function vL(a,c,f,p,v,b,k,L){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tt(0),this.hiddenUpdates=tt(null),this.identifierPrefix=p,this.onUncaughtError=v,this.onCaughtError=b,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function D3(a,c,f,p,v,b,k,L,K,fe,ge,ve){return a=new vL(a,c,f,k,L,K,fe,ve),c=1,b===!0&&(c|=24),b=Bn(3,null,null,c),a.current=b,b.stateNode=a,c=Wh(),c.refCount++,a.pooledCache=c,c.refCount++,b.memoizedState={element:p,isDehydrated:f,cache:c},Kh(b),a}function j3(a){return a?(a=ma,a):ma}function L3(a,c,f,p,v,b){v=j3(v),p.context===null?p.context=v:p.pendingContext=v,p=Si(c),p.payload={element:f},b=b===void 0?null:b,b!==null&&(p.callback=b),f=Ei(a,p,c),f!==null&&(Vn(f,a,c),Yo(f,a,c))}function B3(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var f=a.retryLane;a.retryLane=f!==0&&f<c?f:c}}function dg(a,c){B3(a,c),(a=a.alternate)&&B3(a,c)}function U3(a){if(a.tag===13){var c=ga(a,67108864);c!==null&&Vn(c,a,67108864),dg(a,67108864)}}var ju=!0;function yL(a,c,f,p){var v=q.T;q.T=null;var b=ee.p;try{ee.p=2,hg(a,c,f,p)}finally{ee.p=b,q.T=v}}function bL(a,c,f,p){var v=q.T;q.T=null;var b=ee.p;try{ee.p=8,hg(a,c,f,p)}finally{ee.p=b,q.T=v}}function hg(a,c,f,p){if(ju){var v=pg(p);if(v===null)eg(a,c,p,Lu,f),z3(a,p);else if(wL(v,a,c,f,p))p.stopPropagation();else if(z3(a,p),c&4&&-1<xL.indexOf(a)){for(;v!==null;){var b=ra(v);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var k=Nn(b.pendingLanes);if(k!==0){var L=b;for(L.pendingLanes|=2,L.entangledLanes|=2;k;){var K=1<<31-vt(k);L.entanglements[1]|=K,k&=~K}Lr(b),(rt&6)===0&&(bu=Ne()+500,fl(0))}}break;case 13:L=ga(b,2),L!==null&&Vn(L,b,2),wu(),dg(b,2)}if(b=pg(p),b===null&&eg(a,c,p,Lu,f),b===v)break;v=b}v!==null&&p.stopPropagation()}else eg(a,c,p,null,f)}}function pg(a){return a=yh(a),gg(a)}var Lu=null;function gg(a){if(Lu=null,a=na(a),a!==null){var c=s(a);if(c===null)a=null;else{var f=c.tag;if(f===13){if(a=o(c),a!==null)return a;a=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return Lu=a,null}function F3(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xn()){case Xt:return 2;case Cn:return 8;case jt:case fn:return 32;case Ye:return 268435456;default:return 32}default:return 32}}var mg=!1,Bi=null,Ui=null,Fi=null,yl=new Map,bl=new Map,zi=[],xL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function z3(a,c){switch(a){case"focusin":case"focusout":Bi=null;break;case"dragenter":case"dragleave":Ui=null;break;case"mouseover":case"mouseout":Fi=null;break;case"pointerover":case"pointerout":yl.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":bl.delete(c.pointerId)}}function xl(a,c,f,p,v,b){return a===null||a.nativeEvent!==b?(a={blockedOn:c,domEventName:f,eventSystemFlags:p,nativeEvent:b,targetContainers:[v]},c!==null&&(c=ra(c),c!==null&&U3(c)),a):(a.eventSystemFlags|=p,c=a.targetContainers,v!==null&&c.indexOf(v)===-1&&c.push(v),a)}function wL(a,c,f,p,v){switch(c){case"focusin":return Bi=xl(Bi,a,c,f,p,v),!0;case"dragenter":return Ui=xl(Ui,a,c,f,p,v),!0;case"mouseover":return Fi=xl(Fi,a,c,f,p,v),!0;case"pointerover":var b=v.pointerId;return yl.set(b,xl(yl.get(b)||null,a,c,f,p,v)),!0;case"gotpointercapture":return b=v.pointerId,bl.set(b,xl(bl.get(b)||null,a,c,f,p,v)),!0}return!1}function q3(a){var c=na(a.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=o(f),c!==null){a.blockedOn=c,gj(a.priority,function(){if(f.tag===13){var p=qn();p=lh(p);var v=ga(f,p);v!==null&&Vn(v,f,p),dg(f,p)}});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){a.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Bu(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var f=pg(a.nativeEvent);if(f===null){f=a.nativeEvent;var p=new f.constructor(f.type,f);vh=p,f.target.dispatchEvent(p),vh=null}else return c=ra(f),c!==null&&U3(c),a.blockedOn=f,!1;c.shift()}return!0}function V3(a,c,f){Bu(a)&&f.delete(c)}function TL(){mg=!1,Bi!==null&&Bu(Bi)&&(Bi=null),Ui!==null&&Bu(Ui)&&(Ui=null),Fi!==null&&Bu(Fi)&&(Fi=null),yl.forEach(V3),bl.forEach(V3)}function Uu(a,c){a.blockedOn===c&&(a.blockedOn=null,mg||(mg=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,TL)))}var Fu=null;function $3(a){Fu!==a&&(Fu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Fu===a&&(Fu=null);for(var c=0;c<a.length;c+=3){var f=a[c],p=a[c+1],v=a[c+2];if(typeof p!="function"){if(gg(p||f)===null)continue;break}var b=ra(f);b!==null&&(a.splice(c,3),c-=3,gp(b,{pending:!0,data:v,method:f.method,action:p},p,v))}}))}function wl(a){function c(K){return Uu(K,a)}Bi!==null&&Uu(Bi,a),Ui!==null&&Uu(Ui,a),Fi!==null&&Uu(Fi,a),yl.forEach(c),bl.forEach(c);for(var f=0;f<zi.length;f++){var p=zi[f];p.blockedOn===a&&(p.blockedOn=null)}for(;0<zi.length&&(f=zi[0],f.blockedOn===null);)q3(f),f.blockedOn===null&&zi.shift();if(f=(a.ownerDocument||a).$$reactFormReplay,f!=null)for(p=0;p<f.length;p+=3){var v=f[p],b=f[p+1],k=v[kn]||null;if(typeof b=="function")k||$3(f);else if(k){var L=null;if(b&&b.hasAttribute("formAction")){if(v=b,k=b[kn]||null)L=k.formAction;else if(gg(v)!==null)continue}else L=k.action;typeof L=="function"?f[p+1]=L:(f.splice(p,3),p-=3),$3(f)}}}function _g(a){this._internalRoot=a}zu.prototype.render=_g.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(r(409));var f=c.current,p=qn();L3(f,p,a,c,null,null)},zu.prototype.unmount=_g.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;L3(a.current,2,null,a,null,null),wu(),c[ta]=null}};function zu(a){this._internalRoot=a}zu.prototype.unstable_scheduleHydration=function(a){if(a){var c=o2();a={blockedOn:null,target:a,priority:c};for(var f=0;f<zi.length&&c!==0&&c<zi[f].priority;f++);zi.splice(f,0,a),f===0&&q3(a)}};var H3=e.version;if(H3!=="19.1.0")throw Error(r(527,H3,"19.1.0"));ee.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=u(c),a=a!==null?d(a):null,a=a===null?null:a.stateNode,a};var SL={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qu.isDisabled&&qu.supportsFiber)try{et=qu.inject(SL),Ve=qu}catch{}}return Sl.createRoot=function(a,c){if(!i(a))throw Error(r(299));var f=!1,p="",v=oT,b=lT,k=cT,L=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(v=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(k=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(L=c.unstable_transitionCallbacks)),c=D3(a,1,!1,null,null,f,p,v,b,k,L,null),a[ta]=c.current,Jp(a),new _g(c)},Sl.hydrateRoot=function(a,c,f){if(!i(a))throw Error(r(299));var p=!1,v="",b=oT,k=lT,L=cT,K=null,fe=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(b=f.onUncaughtError),f.onCaughtError!==void 0&&(k=f.onCaughtError),f.onRecoverableError!==void 0&&(L=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(K=f.unstable_transitionCallbacks),f.formState!==void 0&&(fe=f.formState)),c=D3(a,1,!0,c,f??null,p,v,b,k,L,K,fe),c.context=j3(null),f=c.current,p=qn(),p=lh(p),v=Si(p),v.callback=null,Ei(f,v,p),f=p,c.current.lanes=f,bt(c,f),Lr(c),a[ta]=c.current,Jp(a),new zu(c)},Sl.version="19.1.0",Sl}var tS;function jL(){if(tS)return yg.exports;tS=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),yg.exports=DL(),yg.exports}var LL=jL(),U=H0();const nc=$0(U),BL=CL({__proto__:null,default:nc},[U]);CM();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rc(){return rc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rc.apply(this,arguments)}var Qi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Qi||(Qi={}));const nS="popstate";function UL(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:o,hash:l}=r.location;return Lx("",{pathname:s,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:kM(i)}return zL(e,n,null,t)}function Qt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function NM(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function FL(){return Math.random().toString(36).substr(2,8)}function rS(t,e){return{usr:t.state,key:t.key,idx:e}}function Lx(t,e,n,r){return n===void 0&&(n=null),rc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?bo(e):e,{state:n,key:e&&e.key||r||FL()})}function kM(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function bo(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function zL(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,l=Qi.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(rc({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function g(){l=Qi.Pop;let x=h(),S=x==null?null:x-d;d=x,u&&u({action:l,location:w.location,delta:S})}function _(x,S){l=Qi.Push;let A=Lx(w.location,x,S);d=h()+1;let R=rS(A,d),E=w.createHref(A);try{o.pushState(R,"",E)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(E)}s&&u&&u({action:l,location:w.location,delta:1})}function y(x,S){l=Qi.Replace;let A=Lx(w.location,x,S);d=h();let R=rS(A,d),E=w.createHref(A);o.replaceState(R,"",E),s&&u&&u({action:l,location:w.location,delta:0})}function T(x){let S=i.location.origin!=="null"?i.location.origin:i.location.href,A=typeof x=="string"?x:kM(x);return A=A.replace(/ $/,"%20"),Qt(S,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,S)}let w={get action(){return l},get location(){return t(i,o)},listen(x){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(nS,g),u=x,()=>{i.removeEventListener(nS,g),u=null}},createHref(x){return e(i,x)},createURL:T,encodeLocation(x){let S=T(x);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:_,replace:y,go(x){return o.go(x)}};return w}var iS;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(iS||(iS={}));function qL(t,e,n){return n===void 0&&(n="/"),VL(t,e,n)}function VL(t,e,n,r){let i=typeof e=="string"?bo(e):e,s=OM(i.pathname||"/",n);if(s==null)return null;let o=MM(t);$L(o);let l=null;for(let u=0;l==null&&u<o.length;++u){let d=nB(s);l=JL(o[u],d)}return l}function MM(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,o,l)=>{let u={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(Qt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=Ms([r,u.relativePath]),h=n.concat(u);s.children&&s.children.length>0&&(Qt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),MM(s.children,e,h,d)),!(s.path==null&&!s.index)&&e.push({path:d,score:ZL(d,s.index),routesMeta:h})};return t.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))i(s,o);else for(let u of IM(s.path))i(s,o,u)}),e}function IM(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=IM(r.join("/")),l=[];return l.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&l.push(...o),l.map(u=>t.startsWith("/")&&u===""?"/":u)}function $L(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:QL(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const HL=/^:[\w-]+$/,WL=3,XL=2,YL=1,GL=10,KL=-2,sS=t=>t==="*";function ZL(t,e){let n=t.split("/"),r=n.length;return n.some(sS)&&(r+=KL),e&&(r+=XL),n.filter(i=>!sS(i)).reduce((i,s)=>i+(HL.test(s)?WL:s===""?YL:GL),r)}function QL(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function JL(t,e,n){let{routesMeta:r}=t,i={},s="/",o=[];for(let l=0;l<r.length;++l){let u=r[l],d=l===r.length-1,h=s==="/"?e:e.slice(s.length)||"/",g=eB({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),_=u.route;if(!g)return null;Object.assign(i,g.params),o.push({params:i,pathname:Ms([s,g.pathname]),pathnameBase:lB(Ms([s,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(s=Ms([s,g.pathnameBase]))}return o}function eB(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=tB(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((d,h,g)=>{let{paramName:_,isOptional:y}=h;if(_==="*"){let w=l[g]||"";o=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const T=l[g];return y&&!T?d[_]=void 0:d[_]=(T||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:o,pattern:t}}function tB(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),NM(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,u)=>(r.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function nB(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return NM(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function OM(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function rB(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?bo(t):t;return{pathname:n?n.startsWith("/")?n:iB(n,e):e,search:cB(r),hash:uB(i)}}function iB(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Sg(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function sB(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function aB(t,e){let n=sB(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function oB(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=bo(t):(i=rc({},t),Qt(!i.pathname||!i.pathname.includes("?"),Sg("?","pathname","search",i)),Qt(!i.pathname||!i.pathname.includes("#"),Sg("#","pathname","hash",i)),Qt(!i.search||!i.search.includes("#"),Sg("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=n;else{let g=e.length-1;if(!r&&o.startsWith("..")){let _=o.split("/");for(;_[0]==="..";)_.shift(),g-=1;i.pathname=_.join("/")}l=g>=0?e[g]:"/"}let u=rB(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const Ms=t=>t.join("/").replace(/\/\/+/g,"/"),lB=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),cB=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,uB=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function fB(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const PM=["post","put","patch","delete"];new Set(PM);const dB=["get",...PM];new Set(dB);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ic(){return ic=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ic.apply(this,arguments)}const W0=U.createContext(null),hB=U.createContext(null),Cd=U.createContext(null),Nd=U.createContext(null),$s=U.createContext({outlet:null,matches:[],isDataRoute:!1}),DM=U.createContext(null);function kd(){return U.useContext(Nd)!=null}function gc(){return kd()||Qt(!1),U.useContext(Nd).location}function jM(t){U.useContext(Cd).static||U.useLayoutEffect(t)}function mc(){let{isDataRoute:t}=U.useContext($s);return t?AB():pB()}function pB(){kd()||Qt(!1);let t=U.useContext(W0),{basename:e,future:n,navigator:r}=U.useContext(Cd),{matches:i}=U.useContext($s),{pathname:s}=gc(),o=JSON.stringify(aB(i,n.v7_relativeSplatPath)),l=U.useRef(!1);return jM(()=>{l.current=!0}),U.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let g=oB(d,JSON.parse(o),s,h.relative==="path");t==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:Ms([e,g.pathname])),(h.replace?r.replace:r.push)(g,h.state,h)},[e,r,o,s,t])}function LM(){let{matches:t}=U.useContext($s),e=t[t.length-1];return e?e.params:{}}function gB(t,e){return mB(t,e)}function mB(t,e,n,r){kd()||Qt(!1);let{navigator:i}=U.useContext(Cd),{matches:s}=U.useContext($s),o=s[s.length-1],l=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=gc(),h;if(e){var g;let x=typeof e=="string"?bo(e):e;u==="/"||(g=x.pathname)!=null&&g.startsWith(u)||Qt(!1),h=x}else h=d;let _=h.pathname||"/",y=_;if(u!=="/"){let x=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(x.length).join("/")}let T=qL(t,{pathname:y}),w=xB(T&&T.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:Ms([u,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?u:Ms([u,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),s,n,r);return e&&w?U.createElement(Nd.Provider,{value:{location:ic({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Qi.Pop}},w):w}function _B(){let t=EB(),e=fB(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return U.createElement(U.Fragment,null,U.createElement("h2",null,"Unexpected Application Error!"),U.createElement("h3",{style:{fontStyle:"italic"}},e),n?U.createElement("pre",{style:i},n):null,null)}const vB=U.createElement(_B,null);class yB extends U.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?U.createElement($s.Provider,{value:this.props.routeContext},U.createElement(DM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function bB(t){let{routeContext:e,match:n,children:r}=t,i=U.useContext(W0);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),U.createElement($s.Provider,{value:e},r)}function xB(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(i=n)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(g=>g.route.id&&(l==null?void 0:l[g.route.id])!==void 0);h>=0||Qt(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let g=o[h];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=h),g.route.id){let{loaderData:_,errors:y}=n,T=g.route.loader&&_[g.route.id]===void 0&&(!y||y[g.route.id]===void 0);if(g.route.lazy||T){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,g,_)=>{let y,T=!1,w=null,x=null;n&&(y=l&&g.route.id?l[g.route.id]:void 0,w=g.route.errorElement||vB,u&&(d<0&&_===0?(RB("route-fallback"),T=!0,x=null):d===_&&(T=!0,x=g.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,_+1)),A=()=>{let R;return y?R=w:T?R=x:g.route.Component?R=U.createElement(g.route.Component,null):g.route.element?R=g.route.element:R=h,U.createElement(bB,{match:g,routeContext:{outlet:h,matches:S,isDataRoute:n!=null},children:R})};return n&&(g.route.ErrorBoundary||g.route.errorElement||_===0)?U.createElement(yB,{location:n.location,revalidation:n.revalidation,component:w,error:y,children:A(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):A()},null)}var BM=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(BM||{}),UM=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(UM||{});function wB(t){let e=U.useContext(W0);return e||Qt(!1),e}function TB(t){let e=U.useContext(hB);return e||Qt(!1),e}function SB(t){let e=U.useContext($s);return e||Qt(!1),e}function FM(t){let e=SB(),n=e.matches[e.matches.length-1];return n.route.id||Qt(!1),n.route.id}function EB(){var t;let e=U.useContext(DM),n=TB(),r=FM();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function AB(){let{router:t}=wB(BM.UseNavigateStable),e=FM(UM.UseNavigateStable),n=U.useRef(!1);return jM(()=>{n.current=!0}),U.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,ic({fromRouteId:e},s)))},[t,e])}const aS={};function RB(t,e,n){aS[t]||(aS[t]=!0)}function CB(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Ol(t){Qt(!1)}function NB(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Qi.Pop,navigator:s,static:o=!1,future:l}=t;kd()&&Qt(!1);let u=e.replace(/^\/*/,"/"),d=U.useMemo(()=>({basename:u,navigator:s,static:o,future:ic({v7_relativeSplatPath:!1},l)}),[u,l,s,o]);typeof r=="string"&&(r=bo(r));let{pathname:h="/",search:g="",hash:_="",state:y=null,key:T="default"}=r,w=U.useMemo(()=>{let x=OM(h,u);return x==null?null:{location:{pathname:x,search:g,hash:_,state:y,key:T},navigationType:i}},[u,h,g,_,y,T,i]);return w==null?null:U.createElement(Cd.Provider,{value:d},U.createElement(Nd.Provider,{children:n,value:w}))}function kB(t){let{children:e,location:n}=t;return gB(Bx(e),n)}new Promise(()=>{});function Bx(t,e){e===void 0&&(e=[]);let n=[];return U.Children.forEach(t,(r,i)=>{if(!U.isValidElement(r))return;let s=[...e,i];if(r.type===U.Fragment){n.push.apply(n,Bx(r.props.children,s));return}r.type!==Ol&&Qt(!1),!r.props.index||!r.props.children||Qt(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Bx(r.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const MB="6";try{window.__reactRouterVersion=MB}catch{}const IB="startTransition",oS=BL[IB];function OB(t){let{basename:e,children:n,future:r,window:i}=t,s=U.useRef();s.current==null&&(s.current=UL({window:i,v5Compat:!0}));let o=s.current,[l,u]=U.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=U.useCallback(g=>{d&&oS?oS(()=>u(g)):u(g)},[u,d]);return U.useLayoutEffect(()=>o.listen(h),[o,h]),U.useEffect(()=>CB(r),[r]),U.createElement(NB,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}var lS;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(lS||(lS={}));var cS;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(cS||(cS={}));const PB=()=>(console.log("Using default API base: /api"),"/api"),mn={BASE_URL:PB(),ENDPOINTS:{CREATE_SESSION:"/create-session",GET_SESSION:"/session",UPLOAD:"/upload-tree-sequence",UPLOADED_FILES:"/uploaded-files/",TREE_SEQUENCE_METADATA:"/tree-sequence-metadata",DELETE_TREE_SEQUENCE:"/tree-sequence",DOWNLOAD_TREE_SEQUENCE:"/download-tree-sequence",GRAPH_DATA:"/graph-data",INFER_LOCATIONS_FAST:"/infer-locations-fast",INFER_LOCATIONS_GAIA_QUADRATIC:"/infer-locations-gaia-quadratic",INFER_LOCATIONS_MIDPOINT:"/infer-locations-midpoint",INFER_LOCATIONS_SPARG:"/infer-locations-sparg",INFER_TIMES_TSDATE:"/infer-times-tsdate",SIMULATE_TREE_SEQUENCE:"/simulate-tree-sequence/"}},DB={LOADING_DOTS_INTERVAL:420},Ji={DEFAULT_MAX_SAMPLES:25,MIN_SAMPLES:2,WARNING_THRESHOLD:25},Eg={ACCEPTED_FORMATS:{"application/octet-stream":[".trees",".tsz"],"application/x-trees":[".trees"],"application/x-tsz":[".tsz"]},CSV_FORMATS:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]}},El={UPLOAD_FAILED:"Upload failed",DOWNLOAD_FAILED:"Download failed",FETCH_FAILED:"Failed to fetch data",NO_SPATIAL_DATA:"No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.",NO_SPATIAL_RANGE:"No spatial data found in this genomic range.",UNKNOWN_ERROR:"Unknown error occurred"},zM=U.createContext(void 0);function jB({children:t}){const[e,n]=U.useState(null),[r,i]=U.useState(Ji.DEFAULT_MAX_SAMPLES),s=l=>{if(n(l),l!=null&&l.num_samples){const u=Math.min(Ji.DEFAULT_MAX_SAMPLES,l.num_samples);i(u)}},o=l=>{if(e!=null&&e.num_samples){const u=Math.max(Ji.MIN_SAMPLES,Math.min(l,e.num_samples));i(u)}else i(Math.min(l,Ji.DEFAULT_MAX_SAMPLES))};return m.jsx(zM.Provider,{value:{treeSequence:e,setTreeSequence:s,maxSamples:r,setMaxSamples:o},children:t})}function Hs(){const t=U.useContext(zM);if(t===void 0)throw new Error("useTreeSequence must be used within a TreeSequenceProvider");return t}var qM=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t))(qM||{});class LB{constructor(){j(this,"logLevel");j(this,"isDevelopment");this.isDevelopment=!1,this.logLevel=this.isDevelopment?0:2}shouldLog(e){return e>=this.logLevel}formatMessage(e,n,r){const i=new Date().toISOString(),s=r!=null&&r.component?`[${r.component}]`:"",o=r!=null&&r.action?`(${r.action})`:"";return`[${i}] ${e} ${s}${o} ${n}`}logToConsole(e,n,r,i){const s=qM[e],o=this.formatMessage(s,n,r);switch(e){case 0:console.debug(o,r==null?void 0:r.data);break;case 1:console.info(o,r==null?void 0:r.data);break;case 2:console.warn(o,r==null?void 0:r.data);break;case 3:console.error(o,i||(r==null?void 0:r.error),r==null?void 0:r.data);break}}debug(e,n){this.shouldLog(0)&&this.logToConsole(0,e,n)}info(e,n){this.shouldLog(1)&&this.logToConsole(1,e,n)}warn(e,n){this.shouldLog(2)&&this.logToConsole(2,e,n)}error(e,n){this.shouldLog(3)&&this.logToConsole(3,e,n,n==null?void 0:n.error)}apiCall(e,n="GET",r){this.debug(`API ${n} ${e}`,{action:"api-call",data:{endpoint:e,method:n,payload:r}})}apiSuccess(e,n="GET",r){this.info(`API ${n} ${e} succeeded`,{action:"api-success",data:{endpoint:e,method:n,response:r}})}apiError(e,n,r="GET"){this.error(`API ${r} ${e} failed`,{action:"api-error",error:n,data:{endpoint:e,method:r}})}componentMount(e,n){this.debug(`${e} mounted`,{component:e,action:"mount",data:n})}componentUnmount(e){this.debug(`${e} unmounted`,{component:e,action:"unmount"})}userAction(e,n,r){this.info(`User action: ${e}`,{component:r,action:"user-action",data:n})}dataProcessing(e,n,r,i){this.debug(`Data processing: ${e}`,{component:n,action:"data-processing",data:{operation:e,inputSize:r,outputSize:i}})}navigation(e,n){this.info(`Navigation: ${e}  ${n}`,{action:"navigation",data:{from:e,to:n}})}performance(e,n,r){this.info(`Performance: ${e} took ${n}ms`,{component:r,action:"performance",data:{operation:e,duration:n}})}}const $n=new LB,Ee={debug:(t,e)=>$n.debug(t,e),info:(t,e)=>$n.info(t,e),warn:(t,e)=>$n.warn(t,e),error:(t,e)=>$n.error(t,e),api:{call:(t,e,n)=>$n.apiCall(t,e,n),success:(t,e,n)=>$n.apiSuccess(t,e,n),error:(t,e,n)=>$n.apiError(t,e,n)},component:{mount:(t,e)=>$n.componentMount(t,e),unmount:t=>$n.componentUnmount(t)},user:{action:(t,e,n)=>$n.userAction(t,e,n)},data:{processing:(t,e,n,r)=>$n.dataProcessing(t,e,n,r)},nav:(t,e)=>$n.navigation(t,e),perf:(t,e,n)=>$n.performance(t,e,n)};class BB{constructor(){j(this,"baseURL");this.baseURL=mn.BASE_URL}async request(e,n={}){const r=`${this.baseURL}${e}`,i=n.method||"GET";Ee.api.call(e,i,n.body);try{const s=new AbortController,o=setTimeout(()=>s.abort(),6e4),l=await fetch(r,{...n,headers:{"Content-Type":"application/json",...n.headers},signal:s.signal});if(clearTimeout(o),!l.ok){const d=await l.json().catch(()=>null),h={message:`HTTP error! status: ${l.status}`,status:l.status,details:(d==null?void 0:d.detail)||"No details available"};throw Ee.api.error(e,new Error(h.message),i),h}const u=await l.json();return Ee.api.success(e,i,u),{data:u,status:l.status}}catch(s){if(s instanceof Error){if(s.name==="AbortError"){const l=new Error("Request timed out after 60 seconds");throw Ee.api.error(e,l,i),l}throw Ee.api.error(e,s,i),s}const o={message:El.UNKNOWN_ERROR,details:String(s)};throw Ee.api.error(e,new Error(o.message),i),o}}async uploadFile(e,n){const r=`${this.baseURL}${e}`,i=new FormData;i.append("file",n),Ee.api.call(e,"POST",{filename:n.name,size:n.size});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok)throw new Error(El.UPLOAD_FAILED);const o=await s.json();return Ee.api.success(e,"POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:El.UPLOAD_FAILED;throw Ee.api.error(e,new Error(o),"POST"),s}}async getCurrentSession(){return this.request(mn.ENDPOINTS.GET_SESSION)}async uploadTreeSequence(e){return this.uploadFile(mn.ENDPOINTS.UPLOAD,e)}async getUploadedFiles(){return this.request(mn.ENDPOINTS.UPLOADED_FILES)}async getTreeSequenceMetadata(e){return this.request(`${mn.ENDPOINTS.TREE_SEQUENCE_METADATA}/${encodeURIComponent(e)}`)}async deleteTreeSequence(e){return this.request(`${mn.ENDPOINTS.DELETE_TREE_SEQUENCE}/${encodeURIComponent(e)}`,{method:"DELETE"})}async downloadTreeSequence(e,n="trees"){const r=`${this.baseURL}${mn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE}/${encodeURIComponent(e)}?format=${n}`;Ee.api.call(mn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{filename:e,format:n});try{const i=await fetch(r);if(!i.ok)throw new Error(El.DOWNLOAD_FAILED);const s=await i.blob();return Ee.api.success(mn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,"GET",{size:s.size,format:n}),s}catch(i){const s=i instanceof Error?i.message:El.DOWNLOAD_FAILED;throw Ee.api.error(mn.ENDPOINTS.DOWNLOAD_TREE_SEQUENCE,new Error(s),"GET"),i}}async getGraphData(e,n={}){const r=new URLSearchParams;n.maxSamples&&r.append("max_samples",n.maxSamples.toString()),n.genomicStart!==void 0&&r.append("genomic_start",n.genomicStart.toString()),n.genomicEnd!==void 0&&r.append("genomic_end",n.genomicEnd.toString()),n.treeStartIdx!==void 0&&r.append("tree_start_idx",n.treeStartIdx.toString()),n.treeEndIdx!==void 0&&r.append("tree_end_idx",n.treeEndIdx.toString()),n.sampleOrder&&r.append("sample_order",n.sampleOrder);const i=`${mn.ENDPOINTS.GRAPH_DATA}/${encodeURIComponent(e)}?${r}`;return this.request(i)}async inferLocationsFast(e){return this.request(mn.ENDPOINTS.INFER_LOCATIONS_FAST,{method:"POST",body:JSON.stringify(e)})}async inferLocationsSparg(e){return this.request(mn.ENDPOINTS.INFER_LOCATIONS_SPARG,{method:"POST",body:JSON.stringify(e)})}async inferLocationsGaiaQuadratic(e){return this.request("/infer-locations-gaia-quadratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsGaiaLinear(e){return this.request("/infer-locations-gaia-linear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async inferLocationsMidpoint(e){return this.request(mn.ENDPOINTS.INFER_LOCATIONS_MIDPOINT,{method:"POST",body:JSON.stringify(e)})}async simulateTreeSequence(e){return this.request(mn.ENDPOINTS.SIMULATE_TREE_SEQUENCE,{method:"POST",body:JSON.stringify(e)})}async uploadLocationCSV(e,n){const r=`${this.baseURL}/upload-location-csv?csv_type=${n}`,i=new FormData;i.append("file",e),Ee.api.call("/upload-location-csv","POST",{filename:e.name,csvType:n});try{const s=await fetch(r,{method:"POST",body:i});if(!s.ok){const l=await s.json().catch(()=>null);throw new Error((l==null?void 0:l.detail)||"Failed to upload CSV")}const o=await s.json();return Ee.api.success("/upload-location-csv","POST",o),{data:o,status:s.status}}catch(s){const o=s instanceof Error?s.message:"Failed to upload CSV";throw Ee.api.error("/upload-location-csv",new Error(o),"POST"),s}}async updateTreeSequenceLocations(e){return this.request("/update-tree-sequence-locations",{method:"POST",body:JSON.stringify(e)})}async getAvailableCRS(){return this.request("/geographic/crs")}async getAvailableShapes(){return this.request("/geographic/shapes")}async uploadShapefile(e){return this.uploadFile("/geographic/upload-shapefile",e)}async getShapeData(e){return this.request(`/geographic/shape/${encodeURIComponent(e)}`)}async transformCoordinates(e){return this.request("/geographic/transform-coordinates",{method:"POST",body:JSON.stringify(e)})}async validateSpatialData(e){return this.request("/geographic/validate-spatial",{method:"POST",body:JSON.stringify(e)})}async inferTimesTsdate(e){return this.request(mn.ENDPOINTS.INFER_TIMES_TSDATE,{method:"POST",body:JSON.stringify(e)})}}const kt=new BB,mt={getCurrentSession:()=>kt.getCurrentSession(),uploadTreeSequence:t=>kt.uploadTreeSequence(t),getUploadedFiles:()=>kt.getUploadedFiles(),getTreeSequenceMetadata:t=>kt.getTreeSequenceMetadata(t),deleteTreeSequence:t=>kt.deleteTreeSequence(t),downloadTreeSequence:(t,e="trees")=>kt.downloadTreeSequence(t,e),getGraphData:(t,e)=>kt.getGraphData(t,e),inferLocationsFast:t=>kt.inferLocationsFast(t),inferLocationsSparg:t=>kt.inferLocationsSparg(t),inferLocationsGaiaQuadratic:t=>kt.inferLocationsGaiaQuadratic(t),inferLocationsGaiaLinear:t=>kt.inferLocationsGaiaLinear(t),inferLocationsMidpoint:t=>kt.inferLocationsMidpoint(t),simulateTreeSequence:t=>kt.simulateTreeSequence(t),uploadLocationCSV:(t,e)=>kt.uploadLocationCSV(t,e),updateTreeSequenceLocations:t=>kt.updateTreeSequenceLocations(t),getAvailableCRS:()=>kt.getAvailableCRS(),getAvailableShapes:()=>kt.getAvailableShapes(),uploadShapefile:t=>kt.uploadShapefile(t),getShapeData:t=>kt.getShapeData(t),transformCoordinates:t=>kt.transformCoordinates(t),validateSpatialData:t=>kt.validateSpatialData(t),inferTimesTsdate:t=>kt.inferTimesTsdate(t)},uS={tskit:{background:"#03303E",containerBackground:"#0f1419",nodeDefault:[96,160,183,255],nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:[80,160,175,255],nodeSelected:[255,255,255,255],edgeDefault:[153,153,153,102],edgeHighlight:[255,255,255,200],text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"},grayscale:{background:"#ffffff",containerBackground:"#f8f9fa",nodeDefault:[100,100,100,255],nodeRoot:[50,50,50,255],nodeSample:[70,70,70,255],nodeCombined:[120,120,120,255],nodeSelected:[0,0,0,255],edgeDefault:[140,140,140,128],edgeHighlight:[40,40,40,200],text:"#212529",textSecondary:"#6c757d",border:"#dee2e6",exportBackground:"#ffffff",accentPrimary:"#085167",accentSecondary:"#085167",geographicGrid:[140,140,140,102],temporalGrid:[140,140,140,77],tooltipBackground:"rgba(0, 0, 0, 0.9)",tooltipText:"#ffffff",headerText:"#212529",controlPanelText:"#212529",buttonText:"#212529"}},VM=U.createContext(void 0),$u="argscape_custom_themes",Ag="argscape_selected_theme",Al="argscape_selected_custom_theme",UB=({children:t})=>{const[e,n]=U.useState("tskit"),[r,i]=U.useState([]),[s,o]=U.useState(null),[l,u]=U.useState("any");U.useEffect(()=>{try{const x=localStorage.getItem($u);x&&i(JSON.parse(x));const S=localStorage.getItem(Ag);S&&(S==="tskit"||S==="grayscale"||S==="custom")&&n(S);const A=localStorage.getItem(Al);A&&o(A)}catch(x){console.warn("Failed to load saved color themes:",x)}},[]);const d=U.useCallback(x=>{n(x),localStorage.setItem(Ag,x)},[]),h=U.useCallback(x=>{o(x),x?localStorage.setItem(Al,x):localStorage.removeItem(Al)},[]),g=U.useCallback((x,S)=>{const A=`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R={id:A,name:x,colors:S};return i(E=>{const C=[...E,R];return localStorage.setItem($u,JSON.stringify(C)),C}),n("custom"),o(A),localStorage.setItem(Ag,"custom"),localStorage.setItem(Al,A),A},[]),_=U.useCallback(x=>{i(S=>{const A=S.filter(R=>R.id!==x);return localStorage.setItem($u,JSON.stringify(A)),A}),s===x&&(o(null),localStorage.removeItem(Al))},[s]),y=U.useCallback((x,S,A)=>{i(R=>{const E=R.map(C=>C.id===x?{...C,name:S,colors:A}:C);return localStorage.setItem($u,JSON.stringify(E)),E})},[]),T=nc.useMemo(()=>{if(e==="custom"&&s){const x=r.find(S=>S.id===s);if(x)return x.colors}return uS[e]||uS.tskit},[e,s,r]),w={theme:e,setTheme:d,colors:T,customThemes:r,selectedCustomTheme:s,setSelectedCustomTheme:h,saveCustomTheme:g,deleteCustomTheme:_,updateCustomTheme:y,currentVisualizationType:l,setCurrentVisualizationType:u};return m.jsx(VM.Provider,{value:w,children:t})},Ht=()=>{const t=U.useContext(VM);if(t===void 0)throw new Error("useColorTheme must be used within a ColorThemeProvider");return t},$M=t=>{if(t.startsWith("#")){const n=t.slice(1),r=parseInt(n.substr(0,2),16),i=parseInt(n.substr(2,2),16),s=parseInt(n.substr(4,2),16);return[r,i,s,255]}const e=t.match(/rgba?\(([^)]+)\)/);if(e){const n=e[1].split(",").map(r=>parseFloat(r.trim()));return[Math.round(n[0]),Math.round(n[1]),Math.round(n[2]),Math.round((n[3]??1)*255)]}return[128,128,128,255]},HM=t=>{const e=["background","nodeSample","nodeRoot","nodeDefault","edgeDefault"];switch(t){case"force-directed":return e;case"spatial-3d":return[...e,"geographicGrid","temporalGrid"];case"any":default:return[...e,"geographicGrid","temporalGrid"]}},FB=t=>{const e=["background","containerBackground","nodeDefault","nodeRoot","nodeSample","nodeCombined","nodeSelected","edgeDefault","edgeHighlight","text","textSecondary","border","exportBackground","accentPrimary","accentSecondary","geographicGrid","temporalGrid","tooltipBackground","tooltipText","headerText","controlPanelText","buttonText"],n=HM(t);return e.filter(r=>!n.includes(r))},WM=t=>`#${t[0].toString(16).padStart(2,"0")}${t[1].toString(16).padStart(2,"0")}${t[2].toString(16).padStart(2,"0")}`;function _c({className:t="",style:e={},size:n="medium",showSubtext:r=!1}){const i=mc(),{colors:s}=Ht(),o=()=>{i("/",{state:{forceIntro:!0}})},l=()=>{switch(n){case"small":return"text-xl md:text-2xl";case"medium":return"text-2xl md:text-3xl";case"large":return"text-[3rem] md:text-[4rem]";default:return"text-2xl md:text-3xl"}};return m.jsxs("div",{className:"cursor-pointer select-none",onClick:o,children:[m.jsxs("h1",{className:`${l()} font-extrabold tracking-tight ${t}`,style:{letterSpacing:"-0.04em",...e},children:["ARG",m.jsx("span",{style:{color:s.accentPrimary},children:"scape"})]}),r&&m.jsx("div",{className:"mt-2 text-center",children:m.jsx("div",{className:"text-sm font-medium",style:{color:s.accentPrimary},children:"Visualizing Ancestral Recombination Graphs"})})]})}function XM({isOpen:t,title:e,message:n,buttonText:r="OK",onClose:i,type:s="info"}){if(U.useEffect(()=>{const h=g=>{g.key==="Escape"&&i()};return t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[t,i]),!t)return null;const o=()=>{switch(s){case"success":return{icon:m.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-green-500/10",buttonColor:"bg-green-600 hover:bg-green-500 text-white"};case"error":return{icon:m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-red-500/10",buttonColor:"bg-red-600 hover:bg-red-500 text-white"};default:return{icon:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),bgColor:"bg-sp-pale-green/10",buttonColor:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}}},{icon:l,bgColor:u,buttonColor:d}=o();return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:i}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u}`,children:l}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("div",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),m.jsx("div",{className:"flex justify-end",children:m.jsx("button",{onClick:i,className:`font-bold py-3 px-6 rounded-xl transition-all duration-200 ${d}`,children:r})})]})})]})}function X0({filename:t,onError:e}){const[n,r]=U.useState(!1),i=async s=>{try{const o=await mt.downloadTreeSequence(t,s),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const d=`${t.replace(/\.(trees|tsz)$/,"")}.${s}`;u.setAttribute("download",d),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),Ee.user.action("download-tree-sequence",{filename:t,format:s},"DownloadDropdown"),r(!1)}catch(o){Ee.error("Download failed",{component:"DownloadDropdown",error:o instanceof Error?o:new Error(String(o)),data:{filename:t}}),e&&o instanceof Error&&e(o)}};return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>r(!n),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download",m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&m.jsx("div",{className:"absolute z-50 w-48 mt-2 right-0 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsxs("div",{className:"py-2",children:[m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("trees"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download .trees"]}),m.jsxs("button",{className:"w-full px-4 py-2 text-left hover:bg-sp-pale-green hover:text-sp-very-dark-blue transition-colors duration-200 flex items-center gap-2",onClick:()=>i("tsz"),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Download .tsz"]})]})})]})}function YM({isOpen:t,title:e,message:n,confirmText:r="Confirm",cancelText:i="Cancel",onConfirm:s,onCancel:o,type:l="default"}){if(U.useEffect(()=>{const d=h=>{h.key==="Escape"&&o()};return t&&(document.addEventListener("keydown",d),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}},[t,o]),!t)return null;const u=l==="danger";return m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:o}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u?"bg-red-500/10":"bg-sp-pale-green/10"}`,children:u?m.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white break-words",children:e})]}),m.jsx("p",{className:"text-sp-white/80 mb-6 leading-relaxed break-words whitespace-pre-wrap",children:n}),m.jsxs("div",{className:"flex gap-3",children:[m.jsx("button",{onClick:o,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:i}),m.jsx("button",{onClick:s,className:`flex-1 font-bold py-3 px-4 rounded-xl transition-all duration-200 ${u?"bg-red-600 hover:bg-red-500 text-white":"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue"}`,children:r})]})]})})]})}function GM({onSelect:t,className:e=""}){const[n,r]=U.useState([]),[i,s]=U.useState({}),[o,l]=U.useState(!1),[u,d]=U.useState(""),[h,g]=U.useState(new Set),[_,y]=U.useState(-1),{treeSequence:T}=Hs(),[w,x]=U.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"default"}),[S,A]=U.useState({isOpen:!1,title:"",message:"",type:"info"}),R=async()=>{var N;l(!0);try{Ee.data.processing("fetch-available-tree-sequences","TreeSequenceSelector");const z=(await mt.getUploadedFiles()).data;r(z.uploaded_tree_sequences||[]),Ee.info(`Loaded ${((N=z.uploaded_tree_sequences)==null?void 0:N.length)||0} tree sequences`,{component:"TreeSequenceSelector",action:"fetch-available"})}catch(B){Ee.error("Failed to fetch available tree sequences",{component:"TreeSequenceSelector",error:B instanceof Error?B:new Error(String(B))}),r([])}finally{l(!1)}},E=async N=>{try{Ee.data.processing("fetch-metadata","TreeSequenceSelector",void 0,void 0);const z=(await mt.getTreeSequenceMetadata(N)).data;return Ee.debug(`Retrieved metadata for ${N}`,{component:"TreeSequenceSelector",data:{filename:N,num_samples:z.num_samples,num_nodes:z.num_nodes,num_mutations:z.num_mutations}}),{filename:z.filename,num_samples:z.num_samples,num_nodes:z.num_nodes,num_edges:z.num_edges,num_trees:z.num_trees,num_mutations:z.num_mutations,has_temporal:z.has_temporal,has_sample_spatial:z.has_sample_spatial,has_all_spatial:z.has_all_spatial,spatial_status:z.spatial_status}}catch(B){return Ee.error(`Failed to get metadata for ${N}`,{component:"TreeSequenceSelector",error:B instanceof Error?B:new Error(String(B)),data:{filename:N}}),null}};U.useEffect(()=>{R()},[]),U.useEffect(()=>{const N=async()=>{const B={};for(const z of n){const Q=await E(z);Q&&(B[z]=Q)}s(B)};n.length>0&&N()},[n]);const C=()=>{u&&i[u]&&t(i[u])},I=(N,B,z)=>{if((z.shiftKey||z.ctrlKey||z.metaKey)&&z.preventDefault(),z.shiftKey&&_!==-1){const Q=Math.min(_,B),H=Math.max(_,B),W=new Set;for(let q=Q;q<=H;q++)W.add(n[q]);g(W)}else if(z.ctrlKey||z.metaKey){const Q=new Set(h);Q.has(N)?Q.delete(N):Q.add(N),g(Q),y(B)}else d(N),g(new Set([N])),y(B)},O=async(N,B)=>{B.stopPropagation(),x({isOpen:!0,title:"Delete Tree Sequence",message:`Are you sure you want to delete "${N}"?`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{Ee.user.action("delete-tree-sequence",{filename:N},"TreeSequenceSelector");const z=await mt.deleteTreeSequence(N);Ee.info(`Successfully deleted tree sequence: ${N}`,{component:"TreeSequenceSelector",data:{filename:N}}),r(Q=>Q.filter(H=>H!==N)),s(Q=>{const H={...Q};return delete H[N],H}),u===N&&d(""),g(Q=>{const H=new Set(Q);return H.delete(N),H})}catch(z){Ee.error("Failed to delete tree sequence",{component:"TreeSequenceSelector",error:z instanceof Error?z:new Error(String(z)),data:{filename:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequence: ${z instanceof Error?z.message:"Unknown error"}`,type:"error"})}}})},M=async()=>{if(h.size===0)return;const N=Array.from(h),B=N.length===1?`Are you sure you want to delete "${N[0]}"?`:`Are you sure you want to delete ${N.length} tree sequences?`;x({isOpen:!0,title:"Delete Tree Sequences",message:B,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const z=N.map(Q=>mt.deleteTreeSequence(Q));await Promise.all(z),Ee.info(`Successfully deleted ${N.length} tree sequences`,{component:"TreeSequenceSelector",data:{filenames:N}}),r(Q=>Q.filter(H=>!N.includes(H))),s(Q=>{const H={...Q};return N.forEach(W=>delete H[W]),H}),g(new Set),N.includes(u)&&d("")}catch(z){Ee.error("Failed to delete selected tree sequences",{component:"TreeSequenceSelector",error:z instanceof Error?z:new Error(String(z)),data:{filenames:N}}),A({isOpen:!0,title:"Delete Failed",message:`Failed to delete tree sequences: ${z instanceof Error?z.message:"Unknown error"}`,type:"error"})}}})},P=async()=>{n.length!==0&&x({isOpen:!0,title:"Clear All Tree Sequences",message:`Are you sure you want to delete ALL ${n.length} tree sequences? This action cannot be undone.`,type:"danger",onConfirm:async()=>{x({...w,isOpen:!1});try{const N=n.map(B=>mt.deleteTreeSequence(B));await Promise.all(N),Ee.info(`Successfully cleared all ${n.length} tree sequences`,{component:"TreeSequenceSelector",data:{count:n.length}}),r([]),s({}),g(new Set),d("")}catch(N){Ee.error("Failed to clear all tree sequences",{component:"TreeSequenceSelector",error:N instanceof Error?N:new Error(String(N))}),A({isOpen:!0,title:"Clear Failed",message:`Failed to clear all tree sequences: ${N instanceof Error?N.message:"Unknown error"}`,type:"error"}),R()}}})};return o?m.jsx("div",{className:`flex items-center justify-center p-8 ${e}`,children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-sp-pale-green"})}):n.length===0?m.jsx("div",{className:e,children:m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-8 text-center",children:[m.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[m.jsx("div",{className:"w-10 h-10 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"No Existing Tree Sequences"})]}),m.jsx("p",{className:"text-sp-white/60 text-sm mb-6",children:"No previously uploaded sequences found. Upload or simulate a tree sequence first."}),m.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2 mx-auto",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}):m.jsxs("div",{className:e,children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5 mb-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Select Existing Tree Sequence"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Choose from previously uploaded sequences"})]}),h.size>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{className:"text-sm text-sp-white/70",children:[h.size," selected"]}),m.jsxs("button",{onClick:M,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-1",title:`Delete ${h.size} selected tree sequence${h.size>1?"s":""}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete"]})]})]}),m.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto select-none",children:n.map((N,B)=>{const z=i[N],Q=(T==null?void 0:T.filename)===N,H=u===N,W=h.has(N);return m.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${H?"border-sp-pale-green bg-sp-very-dark-blue shadow-lg":W?"border-blue-400 bg-sp-very-dark-blue shadow-md":"border-sp-pale-green/20 bg-sp-very-dark-blue hover:border-sp-pale-green/50 hover:shadow-md"} ${Q?"ring-2 ring-sp-pale-green ring-offset-2 ring-offset-sp-dark-blue":""}`,onClick:q=>I(N,B,q),children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-shrink-0",children:m.jsx("input",{type:"checkbox",checked:W,onChange:()=>{},className:"w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"font-mono text-sp-pale-green text-sm font-medium truncate",title:N,children:N}),Q&&m.jsx("span",{className:"text-xs bg-sp-pale-green text-sp-very-dark-blue px-2 py-1 rounded-full font-medium",children:"Current"})]}),z?m.jsxs("div",{className:"text-xs text-sp-white/70 space-y-0.5",children:[m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[z.num_samples," samples"]}),m.jsxs("span",{children:[z.num_nodes," nodes"]})]}),m.jsxs("div",{className:"flex gap-4",children:[m.jsxs("span",{children:[z.num_edges," edges"]}),m.jsxs("span",{children:[z.num_trees," trees"]})]})]}):m.jsx("div",{className:"text-xs text-sp-white/50",children:"Loading info..."})]})]}),m.jsx("button",{onClick:q=>O(N,q),className:"ml-3 text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-400/10 transition-all duration-200",title:"Delete tree sequence",children:m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},N)})}),m.jsx("div",{className:"mt-3 text-xs text-sp-white/60 text-center",children:"Click to select for loading  Ctrl+click to multi-select  Shift+click to select range"})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{onClick:C,disabled:!u||!i[u],className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Load Selected"]}),m.jsxs("button",{onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),m.jsxs("button",{onClick:P,disabled:n.length===0,className:"bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center gap-2",title:"Delete all tree sequences",children:[m.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Clear All"]})]}),m.jsx(YM,{isOpen:w.isOpen,title:w.title,message:w.message,type:w.type,confirmText:"Delete",cancelText:"Cancel",onConfirm:w.onConfirm,onCancel:()=>x({...w,isOpen:!1})}),m.jsx(XM,{isOpen:S.isOpen,title:S.title,message:S.message,type:S.type,onClose:()=>A({...S,isOpen:!1})})]})}function Y0({isOpen:t,onClose:e,onSelect:n}){const{colors:r}=Ht();return t?m.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[m.jsx("div",{className:"fixed inset-0 transition-opacity",style:{backgroundColor:`${r.background}CC`},onClick:e}),m.jsx("div",{className:"flex items-start justify-center min-h-screen pt-16 px-4",children:m.jsxs("div",{className:"relative rounded-xl shadow-xl max-w-3xl w-full p-6 border",style:{backgroundColor:r.background,borderColor:r.border},children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h2",{className:"text-lg font-medium",style:{color:r.text},children:"Switch Tree Sequence"}),m.jsx("button",{className:"rounded-lg p-2 transition-colors",style:{color:r.text},onClick:e,onMouseEnter:i=>{i.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:i=>{i.currentTarget.style.backgroundColor="transparent"},children:m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.jsx(GM,{onSelect:n})]})})]}):null}const zB=[{id:"sparg",name:"sparg",description:"Spatial inference using Brownian motion on the full ancestral recombination graph. Modified to include node ID tracking. Best for small ARGs.",reference:"https://www.biorxiv.org/content/10.1101/2024.04.10.588900v2",github:"https://github.com/osmond-lab/sparg",github2:"",speed:1,enabled:!0},{id:"spacetrees",name:"spacetrees",description:"Spatial inference using genome-wide genealogies. Coming Soon!",reference:"https://elifesciences.org/articles/72177",github:"https://github.com/osmond-lab/spacetrees",github2:"",speed:2,enabled:!1},{id:"gaia_quadratic",name:"gaia quadratic",description:"High-accuracy spatial inference using quadratic parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"gaia_linear",name:"gaia linear",description:"High-accuracy spatial inference using linear parsimony. Best for small to medium ARGs.",reference:"https://www.science.org/doi/10.1126/science.adp4642",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/chris-a-talbot/gaiapy",speed:3,enabled:!0},{id:"fastgaia",name:"fastgaia",description:"Fast spatial inference using a greedy algorithm. Best for large ARGs where GAIA is too slow.",reference:"",github:"https://github.com/chris-a-talbot/fastgaia",github2:"https://github.com/blueraleigh/gaia",speed:4,enabled:!0},{id:"midpoint",name:"Wohns midpoint",description:"Weighted midpoint-based spatial inference. Simple and fast for ARGs of all sizes.",reference:"https://doi.org/10.1126/science.abi8264",github:"https://github.com/awohns/unified_genealogy_paper/",github2:"",speed:5,enabled:!0}];function qB({selectedMethod:t,onMethodSelect:e,disabled:n,isInferring:r,data:i}){const[s,o]=U.useState(!1),[l,u]=U.useState(null),d=zB.map(_=>({..._,isReInference:(i==null?void 0:i.spatial_status)==="all"})),h=d.find(_=>_.enabled),g=d.find(_=>_.id===t)||h||d[0];return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 w-full ${n&&"opacity-50 cursor-not-allowed hover:transform-none"} ${r&&"opacity-75 cursor-not-allowed hover:transform-none"}`,onClick:()=>!n&&!r&&o(!s),disabled:n||r,children:[r&&m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),m.jsx("span",{children:r?"Inferring...":`${g.isReInference?"Re-infer":"Infer"} locations (${g.name})`}),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&m.jsx("div",{className:"absolute z-50 w-full mt-2 bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",children:m.jsx("div",{className:"py-2",children:d.map(_=>m.jsxs("div",{className:"relative group",onMouseEnter:()=>u(_),onMouseLeave:y=>{const T=document.querySelector(`[data-tooltip-id="${_.id}"]`);T&&!T.contains(y.relatedTarget)&&u(null)},children:[m.jsx("button",{className:`w-full px-4 py-2 text-left transition-colors duration-200 ${_.enabled?t===_.id?"bg-sp-pale-green/10 hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"hover:bg-sp-pale-green hover:text-sp-very-dark-blue":"text-sp-white/50 cursor-not-allowed"}`,onClick:()=>{_.enabled&&(e(_),o(!1))},disabled:r||!_.enabled,children:m.jsxs("div",{className:"font-medium flex items-center justify-between",children:[m.jsx("span",{children:_.name}),!_.enabled&&m.jsx("span",{className:"text-xs text-sp-pale-green/50",children:"Coming Soon"})]})}),(l==null?void 0:l.id)===_.id&&m.jsxs("div",{"data-tooltip-id":_.id,className:"fixed z-50 w-72 p-4 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl shadow-xl",style:{left:"var(--tooltip-x, 0)",top:"var(--tooltip-y, 0)"},ref:y=>{var T;if(y){const w=(T=y.parentElement)==null?void 0:T.getBoundingClientRect();if(w){const x=window.innerHeight-w.bottom,S=w.top,A=y.offsetHeight,R=w.left-y.offsetWidth-8;let E;x>=A?E=w.top:S>=A?E=w.bottom-A:E=Math.max(8,Math.min(window.innerHeight-A-8,w.top-(A-w.height)/2)),y.style.setProperty("--tooltip-x",`${R}px`),y.style.setProperty("--tooltip-y",`${E}px`)}}},onMouseEnter:()=>u(_),onMouseLeave:()=>u(null),children:[m.jsx("h4",{className:"font-bold text-sp-pale-green mb-2",children:l.name}),m.jsx("p",{className:"text-sm text-sp-white/80 mb-2",children:l.description}),m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx("span",{className:"text-xs text-sp-white/80",children:"Speed:"}),m.jsx("div",{className:"flex items-center gap-[2px]",children:[...Array(5)].map((y,T)=>m.jsx("div",{className:`w-3 h-5 rounded-sm transition-all ${T<l.speed?T===0?"bg-yellow-400":T===1?"bg-yellow-500":T===2?"bg-lime-500":T===3?"bg-green-400":"bg-green-500":"bg-gray-700"}`},T))})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[l.reference&&m.jsx("a",{href:l.reference,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View reference"}),l.id==="gaia_quadratic"||l.id==="gaia_linear"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaiapy on GitHub"})]}):l.id==="fastgaia"?m.jsxs(m.Fragment,{children:[m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View fastgaia on GitHub"}),m.jsx("a",{href:l.github2,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View gaia on GitHub"})]}):l.github&&m.jsx("a",{href:l.github,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-sp-pale-green hover:text-sp-pale-green/80 underline",children:"View on GitHub"})]})]})]},_.id))})}),m.jsxs("div",{className:"absolute -right-8 top-1/2 transform -translate-y-1/2 group",children:[m.jsx("div",{className:"p-1 cursor-help",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),m.jsx("div",{className:"hidden group-hover:block absolute right-full mr-2 w-64 p-3 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg shadow-xl",children:m.jsx("p",{className:"text-xs text-sp-white/80",children:"Choose from different methods to infer ancestral locations in your ARG. Each method has its own strengths and is optimized for different scenarios."})})]})]})}const Rg=t=>t.toExponential(8);function VB({isOpen:t,onClose:e,onConfirm:n,defaultRate:r=1e-8}){const[i,s]=U.useState(Rg(r)),[o,l]=U.useState(!0),[u,d]=U.useState(!1),[h,g]=U.useState("1000000"),[_,y]=U.useState(!0),[T,w]=U.useState(!1),[x,S]=U.useState(!1),[A,R]=U.useState(!1),E=C=>{C.preventDefault();const I=parseFloat(i),O=h?parseFloat(h):void 0;!isNaN(I)&&I>0&&n(I,o,u,O,_,T,x,A)};return t?m.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-xl p-6 w-full max-w-md",children:[m.jsx("h3",{className:"text-xl font-bold text-sp-white mb-4",children:"Set Mutation Rate"}),m.jsxs("form",{onSubmit:E,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80 mb-2",children:"Mutation Rate (per base pair per generation)"}),m.jsx("input",{type:"text",id:"mutation-rate",value:i,onChange:C=>{const I=C.target.value;s(I)},onBlur:C=>{const I=C.target.value,O=parseFloat(I);isNaN(O)||O<=0?s(Rg(r)):s(Rg(O))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),m.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"preprocess",checked:o,onChange:C=>l(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"preprocess",className:"ml-2 block text-sm text-sp-white/80",children:"Preprocess tree sequence"})]}),o&&m.jsxs("div",{className:"ml-6 space-y-3 border-l-2 border-sp-pale-green/20 pl-4",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"remove-telomeres",checked:u,onChange:C=>d(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"remove-telomeres",className:"ml-2 block text-sm text-sp-white/80",children:"Remove telomeres (flanking regions)"})]}),m.jsxs("div",{children:[m.jsx("label",{htmlFor:"minimum-gap",className:"block text-sm text-sp-white/80 mb-1",children:"Minimum gap between sites (bp)"}),m.jsx("input",{type:"text",id:"minimum-gap",value:h,onChange:C=>g(C.target.value),onBlur:C=>{const I=C.target.value,O=parseFloat(I);(isNaN(O)||O<0)&&g("1000000")},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1000000"}),m.jsx("p",{className:"mt-1 text-xs text-sp-white/60",children:"Default: 1,000,000 bp"})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"split-disjoint",checked:_,onChange:C=>y(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"split-disjoint",className:"ml-2 block text-sm text-sp-white/80",children:"Split disjoint nodes"})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"filter-populations",checked:T,onChange:C=>w(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"filter-populations",className:"ml-2 block text-sm text-sp-white/80",children:"Filter populations"})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"filter-individuals",checked:x,onChange:C=>S(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"filter-individuals",className:"ml-2 block text-sm text-sp-white/80",children:"Filter individuals"})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"filter-sites",checked:A,onChange:C=>R(C.target.checked),className:"h-4 w-4 text-sp-pale-green focus:ring-sp-pale-green border-sp-pale-green/20 rounded bg-sp-dark-blue"}),m.jsx("label",{htmlFor:"filter-sites",className:"ml-2 block text-sm text-sp-white/80",children:"Filter sites"})]}),m.jsx("p",{className:"text-xs text-sp-white/60",children:"Preprocessing simplifies the tree sequence by removing unary nodes and splitting disjoint nodes. Telomeres are flanking regions that may contain missing data."})]})]}),m.jsxs("div",{className:"flex justify-end gap-3",children:[m.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-sp-white/80 hover:text-sp-white transition-colors",children:"Cancel"}),m.jsx("button",{type:"submit",className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold px-4 py-2 rounded-lg transition-colors",children:"Run tsdate"})]})]})]})}):null}function $B(){const t=mc(),e=gc(),{treeSequence:n,maxSamples:r,setMaxSamples:i,setTreeSequence:s}=Hs(),[o,l]=U.useState(null),[u,d]=U.useState(!1),[h,g]=U.useState(!1),[_,y]=U.useState(!1),[T,w]=U.useState(!1),[x,S]=U.useState(!1),[A,R]=U.useState(!1),[E,C]=U.useState(r.toString()),[I,O]=U.useState("gaia_quadratic"),[M,P]=U.useState(!1),[N,B]=U.useState(!1),[z,Q]=U.useState({isOpen:!1,title:"",message:"",type:"info"});U.useEffect(()=>{n!=null&&n.num_samples&&l(n.num_samples)},[n]),U.useEffect(()=>{C(r.toString())},[r]),n!=null&&n.has_temporal;const H=(n==null?void 0:n.spatial_status)==="sample_only"||(n==null?void 0:n.spatial_status)==="all",W=!!(n!=null&&n.has_temporal&&(n!=null&&n.has_all_spatial)),q=(n==null?void 0:n.num_mutations)!==void 0&&n.num_mutations>0,ee=async()=>{if(!(!(n!=null&&n.filename)||u)){d(!0);try{Ee.user.action("fast-location-inference-start",{filename:n.filename},"ResultPage");const $=await mt.inferLocationsFast({filename:n.filename,weight_span:!0,weight_branch_length:!0});Ee.info("Fast location inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:$.data}});const Y=$.data,ue={...n,filename:Y.new_filename,has_sample_spatial:Y.has_sample_spatial,has_all_spatial:Y.has_all_spatial,spatial_status:Y.spatial_status};s(ue),Q({isOpen:!0,title:"Success!",message:`Fast location inference completed successfully!
Inferred locations for ${Y.num_inferred_locations} nodes.
New file: ${Y.new_filename}`,type:"success"})}catch($){Ee.error("Fast location inference failed",{component:"ResultPage",error:$ instanceof Error?$:new Error(String($)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Fast location inference failed: ${$ instanceof Error?$.message:"Unknown error"}`,type:"error"})}finally{d(!1)}}},de=async()=>{if(!(!(n!=null&&n.filename)||h)){g(!0);try{Ee.user.action("gaia-quadratic-inference-start",{filename:n.filename},"ResultPage");const $=await mt.inferLocationsGaiaQuadratic({filename:n.filename});Ee.info("GAIA quadratic inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:$.data}});const Y=$.data,ue={...n,filename:Y.new_filename,has_sample_spatial:Y.has_sample_spatial,has_all_spatial:Y.has_all_spatial,spatial_status:Y.spatial_status};s(ue),Q({isOpen:!0,title:"Success!",message:`GAIA quadratic inference completed successfully!
Inferred locations for ${Y.num_inferred_locations} nodes.
New file: ${Y.new_filename}`,type:"success"})}catch($){Ee.error("GAIA quadratic inference failed",{component:"ResultPage",error:$ instanceof Error?$:new Error(String($)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA quadratic inference failed: ${$ instanceof Error?$.message:"Unknown error"}`,type:"error"})}finally{g(!1)}}},Z=$=>{Ee.user.action("switch-tree-sequence",{treeSequence:$},"ResultPage"),s($),R(!1)},D=()=>{var Y;const $=(Y=e.state)==null?void 0:Y.fromIntermediate;$?$==="load"?(Ee.nav("result","landing"),t("/",{state:{fromInternal:!0}})):(Ee.nav("result","intermediate"),t("/",{state:{fromResult:!0,selectedOption:$}})):(Ee.nav("result","landing"),t("/",{state:{fromInternal:!0}}))},G=()=>{var Y;const $=(Y=e.state)==null?void 0:Y.fromIntermediate;if($)switch($){case"upload":return"Back to Upload";case"simulate":return"Back to Simulate";case"load":return"Back to options";default:return"Back"}return"Back"},oe=async $=>{if(n!=null&&n.filename)switch($.id){case"fastgaia":await ee();break;case"gaia_quadratic":await de();break;case"gaia_linear":if(_)return;y(!0);try{Ee.user.action("gaia-linear-inference-start",{filename:n.filename},"ResultPage");const Y=await mt.inferLocationsGaiaLinear({filename:n.filename});Ee.info("GAIA linear inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Y.data}});const ue=Y.data,ye={...n,filename:ue.new_filename,has_sample_spatial:ue.has_sample_spatial,has_all_spatial:ue.has_all_spatial,spatial_status:ue.spatial_status};s(ye),Q({isOpen:!0,title:"Success!",message:`GAIA linear inference completed successfully!
Inferred locations for ${ue.num_inferred_locations} nodes.
New file: ${ue.new_filename}`,type:"success"})}catch(Y){Ee.error("GAIA linear inference failed",{component:"ResultPage",error:Y instanceof Error?Y:new Error(String(Y)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`GAIA linear inference failed: ${Y instanceof Error?Y.message:"Unknown error"}`,type:"error"})}finally{y(!1)}break;case"sparg":if(x)return;S(!0);try{Ee.user.action("sparg-inference-start",{filename:n.filename},"ResultPage");const Y=await mt.inferLocationsSparg({filename:n.filename});Ee.info("sparg inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Y.data}});const ue=Y.data,ye={...n,filename:ue.new_filename,has_sample_spatial:ue.has_sample_spatial,has_all_spatial:ue.has_all_spatial,spatial_status:ue.spatial_status};s(ye),Q({isOpen:!0,title:"Success!",message:`sparg inference completed successfully!
Inferred locations for ${ue.num_inferred_locations} nodes.
New file: ${ue.new_filename}`,type:"success"})}catch(Y){Ee.error("sparg inference failed",{component:"ResultPage",error:Y instanceof Error?Y:new Error(String(Y)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`sparg inference failed: ${Y instanceof Error?Y.message:"Unknown error"}`,type:"error"})}finally{S(!1)}break;case"midpoint":if(T)return;w(!0);try{Ee.user.action("midpoint-inference-start",{filename:n.filename},"ResultPage");const Y=await mt.inferLocationsMidpoint({filename:n.filename});Ee.info("Midpoint inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:Y.data}});const ue=Y.data,ye={...n,filename:ue.new_filename,has_sample_spatial:ue.has_sample_spatial,has_all_spatial:ue.has_all_spatial,spatial_status:ue.spatial_status};s(ye),Q({isOpen:!0,title:"Success!",message:`Midpoint inference completed successfully!
Inferred locations for ${ue.num_inferred_locations} nodes.
New file: ${ue.new_filename}`,type:"success"})}catch(Y){Ee.error("Midpoint inference failed",{component:"ResultPage",error:Y instanceof Error?Y:new Error(String(Y)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`Midpoint inference failed: ${Y instanceof Error?Y.message:"Unknown error"}`,type:"error"})}finally{w(!1)}break;default:Q({isOpen:!0,title:"Not Implemented",message:`The ${$.name} inference method is not yet implemented.`,type:"info"})}},ie=u||h||_||T||x,F=async($,Y,ue,ye,Se,ke,Ue,yt)=>{if(!(!(n!=null&&n.filename)||N)){B(!0),P(!1);try{Ee.user.action("tsdate-inference-start",{filename:n.filename,mutationRate:$,preprocess:Y,removeTelomeres:ue,minimumGap:ye,splitDisjoint:Se,filterPopulations:ke,filterIndividuals:Ue,filterSites:yt},"ResultPage");const We=await mt.inferTimesTsdate({filename:n.filename,mutation_rate:$,preprocess:Y,remove_telomeres:ue,minimum_gap:ye,split_disjoint:Se,filter_populations:ke,filter_individuals:Ue,filter_sites:yt});Ee.info("tsdate inference completed successfully",{component:"ResultPage",data:{filename:n.filename,result:We.data}});const Fe=We.data,De={...n,filename:Fe.new_filename,has_temporal:Fe.has_temporal};s(De);const Jt=Fe.preprocessing.preprocessed?`
Preprocessing: ${[Fe.preprocessing.remove_telomeres?"with telomere removal":"without telomere removal",Fe.preprocessing.minimum_gap?`minimum gap ${Fe.preprocessing.minimum_gap}bp`:null,Fe.preprocessing.split_disjoint?"split disjoint nodes":null,Fe.preprocessing.filter_populations?"filtered populations":null,Fe.preprocessing.filter_individuals?"filtered individuals":null,Fe.preprocessing.filter_sites?"filtered sites":null].filter(Boolean).join(", ")}`:`
No preprocessing applied`;Q({isOpen:!0,title:"Success!",message:`tsdate inference completed successfully!${Jt}
Inferred times for ${Fe.num_inferred_times} nodes.
New file: ${Fe.new_filename}`,type:"success"})}catch(We){Ee.error("tsdate inference failed",{component:"ResultPage",error:We instanceof Error?We:new Error(String(We)),data:{filename:n.filename}}),Q({isOpen:!0,title:"Error",message:`tsdate inference failed: ${We instanceof Error?We.message:"Unknown error"}`,type:"error"})}finally{B(!1)}}};return n?m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",onClick:D,children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),G()]}),m.jsx(_c,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"Tree Sequence Analysis"}),m.jsx("p",{className:"text-sp-white/70 text-lg font-mono break-all",children:n.filename})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsxs("div",{className:"p-8 space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("div",{className:"flex flex-wrap gap-3",children:[m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_temporal?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_temporal?"text-sp-white":"text-red-400"}`,children:n.has_temporal?"":""}),"Temporal"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_sample_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_sample_spatial?"text-sp-white":"text-red-400"}`,children:n.has_sample_spatial?"":""}),"Sample Coords"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${n.has_all_spatial?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${n.has_all_spatial?"text-sp-white":"text-red-400"}`,children:n.has_all_spatial?"":""}),"All Coords"]}),m.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium ${q?"bg-sp-dark-blue text-sp-white border border-sp-pale-green/20":"bg-transparent text-sp-white/70"}`,children:[m.jsx("span",{className:`inline-block ${q?"text-sp-white":"text-red-400"}`,children:q?"":""}),"Mutations"]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",onClick:()=>R(!A),children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),A?"Cancel":"Switch Tree Sequence"]}),m.jsx(X0,{filename:n.filename,onError:$=>{Q({isOpen:!0,title:"Download Failed",message:`Failed to download tree sequence: ${$.message}`,type:"error"})}})]})]}),m.jsx(Y0,{isOpen:A,onClose:()=>R(!1),onSelect:Z}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_samples}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Samples"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_nodes}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Nodes"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_edges}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Edges"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_trees}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Local Trees"})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-3 text-center",children:[m.jsx("div",{className:"text-lg font-bold text-sp-pale-green",children:n.num_mutations??0}),m.jsx("div",{className:"text-xs text-sp-white/70",children:"Mutations"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("button",{className:`bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2 ${!q&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!q||N,onClick:()=>P(!0),children:[N&&m.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-sp-pale-green border-t-transparent"}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),m.jsx("span",{children:N?"Inferring...":"Infer ages (tsdate)"})]}),m.jsx(qB,{selectedMethod:I,onMethodSelect:$=>{O($.id),oe($)},disabled:!H,isInferring:ie,data:n})]}),m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg p-4",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Visualization Sample Count"})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("input",{type:"range",id:"sample-slider",min:"2",max:o||Ji.DEFAULT_MAX_SAMPLES,value:Math.max(r,2),onChange:$=>i(parseInt($.target.value)),className:"flex-1 h-2 bg-sp-dark-blue rounded-lg appearance-none cursor-pointer accent-sp-pale-green"}),m.jsxs("div",{className:"flex items-center gap-2 min-w-[8rem]",children:[m.jsx("input",{type:"number",value:E,onChange:$=>{const Y=$.target.value;if(C(Y),Y!==""){const ue=parseInt(Y);isNaN(ue)||i(ue)}},onBlur:$=>{const Y=parseInt($.target.value);let ue=2;isNaN(Y)||(ue=Math.max(2,Math.min(Y,o||Ji.DEFAULT_MAX_SAMPLES))),i(ue),C(ue.toString())},min:"2",max:o||Ji.DEFAULT_MAX_SAMPLES,className:"w-20 bg-sp-dark-blue border border-sp-pale-green/20 rounded px-2 py-1 text-sm text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green"}),m.jsxs("span",{className:"text-sm font-mono text-sp-white/70",children:["/ ",o||"?"]})]})]}),m.jsxs("div",{className:"mt-2",children:[m.jsx("p",{className:"text-xs text-sp-white/60",children:"Adjust before visualizing to control the number of samples shown (minimum: 2)"}),o&&o>Ji.WARNING_THRESHOLD&&m.jsx("p",{className:"text-xs text-sp-white/60 mt-1",children:"Note: Large sample numbers may affect visualization performance"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[m.jsxs("button",{className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 false",disabled:!1,onClick:()=>t(`/visualize/${encodeURIComponent(n.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Visualize ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"Interactive D3"})]})]}),m.jsxs("button",{className:`bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-5 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex flex-col items-center gap-2 ${!W&&"opacity-50 cursor-not-allowed hover:transform-none"}`,disabled:!W,onClick:()=>t(`/visualize-spatial/${encodeURIComponent(n.filename)}`),children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Spatial ARG"}),m.jsx("span",{className:"text-sm opacity-80 block",children:"3D coordinates"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Pretty ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Pretty ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]}),m.jsxs("button",{className:"bg-sp-dark-blue text-sp-white/50 font-bold py-5 px-6 rounded-xl flex flex-col items-center gap-2 opacity-40 cursor-not-allowed",disabled:!0,title:"Huge ARG visualization coming soon",children:[m.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-base font-bold",children:"Huge ARG"}),m.jsx("span",{className:"text-sm opacity-60 block",children:"Coming soon"})]})]})]})]})})}),m.jsx(VB,{isOpen:M,onClose:()=>P(!1),onConfirm:F}),m.jsx(XM,{isOpen:z.isOpen,title:z.title,message:z.message,type:z.type,onClose:()=>Q({...z,isOpen:!1})})]}):m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-sp-very-dark-blue text-sp-white",children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No data loaded"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4",onClick:D,children:"Back to Home"})]})}var HB={value:()=>{}};function vc(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new pf(n)}function pf(t){this._=t}function WB(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}pf.prototype=vc.prototype={constructor:pf,on:function(t,e){var n=this._,r=WB(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=XB(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=fS(n[i],t.name,e);else if(e==null)for(i in n)n[i]=fS(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new pf(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function XB(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function fS(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=HB,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Ux="http://www.w3.org/1999/xhtml";const dS={svg:"http://www.w3.org/2000/svg",xhtml:Ux,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Md(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),dS.hasOwnProperty(e)?{space:dS[e],local:t}:t}function YB(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ux&&e.documentElement.namespaceURI===Ux?e.createElement(t):e.createElementNS(n,t)}}function GB(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function KM(t){var e=Md(t);return(e.local?GB:YB)(e)}function KB(){}function G0(t){return t==null?KB:function(){return this.querySelector(t)}}function ZB(t){typeof t!="function"&&(t=G0(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=new Array(o),u,d,h=0;h<o;++h)(u=s[h])&&(d=t.call(u,u.__data__,h,s))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d);return new Kn(r,this._parents)}function QB(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function JB(){return[]}function ZM(t){return t==null?JB:function(){return this.querySelectorAll(t)}}function eU(t){return function(){return QB(t.apply(this,arguments))}}function tU(t){typeof t=="function"?t=eU(t):t=ZM(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(t.call(u,u.__data__,d,o)),i.push(u));return new Kn(r,i)}function QM(t){return function(){return this.matches(t)}}function JM(t){return function(e){return e.matches(t)}}var nU=Array.prototype.find;function rU(t){return function(){return nU.call(this.children,t)}}function iU(){return this.firstElementChild}function sU(t){return this.select(t==null?iU:rU(typeof t=="function"?t:JM(t)))}var aU=Array.prototype.filter;function oU(){return Array.from(this.children)}function lU(t){return function(){return aU.call(this.children,t)}}function cU(t){return this.selectAll(t==null?oU:lU(typeof t=="function"?t:JM(t)))}function uU(t){typeof t!="function"&&(t=QM(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new Kn(r,this._parents)}function eI(t){return new Array(t.length)}function fU(){return new Kn(this._enter||this._groups.map(eI),this._parents)}function Rf(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Rf.prototype={constructor:Rf,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function dU(t){return function(){return t}}function hU(t,e,n,r,i,s){for(var o=0,l,u=e.length,d=s.length;o<d;++o)(l=e[o])?(l.__data__=s[o],r[o]=l):n[o]=new Rf(t,s[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function pU(t,e,n,r,i,s,o){var l,u,d=new Map,h=e.length,g=s.length,_=new Array(h),y;for(l=0;l<h;++l)(u=e[l])&&(_[l]=y=o.call(u,u.__data__,l,e)+"",d.has(y)?i[l]=u:d.set(y,u));for(l=0;l<g;++l)y=o.call(t,s[l],l,s)+"",(u=d.get(y))?(r[l]=u,u.__data__=s[l],d.delete(y)):n[l]=new Rf(t,s[l]);for(l=0;l<h;++l)(u=e[l])&&d.get(_[l])===u&&(i[l]=u)}function gU(t){return t.__data__}function mU(t,e){if(!arguments.length)return Array.from(this,gU);var n=e?pU:hU,r=this._parents,i=this._groups;typeof t!="function"&&(t=dU(t));for(var s=i.length,o=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var h=r[d],g=i[d],_=g.length,y=_U(t.call(h,h&&h.__data__,d,r)),T=y.length,w=l[d]=new Array(T),x=o[d]=new Array(T),S=u[d]=new Array(_);n(h,g,w,x,S,y,e);for(var A=0,R=0,E,C;A<T;++A)if(E=w[A]){for(A>=R&&(R=A+1);!(C=x[R])&&++R<T;);E._next=C||null}}return o=new Kn(o,r),o._enter=l,o._exit=u,o}function _U(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function vU(){return new Kn(this._exit||this._groups.map(eI),this._parents)}function yU(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function bU(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),l=new Array(i),u=0;u<o;++u)for(var d=n[u],h=r[u],g=d.length,_=l[u]=new Array(g),y,T=0;T<g;++T)(y=d[T]||h[T])&&(_[T]=y);for(;u<i;++u)l[u]=n[u];return new Kn(l,this._parents)}function xU(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function wU(t){t||(t=TU);function e(g,_){return g&&_?t(g.__data__,_.__data__):!g-!_}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],l=o.length,u=i[s]=new Array(l),d,h=0;h<l;++h)(d=o[h])&&(u[h]=d);u.sort(e)}return new Kn(i,this._parents).order()}function TU(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function SU(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function EU(){return Array.from(this)}function AU(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function RU(){let t=0;for(const e of this)++t;return t}function CU(){return!this.node()}function NU(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,l;s<o;++s)(l=i[s])&&t.call(l,l.__data__,s,i);return this}function kU(t){return function(){this.removeAttribute(t)}}function MU(t){return function(){this.removeAttributeNS(t.space,t.local)}}function IU(t,e){return function(){this.setAttribute(t,e)}}function OU(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function PU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function DU(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function jU(t,e){var n=Md(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?MU:kU:typeof e=="function"?n.local?DU:PU:n.local?OU:IU)(n,e))}function tI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function LU(t){return function(){this.style.removeProperty(t)}}function BU(t,e,n){return function(){this.style.setProperty(t,e,n)}}function UU(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function FU(t,e,n){return arguments.length>1?this.each((e==null?LU:typeof e=="function"?UU:BU)(t,e,n??"")):ao(this.node(),t)}function ao(t,e){return t.style.getPropertyValue(e)||tI(t).getComputedStyle(t,null).getPropertyValue(e)}function zU(t){return function(){delete this[t]}}function qU(t,e){return function(){this[t]=e}}function VU(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function $U(t,e){return arguments.length>1?this.each((e==null?zU:typeof e=="function"?VU:qU)(t,e)):this.node()[t]}function nI(t){return t.trim().split(/^|\s+/)}function K0(t){return t.classList||new rI(t)}function rI(t){this._node=t,this._names=nI(t.getAttribute("class")||"")}rI.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function iI(t,e){for(var n=K0(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function sI(t,e){for(var n=K0(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function HU(t){return function(){iI(this,t)}}function WU(t){return function(){sI(this,t)}}function XU(t,e){return function(){(e.apply(this,arguments)?iI:sI)(this,t)}}function YU(t,e){var n=nI(t+"");if(arguments.length<2){for(var r=K0(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?XU:e?HU:WU)(n,e))}function GU(){this.textContent=""}function KU(t){return function(){this.textContent=t}}function ZU(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function QU(t){return arguments.length?this.each(t==null?GU:(typeof t=="function"?ZU:KU)(t)):this.node().textContent}function JU(){this.innerHTML=""}function e8(t){return function(){this.innerHTML=t}}function t8(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function n8(t){return arguments.length?this.each(t==null?JU:(typeof t=="function"?t8:e8)(t)):this.node().innerHTML}function r8(){this.nextSibling&&this.parentNode.appendChild(this)}function i8(){return this.each(r8)}function s8(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function a8(){return this.each(s8)}function o8(t){var e=typeof t=="function"?t:KM(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function l8(){return null}function c8(t,e){var n=typeof t=="function"?t:KM(t),r=e==null?l8:typeof e=="function"?e:G0(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function u8(){var t=this.parentNode;t&&t.removeChild(this)}function f8(){return this.each(u8)}function d8(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function h8(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function p8(t){return this.select(t?h8:d8)}function g8(t){return arguments.length?this.property("__data__",t):this.node().__data__}function m8(t){return function(e){t.call(this,e,this.__data__)}}function _8(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function v8(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function y8(t,e,n){return function(){var r=this.__on,i,s=m8(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function b8(t,e,n){var r=_8(t+""),i,s=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,h;u<d;++u)for(i=0,h=l[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(l=e?y8:v8,i=0;i<s;++i)this.each(l(r[i],e,n));return this}function aI(t,e,n){var r=tI(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function x8(t,e){return function(){return aI(this,t,e)}}function w8(t,e){return function(){return aI(this,t,e.apply(this,arguments))}}function T8(t,e){return this.each((typeof e=="function"?w8:x8)(t,e))}function*S8(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var oI=[null];function Kn(t,e){this._groups=t,this._parents=e}function yc(){return new Kn([[document.documentElement]],oI)}function E8(){return this}Kn.prototype=yc.prototype={constructor:Kn,select:ZB,selectAll:tU,selectChild:sU,selectChildren:cU,filter:uU,data:mU,enter:fU,exit:vU,join:yU,merge:bU,selection:E8,order:xU,sort:wU,call:SU,nodes:EU,node:AU,size:RU,empty:CU,each:NU,attr:jU,style:FU,property:$U,classed:YU,text:QU,html:n8,raise:i8,lower:a8,append:o8,insert:c8,remove:f8,clone:p8,datum:g8,on:b8,dispatch:T8,[Symbol.iterator]:S8};function lr(t){return typeof t=="string"?new Kn([[document.querySelector(t)]],[document.documentElement]):new Kn([[t]],oI)}function A8(t){let e;for(;e=t.sourceEvent;)t=e;return t}function fi(t,e){if(t=A8(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const R8={passive:!1},sc={capture:!0,passive:!1};function Cg(t){t.stopImmediatePropagation()}function no(t){t.preventDefault(),t.stopImmediatePropagation()}function lI(t){var e=t.document.documentElement,n=lr(t).on("dragstart.drag",no,sc);"onselectstart"in e?n.on("selectstart.drag",no,sc):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function cI(t,e){var n=t.document.documentElement,r=lr(t).on("dragstart.drag",null);e&&(r.on("click.drag",no,sc),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Hu=t=>()=>t;function Fx(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:l,dx:u,dy:d,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:h}})}Fx.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function C8(t){return!t.ctrlKey&&!t.button}function N8(){return this.parentNode}function k8(t,e){return e??{x:t.x,y:t.y}}function M8(){return navigator.maxTouchPoints||"ontouchstart"in this}function I8(){var t=C8,e=N8,n=k8,r=M8,i={},s=vc("start","drag","end"),o=0,l,u,d,h,g=0;function _(E){E.on("mousedown.drag",y).filter(r).on("touchstart.drag",x).on("touchmove.drag",S,R8).on("touchend.drag touchcancel.drag",A).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(E,C){if(!(h||!t.call(this,E,C))){var I=R(this,e.call(this,E,C),E,C,"mouse");I&&(lr(E.view).on("mousemove.drag",T,sc).on("mouseup.drag",w,sc),lI(E.view),Cg(E),d=!1,l=E.clientX,u=E.clientY,I("start",E))}}function T(E){if(no(E),!d){var C=E.clientX-l,I=E.clientY-u;d=C*C+I*I>g}i.mouse("drag",E)}function w(E){lr(E.view).on("mousemove.drag mouseup.drag",null),cI(E.view,d),no(E),i.mouse("end",E)}function x(E,C){if(t.call(this,E,C)){var I=E.changedTouches,O=e.call(this,E,C),M=I.length,P,N;for(P=0;P<M;++P)(N=R(this,O,E,C,I[P].identifier,I[P]))&&(Cg(E),N("start",E,I[P]))}}function S(E){var C=E.changedTouches,I=C.length,O,M;for(O=0;O<I;++O)(M=i[C[O].identifier])&&(no(E),M("drag",E,C[O]))}function A(E){var C=E.changedTouches,I=C.length,O,M;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),O=0;O<I;++O)(M=i[C[O].identifier])&&(Cg(E),M("end",E,C[O]))}function R(E,C,I,O,M,P){var N=s.copy(),B=fi(P||I,C),z,Q,H;if((H=n.call(E,new Fx("beforestart",{sourceEvent:I,target:_,identifier:M,active:o,x:B[0],y:B[1],dx:0,dy:0,dispatch:N}),O))!=null)return z=H.x-B[0]||0,Q=H.y-B[1]||0,function W(q,ee,de){var Z=B,D;switch(q){case"start":i[M]=W,D=o++;break;case"end":delete i[M],--o;case"drag":B=fi(de||ee,C),D=o;break}N.call(q,E,new Fx(q,{sourceEvent:ee,subject:H,target:_,identifier:M,active:D,x:B[0]+z,y:B[1]+Q,dx:B[0]-Z[0],dy:B[1]-Z[1],dispatch:N}),O)}}return _.filter=function(E){return arguments.length?(t=typeof E=="function"?E:Hu(!!E),_):t},_.container=function(E){return arguments.length?(e=typeof E=="function"?E:Hu(E),_):e},_.subject=function(E){return arguments.length?(n=typeof E=="function"?E:Hu(E),_):n},_.touchable=function(E){return arguments.length?(r=typeof E=="function"?E:Hu(!!E),_):r},_.on=function(){var E=s.on.apply(s,arguments);return E===s?_:E},_.clickDistance=function(E){return arguments.length?(g=(E=+E)*E,_):Math.sqrt(g)},_}function Z0(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function uI(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function bc(){}var ac=.7,Cf=1/ac,ro="\\s*([+-]?\\d+)\\s*",oc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$r="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",O8=/^#([0-9a-f]{3,8})$/,P8=new RegExp(`^rgb\\(${ro},${ro},${ro}\\)$`),D8=new RegExp(`^rgb\\(${$r},${$r},${$r}\\)$`),j8=new RegExp(`^rgba\\(${ro},${ro},${ro},${oc}\\)$`),L8=new RegExp(`^rgba\\(${$r},${$r},${$r},${oc}\\)$`),B8=new RegExp(`^hsl\\(${oc},${$r},${$r}\\)$`),U8=new RegExp(`^hsla\\(${oc},${$r},${$r},${oc}\\)$`),hS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Z0(bc,lc,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:pS,formatHex:pS,formatHex8:F8,formatHsl:z8,formatRgb:gS,toString:gS});function pS(){return this.rgb().formatHex()}function F8(){return this.rgb().formatHex8()}function z8(){return fI(this).formatHsl()}function gS(){return this.rgb().formatRgb()}function lc(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=O8.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?mS(e):n===3?new Dn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Wu(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Wu(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=P8.exec(t))?new Dn(e[1],e[2],e[3],1):(e=D8.exec(t))?new Dn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=j8.exec(t))?Wu(e[1],e[2],e[3],e[4]):(e=L8.exec(t))?Wu(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=B8.exec(t))?yS(e[1],e[2]/100,e[3]/100,1):(e=U8.exec(t))?yS(e[1],e[2]/100,e[3]/100,e[4]):hS.hasOwnProperty(t)?mS(hS[t]):t==="transparent"?new Dn(NaN,NaN,NaN,0):null}function mS(t){return new Dn(t>>16&255,t>>8&255,t&255,1)}function Wu(t,e,n,r){return r<=0&&(t=e=n=NaN),new Dn(t,e,n,r)}function q8(t){return t instanceof bc||(t=lc(t)),t?(t=t.rgb(),new Dn(t.r,t.g,t.b,t.opacity)):new Dn}function zx(t,e,n,r){return arguments.length===1?q8(t):new Dn(t,e,n,r??1)}function Dn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Z0(Dn,zx,uI(bc,{brighter(t){return t=t==null?Cf:Math.pow(Cf,t),new Dn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ac:Math.pow(ac,t),new Dn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Dn(Is(this.r),Is(this.g),Is(this.b),Nf(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_S,formatHex:_S,formatHex8:V8,formatRgb:vS,toString:vS}));function _S(){return`#${Ns(this.r)}${Ns(this.g)}${Ns(this.b)}`}function V8(){return`#${Ns(this.r)}${Ns(this.g)}${Ns(this.b)}${Ns((isNaN(this.opacity)?1:this.opacity)*255)}`}function vS(){const t=Nf(this.opacity);return`${t===1?"rgb(":"rgba("}${Is(this.r)}, ${Is(this.g)}, ${Is(this.b)}${t===1?")":`, ${t})`}`}function Nf(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Is(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ns(t){return t=Is(t),(t<16?"0":"")+t.toString(16)}function yS(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Er(t,e,n,r)}function fI(t){if(t instanceof Er)return new Er(t.h,t.s,t.l,t.opacity);if(t instanceof bc||(t=lc(t)),!t)return new Er;if(t instanceof Er)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,l=s-i,u=(s+i)/2;return l?(e===s?o=(n-r)/l+(n<r)*6:n===s?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?s+i:2-s-i,o*=60):l=u>0&&u<1?0:o,new Er(o,l,u,t.opacity)}function $8(t,e,n,r){return arguments.length===1?fI(t):new Er(t,e,n,r??1)}function Er(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Z0(Er,$8,uI(bc,{brighter(t){return t=t==null?Cf:Math.pow(Cf,t),new Er(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ac:Math.pow(ac,t),new Er(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Dn(Ng(t>=240?t-240:t+120,i,r),Ng(t,i,r),Ng(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Er(bS(this.h),Xu(this.s),Xu(this.l),Nf(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Nf(this.opacity);return`${t===1?"hsl(":"hsla("}${bS(this.h)}, ${Xu(this.s)*100}%, ${Xu(this.l)*100}%${t===1?")":`, ${t})`}`}}));function bS(t){return t=(t||0)%360,t<0?t+360:t}function Xu(t){return Math.max(0,Math.min(1,t||0))}function Ng(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const dI=t=>()=>t;function H8(t,e){return function(n){return t+n*e}}function W8(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function X8(t){return(t=+t)==1?hI:function(e,n){return n-e?W8(e,n,t):dI(isNaN(e)?n:e)}}function hI(t,e){var n=e-t;return n?H8(t,n):dI(isNaN(t)?e:t)}const xS=function t(e){var n=X8(e);function r(i,s){var o=n((i=zx(i)).r,(s=zx(s)).r),l=n(i.g,s.g),u=n(i.b,s.b),d=hI(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=l(h),i.b=u(h),i.opacity=d(h),i+""}}return r.gamma=t,r}(1);function Xi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var qx=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,kg=new RegExp(qx.source,"g");function Y8(t){return function(){return t}}function G8(t){return function(e){return t(e)+""}}function K8(t,e){var n=qx.lastIndex=kg.lastIndex=0,r,i,s,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=qx.exec(t))&&(i=kg.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),l[o]?l[o]+=s:l[++o]=s),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:Xi(r,i)})),n=kg.lastIndex;return n<e.length&&(s=e.slice(n),l[o]?l[o]+=s:l[++o]=s),l.length<2?u[0]?G8(u[0].x):Y8(e):(e=u.length,function(d){for(var h=0,g;h<e;++h)l[(g=u[h]).i]=g.x(d);return l.join("")})}var wS=180/Math.PI,Vx={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pI(t,e,n,r,i,s){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*wS,skewX:Math.atan(u)*wS,scaleX:o,scaleY:l}}var Yu;function Z8(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Vx:pI(e.a,e.b,e.c,e.d,e.e,e.f)}function Q8(t){return t==null||(Yu||(Yu=document.createElementNS("http://www.w3.org/2000/svg","g")),Yu.setAttribute("transform",t),!(t=Yu.transform.baseVal.consolidate()))?Vx:(t=t.matrix,pI(t.a,t.b,t.c,t.d,t.e,t.f))}function gI(t,e,n,r){function i(d){return d.length?d.pop()+" ":""}function s(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push("translate(",null,e,null,n);T.push({i:w-4,x:Xi(d,g)},{i:w-2,x:Xi(h,_)})}else(g||_)&&y.push("translate("+g+e+_+n)}function o(d,h,g,_){d!==h?(d-h>180?h+=360:h-d>180&&(d+=360),_.push({i:g.push(i(g)+"rotate(",null,r)-2,x:Xi(d,h)})):h&&g.push(i(g)+"rotate("+h+r)}function l(d,h,g,_){d!==h?_.push({i:g.push(i(g)+"skewX(",null,r)-2,x:Xi(d,h)}):h&&g.push(i(g)+"skewX("+h+r)}function u(d,h,g,_,y,T){if(d!==g||h!==_){var w=y.push(i(y)+"scale(",null,",",null,")");T.push({i:w-4,x:Xi(d,g)},{i:w-2,x:Xi(h,_)})}else(g!==1||_!==1)&&y.push(i(y)+"scale("+g+","+_+")")}return function(d,h){var g=[],_=[];return d=t(d),h=t(h),s(d.translateX,d.translateY,h.translateX,h.translateY,g,_),o(d.rotate,h.rotate,g,_),l(d.skewX,h.skewX,g,_),u(d.scaleX,d.scaleY,h.scaleX,h.scaleY,g,_),d=h=null,function(y){for(var T=-1,w=_.length,x;++T<w;)g[(x=_[T]).i]=x.x(y);return g.join("")}}}var J8=gI(Z8,"px, ","px)","deg)"),eF=gI(Q8,", ",")",")"),tF=1e-12;function TS(t){return((t=Math.exp(t))+1/t)/2}function nF(t){return((t=Math.exp(t))-1/t)/2}function rF(t){return((t=Math.exp(2*t))-1)/(t+1)}const iF=function t(e,n,r){function i(s,o){var l=s[0],u=s[1],d=s[2],h=o[0],g=o[1],_=o[2],y=h-l,T=g-u,w=y*y+T*T,x,S;if(w<tF)S=Math.log(_/d)/e,x=function(O){return[l+O*y,u+O*T,d*Math.exp(e*O*S)]};else{var A=Math.sqrt(w),R=(_*_-d*d+r*w)/(2*d*n*A),E=(_*_-d*d-r*w)/(2*_*n*A),C=Math.log(Math.sqrt(R*R+1)-R),I=Math.log(Math.sqrt(E*E+1)-E);S=(I-C)/e,x=function(O){var M=O*S,P=TS(C),N=d/(n*A)*(P*rF(e*M+C)-nF(C));return[l+N*y,u+N*T,d*P/TS(e*M+C)]}}return x.duration=S*1e3*e/Math.SQRT2,x}return i.rho=function(s){var o=Math.max(.001,+s),l=o*o,u=l*l;return t(o,l,u)},i}(Math.SQRT2,2,4);var oo=0,Pl=0,Rl=0,mI=1e3,kf,Dl,Mf=0,Bs=0,Id=0,cc=typeof performance=="object"&&performance.now?performance:Date,_I=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Q0(){return Bs||(_I(sF),Bs=cc.now()+Id)}function sF(){Bs=0}function If(){this._call=this._time=this._next=null}If.prototype=J0.prototype={constructor:If,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Q0():+n)+(e==null?0:+e),!this._next&&Dl!==this&&(Dl?Dl._next=this:kf=this,Dl=this),this._call=t,this._time=n,$x()},stop:function(){this._call&&(this._call=null,this._time=1/0,$x())}};function J0(t,e,n){var r=new If;return r.restart(t,e,n),r}function aF(){Q0(),++oo;for(var t=kf,e;t;)(e=Bs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--oo}function SS(){Bs=(Mf=cc.now())+Id,oo=Pl=0;try{aF()}finally{oo=0,lF(),Bs=0}}function oF(){var t=cc.now(),e=t-Mf;e>mI&&(Id-=e,Mf=t)}function lF(){for(var t,e=kf,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:kf=n);Dl=t,$x(r)}function $x(t){if(!oo){Pl&&(Pl=clearTimeout(Pl));var e=t-Bs;e>24?(t<1/0&&(Pl=setTimeout(SS,t-cc.now()-Id)),Rl&&(Rl=clearInterval(Rl))):(Rl||(Mf=cc.now(),Rl=setInterval(oF,mI)),oo=1,_I(SS))}}function ES(t,e,n){var r=new If;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var cF=vc("start","end","cancel","interrupt"),uF=[],vI=0,AS=1,Hx=2,gf=3,RS=4,Wx=5,mf=6;function Od(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;fF(t,n,{name:e,index:r,group:i,on:cF,tween:uF,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:vI})}function e1(t,e){var n=kr(t,e);if(n.state>vI)throw new Error("too late; already scheduled");return n}function Wr(t,e){var n=kr(t,e);if(n.state>gf)throw new Error("too late; already running");return n}function kr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function fF(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=J0(s,0,n.time);function s(d){n.state=AS,n.timer.restart(o,n.delay,n.time),n.delay<=d&&o(d-n.delay)}function o(d){var h,g,_,y;if(n.state!==AS)return u();for(h in r)if(y=r[h],y.name===n.name){if(y.state===gf)return ES(o);y.state===RS?(y.state=mf,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete r[h]):+h<e&&(y.state=mf,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete r[h])}if(ES(function(){n.state===gf&&(n.state=RS,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=Hx,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Hx){for(n.state=gf,i=new Array(_=n.tween.length),h=0,g=-1;h<_;++h)(y=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++g]=y);i.length=g+1}}function l(d){for(var h=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=Wx,1),g=-1,_=i.length;++g<_;)i[g].call(t,h);n.state===Wx&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=mf,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function _f(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>Hx&&r.state<Wx,r.state=mf,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function dF(t){return this.each(function(){_f(this,t)})}function hF(t,e){var n,r;return function(){var i=Wr(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function pF(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Wr(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}s.tween=i}}function gF(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=kr(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?hF:pF)(n,t,e))}function t1(t,e,n){var r=t._id;return t.each(function(){var i=Wr(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return kr(i,r).value[e]}}function yI(t,e){var n;return(typeof e=="number"?Xi:e instanceof lc?xS:(n=lc(e))?(e=n,xS):K8)(t,e)}function mF(t){return function(){this.removeAttribute(t)}}function _F(t){return function(){this.removeAttributeNS(t.space,t.local)}}function vF(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function yF(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function bF(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function xF(t,e,n){var r,i,s;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l)))}}function wF(t,e){var n=Md(t),r=n==="transform"?eF:yI;return this.attrTween(t,typeof e=="function"?(n.local?xF:bF)(n,r,t1(this,"attr."+t,e)):e==null?(n.local?_F:mF)(n):(n.local?yF:vF)(n,r,e))}function TF(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function SF(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function EF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&SF(t,s)),n}return i._value=e,i}function AF(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&TF(t,s)),n}return i._value=e,i}function RF(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Md(t);return this.tween(n,(r.local?EF:AF)(r,e))}function CF(t,e){return function(){e1(this,t).delay=+e.apply(this,arguments)}}function NF(t,e){return e=+e,function(){e1(this,t).delay=e}}function kF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?CF:NF)(e,t)):kr(this.node(),e).delay}function MF(t,e){return function(){Wr(this,t).duration=+e.apply(this,arguments)}}function IF(t,e){return e=+e,function(){Wr(this,t).duration=e}}function OF(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?MF:IF)(e,t)):kr(this.node(),e).duration}function PF(t,e){if(typeof e!="function")throw new Error;return function(){Wr(this,t).ease=e}}function DF(t){var e=this._id;return arguments.length?this.each(PF(e,t)):kr(this.node(),e).ease}function jF(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Wr(this,t).ease=n}}function LF(t){if(typeof t!="function")throw new Error;return this.each(jF(this._id,t))}function BF(t){typeof t!="function"&&(t=QM(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,l=r[i]=[],u,d=0;d<o;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new mi(r,this._parents,this._name,this._id)}function UF(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),l=0;l<s;++l)for(var u=e[l],d=n[l],h=u.length,g=o[l]=new Array(h),_,y=0;y<h;++y)(_=u[y]||d[y])&&(g[y]=_);for(;l<r;++l)o[l]=e[l];return new mi(o,this._parents,this._name,this._id)}function FF(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function zF(t,e,n){var r,i,s=FF(e)?e1:Wr;return function(){var o=s(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function qF(t,e){var n=this._id;return arguments.length<2?kr(this.node(),n).on.on(t):this.each(zF(n,t,e))}function VF(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function $F(){return this.on("end.remove",VF(this._id))}function HF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=G0(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=s[o]=new Array(u),h,g,_=0;_<u;++_)(h=l[_])&&(g=t.call(h,h.__data__,_,l))&&("__data__"in h&&(g.__data__=h.__data__),d[_]=g,Od(d[_],e,n,_,d,kr(h,n)));return new mi(s,this._parents,e,n)}function WF(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ZM(t));for(var r=this._groups,i=r.length,s=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,h,g=0;g<d;++g)if(h=u[g]){for(var _=t.call(h,h.__data__,g,u),y,T=kr(h,n),w=0,x=_.length;w<x;++w)(y=_[w])&&Od(y,e,n,w,_,T);s.push(_),o.push(h)}return new mi(s,o,e,n)}var XF=yc.prototype.constructor;function YF(){return new XF(this._groups,this._parents)}function GF(t,e){var n,r,i;return function(){var s=ao(this,t),o=(this.style.removeProperty(t),ao(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function bI(t){return function(){this.style.removeProperty(t)}}function KF(t,e,n){var r,i=n+"",s;return function(){var o=ao(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function ZF(t,e,n){var r,i,s;return function(){var o=ao(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),ao(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,l))}}function QF(t,e){var n,r,i,s="style."+e,o="end."+s,l;return function(){var u=Wr(this,t),d=u.on,h=u.value[s]==null?l||(l=bI(e)):void 0;(d!==n||i!==h)&&(r=(n=d).copy()).on(o,i=h),u.on=r}}function JF(t,e,n){var r=(t+="")=="transform"?J8:yI;return e==null?this.styleTween(t,GF(t,r)).on("end.style."+t,bI(t)):typeof e=="function"?this.styleTween(t,ZF(t,r,t1(this,"style."+t,e))).each(QF(this._id,t)):this.styleTween(t,KF(t,r,e),n).on("end.style."+t,null)}function e5(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function t5(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&e5(t,o,n)),r}return s._value=e,s}function n5(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,t5(t,e,n??""))}function r5(t){return function(){this.textContent=t}}function i5(t){return function(){var e=t(this);this.textContent=e??""}}function s5(t){return this.tween("text",typeof t=="function"?i5(t1(this,"text",t)):r5(t==null?"":t+""))}function a5(t){return function(e){this.textContent=t.call(this,e)}}function o5(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&a5(i)),e}return r._value=t,r}function l5(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,o5(t))}function c5(){for(var t=this._name,e=this._id,n=xI(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var h=kr(u,e);Od(u,t,n,d,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new mi(r,this._parents,t,n)}function u5(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var l={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var d=Wr(this,r),h=d.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&s()})}var f5=0;function mi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function xI(){return++f5}var ui=yc.prototype;mi.prototype={constructor:mi,select:HF,selectAll:WF,selectChild:ui.selectChild,selectChildren:ui.selectChildren,filter:BF,merge:UF,selection:YF,transition:c5,call:ui.call,nodes:ui.nodes,node:ui.node,size:ui.size,empty:ui.empty,each:ui.each,on:qF,attr:wF,attrTween:RF,style:JF,styleTween:n5,text:s5,textTween:l5,remove:$F,tween:gF,delay:kF,duration:OF,ease:DF,easeVarying:LF,end:u5,[Symbol.iterator]:ui[Symbol.iterator]};function d5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var h5={time:null,delay:0,duration:250,ease:d5};function p5(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function g5(t){var e,n;t instanceof mi?(e=t._id,t=t._name):(e=xI(),(n=h5).time=Q0(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],l=o.length,u,d=0;d<l;++d)(u=o[d])&&Od(u,t,e,d,o,n||p5(u,e));return new mi(r,this._parents,t,e)}yc.prototype.interrupt=dF;yc.prototype.transition=g5;function m5(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return wI(this.cover(e,n),e,n,t)}function wI(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},l=t._x0,u=t._y0,d=t._x1,h=t._y1,g,_,y,T,w,x,S,A;if(!s)return t._root=o,t;for(;s.length;)if((w=e>=(g=(l+d)/2))?l=g:d=g,(x=n>=(_=(u+h)/2))?u=_:h=_,i=s,!(s=s[S=x<<1|w]))return i[S]=o,t;if(y=+t._x.call(null,s.data),T=+t._y.call(null,s.data),e===y&&n===T)return o.next=s,i?i[S]=o:t._root=o,t;do i=i?i[S]=new Array(4):t._root=new Array(4),(w=e>=(g=(l+d)/2))?l=g:d=g,(x=n>=(_=(u+h)/2))?u=_:h=_;while((S=x<<1|w)===(A=(T>=_)<<1|y>=g));return i[A]=s,i[S]=o,t}function _5(t){var e,n,r=t.length,i,s,o=new Array(r),l=new Array(r),u=1/0,d=1/0,h=-1/0,g=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,l[n]=s,i<u&&(u=i),i>h&&(h=i),s<d&&(d=s),s>g&&(g=s));if(u>h||d>g)return this;for(this.cover(u,d).cover(h,g),n=0;n<r;++n)wI(this,o[n],l[n],t[n]);return this}function v5(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,l=this._root,u,d;n>t||t>=i||r>e||e>=s;)switch(d=(e<r)<<1|t<n,u=new Array(4),u[d]=l,l=u,o*=2,d){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function y5(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function b5(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function En(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function x5(t,e,n){var r,i=this._x0,s=this._y0,o,l,u,d,h=this._x1,g=this._y1,_=[],y=this._root,T,w;for(y&&_.push(new En(y,i,s,h,g)),n==null?n=1/0:(i=t-n,s=e-n,h=t+n,g=e+n,n*=n);T=_.pop();)if(!(!(y=T.node)||(o=T.x0)>h||(l=T.y0)>g||(u=T.x1)<i||(d=T.y1)<s))if(y.length){var x=(o+u)/2,S=(l+d)/2;_.push(new En(y[3],x,S,u,d),new En(y[2],o,S,x,d),new En(y[1],x,l,u,S),new En(y[0],o,l,x,S)),(w=(e>=S)<<1|t>=x)&&(T=_[_.length-1],_[_.length-1]=_[_.length-1-w],_[_.length-1-w]=T)}else{var A=t-+this._x.call(null,y.data),R=e-+this._y.call(null,y.data),E=A*A+R*R;if(E<n){var C=Math.sqrt(n=E);i=t-C,s=e-C,h=t+C,g=e+C,r=y.data}}return r}function w5(t){if(isNaN(h=+this._x.call(null,t))||isNaN(g=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,l=this._y0,u=this._x1,d=this._y1,h,g,_,y,T,w,x,S;if(!n)return this;if(n.length)for(;;){if((T=h>=(_=(o+u)/2))?o=_:u=_,(w=g>=(y=(l+d)/2))?l=y:d=y,e=n,!(n=n[x=w<<1|T]))return this;if(!n.length)break;(e[x+1&3]||e[x+2&3]||e[x+3&3])&&(r=e,S=x)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[x]=s:delete e[x],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[S]=n:this._root=n),this):(this._root=s,this)}function T5(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function S5(){return this._root}function E5(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function A5(t){var e=[],n,r=this._root,i,s,o,l,u;for(r&&e.push(new En(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,l=n.x1,u=n.y1)&&r.length){var d=(s+l)/2,h=(o+u)/2;(i=r[3])&&e.push(new En(i,d,h,l,u)),(i=r[2])&&e.push(new En(i,s,h,d,u)),(i=r[1])&&e.push(new En(i,d,o,l,h)),(i=r[0])&&e.push(new En(i,s,o,d,h))}return this}function R5(t){var e=[],n=[],r;for(this._root&&e.push(new En(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,l=r.y0,u=r.x1,d=r.y1,h=(o+u)/2,g=(l+d)/2;(s=i[0])&&e.push(new En(s,o,l,h,g)),(s=i[1])&&e.push(new En(s,h,l,u,g)),(s=i[2])&&e.push(new En(s,o,g,h,d)),(s=i[3])&&e.push(new En(s,h,g,u,d))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function C5(t){return t[0]}function N5(t){return arguments.length?(this._x=t,this):this._x}function k5(t){return t[1]}function M5(t){return arguments.length?(this._y=t,this):this._y}function n1(t,e,n){var r=new r1(e??C5,n??k5,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function r1(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function CS(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Rn=n1.prototype=r1.prototype;Rn.copy=function(){var t=new r1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=CS(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=CS(r));return t};Rn.add=m5;Rn.addAll=_5;Rn.cover=v5;Rn.data=y5;Rn.extent=b5;Rn.find=x5;Rn.remove=w5;Rn.removeAll=T5;Rn.root=S5;Rn.size=E5;Rn.visit=A5;Rn.visitAfter=R5;Rn.x=N5;Rn.y=M5;function An(t){return function(){return t}}function es(t){return(t()-.5)*1e-6}function I5(t){return t.x+t.vx}function O5(t){return t.y+t.vy}function P5(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=An(t==null?1:+t));function o(){for(var d,h=e.length,g,_,y,T,w,x,S=0;S<s;++S)for(g=n1(e,I5,O5).visitAfter(l),d=0;d<h;++d)_=e[d],w=n[_.index],x=w*w,y=_.x+_.vx,T=_.y+_.vy,g.visit(A);function A(R,E,C,I,O){var M=R.data,P=R.r,N=w+P;if(M){if(M.index>_.index){var B=y-M.x-M.vx,z=T-M.y-M.vy,Q=B*B+z*z;Q<N*N&&(B===0&&(B=es(r),Q+=B*B),z===0&&(z=es(r),Q+=z*z),Q=(N-(Q=Math.sqrt(Q)))/Q*i,_.vx+=(B*=Q)*(N=(P*=P)/(x+P)),_.vy+=(z*=Q)*N,M.vx-=B*(N=1-N),M.vy-=z*N)}return}return E>y+N||I<y-N||C>T+N||O<T-N}}function l(d){if(d.data)return d.r=n[d.data.index];for(var h=d.r=0;h<4;++h)d[h]&&d[h].r>d.r&&(d.r=d[h].r)}function u(){if(e){var d,h=e.length,g;for(n=new Array(h),d=0;d<h;++d)g=e[d],n[g.index]=+t(g,d,e)}}return o.initialize=function(d,h){e=d,r=h,u()},o.iterations=function(d){return arguments.length?(s=+d,o):s},o.strength=function(d){return arguments.length?(i=+d,o):i},o.radius=function(d){return arguments.length?(t=typeof d=="function"?d:An(+d),u(),o):t},o}function D5(t){return t.index}function NS(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function j5(t){var e=D5,n=g,r,i=An(30),s,o,l,u,d,h=1;t==null&&(t=[]);function g(x){return 1/Math.min(l[x.source.index],l[x.target.index])}function _(x){for(var S=0,A=t.length;S<h;++S)for(var R=0,E,C,I,O,M,P,N;R<A;++R)E=t[R],C=E.source,I=E.target,O=I.x+I.vx-C.x-C.vx||es(d),M=I.y+I.vy-C.y-C.vy||es(d),P=Math.sqrt(O*O+M*M),P=(P-s[R])/P*x*r[R],O*=P,M*=P,I.vx-=O*(N=u[R]),I.vy-=M*N,C.vx+=O*(N=1-N),C.vy+=M*N}function y(){if(o){var x,S=o.length,A=t.length,R=new Map(o.map((C,I)=>[e(C,I,o),C])),E;for(x=0,l=new Array(S);x<A;++x)E=t[x],E.index=x,typeof E.source!="object"&&(E.source=NS(R,E.source)),typeof E.target!="object"&&(E.target=NS(R,E.target)),l[E.source.index]=(l[E.source.index]||0)+1,l[E.target.index]=(l[E.target.index]||0)+1;for(x=0,u=new Array(A);x<A;++x)E=t[x],u[x]=l[E.source.index]/(l[E.source.index]+l[E.target.index]);r=new Array(A),T(),s=new Array(A),w()}}function T(){if(o)for(var x=0,S=t.length;x<S;++x)r[x]=+n(t[x],x,t)}function w(){if(o)for(var x=0,S=t.length;x<S;++x)s[x]=+i(t[x],x,t)}return _.initialize=function(x,S){o=x,d=S,y()},_.links=function(x){return arguments.length?(t=x,y(),_):t},_.id=function(x){return arguments.length?(e=x,_):e},_.iterations=function(x){return arguments.length?(h=+x,_):h},_.strength=function(x){return arguments.length?(n=typeof x=="function"?x:An(+x),T(),_):n},_.distance=function(x){return arguments.length?(i=typeof x=="function"?x:An(+x),w(),_):i},_}const L5=1664525,B5=1013904223,kS=4294967296;function U5(){let t=1;return()=>(t=(L5*t+B5)%kS)/kS}function F5(t){return t.x}function z5(t){return t.y}var q5=10,V5=Math.PI*(3-Math.sqrt(5));function $5(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,l=new Map,u=J0(g),d=vc("tick","end"),h=U5();t==null&&(t=[]);function g(){_(),d.call("tick",e),n<r&&(u.stop(),d.call("end",e))}function _(w){var x,S=t.length,A;w===void 0&&(w=1);for(var R=0;R<w;++R)for(n+=(s-n)*i,l.forEach(function(E){E(n)}),x=0;x<S;++x)A=t[x],A.fx==null?A.x+=A.vx*=o:(A.x=A.fx,A.vx=0),A.fy==null?A.y+=A.vy*=o:(A.y=A.fy,A.vy=0);return e}function y(){for(var w=0,x=t.length,S;w<x;++w){if(S=t[w],S.index=w,S.fx!=null&&(S.x=S.fx),S.fy!=null&&(S.y=S.fy),isNaN(S.x)||isNaN(S.y)){var A=q5*Math.sqrt(.5+w),R=w*V5;S.x=A*Math.cos(R),S.y=A*Math.sin(R)}(isNaN(S.vx)||isNaN(S.vy))&&(S.vx=S.vy=0)}}function T(w){return w.initialize&&w.initialize(t,h),w}return y(),e={tick:_,restart:function(){return u.restart(g),e},stop:function(){return u.stop(),e},nodes:function(w){return arguments.length?(t=w,y(),l.forEach(T),e):t},alpha:function(w){return arguments.length?(n=+w,e):n},alphaMin:function(w){return arguments.length?(r=+w,e):r},alphaDecay:function(w){return arguments.length?(i=+w,e):+i},alphaTarget:function(w){return arguments.length?(s=+w,e):s},velocityDecay:function(w){return arguments.length?(o=1-w,e):1-o},randomSource:function(w){return arguments.length?(h=w,l.forEach(T),e):h},force:function(w,x){return arguments.length>1?(x==null?l.delete(w):l.set(w,T(x)),e):l.get(w)},find:function(w,x,S){var A=0,R=t.length,E,C,I,O,M;for(S==null?S=1/0:S*=S,A=0;A<R;++A)O=t[A],E=w-O.x,C=x-O.y,I=E*E+C*C,I<S&&(M=O,S=I);return M},on:function(w,x){return arguments.length>1?(d.on(w,x),e):d.on(w)}}}function H5(){var t,e,n,r,i=An(-30),s,o=1,l=1/0,u=.81;function d(y){var T,w=t.length,x=n1(t,F5,z5).visitAfter(g);for(r=y,T=0;T<w;++T)e=t[T],x.visit(_)}function h(){if(t){var y,T=t.length,w;for(s=new Array(T),y=0;y<T;++y)w=t[y],s[w.index]=+i(w,y,t)}}function g(y){var T=0,w,x,S=0,A,R,E;if(y.length){for(A=R=E=0;E<4;++E)(w=y[E])&&(x=Math.abs(w.value))&&(T+=w.value,S+=x,A+=x*w.x,R+=x*w.y);y.x=A/S,y.y=R/S}else{w=y,w.x=w.data.x,w.y=w.data.y;do T+=s[w.data.index];while(w=w.next)}y.value=T}function _(y,T,w,x){if(!y.value)return!0;var S=y.x-e.x,A=y.y-e.y,R=x-T,E=S*S+A*A;if(R*R/u<E)return E<l&&(S===0&&(S=es(n),E+=S*S),A===0&&(A=es(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)),e.vx+=S*y.value*r/E,e.vy+=A*y.value*r/E),!0;if(y.length||E>=l)return;(y.data!==e||y.next)&&(S===0&&(S=es(n),E+=S*S),A===0&&(A=es(n),E+=A*A),E<o&&(E=Math.sqrt(o*E)));do y.data!==e&&(R=s[y.data.index]*r/E,e.vx+=S*R,e.vy+=A*R);while(y=y.next)}return d.initialize=function(y,T){t=y,n=T,h()},d.strength=function(y){return arguments.length?(i=typeof y=="function"?y:An(+y),h(),d):i},d.distanceMin=function(y){return arguments.length?(o=y*y,d):Math.sqrt(o)},d.distanceMax=function(y){return arguments.length?(l=y*y,d):Math.sqrt(l)},d.theta=function(y){return arguments.length?(u=y*y,d):Math.sqrt(u)},d}function W5(t){var e=An(.1),n,r,i;typeof t!="function"&&(t=An(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vx+=(i[u]-h.x)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:An(+l),o(),s):e},s.x=function(l){return arguments.length?(t=typeof l=="function"?l:An(+l),o(),s):t},s}function X5(t){var e=An(.1),n,r,i;typeof t!="function"&&(t=An(t==null?0:+t));function s(l){for(var u=0,d=n.length,h;u<d;++u)h=n[u],h.vy+=(i[u]-h.y)*r[u]*l}function o(){if(n){var l,u=n.length;for(r=new Array(u),i=new Array(u),l=0;l<u;++l)r[l]=isNaN(i[l]=+t(n[l],l,n))?0:+e(n[l],l,n)}}return s.initialize=function(l){n=l,o()},s.strength=function(l){return arguments.length?(e=typeof l=="function"?l:An(+l),o(),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:An(+l),o(),s):t},s}const Gu=t=>()=>t;function Y5(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function gi(t,e,n){this.k=t,this.x=e,this.y=n}gi.prototype={constructor:gi,scale:function(t){return t===1?this:new gi(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new gi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Pd=new gi(1,0,0);gi.prototype;function Mg(t){t.stopImmediatePropagation()}function Cl(t){t.preventDefault(),t.stopImmediatePropagation()}function G5(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function K5(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function MS(){return this.__zoom||Pd}function Z5(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Q5(){return navigator.maxTouchPoints||"ontouchstart"in this}function J5(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function ez(){var t=G5,e=K5,n=J5,r=Z5,i=Q5,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],l=250,u=iF,d=vc("start","zoom","end"),h,g,_,y=500,T=150,w=0,x=10;function S(H){H.property("__zoom",MS).on("wheel.zoom",M,{passive:!1}).on("mousedown.zoom",P).on("dblclick.zoom",N).filter(i).on("touchstart.zoom",B).on("touchmove.zoom",z).on("touchend.zoom touchcancel.zoom",Q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}S.transform=function(H,W,q,ee){var de=H.selection?H.selection():H;de.property("__zoom",MS),H!==de?C(H,W,q,ee):de.interrupt().each(function(){I(this,arguments).event(ee).start().zoom(null,typeof W=="function"?W.apply(this,arguments):W).end()})},S.scaleBy=function(H,W,q,ee){S.scaleTo(H,function(){var de=this.__zoom.k,Z=typeof W=="function"?W.apply(this,arguments):W;return de*Z},q,ee)},S.scaleTo=function(H,W,q,ee){S.transform(H,function(){var de=e.apply(this,arguments),Z=this.__zoom,D=q==null?E(de):typeof q=="function"?q.apply(this,arguments):q,G=Z.invert(D),oe=typeof W=="function"?W.apply(this,arguments):W;return n(R(A(Z,oe),D,G),de,o)},q,ee)},S.translateBy=function(H,W,q,ee){S.transform(H,function(){return n(this.__zoom.translate(typeof W=="function"?W.apply(this,arguments):W,typeof q=="function"?q.apply(this,arguments):q),e.apply(this,arguments),o)},null,ee)},S.translateTo=function(H,W,q,ee,de){S.transform(H,function(){var Z=e.apply(this,arguments),D=this.__zoom,G=ee==null?E(Z):typeof ee=="function"?ee.apply(this,arguments):ee;return n(Pd.translate(G[0],G[1]).scale(D.k).translate(typeof W=="function"?-W.apply(this,arguments):-W,typeof q=="function"?-q.apply(this,arguments):-q),Z,o)},ee,de)};function A(H,W){return W=Math.max(s[0],Math.min(s[1],W)),W===H.k?H:new gi(W,H.x,H.y)}function R(H,W,q){var ee=W[0]-q[0]*H.k,de=W[1]-q[1]*H.k;return ee===H.x&&de===H.y?H:new gi(H.k,ee,de)}function E(H){return[(+H[0][0]+ +H[1][0])/2,(+H[0][1]+ +H[1][1])/2]}function C(H,W,q,ee){H.on("start.zoom",function(){I(this,arguments).event(ee).start()}).on("interrupt.zoom end.zoom",function(){I(this,arguments).event(ee).end()}).tween("zoom",function(){var de=this,Z=arguments,D=I(de,Z).event(ee),G=e.apply(de,Z),oe=q==null?E(G):typeof q=="function"?q.apply(de,Z):q,ie=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),F=de.__zoom,$=typeof W=="function"?W.apply(de,Z):W,Y=u(F.invert(oe).concat(ie/F.k),$.invert(oe).concat(ie/$.k));return function(ue){if(ue===1)ue=$;else{var ye=Y(ue),Se=ie/ye[2];ue=new gi(Se,oe[0]-ye[0]*Se,oe[1]-ye[1]*Se)}D.zoom(null,ue)}})}function I(H,W,q){return!q&&H.__zooming||new O(H,W)}function O(H,W){this.that=H,this.args=W,this.active=0,this.sourceEvent=null,this.extent=e.apply(H,W),this.taps=0}O.prototype={event:function(H){return H&&(this.sourceEvent=H),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(H,W){return this.mouse&&H!=="mouse"&&(this.mouse[1]=W.invert(this.mouse[0])),this.touch0&&H!=="touch"&&(this.touch0[1]=W.invert(this.touch0[0])),this.touch1&&H!=="touch"&&(this.touch1[1]=W.invert(this.touch1[0])),this.that.__zoom=W,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(H){var W=lr(this.that).datum();d.call(H,this.that,new Y5(H,{sourceEvent:this.sourceEvent,target:S,transform:this.that.__zoom,dispatch:d}),W)}};function M(H,...W){if(!t.apply(this,arguments))return;var q=I(this,W).event(H),ee=this.__zoom,de=Math.max(s[0],Math.min(s[1],ee.k*Math.pow(2,r.apply(this,arguments)))),Z=fi(H);if(q.wheel)(q.mouse[0][0]!==Z[0]||q.mouse[0][1]!==Z[1])&&(q.mouse[1]=ee.invert(q.mouse[0]=Z)),clearTimeout(q.wheel);else{if(ee.k===de)return;q.mouse=[Z,ee.invert(Z)],_f(this),q.start()}Cl(H),q.wheel=setTimeout(D,T),q.zoom("mouse",n(R(A(ee,de),q.mouse[0],q.mouse[1]),q.extent,o));function D(){q.wheel=null,q.end()}}function P(H,...W){if(_||!t.apply(this,arguments))return;var q=H.currentTarget,ee=I(this,W,!0).event(H),de=lr(H.view).on("mousemove.zoom",oe,!0).on("mouseup.zoom",ie,!0),Z=fi(H,q),D=H.clientX,G=H.clientY;lI(H.view),Mg(H),ee.mouse=[Z,this.__zoom.invert(Z)],_f(this),ee.start();function oe(F){if(Cl(F),!ee.moved){var $=F.clientX-D,Y=F.clientY-G;ee.moved=$*$+Y*Y>w}ee.event(F).zoom("mouse",n(R(ee.that.__zoom,ee.mouse[0]=fi(F,q),ee.mouse[1]),ee.extent,o))}function ie(F){de.on("mousemove.zoom mouseup.zoom",null),cI(F.view,ee.moved),Cl(F),ee.event(F).end()}}function N(H,...W){if(t.apply(this,arguments)){var q=this.__zoom,ee=fi(H.changedTouches?H.changedTouches[0]:H,this),de=q.invert(ee),Z=q.k*(H.shiftKey?.5:2),D=n(R(A(q,Z),ee,de),e.apply(this,W),o);Cl(H),l>0?lr(this).transition().duration(l).call(C,D,ee,H):lr(this).call(S.transform,D,ee,H)}}function B(H,...W){if(t.apply(this,arguments)){var q=H.touches,ee=q.length,de=I(this,W,H.changedTouches.length===ee).event(H),Z,D,G,oe;for(Mg(H),D=0;D<ee;++D)G=q[D],oe=fi(G,this),oe=[oe,this.__zoom.invert(oe),G.identifier],de.touch0?!de.touch1&&de.touch0[2]!==oe[2]&&(de.touch1=oe,de.taps=0):(de.touch0=oe,Z=!0,de.taps=1+!!h);h&&(h=clearTimeout(h)),Z&&(de.taps<2&&(g=oe[0],h=setTimeout(function(){h=null},y)),_f(this),de.start())}}function z(H,...W){if(this.__zooming){var q=I(this,W).event(H),ee=H.changedTouches,de=ee.length,Z,D,G,oe;for(Cl(H),Z=0;Z<de;++Z)D=ee[Z],G=fi(D,this),q.touch0&&q.touch0[2]===D.identifier?q.touch0[0]=G:q.touch1&&q.touch1[2]===D.identifier&&(q.touch1[0]=G);if(D=q.that.__zoom,q.touch1){var ie=q.touch0[0],F=q.touch0[1],$=q.touch1[0],Y=q.touch1[1],ue=(ue=$[0]-ie[0])*ue+(ue=$[1]-ie[1])*ue,ye=(ye=Y[0]-F[0])*ye+(ye=Y[1]-F[1])*ye;D=A(D,Math.sqrt(ue/ye)),G=[(ie[0]+$[0])/2,(ie[1]+$[1])/2],oe=[(F[0]+Y[0])/2,(F[1]+Y[1])/2]}else if(q.touch0)G=q.touch0[0],oe=q.touch0[1];else return;q.zoom("touch",n(R(D,G,oe),q.extent,o))}}function Q(H,...W){if(this.__zooming){var q=I(this,W).event(H),ee=H.changedTouches,de=ee.length,Z,D;for(Mg(H),_&&clearTimeout(_),_=setTimeout(function(){_=null},y),Z=0;Z<de;++Z)D=ee[Z],q.touch0&&q.touch0[2]===D.identifier?delete q.touch0:q.touch1&&q.touch1[2]===D.identifier&&delete q.touch1;if(q.touch1&&!q.touch0&&(q.touch0=q.touch1,delete q.touch1),q.touch0)q.touch0[1]=this.__zoom.invert(q.touch0[0]);else if(q.end(),q.taps===2&&(D=fi(D,this),Math.hypot(g[0]-D[0],g[1]-D[1])<x)){var G=lr(this).on("dblclick.zoom");G&&G.apply(this,arguments)}}}return S.wheelDelta=function(H){return arguments.length?(r=typeof H=="function"?H:Gu(+H),S):r},S.filter=function(H){return arguments.length?(t=typeof H=="function"?H:Gu(!!H),S):t},S.touchable=function(H){return arguments.length?(i=typeof H=="function"?H:Gu(!!H),S):i},S.extent=function(H){return arguments.length?(e=typeof H=="function"?H:Gu([[+H[0][0],+H[0][1]],[+H[1][0],+H[1][1]]]),S):e},S.scaleExtent=function(H){return arguments.length?(s[0]=+H[0],s[1]=+H[1],S):[s[0],s[1]]},S.translateExtent=function(H){return arguments.length?(o[0][0]=+H[0][0],o[1][0]=+H[1][0],o[0][1]=+H[0][1],o[1][1]=+H[1][1],S):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},S.constrain=function(H){return arguments.length?(n=H,S):n},S.duration=function(H){return arguments.length?(l=+H,S):l},S.interpolate=function(H){return arguments.length?(u=H,S):u},S.on=function(){var H=d.on.apply(d,arguments);return H===d?S:H},S.clickDistance=function(H){return arguments.length?(w=(H=+H)*H,S):Math.sqrt(w)},S.tapDistance=function(H){return arguments.length?(x=+H,S):x},S}function i1(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ig,IS;function tz(){if(IS)return Ig;IS=1;function t(){this.__data__=[],this.size=0}return Ig=t,Ig}var Og,OS;function xo(){if(OS)return Og;OS=1;function t(e,n){return e===n||e!==e&&n!==n}return Og=t,Og}var Pg,PS;function Dd(){if(PS)return Pg;PS=1;var t=xo();function e(n,r){for(var i=n.length;i--;)if(t(n[i][0],r))return i;return-1}return Pg=e,Pg}var Dg,DS;function nz(){if(DS)return Dg;DS=1;var t=Dd(),e=Array.prototype,n=e.splice;function r(i){var s=this.__data__,o=t(s,i);if(o<0)return!1;var l=s.length-1;return o==l?s.pop():n.call(s,o,1),--this.size,!0}return Dg=r,Dg}var jg,jS;function rz(){if(jS)return jg;jS=1;var t=Dd();function e(n){var r=this.__data__,i=t(r,n);return i<0?void 0:r[i][1]}return jg=e,jg}var Lg,LS;function iz(){if(LS)return Lg;LS=1;var t=Dd();function e(n){return t(this.__data__,n)>-1}return Lg=e,Lg}var Bg,BS;function sz(){if(BS)return Bg;BS=1;var t=Dd();function e(n,r){var i=this.__data__,s=t(i,n);return s<0?(++this.size,i.push([n,r])):i[s][1]=r,this}return Bg=e,Bg}var Ug,US;function jd(){if(US)return Ug;US=1;var t=tz(),e=nz(),n=rz(),r=iz(),i=sz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,Ug=s,Ug}var Fg,FS;function az(){if(FS)return Fg;FS=1;var t=jd();function e(){this.__data__=new t,this.size=0}return Fg=e,Fg}var zg,zS;function oz(){if(zS)return zg;zS=1;function t(e){var n=this.__data__,r=n.delete(e);return this.size=n.size,r}return zg=t,zg}var qg,qS;function lz(){if(qS)return qg;qS=1;function t(e){return this.__data__.get(e)}return qg=t,qg}var Vg,VS;function cz(){if(VS)return Vg;VS=1;function t(e){return this.__data__.has(e)}return Vg=t,Vg}var $g,$S;function TI(){if($S)return $g;$S=1;var t=typeof Vu=="object"&&Vu&&Vu.Object===Object&&Vu;return $g=t,$g}var Hg,HS;function Mr(){if(HS)return Hg;HS=1;var t=TI(),e=typeof self=="object"&&self&&self.Object===Object&&self,n=t||e||Function("return this")();return Hg=n,Hg}var Wg,WS;function wo(){if(WS)return Wg;WS=1;var t=Mr(),e=t.Symbol;return Wg=e,Wg}var Xg,XS;function uz(){if(XS)return Xg;XS=1;var t=wo(),e=Object.prototype,n=e.hasOwnProperty,r=e.toString,i=t?t.toStringTag:void 0;function s(o){var l=n.call(o,i),u=o[i];try{o[i]=void 0;var d=!0}catch{}var h=r.call(o);return d&&(l?o[i]=u:delete o[i]),h}return Xg=s,Xg}var Yg,YS;function fz(){if(YS)return Yg;YS=1;var t=Object.prototype,e=t.toString;function n(r){return e.call(r)}return Yg=n,Yg}var Gg,GS;function Ws(){if(GS)return Gg;GS=1;var t=wo(),e=uz(),n=fz(),r="[object Null]",i="[object Undefined]",s=t?t.toStringTag:void 0;function o(l){return l==null?l===void 0?i:r:s&&s in Object(l)?e(l):n(l)}return Gg=o,Gg}var Kg,KS;function pr(){if(KS)return Kg;KS=1;function t(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}return Kg=t,Kg}var Zg,ZS;function xc(){if(ZS)return Zg;ZS=1;var t=Ws(),e=pr(),n="[object AsyncFunction]",r="[object Function]",i="[object GeneratorFunction]",s="[object Proxy]";function o(l){if(!e(l))return!1;var u=t(l);return u==r||u==i||u==n||u==s}return Zg=o,Zg}var Qg,QS;function dz(){if(QS)return Qg;QS=1;var t=Mr(),e=t["__core-js_shared__"];return Qg=e,Qg}var Jg,JS;function hz(){if(JS)return Jg;JS=1;var t=dz(),e=function(){var r=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function n(r){return!!e&&e in r}return Jg=n,Jg}var em,eE;function SI(){if(eE)return em;eE=1;var t=Function.prototype,e=t.toString;function n(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}return em=n,em}var tm,tE;function pz(){if(tE)return tm;tE=1;var t=xc(),e=hz(),n=pr(),r=SI(),i=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,l=Object.prototype,u=o.toString,d=l.hasOwnProperty,h=RegExp("^"+u.call(d).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function g(_){if(!n(_)||e(_))return!1;var y=t(_)?h:s;return y.test(r(_))}return tm=g,tm}var nm,nE;function gz(){if(nE)return nm;nE=1;function t(e,n){return e==null?void 0:e[n]}return nm=t,nm}var rm,rE;function Xs(){if(rE)return rm;rE=1;var t=pz(),e=gz();function n(r,i){var s=e(r,i);return t(s)?s:void 0}return rm=n,rm}var im,iE;function s1(){if(iE)return im;iE=1;var t=Xs(),e=Mr(),n=t(e,"Map");return im=n,im}var sm,sE;function Ld(){if(sE)return sm;sE=1;var t=Xs(),e=t(Object,"create");return sm=e,sm}var am,aE;function mz(){if(aE)return am;aE=1;var t=Ld();function e(){this.__data__=t?t(null):{},this.size=0}return am=e,am}var om,oE;function _z(){if(oE)return om;oE=1;function t(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}return om=t,om}var lm,lE;function vz(){if(lE)return lm;lE=1;var t=Ld(),e="__lodash_hash_undefined__",n=Object.prototype,r=n.hasOwnProperty;function i(s){var o=this.__data__;if(t){var l=o[s];return l===e?void 0:l}return r.call(o,s)?o[s]:void 0}return lm=i,lm}var cm,cE;function yz(){if(cE)return cm;cE=1;var t=Ld(),e=Object.prototype,n=e.hasOwnProperty;function r(i){var s=this.__data__;return t?s[i]!==void 0:n.call(s,i)}return cm=r,cm}var um,uE;function bz(){if(uE)return um;uE=1;var t=Ld(),e="__lodash_hash_undefined__";function n(r,i){var s=this.__data__;return this.size+=this.has(r)?0:1,s[r]=t&&i===void 0?e:i,this}return um=n,um}var fm,fE;function xz(){if(fE)return fm;fE=1;var t=mz(),e=_z(),n=vz(),r=yz(),i=bz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,fm=s,fm}var dm,dE;function wz(){if(dE)return dm;dE=1;var t=xz(),e=jd(),n=s1();function r(){this.size=0,this.__data__={hash:new t,map:new(n||e),string:new t}}return dm=r,dm}var hm,hE;function Tz(){if(hE)return hm;hE=1;function t(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}return hm=t,hm}var pm,pE;function Bd(){if(pE)return pm;pE=1;var t=Tz();function e(n,r){var i=n.__data__;return t(r)?i[typeof r=="string"?"string":"hash"]:i.map}return pm=e,pm}var gm,gE;function Sz(){if(gE)return gm;gE=1;var t=Bd();function e(n){var r=t(this,n).delete(n);return this.size-=r?1:0,r}return gm=e,gm}var mm,mE;function Ez(){if(mE)return mm;mE=1;var t=Bd();function e(n){return t(this,n).get(n)}return mm=e,mm}var _m,_E;function Az(){if(_E)return _m;_E=1;var t=Bd();function e(n){return t(this,n).has(n)}return _m=e,_m}var vm,vE;function Rz(){if(vE)return vm;vE=1;var t=Bd();function e(n,r){var i=t(this,n),s=i.size;return i.set(n,r),this.size+=i.size==s?0:1,this}return vm=e,vm}var ym,yE;function a1(){if(yE)return ym;yE=1;var t=wz(),e=Sz(),n=Ez(),r=Az(),i=Rz();function s(o){var l=-1,u=o==null?0:o.length;for(this.clear();++l<u;){var d=o[l];this.set(d[0],d[1])}}return s.prototype.clear=t,s.prototype.delete=e,s.prototype.get=n,s.prototype.has=r,s.prototype.set=i,ym=s,ym}var bm,bE;function Cz(){if(bE)return bm;bE=1;var t=jd(),e=s1(),n=a1(),r=200;function i(s,o){var l=this.__data__;if(l instanceof t){var u=l.__data__;if(!e||u.length<r-1)return u.push([s,o]),this.size=++l.size,this;l=this.__data__=new n(u)}return l.set(s,o),this.size=l.size,this}return bm=i,bm}var xm,xE;function Ud(){if(xE)return xm;xE=1;var t=jd(),e=az(),n=oz(),r=lz(),i=cz(),s=Cz();function o(l){var u=this.__data__=new t(l);this.size=u.size}return o.prototype.clear=e,o.prototype.delete=n,o.prototype.get=r,o.prototype.has=i,o.prototype.set=s,xm=o,xm}var wm,wE;function o1(){if(wE)return wm;wE=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i&&n(e[r],r,e)!==!1;);return e}return wm=t,wm}var Tm,TE;function EI(){if(TE)return Tm;TE=1;var t=Xs(),e=function(){try{var n=t(Object,"defineProperty");return n({},"",{}),n}catch{}}();return Tm=e,Tm}var Sm,SE;function Fd(){if(SE)return Sm;SE=1;var t=EI();function e(n,r,i){r=="__proto__"&&t?t(n,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[r]=i}return Sm=e,Sm}var Em,EE;function zd(){if(EE)return Em;EE=1;var t=Fd(),e=xo(),n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l){var u=s[o];(!(r.call(s,o)&&e(u,l))||l===void 0&&!(o in s))&&t(s,o,l)}return Em=i,Em}var Am,AE;function wc(){if(AE)return Am;AE=1;var t=zd(),e=Fd();function n(r,i,s,o){var l=!s;s||(s={});for(var u=-1,d=i.length;++u<d;){var h=i[u],g=o?o(s[h],r[h],h,s,r):void 0;g===void 0&&(g=r[h]),l?e(s,h,g):t(s,h,g)}return s}return Am=n,Am}var Rm,RE;function Nz(){if(RE)return Rm;RE=1;function t(e,n){for(var r=-1,i=Array(e);++r<e;)i[r]=n(r);return i}return Rm=t,Rm}var Cm,CE;function Xr(){if(CE)return Cm;CE=1;function t(e){return e!=null&&typeof e=="object"}return Cm=t,Cm}var Nm,NE;function kz(){if(NE)return Nm;NE=1;var t=Ws(),e=Xr(),n="[object Arguments]";function r(i){return e(i)&&t(i)==n}return Nm=r,Nm}var km,kE;function Tc(){if(kE)return km;kE=1;var t=kz(),e=Xr(),n=Object.prototype,r=n.hasOwnProperty,i=n.propertyIsEnumerable,s=t(function(){return arguments}())?t:function(o){return e(o)&&r.call(o,"callee")&&!i.call(o,"callee")};return km=s,km}var Mm,ME;function Wt(){if(ME)return Mm;ME=1;var t=Array.isArray;return Mm=t,Mm}var jl={exports:{}},Im,IE;function Mz(){if(IE)return Im;IE=1;function t(){return!1}return Im=t,Im}jl.exports;var OE;function To(){return OE||(OE=1,function(t,e){var n=Mr(),r=Mz(),i=e&&!e.nodeType&&e,s=i&&!0&&t&&!t.nodeType&&t,o=s&&s.exports===i,l=o?n.Buffer:void 0,u=l?l.isBuffer:void 0,d=u||r;t.exports=d}(jl,jl.exports)),jl.exports}var Om,PE;function qd(){if(PE)return Om;PE=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function n(r,i){var s=typeof r;return i=i??t,!!i&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}return Om=n,Om}var Pm,DE;function l1(){if(DE)return Pm;DE=1;var t=9007199254740991;function e(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=t}return Pm=e,Pm}var Dm,jE;function Iz(){if(jE)return Dm;jE=1;var t=Ws(),e=l1(),n=Xr(),r="[object Arguments]",i="[object Array]",s="[object Boolean]",o="[object Date]",l="[object Error]",u="[object Function]",d="[object Map]",h="[object Number]",g="[object Object]",_="[object RegExp]",y="[object Set]",T="[object String]",w="[object WeakMap]",x="[object ArrayBuffer]",S="[object DataView]",A="[object Float32Array]",R="[object Float64Array]",E="[object Int8Array]",C="[object Int16Array]",I="[object Int32Array]",O="[object Uint8Array]",M="[object Uint8ClampedArray]",P="[object Uint16Array]",N="[object Uint32Array]",B={};B[A]=B[R]=B[E]=B[C]=B[I]=B[O]=B[M]=B[P]=B[N]=!0,B[r]=B[i]=B[x]=B[s]=B[S]=B[o]=B[l]=B[u]=B[d]=B[h]=B[g]=B[_]=B[y]=B[T]=B[w]=!1;function z(Q){return n(Q)&&e(Q.length)&&!!B[t(Q)]}return Dm=z,Dm}var jm,LE;function Vd(){if(LE)return jm;LE=1;function t(e){return function(n){return e(n)}}return jm=t,jm}var Ll={exports:{}};Ll.exports;var BE;function c1(){return BE||(BE=1,function(t,e){var n=TI(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s&&n.process,l=function(){try{var u=i&&i.require&&i.require("util").types;return u||o&&o.binding&&o.binding("util")}catch{}}();t.exports=l}(Ll,Ll.exports)),Ll.exports}var Lm,UE;function Sc(){if(UE)return Lm;UE=1;var t=Iz(),e=Vd(),n=c1(),r=n&&n.isTypedArray,i=r?e(r):t;return Lm=i,Lm}var Bm,FE;function AI(){if(FE)return Bm;FE=1;var t=Nz(),e=Tc(),n=Wt(),r=To(),i=qd(),s=Sc(),o=Object.prototype,l=o.hasOwnProperty;function u(d,h){var g=n(d),_=!g&&e(d),y=!g&&!_&&r(d),T=!g&&!_&&!y&&s(d),w=g||_||y||T,x=w?t(d.length,String):[],S=x.length;for(var A in d)(h||l.call(d,A))&&!(w&&(A=="length"||y&&(A=="offset"||A=="parent")||T&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||i(A,S)))&&x.push(A);return x}return Bm=u,Bm}var Um,zE;function $d(){if(zE)return Um;zE=1;var t=Object.prototype;function e(n){var r=n&&n.constructor,i=typeof r=="function"&&r.prototype||t;return n===i}return Um=e,Um}var Fm,qE;function RI(){if(qE)return Fm;qE=1;function t(e,n){return function(r){return e(n(r))}}return Fm=t,Fm}var zm,VE;function Oz(){if(VE)return zm;VE=1;var t=RI(),e=t(Object.keys,Object);return zm=e,zm}var qm,$E;function u1(){if($E)return qm;$E=1;var t=$d(),e=Oz(),n=Object.prototype,r=n.hasOwnProperty;function i(s){if(!t(s))return e(s);var o=[];for(var l in Object(s))r.call(s,l)&&l!="constructor"&&o.push(l);return o}return qm=i,qm}var Vm,HE;function vi(){if(HE)return Vm;HE=1;var t=xc(),e=l1();function n(r){return r!=null&&e(r.length)&&!t(r)}return Vm=n,Vm}var $m,WE;function as(){if(WE)return $m;WE=1;var t=AI(),e=u1(),n=vi();function r(i){return n(i)?t(i):e(i)}return $m=r,$m}var Hm,XE;function Pz(){if(XE)return Hm;XE=1;var t=wc(),e=as();function n(r,i){return r&&t(i,e(i),r)}return Hm=n,Hm}var Wm,YE;function Dz(){if(YE)return Wm;YE=1;function t(e){var n=[];if(e!=null)for(var r in Object(e))n.push(r);return n}return Wm=t,Wm}var Xm,GE;function jz(){if(GE)return Xm;GE=1;var t=pr(),e=$d(),n=Dz(),r=Object.prototype,i=r.hasOwnProperty;function s(o){if(!t(o))return n(o);var l=e(o),u=[];for(var d in o)d=="constructor"&&(l||!i.call(o,d))||u.push(d);return u}return Xm=s,Xm}var Ym,KE;function Ys(){if(KE)return Ym;KE=1;var t=AI(),e=jz(),n=vi();function r(i){return n(i)?t(i,!0):e(i)}return Ym=r,Ym}var Gm,ZE;function Lz(){if(ZE)return Gm;ZE=1;var t=wc(),e=Ys();function n(r,i){return r&&t(i,e(i),r)}return Gm=n,Gm}var Bl={exports:{}};Bl.exports;var QE;function CI(){return QE||(QE=1,function(t,e){var n=Mr(),r=e&&!e.nodeType&&e,i=r&&!0&&t&&!t.nodeType&&t,s=i&&i.exports===r,o=s?n.Buffer:void 0,l=o?o.allocUnsafe:void 0;function u(d,h){if(h)return d.slice();var g=d.length,_=l?l(g):new d.constructor(g);return d.copy(_),_}t.exports=u}(Bl,Bl.exports)),Bl.exports}var Km,JE;function NI(){if(JE)return Km;JE=1;function t(e,n){var r=-1,i=e.length;for(n||(n=Array(i));++r<i;)n[r]=e[r];return n}return Km=t,Km}var Zm,eA;function kI(){if(eA)return Zm;eA=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=0,o=[];++r<i;){var l=e[r];n(l,r,e)&&(o[s++]=l)}return o}return Zm=t,Zm}var Qm,tA;function MI(){if(tA)return Qm;tA=1;function t(){return[]}return Qm=t,Qm}var Jm,nA;function f1(){if(nA)return Jm;nA=1;var t=kI(),e=MI(),n=Object.prototype,r=n.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(o){return o==null?[]:(o=Object(o),t(i(o),function(l){return r.call(o,l)}))}:e;return Jm=s,Jm}var e_,rA;function Bz(){if(rA)return e_;rA=1;var t=wc(),e=f1();function n(r,i){return t(r,e(r),i)}return e_=n,e_}var t_,iA;function d1(){if(iA)return t_;iA=1;function t(e,n){for(var r=-1,i=n.length,s=e.length;++r<i;)e[s+r]=n[r];return e}return t_=t,t_}var n_,sA;function Hd(){if(sA)return n_;sA=1;var t=RI(),e=t(Object.getPrototypeOf,Object);return n_=e,n_}var r_,aA;function II(){if(aA)return r_;aA=1;var t=d1(),e=Hd(),n=f1(),r=MI(),i=Object.getOwnPropertySymbols,s=i?function(o){for(var l=[];o;)t(l,n(o)),o=e(o);return l}:r;return r_=s,r_}var i_,oA;function Uz(){if(oA)return i_;oA=1;var t=wc(),e=II();function n(r,i){return t(r,e(r),i)}return i_=n,i_}var s_,lA;function OI(){if(lA)return s_;lA=1;var t=d1(),e=Wt();function n(r,i,s){var o=i(r);return e(r)?o:t(o,s(r))}return s_=n,s_}var a_,cA;function PI(){if(cA)return a_;cA=1;var t=OI(),e=f1(),n=as();function r(i){return t(i,n,e)}return a_=r,a_}var o_,uA;function Fz(){if(uA)return o_;uA=1;var t=OI(),e=II(),n=Ys();function r(i){return t(i,n,e)}return o_=r,o_}var l_,fA;function zz(){if(fA)return l_;fA=1;var t=Xs(),e=Mr(),n=t(e,"DataView");return l_=n,l_}var c_,dA;function qz(){if(dA)return c_;dA=1;var t=Xs(),e=Mr(),n=t(e,"Promise");return c_=n,c_}var u_,hA;function DI(){if(hA)return u_;hA=1;var t=Xs(),e=Mr(),n=t(e,"Set");return u_=n,u_}var f_,pA;function Vz(){if(pA)return f_;pA=1;var t=Xs(),e=Mr(),n=t(e,"WeakMap");return f_=n,f_}var d_,gA;function So(){if(gA)return d_;gA=1;var t=zz(),e=s1(),n=qz(),r=DI(),i=Vz(),s=Ws(),o=SI(),l="[object Map]",u="[object Object]",d="[object Promise]",h="[object Set]",g="[object WeakMap]",_="[object DataView]",y=o(t),T=o(e),w=o(n),x=o(r),S=o(i),A=s;return(t&&A(new t(new ArrayBuffer(1)))!=_||e&&A(new e)!=l||n&&A(n.resolve())!=d||r&&A(new r)!=h||i&&A(new i)!=g)&&(A=function(R){var E=s(R),C=E==u?R.constructor:void 0,I=C?o(C):"";if(I)switch(I){case y:return _;case T:return l;case w:return d;case x:return h;case S:return g}return E}),d_=A,d_}var h_,mA;function $z(){if(mA)return h_;mA=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}return h_=n,h_}var p_,_A;function jI(){if(_A)return p_;_A=1;var t=Mr(),e=t.Uint8Array;return p_=e,p_}var g_,vA;function h1(){if(vA)return g_;vA=1;var t=jI();function e(n){var r=new n.constructor(n.byteLength);return new t(r).set(new t(n)),r}return g_=e,g_}var m_,yA;function Hz(){if(yA)return m_;yA=1;var t=h1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}return m_=e,m_}var __,bA;function Wz(){if(bA)return __;bA=1;var t=/\w*$/;function e(n){var r=new n.constructor(n.source,t.exec(n));return r.lastIndex=n.lastIndex,r}return __=e,__}var v_,xA;function Xz(){if(xA)return v_;xA=1;var t=wo(),e=t?t.prototype:void 0,n=e?e.valueOf:void 0;function r(i){return n?Object(n.call(i)):{}}return v_=r,v_}var y_,wA;function LI(){if(wA)return y_;wA=1;var t=h1();function e(n,r){var i=r?t(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}return y_=e,y_}var b_,TA;function Yz(){if(TA)return b_;TA=1;var t=h1(),e=Hz(),n=Wz(),r=Xz(),i=LI(),s="[object Boolean]",o="[object Date]",l="[object Map]",u="[object Number]",d="[object RegExp]",h="[object Set]",g="[object String]",_="[object Symbol]",y="[object ArrayBuffer]",T="[object DataView]",w="[object Float32Array]",x="[object Float64Array]",S="[object Int8Array]",A="[object Int16Array]",R="[object Int32Array]",E="[object Uint8Array]",C="[object Uint8ClampedArray]",I="[object Uint16Array]",O="[object Uint32Array]";function M(P,N,B){var z=P.constructor;switch(N){case y:return t(P);case s:case o:return new z(+P);case T:return e(P,B);case w:case x:case S:case A:case R:case E:case C:case I:case O:return i(P,B);case l:return new z;case u:case g:return new z(P);case d:return n(P);case h:return new z;case _:return r(P)}}return b_=M,b_}var x_,SA;function BI(){if(SA)return x_;SA=1;var t=pr(),e=Object.create,n=function(){function r(){}return function(i){if(!t(i))return{};if(e)return e(i);r.prototype=i;var s=new r;return r.prototype=void 0,s}}();return x_=n,x_}var w_,EA;function UI(){if(EA)return w_;EA=1;var t=BI(),e=Hd(),n=$d();function r(i){return typeof i.constructor=="function"&&!n(i)?t(e(i)):{}}return w_=r,w_}var T_,AA;function Gz(){if(AA)return T_;AA=1;var t=So(),e=Xr(),n="[object Map]";function r(i){return e(i)&&t(i)==n}return T_=r,T_}var S_,RA;function Kz(){if(RA)return S_;RA=1;var t=Gz(),e=Vd(),n=c1(),r=n&&n.isMap,i=r?e(r):t;return S_=i,S_}var E_,CA;function Zz(){if(CA)return E_;CA=1;var t=So(),e=Xr(),n="[object Set]";function r(i){return e(i)&&t(i)==n}return E_=r,E_}var A_,NA;function Qz(){if(NA)return A_;NA=1;var t=Zz(),e=Vd(),n=c1(),r=n&&n.isSet,i=r?e(r):t;return A_=i,A_}var R_,kA;function FI(){if(kA)return R_;kA=1;var t=Ud(),e=o1(),n=zd(),r=Pz(),i=Lz(),s=CI(),o=NI(),l=Bz(),u=Uz(),d=PI(),h=Fz(),g=So(),_=$z(),y=Yz(),T=UI(),w=Wt(),x=To(),S=Kz(),A=pr(),R=Qz(),E=as(),C=Ys(),I=1,O=2,M=4,P="[object Arguments]",N="[object Array]",B="[object Boolean]",z="[object Date]",Q="[object Error]",H="[object Function]",W="[object GeneratorFunction]",q="[object Map]",ee="[object Number]",de="[object Object]",Z="[object RegExp]",D="[object Set]",G="[object String]",oe="[object Symbol]",ie="[object WeakMap]",F="[object ArrayBuffer]",$="[object DataView]",Y="[object Float32Array]",ue="[object Float64Array]",ye="[object Int8Array]",Se="[object Int16Array]",ke="[object Int32Array]",Ue="[object Uint8Array]",yt="[object Uint8ClampedArray]",We="[object Uint16Array]",Fe="[object Uint32Array]",De={};De[P]=De[N]=De[F]=De[$]=De[B]=De[z]=De[Y]=De[ue]=De[ye]=De[Se]=De[ke]=De[q]=De[ee]=De[de]=De[Z]=De[D]=De[G]=De[oe]=De[Ue]=De[yt]=De[We]=De[Fe]=!0,De[Q]=De[H]=De[ie]=!1;function Jt(Ne,xn,Xt,Cn,jt,fn){var Ye,xe=xn&I,Re=xn&O,et=xn&M;if(Xt&&(Ye=jt?Xt(Ne,Cn,jt,fn):Xt(Ne)),Ye!==void 0)return Ye;if(!A(Ne))return Ne;var Ve=w(Ne);if(Ve){if(Ye=_(Ne),!xe)return o(Ne,Ye)}else{var Ke=g(Ne),vt=Ke==H||Ke==W;if(x(Ne))return s(Ne,xe);if(Ke==de||Ke==P||vt&&!jt){if(Ye=Re||vt?{}:T(Ne),!xe)return Re?u(Ne,i(Ye,Ne)):l(Ne,r(Ye,Ne))}else{if(!De[Ke])return jt?Ne:{};Ye=y(Ne,Ke,xe)}}fn||(fn=new t);var dn=fn.get(Ne);if(dn)return dn;fn.set(Ne,Ye),R(Ne)?Ne.forEach(function(Lt){Ye.add(Jt(Lt,xn,Xt,Lt,Ne,fn))}):S(Ne)&&Ne.forEach(function(Lt,Bt){Ye.set(Bt,Jt(Lt,xn,Xt,Bt,Ne,fn))});var Yr=et?Re?h:d:Re?C:E,_r=Ve?void 0:Yr(Ne);return e(_r||Ne,function(Lt,Bt){_r&&(Bt=Lt,Lt=Ne[Bt]),n(Ye,Bt,Jt(Lt,xn,Xt,Bt,Ne,fn))}),Ye}return R_=Jt,R_}var C_,MA;function Jz(){if(MA)return C_;MA=1;var t=FI(),e=4;function n(r){return t(r,e)}return C_=n,C_}var N_,IA;function p1(){if(IA)return N_;IA=1;function t(e){return function(){return e}}return N_=t,N_}var k_,OA;function e9(){if(OA)return k_;OA=1;function t(e){return function(n,r,i){for(var s=-1,o=Object(n),l=i(n),u=l.length;u--;){var d=l[e?u:++s];if(r(o[d],d,o)===!1)break}return n}}return k_=t,k_}var M_,PA;function g1(){if(PA)return M_;PA=1;var t=e9(),e=t();return M_=e,M_}var I_,DA;function m1(){if(DA)return I_;DA=1;var t=g1(),e=as();function n(r,i){return r&&t(r,i,e)}return I_=n,I_}var O_,jA;function t9(){if(jA)return O_;jA=1;var t=vi();function e(n,r){return function(i,s){if(i==null)return i;if(!t(i))return n(i,s);for(var o=i.length,l=r?o:-1,u=Object(i);(r?l--:++l<o)&&s(u[l],l,u)!==!1;);return i}}return O_=e,O_}var P_,LA;function Wd(){if(LA)return P_;LA=1;var t=m1(),e=t9(),n=e(t);return P_=n,P_}var D_,BA;function Gs(){if(BA)return D_;BA=1;function t(e){return e}return D_=t,D_}var j_,UA;function zI(){if(UA)return j_;UA=1;var t=Gs();function e(n){return typeof n=="function"?n:t}return j_=e,j_}var L_,FA;function qI(){if(FA)return L_;FA=1;var t=o1(),e=Wd(),n=zI(),r=Wt();function i(s,o){var l=r(s)?t:e;return l(s,n(o))}return L_=i,L_}var B_,zA;function VI(){return zA||(zA=1,B_=qI()),B_}var U_,qA;function n9(){if(qA)return U_;qA=1;var t=Wd();function e(n,r){var i=[];return t(n,function(s,o,l){r(s,o,l)&&i.push(s)}),i}return U_=e,U_}var F_,VA;function r9(){if(VA)return F_;VA=1;var t="__lodash_hash_undefined__";function e(n){return this.__data__.set(n,t),this}return F_=e,F_}var z_,$A;function i9(){if($A)return z_;$A=1;function t(e){return this.__data__.has(e)}return z_=t,z_}var q_,HA;function $I(){if(HA)return q_;HA=1;var t=a1(),e=r9(),n=i9();function r(i){var s=-1,o=i==null?0:i.length;for(this.__data__=new t;++s<o;)this.add(i[s])}return r.prototype.add=r.prototype.push=e,r.prototype.has=n,q_=r,q_}var V_,WA;function s9(){if(WA)return V_;WA=1;function t(e,n){for(var r=-1,i=e==null?0:e.length;++r<i;)if(n(e[r],r,e))return!0;return!1}return V_=t,V_}var $_,XA;function HI(){if(XA)return $_;XA=1;function t(e,n){return e.has(n)}return $_=t,$_}var H_,YA;function WI(){if(YA)return H_;YA=1;var t=$I(),e=s9(),n=HI(),r=1,i=2;function s(o,l,u,d,h,g){var _=u&r,y=o.length,T=l.length;if(y!=T&&!(_&&T>y))return!1;var w=g.get(o),x=g.get(l);if(w&&x)return w==l&&x==o;var S=-1,A=!0,R=u&i?new t:void 0;for(g.set(o,l),g.set(l,o);++S<y;){var E=o[S],C=l[S];if(d)var I=_?d(C,E,S,l,o,g):d(E,C,S,o,l,g);if(I!==void 0){if(I)continue;A=!1;break}if(R){if(!e(l,function(O,M){if(!n(R,M)&&(E===O||h(E,O,u,d,g)))return R.push(M)})){A=!1;break}}else if(!(E===C||h(E,C,u,d,g))){A=!1;break}}return g.delete(o),g.delete(l),A}return H_=s,H_}var W_,GA;function a9(){if(GA)return W_;GA=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i,s){r[++n]=[s,i]}),r}return W_=t,W_}var X_,KA;function _1(){if(KA)return X_;KA=1;function t(e){var n=-1,r=Array(e.size);return e.forEach(function(i){r[++n]=i}),r}return X_=t,X_}var Y_,ZA;function o9(){if(ZA)return Y_;ZA=1;var t=wo(),e=jI(),n=xo(),r=WI(),i=a9(),s=_1(),o=1,l=2,u="[object Boolean]",d="[object Date]",h="[object Error]",g="[object Map]",_="[object Number]",y="[object RegExp]",T="[object Set]",w="[object String]",x="[object Symbol]",S="[object ArrayBuffer]",A="[object DataView]",R=t?t.prototype:void 0,E=R?R.valueOf:void 0;function C(I,O,M,P,N,B,z){switch(M){case A:if(I.byteLength!=O.byteLength||I.byteOffset!=O.byteOffset)return!1;I=I.buffer,O=O.buffer;case S:return!(I.byteLength!=O.byteLength||!B(new e(I),new e(O)));case u:case d:case _:return n(+I,+O);case h:return I.name==O.name&&I.message==O.message;case y:case w:return I==O+"";case g:var Q=i;case T:var H=P&o;if(Q||(Q=s),I.size!=O.size&&!H)return!1;var W=z.get(I);if(W)return W==O;P|=l,z.set(I,O);var q=r(Q(I),Q(O),P,N,B,z);return z.delete(I),q;case x:if(E)return E.call(I)==E.call(O)}return!1}return Y_=C,Y_}var G_,QA;function l9(){if(QA)return G_;QA=1;var t=PI(),e=1,n=Object.prototype,r=n.hasOwnProperty;function i(s,o,l,u,d,h){var g=l&e,_=t(s),y=_.length,T=t(o),w=T.length;if(y!=w&&!g)return!1;for(var x=y;x--;){var S=_[x];if(!(g?S in o:r.call(o,S)))return!1}var A=h.get(s),R=h.get(o);if(A&&R)return A==o&&R==s;var E=!0;h.set(s,o),h.set(o,s);for(var C=g;++x<y;){S=_[x];var I=s[S],O=o[S];if(u)var M=g?u(O,I,S,o,s,h):u(I,O,S,s,o,h);if(!(M===void 0?I===O||d(I,O,l,u,h):M)){E=!1;break}C||(C=S=="constructor")}if(E&&!C){var P=s.constructor,N=o.constructor;P!=N&&"constructor"in s&&"constructor"in o&&!(typeof P=="function"&&P instanceof P&&typeof N=="function"&&N instanceof N)&&(E=!1)}return h.delete(s),h.delete(o),E}return G_=i,G_}var K_,JA;function c9(){if(JA)return K_;JA=1;var t=Ud(),e=WI(),n=o9(),r=l9(),i=So(),s=Wt(),o=To(),l=Sc(),u=1,d="[object Arguments]",h="[object Array]",g="[object Object]",_=Object.prototype,y=_.hasOwnProperty;function T(w,x,S,A,R,E){var C=s(w),I=s(x),O=C?h:i(w),M=I?h:i(x);O=O==d?g:O,M=M==d?g:M;var P=O==g,N=M==g,B=O==M;if(B&&o(w)){if(!o(x))return!1;C=!0,P=!1}if(B&&!P)return E||(E=new t),C||l(w)?e(w,x,S,A,R,E):n(w,x,O,S,A,R,E);if(!(S&u)){var z=P&&y.call(w,"__wrapped__"),Q=N&&y.call(x,"__wrapped__");if(z||Q){var H=z?w.value():w,W=Q?x.value():x;return E||(E=new t),R(H,W,S,A,E)}}return B?(E||(E=new t),r(w,x,S,A,R,E)):!1}return K_=T,K_}var Z_,eR;function XI(){if(eR)return Z_;eR=1;var t=c9(),e=Xr();function n(r,i,s,o,l){return r===i?!0:r==null||i==null||!e(r)&&!e(i)?r!==r&&i!==i:t(r,i,s,o,n,l)}return Z_=n,Z_}var Q_,tR;function u9(){if(tR)return Q_;tR=1;var t=Ud(),e=XI(),n=1,r=2;function i(s,o,l,u){var d=l.length,h=d,g=!u;if(s==null)return!h;for(s=Object(s);d--;){var _=l[d];if(g&&_[2]?_[1]!==s[_[0]]:!(_[0]in s))return!1}for(;++d<h;){_=l[d];var y=_[0],T=s[y],w=_[1];if(g&&_[2]){if(T===void 0&&!(y in s))return!1}else{var x=new t;if(u)var S=u(T,w,y,s,o,x);if(!(S===void 0?e(w,T,n|r,u,x):S))return!1}}return!0}return Q_=i,Q_}var J_,nR;function YI(){if(nR)return J_;nR=1;var t=pr();function e(n){return n===n&&!t(n)}return J_=e,J_}var ev,rR;function f9(){if(rR)return ev;rR=1;var t=YI(),e=as();function n(r){for(var i=e(r),s=i.length;s--;){var o=i[s],l=r[o];i[s]=[o,l,t(l)]}return i}return ev=n,ev}var tv,iR;function GI(){if(iR)return tv;iR=1;function t(e,n){return function(r){return r==null?!1:r[e]===n&&(n!==void 0||e in Object(r))}}return tv=t,tv}var nv,sR;function d9(){if(sR)return nv;sR=1;var t=u9(),e=f9(),n=GI();function r(i){var s=e(i);return s.length==1&&s[0][2]?n(s[0][0],s[0][1]):function(o){return o===i||t(o,i,s)}}return nv=r,nv}var rv,aR;function Eo(){if(aR)return rv;aR=1;var t=Ws(),e=Xr(),n="[object Symbol]";function r(i){return typeof i=="symbol"||e(i)&&t(i)==n}return rv=r,rv}var iv,oR;function v1(){if(oR)return iv;oR=1;var t=Wt(),e=Eo(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;function i(s,o){if(t(s))return!1;var l=typeof s;return l=="number"||l=="symbol"||l=="boolean"||s==null||e(s)?!0:r.test(s)||!n.test(s)||o!=null&&s in Object(o)}return iv=i,iv}var sv,lR;function h9(){if(lR)return sv;lR=1;var t=a1(),e="Expected a function";function n(r,i){if(typeof r!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var s=function(){var o=arguments,l=i?i.apply(this,o):o[0],u=s.cache;if(u.has(l))return u.get(l);var d=r.apply(this,o);return s.cache=u.set(l,d)||u,d};return s.cache=new(n.Cache||t),s}return n.Cache=t,sv=n,sv}var av,cR;function p9(){if(cR)return av;cR=1;var t=h9(),e=500;function n(r){var i=t(r,function(o){return s.size===e&&s.clear(),o}),s=i.cache;return i}return av=n,av}var ov,uR;function g9(){if(uR)return ov;uR=1;var t=p9(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g,r=t(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(e,function(o,l,u,d){s.push(u?d.replace(n,"$1"):l||o)}),s});return ov=r,ov}var lv,fR;function Xd(){if(fR)return lv;fR=1;function t(e,n){for(var r=-1,i=e==null?0:e.length,s=Array(i);++r<i;)s[r]=n(e[r],r,e);return s}return lv=t,lv}var cv,dR;function m9(){if(dR)return cv;dR=1;var t=wo(),e=Xd(),n=Wt(),r=Eo(),i=t?t.prototype:void 0,s=i?i.toString:void 0;function o(l){if(typeof l=="string")return l;if(n(l))return e(l,o)+"";if(r(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}return cv=o,cv}var uv,hR;function KI(){if(hR)return uv;hR=1;var t=m9();function e(n){return n==null?"":t(n)}return uv=e,uv}var fv,pR;function Yd(){if(pR)return fv;pR=1;var t=Wt(),e=v1(),n=g9(),r=KI();function i(s,o){return t(s)?s:e(s,o)?[s]:n(r(s))}return fv=i,fv}var dv,gR;function Ec(){if(gR)return dv;gR=1;var t=Eo();function e(n){if(typeof n=="string"||t(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}return dv=e,dv}var hv,mR;function Gd(){if(mR)return hv;mR=1;var t=Yd(),e=Ec();function n(r,i){i=t(i,r);for(var s=0,o=i.length;r!=null&&s<o;)r=r[e(i[s++])];return s&&s==o?r:void 0}return hv=n,hv}var pv,_R;function _9(){if(_R)return pv;_R=1;var t=Gd();function e(n,r,i){var s=n==null?void 0:t(n,r);return s===void 0?i:s}return pv=e,pv}var gv,vR;function v9(){if(vR)return gv;vR=1;function t(e,n){return e!=null&&n in Object(e)}return gv=t,gv}var mv,yR;function ZI(){if(yR)return mv;yR=1;var t=Yd(),e=Tc(),n=Wt(),r=qd(),i=l1(),s=Ec();function o(l,u,d){u=t(u,l);for(var h=-1,g=u.length,_=!1;++h<g;){var y=s(u[h]);if(!(_=l!=null&&d(l,y)))break;l=l[y]}return _||++h!=g?_:(g=l==null?0:l.length,!!g&&i(g)&&r(y,g)&&(n(l)||e(l)))}return mv=o,mv}var _v,bR;function QI(){if(bR)return _v;bR=1;var t=v9(),e=ZI();function n(r,i){return r!=null&&e(r,i,t)}return _v=n,_v}var vv,xR;function y9(){if(xR)return vv;xR=1;var t=XI(),e=_9(),n=QI(),r=v1(),i=YI(),s=GI(),o=Ec(),l=1,u=2;function d(h,g){return r(h)&&i(g)?s(o(h),g):function(_){var y=e(_,h);return y===void 0&&y===g?n(_,h):t(g,y,l|u)}}return vv=d,vv}var yv,wR;function JI(){if(wR)return yv;wR=1;function t(e){return function(n){return n==null?void 0:n[e]}}return yv=t,yv}var bv,TR;function b9(){if(TR)return bv;TR=1;var t=Gd();function e(n){return function(r){return t(r,n)}}return bv=e,bv}var xv,SR;function x9(){if(SR)return xv;SR=1;var t=JI(),e=b9(),n=v1(),r=Ec();function i(s){return n(s)?t(r(s)):e(s)}return xv=i,xv}var wv,ER;function yi(){if(ER)return wv;ER=1;var t=d9(),e=y9(),n=Gs(),r=Wt(),i=x9();function s(o){return typeof o=="function"?o:o==null?n:typeof o=="object"?r(o)?e(o[0],o[1]):t(o):i(o)}return wv=s,wv}var Tv,AR;function eO(){if(AR)return Tv;AR=1;var t=kI(),e=n9(),n=yi(),r=Wt();function i(s,o){var l=r(s)?t:e;return l(s,n(o,3))}return Tv=i,Tv}var Sv,RR;function w9(){if(RR)return Sv;RR=1;var t=Object.prototype,e=t.hasOwnProperty;function n(r,i){return r!=null&&e.call(r,i)}return Sv=n,Sv}var Ev,CR;function tO(){if(CR)return Ev;CR=1;var t=w9(),e=ZI();function n(r,i){return r!=null&&e(r,i,t)}return Ev=n,Ev}var Av,NR;function T9(){if(NR)return Av;NR=1;var t=u1(),e=So(),n=Tc(),r=Wt(),i=vi(),s=To(),o=$d(),l=Sc(),u="[object Map]",d="[object Set]",h=Object.prototype,g=h.hasOwnProperty;function _(y){if(y==null)return!0;if(i(y)&&(r(y)||typeof y=="string"||typeof y.splice=="function"||s(y)||l(y)||n(y)))return!y.length;var T=e(y);if(T==u||T==d)return!y.size;if(o(y))return!t(y).length;for(var w in y)if(g.call(y,w))return!1;return!0}return Av=_,Av}var Rv,kR;function nO(){if(kR)return Rv;kR=1;function t(e){return e===void 0}return Rv=t,Rv}var Cv,MR;function rO(){if(MR)return Cv;MR=1;var t=Wd(),e=vi();function n(r,i){var s=-1,o=e(r)?Array(r.length):[];return t(r,function(l,u,d){o[++s]=i(l,u,d)}),o}return Cv=n,Cv}var Nv,IR;function iO(){if(IR)return Nv;IR=1;var t=Xd(),e=yi(),n=rO(),r=Wt();function i(s,o){var l=r(s)?t:n;return l(s,e(o,3))}return Nv=i,Nv}var kv,OR;function S9(){if(OR)return kv;OR=1;function t(e,n,r,i){var s=-1,o=e==null?0:e.length;for(i&&o&&(r=e[++s]);++s<o;)r=n(r,e[s],s,e);return r}return kv=t,kv}var Mv,PR;function E9(){if(PR)return Mv;PR=1;function t(e,n,r,i,s){return s(e,function(o,l,u){r=i?(i=!1,o):n(r,o,l,u)}),r}return Mv=t,Mv}var Iv,DR;function sO(){if(DR)return Iv;DR=1;var t=S9(),e=Wd(),n=yi(),r=E9(),i=Wt();function s(o,l,u){var d=i(o)?t:r,h=arguments.length<3;return d(o,n(l,4),u,h,e)}return Iv=s,Iv}var Ov,jR;function A9(){if(jR)return Ov;jR=1;var t=Ws(),e=Wt(),n=Xr(),r="[object String]";function i(s){return typeof s=="string"||!e(s)&&n(s)&&t(s)==r}return Ov=i,Ov}var Pv,LR;function R9(){if(LR)return Pv;LR=1;var t=JI(),e=t("length");return Pv=e,Pv}var Dv,BR;function C9(){if(BR)return Dv;BR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="\\u200d",l=RegExp("["+o+t+i+s+"]");function u(d){return l.test(d)}return Dv=u,Dv}var jv,UR;function N9(){if(UR)return jv;UR=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",n="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=e+n+r,s="\\ufe0e\\ufe0f",o="["+t+"]",l="["+i+"]",u="\\ud83c[\\udffb-\\udfff]",d="(?:"+l+"|"+u+")",h="[^"+t+"]",g="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",y="\\u200d",T=d+"?",w="["+s+"]?",x="(?:"+y+"(?:"+[h,g,_].join("|")+")"+w+T+")*",S=w+T+x,A="(?:"+[h+l+"?",l,g,_,o].join("|")+")",R=RegExp(u+"(?="+u+")|"+A+S,"g");function E(C){for(var I=R.lastIndex=0;R.test(C);)++I;return I}return jv=E,jv}var Lv,FR;function k9(){if(FR)return Lv;FR=1;var t=R9(),e=C9(),n=N9();function r(i){return e(i)?n(i):t(i)}return Lv=r,Lv}var Bv,zR;function M9(){if(zR)return Bv;zR=1;var t=u1(),e=So(),n=vi(),r=A9(),i=k9(),s="[object Map]",o="[object Set]";function l(u){if(u==null)return 0;if(n(u))return r(u)?i(u):u.length;var d=e(u);return d==s||d==o?u.size:t(u).length}return Bv=l,Bv}var Uv,qR;function I9(){if(qR)return Uv;qR=1;var t=o1(),e=BI(),n=m1(),r=yi(),i=Hd(),s=Wt(),o=To(),l=xc(),u=pr(),d=Sc();function h(g,_,y){var T=s(g),w=T||o(g)||d(g);if(_=r(_,4),y==null){var x=g&&g.constructor;w?y=T?new x:[]:u(g)?y=l(x)?e(i(g)):{}:y={}}return(w?t:n)(g,function(S,A,R){return _(y,S,A,R)}),y}return Uv=h,Uv}var Fv,VR;function O9(){if(VR)return Fv;VR=1;var t=wo(),e=Tc(),n=Wt(),r=t?t.isConcatSpreadable:void 0;function i(s){return n(s)||e(s)||!!(r&&s&&s[r])}return Fv=i,Fv}var zv,$R;function y1(){if($R)return zv;$R=1;var t=d1(),e=O9();function n(r,i,s,o,l){var u=-1,d=r.length;for(s||(s=e),l||(l=[]);++u<d;){var h=r[u];i>0&&s(h)?i>1?n(h,i-1,s,o,l):t(l,h):o||(l[l.length]=h)}return l}return zv=n,zv}var qv,HR;function P9(){if(HR)return qv;HR=1;function t(e,n,r){switch(r.length){case 0:return e.call(n);case 1:return e.call(n,r[0]);case 2:return e.call(n,r[0],r[1]);case 3:return e.call(n,r[0],r[1],r[2])}return e.apply(n,r)}return qv=t,qv}var Vv,WR;function aO(){if(WR)return Vv;WR=1;var t=P9(),e=Math.max;function n(r,i,s){return i=e(i===void 0?r.length-1:i,0),function(){for(var o=arguments,l=-1,u=e(o.length-i,0),d=Array(u);++l<u;)d[l]=o[i+l];l=-1;for(var h=Array(i+1);++l<i;)h[l]=o[l];return h[i]=s(d),t(r,this,h)}}return Vv=n,Vv}var $v,XR;function D9(){if(XR)return $v;XR=1;var t=p1(),e=EI(),n=Gs(),r=e?function(i,s){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(s),writable:!0})}:n;return $v=r,$v}var Hv,YR;function j9(){if(YR)return Hv;YR=1;var t=800,e=16,n=Date.now;function r(i){var s=0,o=0;return function(){var l=n(),u=e-(l-o);if(o=l,u>0){if(++s>=t)return arguments[0]}else s=0;return i.apply(void 0,arguments)}}return Hv=r,Hv}var Wv,GR;function oO(){if(GR)return Wv;GR=1;var t=D9(),e=j9(),n=e(t);return Wv=n,Wv}var Xv,KR;function Kd(){if(KR)return Xv;KR=1;var t=Gs(),e=aO(),n=oO();function r(i,s){return n(e(i,s,t),i+"")}return Xv=r,Xv}var Yv,ZR;function lO(){if(ZR)return Yv;ZR=1;function t(e,n,r,i){for(var s=e.length,o=r+(i?1:-1);i?o--:++o<s;)if(n(e[o],o,e))return o;return-1}return Yv=t,Yv}var Gv,QR;function L9(){if(QR)return Gv;QR=1;function t(e){return e!==e}return Gv=t,Gv}var Kv,JR;function B9(){if(JR)return Kv;JR=1;function t(e,n,r){for(var i=r-1,s=e.length;++i<s;)if(e[i]===n)return i;return-1}return Kv=t,Kv}var Zv,eC;function U9(){if(eC)return Zv;eC=1;var t=lO(),e=L9(),n=B9();function r(i,s,o){return s===s?n(i,s,o):t(i,e,o)}return Zv=r,Zv}var Qv,tC;function F9(){if(tC)return Qv;tC=1;var t=U9();function e(n,r){var i=n==null?0:n.length;return!!i&&t(n,r,0)>-1}return Qv=e,Qv}var Jv,nC;function z9(){if(nC)return Jv;nC=1;function t(e,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;)if(r(n,e[i]))return!0;return!1}return Jv=t,Jv}var ey,rC;function q9(){if(rC)return ey;rC=1;function t(){}return ey=t,ey}var ty,iC;function V9(){if(iC)return ty;iC=1;var t=DI(),e=q9(),n=_1(),r=1/0,i=t&&1/n(new t([,-0]))[1]==r?function(s){return new t(s)}:e;return ty=i,ty}var ny,sC;function $9(){if(sC)return ny;sC=1;var t=$I(),e=F9(),n=z9(),r=HI(),i=V9(),s=_1(),o=200;function l(u,d,h){var g=-1,_=e,y=u.length,T=!0,w=[],x=w;if(h)T=!1,_=n;else if(y>=o){var S=d?null:i(u);if(S)return s(S);T=!1,_=r,x=new t}else x=d?[]:w;e:for(;++g<y;){var A=u[g],R=d?d(A):A;if(A=h||A!==0?A:0,T&&R===R){for(var E=x.length;E--;)if(x[E]===R)continue e;d&&x.push(R),w.push(A)}else _(x,R,h)||(x!==w&&x.push(R),w.push(A))}return w}return ny=l,ny}var ry,aC;function cO(){if(aC)return ry;aC=1;var t=vi(),e=Xr();function n(r){return e(r)&&t(r)}return ry=n,ry}var iy,oC;function H9(){if(oC)return iy;oC=1;var t=y1(),e=Kd(),n=$9(),r=cO(),i=e(function(s){return n(t(s,1,r,!0))});return iy=i,iy}var sy,lC;function W9(){if(lC)return sy;lC=1;var t=Xd();function e(n,r){return t(r,function(i){return n[i]})}return sy=e,sy}var ay,cC;function uO(){if(cC)return ay;cC=1;var t=W9(),e=as();function n(r){return r==null?[]:t(r,e(r))}return ay=n,ay}var oy,uC;function gr(){if(uC)return oy;uC=1;var t;if(typeof i1=="function")try{t={clone:Jz(),constant:p1(),each:VI(),filter:eO(),has:tO(),isArray:Wt(),isEmpty:T9(),isFunction:xc(),isUndefined:nO(),keys:as(),map:iO(),reduce:sO(),size:M9(),transform:I9(),union:H9(),values:uO()}}catch{}return t||(t=window._),oy=t,oy}var ly,fC;function b1(){if(fC)return ly;fC=1;var t=gr();ly=i;var e="\0",n="\0",r="";function i(h){this._isDirected=t.has(h,"directed")?h.directed:!0,this._isMultigraph=t.has(h,"multigraph")?h.multigraph:!1,this._isCompound=t.has(h,"compound")?h.compound:!1,this._label=void 0,this._defaultNodeLabelFn=t.constant(void 0),this._defaultEdgeLabelFn=t.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(h){return this._label=h,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultNodeLabelFn=h,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return t.keys(this._nodes)},i.prototype.sources=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._in[g])})},i.prototype.sinks=function(){var h=this;return t.filter(this.nodes(),function(g){return t.isEmpty(h._out[g])})},i.prototype.setNodes=function(h,g){var _=arguments,y=this;return t.each(h,function(T){_.length>1?y.setNode(T,g):y.setNode(T)}),this},i.prototype.setNode=function(h,g){return t.has(this._nodes,h)?(arguments.length>1&&(this._nodes[h]=g),this):(this._nodes[h]=arguments.length>1?g:this._defaultNodeLabelFn(h),this._isCompound&&(this._parent[h]=n,this._children[h]={},this._children[n][h]=!0),this._in[h]={},this._preds[h]={},this._out[h]={},this._sucs[h]={},++this._nodeCount,this)},i.prototype.node=function(h){return this._nodes[h]},i.prototype.hasNode=function(h){return t.has(this._nodes,h)},i.prototype.removeNode=function(h){var g=this;if(t.has(this._nodes,h)){var _=function(y){g.removeEdge(g._edgeObjs[y])};delete this._nodes[h],this._isCompound&&(this._removeFromParentsChildList(h),delete this._parent[h],t.each(this.children(h),function(y){g.setParent(y)}),delete this._children[h]),t.each(t.keys(this._in[h]),_),delete this._in[h],delete this._preds[h],t.each(t.keys(this._out[h]),_),delete this._out[h],delete this._sucs[h],--this._nodeCount}return this},i.prototype.setParent=function(h,g){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(t.isUndefined(g))g=n;else{g+="";for(var _=g;!t.isUndefined(_);_=this.parent(_))if(_===h)throw new Error("Setting "+g+" as parent of "+h+" would create a cycle");this.setNode(g)}return this.setNode(h),this._removeFromParentsChildList(h),this._parent[h]=g,this._children[g][h]=!0,this},i.prototype._removeFromParentsChildList=function(h){delete this._children[this._parent[h]][h]},i.prototype.parent=function(h){if(this._isCompound){var g=this._parent[h];if(g!==n)return g}},i.prototype.children=function(h){if(t.isUndefined(h)&&(h=n),this._isCompound){var g=this._children[h];if(g)return t.keys(g)}else{if(h===n)return this.nodes();if(this.hasNode(h))return[]}},i.prototype.predecessors=function(h){var g=this._preds[h];if(g)return t.keys(g)},i.prototype.successors=function(h){var g=this._sucs[h];if(g)return t.keys(g)},i.prototype.neighbors=function(h){var g=this.predecessors(h);if(g)return t.union(g,this.successors(h))},i.prototype.isLeaf=function(h){var g;return this.isDirected()?g=this.successors(h):g=this.neighbors(h),g.length===0},i.prototype.filterNodes=function(h){var g=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});g.setGraph(this.graph());var _=this;t.each(this._nodes,function(w,x){h(x)&&g.setNode(x,w)}),t.each(this._edgeObjs,function(w){g.hasNode(w.v)&&g.hasNode(w.w)&&g.setEdge(w,_.edge(w))});var y={};function T(w){var x=_.parent(w);return x===void 0||g.hasNode(x)?(y[w]=x,x):x in y?y[x]:T(x)}return this._isCompound&&t.each(g.nodes(),function(w){g.setParent(w,T(w))}),g},i.prototype.setDefaultEdgeLabel=function(h){return t.isFunction(h)||(h=t.constant(h)),this._defaultEdgeLabelFn=h,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return t.values(this._edgeObjs)},i.prototype.setPath=function(h,g){var _=this,y=arguments;return t.reduce(h,function(T,w){return y.length>1?_.setEdge(T,w,g):_.setEdge(T,w),w}),this},i.prototype.setEdge=function(){var h,g,_,y,T=!1,w=arguments[0];typeof w=="object"&&w!==null&&"v"in w?(h=w.v,g=w.w,_=w.name,arguments.length===2&&(y=arguments[1],T=!0)):(h=w,g=arguments[1],_=arguments[3],arguments.length>2&&(y=arguments[2],T=!0)),h=""+h,g=""+g,t.isUndefined(_)||(_=""+_);var x=l(this._isDirected,h,g,_);if(t.has(this._edgeLabels,x))return T&&(this._edgeLabels[x]=y),this;if(!t.isUndefined(_)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(h),this.setNode(g),this._edgeLabels[x]=T?y:this._defaultEdgeLabelFn(h,g,_);var S=u(this._isDirected,h,g,_);return h=S.v,g=S.w,Object.freeze(S),this._edgeObjs[x]=S,s(this._preds[g],h),s(this._sucs[h],g),this._in[g][x]=S,this._out[h][x]=S,this._edgeCount++,this},i.prototype.edge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return this._edgeLabels[y]},i.prototype.hasEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_);return t.has(this._edgeLabels,y)},i.prototype.removeEdge=function(h,g,_){var y=arguments.length===1?d(this._isDirected,arguments[0]):l(this._isDirected,h,g,_),T=this._edgeObjs[y];return T&&(h=T.v,g=T.w,delete this._edgeLabels[y],delete this._edgeObjs[y],o(this._preds[g],h),o(this._sucs[h],g),delete this._in[g][y],delete this._out[h][y],this._edgeCount--),this},i.prototype.inEdges=function(h,g){var _=this._in[h];if(_){var y=t.values(_);return g?t.filter(y,function(T){return T.v===g}):y}},i.prototype.outEdges=function(h,g){var _=this._out[h];if(_){var y=t.values(_);return g?t.filter(y,function(T){return T.w===g}):y}},i.prototype.nodeEdges=function(h,g){var _=this.inEdges(h,g);if(_)return _.concat(this.outEdges(h,g))};function s(h,g){h[g]?h[g]++:h[g]=1}function o(h,g){--h[g]||delete h[g]}function l(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}return T+r+w+r+(t.isUndefined(y)?e:y)}function u(h,g,_,y){var T=""+g,w=""+_;if(!h&&T>w){var x=T;T=w,w=x}var S={v:T,w};return y&&(S.name=y),S}function d(h,g){return l(h,g.v,g.w,g.name)}return ly}var cy,dC;function X9(){return dC||(dC=1,cy="2.1.8"),cy}var uy,hC;function Y9(){return hC||(hC=1,uy={Graph:b1(),version:X9()}),uy}var fy,pC;function G9(){if(pC)return fy;pC=1;var t=gr(),e=b1();fy={write:n,read:s};function n(o){var l={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:r(o),edges:i(o)};return t.isUndefined(o.graph())||(l.value=t.clone(o.graph())),l}function r(o){return t.map(o.nodes(),function(l){var u=o.node(l),d=o.parent(l),h={v:l};return t.isUndefined(u)||(h.value=u),t.isUndefined(d)||(h.parent=d),h})}function i(o){return t.map(o.edges(),function(l){var u=o.edge(l),d={v:l.v,w:l.w};return t.isUndefined(l.name)||(d.name=l.name),t.isUndefined(u)||(d.value=u),d})}function s(o){var l=new e(o.options).setGraph(o.value);return t.each(o.nodes,function(u){l.setNode(u.v,u.value),u.parent&&l.setParent(u.v,u.parent)}),t.each(o.edges,function(u){l.setEdge({v:u.v,w:u.w,name:u.name},u.value)}),l}return fy}var dy,gC;function K9(){if(gC)return dy;gC=1;var t=gr();dy=e;function e(n){var r={},i=[],s;function o(l){t.has(r,l)||(r[l]=!0,s.push(l),t.each(n.successors(l),o),t.each(n.predecessors(l),o))}return t.each(n.nodes(),function(l){s=[],o(l),s.length&&i.push(s)}),i}return dy}var hy,mC;function fO(){if(mC)return hy;mC=1;var t=gr();hy=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(n){return n.key})},e.prototype.has=function(n){return t.has(this._keyIndices,n)},e.prototype.priority=function(n){var r=this._keyIndices[n];if(r!==void 0)return this._arr[r].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(n,r){var i=this._keyIndices;if(n=String(n),!t.has(i,n)){var s=this._arr,o=s.length;return i[n]=o,s.push({key:n,priority:r}),this._decrease(o),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},e.prototype.decrease=function(n,r){var i=this._keyIndices[n];if(r>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+r);this._arr[i].priority=r,this._decrease(i)},e.prototype._heapify=function(n){var r=this._arr,i=2*n,s=i+1,o=n;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==n&&(this._swap(n,o),this._heapify(o)))},e.prototype._decrease=function(n){for(var r=this._arr,i=r[n].priority,s;n!==0&&(s=n>>1,!(r[s].priority<i));)this._swap(n,s),n=s},e.prototype._swap=function(n,r){var i=this._arr,s=this._keyIndices,o=i[n],l=i[r];i[n]=l,i[r]=o,s[l.key]=n,s[o.key]=r},hy}var py,_C;function dO(){if(_C)return py;_C=1;var t=gr(),e=fO();py=r;var n=t.constant(1);function r(s,o,l,u){return i(s,String(o),l||n,u||function(d){return s.outEdges(d)})}function i(s,o,l,u){var d={},h=new e,g,_,y=function(T){var w=T.v!==g?T.v:T.w,x=d[w],S=l(T),A=_.distance+S;if(S<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+T+" Weight: "+S);A<x.distance&&(x.distance=A,x.predecessor=g,h.decrease(w,A))};for(s.nodes().forEach(function(T){var w=T===o?0:Number.POSITIVE_INFINITY;d[T]={distance:w},h.add(T,w)});h.size()>0&&(g=h.removeMin(),_=d[g],_.distance!==Number.POSITIVE_INFINITY);)u(g).forEach(y);return d}return py}var gy,vC;function Z9(){if(vC)return gy;vC=1;var t=dO(),e=gr();gy=n;function n(r,i,s){return e.transform(r.nodes(),function(o,l){o[l]=t(r,l,i,s)},{})}return gy}var my,yC;function hO(){if(yC)return my;yC=1;var t=gr();my=e;function e(n){var r=0,i=[],s={},o=[];function l(u){var d=s[u]={onStack:!0,lowlink:r,index:r++};if(i.push(u),n.successors(u).forEach(function(_){t.has(s,_)?s[_].onStack&&(d.lowlink=Math.min(d.lowlink,s[_].index)):(l(_),d.lowlink=Math.min(d.lowlink,s[_].lowlink))}),d.lowlink===d.index){var h=[],g;do g=i.pop(),s[g].onStack=!1,h.push(g);while(u!==g);o.push(h)}}return n.nodes().forEach(function(u){t.has(s,u)||l(u)}),o}return my}var _y,bC;function Q9(){if(bC)return _y;bC=1;var t=gr(),e=hO();_y=n;function n(r){return t.filter(e(r),function(i){return i.length>1||i.length===1&&r.hasEdge(i[0],i[0])})}return _y}var vy,xC;function J9(){if(xC)return vy;xC=1;var t=gr();vy=n;var e=t.constant(1);function n(i,s,o){return r(i,s||e,o||function(l){return i.outEdges(l)})}function r(i,s,o){var l={},u=i.nodes();return u.forEach(function(d){l[d]={},l[d][d]={distance:0},u.forEach(function(h){d!==h&&(l[d][h]={distance:Number.POSITIVE_INFINITY})}),o(d).forEach(function(h){var g=h.v===d?h.w:h.v,_=s(h);l[d][g]={distance:_,predecessor:d}})}),u.forEach(function(d){var h=l[d];u.forEach(function(g){var _=l[g];u.forEach(function(y){var T=_[d],w=h[y],x=_[y],S=T.distance+w.distance;S<x.distance&&(x.distance=S,x.predecessor=w.predecessor)})})}),l}return vy}var yy,wC;function pO(){if(wC)return yy;wC=1;var t=gr();yy=e,e.CycleException=n;function e(r){var i={},s={},o=[];function l(u){if(t.has(s,u))throw new n;t.has(i,u)||(s[u]=!0,i[u]=!0,t.each(r.predecessors(u),l),delete s[u],o.push(u))}if(t.each(r.sinks(),l),t.size(i)!==r.nodeCount())throw new n;return o}function n(){}return n.prototype=new Error,yy}var by,TC;function e7(){if(TC)return by;TC=1;var t=pO();by=e;function e(n){try{t(n)}catch(r){if(r instanceof t.CycleException)return!1;throw r}return!0}return by}var xy,SC;function gO(){if(SC)return xy;SC=1;var t=gr();xy=e;function e(r,i,s){t.isArray(i)||(i=[i]);var o=(r.isDirected()?r.successors:r.neighbors).bind(r),l=[],u={};return t.each(i,function(d){if(!r.hasNode(d))throw new Error("Graph does not have node: "+d);n(r,d,s==="post",u,o,l)}),l}function n(r,i,s,o,l,u){t.has(o,i)||(o[i]=!0,s||u.push(i),t.each(l(i),function(d){n(r,d,s,o,l,u)}),s&&u.push(i))}return xy}var wy,EC;function t7(){if(EC)return wy;EC=1;var t=gO();wy=e;function e(n,r){return t(n,r,"post")}return wy}var Ty,AC;function n7(){if(AC)return Ty;AC=1;var t=gO();Ty=e;function e(n,r){return t(n,r,"pre")}return Ty}var Sy,RC;function r7(){if(RC)return Sy;RC=1;var t=gr(),e=b1(),n=fO();Sy=r;function r(i,s){var o=new e,l={},u=new n,d;function h(_){var y=_.v===d?_.w:_.v,T=u.priority(y);if(T!==void 0){var w=s(_);w<T&&(l[y]=d,u.decrease(y,w))}}if(i.nodeCount()===0)return o;t.each(i.nodes(),function(_){u.add(_,Number.POSITIVE_INFINITY),o.setNode(_)}),u.decrease(i.nodes()[0],0);for(var g=!1;u.size()>0;){if(d=u.removeMin(),t.has(l,d))o.setEdge(d,l[d]);else{if(g)throw new Error("Input graph is not connected: "+i);g=!0}i.nodeEdges(d).forEach(h)}return o}return Sy}var Ey,CC;function i7(){return CC||(CC=1,Ey={components:K9(),dijkstra:dO(),dijkstraAll:Z9(),findCycles:Q9(),floydWarshall:J9(),isAcyclic:e7(),postorder:t7(),preorder:n7(),prim:r7(),tarjan:hO(),topsort:pO()}),Ey}var Ay,NC;function s7(){if(NC)return Ay;NC=1;var t=Y9();return Ay={Graph:t.Graph,json:G9(),alg:i7(),version:t.version},Ay}var Ry,kC;function Cr(){if(kC)return Ry;kC=1;var t;if(typeof i1=="function")try{t=s7()}catch{}return t||(t=window.graphlib),Ry=t,Ry}var Cy,MC;function a7(){if(MC)return Cy;MC=1;var t=FI(),e=1,n=4;function r(i){return t(i,e|n)}return Cy=r,Cy}var Ny,IC;function Zd(){if(IC)return Ny;IC=1;var t=xo(),e=vi(),n=qd(),r=pr();function i(s,o,l){if(!r(l))return!1;var u=typeof o;return(u=="number"?e(l)&&n(o,l.length):u=="string"&&o in l)?t(l[o],s):!1}return Ny=i,Ny}var ky,OC;function o7(){if(OC)return ky;OC=1;var t=Kd(),e=xo(),n=Zd(),r=Ys(),i=Object.prototype,s=i.hasOwnProperty,o=t(function(l,u){l=Object(l);var d=-1,h=u.length,g=h>2?u[2]:void 0;for(g&&n(u[0],u[1],g)&&(h=1);++d<h;)for(var _=u[d],y=r(_),T=-1,w=y.length;++T<w;){var x=y[T],S=l[x];(S===void 0||e(S,i[x])&&!s.call(l,x))&&(l[x]=_[x])}return l});return ky=o,ky}var My,PC;function l7(){if(PC)return My;PC=1;var t=yi(),e=vi(),n=as();function r(i){return function(s,o,l){var u=Object(s);if(!e(s)){var d=t(o,3);s=n(s),o=function(g){return d(u[g],g,u)}}var h=i(s,o,l);return h>-1?u[d?s[h]:h]:void 0}}return My=r,My}var Iy,DC;function c7(){if(DC)return Iy;DC=1;var t=/\s/;function e(n){for(var r=n.length;r--&&t.test(n.charAt(r)););return r}return Iy=e,Iy}var Oy,jC;function u7(){if(jC)return Oy;jC=1;var t=c7(),e=/^\s+/;function n(r){return r&&r.slice(0,t(r)+1).replace(e,"")}return Oy=n,Oy}var Py,LC;function f7(){if(LC)return Py;LC=1;var t=u7(),e=pr(),n=Eo(),r=NaN,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function u(d){if(typeof d=="number")return d;if(n(d))return r;if(e(d)){var h=typeof d.valueOf=="function"?d.valueOf():d;d=e(h)?h+"":h}if(typeof d!="string")return d===0?d:+d;d=t(d);var g=s.test(d);return g||o.test(d)?l(d.slice(2),g?2:8):i.test(d)?r:+d}return Py=u,Py}var Dy,BC;function mO(){if(BC)return Dy;BC=1;var t=f7(),e=1/0,n=17976931348623157e292;function r(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-1/0){var s=i<0?-1:1;return s*n}return i===i?i:0}return Dy=r,Dy}var jy,UC;function d7(){if(UC)return jy;UC=1;var t=mO();function e(n){var r=t(n),i=r%1;return r===r?i?r-i:r:0}return jy=e,jy}var Ly,FC;function h7(){if(FC)return Ly;FC=1;var t=lO(),e=yi(),n=d7(),r=Math.max;function i(s,o,l){var u=s==null?0:s.length;if(!u)return-1;var d=l==null?0:n(l);return d<0&&(d=r(u+d,0)),t(s,e(o,3),d)}return Ly=i,Ly}var By,zC;function p7(){if(zC)return By;zC=1;var t=l7(),e=h7(),n=t(e);return By=n,By}var Uy,qC;function _O(){if(qC)return Uy;qC=1;var t=y1();function e(n){var r=n==null?0:n.length;return r?t(n,1):[]}return Uy=e,Uy}var Fy,VC;function g7(){if(VC)return Fy;VC=1;var t=g1(),e=zI(),n=Ys();function r(i,s){return i==null?i:t(i,e(s),n)}return Fy=r,Fy}var zy,$C;function m7(){if($C)return zy;$C=1;function t(e){var n=e==null?0:e.length;return n?e[n-1]:void 0}return zy=t,zy}var qy,HC;function _7(){if(HC)return qy;HC=1;var t=Fd(),e=m1(),n=yi();function r(i,s){var o={};return s=n(s,3),e(i,function(l,u,d){t(o,u,s(l,u,d))}),o}return qy=r,qy}var Vy,WC;function x1(){if(WC)return Vy;WC=1;var t=Eo();function e(n,r,i){for(var s=-1,o=n.length;++s<o;){var l=n[s],u=r(l);if(u!=null&&(d===void 0?u===u&&!t(u):i(u,d)))var d=u,h=l}return h}return Vy=e,Vy}var $y,XC;function v7(){if(XC)return $y;XC=1;function t(e,n){return e>n}return $y=t,$y}var Hy,YC;function y7(){if(YC)return Hy;YC=1;var t=x1(),e=v7(),n=Gs();function r(i){return i&&i.length?t(i,n,e):void 0}return Hy=r,Hy}var Wy,GC;function vO(){if(GC)return Wy;GC=1;var t=Fd(),e=xo();function n(r,i,s){(s!==void 0&&!e(r[i],s)||s===void 0&&!(i in r))&&t(r,i,s)}return Wy=n,Wy}var Xy,KC;function b7(){if(KC)return Xy;KC=1;var t=Ws(),e=Hd(),n=Xr(),r="[object Object]",i=Function.prototype,s=Object.prototype,o=i.toString,l=s.hasOwnProperty,u=o.call(Object);function d(h){if(!n(h)||t(h)!=r)return!1;var g=e(h);if(g===null)return!0;var _=l.call(g,"constructor")&&g.constructor;return typeof _=="function"&&_ instanceof _&&o.call(_)==u}return Xy=d,Xy}var Yy,ZC;function yO(){if(ZC)return Yy;ZC=1;function t(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}return Yy=t,Yy}var Gy,QC;function x7(){if(QC)return Gy;QC=1;var t=wc(),e=Ys();function n(r){return t(r,e(r))}return Gy=n,Gy}var Ky,JC;function w7(){if(JC)return Ky;JC=1;var t=vO(),e=CI(),n=LI(),r=NI(),i=UI(),s=Tc(),o=Wt(),l=cO(),u=To(),d=xc(),h=pr(),g=b7(),_=Sc(),y=yO(),T=x7();function w(x,S,A,R,E,C,I){var O=y(x,A),M=y(S,A),P=I.get(M);if(P){t(x,A,P);return}var N=C?C(O,M,A+"",x,S,I):void 0,B=N===void 0;if(B){var z=o(M),Q=!z&&u(M),H=!z&&!Q&&_(M);N=M,z||Q||H?o(O)?N=O:l(O)?N=r(O):Q?(B=!1,N=e(M,!0)):H?(B=!1,N=n(M,!0)):N=[]:g(M)||s(M)?(N=O,s(O)?N=T(O):(!h(O)||d(O))&&(N=i(M))):B=!1}B&&(I.set(M,N),E(N,M,R,C,I),I.delete(M)),t(x,A,N)}return Ky=w,Ky}var Zy,eN;function T7(){if(eN)return Zy;eN=1;var t=Ud(),e=vO(),n=g1(),r=w7(),i=pr(),s=Ys(),o=yO();function l(u,d,h,g,_){u!==d&&n(d,function(y,T){if(_||(_=new t),i(y))r(u,d,T,h,l,g,_);else{var w=g?g(o(u,T),y,T+"",u,d,_):void 0;w===void 0&&(w=y),e(u,T,w)}},s)}return Zy=l,Zy}var Qy,tN;function S7(){if(tN)return Qy;tN=1;var t=Kd(),e=Zd();function n(r){return t(function(i,s){var o=-1,l=s.length,u=l>1?s[l-1]:void 0,d=l>2?s[2]:void 0;for(u=r.length>3&&typeof u=="function"?(l--,u):void 0,d&&e(s[0],s[1],d)&&(u=l<3?void 0:u,l=1),i=Object(i);++o<l;){var h=s[o];h&&r(i,h,o,u)}return i})}return Qy=n,Qy}var Jy,nN;function E7(){if(nN)return Jy;nN=1;var t=T7(),e=S7(),n=e(function(r,i,s){t(r,i,s)});return Jy=n,Jy}var eb,rN;function bO(){if(rN)return eb;rN=1;function t(e,n){return e<n}return eb=t,eb}var tb,iN;function A7(){if(iN)return tb;iN=1;var t=x1(),e=bO(),n=Gs();function r(i){return i&&i.length?t(i,n,e):void 0}return tb=r,tb}var nb,sN;function R7(){if(sN)return nb;sN=1;var t=x1(),e=yi(),n=bO();function r(i,s){return i&&i.length?t(i,e(s,2),n):void 0}return nb=r,nb}var rb,aN;function C7(){if(aN)return rb;aN=1;var t=Mr(),e=function(){return t.Date.now()};return rb=e,rb}var ib,oN;function N7(){if(oN)return ib;oN=1;var t=zd(),e=Yd(),n=qd(),r=pr(),i=Ec();function s(o,l,u,d){if(!r(o))return o;l=e(l,o);for(var h=-1,g=l.length,_=g-1,y=o;y!=null&&++h<g;){var T=i(l[h]),w=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(h!=_){var x=y[T];w=d?d(x,T,y):void 0,w===void 0&&(w=r(x)?x:n(l[h+1])?[]:{})}t(y,T,w),y=y[T]}return o}return ib=s,ib}var sb,lN;function k7(){if(lN)return sb;lN=1;var t=Gd(),e=N7(),n=Yd();function r(i,s,o){for(var l=-1,u=s.length,d={};++l<u;){var h=s[l],g=t(i,h);o(g,h)&&e(d,n(h,i),g)}return d}return sb=r,sb}var ab,cN;function M7(){if(cN)return ab;cN=1;var t=k7(),e=QI();function n(r,i){return t(r,i,function(s,o){return e(r,o)})}return ab=n,ab}var ob,uN;function I7(){if(uN)return ob;uN=1;var t=_O(),e=aO(),n=oO();function r(i){return n(e(i,void 0,t),i+"")}return ob=r,ob}var lb,fN;function O7(){if(fN)return lb;fN=1;var t=M7(),e=I7(),n=e(function(r,i){return r==null?{}:t(r,i)});return lb=n,lb}var cb,dN;function P7(){if(dN)return cb;dN=1;var t=Math.ceil,e=Math.max;function n(r,i,s,o){for(var l=-1,u=e(t((i-r)/(s||1)),0),d=Array(u);u--;)d[o?u:++l]=r,r+=s;return d}return cb=n,cb}var ub,hN;function D7(){if(hN)return ub;hN=1;var t=P7(),e=Zd(),n=mO();function r(i){return function(s,o,l){return l&&typeof l!="number"&&e(s,o,l)&&(o=l=void 0),s=n(s),o===void 0?(o=s,s=0):o=n(o),l=l===void 0?s<o?1:-1:n(l),t(s,o,l,i)}}return ub=r,ub}var fb,pN;function j7(){if(pN)return fb;pN=1;var t=D7(),e=t();return fb=e,fb}var db,gN;function L7(){if(gN)return db;gN=1;function t(e,n){var r=e.length;for(e.sort(n);r--;)e[r]=e[r].value;return e}return db=t,db}var hb,mN;function B7(){if(mN)return hb;mN=1;var t=Eo();function e(n,r){if(n!==r){var i=n!==void 0,s=n===null,o=n===n,l=t(n),u=r!==void 0,d=r===null,h=r===r,g=t(r);if(!d&&!g&&!l&&n>r||l&&u&&h&&!d&&!g||s&&u&&h||!i&&h||!o)return 1;if(!s&&!l&&!g&&n<r||g&&i&&o&&!s&&!l||d&&i&&o||!u&&o||!h)return-1}return 0}return hb=e,hb}var pb,_N;function U7(){if(_N)return pb;_N=1;var t=B7();function e(n,r,i){for(var s=-1,o=n.criteria,l=r.criteria,u=o.length,d=i.length;++s<u;){var h=t(o[s],l[s]);if(h){if(s>=d)return h;var g=i[s];return h*(g=="desc"?-1:1)}}return n.index-r.index}return pb=e,pb}var gb,vN;function F7(){if(vN)return gb;vN=1;var t=Xd(),e=Gd(),n=yi(),r=rO(),i=L7(),s=Vd(),o=U7(),l=Gs(),u=Wt();function d(h,g,_){g.length?g=t(g,function(w){return u(w)?function(x){return e(x,w.length===1?w[0]:w)}:w}):g=[l];var y=-1;g=t(g,s(n));var T=r(h,function(w,x,S){var A=t(g,function(R){return R(w)});return{criteria:A,index:++y,value:w}});return i(T,function(w,x){return o(w,x,_)})}return gb=d,gb}var mb,yN;function z7(){if(yN)return mb;yN=1;var t=y1(),e=F7(),n=Kd(),r=Zd(),i=n(function(s,o){if(s==null)return[];var l=o.length;return l>1&&r(s,o[0],o[1])?o=[]:l>2&&r(o[0],o[1],o[2])&&(o=[o[0]]),e(s,t(o,1),[])});return mb=i,mb}var _b,bN;function q7(){if(bN)return _b;bN=1;var t=KI(),e=0;function n(r){var i=++e;return t(r)+i}return _b=n,_b}var vb,xN;function V7(){if(xN)return vb;xN=1;function t(e,n,r){for(var i=-1,s=e.length,o=n.length,l={};++i<s;){var u=i<o?n[i]:void 0;r(l,e[i],u)}return l}return vb=t,vb}var yb,wN;function $7(){if(wN)return yb;wN=1;var t=zd(),e=V7();function n(r,i){return e(r||[],i||[],t)}return yb=n,yb}var bb,TN;function Tt(){if(TN)return bb;TN=1;var t;if(typeof i1=="function")try{t={cloneDeep:a7(),constant:p1(),defaults:o7(),each:VI(),filter:eO(),find:p7(),flatten:_O(),forEach:qI(),forIn:g7(),has:tO(),isUndefined:nO(),last:m7(),map:iO(),mapValues:_7(),max:y7(),merge:E7(),min:A7(),minBy:R7(),now:C7(),pick:O7(),range:j7(),reduce:sO(),sortBy:z7(),uniqueId:q7(),values:uO(),zipObject:$7()}}catch{}return t||(t=window._),bb=t,bb}var xb,SN;function H7(){if(SN)return xb;SN=1,xb=t;function t(){var r={};r._next=r._prev=r,this._sentinel=r}t.prototype.dequeue=function(){var r=this._sentinel,i=r._prev;if(i!==r)return e(i),i},t.prototype.enqueue=function(r){var i=this._sentinel;r._prev&&r._next&&e(r),r._next=i._next,i._next._prev=r,i._next=r,r._prev=i},t.prototype.toString=function(){for(var r=[],i=this._sentinel,s=i._prev;s!==i;)r.push(JSON.stringify(s,n)),s=s._prev;return"["+r.join(", ")+"]"};function e(r){r._prev._next=r._next,r._next._prev=r._prev,delete r._next,delete r._prev}function n(r,i){if(r!=="_next"&&r!=="_prev")return i}return xb}var wb,EN;function W7(){if(EN)return wb;EN=1;var t=Tt(),e=Cr().Graph,n=H7();wb=i;var r=t.constant(1);function i(d,h){if(d.nodeCount()<=1)return[];var g=l(d,h||r),_=s(g.graph,g.buckets,g.zeroIdx);return t.flatten(t.map(_,function(y){return d.outEdges(y.v,y.w)}),!0)}function s(d,h,g){for(var _=[],y=h[h.length-1],T=h[0],w;d.nodeCount();){for(;w=T.dequeue();)o(d,h,g,w);for(;w=y.dequeue();)o(d,h,g,w);if(d.nodeCount()){for(var x=h.length-2;x>0;--x)if(w=h[x].dequeue(),w){_=_.concat(o(d,h,g,w,!0));break}}}return _}function o(d,h,g,_,y){var T=y?[]:void 0;return t.forEach(d.inEdges(_.v),function(w){var x=d.edge(w),S=d.node(w.v);y&&T.push({v:w.v,w:w.w}),S.out-=x,u(h,g,S)}),t.forEach(d.outEdges(_.v),function(w){var x=d.edge(w),S=w.w,A=d.node(S);A.in-=x,u(h,g,A)}),d.removeNode(_.v),T}function l(d,h){var g=new e,_=0,y=0;t.forEach(d.nodes(),function(x){g.setNode(x,{v:x,in:0,out:0})}),t.forEach(d.edges(),function(x){var S=g.edge(x.v,x.w)||0,A=h(x),R=S+A;g.setEdge(x.v,x.w,R),y=Math.max(y,g.node(x.v).out+=A),_=Math.max(_,g.node(x.w).in+=A)});var T=t.range(y+_+3).map(function(){return new n}),w=_+1;return t.forEach(g.nodes(),function(x){u(T,w,g.node(x))}),{graph:g,buckets:T,zeroIdx:w}}function u(d,h,g){g.out?g.in?d[g.out-g.in+h].enqueue(g):d[d.length-1].enqueue(g):d[0].enqueue(g)}return wb}var Tb,AN;function X7(){if(AN)return Tb;AN=1;var t=Tt(),e=W7();Tb={run:n,undo:i};function n(s){var o=s.graph().acyclicer==="greedy"?e(s,l(s)):r(s);t.forEach(o,function(u){var d=s.edge(u);s.removeEdge(u),d.forwardName=u.name,d.reversed=!0,s.setEdge(u.w,u.v,d,t.uniqueId("rev"))});function l(u){return function(d){return u.edge(d).weight}}}function r(s){var o=[],l={},u={};function d(h){t.has(u,h)||(u[h]=!0,l[h]=!0,t.forEach(s.outEdges(h),function(g){t.has(l,g.w)?o.push(g):d(g.w)}),delete l[h])}return t.forEach(s.nodes(),d),o}function i(s){t.forEach(s.edges(),function(o){var l=s.edge(o);if(l.reversed){s.removeEdge(o);var u=l.forwardName;delete l.reversed,delete l.forwardName,s.setEdge(o.w,o.v,l,u)}})}return Tb}var Sb,RN;function jn(){if(RN)return Sb;RN=1;var t=Tt(),e=Cr().Graph;Sb={addDummyNode:n,simplify:r,asNonCompoundGraph:i,successorWeights:s,predecessorWeights:o,intersectRect:l,buildLayerMatrix:u,normalizeRanks:d,removeEmptyRanks:h,addBorderNode:g,maxRank:_,partition:y,time:T,notime:w};function n(x,S,A,R){var E;do E=t.uniqueId(R);while(x.hasNode(E));return A.dummy=S,x.setNode(E,A),E}function r(x){var S=new e().setGraph(x.graph());return t.forEach(x.nodes(),function(A){S.setNode(A,x.node(A))}),t.forEach(x.edges(),function(A){var R=S.edge(A.v,A.w)||{weight:0,minlen:1},E=x.edge(A);S.setEdge(A.v,A.w,{weight:R.weight+E.weight,minlen:Math.max(R.minlen,E.minlen)})}),S}function i(x){var S=new e({multigraph:x.isMultigraph()}).setGraph(x.graph());return t.forEach(x.nodes(),function(A){x.children(A).length||S.setNode(A,x.node(A))}),t.forEach(x.edges(),function(A){S.setEdge(A,x.edge(A))}),S}function s(x){var S=t.map(x.nodes(),function(A){var R={};return t.forEach(x.outEdges(A),function(E){R[E.w]=(R[E.w]||0)+x.edge(E).weight}),R});return t.zipObject(x.nodes(),S)}function o(x){var S=t.map(x.nodes(),function(A){var R={};return t.forEach(x.inEdges(A),function(E){R[E.v]=(R[E.v]||0)+x.edge(E).weight}),R});return t.zipObject(x.nodes(),S)}function l(x,S){var A=x.x,R=x.y,E=S.x-A,C=S.y-R,I=x.width/2,O=x.height/2;if(!E&&!C)throw new Error("Not possible to find intersection inside of the rectangle");var M,P;return Math.abs(C)*I>Math.abs(E)*O?(C<0&&(O=-O),M=O*E/C,P=O):(E<0&&(I=-I),M=I,P=I*C/E),{x:A+M,y:R+P}}function u(x){var S=t.map(t.range(_(x)+1),function(){return[]});return t.forEach(x.nodes(),function(A){var R=x.node(A),E=R.rank;t.isUndefined(E)||(S[E][R.order]=A)}),S}function d(x){var S=t.min(t.map(x.nodes(),function(A){return x.node(A).rank}));t.forEach(x.nodes(),function(A){var R=x.node(A);t.has(R,"rank")&&(R.rank-=S)})}function h(x){var S=t.min(t.map(x.nodes(),function(C){return x.node(C).rank})),A=[];t.forEach(x.nodes(),function(C){var I=x.node(C).rank-S;A[I]||(A[I]=[]),A[I].push(C)});var R=0,E=x.graph().nodeRankFactor;t.forEach(A,function(C,I){t.isUndefined(C)&&I%E!==0?--R:R&&t.forEach(C,function(O){x.node(O).rank+=R})})}function g(x,S,A,R){var E={width:0,height:0};return arguments.length>=4&&(E.rank=A,E.order=R),n(x,"border",E,S)}function _(x){return t.max(t.map(x.nodes(),function(S){var A=x.node(S).rank;if(!t.isUndefined(A))return A}))}function y(x,S){var A={lhs:[],rhs:[]};return t.forEach(x,function(R){S(R)?A.lhs.push(R):A.rhs.push(R)}),A}function T(x,S){var A=t.now();try{return S()}finally{console.log(x+" time: "+(t.now()-A)+"ms")}}function w(x,S){return S()}return Sb}var Eb,CN;function Y7(){if(CN)return Eb;CN=1;var t=Tt(),e=jn();Eb={run:n,undo:i};function n(s){s.graph().dummyChains=[],t.forEach(s.edges(),function(o){r(s,o)})}function r(s,o){var l=o.v,u=s.node(l).rank,d=o.w,h=s.node(d).rank,g=o.name,_=s.edge(o),y=_.labelRank;if(h!==u+1){s.removeEdge(o);var T,w,x;for(x=0,++u;u<h;++x,++u)_.points=[],w={width:0,height:0,edgeLabel:_,edgeObj:o,rank:u},T=e.addDummyNode(s,"edge",w,"_d"),u===y&&(w.width=_.width,w.height=_.height,w.dummy="edge-label",w.labelpos=_.labelpos),s.setEdge(l,T,{weight:_.weight},g),x===0&&s.graph().dummyChains.push(T),l=T;s.setEdge(l,d,{weight:_.weight},g)}}function i(s){t.forEach(s.graph().dummyChains,function(o){var l=s.node(o),u=l.edgeLabel,d;for(s.setEdge(l.edgeObj,u);l.dummy;)d=s.successors(o)[0],s.removeNode(o),u.points.push({x:l.x,y:l.y}),l.dummy==="edge-label"&&(u.x=l.x,u.y=l.y,u.width=l.width,u.height=l.height),o=d,l=s.node(o)})}return Eb}var Ab,NN;function Of(){if(NN)return Ab;NN=1;var t=Tt();Ab={longestPath:e,slack:n};function e(r){var i={};function s(o){var l=r.node(o);if(t.has(i,o))return l.rank;i[o]=!0;var u=t.min(t.map(r.outEdges(o),function(d){return s(d.w)-r.edge(d).minlen}));return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),l.rank=u}t.forEach(r.sources(),s)}function n(r,i){return r.node(i.w).rank-r.node(i.v).rank-r.edge(i).minlen}return Ab}var Rb,kN;function xO(){if(kN)return Rb;kN=1;var t=Tt(),e=Cr().Graph,n=Of().slack;Rb=r;function r(l){var u=new e({directed:!1}),d=l.nodes()[0],h=l.nodeCount();u.setNode(d,{});for(var g,_;i(u,l)<h;)g=s(u,l),_=u.hasNode(g.v)?n(l,g):-n(l,g),o(u,l,_);return u}function i(l,u){function d(h){t.forEach(u.nodeEdges(h),function(g){var _=g.v,y=h===_?g.w:_;!l.hasNode(y)&&!n(u,g)&&(l.setNode(y,{}),l.setEdge(h,y,{}),d(y))})}return t.forEach(l.nodes(),d),l.nodeCount()}function s(l,u){return t.minBy(u.edges(),function(d){if(l.hasNode(d.v)!==l.hasNode(d.w))return n(u,d)})}function o(l,u,d){t.forEach(l.nodes(),function(h){u.node(h).rank+=d})}return Rb}var Cb,MN;function G7(){if(MN)return Cb;MN=1;var t=Tt(),e=xO(),n=Of().slack,r=Of().longestPath,i=Cr().alg.preorder,s=Cr().alg.postorder,o=jn().simplify;Cb=l,l.initLowLimValues=g,l.initCutValues=u,l.calcCutValue=h,l.leaveEdge=y,l.enterEdge=T,l.exchangeEdges=w;function l(R){R=o(R),r(R);var E=e(R);g(E),u(E,R);for(var C,I;C=y(E);)I=T(E,R,C),w(E,R,C,I)}function u(R,E){var C=s(R,R.nodes());C=C.slice(0,C.length-1),t.forEach(C,function(I){d(R,E,I)})}function d(R,E,C){var I=R.node(C),O=I.parent;R.edge(C,O).cutvalue=h(R,E,C)}function h(R,E,C){var I=R.node(C),O=I.parent,M=!0,P=E.edge(C,O),N=0;return P||(M=!1,P=E.edge(O,C)),N=P.weight,t.forEach(E.nodeEdges(C),function(B){var z=B.v===C,Q=z?B.w:B.v;if(Q!==O){var H=z===M,W=E.edge(B).weight;if(N+=H?W:-W,S(R,C,Q)){var q=R.edge(C,Q).cutvalue;N+=H?-q:q}}}),N}function g(R,E){arguments.length<2&&(E=R.nodes()[0]),_(R,{},1,E)}function _(R,E,C,I,O){var M=C,P=R.node(I);return E[I]=!0,t.forEach(R.neighbors(I),function(N){t.has(E,N)||(C=_(R,E,C,N,I))}),P.low=M,P.lim=C++,O?P.parent=O:delete P.parent,C}function y(R){return t.find(R.edges(),function(E){return R.edge(E).cutvalue<0})}function T(R,E,C){var I=C.v,O=C.w;E.hasEdge(I,O)||(I=C.w,O=C.v);var M=R.node(I),P=R.node(O),N=M,B=!1;M.lim>P.lim&&(N=P,B=!0);var z=t.filter(E.edges(),function(Q){return B===A(R,R.node(Q.v),N)&&B!==A(R,R.node(Q.w),N)});return t.minBy(z,function(Q){return n(E,Q)})}function w(R,E,C,I){var O=C.v,M=C.w;R.removeEdge(O,M),R.setEdge(I.v,I.w,{}),g(R),u(R,E),x(R,E)}function x(R,E){var C=t.find(R.nodes(),function(O){return!E.node(O).parent}),I=i(R,C);I=I.slice(1),t.forEach(I,function(O){var M=R.node(O).parent,P=E.edge(O,M),N=!1;P||(P=E.edge(M,O),N=!0),E.node(O).rank=E.node(M).rank+(N?P.minlen:-P.minlen)})}function S(R,E,C){return R.hasEdge(E,C)}function A(R,E,C){return C.low<=E.lim&&E.lim<=C.lim}return Cb}var Nb,IN;function K7(){if(IN)return Nb;IN=1;var t=Of(),e=t.longestPath,n=xO(),r=G7();Nb=i;function i(u){switch(u.graph().ranker){case"network-simplex":l(u);break;case"tight-tree":o(u);break;case"longest-path":s(u);break;default:l(u)}}var s=e;function o(u){e(u),n(u)}function l(u){r(u)}return Nb}var kb,ON;function Z7(){if(ON)return kb;ON=1;var t=Tt();kb=e;function e(i){var s=r(i);t.forEach(i.graph().dummyChains,function(o){for(var l=i.node(o),u=l.edgeObj,d=n(i,s,u.v,u.w),h=d.path,g=d.lca,_=0,y=h[_],T=!0;o!==u.w;){if(l=i.node(o),T){for(;(y=h[_])!==g&&i.node(y).maxRank<l.rank;)_++;y===g&&(T=!1)}if(!T){for(;_<h.length-1&&i.node(y=h[_+1]).minRank<=l.rank;)_++;y=h[_]}i.setParent(o,y),o=i.successors(o)[0]}})}function n(i,s,o,l){var u=[],d=[],h=Math.min(s[o].low,s[l].low),g=Math.max(s[o].lim,s[l].lim),_,y;_=o;do _=i.parent(_),u.push(_);while(_&&(s[_].low>h||g>s[_].lim));for(y=_,_=l;(_=i.parent(_))!==y;)d.push(_);return{path:u.concat(d.reverse()),lca:y}}function r(i){var s={},o=0;function l(u){var d=o;t.forEach(i.children(u),l),s[u]={low:d,lim:o++}}return t.forEach(i.children(),l),s}return kb}var Mb,PN;function Q7(){if(PN)return Mb;PN=1;var t=Tt(),e=jn();Mb={run:n,cleanup:o};function n(l){var u=e.addDummyNode(l,"root",{},"_root"),d=i(l),h=t.max(t.values(d))-1,g=2*h+1;l.graph().nestingRoot=u,t.forEach(l.edges(),function(y){l.edge(y).minlen*=g});var _=s(l)+1;t.forEach(l.children(),function(y){r(l,u,g,_,h,d,y)}),l.graph().nodeRankFactor=g}function r(l,u,d,h,g,_,y){var T=l.children(y);if(!T.length){y!==u&&l.setEdge(u,y,{weight:0,minlen:d});return}var w=e.addBorderNode(l,"_bt"),x=e.addBorderNode(l,"_bb"),S=l.node(y);l.setParent(w,y),S.borderTop=w,l.setParent(x,y),S.borderBottom=x,t.forEach(T,function(A){r(l,u,d,h,g,_,A);var R=l.node(A),E=R.borderTop?R.borderTop:A,C=R.borderBottom?R.borderBottom:A,I=R.borderTop?h:2*h,O=E!==C?1:g-_[y]+1;l.setEdge(w,E,{weight:I,minlen:O,nestingEdge:!0}),l.setEdge(C,x,{weight:I,minlen:O,nestingEdge:!0})}),l.parent(y)||l.setEdge(u,w,{weight:0,minlen:g+_[y]})}function i(l){var u={};function d(h,g){var _=l.children(h);_&&_.length&&t.forEach(_,function(y){d(y,g+1)}),u[h]=g}return t.forEach(l.children(),function(h){d(h,1)}),u}function s(l){return t.reduce(l.edges(),function(u,d){return u+l.edge(d).weight},0)}function o(l){var u=l.graph();l.removeNode(u.nestingRoot),delete u.nestingRoot,t.forEach(l.edges(),function(d){var h=l.edge(d);h.nestingEdge&&l.removeEdge(d)})}return Mb}var Ib,DN;function J7(){if(DN)return Ib;DN=1;var t=Tt(),e=jn();Ib=n;function n(i){function s(o){var l=i.children(o),u=i.node(o);if(l.length&&t.forEach(l,s),t.has(u,"minRank")){u.borderLeft=[],u.borderRight=[];for(var d=u.minRank,h=u.maxRank+1;d<h;++d)r(i,"borderLeft","_bl",o,u,d),r(i,"borderRight","_br",o,u,d)}}t.forEach(i.children(),s)}function r(i,s,o,l,u,d){var h={width:0,height:0,rank:d,borderType:s},g=u[s][d-1],_=e.addDummyNode(i,"border",h,o);u[s][d]=_,i.setParent(_,l),g&&i.setEdge(g,_,{weight:1})}return Ib}var Ob,jN;function eq(){if(jN)return Ob;jN=1;var t=Tt();Ob={adjust:e,undo:n};function e(d){var h=d.graph().rankdir.toLowerCase();(h==="lr"||h==="rl")&&r(d)}function n(d){var h=d.graph().rankdir.toLowerCase();(h==="bt"||h==="rl")&&s(d),(h==="lr"||h==="rl")&&(l(d),r(d))}function r(d){t.forEach(d.nodes(),function(h){i(d.node(h))}),t.forEach(d.edges(),function(h){i(d.edge(h))})}function i(d){var h=d.width;d.width=d.height,d.height=h}function s(d){t.forEach(d.nodes(),function(h){o(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,o),t.has(g,"y")&&o(g)})}function o(d){d.y=-d.y}function l(d){t.forEach(d.nodes(),function(h){u(d.node(h))}),t.forEach(d.edges(),function(h){var g=d.edge(h);t.forEach(g.points,u),t.has(g,"x")&&u(g)})}function u(d){var h=d.x;d.x=d.y,d.y=h}return Ob}var Pb,LN;function tq(){if(LN)return Pb;LN=1;var t=Tt();Pb=e;function e(n){var r={},i=t.filter(n.nodes(),function(d){return!n.children(d).length}),s=t.max(t.map(i,function(d){return n.node(d).rank})),o=t.map(t.range(s+1),function(){return[]});function l(d){if(!t.has(r,d)){r[d]=!0;var h=n.node(d);o[h.rank].push(d),t.forEach(n.successors(d),l)}}var u=t.sortBy(i,function(d){return n.node(d).rank});return t.forEach(u,l),o}return Pb}var Db,BN;function nq(){if(BN)return Db;BN=1;var t=Tt();Db=e;function e(r,i){for(var s=0,o=1;o<i.length;++o)s+=n(r,i[o-1],i[o]);return s}function n(r,i,s){for(var o=t.zipObject(s,t.map(s,function(_,y){return y})),l=t.flatten(t.map(i,function(_){return t.sortBy(t.map(r.outEdges(_),function(y){return{pos:o[y.w],weight:r.edge(y).weight}}),"pos")}),!0),u=1;u<s.length;)u<<=1;var d=2*u-1;u-=1;var h=t.map(new Array(d),function(){return 0}),g=0;return t.forEach(l.forEach(function(_){var y=_.pos+u;h[y]+=_.weight;for(var T=0;y>0;)y%2&&(T+=h[y+1]),y=y-1>>1,h[y]+=_.weight;g+=_.weight*T})),g}return Db}var jb,UN;function rq(){if(UN)return jb;UN=1;var t=Tt();jb=e;function e(n,r){return t.map(r,function(i){var s=n.inEdges(i);if(s.length){var o=t.reduce(s,function(l,u){var d=n.edge(u),h=n.node(u.v);return{sum:l.sum+d.weight*h.order,weight:l.weight+d.weight}},{sum:0,weight:0});return{v:i,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:i}})}return jb}var Lb,FN;function iq(){if(FN)return Lb;FN=1;var t=Tt();Lb=e;function e(i,s){var o={};t.forEach(i,function(u,d){var h=o[u.v]={indegree:0,in:[],out:[],vs:[u.v],i:d};t.isUndefined(u.barycenter)||(h.barycenter=u.barycenter,h.weight=u.weight)}),t.forEach(s.edges(),function(u){var d=o[u.v],h=o[u.w];!t.isUndefined(d)&&!t.isUndefined(h)&&(h.indegree++,d.out.push(o[u.w]))});var l=t.filter(o,function(u){return!u.indegree});return n(l)}function n(i){var s=[];function o(d){return function(h){h.merged||(t.isUndefined(h.barycenter)||t.isUndefined(d.barycenter)||h.barycenter>=d.barycenter)&&r(d,h)}}function l(d){return function(h){h.in.push(d),--h.indegree===0&&i.push(h)}}for(;i.length;){var u=i.pop();s.push(u),t.forEach(u.in.reverse(),o(u)),t.forEach(u.out,l(u))}return t.map(t.filter(s,function(d){return!d.merged}),function(d){return t.pick(d,["vs","i","barycenter","weight"])})}function r(i,s){var o=0,l=0;i.weight&&(o+=i.barycenter*i.weight,l+=i.weight),s.weight&&(o+=s.barycenter*s.weight,l+=s.weight),i.vs=s.vs.concat(i.vs),i.barycenter=o/l,i.weight=l,i.i=Math.min(s.i,i.i),s.merged=!0}return Lb}var Bb,zN;function sq(){if(zN)return Bb;zN=1;var t=Tt(),e=jn();Bb=n;function n(s,o){var l=e.partition(s,function(w){return t.has(w,"barycenter")}),u=l.lhs,d=t.sortBy(l.rhs,function(w){return-w.i}),h=[],g=0,_=0,y=0;u.sort(i(!!o)),y=r(h,d,y),t.forEach(u,function(w){y+=w.vs.length,h.push(w.vs),g+=w.barycenter*w.weight,_+=w.weight,y=r(h,d,y)});var T={vs:t.flatten(h,!0)};return _&&(T.barycenter=g/_,T.weight=_),T}function r(s,o,l){for(var u;o.length&&(u=t.last(o)).i<=l;)o.pop(),s.push(u.vs),l++;return l}function i(s){return function(o,l){return o.barycenter<l.barycenter?-1:o.barycenter>l.barycenter?1:s?l.i-o.i:o.i-l.i}}return Bb}var Ub,qN;function aq(){if(qN)return Ub;qN=1;var t=Tt(),e=rq(),n=iq(),r=sq();Ub=i;function i(l,u,d,h){var g=l.children(u),_=l.node(u),y=_?_.borderLeft:void 0,T=_?_.borderRight:void 0,w={};y&&(g=t.filter(g,function(C){return C!==y&&C!==T}));var x=e(l,g);t.forEach(x,function(C){if(l.children(C.v).length){var I=i(l,C.v,d,h);w[C.v]=I,t.has(I,"barycenter")&&o(C,I)}});var S=n(x,d);s(S,w);var A=r(S,h);if(y&&(A.vs=t.flatten([y,A.vs,T],!0),l.predecessors(y).length)){var R=l.node(l.predecessors(y)[0]),E=l.node(l.predecessors(T)[0]);t.has(A,"barycenter")||(A.barycenter=0,A.weight=0),A.barycenter=(A.barycenter*A.weight+R.order+E.order)/(A.weight+2),A.weight+=2}return A}function s(l,u){t.forEach(l,function(d){d.vs=t.flatten(d.vs.map(function(h){return u[h]?u[h].vs:h}),!0)})}function o(l,u){t.isUndefined(l.barycenter)?(l.barycenter=u.barycenter,l.weight=u.weight):(l.barycenter=(l.barycenter*l.weight+u.barycenter*u.weight)/(l.weight+u.weight),l.weight+=u.weight)}return Ub}var Fb,VN;function oq(){if(VN)return Fb;VN=1;var t=Tt(),e=Cr().Graph;Fb=n;function n(i,s,o){var l=r(i),u=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(function(d){return i.node(d)});return t.forEach(i.nodes(),function(d){var h=i.node(d),g=i.parent(d);(h.rank===s||h.minRank<=s&&s<=h.maxRank)&&(u.setNode(d),u.setParent(d,g||l),t.forEach(i[o](d),function(_){var y=_.v===d?_.w:_.v,T=u.edge(y,d),w=t.isUndefined(T)?0:T.weight;u.setEdge(y,d,{weight:i.edge(_).weight+w})}),t.has(h,"minRank")&&u.setNode(d,{borderLeft:h.borderLeft[s],borderRight:h.borderRight[s]}))}),u}function r(i){for(var s;i.hasNode(s=t.uniqueId("_root")););return s}return Fb}var zb,$N;function lq(){if($N)return zb;$N=1;var t=Tt();zb=e;function e(n,r,i){var s={},o;t.forEach(i,function(l){for(var u=n.parent(l),d,h;u;){if(d=n.parent(u),d?(h=s[d],s[d]=u):(h=o,o=u),h&&h!==u){r.setEdge(h,u);return}u=d}})}return zb}var qb,HN;function cq(){if(HN)return qb;HN=1;var t=Tt(),e=tq(),n=nq(),r=aq(),i=oq(),s=lq(),o=Cr().Graph,l=jn();qb=u;function u(_){var y=l.maxRank(_),T=d(_,t.range(1,y+1),"inEdges"),w=d(_,t.range(y-1,-1,-1),"outEdges"),x=e(_);g(_,x);for(var S=Number.POSITIVE_INFINITY,A,R=0,E=0;E<4;++R,++E){h(R%2?T:w,R%4>=2),x=l.buildLayerMatrix(_);var C=n(_,x);C<S&&(E=0,A=t.cloneDeep(x),S=C)}g(_,A)}function d(_,y,T){return t.map(y,function(w){return i(_,w,T)})}function h(_,y){var T=new o;t.forEach(_,function(w){var x=w.graph().root,S=r(w,x,T,y);t.forEach(S.vs,function(A,R){w.node(A).order=R}),s(w,T,S.vs)})}function g(_,y){t.forEach(y,function(T){t.forEach(T,function(w,x){_.node(w).order=x})})}return qb}var Vb,WN;function uq(){if(WN)return Vb;WN=1;var t=Tt(),e=Cr().Graph,n=jn();Vb={positionX:T,findType1Conflicts:r,findType2Conflicts:i,addConflict:o,hasConflict:l,verticalAlignment:u,horizontalCompaction:d,alignCoordinates:_,findSmallestWidthAlignment:g,balance:y};function r(S,A){var R={};function E(C,I){var O=0,M=0,P=C.length,N=t.last(I);return t.forEach(I,function(B,z){var Q=s(S,B),H=Q?S.node(Q).order:P;(Q||B===N)&&(t.forEach(I.slice(M,z+1),function(W){t.forEach(S.predecessors(W),function(q){var ee=S.node(q),de=ee.order;(de<O||H<de)&&!(ee.dummy&&S.node(W).dummy)&&o(R,q,W)})}),M=z+1,O=H)}),I}return t.reduce(A,E),R}function i(S,A){var R={};function E(I,O,M,P,N){var B;t.forEach(t.range(O,M),function(z){B=I[z],S.node(B).dummy&&t.forEach(S.predecessors(B),function(Q){var H=S.node(Q);H.dummy&&(H.order<P||H.order>N)&&o(R,Q,B)})})}function C(I,O){var M=-1,P,N=0;return t.forEach(O,function(B,z){if(S.node(B).dummy==="border"){var Q=S.predecessors(B);Q.length&&(P=S.node(Q[0]).order,E(O,N,z,M,P),N=z,M=P)}E(O,N,O.length,P,I.length)}),O}return t.reduce(A,C),R}function s(S,A){if(S.node(A).dummy)return t.find(S.predecessors(A),function(R){return S.node(R).dummy})}function o(S,A,R){if(A>R){var E=A;A=R,R=E}var C=S[A];C||(S[A]=C={}),C[R]=!0}function l(S,A,R){if(A>R){var E=A;A=R,R=E}return t.has(S[A],R)}function u(S,A,R,E){var C={},I={},O={};return t.forEach(A,function(M){t.forEach(M,function(P,N){C[P]=P,I[P]=P,O[P]=N})}),t.forEach(A,function(M){var P=-1;t.forEach(M,function(N){var B=E(N);if(B.length){B=t.sortBy(B,function(q){return O[q]});for(var z=(B.length-1)/2,Q=Math.floor(z),H=Math.ceil(z);Q<=H;++Q){var W=B[Q];I[N]===N&&P<O[W]&&!l(R,N,W)&&(I[W]=N,I[N]=C[N]=C[W],P=O[W])}}})}),{root:C,align:I}}function d(S,A,R,E,C){var I={},O=h(S,A,R,C),M=C?"borderLeft":"borderRight";function P(z,Q){for(var H=O.nodes(),W=H.pop(),q={};W;)q[W]?z(W):(q[W]=!0,H.push(W),H=H.concat(Q(W))),W=H.pop()}function N(z){I[z]=O.inEdges(z).reduce(function(Q,H){return Math.max(Q,I[H.v]+O.edge(H))},0)}function B(z){var Q=O.outEdges(z).reduce(function(W,q){return Math.min(W,I[q.w]-O.edge(q))},Number.POSITIVE_INFINITY),H=S.node(z);Q!==Number.POSITIVE_INFINITY&&H.borderType!==M&&(I[z]=Math.max(I[z],Q))}return P(N,O.predecessors.bind(O)),P(B,O.successors.bind(O)),t.forEach(E,function(z){I[z]=I[R[z]]}),I}function h(S,A,R,E){var C=new e,I=S.graph(),O=w(I.nodesep,I.edgesep,E);return t.forEach(A,function(M){var P;t.forEach(M,function(N){var B=R[N];if(C.setNode(B),P){var z=R[P],Q=C.edge(z,B);C.setEdge(z,B,Math.max(O(S,N,P),Q||0))}P=N})}),C}function g(S,A){return t.minBy(t.values(A),function(R){var E=Number.NEGATIVE_INFINITY,C=Number.POSITIVE_INFINITY;return t.forIn(R,function(I,O){var M=x(S,O)/2;E=Math.max(I+M,E),C=Math.min(I-M,C)}),E-C})}function _(S,A){var R=t.values(A),E=t.min(R),C=t.max(R);t.forEach(["u","d"],function(I){t.forEach(["l","r"],function(O){var M=I+O,P=S[M],N;if(P!==A){var B=t.values(P);N=O==="l"?E-t.min(B):C-t.max(B),N&&(S[M]=t.mapValues(P,function(z){return z+N}))}})})}function y(S,A){return t.mapValues(S.ul,function(R,E){if(A)return S[A.toLowerCase()][E];var C=t.sortBy(t.map(S,E));return(C[1]+C[2])/2})}function T(S){var A=n.buildLayerMatrix(S),R=t.merge(r(S,A),i(S,A)),E={},C;t.forEach(["u","d"],function(O){C=O==="u"?A:t.values(A).reverse(),t.forEach(["l","r"],function(M){M==="r"&&(C=t.map(C,function(z){return t.values(z).reverse()}));var P=(O==="u"?S.predecessors:S.successors).bind(S),N=u(S,C,R,P),B=d(S,C,N.root,N.align,M==="r");M==="r"&&(B=t.mapValues(B,function(z){return-z})),E[O+M]=B})});var I=g(S,E);return _(E,I),y(E,S.graph().align)}function w(S,A,R){return function(E,C,I){var O=E.node(C),M=E.node(I),P=0,N;if(P+=O.width/2,t.has(O,"labelpos"))switch(O.labelpos.toLowerCase()){case"l":N=-O.width/2;break;case"r":N=O.width/2;break}if(N&&(P+=R?N:-N),N=0,P+=(O.dummy?A:S)/2,P+=(M.dummy?A:S)/2,P+=M.width/2,t.has(M,"labelpos"))switch(M.labelpos.toLowerCase()){case"l":N=M.width/2;break;case"r":N=-M.width/2;break}return N&&(P+=R?N:-N),N=0,P}}function x(S,A){return S.node(A).width}return Vb}var $b,XN;function fq(){if(XN)return $b;XN=1;var t=Tt(),e=jn(),n=uq().positionX;$b=r;function r(s){s=e.asNonCompoundGraph(s),i(s),t.forEach(n(s),function(o,l){s.node(l).x=o})}function i(s){var o=e.buildLayerMatrix(s),l=s.graph().ranksep,u=0;t.forEach(o,function(d){var h=t.max(t.map(d,function(g){return s.node(g).height}));t.forEach(d,function(g){s.node(g).y=u+h/2}),u+=h+l})}return $b}var Hb,YN;function dq(){if(YN)return Hb;YN=1;var t=Tt(),e=X7(),n=Y7(),r=K7(),i=jn().normalizeRanks,s=Z7(),o=jn().removeEmptyRanks,l=Q7(),u=J7(),d=eq(),h=cq(),g=fq(),_=jn(),y=Cr().Graph;Hb=T;function T(F,$){var Y=$&&$.debugTiming?_.time:_.notime;Y("layout",function(){var ue=Y("  buildLayoutGraph",function(){return P(F)});Y("  runLayout",function(){w(ue,Y)}),Y("  updateInputGraph",function(){x(F,ue)})})}function w(F,$){$("    makeSpaceForEdgeLabels",function(){N(F)}),$("    removeSelfEdges",function(){Z(F)}),$("    acyclic",function(){e.run(F)}),$("    nestingGraph.run",function(){l.run(F)}),$("    rank",function(){r(_.asNonCompoundGraph(F))}),$("    injectEdgeLabelProxies",function(){B(F)}),$("    removeEmptyRanks",function(){o(F)}),$("    nestingGraph.cleanup",function(){l.cleanup(F)}),$("    normalizeRanks",function(){i(F)}),$("    assignRankMinMax",function(){z(F)}),$("    removeEdgeLabelProxies",function(){Q(F)}),$("    normalize.run",function(){n.run(F)}),$("    parentDummyChains",function(){s(F)}),$("    addBorderSegments",function(){u(F)}),$("    order",function(){h(F)}),$("    insertSelfEdges",function(){D(F)}),$("    adjustCoordinateSystem",function(){d.adjust(F)}),$("    position",function(){g(F)}),$("    positionSelfEdges",function(){G(F)}),$("    removeBorderNodes",function(){de(F)}),$("    normalize.undo",function(){n.undo(F)}),$("    fixupEdgeLabelCoords",function(){q(F)}),$("    undoCoordinateSystem",function(){d.undo(F)}),$("    translateGraph",function(){H(F)}),$("    assignNodeIntersects",function(){W(F)}),$("    reversePoints",function(){ee(F)}),$("    acyclic.undo",function(){e.undo(F)})}function x(F,$){t.forEach(F.nodes(),function(Y){var ue=F.node(Y),ye=$.node(Y);ue&&(ue.x=ye.x,ue.y=ye.y,$.children(Y).length&&(ue.width=ye.width,ue.height=ye.height))}),t.forEach(F.edges(),function(Y){var ue=F.edge(Y),ye=$.edge(Y);ue.points=ye.points,t.has(ye,"x")&&(ue.x=ye.x,ue.y=ye.y)}),F.graph().width=$.graph().width,F.graph().height=$.graph().height}var S=["nodesep","edgesep","ranksep","marginx","marginy"],A={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},R=["acyclicer","ranker","rankdir","align"],E=["width","height"],C={width:0,height:0},I=["minlen","weight","width","height","labeloffset"],O={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},M=["labelpos"];function P(F){var $=new y({multigraph:!0,compound:!0}),Y=ie(F.graph());return $.setGraph(t.merge({},A,oe(Y,S),t.pick(Y,R))),t.forEach(F.nodes(),function(ue){var ye=ie(F.node(ue));$.setNode(ue,t.defaults(oe(ye,E),C)),$.setParent(ue,F.parent(ue))}),t.forEach(F.edges(),function(ue){var ye=ie(F.edge(ue));$.setEdge(ue,t.merge({},O,oe(ye,I),t.pick(ye,M)))}),$}function N(F){var $=F.graph();$.ranksep/=2,t.forEach(F.edges(),function(Y){var ue=F.edge(Y);ue.minlen*=2,ue.labelpos.toLowerCase()!=="c"&&($.rankdir==="TB"||$.rankdir==="BT"?ue.width+=ue.labeloffset:ue.height+=ue.labeloffset)})}function B(F){t.forEach(F.edges(),function($){var Y=F.edge($);if(Y.width&&Y.height){var ue=F.node($.v),ye=F.node($.w),Se={rank:(ye.rank-ue.rank)/2+ue.rank,e:$};_.addDummyNode(F,"edge-proxy",Se,"_ep")}})}function z(F){var $=0;t.forEach(F.nodes(),function(Y){var ue=F.node(Y);ue.borderTop&&(ue.minRank=F.node(ue.borderTop).rank,ue.maxRank=F.node(ue.borderBottom).rank,$=t.max($,ue.maxRank))}),F.graph().maxRank=$}function Q(F){t.forEach(F.nodes(),function($){var Y=F.node($);Y.dummy==="edge-proxy"&&(F.edge(Y.e).labelRank=Y.rank,F.removeNode($))})}function H(F){var $=Number.POSITIVE_INFINITY,Y=0,ue=Number.POSITIVE_INFINITY,ye=0,Se=F.graph(),ke=Se.marginx||0,Ue=Se.marginy||0;function yt(We){var Fe=We.x,De=We.y,Jt=We.width,Ne=We.height;$=Math.min($,Fe-Jt/2),Y=Math.max(Y,Fe+Jt/2),ue=Math.min(ue,De-Ne/2),ye=Math.max(ye,De+Ne/2)}t.forEach(F.nodes(),function(We){yt(F.node(We))}),t.forEach(F.edges(),function(We){var Fe=F.edge(We);t.has(Fe,"x")&&yt(Fe)}),$-=ke,ue-=Ue,t.forEach(F.nodes(),function(We){var Fe=F.node(We);Fe.x-=$,Fe.y-=ue}),t.forEach(F.edges(),function(We){var Fe=F.edge(We);t.forEach(Fe.points,function(De){De.x-=$,De.y-=ue}),t.has(Fe,"x")&&(Fe.x-=$),t.has(Fe,"y")&&(Fe.y-=ue)}),Se.width=Y-$+ke,Se.height=ye-ue+Ue}function W(F){t.forEach(F.edges(),function($){var Y=F.edge($),ue=F.node($.v),ye=F.node($.w),Se,ke;Y.points?(Se=Y.points[0],ke=Y.points[Y.points.length-1]):(Y.points=[],Se=ye,ke=ue),Y.points.unshift(_.intersectRect(ue,Se)),Y.points.push(_.intersectRect(ye,ke))})}function q(F){t.forEach(F.edges(),function($){var Y=F.edge($);if(t.has(Y,"x"))switch((Y.labelpos==="l"||Y.labelpos==="r")&&(Y.width-=Y.labeloffset),Y.labelpos){case"l":Y.x-=Y.width/2+Y.labeloffset;break;case"r":Y.x+=Y.width/2+Y.labeloffset;break}})}function ee(F){t.forEach(F.edges(),function($){var Y=F.edge($);Y.reversed&&Y.points.reverse()})}function de(F){t.forEach(F.nodes(),function($){if(F.children($).length){var Y=F.node($),ue=F.node(Y.borderTop),ye=F.node(Y.borderBottom),Se=F.node(t.last(Y.borderLeft)),ke=F.node(t.last(Y.borderRight));Y.width=Math.abs(ke.x-Se.x),Y.height=Math.abs(ye.y-ue.y),Y.x=Se.x+Y.width/2,Y.y=ue.y+Y.height/2}}),t.forEach(F.nodes(),function($){F.node($).dummy==="border"&&F.removeNode($)})}function Z(F){t.forEach(F.edges(),function($){if($.v===$.w){var Y=F.node($.v);Y.selfEdges||(Y.selfEdges=[]),Y.selfEdges.push({e:$,label:F.edge($)}),F.removeEdge($)}})}function D(F){var $=_.buildLayerMatrix(F);t.forEach($,function(Y){var ue=0;t.forEach(Y,function(ye,Se){var ke=F.node(ye);ke.order=Se+ue,t.forEach(ke.selfEdges,function(Ue){_.addDummyNode(F,"selfedge",{width:Ue.label.width,height:Ue.label.height,rank:ke.rank,order:Se+ ++ue,e:Ue.e,label:Ue.label},"_se")}),delete ke.selfEdges})})}function G(F){t.forEach(F.nodes(),function($){var Y=F.node($);if(Y.dummy==="selfedge"){var ue=F.node(Y.e.v),ye=ue.x+ue.width/2,Se=ue.y,ke=Y.x-ye,Ue=ue.height/2;F.setEdge(Y.e,Y.label),F.removeNode($),Y.label.points=[{x:ye+2*ke/3,y:Se-Ue},{x:ye+5*ke/6,y:Se-Ue},{x:ye+ke,y:Se},{x:ye+5*ke/6,y:Se+Ue},{x:ye+2*ke/3,y:Se+Ue}],Y.label.x=Y.x,Y.label.y=Y.y}})}function oe(F,$){return t.mapValues(t.pick(F,$),Number)}function ie(F){var $={};return t.forEach(F,function(Y,ue){$[ue.toLowerCase()]=Y}),$}return Hb}var Wb,GN;function hq(){if(GN)return Wb;GN=1;var t=Tt(),e=jn(),n=Cr().Graph;Wb={debugOrdering:r};function r(i){var s=e.buildLayerMatrix(i),o=new n({compound:!0,multigraph:!0}).setGraph({});return t.forEach(i.nodes(),function(l){o.setNode(l,{label:l}),o.setParent(l,"layer"+i.node(l).rank)}),t.forEach(i.edges(),function(l){o.setEdge(l.v,l.w,{},l.name)}),t.forEach(s,function(l,u){var d="layer"+u;o.setNode(d,{rank:"same"}),t.reduce(l,function(h,g){return o.setEdge(h,g,{style:"invis"}),g})}),o}return Wb}var Xb,KN;function pq(){return KN||(KN=1,Xb="0.8.5"),Xb}var Yb,ZN;function gq(){return ZN||(ZN=1,Yb={graphlib:Cr(),layout:dq(),debug:hq(),util:{time:jn().time,notime:jn().notime},version:pq()}),Yb}var QN=gq();const mq={sample:8,root:6,other:5};function Xx(t,e,n,r){return t.is_sample||Ul(t,n,r)?t.is_sample?e.sample:e.root:e.other}const Be={ROOT_NODE_STROKE_WIDTH:2,SAMPLE_NODE_STROKE_WIDTH:1,EDGE_STROKE_WIDTH:1,COLLISION_RADIUS:15,TOOLTIP_FONT_SIZE:"12px",PADDING_RATIO:.1,MAX_SIBLING_DISTANCE:50,FORCE_STRENGTH:{LINK_SIBLING:.9,LINK_SAMPLE:.8,LINK_DEFAULT:.3,CHARGE:-20,X_POSITION:.15,Y_POSITION:1,ALPHA_START:.8,ALPHA_DECAY:.05,VELOCITY_DECAY:.7},ZOOM:{MIN_SCALE:.1,MAX_SCALE:4,FOCUS_SCALE:1.5,GRAPH_FIT_SCALE_MIN:.2,GRAPH_FIT_SCALE_MAX:1.5,TRANSITION_DURATION:750,ALPHA_TARGET:.3},LAYOUT:{BOTTOM_MARGIN_RATIO:.15},PERFORMANCE:{ALPHA_THRESHOLD:.1}};function lo(t,e){const n=typeof t.source=="number"?e.find(i=>i.id===t.source)||null:t.source,r=typeof t.target=="number"?e.find(i=>i.id===t.target)||null:t.target;return{source:n,target:r}}function wO(t,e,n){const r=new Set,i=new Set,s=[t];for(;s.length>0;){const o=s.shift();if(i.has(o.id))continue;i.add(o.id),n.filter(u=>{const{source:d,target:h}=lo(u,e);return(d==null?void 0:d.id)===o.id&&h&&h.timeIndex>o.timeIndex}).forEach(u=>{const{target:d}=lo(u,e);d&&(d.is_sample?r.add(d):i.has(d.id)||s.push(d))})}return Array.from(r)}function vf(t,e,n){const r=wO(t,e,n);if(r.length===0)return null;const i=r.map(s=>s.x);return{min:Math.min(...i),max:Math.max(...i)}}function _q(t,e,n){const r=vf(t,e,n);r&&t.x!==void 0&&(t.x=Math.max(r.min,Math.min(r.max,t.x)))}function Pf(t,e,n){const r=n.find(s=>{const{source:o,target:l}=lo(s,e);return(l==null?void 0:l.id)===t.id&&o&&o.timeIndex<t.timeIndex});if(!r)return null;const{source:i}=lo(r,e);return i}function JN(t,e,n){const r=Pf(t,e,n);return r?e.filter(i=>{if(i.id===t.id||i.timeIndex<=r.timeIndex)return!1;const s=Pf(i,e,n);return(s==null?void 0:s.id)===r.id}):[]}function Gb(t,e,n,r,i,s,o=5){const l=Math.sqrt((t-n)**2+(e-r)**2),u=Math.sqrt((t-i)**2+(e-s)**2),d=Math.sqrt((i-n)**2+(s-r)**2);return Math.abs(l+u-d)<=o}function vq(t,e,n,r,i,s,o){const l=new Set(e.filter(g=>{const _=typeof g.source=="number"?g.source:g.source.id,y=typeof g.target=="number"?g.target:g.target.id;return _===t.id||y===t.id}).map(g=>`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`)),u=e.filter(g=>{const _=`${typeof g.source=="number"?g.source:g.source.id}-${typeof g.target=="number"?g.target:g.target.id}`;if(l.has(_))return!1;const y=typeof g.source=="number"?n.find(w=>w.id===g.source):g.source,T=typeof g.target=="number"?n.find(w=>w.id===g.target):g.target;return!y||!T?!1:Gb(t.x,t.y,y.x,y.y,T.x,T.y,r*2)});if(u.length===0)return{x:t.x,y:t.y};const d=30,h=5;for(let g=h;g<=d;g+=h){const _=Math.min(t.x+g,s);let y=!1;for(const x of u){const S=typeof x.source=="number"?n.find(R=>R.id===x.source):x.source,A=typeof x.target=="number"?n.find(R=>R.id===x.target):x.target;if(Gb(_,t.y,S.x,S.y,A.x,A.y,r*2)){y=!0;break}}if(!y)return{x:_,y:t.y};const T=Math.max(t.x-g,i);let w=!1;for(const x of u){const S=typeof x.source=="number"?n.find(R=>R.id===x.source):x.source,A=typeof x.target=="number"?n.find(R=>R.id===x.target):x.target;if(Gb(T,t.y,S.x,S.y,A.x,A.y,r*2)){w=!0;break}}if(!w)return{x:T,y:t.y}}return{x:t.x,y:t.y}}function yq(t,e){return e.filter(n=>{const r=typeof n.source=="number"?n.source:n.source.id,i=typeof n.target=="number"?n.target:n.target.id;return r===t.id||i===t.id})}function bq(t,e,n){const r=ek(t,n),i=ek(e,n);if(r.size!==i.size)return!1;for(const s of r)if(!i.has(s))return!1;return!0}function ek(t,e){const n=new Set;return yq(t,e).forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id;i!==t.id&&n.add(i),s!==t.id&&n.add(s)}),n}function xq(t,e){const n=new Set,r=[],i=new Map;for(let o=0;o<t.length;o++){if(n.has(t[o].id))continue;const l=t[o];if(l.is_sample){r.push(l),i.set(l.id,l.id),n.add(l.id);continue}const u=wq(l,t,e,n,o),d=Tq(l,u);r.push(d),u.forEach(h=>{i.set(h.id,d.id),n.add(h.id)})}const s=Sq(e,i);return{nodes:r,edges:s}}function wq(t,e,n,r,i){const s=[t];for(let o=i+1;o<e.length;o++){const l=e[o];r.has(l.id)||l.is_sample||t.time===l.time&&bq(t,l,n)&&s.push(l)}return s}function Tq(t,e){return e.length===1?t:{...t,is_combined:!0,combined_nodes:e.map(n=>n.id)}}function Sq(t,e){const n=[];return t.forEach(r=>{const i=typeof r.source=="number"?r.source:r.source.id,s=typeof r.target=="number"?r.target:r.target.id,o=e.get(i),l=e.get(s);o!==void 0&&l!==void 0&&n.push({...r,source:o,target:l})}),n}function Ul(t,e,n){const r=n.some(s=>{const{target:o}=lo(s,e);return(o==null?void 0:o.id)===t.id}),i=n.some(s=>{const{source:o}=lo(s,e);return(o==null?void 0:o.id)===t.id});return!r&&i}function Eq(t,e,n,r,i){return(s,o,l)=>{if(s)if(l.length===0){const u=o.find(y=>y.id===s.id);if(!u)return;const d=u.x??0,g=r*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO)-u.timeIndex*i,_=Pd.translate(n/2,r/2).scale(Be.ZOOM.FOCUS_SCALE).translate(-d,-g);t.transition().duration(Be.ZOOM.TRANSITION_DURATION).call(e.transform,_)}else{const u=o.filter(g=>g.x!==void 0&&g.timeIndex!==void 0);if(u.length===0)return;const d=Aq(u,r,i),h=Rq(d,n,r);t.transition().duration(Be.ZOOM.TRANSITION_DURATION).call(e.transform,h)}}}function Aq(t,e,n){const r=t.map(o=>o.x),i=e*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),s=t.map(o=>i-o.timeIndex*n);return{minX:Math.min(...r),maxX:Math.max(...r),minY:Math.min(...s),maxY:Math.max(...s)}}function Rq(t,e,n){const r=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2,s=t.maxX-t.minX,o=t.maxY-t.minY,l=50,u=(e-2*l)/(s||1),d=(n-2*l)/(o||1),h=Math.min(Math.max(Be.ZOOM.GRAPH_FIT_SCALE_MIN,Math.min(u,d)),Be.ZOOM.GRAPH_FIT_SCALE_MAX);return Pd.translate(e/2,n/2).scale(h).translate(-r,-i)}function Cq(t,e,n,r){const i=new Map;t.forEach(s=>{if(!s.is_sample){const o=Math.round(s.x*100)/100,l=i.get(o)||[];l.push(s),i.set(o,l)}}),i.forEach((s,o)=>{if(s.length>1){s.sort((l,u)=>l.y-u.y);for(let l=0;l<s.length;l++)for(let u=l+1;u<s.length;u++){const d=s[l],h=s[u];if(!e.some(_=>{const y=typeof _.source=="number"?_.source:_.source.id,T=typeof _.target=="number"?_.target:_.target.id;return y===d.id&&T===h.id||y===h.id&&T===d.id})){const T=((h.id*1e4+d.id)%1e3/1e3-.5)*15,w=Math.max(n,Math.min(r,h.x+T));h.x=w,h.fx=w}}}})}function or(t,e,n,r){if(e.length<=1)return n/2;const i=e[0],s=e[e.length-1],o=s-i;let l;switch(r){case"log":const u=i===0?.1:i;l=(Math.log(t===0?.1:t)-Math.log(u))/(Math.log(s)-Math.log(u));break;case"linear":l=(t-i)/o;break;case"equal":default:l=e.indexOf(t)/(e.length-1);break}return n-l*n}function Nq(t,e,n,r,i,s,o="equal"){const l=Array.from(new Set(t.map(y=>y.time))).sort((y,T)=>y-T),u=new Map(l.map((y,T)=>[y,T])),d=r*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h=d/(l.length-1||1),g=n*Be.PADDING_RATIO,_=n-2*g;if(t.forEach(y=>{y.timeIndex=u.get(y.time)??0}),i==="dagre"){console.log("Setting up dagre layout...");const y=new QN.graphlib.Graph;y.setGraph({rankdir:"TB",nodesep:50,ranksep:75,marginx:g,marginy:20,ranker:"network-simplex",acyclicer:"greedy",align:"UL"}),y.setDefaultEdgeLabel(()=>({})),t.forEach(P=>{y.setNode(P.id.toString(),{width:20,height:20,paddingLeft:5,paddingRight:5,paddingTop:5,paddingBottom:5})}),e.forEach(P=>{const N=typeof P.source=="number"?P.source:P.source.id,B=typeof P.target=="number"?P.target:P.target.id,z=t.find(W=>W.id===N),Q=t.find(W=>W.id===B);let H=1;z&&Q&&((z.is_sample||Q.is_sample)&&(H=3),Math.abs(z.time-Q.time)===1&&(H+=1)),y.setEdge(N.toString(),B.toString(),{weight:H})}),QN.layout(y);const T=t.filter(P=>P.is_sample);let w=1/0,x=-1/0;T.forEach(P=>{const N=y.node(P.id.toString());N&&(w=Math.min(w,N.x),x=Math.max(x,N.x))});const S=100,A=x-w,E=Math.min(A,S*(T.length-1))/A;t.forEach(P=>{const N=y.node(P.id.toString());if(N){const B=(N.x-w)*E+w;P.x=B,P.y=N.y,P.fx=P.x,P.fy=P.y}}),Cq(t,e,w,x);const C=new Set;let I=!0;const O=3;let M=0;for(;I&&M<O;){I=!1,M++;const P=t.filter(N=>!C.has(N.id)).sort((N,B)=>{const z=e.filter(H=>{const W=typeof H.source=="number"?H.source:H.source.id,q=typeof H.target=="number"?H.target:H.target.id;return W===N.id||q===N.id}).length;return e.filter(H=>{const W=typeof H.source=="number"?H.source:H.source.id,q=typeof H.target=="number"?H.target:H.target.id;return W===B.id||q===B.id}).length-z});for(const N of P){if(N.is_sample){C.add(N.id);continue}const B=s?Xx(N,s,t,e):5,z=vq(N,e,t,B,w,x);(z.x!==N.x||z.y!==N.y)&&(N.x=z.x,N.fx=z.x,N.y=z.y,N.fy=z.y,I=!0),C.add(N.id)}}console.log("Dagre layout complete. Node count:",t.length)}else{const y=t.filter(w=>w.is_sample),T=_/(y.length-1||1);y.sort((w,x)=>w.order_position!==void 0&&x.order_position!==void 0?w.order_position-x.order_position:w.order_position!==void 0?-1:x.order_position!==void 0?1:(x.degree??0)-(w.degree??0)),y.forEach((w,x)=>{w.x=g+x*T,w.fx=w.x,w.y=or(w.time,l,d,o),w.fy=w.y}),t.filter(w=>!w.is_sample).forEach(w=>{w.fx=null,w.fy=null,w.y=or(w.time,l,d,o)})}return{timeSpacing:h,uniqueTimes:l}}const kq=U.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,onEdgeClick:s,focalNode:o,nodeSizes:l=mq,sampleOrder:u="degree",edgeThickness:d=Be.EDGE_STROKE_WIDTH,temporalSpacingMode:h="equal"},g)=>{const{colors:_}=Ht(),y=U.useMemo(()=>t?`${t.nodes.length}-${t.edges.length}-${t.metadata.genomic_start||0}-${t.metadata.genomic_end||t.metadata.sequence_length}`:null,[t==null?void 0:t.nodes.length,t==null?void 0:t.edges.length,t==null?void 0:t.metadata.genomic_start,t==null?void 0:t.metadata.genomic_end,t==null?void 0:t.metadata.sequence_length]),T=U.useRef({data:null,key:null}),w=U.useMemo(()=>!t||!y?null:T.current.key===y&&T.current.data?T.current.data:(T.current={data:t,key:y},t),[t,y]);return U.useEffect(()=>{if(!g||typeof g=="function"||!g.current||!w)return;const x=g.current.getBoundingClientRect(),S=e||x.width||800,A=n||x.height||600,R=A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),{nodes:E,edges:C}=xq(w.nodes,w.edges);Array.from(new Set(E.map(Z=>Z.time))).sort((Z,D)=>Z-D),lr(g.current).selectAll("*").remove();const I=lr(g.current).attr("width",S).attr("height",A).attr("viewBox",[0,0,S,A]).attr("style","max-width: 100%; height: auto;"),O=I.append("g"),M=ez().scaleExtent([Be.ZOOM.MIN_SCALE,Be.ZOOM.MAX_SCALE]).on("zoom",Z=>{O.attr("transform",Z.transform)});I.call(M);const P=Eq(I,M,S,A,0),{uniqueTimes:N}=Nq(E,C,S,A,u,l,h);o&&P(o,E,C);const B=lr("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color",_.tooltipBackground).style("color",_.tooltipText).style("border",`1px solid ${_.border}`).style("padding","8px").style("border-radius","4px").style("font-size",Be.TOOLTIP_FONT_SIZE).style("pointer-events","none"),z=$5(E).alpha(u==="dagre"?0:Be.FORCE_STRENGTH.ALPHA_START).alphaDecay(u==="dagre"?1:Be.FORCE_STRENGTH.ALPHA_DECAY).velocityDecay(u==="dagre"?1:Be.FORCE_STRENGTH.VELOCITY_DECAY).force("link",u==="dagre"?null:j5(C).id(Z=>Z.id).distance(50).strength(Z=>{const D=typeof Z.source=="number"?E.find(F=>F.id===Z.source):Z.source,G=typeof Z.target=="number"?E.find(F=>F.id===Z.target):Z.target,oe=Pf(D,E,C),ie=Pf(G,E,C);return oe&&ie&&oe.id===ie.id?Be.FORCE_STRENGTH.LINK_SIBLING:D!=null&&D.is_sample||G!=null&&G.is_sample?Be.FORCE_STRENGTH.LINK_SAMPLE:Be.FORCE_STRENGTH.LINK_DEFAULT})).force("charge",u==="dagre"?null:H5().strength(Be.FORCE_STRENGTH.CHARGE)).force("x",u==="dagre"?null:W5(Z=>{if(Z.is_sample)return Z.x;const D=vf(Z,E,C),G=JN(Z,E,C);if(G.length>0){const oe=G.reduce((ie,F)=>ie+(F.x??0),0)/G.length;if(D){const ie=(oe+(D.min+D.max)/2)/2;return Math.max(D.min,Math.min(D.max,ie))}return oe}return D?(D.min+D.max)/2:Z.x??S/2}).strength(Be.FORCE_STRENGTH.X_POSITION)).force("y",X5(Z=>or(Z.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)).strength(u==="dagre"?1:Be.FORCE_STRENGTH.Y_POSITION)).force("collision",u==="dagre"?null:P5().radius(Be.COLLISION_RADIUS)),Q=O.append("g").selectAll("line").data(C).join("line").attr("stroke",`rgb(${_.edgeDefault[0]}, ${_.edgeDefault[1]}, ${_.edgeDefault[2]})`).attr("stroke-opacity",_.edgeDefault[3]/255).attr("stroke-width",d).attr("x1",Z=>{const D=typeof Z.source=="number"?E.find(G=>G.id===Z.source):Z.source;return(D==null?void 0:D.x)??0}).attr("y1",Z=>{const D=typeof Z.source=="number"?E.find(G=>G.id===Z.source):Z.source;return or(D.time,N,R,h)}).attr("x2",Z=>{const D=typeof Z.target=="number"?E.find(G=>G.id===Z.target):Z.target;return(D==null?void 0:D.x)??0}).attr("y2",Z=>{const D=typeof Z.target=="number"?E.find(G=>G.id===Z.target):Z.target;return or(D.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).on("click",(Z,D)=>s==null?void 0:s(D));function H(Z){Z.active||z.alphaTarget(Be.ZOOM.ALPHA_TARGET).restart(),Z.subject.fx=Z.subject.x,Z.subject.fy=or(Z.subject.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function W(Z){if(!w)return;const D=vf(Z.subject,E,C),G=JN(Z.subject,E,C);let oe=Z.x;if(D)oe=Math.max(D.min,Math.min(D.max,oe));else{const ie=S*Be.PADDING_RATIO;oe=Math.max(ie,Math.min(S-ie,oe))}if(G.length>0){const ie=G.reduce((F,$)=>F+($.x??0),0)/G.length;oe=Math.max(ie-Be.MAX_SIBLING_DISTANCE,Math.min(ie+Be.MAX_SIBLING_DISTANCE,oe))}Z.subject.fx=oe,Z.subject.fy=or(Z.subject.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}function q(Z){Z.active||z.alphaTarget(0),Z.subject.fx=null;const D=vf(Z.subject,E,C);let G=Z.subject.x??0;if(D)G=Math.max(D.min,Math.min(D.max,G));else{const oe=S*Be.PADDING_RATIO;G=Math.max(oe,Math.min(S-oe,G))}Z.subject.x=G,Z.subject.fy=or(Z.subject.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}const ee=O.append("g").selectAll("circle").data(E).join("circle").attr("r",Z=>Xx(Z,l,E,C)).attr("fill",Z=>Z.is_sample?`rgb(${_.nodeSample[0]}, ${_.nodeSample[1]}, ${_.nodeSample[2]})`:Z.is_combined?`rgb(${_.nodeCombined[0]}, ${_.nodeCombined[1]}, ${_.nodeCombined[2]})`:Ul(Z,E,C)?`rgb(${_.nodeRoot[0]}, ${_.nodeRoot[1]}, ${_.nodeRoot[2]})`:`rgb(${_.nodeDefault[0]}, ${_.nodeDefault[1]}, ${_.nodeDefault[2]})`).attr("stroke",Z=>Ul(Z,E,C)?`rgb(${_.nodeSelected[0]}, ${_.nodeSelected[1]}, ${_.nodeSelected[2]})`:Z.is_sample?_.background:"none").attr("stroke-width",Z=>Ul(Z,E,C)?Be.ROOT_NODE_STROKE_WIDTH:Z.is_sample?Be.SAMPLE_NODE_STROKE_WIDTH:0).style("cursor","pointer").call(I8().on("start",H).on("drag",W).on("end",q)).on("click",(Z,D)=>{Z.preventDefault(),r==null||r(D)}).on("contextmenu",(Z,D)=>{Z.preventDefault(),i==null||i(D)}).on("mouseover",(Z,D)=>{var oe;let G="";if(D.is_sample)G=`Sample node ${D.id}<br>Time: ${D.time}`;else if(D.is_combined)G=`Combined node ${D.id}<br>Contains nodes: ${(oe=D.combined_nodes)==null?void 0:oe.join(", ")}<br>Time: ${D.time}`;else if(Ul(D,E,C)){const ie=[...new Set(C.filter($=>{const Y=typeof $.source=="number"?E.find(ue=>ue.id===$.source):$.source;return(Y==null?void 0:Y.id)===D.id}).map($=>{const Y=typeof $.target=="number"?E.find(ue=>ue.id===$.target):$.target;return Y==null?void 0:Y.id}).filter($=>$!==void 0))].sort(($,Y)=>$-Y),F=wO(D,E,C).map($=>$.id).sort(($,Y)=>$-Y);G=`Root node ${D.id}<br>Time: ${D.time}`,ie.length>0&&(G+=`<br>Children: ${ie.join(", ")}`),F.length>0&&(G+=`<br>Descendant samples: ${F.join(", ")}`)}else{const ie=[...new Set(C.filter($=>{const Y=typeof $.target=="number"?E.find(ue=>ue.id===$.target):$.target;return(Y==null?void 0:Y.id)===D.id}).map($=>{const Y=typeof $.source=="number"?E.find(ue=>ue.id===$.source):$.source;return Y==null?void 0:Y.id}).filter($=>$!==void 0))].sort(($,Y)=>$-Y),F=[...new Set(C.filter($=>{const Y=typeof $.source=="number"?E.find(ue=>ue.id===$.source):$.source;return(Y==null?void 0:Y.id)===D.id}).map($=>{const Y=typeof $.target=="number"?E.find(ue=>ue.id===$.target):$.target;return Y==null?void 0:Y.id}).filter($=>$!==void 0))].sort(($,Y)=>$-Y);G=`Internal node ${D.id}<br>Time: ${D.time}`,ie.length>0&&(G+=`<br>Parents: ${ie.join(", ")}`),F.length>0&&(G+=`<br>Children: ${F.join(", ")}`)}if(D.individual!==void 0&&D.individual!==-1&&(G+=`<br>Individual: ${D.individual}`),D.location){const ie=D.location,F=ie.x>=-180&&ie.x<=180&&ie.y>=-90&&ie.y<=90&&(ie.x!==0||ie.y!==0);ie.z!==void 0?F?G+=`<br>Location: Lat: ${ie.y.toFixed(3)}, Lon: ${ie.x.toFixed(3)}, Z: ${ie.z.toFixed(2)}`:G+=`<br>Location: (${ie.x.toFixed(2)}, ${ie.y.toFixed(2)}, ${ie.z.toFixed(2)})`:F?G+=`<br>Location: Lat: ${ie.y.toFixed(3)}, Lon: ${ie.x.toFixed(3)}`:G+=`<br>Location: (${ie.x.toFixed(2)}, ${ie.y.toFixed(2)})`}B.style("visibility","visible").html(G).style("left",Z.pageX+10+"px").style("top",Z.pageY-10+"px")}).on("mousemove",Z=>{B.style("left",Z.pageX+10+"px").style("top",Z.pageY-10+"px")}).on("mouseout",()=>{B.style("visibility","hidden")}),de=O.append("g").selectAll("text").data(E.filter(Z=>Z.is_sample)).join("text").text(Z=>Z.id.toString()).attr("font-size",Z=>`${l.sample*1.2}px`).attr("fill",_.text).attr("text-anchor","middle").attr("dx",0).attr("dy",Z=>Xx(Z,l,E,C)+12);return z.on("tick",()=>{w&&(z.alpha()>Be.PERFORMANCE.ALPHA_THRESHOLD&&E.forEach(Z=>{Z.is_sample||_q(Z,E,C)}),Q.attr("x1",Z=>{const D=typeof Z.source=="number"?E.find(G=>G.id===Z.source):Z.source;return(D==null?void 0:D.x)??0}).attr("y1",Z=>{const D=typeof Z.source=="number"?E.find(G=>G.id===Z.source):Z.source;return or(D.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}).attr("x2",Z=>{const D=typeof Z.target=="number"?E.find(G=>G.id===Z.target):Z.target;return(D==null?void 0:D.x)??0}).attr("y2",Z=>{const D=typeof Z.target=="number"?E.find(G=>G.id===Z.target):Z.target;return or(D.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)}),ee.attr("cx",Z=>Z.x??0).attr("cy",Z=>or(Z.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)),de.attr("x",Z=>Z.x??0).attr("y",Z=>or(Z.time,N,A*(1-Be.LAYOUT.BOTTOM_MARGIN_RATIO),h)))}),()=>{z&&z.stop(),B&&B.remove()}},[w,e,n,r,i,s,o,l,g,u,d,h]),m.jsx("div",{className:"w-full h-full",children:m.jsx("svg",{ref:g,className:"w-full h-full"})})}),Mq=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,genomicRange:o,sequenceLength:l,isFiltered:u=!1,isFilterSectionCollapsed:d=!0})=>{const{colors:h}=Ht(),[g,_]=U.useState(!0),y=t&&n?(n/t*100).toFixed(1):null,T=e&&r?(r/e*100).toFixed(1):null;if(!(t||n||i))return null;const x=S=>S>=1e6?`${(S/1e6).toFixed(1)}M`:S>=1e3?`${(S/1e3).toFixed(1)}K`:S.toString();return m.jsxs("div",{className:"absolute top-4 right-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${h.background}F0`,borderColor:h.border,color:h.text},children:[m.jsxs("div",{onClick:()=>_(!g),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:g?"transparent":`${h.containerBackground}80`},onMouseEnter:S=>{g||(S.currentTarget.style.backgroundColor=`${h.border}40`)},onMouseLeave:S=>{g||(S.currentTarget.style.backgroundColor=`${h.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:h.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${g?"rotate-180":""}`,style:{color:h.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:h.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:h.text},children:[n.toLocaleString()," nodes (",y,"%), ",r.toLocaleString()," edges (",T,"%)"]})]}),i&&s&&(i!==n||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:h.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:h.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),u&&o&&l&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Filter Information"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Range:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[0])," - ",x(o[1])]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Length:"}),m.jsxs("span",{style:{color:h.text},children:[x(o[1]-o[0])," bp"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:h.accentPrimary},children:"Coverage:"}),m.jsxs("span",{style:{color:h.text},children:[((o[1]-o[0])/l*100).toFixed(1),"% of sequence"]})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${h.text}CC`},children:[m.jsx("div",{children:" Drag: Pan view"}),m.jsx("div",{children:" Scroll: Zoom in/out"}),m.jsx("div",{children:" Left click: Select node"}),m.jsx("div",{children:" Right click: Show ancestors"}),m.jsx("div",{children:" Drag nodes to reposition"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:h.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]})`,borderColor:h.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:h.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${h.nodeCombined[0]}, ${h.nodeCombined[1]}, ${h.nodeCombined[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]})`,borderColor:`rgb(${h.nodeSelected[0]}, ${h.nodeSelected[1]}, ${h.nodeSelected[2]})`}}),m.jsx("span",{style:{color:h.text},children:"Root Nodes"})]})]})]})]})]})},Iq=[{value:"degree",label:"Degree",description:"Order by node connectivity (current default)"},{value:"center_minlex",label:"Center Tree",description:"Minlex postorder of tree at center genomic position"},{value:"first_tree",label:"First Tree",description:"Minlex postorder of first tree"},{value:"custom",label:"Consensus",description:"Majority vote across multiple trees"},{value:"numeric",label:"Numeric",description:"Simple numeric order (0, 1, 2, ...)"},{value:"dagre",label:"Layer-based",description:"Order nodes in each layer using dagre-d3 algorithm"}],Oq=({value:t,onChange:e,className:n=""})=>{const{colors:r}=Ht();return m.jsxs("div",{className:`flex items-center gap-2 ${n}`,children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Sample Order:"}),m.jsx("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:Iq.map(i=>m.jsx("button",{onClick:()=>e(i.value),className:"px-3 py-1 text-xs font-medium transition-colors whitespace-nowrap",style:{backgroundColor:t===i.value?r.textSecondary:r.containerBackground,color:t===i.value?r.background:r.text},title:i.description,children:i.label},i.value))})]})},Pq=({sampleOrder:t,onSampleOrderChange:e,nodeSizes:n,onNodeSizeChange:r,edgeThickness:i,onEdgeThicknessChange:s,temporalSpacing:o,onTemporalSpacingChange:l,temporalSpacingMode:u,onTemporalSpacingModeChange:d,isLoading:h=!1})=>{const{colors:g}=Ht(),[_,y]=U.useState(!0);return m.jsxs("div",{className:"absolute top-4 left-4 border rounded-lg shadow-lg z-20",style:{backgroundColor:`${g.background}F0`,borderColor:g.border,color:g.text},children:[m.jsxs("div",{onClick:()=>y(!_),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:_?"transparent":`${g.containerBackground}80`},onMouseEnter:T=>{_||(T.currentTarget.style.backgroundColor=`${g.border}40`)},onMouseLeave:T=>{_||(T.currentTarget.style.backgroundColor=`${g.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:g.text},children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})}),"Graph Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${_?"rotate-180":""}`,style:{color:g.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Temporal Spacing"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:()=>d("equal"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="equal"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="equal"?g.accentPrimary:`${g.border}40`,color:u==="equal"?g.background:g.text},children:"Equal"}),m.jsx("button",{onClick:()=>d("log"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="log"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="log"?g.accentPrimary:`${g.border}40`,color:u==="log"?g.background:g.text},children:"Log"}),m.jsx("button",{onClick:()=>d("linear"),className:`px-3 py-1 text-xs rounded-md transition-colors ${u==="linear"?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,style:{backgroundColor:u==="linear"?g.accentPrimary:`${g.border}40`,color:u==="linear"?g.background:g.text},children:"Linear"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("label",{className:"text-xs font-medium",style:{color:g.text},children:["Spacing: ",o]})}),m.jsx("input",{type:"range",min:5,max:50,step:1,value:o,onChange:T=>l(Number(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(o-5)/45*100}%, ${g.border} ${(o-5)/45*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"text-xs",style:{color:`${g.text}CC`},children:[u==="equal"&&m.jsx("div",{children:" Time points are spaced equally"}),u==="log"&&m.jsx("div",{children:" Time points are spaced logarithmically based on their actual values"}),u==="linear"&&m.jsx("div",{children:" Time points are spaced according to their actual time values"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Sample Order"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Oq,{value:t,onChange:e}),h&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:g.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:g.text},children:"Updating sample order..."})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Node Sizes"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Sample Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.sample,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.sample,onChange:T=>r({...n,sample:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.sample-3)/12*100}%, ${g.border} ${(n.sample-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Root Nodes"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.root,"px"]})]}),m.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:n.root,onChange:T=>r({...n,root:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.root-3)/12*100}%, ${g.border} ${(n.root-3)/12*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Internal & Combined"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[n.other,"px"]})]}),m.jsx("input",{type:"range",min:"2",max:"10",step:"1",value:n.other,onChange:T=>r({...n,other:parseInt(T.target.value)}),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(n.other-2)/8*100}%, ${g.border} ${(n.other-2)/8*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Edge Thickness"}),m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:g.text},children:"Edge Width"}),m.jsxs("span",{className:"text-xs",style:{color:g.text},children:[i,"px"]})]}),m.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.5",value:i,onChange:T=>s(parseFloat(T.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${g.accentPrimary} 0%, ${g.accentPrimary} ${(i-.5)/2.5*100}%, ${g.border} ${(i-.5)/2.5*100}%, ${g.border} 100%)`,accentColor:g.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:g.text},children:"Graph Layout"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${g.text}CC`},children:[m.jsx("div",{children:" Sample nodes are positioned based on the selected order"}),m.jsx("div",{children:" Internal nodes position themselves relative to descendants"}),m.jsx("div",{children:" Drag nodes to manually adjust positions"}),m.jsx("div",{children:" Use zoom and pan to navigate the graph"})]})]})]})]})},TO=({min:t,max:e,step:n=1,value:r,onChange:i,formatValue:s=l=>l.toString(),className:o=""})=>{const{colors:l}=Ht(),[u,d]=U.useState(null),[h,g]=U.useState({x:0,startValue:[0,0]}),[_,y]=U.useState(!1),[T,w]=U.useState(null),x=U.useRef(null);U.useEffect(()=>{const M=N=>{if(N.key==="Shift"){if(y(!0),T===null){const B=Math.abs(r[1]-r[0]);w(Math.max(B,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},P=N=>{N.key==="Shift"&&(y(!1),w(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",M),document.addEventListener("keyup",P),()=>{document.removeEventListener("keydown",M),document.removeEventListener("keyup",P),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,T,n]);const S=U.useCallback(M=>{if(!x.current)return t;const P=x.current.getBoundingClientRect(),N=Math.max(0,Math.min(1,(M-P.left)/P.width)),B=t+N*(e-t);return Math.round(B/n)*n},[t,e,n]),A=U.useCallback(M=>(M-t)/(e-t)*100,[t,e]),R=U.useCallback((M,P)=>{M.preventDefault(),M.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",d(P),g({x:M.clientX,startValue:r})},[r]),E=U.useCallback(M=>{if(!u||!x.current)return;const P=S(M.clientX),[N,B]=r;if(u==="left"){const z=Math.min(P,B-n);i([Math.max(t,z),B])}else if(u==="right"){const z=Math.max(P,N+n);i([N,Math.min(e,z)])}else if(u==="range"){const z=M.clientX-h.x,Q=x.current.getBoundingClientRect(),H=z/Q.width*(e-t),[W,q]=h.startValue;let ee=Math.abs(q-W);_&&T!==null&&(ee=T);const Z=(W+q)/2+H;let D,G;_&&T!==null?(D=Z-ee/2,G=Z+ee/2):(D=W+H,G=q+H),D<t&&(D=t,G=t+ee),G>e&&(G=e,D=e-ee),i([Math.round(D/n)*n,Math.round(G/n)*n])}},[u,r,i,S,t,e,n,h,_,T]),C=U.useCallback(()=>{d(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(u)return document.addEventListener("mousemove",E),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",C)}},[u,E,C]);const I=A(r[0]),O=A(r[1]);return m.jsxs("div",{className:`relative w-full ${o}`,style:{userSelect:"none"},children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:l.text},children:[m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(r[1])})]}),m.jsxs("div",{ref:x,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:l.containerBackground},onMouseDown:M=>{const P=S(M.clientX),[N,B]=r,z=Math.abs(P-N),Q=Math.abs(P-B);_||Math.abs(B-N)<n*2?R(M,"range"):z<Q?R(M,"left"):R(M,"right")},children:[m.jsx("div",{className:`absolute h-full rounded-full transition-opacity ${_?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{left:`${I}%`,width:`${O-I}%`,backgroundColor:_?l.text:l.textSecondary,opacity:_?.8:1,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"range")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${I}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"left")}}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${O}%`,top:"50%",backgroundColor:l.background,borderColor:l.textSecondary,userSelect:"none"},onMouseDown:M=>{M.preventDefault(),M.stopPropagation(),R(M,"right")}})]}),m.jsxs("div",{className:"flex justify-between items-center mt-1 text-xs",style:{color:l.text},children:[m.jsx("span",{children:s(t)}),m.jsx("div",{className:"flex items-center justify-center",children:_&&m.jsx("div",{className:"px-2 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:l.textSecondary,color:l.background,fontSize:"10px"},children:"Fixed Size"})}),m.jsx("span",{children:s(e)})]})]})},SO=({treeIntervals:t,value:e,onChange:n,className:r=""})=>{const{colors:i}=Ht(),[s,o]=U.useState(null),[l,u]=U.useState({x:0,startValue:[0,0]}),d=U.useRef(null);if(!t||t.length===0)return null;const h=0,g=t.length-1,_=t[g].right-t[0].left,y=U.useCallback(O=>{if(!d.current)return h;const M=d.current.getBoundingClientRect(),P=Math.max(0,Math.min(1,(O-M.left)/M.width)),N=t[0].left+P*_;for(let B=0;B<t.length;B++){const z=t[B],Q=(z.left+z.right)/2;if(B===t.length-1||N<=Q)return B}return g},[t,_]),T=U.useCallback(O=>{if(O<0||O>=t.length)return 0;const M=t[O];return((M.left+M.right)/2-t[0].left)/_*100},[t,_]),w=U.useCallback(O=>{if(O<0||O>=t.length)return"Invalid";const M=t[O];return`Tree ${O} (${M.left.toFixed(1)}-${M.right.toFixed(1)})`},[t]),x=U.useCallback((O,M)=>{if(O<0||M>=t.length||O>M)return"Invalid range";const P=t[O].left,N=t[M].right,B=N-P;return`${(Q=>Q>=1e6?`${(Q/1e6).toFixed(1)}M`:Q>=1e3?`${(Q/1e3).toFixed(1)}K`:Q.toFixed(1))(B)} bp (${P.toFixed(1)}-${N.toFixed(1)})`},[t]),S=U.useCallback((O,M)=>{O.preventDefault(),o(M),u({x:O.clientX,startValue:e})},[e]),A=U.useCallback(O=>{if(!s||!d.current)return;const M=y(O.clientX),[P,N]=e;if(s==="left")M<=N?n([Math.max(h,Math.min(g,M)),N]):n([N,Math.max(h,Math.min(g,M))]);else if(s==="right")M>=P?n([P,Math.max(h,Math.min(g,M))]):n([Math.max(h,Math.min(g,M)),P]);else if(s==="range"){const B=O.clientX-l.x,z=d.current.getBoundingClientRect(),H=B/z.width*_,[W,q]=l.startValue,ee=(t[W].left+t[W].right)/2,de=(t[q].left+t[q].right)/2,Z=ee+H,D=de+H;let G=W,oe=q;for(let F=0;F<t.length;F++){const $=(t[F].left+t[F].right)/2;if(Z<=$||F===t.length-1){G=F;break}}for(let F=0;F<t.length;F++){const $=(t[F].left+t[F].right)/2;if(D<=$||F===t.length-1){oe=F;break}}G=Math.max(h,Math.min(g,G)),oe=Math.max(h,Math.min(g,oe));const ie=q-W;G!==oe&&Math.abs(oe-G)!==ie&&(G+ie<=g?oe=G+ie:oe-ie>=h&&(G=oe-ie)),n([G,oe])}},[s,e,n,y,h,g,l,_,t]),R=U.useCallback(()=>{o(null)},[]);U.useEffect(()=>{if(s)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",R),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R)}},[s,A,R]);const E=T(e[0]),C=T(e[1]),I=e[1]-e[0]+1;return m.jsxs("div",{className:`relative w-full ${r}`,children:[m.jsxs("div",{className:"flex justify-between mb-2 text-sm",style:{color:i.text},children:[m.jsx("span",{children:w(e[0])}),m.jsx("span",{children:w(e[1])})]}),m.jsxs("div",{ref:d,className:"relative h-2 rounded-full cursor-pointer",style:{backgroundColor:i.containerBackground},onMouseDown:O=>{const M=y(O.clientX),[P,N]=e,B=Math.abs(M-P),z=Math.abs(M-N);B<z?S(O,"left"):S(O,"right")},children:[m.jsx("div",{className:"absolute h-full rounded-full cursor-grab active:cursor-grabbing",style:{left:`${E}%`,width:`${C-E}%`,backgroundColor:i.textSecondary},onMouseDown:O=>S(O,"range")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${E}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:O=>S(O,"left")}),m.jsx("div",{className:"absolute w-4 h-4 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{left:`${C}%`,top:"50%",backgroundColor:i.background,borderColor:i.textSecondary},onMouseDown:O=>S(O,"right")})]}),m.jsxs("div",{className:"flex justify-between mt-1 text-xs",style:{color:i.text},children:[m.jsx("span",{children:"Tree 0"}),m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{children:[I," tree",I!==1?"s":""," selected"]}),m.jsx("div",{style:{color:i.textSecondary},children:x(e[0],e[1])})]}),m.jsxs("span",{children:["Tree ",g]})]})]})},Dq=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u===o&&!i.has(d)&&(r.add(d),s.push(d))}))}return r},jq=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),n.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id;(typeof l.target=="number"?l.target:l.target.id)===o&&!i.has(u)&&(r.add(u),s.push(u))}))}return r},Lq=1,Bq={nodeSizes:{sample:8,root:6,other:5},edgeThickness:1,temporalSpacingMode:"equal"},Uq=U.forwardRef(({filename:t,max_samples:e=25},n)=>{var _r,Lt,Bt,Nn,vr,Zn;const{colors:r}=Ht(),{treeSequence:i}=Hs(),[s,o]=U.useState(null),[l,u]=U.useState(null),[d,h]=U.useState(null),[g,_]=U.useState(!0),[y,T]=U.useState("full"),[w,x]=U.useState(null),[S,A]=U.useState([0,0]),[R,E]=U.useState(0),[C,I]=U.useState(!1),[O,M]=U.useState([0,0]),[P,N]=U.useState(!1),[B,z]=U.useState(!1),[Q,H]=U.useState("genomic"),[W,q]=U.useState([0,0]),[ee,de]=U.useState([0,0]),[Z,D]=U.useState(!1),[G,oe]=U.useState([]),[ie,F]=U.useState(!1),[$,Y]=U.useState("degree"),[ue,ye]=U.useState(!0),[Se,ke]=U.useState({sample:8,root:6,other:5}),[Ue,yt]=U.useState(Lq),[We,Fe]=U.useState(!1),[De,Jt]=U.useState(Bq),[Ne,xn]=U.useState(!1),Xt=U.useCallback(we=>we.map(([st,Et,tt])=>({index:st,left:Et,right:tt})),[]);U.useEffect(()=>{ie&&Q==="genomic"&&N(!0);const we=setTimeout(()=>{M(S),N(!1)},500);return()=>clearTimeout(we)},[S,ie,Q]),U.useEffect(()=>{ie&&Q==="tree"&&D(!0);const we=setTimeout(()=>{de(W),D(!1)},500);return()=>clearTimeout(we)},[W,ie,Q]),U.useEffect(()=>{const we=async()=>{try{_(!0),console.log("Fetching initial graph data for file:",t,"with max_samples:",e);const Et=(await mt.getGraphData(t,{maxSamples:e,sampleOrder:$})).data;if(console.log("Received initial graph data:",Et),Et.metadata.sequence_length){E(Et.metadata.sequence_length);const tt=[0,Et.metadata.sequence_length];A(tt),M(tt)}if(Et.metadata.tree_intervals&&Et.metadata.tree_intervals.length>0){const tt=Xt(Et.metadata.tree_intervals);oe(tt);const bt=[0,tt.length-1];q(bt),de(bt)}z(!0),o(Et),u(Et),h(null)}catch(st){console.error("Error fetching initial graph data:",st),h(st instanceof Error?st.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}};z(!1),F(!1),we()},[t,e,Xt]),U.useEffect(()=>{if(!B)return;let we=!1,st=null,Et=null;if(ie&&(Q==="genomic"?O[0]===0&&O[1]===R||(we=!0,st={genomic_start:O[0],genomic_end:O[1]}):Q==="tree"&&!(ee[0]===0&&ee[1]===G.length-1)&&G.length>0&&(we=!0,Et={tree_start_idx:ee[0],tree_end_idx:ee[1]})),!we)if(!s||s.metadata.sample_order!==$)we=!0,console.log("Making API call due to sample order change");else{console.log("Skipping API call - using existing data (full range or filter disabled)");return}(async()=>{try{_(!0);let bt={maxSamples:e,sampleOrder:$};st?(console.log("Fetching filtered graph data for genomic range:",O),bt.genomicStart=st.genomic_start,bt.genomicEnd=st.genomic_end):Et?(console.log("Fetching filtered graph data for tree range:",ee),bt.treeStartIdx=Et.tree_start_idx,bt.treeEndIdx=Et.tree_end_idx):console.log("Fetching unfiltered graph data");const Co=(await mt.getGraphData(t,bt)).data;console.log("Received graph data:",Co),o(Co),h(null)}catch(bt){console.error("Error fetching graph data:",bt),h(bt instanceof Error?bt.message:"An error occurred while fetching graph data"),o(null)}finally{_(!1)}})()},[t,e,O,ee,ie,Q,B,R,G,$]),U.useEffect(()=>{ie||ye(!0)},[ie]);const Cn=()=>{if(!s||!w)return s;switch(y){case"subgraph":{const we=Dq(w,s.nodes,s.edges);we.add(w.id);const st=s.nodes.filter(tt=>we.has(tt.id)),Et=s.edges.filter(tt=>{const bt=typeof tt.source=="number"?tt.source:tt.source.id,ea=typeof tt.target=="number"?tt.target:tt.target.id;return we.has(bt)&&we.has(ea)});return{...s,nodes:st,edges:Et,metadata:{...s.metadata,is_subset:!0}}}case"ancestors":{const we=jq(w,s.nodes,s.edges);we.add(w.id);const st=s.nodes.filter(tt=>we.has(tt.id)),Et=s.edges.filter(tt=>{const bt=typeof tt.source=="number"?tt.source:tt.source.id,ea=typeof tt.target=="number"?tt.target:tt.target.id;return we.has(bt)&&we.has(ea)});return{...s,nodes:st,edges:Et,metadata:{...s.metadata,is_subset:!0}}}default:return s}},jt=()=>{if(!l||!s||!i)return null;const we=Cn();return we?{originalNodes:s.metadata.original_num_nodes||i.num_nodes,originalEdges:s.metadata.original_num_edges||i.num_edges,subArgNodes:l.nodes.length,subArgEdges:l.edges.length,displayedNodes:we.nodes.length,displayedEdges:we.edges.length}:null},fn=we=>{y==="full"?(x(we),T("subgraph")):(w==null?void 0:w.id)===we.id?(T("full"),x(null)):(x(we),T("subgraph"))},Ye=we=>{x(we),T("ancestors")},xe=we=>{console.log("Edge clicked:",we)},Re=()=>{T("full"),x(null)},et=U.useCallback(we=>{(we[0]!==S[0]||we[1]!==S[1])&&A(we)},[S]),Ve=U.useCallback(we=>{(we[0]!==W[0]||we[1]!==W[1])&&q(we)},[W]),Ke=U.useCallback(()=>{const we=!ie;if(F(we),we){if(Q==="genomic")A([0,R]),M([0,R]);else if(Q==="tree"&&G.length>0){const st=[0,G.length-1];q(st),de(st)}ye(!1)}else ye(!0)},[ie,Q,R,G]),vt=U.useCallback(we=>{if(H(we),we==="genomic")A([0,R]),M([0,R]);else if(we==="tree"&&G.length>0){const st=[0,G.length-1];q(st),de(st)}},[R,G]),dn=U.useCallback(we=>we>=1e6?`${(we/1e6).toFixed(1)}M`:we>=1e3?`${(we/1e3).toFixed(1)}K`:we.toString(),[]),Yr=()=>{let we="";switch(y){case"subgraph":we=`SubARG at Root ${w==null?void 0:w.id}`;break;case"ancestors":we=`Parent ARG of Node ${w==null?void 0:w.id}`;break;default:we="Full ARG"}return ie&&(s==null?void 0:s.metadata.genomic_start)!==void 0&&(s==null?void 0:s.metadata.genomic_end)!==void 0&&(we+=` (${dn(s.metadata.genomic_start)} - ${dn(s.metadata.genomic_end)})`),we};return g?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:r.accentPrimary}}),m.jsx("p",{style:{color:r.text},children:"Loading force-directed ARG visualization..."})]})}):d?m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:r.background},children:m.jsxs("div",{className:"text-center",style:{color:r.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${r.text}B3`},children:d})]})}):m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:r.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:m.jsx("div",{className:"px-4 py-2",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:r.headerText},children:Yr()}),(R>0||G.length>0)&&m.jsx("div",{className:"flex items-center gap-4",children:R>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:r.headerText},children:[m.jsx("input",{type:"checkbox",checked:ie,onChange:Ke,className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:r.accentPrimary}}),"Filter Genomic Range"]})}),y!=="full"&&m.jsx("button",{onClick:Re,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:r.containerBackground,color:r.text,borderColor:`${r.accentPrimary}33`},onMouseEnter:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}66`,we.currentTarget.style.backgroundColor=`${r.containerBackground}CC`},onMouseLeave:we=>{we.currentTarget.style.borderColor=`${r.accentPrimary}33`,we.currentTarget.style.backgroundColor=r.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[ie&&m.jsxs("button",{onClick:()=>ye(!ue),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:r.accentPrimary,color:r.background},onMouseEnter:we=>{we.currentTarget.style.opacity="0.8"},onMouseLeave:we=>{we.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:ue?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${ue?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:r.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${r.nodeSample[0]}, ${r.nodeSample[1]}, ${r.nodeSample[2]})`,borderColor:r.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeDefault[0]}, ${r.nodeDefault[1]}, ${r.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${r.nodeCombined[0]}, ${r.nodeCombined[1]}, ${r.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${r.nodeRoot[0]}, ${r.nodeRoot[1]}, ${r.nodeRoot[2]})`,borderColor:`rgb(${r.nodeSelected[0]}, ${r.nodeSelected[1]}, ${r.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:r.headerText,borderLeftColor:r.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})})}),ie&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:r.background,borderBottomColor:r.border},children:!ue&&m.jsx("div",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsx("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:G.length>0&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:r.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:r.containerBackground},children:[m.jsx("button",{onClick:()=>vt("genomic"),className:`px-3 py-1 text-xs font-medium transition-colors ${Q==="genomic"?"":"hover:opacity-80"}`,style:{backgroundColor:Q==="genomic"?r.accentPrimary:r.containerBackground,color:Q==="genomic"?r.background:r.text},children:"Genomic"}),m.jsx("button",{onClick:()=>vt("tree"),className:`px-3 py-1 text-xs font-medium transition-colors ${Q==="tree"?"":"hover:opacity-80"}`,style:{backgroundColor:Q==="tree"?r.accentPrimary:r.containerBackground,color:Q==="tree"?r.background:r.text},children:"Tree Index"})]})]})}),m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:Q==="genomic"&&R>0?m.jsx(TO,{min:0,max:R,step:Math.max(1,Math.floor(R/1e3)),value:S,onChange:et,formatValue:dn,className:"w-full"}):Q==="tree"&&G.length>0?m.jsx(SO,{treeIntervals:G,value:W,onChange:Ve,className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:r.text},children:[Q==="genomic"?m.jsxs("span",{children:[dn(S[1]-S[0])," bp (",((S[1]-S[0])/R*100).toFixed(1),"%)",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",s.metadata.num_local_trees," trees"]})]}):Q==="tree"&&G.length>0?m.jsxs("span",{children:["Trees ",W[0],"-",W[1]," (",W[1]-W[0]+1," of ",G.length,")",(s==null?void 0:s.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",s.metadata.expected_tree_count??s.metadata.num_local_trees," displayed"]}),(s==null?void 0:s.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:["  (actual: ",s.metadata.num_local_trees,")"]})]}):null,g&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:r.accentPrimary}})]})]})]})})}),m.jsx("div",{className:"flex-1 overflow-hidden",children:m.jsxs("div",{className:"w-full h-full relative",children:[m.jsx(kq,{ref:n,data:Cn(),onNodeClick:fn,onNodeRightClick:Ye,onEdgeClick:xe,focalNode:w,nodeSizes:Se,sampleOrder:$,edgeThickness:Ue,temporalSpacingMode:De.temporalSpacingMode}),m.jsx(Pq,{sampleOrder:$,onSampleOrderChange:Y,nodeSizes:Se,onNodeSizeChange:we=>ke(we),edgeThickness:Ue,onEdgeThicknessChange:we=>yt(we),temporalSpacingMode:De.temporalSpacingMode,onTemporalSpacingModeChange:we=>Jt(st=>({...st,temporalSpacingMode:we})),isLoading:Ne}),m.jsx(Mq,{originalNodeCount:(_r=jt())==null?void 0:_r.originalNodes,originalEdgeCount:(Lt=jt())==null?void 0:Lt.originalEdges,subargNodeCount:(Bt=jt())==null?void 0:Bt.subArgNodes,subargEdgeCount:(Nn=jt())==null?void 0:Nn.subArgEdges,displayedNodeCount:(vr=jt())==null?void 0:vr.displayedNodes,displayedEdgeCount:(Zn=jt())==null?void 0:Zn.displayedEdges,genomicRange:ie?S:void 0,sequenceLength:R,isFiltered:ie,isFilterSectionCollapsed:ue})]})})]})});function Fq(t){const e=t.querySelectorAll("circle, line, path, text, rect, ellipse, polygon, polyline");let n=1/0,r=-1/0,i=1/0,s=-1/0;if(e.forEach(u=>{try{const d=u.getBBox();d.width>0&&d.height>0&&(n=Math.min(n,d.x),r=Math.max(r,d.x+d.width),i=Math.min(i,d.y),s=Math.max(s,d.y+d.height))}catch(d){console.warn("Could not get bounding box for element:",u,d)}}),n===1/0){const u=t.viewBox.baseVal;n=u.x,i=u.y,r=u.x+u.width,s=u.y+u.height}const o=r-n,l=s-i;return{minX:n,maxX:r,minY:i,maxY:s,width:o,height:l,centerX:n+o/2,centerY:i+l/2}}async function zq(t,e){const{filename:n,padding:r=50,maxWidth:i=8192,maxHeight:s=8192,backgroundColor:o="#03303E",scale:l=3,watermark:u}=e;try{const d=Fq(t),h=d.width+r*2,g=d.height+r*2,_=Math.min(i/h,s/g),y=Math.min(l,_),T=Math.round(h*y),w=Math.round(g*y),x=t.cloneNode(!0);x.removeAttribute("transform");const S=d.minX-r,A=d.minY-r;x.setAttribute("viewBox",`${S} ${A} ${h} ${g}`),x.setAttribute("width",T.toString()),x.setAttribute("height",w.toString()),x.setAttribute("shape-rendering","geometricPrecision"),x.setAttribute("text-rendering","geometricPrecision"),x.setAttribute("xmlns","http://www.w3.org/2000/svg"),x.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const R=document.createElementNS("http://www.w3.org/2000/svg","rect");R.setAttribute("x",S.toString()),R.setAttribute("y",A.toString()),R.setAttribute("width",h.toString()),R.setAttribute("height",g.toString()),R.setAttribute("fill",o),R.setAttribute("stroke","none"),x.insertBefore(R,x.firstChild),x.querySelectorAll("*").forEach(z=>{const Q=window.getComputedStyle(z),H=z.getAttribute("style")||"";["fill","stroke","stroke-width","stroke-opacity","fill-opacity","opacity"].forEach(q=>{const ee=q.replace(/([A-Z])/g,"-$1").toLowerCase(),de=Q.getPropertyValue(ee);de&&de!=="none"&&!z.hasAttribute(ee)&&z.setAttribute(ee,de)})});const C=new XMLSerializer().serializeToString(x),I=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),O=URL.createObjectURL(I),M=document.createElement("canvas");M.width=T,M.height=w;const P=M.getContext("2d",{alpha:!1});if(!P)throw new Error("Could not get canvas context");P.imageSmoothingEnabled=!0,P.imageSmoothingQuality="high",P.fillStyle=o,P.fillRect(0,0,T,w);const N=new Image,B=setTimeout(()=>{throw URL.revokeObjectURL(O),new Error("SVG loading timed out")},1e4);N.onload=()=>{clearTimeout(B);try{P.fillStyle=o,P.fillRect(0,0,T,w),P.globalCompositeOperation="source-over",P.drawImage(N,0,0,T,w),u&&T1(P,T,w,u),M.toBlob(z=>{if(!z)throw new Error("Failed to create image blob");w1(z,n)},"image/png",1),URL.revokeObjectURL(O)}catch(z){throw URL.revokeObjectURL(O),new Error(`Failed to draw SVG to canvas: ${z}`)}},N.onerror=z=>{throw clearTimeout(B),URL.revokeObjectURL(O),new Error(`Failed to load SVG image: ${z}`)},N.crossOrigin="anonymous",N.src=O}catch(d){throw console.error("Error exporting SVG image:",d),d}}async function qq(t,e,n){var d,h,g,_;const{filename:r,maxWidth:i=4096,maxHeight:s=4096,backgroundColor:o="#03303E",scale:l=2,watermark:u}=n;try{if(!e.current||!t.nodes.length)throw new Error("No 3D visualization data available for export");const{bounds:y,currentViewState:T}=t,w=(y.minX+y.maxX)/2,x=(y.minY+y.maxY)/2,S=(y.minZ+y.maxZ)/2,A=y.maxX-y.minX,R=y.maxY-y.minY,E=y.maxZ-y.minZ,C=Math.max(A,R,E),O=Math.max(.1,Math.min(3,1/(C*1.3)));let M=null;if((h=(d=e.current)==null?void 0:d.deck)!=null&&h.canvas)M=e.current.deck.canvas;else if((g=e.current)!=null&&g.canvas)M=e.current.canvas;else{const ee=((_=e.current)==null?void 0:_.domElement)||e.current;ee&&(M=ee.querySelector("canvas"))}if(!M)throw new Error("Could not access DeckGL canvas - trying fallback method");const P={...T},N={...T,target:[w,x,S],zoom:O},B=M.width/M.height;let z=Math.min(i,2048*l),Q=Math.min(s,z/B);Q>s&&(Q=s,z=Q*B),z=Math.round(z),Q=Math.round(Q);const H=M.width,W=M.height,q={width:M.style.width,height:M.style.height};try{M.width=z,M.height=Q,M.style.width=`${z}px`,M.style.height=`${Q}px`,e.current.setProps({width:z,height:Q,viewState:N}),await new Promise(Z=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(Z,200)})})});const ee=document.createElement("canvas");ee.width=z,ee.height=Q;const de=ee.getContext("2d");if(!de)throw new Error("Could not get export canvas context");de.imageSmoothingEnabled=!0,de.imageSmoothingQuality="high",de.fillStyle=o,de.fillRect(0,0,z,Q),de.drawImage(M,0,0),u&&T1(de,z,Q,u),ee.toBlob(Z=>{if(!Z)throw new Error("Failed to create image blob");w1(Z,r)},"image/png",1)}finally{M.width=H,M.height=W,M.style.width=q.width,M.style.height=q.height,e.current.setProps({width:H,height:W,viewState:P}),await new Promise(ee=>{requestAnimationFrame(()=>{requestAnimationFrame(ee)})})}}catch(y){throw console.error("Error exporting 3D visualization image:",y),y}}async function Vq(t,e){const{filename:n,maxWidth:r=4096,maxHeight:i=4096,backgroundColor:s="#03303E",scale:o=2,watermark:l}=e;try{await new Promise(_=>requestAnimationFrame(_));const u=Math.min(r,t.width*o),d=Math.min(i,t.height*o),h=document.createElement("canvas");h.width=u,h.height=d;const g=h.getContext("2d");if(!g)throw new Error("Could not get canvas context");g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.fillStyle=s,g.fillRect(0,0,u,d),g.drawImage(t,0,0,u,d),l&&T1(g,u,d,l),h.toBlob(_=>{if(!_)throw new Error("Failed to create image blob");w1(_,n)},"image/png",1)}catch(u){throw console.error("Error exporting canvas image:",u),u}}function w1(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.setAttribute("download",e),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function T1(t,e,n,r){const{text:i,subtext:s,position:o="bottom-right",color:l="#14E2A8",backgroundColor:u="rgba(3, 48, 62, 0.8)",fontSize:d=24,fontFamily:h="Arial, sans-serif",opacity:g=.9}=r;t.save(),t.globalAlpha=g,t.font=`bold ${d}px ${h}`,t.textAlign="left",t.textBaseline="top";const _=t.measureText(i),y=s?t.measureText(s):{width:0},T=Math.max(_.width,y.width),w=d,x=4,S=s?w*2+x:w,A=16,R=12,E=T+A*2,C=S+R*2;let I,O;const M=20;switch(o){case"top-left":I=M,O=M;break;case"top-right":I=e-E-M,O=M;break;case"bottom-left":I=M,O=n-C-M;break;case"bottom-right":I=e-E-M,O=n-C-M;break;case"top-center":I=(e-E)/2,O=M;break;case"bottom-center":default:I=(e-E)/2,O=n-C-M;break}t.fillStyle=u,t.beginPath(),t.roundRect?t.roundRect(I,O,E,C,6):t.rect(I,O,E,C),t.fill(),t.fillStyle=l,t.fillText(i,I+A,O+R),s&&(t.font=`${Math.round(d*.7)}px ${h}`,t.fillStyle=l,t.fillText(s,I+A,O+R+w+x)),t.restore()}const Qd=(t,e)=>{const n=u=>{let d=u.replace("#","");if(d.length===3&&(d=d.split("").map(T=>T+T).join("")),d.length!==6)return console.warn("Invalid hex color:",u),0;const h=parseInt(d.substr(0,2),16)/255,g=parseInt(d.substr(2,2),16)/255,_=parseInt(d.substr(4,2),16)/255,y=T=>T<=.03928?T/12.92:Math.pow((T+.055)/1.055,2.4);return .2126*y(h)+.7152*y(g)+.0722*y(_)};if(!t||!e)return console.warn("Missing colors for contrast check:",{color1:t,color2:e}),21;const r=n(t),i=n(e),s=Math.max(r,i),o=Math.min(r,i),l=(s+.05)/(o+.05);return t.toLowerCase()==="#ffffff"&&e.toLowerCase()==="#ffffff"&&console.log("White/white contrast check:",{color1:t,color2:e,lum1:r,lum2:i,ratio:l}),l},$q=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&Qd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`compact-string-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]})]})},Hq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=WM(e),s=e[3],o=d=>{const h=$M(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&Qd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-xs font-medium text-sp-white",children:t}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-3 h-3 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 rounded border border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`compact-node-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-xs rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none min-w-0",placeholder:"#000000"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70 flex-shrink-0",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"flex-1 min-w-0"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-10 text-right flex-shrink-0",children:[Math.round(s/255*100),"%"]})]})]})},Wq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=WM(e),s=e[3],o=d=>{const h=$M(d);n([h[0],h[1],h[2],s])},l=d=>{n([e[0],e[1],e[2],d])},u=r&&s>128&&Qd(i,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),u&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`},onClick:()=>{var d;return(d=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:d.click()}}),m.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:i,onChange:d=>o(d.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs text-sp-white/70",children:"Opacity:"}),m.jsx("input",{type:"range",min:"0",max:"255",value:s,onChange:d=>l(parseInt(d.target.value)),className:"w-20"}),m.jsxs("span",{className:"text-xs text-sp-white/70 w-8 text-right",children:[Math.round(s/255*100),"%"]})]})]})})]})]})},Xq=({label:t,value:e,onChange:n,backgroundColor:r})=>{const i=r&&Qd(e,r)<3;return m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white",children:t}),i&&m.jsxs("div",{className:"relative group",children:[m.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-48 p-2 text-xs bg-yellow-100 text-yellow-800 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:"Low contrast with background. Consider choosing a different color for better readability."})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"w-10 h-10 rounded border-2 border-sp-pale-green/20 cursor-pointer flex-shrink-0",style:{backgroundColor:e},onClick:()=>{var s;return(s=document.getElementById(`color-${t.replace(/\s+/g,"-").toLowerCase()}`))==null?void 0:s.click()}}),m.jsx("input",{id:`color-${t.replace(/\s+/g,"-").toLowerCase()}`,type:"color",value:e,onChange:s=>n(s.target.value),className:"w-0 h-0 opacity-0 pointer-events-none"}),m.jsx("input",{type:"text",value:e,onChange:s=>n(s.target.value),className:"flex-1 px-2 py-1 text-sm rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"#000000"})]})]})},Yq=({isOpen:t,onClose:e,editingTheme:n})=>{const{saveCustomTheme:r,updateCustomTheme:i,currentVisualizationType:s}=Ht(),[o,l]=U.useState(""),[u,d]=U.useState(!1),[h,g]=U.useState(()=>{const M=[96,160,183,255],P=[153,153,153,102],N=[Math.min(255,Math.round(P[0]*1.5)),Math.min(255,Math.round(P[1]*1.5)),Math.min(255,Math.round(P[2]*1.5)),Math.min(255,Math.round(P[3]*1.3))];return{background:"#03303E",containerBackground:"#0f1419",nodeDefault:M,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:M,nodeSelected:[255,255,255,255],edgeDefault:P,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"}});U.useEffect(()=>{if(n)l(n.name),g(n.colors);else{l("");const M=[96,160,183,255],P=[153,153,153,102],N=[Math.min(255,Math.round(P[0]*1.5)),Math.min(255,Math.round(P[1]*1.5)),Math.min(255,Math.round(P[2]*1.5)),Math.min(255,Math.round(P[3]*1.3))];g({background:"#03303E",containerBackground:"#0f1419",nodeDefault:M,nodeRoot:[96,160,183,255],nodeSample:[20,226,168,255],nodeCombined:M,nodeSelected:[255,255,255,255],edgeDefault:P,edgeHighlight:N,text:"#ffffff",textSecondary:"#14E2A8",border:"#2a4a5a",exportBackground:"#03303E",accentPrimary:"#14E2A8",accentSecondary:"#14E2A8",geographicGrid:[20,226,168,102],temporalGrid:[20,226,168,77],tooltipBackground:"rgba(5, 62, 78, 0.95)",tooltipText:"#ffffff",headerText:"#ffffff",controlPanelText:"#ffffff",buttonText:"#ffffff"})}},[n,t]),U.useEffect(()=>{const M=P=>{P.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",M),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",M),document.body.style.overflow="unset"}},[t,e]);const _=()=>{if(!o.trim()){alert("Please enter a theme name");return}n?i(n.id,o.trim(),h):r(o.trim(),h),e()},y=M=>P=>{g(N=>({...N,[M]:P}))},T=M=>P=>{g(N=>({...N,[M]:P}))},w=M=>{const P=M.replace("#",""),N=parseInt(P.substr(0,2),16),B=parseInt(P.substr(2,2),16),z=parseInt(P.substr(4,2),16);return(.299*N+.587*B+.114*z)/255>.5?"#000000":"#ffffff"},x=M=>{const P=w(M);g(N=>({...N,background:M,headerText:P,controlPanelText:P,buttonText:P,text:P}))},S=M=>{const P=[Math.min(255,Math.round(M[0]*1.5)),Math.min(255,Math.round(M[1]*1.5)),Math.min(255,Math.round(M[2]*1.5)),Math.min(255,Math.round(M[3]*1.3))];g(N=>({...N,edgeDefault:M,edgeHighlight:P}))},A=M=>{g(P=>({...P,nodeDefault:M,nodeCombined:M}))},R=HM(s),E=FB(s),C=M=>M==="nodeDefault"?A:M==="edgeDefault"?S:y(M),I=M=>({background:"Visualization Background",containerBackground:"Container Background",nodeDefault:"Internal Nodes (combined nodes will match)",nodeRoot:"Root Nodes",nodeSample:"Sample Nodes",nodeCombined:"Combined Nodes",nodeSelected:"Selected Nodes",edgeDefault:"Edges (highlighted edges will be auto-brightened)",edgeHighlight:"Highlighted Edges",text:"Primary Text",textSecondary:"Secondary Text",border:"Borders",exportBackground:"Export Background",accentPrimary:"Primary Accent",accentSecondary:"Secondary Accent",geographicGrid:"Geographic Shapes & Grid",temporalGrid:"Temporal Grid Lines",tooltipBackground:"Tooltip Background",tooltipText:"Tooltip Text",headerText:"Header Text",controlPanelText:"Control Panel Text",buttonText:"Button Text"})[M]||M,O=M=>{const P=h[M];return typeof P=="string"?m.jsx(Xq,{label:I(M),value:P,onChange:M==="background"?x:T(M),backgroundColor:M==="tooltipText"?h.tooltipBackground:void 0},M):m.jsx(Wq,{label:I(M),value:P,onChange:C(M),backgroundColor:h.background},M)};return t?m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[m.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),m.jsx("div",{className:"relative bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden transform transition-all",children:m.jsxs("div",{className:"p-6 overflow-y-auto max-h-[85vh] overflow-x-hidden",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[m.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-sp-pale-green/10",children:m.jsx("svg",{className:"w-5 h-5 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"})})}),m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:n?"Edit Custom Theme":"Create Custom Theme"})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-sp-white mb-2",children:"Theme Name"}),m.jsx("input",{type:"text",value:o,onChange:M=>l(M.target.value),className:"w-full px-3 py-2 rounded border bg-sp-very-dark-blue text-sp-white border-sp-pale-green/20 focus:border-sp-pale-green focus:outline-none",placeholder:"Enter theme name...",maxLength:50})]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsx("h4",{className:"text-base font-semibold text-sp-pale-green",children:"Main Colors"}),R.map(M=>O(M))]}),m.jsxs("div",{className:"space-y-4 mb-6",children:[m.jsxs("button",{onClick:()=>d(!u),className:"flex items-center gap-2 text-base font-semibold text-sp-pale-green hover:text-sp-very-pale-green transition-colors",children:[m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Other Colors"]}),u&&m.jsx("div",{className:"space-y-6 pl-6 border-l-2 border-sp-pale-green/20",children:m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 min-w-0",children:E.map(M=>{try{const P=h[M];return P?typeof P=="string"?m.jsx($q,{label:I(M),value:P,onChange:T(M),backgroundColor:M==="tooltipText"?h.tooltipBackground:h.background},M):m.jsx(Hq,{label:I(M),value:P,onChange:y(M),backgroundColor:h.background},M):null}catch(P){return console.warn(`Error rendering color picker for ${M}:`,P),null}})})})]}),m.jsxs("div",{className:"mt-6 p-4 rounded-lg border border-sp-pale-green/20 bg-sp-dark-blue/20",children:[m.jsx("h4",{className:"text-sm font-semibold text-sp-pale-green mb-3",children:"Preview"}),m.jsxs("div",{className:"p-4 rounded border text-sm",style:{backgroundColor:h.background,borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`,color:h.text},children:[m.jsx("div",{style:{color:h.headerText},className:"font-semibold mb-2",children:"3D ARG Visualization"}),m.jsx("div",{style:{color:h.controlPanelText},className:"mb-3",children:"Control panel text sample"}),m.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded border",style:{backgroundColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Background"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full border",style:{backgroundColor:`rgba(${h.nodeSample[0]}, ${h.nodeSample[1]}, ${h.nodeSample[2]}, ${h.nodeSample[3]/255})`,borderColor:h.background}}),m.jsx("span",{className:"text-xs",children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeRoot[0]}, ${h.nodeRoot[1]}, ${h.nodeRoot[2]}, ${h.nodeRoot[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Root"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:`rgba(${h.nodeDefault[0]}, ${h.nodeDefault[1]}, ${h.nodeDefault[2]}, ${h.nodeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Internal"})]})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeDefault[0]}, ${h.edgeDefault[1]}, ${h.edgeDefault[2]}, ${h.edgeDefault[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Edges"}),m.jsx("div",{className:"w-8 h-1 rounded",style:{backgroundColor:`rgba(${h.edgeHighlight[0]}, ${h.edgeHighlight[1]}, ${h.edgeHighlight[2]}, ${h.edgeHighlight[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Highlighted"})]}),m.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[m.jsx("div",{className:"w-6 h-6 border-2 rounded",style:{borderColor:`rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, ${h.geographicGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Geographic Grid"}),m.jsx("div",{className:"w-6 h-1 rounded",style:{backgroundColor:`rgba(${h.temporalGrid[0]}, ${h.temporalGrid[1]}, ${h.temporalGrid[2]}, ${h.temporalGrid[3]/255})`}}),m.jsx("span",{className:"text-xs",children:"Temporal Grid"})]}),m.jsx("div",{className:"text-xs inline-block px-2 py-1 rounded",style:{color:h.tooltipText,backgroundColor:h.tooltipBackground,border:`1px solid rgba(${h.geographicGrid[0]}, ${h.geographicGrid[1]}, ${h.geographicGrid[2]}, 0.3)`},children:"Sample tooltip text"})]})]}),m.jsxs("div",{className:"flex gap-3 mt-6",children:[m.jsx("button",{onClick:e,className:"flex-1 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-4 rounded-xl transition-all duration-200",children:"Cancel"}),m.jsx("button",{onClick:_,disabled:!o.trim(),className:"flex-1 bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-4 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Update Theme":"Save Theme"})]})]})})]}):null},tk=[{value:"tskit",label:"tskit",icon:""},{value:"grayscale",label:"B&W",icon:""},{value:"custom",label:"Custom",icon:""}],EO=()=>{const{theme:t,setTheme:e,colors:n,customThemes:r,selectedCustomTheme:i,setSelectedCustomTheme:s,deleteCustomTheme:o}=Ht(),[l,u]=U.useState(!1),[d,h]=U.useState(!1),[g,_]=U.useState(null),[y,T]=U.useState({isOpen:!1,themeId:"",themeName:""}),w=U.useRef(null),x=tk.find(N=>N.value===t),S=t==="custom"&&i?r.find(N=>N.id===i):null;U.useEffect(()=>{const N=B=>{w.current&&!w.current.contains(B.target)&&u(!1)};return document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[]);const A=N=>{N==="custom"?r.length===0?(h(!0),_(null)):(e("custom"),i||s(r[0].id)):e(N),u(!1)},R=N=>{e("custom"),s(N),u(!1)},E=()=>{_(null),h(!0),u(!1)},C=N=>{const B=r.find(z=>z.id===N);B&&(_(B),h(!0)),u(!1)},I=N=>{const B=r.find(z=>z.id===N);B&&T({isOpen:!0,themeId:N,themeName:B.name}),u(!1)},O=()=>{o(y.themeId),T({isOpen:!1,themeId:"",themeName:""}),i===y.themeId&&r.length<=1&&e("tskit")},M=()=>t==="custom"&&S?S.name.length>12?`${S.name.slice(0,12)}...`:S.name:(x==null?void 0:x.label)||"Custom",P=()=>t==="custom"?"":(x==null?void 0:x.icon)||"";return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative",ref:w,children:[m.jsxs("button",{className:"font-medium px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1",style:{backgroundColor:n.containerBackground,color:n.text,border:`1px solid ${n.border}`},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor=n.containerBackground},onClick:()=>u(!l),title:"Select color theme",children:[P()," ",M(),m.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&m.jsxs("div",{className:"absolute right-0 mt-1 py-1 rounded-md shadow-lg z-50 min-w-[160px] max-w-[250px]",style:{backgroundColor:n.containerBackground,border:`1px solid ${n.border}`},children:[tk.filter(N=>N.value!=="custom").map(N=>m.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:t===N.value?n.textSecondary:n.text,backgroundColor:t===N.value?n.border:"transparent"},onMouseEnter:B=>{t!==N.value&&(B.currentTarget.style.backgroundColor=n.border)},onMouseLeave:B=>{t!==N.value&&(B.currentTarget.style.backgroundColor="transparent")},onClick:()=>A(N.value),children:[N.icon," ",N.label,t===N.value&&m.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},N.value)),m.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),m.jsx("div",{className:"px-3 py-1",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-xs font-medium",style:{color:n.textSecondary},children:"Custom Themes"}),m.jsx("button",{onClick:E,className:"text-xs hover:underline",style:{color:n.textSecondary},title:"Create new custom theme",children:"+ New"})]})}),r.length===0?m.jsx("div",{className:"px-3 py-2 text-xs",style:{color:n.text+"80"},children:"No custom themes yet"}):r.map(N=>m.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm transition-colors group",style:{backgroundColor:t==="custom"&&i===N.id?n.border:"transparent"},onMouseEnter:B=>{t==="custom"&&i===N.id||(B.currentTarget.style.backgroundColor=n.border)},onMouseLeave:B=>{t==="custom"&&i===N.id||(B.currentTarget.style.backgroundColor="transparent")},children:[m.jsxs("button",{onClick:()=>R(N.id),className:"flex-1 text-left flex items-center gap-2 min-w-0",style:{color:t==="custom"&&i===N.id?n.textSecondary:n.text},children:["",m.jsx("span",{className:"truncate",children:N.name}),t==="custom"&&i===N.id&&m.jsx("svg",{className:"w-4 h-4 ml-auto flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:m.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),m.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[m.jsx("button",{onClick:()=>C(N.id),className:"p-1 rounded hover:bg-opacity-20",style:{color:n.textSecondary},title:"Edit theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),m.jsx("button",{onClick:()=>I(N.id),className:"p-1 rounded hover:bg-red-500 hover:bg-opacity-20",style:{color:"#ef4444"},title:"Delete theme",children:m.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},N.id)),r.length>0&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"h-px my-1",style:{backgroundColor:n.border}}),m.jsx("button",{onClick:E,className:"w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2",style:{color:n.textSecondary},onMouseEnter:N=>{N.currentTarget.style.backgroundColor=n.border},onMouseLeave:N=>{N.currentTarget.style.backgroundColor="transparent"},children:" Create New Theme"})]})]})]}),m.jsx(Yq,{isOpen:d,onClose:()=>{h(!1),_(null)},editingTheme:g}),m.jsx(YM,{isOpen:y.isOpen,title:"Delete Custom Theme",message:`Are you sure you want to delete the custom theme "${y.themeName}"? This action cannot be undone.`,type:"danger",confirmText:"Delete",cancelText:"Cancel",onConfirm:O,onCancel:()=>T({isOpen:!1,themeId:"",themeName:""})})]})};function Gq(){const{filename:t}=LM(),e=mc(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Hs(),{colors:s,setCurrentVisualizationType:o}=Ht(),l=U.useRef(null),[u,d]=U.useState(!1);if(U.useEffect(()=>{o("force-directed")},[o]),!t)return m.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"bg-sp-dark-blue hover:bg-sp-very-pale-green hover:text-sp-very-dark-blue text-sp-white font-bold py-2 px-6 rounded-lg mt-4 transition-colors",onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=y=>{Ee.user.action("switch-tree-sequence-force-directed",{treeSequence:y},"ArgVisualizationPage"),i(y),d(!1),e(`/visualize/${encodeURIComponent(y.filename)}`)},_=async()=>{const y=l.current;if(y)try{const T=`${h.replace(/\.(trees|tsz)$/,"")}_arg.png`;await zq(y,{filename:T,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:3,watermark:{text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"}}),console.log("High-resolution ARG image downloaded successfully")}catch(T){console.error("Error downloading ARG image:",T)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.color=`${s.accentPrimary}CC`},onMouseLeave:y=>{y.currentTarget.style.color=s.accentPrimary},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(_c,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"ARG Visualization"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(EO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download ARG visualization as PNG",children:"Download Image"}),r&&m.jsx(X0,{filename:r.filename})]})]})]})}),m.jsx(Y0,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:U.useMemo(()=>m.jsx(Uq,{ref:l,filename:h,max_samples:n}),[h,n])})]})}function Kq(){const e=gc().pathname.startsWith("/visualize"),{colors:n,theme:r}=Ht(),s=e&&!(e&&r==="custom")?n:null;return m.jsx("footer",{className:`fixed bottom-0 left-0 right-0 py-4 text-center text-sm backdrop-blur-sm border-t z-50 ${e?"":"text-sp-white bg-sp-very-dark-blue/90 border-t-sp-dark-blue/50"}`,style:e&&s?{color:s.text,backgroundColor:s.background+"E6",borderTopColor:s.border+"80"}:{},children:m.jsxs("div",{className:"flex flex-col items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("p",{children:[" ",new Date().getFullYear()," ",m.jsx("a",{href:"https://chris-a-talbot.com",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-pale-green hover:text-sp-white transition-colors",style:e&&s?{color:s.accentPrimary}:{},children:"Chris Talbot"}),". All rights reserved."]}),m.jsx("a",{href:"https://github.com/chris-a-talbot/argscape",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary}:{},title:"View source on GitHub",children:m.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[m.jsx("span",{className:e?"":"text-sp-white/70",style:e&&s?{color:s.textSecondary,opacity:.7}:{},children:"Resources:"}),m.jsx("a",{href:"https://tskit.dev/",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tskit"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/tskit-dev/tszip",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tszip"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/tskit-dev/tsdate",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"tsdate"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://tskit.dev/msprime/docs/stable/intro.html",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"msprime"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/blueraleigh/gaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaia"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/chris-a-talbot/gaiapy",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"gaiapy"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/chris-a-talbot/fastgaia",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"fastgaia"}),m.jsx("span",{className:e?"":"text-sp-white/50",style:e&&s?{color:s.text,opacity:.5}:{},children:""}),m.jsx("a",{href:"https://github.com/osmond-lab/sparg",target:"_blank",rel:"noopener noreferrer",className:e?"transition-colors":"text-sp-white/90 hover:text-sp-pale-green transition-colors",style:e&&s?{color:s.accentPrimary,opacity:.9}:{},children:"sparg"})]})]})})}const Zq="modulepreload",Qq=function(t){return"/"+t},nk={},rk=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(d=>{if(d=Qq(d),d in nk)return;nk[d]=!0;const h=d.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":Zq,h||(_.as="script"),_.crossOrigin="",_.href=d,u&&_.setAttribute("nonce",u),document.head.appendChild(_),h)return new Promise((y,T)=>{_.addEventListener("load",y),_.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};function Df(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const S1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ik=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ik&&parseFloat(ik[1]);const Ku=globalThis,Fa=globalThis.process||{},Jq=globalThis.navigator||{};function AO(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Ks(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||AO()}function eV(t){return Ks()?AO()?"Electron":(Jq.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const RO="4.1.0";function tV(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class nV{constructor(e,n,r="sessionStorage"){this.storage=tV(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function rV(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function iV(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var jf;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(jf||(jf={}));const sV=10;function sk(t){return typeof t!="string"?t:(t=t.toUpperCase(),jf[t]||jf.WHITE)}function aV(t,e,n){return!Ks&&typeof t=="string"&&(e&&(t=`\x1B[${sk(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${sk(n)+sV}m${t}\x1B[49m`)),t}function oV(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(l=>s===l)||(i[s]=o.bind(t)))}}function E1(t,e){if(!t)throw new Error("Assertion failed")}function za(){var e,n,r;let t;if(Ks()&&Ku.performance)t=(n=(e=Ku==null?void 0:Ku.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Fa){const i=(r=Fa==null?void 0:Fa.hrtime)==null?void 0:r.call(Fa);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const qa={debug:Ks()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},lV={enabled:!0,level:0};function Va(){}const ak={},ok={once:!0};class Ac{constructor({id:e}={id:""}){this.VERSION=RO,this._startTs=za(),this._deltaTs=za(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new nV(`__probe-${this.id}__`,lV),this.timeStamp(`${this.id} started`),oV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((za()-this._startTs).toPrecision(10))}getDelta(){return Number((za()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,qa.warn,arguments,ok)}error(e){return this._getLogFunction(0,e,qa.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,qa.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,qa.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,qa.debug||qa.info,arguments,ok)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Va,r&&[r],{tag:uV(n)}):Va}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Va)}group(e,n,r={collapsed:!1}){const i=lk({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Va)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=CO(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=lk({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,E1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=za();const o=s.tag||s.message;if(s.once&&o)if(!ak[o])ak[o]=za();else return Va;return n=cV(this.id,s.message,s),r.bind(console,n,...s.args)}return Va}}Ac.VERSION=RO;function CO(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return E1(Number.isFinite(e)&&e>=0),e}function lk(t){const{logLevel:e,message:n}=t;t.logLevel=CO(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return E1(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function cV(t,e,n){if(typeof e=="string"){const r=n.time?iV(rV(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=aV(e,n.color,n.background)}return e}function uV(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Kb="4.3.2",fV=Kb[0]>="0"&&Kb[0]<="9"?`v${Kb}`:"";function dV(){const t=new Ac({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=fV,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const hV=dV();function pV(t,e){return NO(t||{},e)}function NO(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=NO(r[i]||{},e[i],n+1):r[i]=e[i];return r}const gV="latest";function mV(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const _V=mV();function ss(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Os=typeof process!="object"||String(process)!=="[object process]"||process.browser,vV=typeof window<"u"&&typeof window.orientation<"u",ck=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ck&&parseFloat(ck[1]);class yV{constructor(e,n){j(this,"name");j(this,"workerThread");j(this,"isRunning",!0);j(this,"result");j(this,"_resolve",()=>{});j(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){ss(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ss(this.isRunning),this.isRunning=!1,this._reject(e)}}class Zb{terminate(){}}const Qb=new Map;function bV(t){ss(t.source&&!t.url||!t.source&&t.url);let e=Qb.get(t.source||t.url);return e||(t.url&&(e=xV(t.url),Qb.set(t.url,e)),t.source&&(e=kO(t.source),Qb.set(t.source,e))),ss(e),e}function xV(t){if(!t.startsWith("http"))return t;const e=wV(t);return kO(e)}function kO(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function wV(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function MO(t,e=!0,n){const r=n||new Set;if(t){if(uk(t))r.add(t);else if(uk(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)MO(t[i],e,r)}}return n===void 0?Array.from(r):[]}function uk(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Jb=()=>{};class Yx{constructor(e){j(this,"name");j(this,"source");j(this,"url");j(this,"terminated",!1);j(this,"worker");j(this,"onMessage");j(this,"onError");j(this,"_loadableURL","");const{name:n,source:r,url:i}=e;ss(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Jb,this.onError=s=>console.log(s),this.worker=Os?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Os||typeof Zb<"u"&&!Os}destroy(){this.onMessage=Jb,this.onError=Jb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||MO(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=bV({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Zb(r,{eval:!1})}else if(this.source)e=new Zb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class TV{constructor(e){j(this,"name","unnamed");j(this,"source");j(this,"url");j(this,"maxConcurrency",1);j(this,"maxMobileConcurrency",1);j(this,"onDebug",()=>{});j(this,"reuseWorkers",!0);j(this,"props",{});j(this,"jobQueue",[]);j(this,"idleQueue",[]);j(this,"count",0);j(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Yx.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new yV(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Os||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Yx({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return vV?this.maxMobileConcurrency:this.maxConcurrency}}const SV={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Gi=class Gi{constructor(e){j(this,"props");j(this,"workerPools",new Map);this.props={...SV},this.setProps(e),this.workerPools=new Map}static isSupported(){return Yx.isSupported()}static getWorkerFarm(e={}){return Gi._workerFarm=Gi._workerFarm||new Gi({}),Gi._workerFarm.setProps(e),Gi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new TV({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};j(Gi,"_workerFarm");let Lf=Gi;function EV(t,e={}){const n=e[t.id]||{},r=Os?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Os?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=gV);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return ss(i),i}function AV(t,e=_V){ss(t,"no worker provided");const n=t.version;return!(!e||!n)}function RV(t,e){return!Lf.isSupported()||!Os&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function CV(t,e,n,r,i){const s=t.id,o=EV(t,n),u=Lf.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const d=await u.startJob("process-on-worker",NV.bind(null,i));return d.postMessage("process",{input:e,options:n,context:r}),await(await d.result).result}async function NV(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const l=await t(s,o);e.postMessage("done",{id:i,result:l})}catch(l){const u=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function kV(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function MV(...t){return IV(t)}function IV(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function OV(t){const e=[];for await(const n of t)e.push(n);return MV(...e)}function fk(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class dk{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=fk(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(fk()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Jd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof dk?i=e:i=new dk(n,r),this.stats[n]=i),i}}let PV="";const hk={};function DV(t){for(const e in hk)if(t.startsWith(e)){const n=hk[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${PV}${t}`),t}function jV(t){return t&&typeof t=="object"&&t.isBuffer}function IO(t){if(jV(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function OO(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function LV(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const BV=t=>typeof t=="boolean",Wl=t=>typeof t=="function",Rc=t=>t!==null&&typeof t=="object",pk=t=>Rc(t)&&t.constructor==={}.constructor,UV=t=>!!t&&typeof t[Symbol.iterator]=="function",FV=t=>t&&typeof t[Symbol.asyncIterator]=="function",Zs=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Qs=t=>typeof Blob<"u"&&t instanceof Blob,zV=t=>t&&typeof t=="object"&&t.isBuffer,qV=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Rc(t)&&Wl(t.tee)&&Wl(t.cancel)&&Wl(t.getReader),VV=t=>Rc(t)&&Wl(t.read)&&Wl(t.pipe)&&BV(t.readable),PO=t=>qV(t)||VV(t);class $V extends Error{constructor(n,r){super(n);j(this,"reason");j(this,"url");j(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const HV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,WV=/^([-\w.]+\/[-\w.+]+)/;function gk(t,e){return t.toLowerCase()===e.toLowerCase()}function XV(t){const e=WV.exec(t);return e?e[1]:t}function mk(t){const e=HV.exec(t);return e?e[1]:""}const DO=/\?.*/;function YV(t){const e=t.match(DO);return e&&e[0]}function A1(t){return t.replace(DO,"")}function GV(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function eh(t){return Zs(t)?t.url:Qs(t)?t.name||"":typeof t=="string"?t:""}function R1(t){if(Zs(t)){const e=t,n=e.headers.get("content-type")||"",r=A1(e.url);return XV(n)||mk(r)}return Qs(t)?t.type||"":typeof t=="string"?mk(t):""}function KV(t){return Zs(t)?t.headers["content-length"]||-1:Qs(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function jO(t){if(Zs(t))return t;const e={},n=KV(t);n>=0&&(e["content-length"]=String(n));const r=eh(t),i=R1(t);i&&(e["content-type"]=i);const s=await JV(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function ZV(t){if(!t.ok)throw await QV(t)}async function QV(t){const e=GV(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new $V(n,r)}async function JV(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${e$(n)}`}return null}function e$(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function t$(t){return!n$(t)&&!r$(t)}function n$(t){return t.startsWith("http:")||t.startsWith("https:")}function r$(t){return t.startsWith("data:")}async function _k(t,e){var n,r;if(typeof t=="string"){const i=DV(t);return t$(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await jO(t)}const vk=new Ac({id:"loaders.gl"});class i${log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class s${constructor(){j(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const LO={fetch:null,mimeType:void 0,nothrow:!1,log:new s$,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:S1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},a$={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function BO(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function UO(){const t=BO();return t.globalOptions=t.globalOptions||{...LO},t.globalOptions}function o$(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],l$(t,n),u$(e,t,r)}function l$(t,e){yk(t,null,LO,a$,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};yk(r,n.id,i,s,e)}}function yk(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const l in t){const u=!e&&Rc(t[l]),d=l==="baseUri"&&!e,h=l==="workerUrl"&&e;if(!(l in n)&&!d&&!h){if(l in r)vk.warn(`${s} loader option '${o}${l}' no longer supported, use '${r[l]}'`)();else if(!u){const g=c$(l,i);vk.warn(`${s} loader option '${o}${l}' not recognized. ${g}`)()}}}}function c$(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function u$(t,e,n){const i={...t.options||{}};return f$(i,n),i.log===null&&(i.log=new i$),bk(i,UO()),bk(i,e),i}function bk(t,e){for(const n in e)if(n in e){const r=e[n];pk(r)&&pk(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function f$(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function C1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function N1(t){Df(t,"null loader"),Df(C1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const FO=()=>{const t=BO();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function d$(t){const e=FO();t=Array.isArray(t)?t:[t];for(const n of t){const r=N1(n);e.find(i=>r===i)||e.unshift(r)}}function h$(){return FO()}const p$=/\.([^.]+)$/;async function g$(t,e=[],n,r){if(!zO(t))return null;let i=xk(t,e,{...n,nothrow:!0},r);if(i)return i;if(Qs(t)&&(t=await t.slice(0,10).arrayBuffer(),i=xk(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(qO(t));return i}function xk(t,e=[],n,r){if(!zO(t))return null;if(e&&!Array.isArray(e))return N1(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...h$()),_$(i);const s=m$(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(qO(t));return s}function m$(t,e,n,r){const i=eh(t),s=R1(t),o=A1(i)||(r==null?void 0:r.url);let l=null,u="";return n!=null&&n.mimeType&&(l=ex(e,n==null?void 0:n.mimeType),u=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),l=l||v$(e,o),u=u||(l?`matched url ${o}`:""),l=l||ex(e,s),u=u||(l?`matched MIME type ${s}`:""),l=l||b$(e,t),u=u||(l?`matched initial data ${VO(t)}`:""),n!=null&&n.fallbackMimeType&&(l=l||ex(e,n==null?void 0:n.fallbackMimeType),u=u||(l?`matched fallback MIME type ${s}`:"")),u&&hV.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${u}.`),l}function zO(t){return!(t instanceof Response&&t.status===204)}function qO(t){const e=eh(t),n=R1(t);let r="No valid loader found (";r+=e?`${OO(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?VO(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function _$(t){for(const e of t)N1(e)}function v$(t,e){const n=e&&p$.exec(e),r=n&&n[1];return r?y$(t,r):null}function y$(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function ex(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>gk(e,i))||gk(e,`application/x.${r.id}`))return r;return null}function b$(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(x$(e,n))return n}else if(ArrayBuffer.isView(e)){if(wk(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&wk(e,0,n))return n;return null}function x$(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function wk(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>w$(t,e,n,i))}function w$(t,e,n,r){if(r instanceof ArrayBuffer)return kV(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=Gx(t,e,r.length);return r===i;default:return!1}}function VO(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Gx(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Gx(t,0,e):""}function Gx(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const T$=256*1024;function*S$(t,e){const n=(e==null?void 0:e.chunkSize)||T$;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const E$=256*1024;function*A$(t,e={}){const{chunkSize:n=E$}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const R$=1024*1024;async function*C$(t,e){const n=(e==null?void 0:e.chunkSize)||R$;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Tk(t,e){return S1?N$(t,e):k$(t)}async function*N$(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield IO(o)}}catch{n.releaseLock()}}async function*k$(t,e){for await(const n of t)yield IO(n)}function M$(t,e){if(typeof t=="string")return S$(t,e);if(t instanceof ArrayBuffer)return A$(t,e);if(Qs(t))return C$(t,e);if(PO(t))return Tk(t,e);if(Zs(t))return Tk(t.body,e);throw new Error("makeIterator")}const $O="Cannot convert supplied data type";function I$(t,e,n){if(e.text&&typeof t=="string")return t;if(zV(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error($O)}async function O$(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return I$(t,e);if(Qs(t)&&(t=await jO(t)),Zs(t)){const i=t;return await ZV(i),e.binary?await i.arrayBuffer():await i.text()}if(PO(t)&&(t=M$(t,n)),UV(t)||FV(t))return OV(t);throw new Error($O)}function HO(t,e){const n=UO(),r=t||n;return typeof r.fetch=="function"?r.fetch:Rc(r.fetch)?i=>_k(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:_k}function P$(t,e,n){if(n)return n;const r={fetch:HO(e,t),...t};if(r.url){const i=A1(r.url);r.baseUrl=i,r.queryString=YV(r.url),r.filename=OO(i),r.baseUrl=LV(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function D$(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Bf(t,e,n,r){e&&!Array.isArray(e)&&!C1(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=eh(t),o=D$(e,r),l=await g$(t,o,n);return l?(n=o$(n,l,o,i),r=P$({url:i,_parse:Bf,loaders:o},n,r||null),await j$(l,t,n,r)):null}async function j$(t,e,n,r){if(AV(t),n=pV(t.options,n),Zs(e)){const s=e,{ok:o,redirected:l,status:u,statusText:d,type:h,url:g}=s,_=Object.fromEntries(s.headers.entries());r.response={headers:_,ok:o,redirected:l,status:u,statusText:d,type:h,url:g}}e=await O$(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(RV(t,n))return await CV(t,e,n,r,Bf);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw ss(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Kx(t,e,n,r){let i,s;!Array.isArray(e)&&!C1(e)?(i=[],s=e):(i=e,s=n);const o=HO(s);let l=t;return typeof t=="string"&&(l=await o(t)),Qs(t)&&(l=await o(t)),Array.isArray(i)?await Bf(l,i,s):await Bf(l,i,s)}const L$="4.3.2";var RM;const B$=(RM=globalThis.loaders)==null?void 0:RM.parseImageNode,Zx=typeof Image<"u",Qx=typeof ImageBitmap<"u",U$=!!B$,Jx=S1?!0:U$;function F$(t){switch(t){case"auto":return Qx||Zx||Jx;case"imagebitmap":return Qx;case"image":return Zx;case"data":return Jx;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function z$(){if(Qx)return"imagebitmap";if(Zx)return"image";if(Jx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function q$(t){const e=$$(t);if(!e)throw new Error("Not an image");return e}function V$(t){switch(q$(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function $$(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const H$=/^data:image\/svg\+xml/,W$=/\.svg((\?|#).*)?$/;function k1(t){return t&&(H$.test(t)||W$.test(t))}function X$(t,e){if(k1(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return WO(t,e)}function WO(t,e){if(k1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function XO(t,e,n){const r=X$(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await Y$(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function Y$(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const G$={};let Sk=!0;async function K$(t,e,n){let r;k1(n)?r=await XO(t,e,n):r=WO(t,n);const i=e&&e.imagebitmap;return await Z$(r,i)}async function Z$(t,e=null){if((Q$(e)||!Sk)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Sk=!1}return await createImageBitmap(t)}function Q$(t){for(const e in t||G$)return!1;return!0}function J$(t){return!rH(t,"ftyp",4)||(t[8]&96)===0?null:eH(t)}function eH(t){switch(tH(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function tH(t,e,n){return String.fromCharCode(...t.slice(e,n))}function nH(t){return[...t].map(e=>e.charCodeAt(0))}function rH(t,e,n=0){const r=nH(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const qr=!1,Xl=!0;function YO(t){const e=Cc(t);return sH(e)||lH(e)||aH(e)||oH(e)||iH(e)}function iH(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=J$(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function sH(t){const e=Cc(t);return e.byteLength>=24&&e.getUint32(0,qr)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qr),height:e.getUint32(20,qr)}:null}function aH(t){const e=Cc(t);return e.byteLength>=10&&e.getUint32(0,qr)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Xl),height:e.getUint16(8,Xl)}:null}function oH(t){const e=Cc(t);return e.byteLength>=14&&e.getUint16(0,qr)===16973&&e.getUint32(2,Xl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Xl),height:e.getUint32(22,Xl)}:null}function lH(t){const e=Cc(t);if(!(e.byteLength>=3&&e.getUint16(0,qr)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=cH();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,qr);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,qr),width:e.getUint16(s+7,qr)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,qr)}return null}function cH(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Cc(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function uH(t,e){var i;const{mimeType:n}=YO(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Df(r),await r(t,n)}async function fH(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=dH(i);let l;switch(o){case"imagebitmap":l=await K$(t,e,s);break;case"image":l=await XO(t,e,s);break;case"data":l=await uH(t);break;default:Df(!1)}return i==="data"&&(l=V$(l)),l}function dH(t){switch(t){case"auto":case"data":return z$();default:return F$(t),t}}const hH=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],pH=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],gH={image:{type:"auto",decode:!0}},mH={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:L$,mimeTypes:pH,extensions:hH,parse:fH,tests:[t=>!!YO(new DataView(t))],options:gH},_t=new Ac({id:"deck"});let e0={};function _H(t){e0=t}function Sn(t,e,n,r){_t.level>0&&e0[t]&&e0[t].call(null,e,n,r)}function vH(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const yH={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:vH,parseTextSync:JSON.parse};function bH(){const t="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(_t.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:_t,_registerLoggers:_H},d$([yH,[mH,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const xH=bH();function M1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const tx={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function wH(t){const e={};for(const[n,r]of Object.entries(t))e[n]=TH(r);return e}function TH(t){let e=Ek(t);if(e!=="object")return{value:t,...tx[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...tx[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Ek(t.value),{...t,...tx[e],type:e}):{type:"object",value:null};throw new Error("props")}function Ek(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const SH=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,EH=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,AH={vertex:SH,fragment:EH},Ak=/void\s+main\s*\([^)]*\)\s*\{\n?/,Rk=/}\n?[^{}]*$/,nx=[],yf="__LUMA_INJECT_DECLARATIONS__";function RH(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=CH(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function CH(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Uf(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((u,d)=>u.order-d.order),nx.length=o.length;for(let u=0,d=o.length;u<d;++u)nx[u]=o[u].injection;const l=`${nx.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(yf,l));break;case"vs:#main-start":i&&(t=t.replace(Ak,u=>u+l));break;case"vs:#main-end":i&&(t=t.replace(Rk,u=>l+u));break;case"fs:#decl":i||(t=t.replace(yf,l));break;case"fs:#main-start":i||(t=t.replace(Ak,u=>u+l));break;case"fs:#main-end":i||(t=t.replace(Rk,u=>l+u));break;default:t=t.replace(s,u=>u+l)}}return t=t.replace(yf,""),r&&(t=t.replace(/\}\s*$/,s=>s+AH[e])),t}function Ff(t){t.map(e=>NH(e))}function NH(t){if(t.instance)return;Ff(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:RH(r),parsedDeprecations:kH(n)};e&&(i.propValidators=wH(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[l,u])=>{const d=u==null?void 0:u.value;return d&&(o[l]=d),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function GO(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function kH(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function I1(t){Ff(t);const e={},n={};KO({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Ff(r),r}function KO(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&KO({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function MH(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function IH(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Ck(t,OH),t;case"fragment":return t=Ck(t,PH),t;default:throw new Error(e)}}const ZO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],OH=[...ZO,[t0("attribute"),"in $1"],[t0("varying"),"out $1"]],PH=[...ZO,[t0("varying"),"in $1"]];function Ck(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function t0(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function QO(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,l)=>o.order-l.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function JO(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),l=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[l]=u;break;case"fs":e.fragment[l]=u;break;default:throw new Error(s)}}return e}function DH(t,e){return{name:jH(t,e),language:"glsl",version:LH(t)}}function jH(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function LH(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const eP=`

${yf}
`,BH=`precision highp float;
`;function UH(t){const e=I1(t.modules||[]);return{source:zH(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:tP(e)}}function FH(t){const{vs:e,fs:n}=t,r=I1(t.modules||[]);return{vs:Nk(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:Nk(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:tP(r)}}function zH(t,e){var w;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:l}=e;M1(typeof n=="string","shader source must be a string");const u=n;let d="";const h=JO(s),g={},_={},y={};for(const x in o){const S=typeof o[x]=="string"?{injection:o[x],order:0}:o[x],A=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(A){const R=A[2],E=A[3];R?E==="decl"?_[x]=[S]:y[x]=[S]:g[x]=[S]}else y[x]=[S]}const T=i;for(const x of T){l&&GO(x,u,l);const S=nP(x,"wgsl");d+=S;const A=((w=x.injections)==null?void 0:w[r])||{};for(const R in A){const E=/^(v|f)s:#([\w-]+)$/.exec(R);if(E){const I=E[2]==="decl"?_:y;I[R]=I[R]||[],I[R].push(A[R])}else g[R]=g[R]||[],g[R].push(A[R])}}return d+=eP,d=Uf(d,r,_),d+=QO(h[r],g),d+=u,d=Uf(d,r,y),d}function Nk(t,e){var O;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:l={},hookFunctions:u=[],inject:d={},prologue:h=!0,log:g}=e;M1(typeof r=="string","shader source must be a string");const _=s==="glsl"?DH(r).version:-1,y=t.shaderLanguageVersion,T=_===100?"#version 100":"#version 300 es",x=r.split(`
`).slice(1).join(`
`),S={};o.forEach(M=>{Object.assign(S,M.defines)}),Object.assign(S,l);let A="";switch(s){case"wgsl":break;case"glsl":A=h?`${T}

// ----- PROLOGUE -------------------------
${qH({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${MH(t)}
${i==="fragment"?BH:""}

// ----- APPLICATION DEFINES -------------------------

${VH(S)}

`:`${T}
`;break}const R=JO(u),E={},C={},I={};for(const M in d){const P=typeof d[M]=="string"?{injection:d[M],order:0}:d[M],N=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(N){const B=N[2],z=N[3];B?z==="decl"?C[M]=[P]:I[M]=[P]:E[M]=[P]}else I[M]=[P]}for(const M of o){g&&GO(M,x,g);const P=nP(M,i);A+=P;const N=((O=M.instance)==null?void 0:O.normalizedInjections[i])||{};for(const B in N){const z=/^(v|f)s:#([\w-]+)$/.exec(B);if(z){const H=z[2]==="decl"?C:I;H[B]=H[B]||[],H[B].push(N[B])}else E[B]=E[B]||[],E[B].push(N[B])}}return A+="// ----- MAIN SHADER SOURCE -------------------------",A+=eP,A=Uf(A,i,C),A+=QO(R[i],E),A+=x,A=Uf(A,i,I),s==="glsl"&&_!==y&&(A=IH(A,i)),A.trim()}function tP(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function qH(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function VH(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function nP(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:M1(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const $H=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,HH=/^\s*\#\s*endif\s*$/;function WH(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const l of n){const u=l.match($H),d=l.match(HH);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):d?i=!0:i&&r.push(l)}return r.join(`
`)}const Cs=class Cs{constructor(){j(this,"_hookFunctions",[]);j(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Cs.defaultShaderAssembler=Cs.defaultShaderAssembler||new Cs,Cs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=UH({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?WH(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...FH({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],u=l.name;n[i++]=l,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const l=e[s],u=l.name;r[u]||(n[i++]=l,r[u]=!0)}return n.length=i,Ff(n),n}};j(Cs,"defaultShaderAssembler");let zf=Cs;const XH=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,YH=`#version 300 es
${XH}`;function GH(t){const{input:e,inputChannels:n,output:r}={};if(!e)return YH;if(!n)throw new Error("inputChannels");const i=KH(n),s=ZH(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function KH(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function ZH(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class QH{constructor(){j(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Jd({id:e})),this.stats.get(e)}}const rP=new QH,be=new Ac({id:"luma.gl"}),rx={};function th(t="id"){rx[t]=rx[t]||1;const e=rx[t]++;return`${t}-${e}`}var jx;let ut=(jx=class{constructor(e,n,r){j(this,"id");j(this,"props");j(this,"userData",{});j(this,"_device");j(this,"destroyed",!1);j(this,"allocatedBytes",0);j(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=JH(n,r);const i=this.props.id!=="undefined"?this.props.id:th(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},j(jx,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),jx);function JH(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const cn=class cn extends ut{constructor(n,r){const i={...r};(r.usage||0)&cn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,cn.defaultProps);j(this,"usage");j(this,"indexType");j(this,"updateTimestamp");j(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,cn.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};j(cn,"defaultProps",{...ut.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),j(cn,"MAP_READ",1),j(cn,"MAP_WRITE",2),j(cn,"COPY_SRC",4),j(cn,"COPY_DST",8),j(cn,"INDEX",16),j(cn,"VERTEX",32),j(cn,"UNIFORM",64),j(cn,"STORAGE",128),j(cn,"INDIRECT",256),j(cn,"QUERY_RESOLVE",512),j(cn,"DEBUG_DATA_MAX_LENGTH",32);let wt=cn;function iP(t){const e=kk[t],n=eW(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:kk[t],byteLength:n,integer:i,signed:s,normalized:r}}function eW(t){return tW[t]}const kk={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},tW={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},_n="texture-compression-bc",ct="texture-compression-astc",Br="texture-compression-etc2",nW="texture-compression-etc1-webgl",Zu="texture-compression-pvrtc-webgl",ix="texture-compression-atc-webgl",Qu="float32-renderable-webgl",sx="float16-renderable-webgl",rW="rgb9e5ufloat-renderable-webgl",ax="snorm8-renderable-webgl",Nl="norm16-renderable-webgl",ox="snorm16-renderable-webgl",Ju="float32-filterable",Mk="float16-filterable-webgl";function sP(t){const e=iW[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const iW={r8unorm:{},r8snorm:{render:ax},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:ax},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:sx,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Nl},"r16snorm-webgl":{f:ox},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:ax},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:sx,filter:Mk},"rg16unorm-webgl":{render:Nl},"rg16snorm-webgl":{render:ox},r32uint:{},r32sint:{},r32float:{render:Qu,filter:Ju},rgb9e5ufloat:{channels:"rgb",packed:!0,render:rW},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Qu},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Nl},"rgb16snorm-webgl":{f:Nl},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Ju},rgba16uint:{},rgba16sint:{},rgba16float:{render:sx,filter:Mk},"rgba16unorm-webgl":{render:Nl},"rgba16snorm-webgl":{render:ox},"rgb32float-webgl":{render:Qu,filter:Ju},rgba32uint:{},rgba32sint:{},rgba32float:{render:Qu,filter:Ju},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:_n},"bc1-rgb-unorm-srgb-webgl":{f:_n},"bc1-rgba-unorm":{f:_n},"bc1-rgba-unorm-srgb":{f:_n},"bc2-rgba-unorm":{f:_n},"bc2-rgba-unorm-srgb":{f:_n},"bc3-rgba-unorm":{f:_n},"bc3-rgba-unorm-srgb":{f:_n},"bc4-r-unorm":{f:_n},"bc4-r-snorm":{f:_n},"bc5-rg-unorm":{f:_n},"bc5-rg-snorm":{f:_n},"bc6h-rgb-ufloat":{f:_n},"bc6h-rgb-float":{f:_n},"bc7-rgba-unorm":{f:_n},"bc7-rgba-unorm-srgb":{f:_n},"etc2-rgb8unorm":{f:Br},"etc2-rgb8unorm-srgb":{f:Br},"etc2-rgb8a1unorm":{f:Br},"etc2-rgb8a1unorm-srgb":{f:Br},"etc2-rgba8unorm":{f:Br},"etc2-rgba8unorm-srgb":{f:Br},"eac-r11unorm":{f:Br},"eac-r11snorm":{f:Br},"eac-rg11unorm":{f:Br},"eac-rg11snorm":{f:Br},"astc-4x4-unorm":{f:ct},"astc-4x4-unorm-srgb":{f:ct},"astc-5x4-unorm":{f:ct},"astc-5x4-unorm-srgb":{f:ct},"astc-5x5-unorm":{f:ct},"astc-5x5-unorm-srgb":{f:ct},"astc-6x5-unorm":{f:ct},"astc-6x5-unorm-srgb":{f:ct},"astc-6x6-unorm":{f:ct},"astc-6x6-unorm-srgb":{f:ct},"astc-8x5-unorm":{f:ct},"astc-8x5-unorm-srgb":{f:ct},"astc-8x6-unorm":{f:ct},"astc-8x6-unorm-srgb":{f:ct},"astc-8x8-unorm":{f:ct},"astc-8x8-unorm-srgb":{f:ct},"astc-10x5-unorm":{f:ct},"astc-10x5-unorm-srgb":{f:ct},"astc-10x6-unorm":{f:ct},"astc-10x6-unorm-srgb":{f:ct},"astc-10x8-unorm":{f:ct},"astc-10x8-unorm-srgb":{f:ct},"astc-10x10-unorm":{f:ct},"astc-10x10-unorm-srgb":{f:ct},"astc-12x10-unorm":{f:ct},"astc-12x10-unorm-srgb":{f:ct},"astc-12x12-unorm":{f:ct},"astc-12x12-unorm-srgb":{f:ct},"pvrtc-rgb4unorm-webgl":{f:Zu},"pvrtc-rgba4unorm-webgl":{f:Zu},"pvrtc-rbg2unorm-webgl":{f:Zu},"pvrtc-rgba2unorm-webgl":{f:Zu},"etc1-rbg-unorm-webgl":{f:nW},"atc-rgb-unorm-webgl":{f:ix},"atc-rgba-unorm-webgl":{f:ix},"atc-rgbai-unorm-webgl":{f:ix}},sW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],aW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function aP(t){return sW.some(e=>t.startsWith(e))}function O1(t){let e=oW(t);if(aP(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=lW(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=aW.exec(t);if(n){const[,r,i,s,o,l]=n,u=`${s}${i}`,d=iP(u),h=d.byteLength*8,g=r.length,_=[h,g>=2?h:0,g>=3?h:0,g>=4?h:0];e={format:t,attachment:e.attachment,dataType:d.dataType,components:g,channels:r,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:_,bytesPerPixel:d.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function oW(t){var s;const e=sP(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function lW(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function cW(t){const e=sP(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=O1(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,l=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!l),n}class uW{}class fW{constructor(e=[],n){j(this,"features");j(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const hd=class hd{constructor(e){j(this,"id");j(this,"props");j(this,"userData",{});j(this,"statsManager",rP);j(this,"timestamp",0);j(this,"_reused",!1);j(this,"_lumaData",{});this.props={...hd.defaultProps,...e},this.id=this.props.id||th(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=cW(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return aP(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&wt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":be.warn("indices buffer content must be of integer type")()),n}};j(hd,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>be.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:be.get("debug")||void 0,debugShaders:be.get("debug-shaders")||void 0,debugFramebuffers:!!be.get("debug-framebuffers"),debugWebGL:!!be.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let rs=hd;const dW=Ks()&&typeof document<"u",hW=()=>dW&&document.readyState==="complete",pW="set luma.log.level=1 (or higher) to trace rendering",Ik="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Ki=class Ki{constructor(){j(this,"stats",rP);j(this,"log",be);j(this,"VERSION","9.1.9");j(this,"spector");j(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw be.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),be.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");be.error("This version of luma.gl has already been initialized")()}be.log(1,`${this.VERSION} - ${pW}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Ki.defaultProps,e)}async createDevice(e={}){var l;e={...Ki.defaultProps,...e},e.waitForPageLoad&&await Ki.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((l=s==null?void 0:s.create)==null?void 0:l.call(s,e));if(o)return o;throw new Error(Ik)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Ki.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(Ik)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||be.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){be.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};j(Ki,"defaultProps",{...rs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),j(Ki,"pageLoaded",gW().then(()=>{be.probe(2,"DOM is loaded")()}));let n0=Ki;const r0=new n0;function gW(){return hW()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class mW{}const pd=class pd{constructor(e){j(this,"id");j(this,"props");j(this,"canvas");j(this,"htmlCanvas");j(this,"offscreenCanvas");j(this,"type");j(this,"width",1);j(this,"height",1);j(this,"resizeObserver");j(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...pd.defaultProps,...e},e=this.props,!Ks()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=vW(e.canvas):this.canvas=e.canvas;else{const n=yW(e),r=_W((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return bW(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(be.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const l=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=u,this.device.gl){const[h,g]=this.getDrawingBufferSize();(h!==l||g!==u)&&(o=Math.min(h/r,g/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),be.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};j(pd,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let i0=pd;function _W(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function vW(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function yW(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=th("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function bW(t,e,n,r,i){const s=t,o=Ok(s[0],e,n);let l=Pk(s[1],e,r,i),u=Ok(s[0]+1,e,n);const d=u===n-1?u:u-1;u=Pk(s[1]+1,e,r,i);let h;return i?(u=u===0?u:u+1,h=l,l=u):h=u===r-1?u:u-1,{x:o,y:l,width:Math.max(d-o+1,1),height:Math.max(h-l+1,1)}}function Ok(t,e,n){return Math.min(Math.round(t*e),n-1)}function Pk(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const un=class un extends ut{constructor(n,r){r=un.normalizeProps(n,r);super(n,r,un.defaultProps);j(this,"dimension");j(this,"format");j(this,"width");j(this,"height");j(this,"depth");j(this,"mipLevels");j(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=un.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?un.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return un.getTextureDataSize(n[0]);if(un.isExternalImage(n))return un.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var u,d;const i={...r},s=((d=(u=n==null?void 0:n.props)==null?void 0:u._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(i,s);const{width:o,height:l}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof l=="number"&&(i.height=Math.max(1,Math.ceil(l))),i}};j(un,"COPY_SRC",1),j(un,"COPY_DST",2),j(un,"TEXTURE",4),j(un,"STORAGE",8),j(un,"RENDER_ATTACHMENT",16),j(un,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),j(un,"defaultProps",{...ut.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),j(un,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let It=un;const gd=class gd extends ut{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,gd.defaultProps)}};j(gd,"defaultProps",{...ut.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let qf=gd;function xW(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=i.length;l++)for(r+=oP(i[l-1],l,n);s.length>o&&s[o].lineNum===l;){const u=s[o++];r+=Dk(u,i,u.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const l of t)r+=Dk(l,i,l.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Dk(t,e,n,r){if(r!=null&&r.inlineSource){const s=wW(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function wW(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=oP(s,e,n))}return r}function oP(t,e,n){const r=n!=null&&n.html?SW(t):t;return`${TW(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function TW(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function SW(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const md=class md extends ut{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:EW(r),...r},md.defaultProps);j(this,"stage");j(this,"source");j(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=lP(this.source),i=`${this.stage} ${r}`;let s=xW(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};j(md,"defaultProps",{...ut.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Vf=md;function EW(t){return lP(t.source)||t.id||th(`unnamed ${t.stage}-shader`)}function lP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const ec=class ec extends ut{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=ec.normalizeProps(e,n),super(e,n,ec.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};j(ec,"defaultProps",{...ut.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let $f=ec;const _d=class _d extends ut{constructor(n,r={}){super(n,r,_d.defaultProps);j(this,"width");j(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(be.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof It?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof It?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:It.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:It.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};j(_d,"defaultProps",{...ut.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Hf=_d;const vd=class vd extends ut{constructor(n,r){super(n,r,vd.defaultProps);j(this,"shaderLayout");j(this,"bufferLayout");j(this,"linkStatus","pending");j(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};j(vd,"defaultProps",{...ut.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let co=vd;const Sr=class Sr extends ut{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=Sr.normalizeProps(e,n),super(e,n,Sr.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};j(Sr,"defaultClearColor",[0,0,0,1]),j(Sr,"defaultClearDepth",1),j(Sr,"defaultClearStencil",0),j(Sr,"defaultProps",{...ut.defaultProps,framebuffer:null,parameters:void 0,clearColor:Sr.defaultClearColor,clearColors:void 0,clearDepth:Sr.defaultClearDepth,clearStencil:Sr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let s0=Sr;const yd=class yd extends ut{constructor(n,r){super(n,r,yd.defaultProps);j(this,"hash","");j(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};j(yd,"defaultProps",{...ut.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Wf=yd;const bd=class bd extends ut{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,bd.defaultProps)}};j(bd,"defaultProps",{...ut.defaultProps,measureExecutionTime:void 0});let a0=bd;const xd=class xd extends ut{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,xd.defaultProps)}};j(xd,"defaultProps",{...ut.defaultProps});let o0=xd;function AW(t){const[e,n]=CW[t],r=e==="i32"||e==="u32",i=e!=="u32",s=NW[e]*n,o=RW(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function RW(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const CW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},NW={f32:4,f16:2,i32:4,u32:4};function cP(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=iP(i),l={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(l.webglOnly=!0),l}function uP(t,e){const n={};for(const r of t.attributes){const i=MW(t,e,r.name);i&&(n[r.name]=i)}return n}function kW(t,e,n=16){const r=uP(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function MW(t,e,n){const r=IW(t,n),i=OW(e,n);if(!r)return null;const s=AW(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,l=cP(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function IW(t,e){const n=t.attributes.find(r=>r.name===e);return n||be.warn(`shader layout attribute "${e}" not present in shader`),n||null}function OW(t,e){PW(t);let n=DW(t,e);return n||(n=jW(t,e),n)?n:(be.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function PW(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&be.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function DW(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function jW(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const l=cP(o.format);i+=l.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const wd=class wd extends ut{constructor(n,r){super(n,r,wd.defaultProps);j(this,"maxVertexAttributes");j(this,"attributeInfos");j(this,"indexBuffer",null);j(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=kW(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};j(wd,"defaultProps",{...ut.defaultProps,renderPipeline:null});let l0=wd;const Td=class Td extends ut{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Td.defaultProps)}};j(Td,"defaultProps",{...ut.defaultProps,layout:void 0,buffers:{}});let c0=Td;const Sd=class Sd extends ut{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Sd.defaultProps)}};j(Sd,"defaultProps",{...ut.defaultProps,type:void 0,count:void 0});let u0=Sd;const LW={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function BW(t){return LW[t]}function UW(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let ef;function fP(t){return(!ef||ef.byteLength<t)&&(ef=new ArrayBuffer(t)),ef}function FW(t,e){const n=fP(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function zW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Xf(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":zW(t)}const jk=1024;class qW{constructor(e){j(this,"layout",{});j(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=BW(s),{type:l,components:u}=o;n=UW(n,u);const d=n;n+=u,this.layout[i]={type:l,size:u,offset:d}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,jk)}getData(e){const n=Math.max(this.byteLength,jk),r=fP(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const l=this.layout[s];if(!l){be.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:d,offset:h}=l,g=i[u];if(d===1){if(typeof o!="number"&&typeof o!="boolean"){be.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}g[h]=Number(o)}else{if(!Xf(o)){be.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}g.set(o,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function VW(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!Xf(r))return!1;if(Xf(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function $W(t){return Xf(t)?t.slice():t}class HW{constructor(e){j(this,"name");j(this,"uniforms",{});j(this,"modifiedUniforms",{});j(this,"modified",!0);j(this,"bindingLayout",{});j(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){VW(this.uniforms[e],n)||(this.uniforms[e]=$W(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class WW{constructor(e){j(this,"uniformBlocks",new Map);j(this,"uniformBufferLayouts",new Map);j(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new qW(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new HW({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:wt.UNIFORM|wt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:wt.UNIFORM|wt.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&be.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const l=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();be.log(4,`Writing to uniform buffer ${String(e)}`,o,l)()}return i}}function dP(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function hP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function XW(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=dP(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class lx{constructor(e){j(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&be.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function YW(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(h=>h.attribute):[i.name],l=s.attributes?s.attributes.map(h=>h.attribute):[s.name],u=Math.min(...o.map(h=>n[h])),d=Math.min(...l.map(h=>n[h]));return u-d}),r}class ur{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Lk{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ts extends ur{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class is extends ur{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class f0 extends ur{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Us extends ur{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Yi;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Yi||(Yi={}));class tf{constructor(e,n,r,i,s,o,l){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class GW{constructor(e,n){this.name=e,this.type=n}}class KW{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Bk{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class ZW{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class QW{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class JW{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class eX{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const pP=new Float32Array(1),tX=new Int32Array(pP.buffer),vn=new Uint16Array(1);function nX(t){pP[0]=t;const e=tX[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return vn[0]=n<<15|31744|(i!==0?512:0),vn[0];if(r===0){if(i===0)return vn[0]=n<<15,vn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),vn[0]=n<<15|r<<10|i>>13,vn[0]):(vn[0]=n<<15,vn[0])}return r=r-127+15,r>=31?(vn[0]=n<<15|31744,vn[0]):r<=0?r<-10?(vn[0]=n<<15,vn[0]):(i=(8388608|i)>>1-r,vn[0]=n<<15|i>>13,vn[0]):(i>>=13,vn[0]=n<<15|r<<10|i,vn[0])}const P1=new Uint32Array(1),gP=new Float32Array(P1.buffer,0,1);function Uk(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return P1[0]=e,gP[0]}function rX(t,e,n,r,i,s,o,l,u){const d=r*(o>>=i)*(s>>=i)+n*o+e*l;switch(u){case"r8unorm":return[Qe(t,d,"8unorm",1)[0]];case"r8snorm":return[Qe(t,d,"8snorm",1)[0]];case"r8uint":return[Qe(t,d,"8uint",1)[0]];case"r8sint":return[Qe(t,d,"8sint",1)[0]];case"rg8unorm":{const h=Qe(t,d,"8unorm",2);return[h[0],h[1]]}case"rg8snorm":{const h=Qe(t,d,"8snorm",2);return[h[0],h[1]]}case"rg8uint":{const h=Qe(t,d,"8uint",2);return[h[0],h[1]]}case"rg8sint":{const h=Qe(t,d,"8sint",2);return[h[0],h[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const h=Qe(t,d,"8unorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8snorm":{const h=Qe(t,d,"8snorm",4);return[h[0],h[1],h[2],h[3]]}case"rgba8uint":{const h=Qe(t,d,"8uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba8sint":{const h=Qe(t,d,"8sint",4);return[h[0],h[1],h[2],h[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const h=Qe(t,d,"8unorm",4);return[h[2],h[1],h[0],h[3]]}case"r16uint":return[Qe(t,d,"16uint",1)[0]];case"r16sint":return[Qe(t,d,"16sint",1)[0]];case"r16float":return[Qe(t,d,"16float",1)[0]];case"rg16uint":{const h=Qe(t,d,"16uint",2);return[h[0],h[1]]}case"rg16sint":{const h=Qe(t,d,"16sint",2);return[h[0],h[1]]}case"rg16float":{const h=Qe(t,d,"16float",2);return[h[0],h[1]]}case"rgba16uint":{const h=Qe(t,d,"16uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16sint":{const h=Qe(t,d,"16sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba16float":{const h=Qe(t,d,"16float",4);return[h[0],h[1],h[2],h[3]]}case"r32uint":return[Qe(t,d,"32uint",1)[0]];case"r32sint":return[Qe(t,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Qe(t,d,"32float",1)[0]];case"rg32uint":{const h=Qe(t,d,"32uint",2);return[h[0],h[1]]}case"rg32sint":{const h=Qe(t,d,"32sint",2);return[h[0],h[1]]}case"rg32float":{const h=Qe(t,d,"32float",2);return[h[0],h[1]]}case"rgba32uint":{const h=Qe(t,d,"32uint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32sint":{const h=Qe(t,d,"32sint",4);return[h[0],h[1],h[2],h[3]]}case"rgba32float":{const h=Qe(t,d,"32float",4);return[h[0],h[1],h[2],h[3]]}case"rg11b10ufloat":{const h=new Uint32Array(t.buffer,d,1)[0],g=(4192256&h)>>11,_=(4290772992&h)>>22;return[Uk(2047&h),Uk(g),function(y){const T=112+(y>>5&31)<<23|(31&y)<<18;return P1[0]=T,gP[0]}(_),1]}}return null}function Qe(t,e,n,r){const i=[0,0,0,0];for(let d=0;d<r;++d)switch(n){case"8unorm":i[d]=t[e]/255,e++;break;case"8snorm":i[d]=t[e]/255*2-1,e++;break;case"8uint":i[d]=t[e],e++;break;case"8sint":i[d]=t[e]-127,e++;break;case"16uint":i[d]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[d]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[d]=(s=t[e]|t[e+1]<<8,o=void 0,l=void 0,u=void 0,o=(32768&s)>>15,u=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):l==31?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+u/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[d]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[d]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,o,l,u;return i}function nt(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=nX(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const cx={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class mr{constructor(){this.id=mr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(Yf.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Gf.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}mr._id=0;class Yf extends mr{}Yf.instance=new Yf;class Gf extends mr{}Gf.instance=new Gf;const mP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class St extends mr{constructor(){super()}}class uc extends St{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class iX extends St{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class _P extends St{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class d0 extends St{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class vP extends St{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class pi extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class D1 extends St{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Yl extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class bf extends St{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Ka,Fl,le,ne;(t=>{t.increment="++",t.decrement="--"})(Ka||(Ka={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(Ka||(Ka={}));class yP extends St{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Fl||(Fl={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Fl||(Fl={}));class bP extends St{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class j1 extends St{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return mP.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class xP extends St{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class wP extends St{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class TP extends St{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class SP extends St{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class sX extends St{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class aX extends St{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class EP extends St{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class L1 extends St{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class oX extends St{constructor(){super()}get astNodeType(){return"discard"}}class AP extends St{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class RP extends St{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class _e extends St{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=_e._priority.get(n.name);_e._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?_e.i32:n}getTypeName(){return this.name}}_e.x32=new _e("x32"),_e.f32=new _e("f32"),_e.i32=new _e("i32"),_e.u32=new _e("u32"),_e.f16=new _e("f16"),_e.bool=new _e("bool"),_e.void=new _e("void"),_e._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Fk extends _e{constructor(e){super(e)}}class di extends _e{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class ae extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ae.vec2f=new ae("vec2",_e.f32,null),ae.vec3f=new ae("vec3",_e.f32,null),ae.vec4f=new ae("vec4",_e.f32,null),ae.vec2i=new ae("vec2",_e.i32,null),ae.vec3i=new ae("vec3",_e.i32,null),ae.vec4i=new ae("vec4",_e.i32,null),ae.vec2u=new ae("vec2",_e.u32,null),ae.vec3u=new ae("vec3",_e.u32,null),ae.vec4u=new ae("vec4",_e.u32,null),ae.vec2h=new ae("vec2",_e.f16,null),ae.vec3h=new ae("vec3",_e.f16,null),ae.vec4h=new ae("vec4",_e.f16,null),ae.vec2b=new ae("vec2",_e.bool,null),ae.vec3b=new ae("vec3",_e.bool,null),ae.vec4b=new ae("vec4",_e.bool,null),ae.mat2x2f=new ae("mat2x2",_e.f32,null),ae.mat2x3f=new ae("mat2x3",_e.f32,null),ae.mat2x4f=new ae("mat2x4",_e.f32,null),ae.mat3x2f=new ae("mat3x2",_e.f32,null),ae.mat3x3f=new ae("mat3x3",_e.f32,null),ae.mat3x4f=new ae("mat3x4",_e.f32,null),ae.mat4x2f=new ae("mat4x2",_e.f32,null),ae.mat4x3f=new ae("mat4x3",_e.f32,null),ae.mat4x4f=new ae("mat4x4",_e.f32,null),ae.mat2x2h=new ae("mat2x2",_e.f16,null),ae.mat2x3h=new ae("mat2x3",_e.f16,null),ae.mat2x4h=new ae("mat2x4",_e.f16,null),ae.mat3x2h=new ae("mat3x2",_e.f16,null),ae.mat3x3h=new ae("mat3x3",_e.f16,null),ae.mat3x4h=new ae("mat3x4",_e.f16,null),ae.mat4x2h=new ae("mat4x2",_e.f16,null),ae.mat4x3h=new ae("mat4x3",_e.f16,null),ae.mat4x4h=new ae("mat4x4",_e.f16,null),ae.mat2x2i=new ae("mat2x2",_e.i32,null),ae.mat2x3i=new ae("mat2x3",_e.i32,null),ae.mat2x4i=new ae("mat2x4",_e.i32,null),ae.mat3x2i=new ae("mat3x2",_e.i32,null),ae.mat3x3i=new ae("mat3x3",_e.i32,null),ae.mat3x4i=new ae("mat3x4",_e.i32,null),ae.mat4x2i=new ae("mat4x2",_e.i32,null),ae.mat4x3i=new ae("mat4x3",_e.i32,null),ae.mat4x4i=new ae("mat4x4",_e.i32,null),ae.mat2x2u=new ae("mat2x2",_e.u32,null),ae.mat2x3u=new ae("mat2x3",_e.u32,null),ae.mat2x4u=new ae("mat2x4",_e.u32,null),ae.mat3x2u=new ae("mat3x2",_e.u32,null),ae.mat3x3u=new ae("mat3x3",_e.u32,null),ae.mat3x4u=new ae("mat3x4",_e.u32,null),ae.mat4x2u=new ae("mat4x2",_e.u32,null),ae.mat4x3u=new ae("mat4x3",_e.u32,null),ae.mat4x4u=new ae("mat4x4",_e.u32,null);class xf extends _e{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Gl extends _e{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class zl extends _e{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Ir extends mr{constructor(){super(),this.postfix=null}}class Fs extends Ir{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class zr extends Ir{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class B1 extends Ir{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return mP.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Yn extends Ir{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class CP extends Ir{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Kt extends Ir{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof te}get isVector(){return this.value instanceof X||this.value instanceof Oe}get scalarValue(){return this.value instanceof te?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof X||this.value instanceof Oe?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class NP extends Ir{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class uo extends Ir{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class kP extends Ir{constructor(){super()}}class Vt extends kP{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Tr extends kP{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?_e.f32:e.name==="u32"||n.name==="u32"?_e.u32:_e.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class MP extends mr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class wf extends Ir{constructor(){super()}get astNodeType(){return"default"}}class IP extends MP{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class OP extends MP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class zk extends mr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class lX extends mr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class qk extends mr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class PP extends mr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class hr{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=hr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}hr._id=0;class h0 extends hr{constructor(){super(new ur("void",null),null)}toString(){return"void"}}h0.void=new h0;class $a extends hr{constructor(e){super(new f0("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class te extends hr{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new te(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new te(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new te(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function cX(t,e,n){const r=e.length;return r===2?n==="f32"?new X(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new X(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new X(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new X(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new X(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new X(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new X(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new X(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new X(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new X(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new X(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new X(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class X extends hr{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new X(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new X(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new X(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Fs?console.error("TODO: Set vector postfix"):n instanceof X?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Us)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof uo){const o=n.index;let l=-1;if(o instanceof Kt){if(!(o.value instanceof te))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof te))return console.error("GetSubData: Unknown index type",o),null;l=u.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new te(u,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Fs))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new te(d,i,this)}}const l=[];for(const u of o)u==="x"||u==="r"?l.push(this.data[0]):u==="y"||u==="g"?l.push(this.data[1]):u==="z"||u==="b"?l.push(this.data[2]):u==="w"||u==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=cX(e,l,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Oe extends hr{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Oe(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Fs?console.error("TODO: Set matrix postfix"):n instanceof Oe?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Us)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof uo){const s=n.index;let o=-1;if(s instanceof Kt){if(!(s.value instanceof te))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const d=e.evalExpression(s,r);if(!(d instanceof te))return console.error("GetDataValue: Unknown index type",s),null;o=d.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${l}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${l}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new X(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${l}`))}return n.postfix?u.getSubData(e,n.postfix,r):u}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Ot extends hr{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Ot(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof uo)if(o instanceof is){const l=r.index;if(l instanceof Kt){if(!(l.value instanceof te))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const u=e.evalExpression(l,i);if(!(u instanceof te))return void console.error("SetDataValue: Unknown index type",l);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Fs))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(o instanceof ts){let u=!1;for(const d of o.members)if(d.name===l){s+=d.offset,o=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof ur){const u=o.getTypeName();let d=0;if(l==="x"||l==="r")d=0;else if(l==="y"||l==="g")d=1;else if(l==="z"||l==="b")d=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);d=3}if(!(n instanceof te))return void console.error("SetDataValue: Invalid value",n);const h=n.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=h):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=h):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=h):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=h):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=h):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=h):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=h):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=h):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=h):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(n instanceof Ot){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,i,16);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11],l[12]=n.data[12],l[13]=n.data[13],l[14]=n.data[14],l[15]=n.data[15]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,12);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8],l[9]=n.data[9],l[10]=n.data[10],l[11]=n.data[11]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11])}else{const l=new Float32Array(this.buffer,i,9);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7],l[8]=n.data[8]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,8);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5],l[6]=n.data[6],l[7]=n.data[7]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7])}else{const l=new Float32Array(this.buffer,i,6);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3],l[4]=n.data[4],l[5]=n.data[5]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5])}else{const l=new Float32Array(this.buffer,i,4);n instanceof Oe?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Uint32Array(this.buffer,i,4);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Uint32Array(this.buffer,i,3);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Uint32Array(this.buffer,i,2);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Int32Array(this.buffer,i,4);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Int32Array(this.buffer,i,3);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Int32Array(this.buffer,i,2);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else{const l=new Float32Array(this.buffer,i,4);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2],l[3]=n.data[3]):(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3])}else{const l=new Float32Array(this.buffer,i,3);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1],l[2]=n.data[2]):(l[0]=n[0],l[1]=n[1],l[2]=n[2])}else{const l=new Float32Array(this.buffer,i,2);n instanceof X?(l[0]=n.data[0],l[1]=n.data[1]):(l[0]=n[0],l[1]=n[1])}else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof te&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let l=this.offset,u=this.typeInfo;for(;n;){if(n instanceof uo){const h=n.index,g=h instanceof Ir?e.evalExpression(h,r):h;let _=0;if(g instanceof te?_=g.value:typeof g=="number"?_=g:console.error("GetDataValue: Invalid index type",h),u instanceof is)l+=_*u.stride,u=u.format;else{const y=u.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(l+=16*_,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(n instanceof Fs))return console.error("GetDataValue: Unknown postfix type",n),null;{const h=n.value;if(u instanceof ts){let g=!1;for(const _ of u.members)if(_.name===h){l+=_.offset,u=_.type,g=!0;break}if(!g)return console.error(`GetDataValue: Member ${h} not found`),null}else if(u instanceof ur){const g=u.getTypeName();if(g==="vec2f"||g==="vec3f"||g==="vec4f"||g==="vec2i"||g==="vec3i"||g==="vec4i"||g==="vec2u"||g==="vec3u"||g==="vec4u"||g==="vec2b"||g==="vec3b"||g==="vec4b"||g==="vec2h"||g==="vec3h"||g==="vec4h"||g==="vec2"||g==="vec3"||g==="vec4"){if(h.length>0&&h.length<5){let _="f";const y=[];for(let T=0;T<h.length;++T){const w=h[T].toLowerCase();let x=0;if(w==="x"||w==="r")x=0;else if(w==="y"||w==="g")x=1;else if(w==="z"||w==="b")x=2;else{if(w!=="w"&&w!=="a")return console.error(`Unknown member ${h}`),null;x=3}if(h.length===1){if(g.endsWith("f"))return this.buffer.byteLength<l+4*x+4?(console.log("Insufficient buffer data"),null):new te(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f32"),this);if(g.endsWith("h"))return new te(new Float32Array(this.buffer,l+4*x,1),e.getTypeInfo("f16"),this);if(g.endsWith("i"))return new te(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this);if(g.endsWith("b"))return new te(new Int32Array(this.buffer,l+4*x,1),e.getTypeInfo("bool"),this);if(g.endsWith("u"))return new te(new Uint32Array(this.buffer,l+4*x,1),e.getTypeInfo("i32"),this)}if(g==="vec2f")y.push(new Float32Array(this.buffer,l,2)[x]);else if(g==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const S=new Float32Array(this.buffer,l,3);y.push(S[x])}else if(g==="vec4f")y.push(new Float32Array(this.buffer,l,4)[x]);else if(g==="vec2i")_="i",y.push(new Int32Array(this.buffer,l,2)[x]);else if(g==="vec3i")_="i",y.push(new Int32Array(this.buffer,l,3)[x]);else if(g==="vec4i")_="i",y.push(new Int32Array(this.buffer,l,4)[x]);else if(g==="vec2u"){_="u";const S=new Uint32Array(this.buffer,l,2);y.push(S[x])}else g==="vec3u"?(_="u",y.push(new Uint32Array(this.buffer,l,3)[x])):g==="vec4u"&&(_="u",y.push(new Uint32Array(this.buffer,l,4)[x]))}return y.length===2?u=e.getTypeInfo(`vec2${_}`):y.length===3?u=e.getTypeInfo(`vec3${_}`):y.length===4?u=e.getTypeInfo(`vec4${_}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new X(y,u,null)}return console.error(`GetDataValue: Unknown member ${h}`),null}return console.error(`GetDataValue: Type ${g} is not a struct`),null}}}n=n.postfix}const d=u.getTypeName();return d==="f32"?new te(new Float32Array(this.buffer,l,1),u,this):d==="i32"?new te(new Int32Array(this.buffer,l,1),u,this):d==="u32"?new te(new Uint32Array(this.buffer,l,1),u,this):d==="vec2f"?new X(new Float32Array(this.buffer,l,2),u,this):d==="vec3f"?new X(new Float32Array(this.buffer,l,3),u,this):d==="vec4f"?new X(new Float32Array(this.buffer,l,4),u,this):d==="vec2i"?new X(new Int32Array(this.buffer,l,2),u,this):d==="vec3i"?new X(new Int32Array(this.buffer,l,3),u,this):d==="vec4i"?new X(new Int32Array(this.buffer,l,4),u,this):d==="vec2u"?new X(new Uint32Array(this.buffer,l,2),u,this):d==="vec3u"?new X(new Uint32Array(this.buffer,l,3),u,this):d==="vec4u"?new X(new Uint32Array(this.buffer,l,4),u,this):u instanceof Us&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new te(new Uint32Array(this.buffer,l,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new te(new Int32Array(this.buffer,l,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Ot(this.buffer,u,l,this)}toString(){let e="";if(this.typeInfo instanceof is)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof ts?e+="{...}":e="[...]";return e}}class hi extends hr{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new hi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=cx[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=cx[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=cx[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[i];return rX(new Uint8Array(u),e,n,r,i,l,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,l=this.bytesPerRow,u=this.height,d=this.data[i];(function(h,g,_,y,T,w,x,S,A,R){const E=y*(x>>=T)*(w>>=T)+_*x+g*S;switch(A){case"r8unorm":return void nt(h,E,"8unorm",1,R);case"r8snorm":return void nt(h,E,"8snorm",1,R);case"r8uint":return void nt(h,E,"8uint",1,R);case"r8sint":return void nt(h,E,"8sint",1,R);case"rg8unorm":return void nt(h,E,"8unorm",2,R);case"rg8snorm":return void nt(h,E,"8snorm",2,R);case"rg8uint":return void nt(h,E,"8uint",2,R);case"rg8sint":return void nt(h,E,"8sint",2,R);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void nt(h,E,"8unorm",4,R);case"rgba8snorm":return void nt(h,E,"8snorm",4,R);case"rgba8uint":return void nt(h,E,"8uint",4,R);case"rgba8sint":return void nt(h,E,"8sint",4,R);case"r16uint":return void nt(h,E,"16uint",1,R);case"r16sint":return void nt(h,E,"16sint",1,R);case"r16float":return void nt(h,E,"16float",1,R);case"rg16uint":return void nt(h,E,"16uint",2,R);case"rg16sint":return void nt(h,E,"16sint",2,R);case"rg16float":return void nt(h,E,"16float",2,R);case"rgba16uint":return void nt(h,E,"16uint",4,R);case"rgba16sint":return void nt(h,E,"16sint",4,R);case"rgba16float":return void nt(h,E,"16float",4,R);case"r32uint":return void nt(h,E,"32uint",1,R);case"r32sint":return void nt(h,E,"32sint",1,R);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void nt(h,E,"32float",1,R);case"rg32uint":return void nt(h,E,"32uint",2,R);case"rg32sint":return void nt(h,E,"32sint",2,R);case"rg32float":return void nt(h,E,"32float",2,R);case"rgba32uint":return void nt(h,E,"32uint",4,R);case"rgba32sint":return void nt(h,E,"32sint",4,R);case"rgba32float":return void nt(h,E,"32float",4,R);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,n,r,i,u,l,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ne||(ne={}));class re{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class V{}le=V,V.none=new re("",ne.reserved,""),V.eof=new re("EOF",ne.token,""),V.reserved={asm:new re("asm",ne.reserved,"asm"),bf16:new re("bf16",ne.reserved,"bf16"),do:new re("do",ne.reserved,"do"),enum:new re("enum",ne.reserved,"enum"),f16:new re("f16",ne.reserved,"f16"),f64:new re("f64",ne.reserved,"f64"),handle:new re("handle",ne.reserved,"handle"),i8:new re("i8",ne.reserved,"i8"),i16:new re("i16",ne.reserved,"i16"),i64:new re("i64",ne.reserved,"i64"),mat:new re("mat",ne.reserved,"mat"),premerge:new re("premerge",ne.reserved,"premerge"),regardless:new re("regardless",ne.reserved,"regardless"),typedef:new re("typedef",ne.reserved,"typedef"),u8:new re("u8",ne.reserved,"u8"),u16:new re("u16",ne.reserved,"u16"),u64:new re("u64",ne.reserved,"u64"),unless:new re("unless",ne.reserved,"unless"),using:new re("using",ne.reserved,"using"),vec:new re("vec",ne.reserved,"vec"),void:new re("void",ne.reserved,"void")},V.keywords={array:new re("array",ne.keyword,"array"),atomic:new re("atomic",ne.keyword,"atomic"),bool:new re("bool",ne.keyword,"bool"),f32:new re("f32",ne.keyword,"f32"),i32:new re("i32",ne.keyword,"i32"),mat2x2:new re("mat2x2",ne.keyword,"mat2x2"),mat2x3:new re("mat2x3",ne.keyword,"mat2x3"),mat2x4:new re("mat2x4",ne.keyword,"mat2x4"),mat3x2:new re("mat3x2",ne.keyword,"mat3x2"),mat3x3:new re("mat3x3",ne.keyword,"mat3x3"),mat3x4:new re("mat3x4",ne.keyword,"mat3x4"),mat4x2:new re("mat4x2",ne.keyword,"mat4x2"),mat4x3:new re("mat4x3",ne.keyword,"mat4x3"),mat4x4:new re("mat4x4",ne.keyword,"mat4x4"),ptr:new re("ptr",ne.keyword,"ptr"),sampler:new re("sampler",ne.keyword,"sampler"),sampler_comparison:new re("sampler_comparison",ne.keyword,"sampler_comparison"),struct:new re("struct",ne.keyword,"struct"),texture_1d:new re("texture_1d",ne.keyword,"texture_1d"),texture_2d:new re("texture_2d",ne.keyword,"texture_2d"),texture_2d_array:new re("texture_2d_array",ne.keyword,"texture_2d_array"),texture_3d:new re("texture_3d",ne.keyword,"texture_3d"),texture_cube:new re("texture_cube",ne.keyword,"texture_cube"),texture_cube_array:new re("texture_cube_array",ne.keyword,"texture_cube_array"),texture_multisampled_2d:new re("texture_multisampled_2d",ne.keyword,"texture_multisampled_2d"),texture_storage_1d:new re("texture_storage_1d",ne.keyword,"texture_storage_1d"),texture_storage_2d:new re("texture_storage_2d",ne.keyword,"texture_storage_2d"),texture_storage_2d_array:new re("texture_storage_2d_array",ne.keyword,"texture_storage_2d_array"),texture_storage_3d:new re("texture_storage_3d",ne.keyword,"texture_storage_3d"),texture_depth_2d:new re("texture_depth_2d",ne.keyword,"texture_depth_2d"),texture_depth_2d_array:new re("texture_depth_2d_array",ne.keyword,"texture_depth_2d_array"),texture_depth_cube:new re("texture_depth_cube",ne.keyword,"texture_depth_cube"),texture_depth_cube_array:new re("texture_depth_cube_array",ne.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new re("texture_depth_multisampled_2d",ne.keyword,"texture_depth_multisampled_2d"),texture_external:new re("texture_external",ne.keyword,"texture_external"),u32:new re("u32",ne.keyword,"u32"),vec2:new re("vec2",ne.keyword,"vec2"),vec3:new re("vec3",ne.keyword,"vec3"),vec4:new re("vec4",ne.keyword,"vec4"),bitcast:new re("bitcast",ne.keyword,"bitcast"),block:new re("block",ne.keyword,"block"),break:new re("break",ne.keyword,"break"),case:new re("case",ne.keyword,"case"),continue:new re("continue",ne.keyword,"continue"),continuing:new re("continuing",ne.keyword,"continuing"),default:new re("default",ne.keyword,"default"),diagnostic:new re("diagnostic",ne.keyword,"diagnostic"),discard:new re("discard",ne.keyword,"discard"),else:new re("else",ne.keyword,"else"),enable:new re("enable",ne.keyword,"enable"),fallthrough:new re("fallthrough",ne.keyword,"fallthrough"),false:new re("false",ne.keyword,"false"),fn:new re("fn",ne.keyword,"fn"),for:new re("for",ne.keyword,"for"),function:new re("function",ne.keyword,"function"),if:new re("if",ne.keyword,"if"),let:new re("let",ne.keyword,"let"),const:new re("const",ne.keyword,"const"),loop:new re("loop",ne.keyword,"loop"),while:new re("while",ne.keyword,"while"),private:new re("private",ne.keyword,"private"),read:new re("read",ne.keyword,"read"),read_write:new re("read_write",ne.keyword,"read_write"),return:new re("return",ne.keyword,"return"),requires:new re("requires",ne.keyword,"requires"),storage:new re("storage",ne.keyword,"storage"),switch:new re("switch",ne.keyword,"switch"),true:new re("true",ne.keyword,"true"),alias:new re("alias",ne.keyword,"alias"),type:new re("type",ne.keyword,"type"),uniform:new re("uniform",ne.keyword,"uniform"),var:new re("var",ne.keyword,"var"),override:new re("override",ne.keyword,"override"),workgroup:new re("workgroup",ne.keyword,"workgroup"),write:new re("write",ne.keyword,"write"),r8unorm:new re("r8unorm",ne.keyword,"r8unorm"),r8snorm:new re("r8snorm",ne.keyword,"r8snorm"),r8uint:new re("r8uint",ne.keyword,"r8uint"),r8sint:new re("r8sint",ne.keyword,"r8sint"),r16uint:new re("r16uint",ne.keyword,"r16uint"),r16sint:new re("r16sint",ne.keyword,"r16sint"),r16float:new re("r16float",ne.keyword,"r16float"),rg8unorm:new re("rg8unorm",ne.keyword,"rg8unorm"),rg8snorm:new re("rg8snorm",ne.keyword,"rg8snorm"),rg8uint:new re("rg8uint",ne.keyword,"rg8uint"),rg8sint:new re("rg8sint",ne.keyword,"rg8sint"),r32uint:new re("r32uint",ne.keyword,"r32uint"),r32sint:new re("r32sint",ne.keyword,"r32sint"),r32float:new re("r32float",ne.keyword,"r32float"),rg16uint:new re("rg16uint",ne.keyword,"rg16uint"),rg16sint:new re("rg16sint",ne.keyword,"rg16sint"),rg16float:new re("rg16float",ne.keyword,"rg16float"),rgba8unorm:new re("rgba8unorm",ne.keyword,"rgba8unorm"),rgba8unorm_srgb:new re("rgba8unorm_srgb",ne.keyword,"rgba8unorm_srgb"),rgba8snorm:new re("rgba8snorm",ne.keyword,"rgba8snorm"),rgba8uint:new re("rgba8uint",ne.keyword,"rgba8uint"),rgba8sint:new re("rgba8sint",ne.keyword,"rgba8sint"),bgra8unorm:new re("bgra8unorm",ne.keyword,"bgra8unorm"),bgra8unorm_srgb:new re("bgra8unorm_srgb",ne.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new re("rgb10a2unorm",ne.keyword,"rgb10a2unorm"),rg11b10float:new re("rg11b10float",ne.keyword,"rg11b10float"),rg32uint:new re("rg32uint",ne.keyword,"rg32uint"),rg32sint:new re("rg32sint",ne.keyword,"rg32sint"),rg32float:new re("rg32float",ne.keyword,"rg32float"),rgba16uint:new re("rgba16uint",ne.keyword,"rgba16uint"),rgba16sint:new re("rgba16sint",ne.keyword,"rgba16sint"),rgba16float:new re("rgba16float",ne.keyword,"rgba16float"),rgba32uint:new re("rgba32uint",ne.keyword,"rgba32uint"),rgba32sint:new re("rgba32sint",ne.keyword,"rgba32sint"),rgba32float:new re("rgba32float",ne.keyword,"rgba32float"),static_assert:new re("static_assert",ne.keyword,"static_assert")},V.tokens={decimal_float_literal:new re("decimal_float_literal",ne.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new re("hex_float_literal",ne.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new re("int_literal",ne.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new re("uint_literal",ne.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new re("name",ne.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new re("ident",ne.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new re("and",ne.token,"&"),and_and:new re("and_and",ne.token,"&&"),arrow:new re("arrow ",ne.token,"->"),attr:new re("attr",ne.token,"@"),forward_slash:new re("forward_slash",ne.token,"/"),bang:new re("bang",ne.token,"!"),bracket_left:new re("bracket_left",ne.token,"["),bracket_right:new re("bracket_right",ne.token,"]"),brace_left:new re("brace_left",ne.token,"{"),brace_right:new re("brace_right",ne.token,"}"),colon:new re("colon",ne.token,":"),comma:new re("comma",ne.token,","),equal:new re("equal",ne.token,"="),equal_equal:new re("equal_equal",ne.token,"=="),not_equal:new re("not_equal",ne.token,"!="),greater_than:new re("greater_than",ne.token,">"),greater_than_equal:new re("greater_than_equal",ne.token,">="),shift_right:new re("shift_right",ne.token,">>"),less_than:new re("less_than",ne.token,"<"),less_than_equal:new re("less_than_equal",ne.token,"<="),shift_left:new re("shift_left",ne.token,"<<"),modulo:new re("modulo",ne.token,"%"),minus:new re("minus",ne.token,"-"),minus_minus:new re("minus_minus",ne.token,"--"),period:new re("period",ne.token,"."),plus:new re("plus",ne.token,"+"),plus_plus:new re("plus_plus",ne.token,"++"),or:new re("or",ne.token,"|"),or_or:new re("or_or",ne.token,"||"),paren_left:new re("paren_left",ne.token,"("),paren_right:new re("paren_right",ne.token,")"),semicolon:new re("semicolon",ne.token,";"),star:new re("star",ne.token,"*"),tilde:new re("tilde",ne.token,"~"),underscore:new re("underscore",ne.token,"_"),xor:new re("xor",ne.token,"^"),plus_equal:new re("plus_equal",ne.token,"+="),minus_equal:new re("minus_equal",ne.token,"-="),times_equal:new re("times_equal",ne.token,"*="),division_equal:new re("division_equal",ne.token,"/="),modulo_equal:new re("modulo_equal",ne.token,"%="),and_equal:new re("and_equal",ne.token,"&="),or_equal:new re("or_equal",ne.token,"|="),xor_equal:new re("xor_equal",ne.token,"^="),shift_right_equal:new re("shift_right_equal",ne.token,">>="),shift_left_equal:new re("shift_left_equal",ne.token,"<<=")},V.simpleTokens={"@":le.tokens.attr,"{":le.tokens.brace_left,"}":le.tokens.brace_right,":":le.tokens.colon,",":le.tokens.comma,"(":le.tokens.paren_left,")":le.tokens.paren_right,";":le.tokens.semicolon},V.literalTokens={"&":le.tokens.and,"&&":le.tokens.and_and,"->":le.tokens.arrow,"/":le.tokens.forward_slash,"!":le.tokens.bang,"[":le.tokens.bracket_left,"]":le.tokens.bracket_right,"=":le.tokens.equal,"==":le.tokens.equal_equal,"!=":le.tokens.not_equal,">":le.tokens.greater_than,">=":le.tokens.greater_than_equal,">>":le.tokens.shift_right,"<":le.tokens.less_than,"<=":le.tokens.less_than_equal,"<<":le.tokens.shift_left,"%":le.tokens.modulo,"-":le.tokens.minus,"--":le.tokens.minus_minus,".":le.tokens.period,"+":le.tokens.plus,"++":le.tokens.plus_plus,"|":le.tokens.or,"||":le.tokens.or_or,"*":le.tokens.star,"~":le.tokens.tilde,_:le.tokens.underscore,"^":le.tokens.xor,"+=":le.tokens.plus_equal,"-=":le.tokens.minus_equal,"*=":le.tokens.times_equal,"/=":le.tokens.division_equal,"%=":le.tokens.modulo_equal,"&=":le.tokens.and_equal,"|=":le.tokens.or_equal,"^=":le.tokens.xor_equal,">>=":le.tokens.shift_right_equal,"<<=":le.tokens.shift_left_equal},V.regexTokens={decimal_float_literal:le.tokens.decimal_float_literal,hex_float_literal:le.tokens.hex_float_literal,int_literal:le.tokens.int_literal,uint_literal:le.tokens.uint_literal,ident:le.tokens.ident},V.storage_class=[le.keywords.function,le.keywords.private,le.keywords.workgroup,le.keywords.uniform,le.keywords.storage],V.access_mode=[le.keywords.read,le.keywords.write,le.keywords.read_write],V.sampler_type=[le.keywords.sampler,le.keywords.sampler_comparison],V.sampled_texture_type=[le.keywords.texture_1d,le.keywords.texture_2d,le.keywords.texture_2d_array,le.keywords.texture_3d,le.keywords.texture_cube,le.keywords.texture_cube_array],V.multisampled_texture_type=[le.keywords.texture_multisampled_2d],V.storage_texture_type=[le.keywords.texture_storage_1d,le.keywords.texture_storage_2d,le.keywords.texture_storage_2d_array,le.keywords.texture_storage_3d],V.depth_texture_type=[le.keywords.texture_depth_2d,le.keywords.texture_depth_2d_array,le.keywords.texture_depth_cube,le.keywords.texture_depth_cube_array,le.keywords.texture_depth_multisampled_2d],V.texture_external_type=[le.keywords.texture_external],V.any_texture_type=[...le.sampled_texture_type,...le.multisampled_texture_type,...le.storage_texture_type,...le.depth_texture_type,...le.texture_external_type],V.texel_format=[le.keywords.r8unorm,le.keywords.r8snorm,le.keywords.r8uint,le.keywords.r8sint,le.keywords.r16uint,le.keywords.r16sint,le.keywords.r16float,le.keywords.rg8unorm,le.keywords.rg8snorm,le.keywords.rg8uint,le.keywords.rg8sint,le.keywords.r32uint,le.keywords.r32sint,le.keywords.r32float,le.keywords.rg16uint,le.keywords.rg16sint,le.keywords.rg16float,le.keywords.rgba8unorm,le.keywords.rgba8unorm_srgb,le.keywords.rgba8snorm,le.keywords.rgba8uint,le.keywords.rgba8sint,le.keywords.bgra8unorm,le.keywords.bgra8unorm_srgb,le.keywords.rgb10a2unorm,le.keywords.rg11b10float,le.keywords.rg32uint,le.keywords.rg32sint,le.keywords.rg32float,le.keywords.rgba16uint,le.keywords.rgba16sint,le.keywords.rgba16float,le.keywords.rgba32uint,le.keywords.rgba32sint,le.keywords.rgba32float],V.const_literal=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.keywords.true,le.keywords.false],V.literal_or_ident=[le.tokens.ident,le.tokens.int_literal,le.tokens.uint_literal,le.tokens.decimal_float_literal,le.tokens.hex_float_literal,le.tokens.name],V.element_count_expression=[le.tokens.int_literal,le.tokens.uint_literal,le.tokens.ident],V.template_types=[le.keywords.vec2,le.keywords.vec3,le.keywords.vec4,le.keywords.mat2x2,le.keywords.mat2x3,le.keywords.mat2x4,le.keywords.mat3x2,le.keywords.mat3x3,le.keywords.mat3x4,le.keywords.mat4x2,le.keywords.mat4x3,le.keywords.mat4x4,le.keywords.atomic,le.keywords.bitcast,...le.any_texture_type],V.attribute_name=[le.tokens.ident,le.keywords.block,le.keywords.diagnostic],V.assignment_operators=[le.tokens.equal,le.tokens.plus_equal,le.tokens.minus_equal,le.tokens.times_equal,le.tokens.division_equal,le.tokens.modulo_equal,le.tokens.and_equal,le.tokens.or_equal,le.tokens.xor_equal,le.tokens.shift_right_equal,le.tokens.shift_left_equal],V.increment_operators=[le.tokens.plus_plus,le.tokens.minus_minus];class Vk{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return V.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==V.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class uX{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Vk(V.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=V.simpleTokens[e];if(n)return this._addToken(n),!0;let r=V.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=V.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(V.tokens.ident),!0;for(;;){let o=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(V.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(V.tokens.minus_minus),!0;const u=this._tokens.length-1;if((V.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==V.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(e==">"&&(l==">"||l=="=")){let u=!1,d=this._tokens.length-1;for(let h=0;h<5&&d>=0&&V.assignment_operators.indexOf(this._tokens[d].type)===-1;++h,--d)if(this._tokens[d].type===V.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===V.none){let u=e,d=0;const h=2;for(let g=0;g<h;++g)if(u+=this._peekAhead(g),o=this._findType(u),o!==V.none){d=g;break}if(o===V.none)return r!==V.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=d+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==V.none&&(this._addToken(r),!0)}_findType(e){for(const r in V.regexTokens){const i=V.regexTokens[r];if(this._match(e,i.rule))return i}return V.literalTokens[e]||V.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Vk(e,n,this._line,this._start,this._current))}}function Te(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const Kf=new Float32Array(1),fX=new Uint32Array(Kf.buffer),dX=new Uint32Array(Kf.buffer),Zf=new Int32Array(1),hX=new Float32Array(Zf.buffer),pX=new Uint32Array(Zf.buffer),Qf=new Uint32Array(1),gX=new Float32Array(Qf.buffer),mX=new Int32Array(Qf.buffer);function $k(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return Kf[0]=t,fX[0];if(n==="u32")return Kf[0]=t,dX[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return Zf[0]=t,hX[0];if(n==="u32")return Zf[0]=t,pX[0]}else if(e==="u32"){if(n==="f32")return Qf[0]=t,gX[0];if(n==="i32"||n==="x32")return Qf[0]=t,mX[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class _X{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class nf{constructor(e,n){this.align=e,this.size=n}}class Vr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new eX,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof uc&&this._functions.set(n.name,new _X(n));for(const n of e)if(n instanceof di){const r=this.getTypeInfo(n,null);r instanceof ts&&this.structs.push(r)}for(const n of e)if(n instanceof L1)this.aliases.push(this._getAliasInfo(n));else if(n instanceof D1){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new ZW(r.name,s,r.attributes,i))}else if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new tf(r.name,o,i,s,r.attributes,Yi.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new tf(r.name,o,i,s,r.attributes,l?Yi.StorageTexture:Yi.Storage,r.access);u.access||(u.access="read"),this.storage.push(u)}else if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(o),u=new tf(r.name,o,i,s,r.attributes,l?Yi.StorageTexture:Yi.Texture,r.access);u.access||(u.access="read"),l?this.storage.push(u):this.textures.push(u)}else if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),l=new tf(r.name,o,i,s,r.attributes,Yi.Sampler,r.access);this.samplers.push(l)}for(const n of e)if(n instanceof uc){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,l=new JW(n.name,o==null?void 0:o.name,n.attributes);l.attributes=n.attributes,l.startLine=n.startLine,l.endLine=n.endLine,this.functions.push(l),this._functions.get(n.name).info=l,o&&(this._functions.get(n.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(n,!!o),l.inputs=this._getInputs(n.args),l.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(l)),l.arguments=n.args.map(u=>new QW(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),l.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof PP){if(r.value)if(Te(r.value))for(const l of r.value)for(const u of this.overrides)l===u.name&&((i=n.info)===null||i===void 0||i.overrides.push(u));else for(const l of this.overrides)r.value===l.name&&((s=n.info)===null||s===void 0||s.overrides.push(l))}else if(r instanceof Yn)for(const l of this.overrides)r.name===l.name&&((o=n.info)===null||o===void 0||o.overrides.push(l))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Yf)s.push({});else if(o instanceof Gf)s.pop();else if(o instanceof pi){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof zr){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof Yl){const l=o;n&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof Yn){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const u=i._findResource(l.name);u&&r.push(u)}else if(o instanceof B1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}else if(o instanceof j1){const l=o,u=i._functions.get(l.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof di)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof di)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),l=new Bk(r.name,s,i.name,o);n.push(l)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Bk("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof di)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof di)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new KW(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new GW(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof xf){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new f0(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Gl){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new is(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof di){const i=e,s=new ts(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new Lk(o.name,l,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof zl){const i=e,s=i.format instanceof _e,o=i.format?s?this.getTypeInfo(i.format,null):new ur(i.format,null):null,l=new Us(i.name,o,n,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof ae){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Us(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new ur(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof is&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof f0&&this._updateTypeInfo(e.format),e instanceof ts&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let l=0,u=e.members.length;l<u;++l){const d=e.members[l],h=this._getTypeSize(d);if(!h)continue;(n=this._getAlias(d.type.name))!==null&&n!==void 0||d.type;const g=h.align,_=h.size;r=this._roundUp(g,r+i),i=_,s=r,o=Math.max(o,g),d.offset=r,d.size=_,this._updateTypeInfo(d.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Lk&&(e=e.type),e instanceof ur){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Vr._typeInfo[e.name];if(o!==void 0){const l=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new nf(Math.max(s,o.align/l),Math.max(i,o.size/l))}}{const o=Vr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const l=e.name[e.name.length-1]==="h"?2:1;return new nf(Math.max(s,o.align/l),Math.max(i,o.size/l))}}if(e instanceof is){let o=e,l=8,u=8;const d=this._getTypeSize(o.format);return d!==null&&(u=d.size,l=d.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,u)),i&&(u=i),new nf(Math.max(s,l),Math.max(i,u))}if(e instanceof ts){let o=0,l=0,u=0,d=0,h=0;for(const g of e.members){const _=this._getTypeSize(g.type);_!==null&&(o=Math.max(_.align,o),u=this._roundUp(_.align,u+d),d=_.size,h=u)}return l=this._roundUp(o,h+d),new nf(Math.max(s,o),Math.max(i,l))}return null}_isUniformVar(e){return e instanceof pi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof pi&&e.storage=="storage"}_isTextureVar(e){return e instanceof pi&&e.type!==null&&Vr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof pi&&e.type!==null&&Vr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Vr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Vr._textureTypes=V.any_texture_type.map(t=>t.name),Vr._samplerTypes=V.sampler_type.map(t=>t.name);let U1=0;class F1{constructor(e,n,r){this.id=U1++,this.name=e,this.value=n,this.node=r}clone(){return new F1(this.name,this.value,this.node)}}class z1{constructor(e){this.id=U1++,this.name=e.name,this.node=e}clone(){return new z1(this.node)}}class q1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=U1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new F1(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new q1(this)}}class vX{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class yX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof X)return r.data.forEach(s=>{s||(i=!1)}),new te(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X){const i=r.data.some(s=>s);return new te(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof te))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Ot&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new te(o,this.getTypeInfo("u32"))}return new te(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new te(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new te(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new te(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new te(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new te(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new te(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new te(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X)return new X(r.data.map((l,u)=>Math.atan2(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new te(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof X&&i instanceof X&&s instanceof X)return new X(r.data.map((d,h)=>this._clamp(d,i.data[h],s.data[h])),r.typeInfo);const o=r,l=i,u=s;return new te(this._clamp(o.value,l.value,u.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new te(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new te(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new te(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new te(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new X([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof X?new X(r.data.map(s=>s*i),r.typeInfo):new te(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Oe){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new te(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new te(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X){let l=0;for(let u=0;u<r.data.length;++u)l+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new te(Math.sqrt(l),this.getTypeInfo("f32"))}const s=r,o=i;return new te(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof X&&i instanceof X?new te(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new te(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new te(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,l=s.value;if(r instanceof X)return new X(r.data.map(d=>d>>o&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new te(u>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof X&&i instanceof X&&s instanceof X){const o=this._dot(i.data,s.data);return new X(o<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new te(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new te(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new te(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof X&&i instanceof X&&s instanceof X)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new X(r.data.map((d,h)=>d*i.data[h]+s.data[h]),r.typeInfo);const o=r,l=i,u=s;return new te(o.value*l.value+u.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new te(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=s.value,u=(1<<o.value)-1<<l,d=~u;if(r instanceof X&&i instanceof X)return new X(r.data.map((_,y)=>_&d|i.data[y]<<l&u),r.typeInfo);const h=r.value,g=i.value;return new te(h&d|g<<l&u,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new te(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X){let s=0;return r.data.forEach(o=>{s+=o*o}),new te(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new te(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new te(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new te(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X)return new X(r.data.map((l,u)=>Math.max(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X)return new X(r.data.map((l,u)=>Math.min(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof X&&i instanceof X&&s instanceof X)return new X(r.data.map((u,d)=>r.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),r.typeInfo);const o=i,l=s;return new te(r.value*(1-l.value)+o.value*l.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X)return new X(r.data.map((o,l)=>o%i.data[l]),r.typeInfo);const s=i;return new te(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X){const i=this.Length(e,n).value;return new X(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X)return new X(r.data.map((l,u)=>Math.pow(l,i.data[u])),r.typeInfo);const s=r,o=i;return new te(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof X?new X(r.data.map(i=>i),r.typeInfo):new te(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof X?new X(r.data.map(i=>i*Math.PI/180),r.typeInfo):new te(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof X&&i instanceof X){const s=this._dot(r.data,i.data);return new X(r.data.map((o,l)=>o-2*s*i.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof X&&i instanceof X&&s instanceof te){const o=this._dot(i.data,r.data);return new X(r.data.map((l,u)=>{const d=1-s.value*s.value*(1-o*o);if(d<0)return 0;const h=Math.sqrt(d);return s.value*l-(s.value*o+h)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new te(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new te(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new te(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new te(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new te(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof X&&r instanceof X&&i instanceof X)return new X(s.data.map((d,h)=>this._smoothstep(r.data[h],i.data[h],d)),s.typeInfo);const o=r,l=i,u=s;return new te(this._smoothstep(o.value,l.value,u.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new te(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof X&&r instanceof X)return new X(i.data.map((o,l)=>o<r.data[l]?0:1),i.typeInfo);const s=r;return new te(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new te(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new te(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof Oe))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Oe([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Oe([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Oe([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Oe([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Oe([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Oe([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof X)return new X(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new te(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof Yn){const s=r.name,o=n.getVariableValue(s);if(o instanceof hi){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new te(l[0],this.getTypeInfo("u32")):u==="3d"?new X(l,this.getTypeInfo("vec3u")):u==="2d"?new X(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof X)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Yn){const o=r.name,l=n.getVariableValue(o);if(l instanceof hi){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=l.width||d<0||d>=l.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const h=l.getPixel(u,d,0,s);return h===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new X(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof Yn){const i=r.name,s=n.getVariableValue(i);return s instanceof hi?new te(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof Yn){const i=r.name,s=n.getVariableValue(i);return s instanceof hi?new te(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof Yn){const i=r.name,s=n.getVariableValue(i);return s instanceof hi?new te(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof X)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Yn){const l=r.name,u=n.getVariableValue(l);if(u instanceof hi){const d=u.getMipLevelSize(0),h=Math.floor(i.data[0]),g=Math.floor(i.data[1]);return h<0||h>=d[0]||g<0||g>=d[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(u.setPixel(h,g,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value+=l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicSub(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value-=l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMax(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.max(u.value,l.value)),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicMin(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=Math.min(u.value,l.value)),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicAnd(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value&l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicOr(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value|l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicXor(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=u.value^l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicExchange(e,n){let r=e.args[0];r instanceof Vt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const l=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),d=new te(u.value,u.typeInfo);return u instanceof te&&l instanceof te&&(u.value=l.value),s.value instanceof Ot&&s.value.setDataValue(this.exec,u,r.postfix,n),d}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const ux={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Tn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class yn extends vX{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Vr,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new q1,this.builtins=new yX(this),this.typeInfo={bool:this.getTypeInfo(_e.bool),i32:this.getTypeInfo(_e.i32),u32:this.getTypeInfo(_e.u32),f32:this.getTypeInfo(_e.f32),f16:this.getTypeInfo(_e.f16),vec2f:this.getTypeInfo(ae.vec2f),vec2u:this.getTypeInfo(ae.vec2u),vec2i:this.getTypeInfo(ae.vec2i),vec2h:this.getTypeInfo(ae.vec2h),vec3f:this.getTypeInfo(ae.vec3f),vec3u:this.getTypeInfo(ae.vec3u),vec3i:this.getTypeInfo(ae.vec3i),vec3h:this.getTypeInfo(ae.vec3h),vec4f:this.getTypeInfo(ae.vec4f),vec4u:this.getTypeInfo(ae.vec4u),vec4i:this.getTypeInfo(ae.vec4i),vec4h:this.getTypeInfo(ae.vec4h),mat2x2f:this.getTypeInfo(ae.mat2x2f),mat2x3f:this.getTypeInfo(ae.mat2x3f),mat2x4f:this.getTypeInfo(ae.mat2x4f),mat3x2f:this.getTypeInfo(ae.mat3x2f),mat3x3f:this.getTypeInfo(ae.mat3x3f),mat3x4f:this.getTypeInfo(ae.mat3x4f),mat4x2f:this.getTypeInfo(ae.mat4x2f),mat4x3f:this.getTypeInfo(ae.mat4x3f),mat4x4f:this.getTypeInfo(ae.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof te)return i.value;if(i instanceof X||i instanceof Oe)return Array.from(i.data);if(i instanceof Ot&&i.typeInfo instanceof is){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const l=n[0],u=n[1],d=n[2],h=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new X(n,h));for(const g in r)for(const _ in r[g]){const y=r[g][_];s.variables.forEach(T=>{var w;const x=T.node;if(x!=null&&x.attributes){let S=null,A=null;for(const R of x.attributes)R.name==="binding"?S=R.value:R.name==="group"&&(A=R.value);if(_==S&&g==A)if(y.texture!==void 0&&y.descriptor!==void 0){const R=new hi(y.texture,this.getTypeInfo(x.type),y.descriptor,(w=y.texture.view)!==null&&w!==void 0?w:null);T.value=R}else y.uniform!==void 0?T.value=new Ot(y.uniform,this.getTypeInfo(x.type)):T.value=new Ot(y,this.getTypeInfo(x.type))}})}for(let g=0;g<d;++g)for(let _=0;_<u;++_)for(let y=0;y<l;++y)s.setVariable("@workgroup_id",new X([y,_,g],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[y,_,g],s)}execStatement(e,n){if(e instanceof SP)return this.evalExpression(e.value,n);if(e instanceof AP){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof te))throw new Error("Invalid break-if condition");if(!r.value)return null}return yn._breakObj}if(e instanceof RP)return yn._continueObj;if(e instanceof Yl)this._let(e,n);else if(e instanceof pi)this._var(e,n);else if(e instanceof bf)this._const(e,n);else if(e instanceof uc)this._function(e,n);else{if(e instanceof TP)return this._if(e,n);if(e instanceof wP)return this._switch(e,n);if(e instanceof vP)return this._for(e,n);if(e instanceof _P)return this._while(e,n);if(e instanceof xP)return this._loop(e,n);if(e instanceof d0){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof bP)this._assign(e,n);else if(e instanceof yP)this._increment(e,n);else{if(e instanceof di)return null;if(e instanceof D1){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new te(0,this.getTypeInfo("u32")))}else if(e instanceof j1)this._call(e,n);else{if(e instanceof EP||e instanceof L1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Tr?this._evalBinaryOp(e,n):e instanceof Kt?this._evalLiteral(e,n):e instanceof Yn?this._evalVariable(e,n):e instanceof B1?this._evalCall(e,n):e instanceof zr?this._evalCreate(e,n):e instanceof CP?this._evalConst(e,n):e instanceof NP?this._evalBitcast(e,n):e instanceof Vt?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof _e){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new te(i,s.type)):s.type.name==="bool"?n.setVariable(r,new te(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new X(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const h of e.node.attributes)if(h.name==="workgroup_size"){if(h.value.length>0){const g=r.getVariableValue(h.value[0]);i[0]=g instanceof te?g.value:parseInt(h.value[0])}if(h.value.length>1){const g=r.getVariableValue(h.value[1]);i[1]=g instanceof te?g.value:parseInt(h.value[1])}if(h.value.length>2){const g=r.getVariableValue(h.value[2]);i[2]=g instanceof te?g.value:parseInt(h.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new X(i,s));const l=i[0],u=i[1],d=i[2];for(let h=0,g=0;h<d;++h)for(let _=0;_<u;++_)for(let y=0;y<l;++y,++g){const T=[y,_,h],w=[y+n[0]*i[0],_+n[1]*i[1],h+n[2]*i[2]];r.setVariable("@local_invocation_id",new X(T,s)),r.setVariable("@global_invocation_id",new X(w,s)),r.setVariable("@local_invocation_index",new te(g,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Vt;)e=e.right;return e instanceof Yn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.setVariable(o.name,l,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof te?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof te?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Yn){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Vt){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof $a?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new $a(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Vt){const u=this._getVariableData(e.variable,n),d=this.evalExpression(e.value,n),h=e.operator;if(h==="="){if(u instanceof te||u instanceof X||u instanceof Oe){if(d instanceof te||d instanceof X||d instanceof Oe&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Ot&&d instanceof Ot&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(h==="+=")return u instanceof te||u instanceof X||u instanceof Oe?d instanceof te||d instanceof X||d instanceof Oe?void u.data.set(d.data.map((g,_)=>u.data[_]+g)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(h==="-=")return(u instanceof te||u instanceof X||u instanceof Oe)&&(d instanceof te||d instanceof X||d instanceof Oe)?void u.data.set(d.data.map((g,_)=>u.data[_]-g)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Vt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const u=n.getVariable(i);if(!(u&&u.value instanceof $a))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let d=e.variable.postfix;if(!d){let h=e.variable.right;for(;h instanceof Vt;){if(h.postfix){d=h.postfix;break}h=h.right}}d&&(r=r.getSubData(this,d,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const u=n.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof $a&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),l=e.operator;if(l==="=")if(r instanceof Ot)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof X||r instanceof Oe))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof uo){const u=this.evalExpression(s.index,n).value;if(r instanceof X){if(!(o instanceof te))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof Oe))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,n).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof X))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=r.typeInfo.getTypeName();if(h==="mat2x2"||h==="mat2x2f"||h==="mat2x2h"){if(!(d<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat2x3"||h==="mat2x3f"||h==="mat2x3h"){if(!(d<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat2x4"||h==="mat2x4f"||h==="mat2x4h"){if(!(d<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat3x2"||h==="mat3x2f"||h==="mat3x2h"){if(!(d<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat3x3"||h==="mat3x3f"||h==="mat3x3h"){if(!(d<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else if(h==="mat3x4"||h==="mat3x4f"||h==="mat3x4h"){if(!(d<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}else if(h==="mat4x2"||h==="mat4x2f"||h==="mat4x2h"){if(!(d<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*d]=o.data[0],r.data[2*d+1]=o.data[1]}else if(h==="mat4x3"||h==="mat4x3f"||h==="mat4x3h"){if(!(d<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*d]=o.data[0],r.data[3*d+1]=o.data[1],r.data[3*d+2]=o.data[2]}else{if(h!=="mat4x4"&&h!=="mat4x4f"&&h!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*d]=o.data[0],r.data[4*d+1]=o.data[1],r.data[4*d+2]=o.data[2],r.data[4*d+3]=o.data[3]}}}}}else if(s instanceof Fs){const u=s.value;if(!(r instanceof X))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof te){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof X))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const h=u[d];if(h==="x"||h==="r")r.data[0]=o.data[d];else if(h==="y"||h==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[d]}else if(h==="z"||h==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[d]}else{if(h!=="w"&&h!=="a")return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[d]}}}}}else r instanceof te&&o instanceof te?r.value=o.value:r instanceof X&&o instanceof X||r instanceof Oe&&o instanceof Oe?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const u=r.getSubData(this,s,n);if(u instanceof X&&o instanceof te){const d=u.data,h=o.value;if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h;else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h;else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h;else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h;else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h;else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h;else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h;else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h;else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h;else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(u instanceof X&&o instanceof X){const d=u.data,h=o.data;if(d.length!==h.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let g=0;g<d.length;++g)d[g]+=h[g];else if(l==="-=")for(let g=0;g<d.length;++g)d[g]-=h[g];else if(l==="*=")for(let g=0;g<d.length;++g)d[g]*=h[g];else if(l==="/=")for(let g=0;g<d.length;++g)d[g]/=h[g];else if(l==="%=")for(let g=0;g<d.length;++g)d[g]%=h[g];else if(l==="&=")for(let g=0;g<d.length;++g)d[g]&=h[g];else if(l==="|=")for(let g=0;g<d.length;++g)d[g]|=h[g];else if(l==="^=")for(let g=0;g<d.length;++g)d[g]^=h[g];else if(l==="<<=")for(let g=0;g<d.length;++g)d[g]<<=h[g];else if(l===">>=")for(let g=0;g<d.length;++g)d[g]>>=h[g];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(u instanceof te&&o instanceof te))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?u.value+=o.value:l==="-="?u.value-=o.value:l==="*="?u.value*=o.value:l==="/="?u.value/=o.value:l==="%="?u.value%=o.value:l==="&="?u.value&=o.value:l==="|="?u.value|=o.value:l==="^="?u.value^=o.value:l==="<<="?u.value<<=o.value:l===">>="?u.value>>=o.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}r instanceof Ot&&r.setDataValue(this,u,s,n)}}_function(e,n){const r=new z1(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new zr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Vt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Gl||e.type instanceof di||e.type instanceof ae){const s=new zr(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof IP)for(const o of s.selectors){if(o instanceof wf){i=s;continue}const l=this.evalExpression(o,n);if(!(l instanceof te))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(s.body,n)}else s instanceof OP&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof te))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof te?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===yn._breakObj)break;if(r!==null&&r!==yn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===yn._breakObj)break;if(r===yn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===yn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===yn._breakObj)break;if(r!==yn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof te){const s=$k(r.value,r.typeInfo.name,i.name);return new te(s,this.getTypeInfo(i))}if(r instanceof X){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const l=i.getTypeName();let u="";if(l.endsWith("f"))u="f32";else if(l.endsWith("i"))u="i32";else if(l.endsWith("u"))u="u32";else if(l.endsWith("b"))u="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(h,g,_){if(g===_)return h;const y=new Array(h.length);for(let T=0;T<h.length;T++)y[T]=$k(h[T],g,_);return y}(Array.from(r.data),o,u);return new X(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof zr){if(e.type===null)return h0.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof zr?e.type.name:e.name,s=e instanceof zr?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Ot(new ArrayBuffer(s.size),s,0);if(s instanceof ts){if(e.args)for(let l=0;l<e.args.length;++l){const u=s.members[l],d=e.args[l],h=this.evalExpression(d,n);o.setData(this,h,u.type,u.offset,n)}}else if(s instanceof is){let l=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],h=this.evalExpression(d,n);s.format===null&&(((r=h.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=h.typeInfo),o.setData(this,h,s.format,l,n),l+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof zr?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new te(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=yn._priority.get(n.name);yn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new $a(r);if(e.operator==="*")return r instanceof $a?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof te?r.value:r instanceof X?Array.from(r.data):null;switch(e.operator){case"+":{if(Te(i)){const l=i.map((u,d)=>+u);return new X(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(+s,o)}case"-":{if(Te(i)){const l=i.map((u,d)=>-u);return new X(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(-s,o)}case"!":{if(Te(i)){const l=i.map((u,d)=>u?0:1);return new X(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(s?0:1,o)}case"~":{if(Te(i)){const l=i.map((u,d)=>~u);return new X(l,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new te(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof te?r.value:r instanceof X||r instanceof Oe?Array.from(r.data):null,o=i instanceof te?i.value:i instanceof X||i instanceof Oe?Array.from(i.data):null;switch(e.operator){case"+":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y+g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_+h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h+_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l+u,d)}case"-":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y-g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_-h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h-_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l-u,d)}case"*":{if(Te(s)&&Te(o)){const h=s,g=o;if(r instanceof Oe&&i instanceof Oe){const _=function(x,S,A,R){if(Tn[S.name]===void 0||Tn[R.name]===void 0)return null;const E=Tn[S.name][0],C=Tn[S.name][1],I=Tn[R.name][0];if(E!==Tn[R.name][1])return null;const O=new Array(I*C);for(let M=0;M<C;M++)for(let P=0;P<I;P++){let N=0;for(let B=0;B<E;B++)N+=x[B*C+M]*A[P*E+B];O[M*I+P]=N}return O}(h,r.typeInfo,g,i.typeInfo);if(_===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const y=Tn[i.typeInfo.name][0],T=Tn[r.typeInfo.name][1],w=this.getTypeInfo(`mat${y}x${T}f`);return new Oe(_,w)}if(r instanceof Oe&&i instanceof X){const _=function(y,T,w,x){if(Tn[T.name]===void 0||ux[x.name]===void 0)return null;const S=Tn[T.name][0],A=Tn[T.name][1];if(S!==w.length)return null;const R=new Array(A);for(let E=0;E<A;E++){let C=0;for(let I=0;I<S;I++)C+=y[I*A+E]*w[I];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new X(_,i.typeInfo)}if(r instanceof X&&i instanceof Oe){const _=function(y,T,w,x){if(ux[T.name]===void 0||Tn[x.name]===void 0)return null;const S=Tn[x.name][0],A=Tn[x.name][1];if(A!==y.length)return null;const R=[];for(let E=0;E<S;E++){let C=0;for(let I=0;I<A;I++)C+=y[I]*w[I*S+E];R[E]=C}return R}(h,r.typeInfo,g,i.typeInfo);return _===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new X(_,r.typeInfo)}{if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y*g[T]);return new X(_,r.typeInfo)}}if(Te(s)){const h=o,g=s.map((_,y)=>_*h);return r instanceof Oe?new Oe(g,r.typeInfo):new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h*_);return i instanceof Oe?new Oe(g,i.typeInfo):new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l*u,d)}case"%":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y%g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_%h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h%_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l%u,d)}case"/":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y/g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_/h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h/_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l/u,d)}case"&":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y&g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_&h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h&_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l&u,d)}case"|":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y|g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_|h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h|_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l|u,d)}case"^":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y^g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_^h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h^_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l^u,d)}case"<<":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y<<g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_<<h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h<<_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l<<u,d)}case">>":{if(Te(s)&&Te(o)){const h=s,g=o;if(h.length!==g.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const _=h.map((y,T)=>y>>g[T]);return new X(_,r.typeInfo)}if(Te(s)){const h=o,g=s.map((_,y)=>_>>h);return new X(g,r.typeInfo)}if(Te(o)){const h=s,g=o.map((_,y)=>h>>_);return new X(g,i.typeInfo)}const l=s,u=o,d=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new te(l>>u,d)}case">":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>d?1:0);return new X(u,i.typeInfo)}return new te(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<d?1:0);return new X(u,i.typeInfo)}return new te(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h===u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d==l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l==d?1:0);return new X(u,i.typeInfo)}return new te(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h!==u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d!==l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l!==d?1:0);return new X(u,i.typeInfo)}return new te(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h>=u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d>=l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l>=d?1:0);return new X(u,i.typeInfo)}return new te(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h<=u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d<=l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l<=d?1:0);return new X(u,i.typeInfo)}return new te(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h&&u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d&&l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l&&d?1:0);return new X(u,i.typeInfo)}return new te(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Te(s)&&Te(o)){const l=s,u=o;if(l.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=l.map((h,g)=>h||u[g]?1:0);return new X(d,r.typeInfo)}if(Te(s)){const l=o,u=s.map((d,h)=>d||l?1:0);return new X(u,r.typeInfo)}if(Te(o)){const l=s,u=o.map((d,h)=>l||d?1:0);return new X(u,i.typeInfo)}return new te(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],l=this.evalExpression(e.args[s],r);r.createVariable(o.name,l,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothStep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(e.args[s],i);i.setVariable(o.name,l,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new te(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=ux[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Kt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);if(u instanceof X){const d=u.data;for(let h=0;h<d.length;++h){let g=d[h];o.push(g)}}else if(u instanceof te){let d=u.value;o.push(d)}}if(e.type instanceof ae&&e.type.format===null&&(e.type.format=ae.f32),o.length===0){const l=new Array(s).fill(0);return new X(l,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new X(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Tn[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Kt)if(e.isVector){const l=e.vectorValue;for(const u of l)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const l of e.args){const u=this.evalExpression(l,n);u instanceof X?o.push(...u.data):u instanceof te?o.push(u.value):u instanceof Oe&&o.push(...u.data)}if(r instanceof Us&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new Oe(l,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Oe(o,r).getSubData(this,e.postfix,n)}}yn._breakObj=new hr(new ur("BREAK",null),null),yn._continueObj=new hr(new ur("CONTINUE",null),null),yn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class bX{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class xX{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new bX,this._exec=new yn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Yn){const o=s.name,l=this._context.constants.get(o);if(l)try{const u=l.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof qk||i instanceof xf?i.type=this._forwardType(i.type):i instanceof Gl?i.format=this._forwardType(i.format):i instanceof pi||i instanceof Yl||i instanceof bf?i.type=this._forwardType(i.type):i instanceof uc?i.returnType=this._forwardType(i.returnType):i instanceof zk&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof Fk){const n=this._getType(e.name);if(n)return n}else e instanceof xf?e.type=this._forwardType(e.type):e instanceof Gl&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new uX(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==V.eof}_match(e){if(e instanceof re)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===V.tokens.name&&(i=!0)}if(i){const s=V.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===V.tokens.name){const r=V.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(V.tokens.semicolon)&&!this._isAtEnd(););if(this._match(V.keywords.alias)){const n=this._type_alias();return this._consume(V.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(V.keywords.diagnostic)){const n=this._diagnostic();return this._consume(V.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(V.keywords.requires)){const n=this._requires_directive();return this._consume(V.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(V.keywords.enable)){const n=this._enable_directive();return this._consume(V.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(V.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(V.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(V.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(V.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(V.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(V.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(V.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(V.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(V.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(V.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(V.keywords.fn))return null;const e=this._currentLine,n=this._consume(V.tokens.ident,"Expected function name.").toString();this._consume(V.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(V.tokens.paren_right))do{if(this._check(V.tokens.paren_right))break;const l=this._attribute(),u=this._consume(V.tokens.name,"Expected argument name.").toString();this._consume(V.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=d,r.push(this._updateNode(new zk(u,h,l))))}while(this._match(V.tokens.comma));this._consume(V.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(V.tokens.arrow)){const l=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new uc(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(V.tokens.brace_left,"Expected '{' for block.");!this._check(V.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(V.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(V.tokens.semicolon)&&!this._isAtEnd(););if(this._check(V.tokens.attr)&&this._attribute(),this._check(V.keywords.if))return this._if_statement();if(this._check(V.keywords.switch))return this._switch_statement();if(this._check(V.keywords.loop))return this._loop_statement();if(this._check(V.keywords.for))return this._for_statement();if(this._check(V.keywords.while))return this._while_statement();if(this._check(V.keywords.continuing))return this._continuing_statement();if(this._check(V.keywords.static_assert))return this._static_assert_statement();if(this._check(V.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(V.keywords.return))e=this._return_statement();else if(this._check([V.keywords.var,V.keywords.let,V.keywords.const]))e=this._variable_statement();else if(this._match(V.keywords.discard))e=this._updateNode(new oX);else if(this._match(V.keywords.break)){const n=this._updateNode(new AP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(V.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(V.keywords.continue)){const n=this._updateNode(new RP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(V.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(V.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new iX(n),e)}_while_statement(){if(!this._match(V.keywords.while))return null;const e=this._updateNode(new _P(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(V.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(V.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new d0(r,e),n)}_for_statement(){if(!this._match(V.keywords.for))return null;this._consume(V.tokens.paren_left,"Expected '('.");const e=this._updateNode(new vP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(V.tokens.semicolon)?null:this._for_init(),this._consume(V.tokens.semicolon,"Expected ';'."),e.condition=this._check(V.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(V.tokens.semicolon,"Expected ';'."),e.increment=this._check(V.tokens.paren_right)?null:this._for_increment(),this._consume(V.tokens.paren_right,"Expected ')'."),this._check(V.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(V.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(V.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new pi(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(V.keywords.let)){const e=this._currentLine,n=this._consume(V.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(V.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(V.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Yl(n,r,null,null,i),e)}if(this._match(V.keywords.const)){const e=this._currentLine,n=this._consume(V.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(V.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(V.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Kt&&(r=i.type),this._updateNode(new bf(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(V.increment_operators))return this._current=e,null;const r=this._consume(V.increment_operators,"Expected increment operator");return this._updateNode(new yP(r.type===V.tokens.plus_plus?Ka.increment:Ka.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(V.tokens.brace_right))return null;let r=this._match(V.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(V.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new bP(Fl.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(V.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(V.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new j1(r.lexeme,i),e)}_loop_statement(){if(!this._match(V.keywords.loop))return null;this._check(V.tokens.attr)&&this._attribute(),this._consume(V.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new xP([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof d0){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(V.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(V.keywords.switch))return null;const e=this._updateNode(new wP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(V.tokens.attr)&&this._attribute(),this._consume(V.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(V.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([V.keywords.default,V.keywords.case]);){if(this._match(V.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof wf){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(V.tokens.colon),this._check(V.tokens.attr)&&this._attribute(),this._consume(V.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(V.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new IP(r,i)))}if(this._match(V.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(V.tokens.colon),this._check(V.tokens.attr)&&this._attribute(),this._consume(V.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(V.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new OP(r)))}}return e}_case_selectors(){const e=[];for(this._match(V.keywords.default)?e.push(this._updateNode(new wf)):e.push(this._shift_expression());this._match(V.tokens.comma);)this._match(V.keywords.default)?e.push(this._updateNode(new wf)):e.push(this._shift_expression());return e}_case_body(){if(this._match(V.keywords.fallthrough))return this._consume(V.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(V.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(V.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(V.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(V.keywords.else)&&(this._check(V.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new TP(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===V.keywords.else&&this._tokens[this._current+1].type===V.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new lX(n,r))),this._match_elseif()&&(this._check(V.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(V.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new SP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(V.tokens.or_or);)e=this._updateNode(new Tr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(V.tokens.and_and);)e=this._updateNode(new Tr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(V.tokens.or);)e=this._updateNode(new Tr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(V.tokens.xor);)e=this._updateNode(new Tr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(V.tokens.and);)e=this._updateNode(new Tr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([V.tokens.equal_equal,V.tokens.not_equal])?this._updateNode(new Tr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([V.tokens.less_than,V.tokens.greater_than,V.tokens.less_than_equal,V.tokens.greater_than_equal]);)e=this._updateNode(new Tr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([V.tokens.shift_left,V.tokens.shift_right]);)e=this._updateNode(new Tr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([V.tokens.plus,V.tokens.minus]);)e=this._updateNode(new Tr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([V.tokens.star,V.tokens.forward_slash,V.tokens.modulo]);)e=this._updateNode(new Tr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([V.tokens.minus,V.tokens.bang,V.tokens.tilde,V.tokens.star,V.tokens.and])?this._updateNode(new Vt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(V.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(V.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new uo(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(V.tokens.period)){const e=this._consume(V.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Fs(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return _e.void;case"bool":return _e.bool;case"i32":return _e.i32;case"u32":return _e.u32;case"f32":return _e.f32;case"f16":return _e.f16;case"vec2f":return ae.vec2f;case"vec3f":return ae.vec3f;case"vec4f":return ae.vec4f;case"vec2i":return ae.vec2i;case"vec3i":return ae.vec3i;case"vec4i":return ae.vec4i;case"vec2u":return ae.vec2u;case"vec3u":return ae.vec3u;case"vec4u":return ae.vec4u;case"vec2h":return ae.vec2h;case"vec3h":return ae.vec3h;case"vec4h":return ae.vec4h;case"mat2x2f":return ae.mat2x2f;case"mat2x3f":return ae.mat2x3f;case"mat2x4f":return ae.mat2x4f;case"mat3x2f":return ae.mat3x2f;case"mat3x3f":return ae.mat3x3f;case"mat3x4f":return ae.mat3x4f;case"mat4x2f":return ae.mat4x2f;case"mat4x3f":return ae.mat4x3f;case"mat4x4f":return ae.mat4x4f;case"mat2x2h":return ae.mat2x2h;case"mat2x3h":return ae.mat2x3h;case"mat2x4h":return ae.mat2x4h;case"mat3x2h":return ae.mat3x2h;case"mat3x3h":return ae.mat3x3h;case"mat3x4h":return ae.mat3x4h;case"mat4x2h":return ae.mat4x2h;case"mat4x3h":return ae.mat4x3h;case"mat4x4h":return ae.mat4x4h;case"mat2x2i":return ae.mat2x2i;case"mat2x3i":return ae.mat2x3i;case"mat2x4i":return ae.mat2x4i;case"mat3x2i":return ae.mat3x2i;case"mat3x3i":return ae.mat3x3i;case"mat3x4i":return ae.mat3x4i;case"mat4x2i":return ae.mat4x2i;case"mat4x3i":return ae.mat4x3i;case"mat4x4i":return ae.mat4x4i;case"mat2x2u":return ae.mat2x2u;case"mat2x3u":return ae.mat2x3u;case"mat2x4u":return ae.mat2x4u;case"mat3x2u":return ae.mat3x2u;case"mat3x3u":return ae.mat3x3u;case"mat3x4u":return ae.mat3x4u;case"mat4x2u":return ae.mat4x2u;case"mat4x3u":return ae.mat4x3u;case"mat4x4u":return ae.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(V.tokens.ident)){const r=this._previous().toString();if(this._check(V.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new zr(s,i)):this._updateNode(new B1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new CP(r,i.value))}return this._updateNode(new Yn(r))}if(this._match(V.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?_e.i32:r.endsWith("u")||r.endsWith("U")?_e.u32:_e.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Kt(new te(s,this._exec.getTypeInfo(i)),i))}if(this._match(V.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,_e.u32),this._updateNode(new Kt(new te(r,this._exec.getTypeInfo(_e.u32)),_e.u32))}if(this._match([V.tokens.decimal_float_literal,V.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?_e.f16:_e.f32);const o=i?_e.f16:_e.f32;return this._updateNode(new Kt(new te(s,this._exec.getTypeInfo(o)),o))}if(this._match([V.keywords.true,V.keywords.false])){let r=this._previous().toString()===V.keywords.true.rule;return this._updateNode(new Kt(new te(r?1:0,this._exec.getTypeInfo(_e.bool)),_e.bool))}if(this._check(V.tokens.paren_left))return this._paren_expression();if(this._match(V.keywords.bitcast)){this._consume(V.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(V.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new NP(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new zr(e,n))}_argument_expression_list(){if(!this._match(V.tokens.paren_left))return null;const e=[];do{if(this._check(V.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(V.tokens.comma));return this._consume(V.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(V.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(V.tokens.paren_right),e}_paren_expression(){this._consume(V.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(V.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(V.keywords.struct))return null;const e=this._currentLine,n=this._consume(V.tokens.ident,"Expected name for struct.").toString();this._consume(V.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(V.tokens.brace_right);){const o=this._attribute(),l=this._consume(V.tokens.name,"Expected variable name.").toString();this._consume(V.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(V.tokens.brace_right)?this._match(V.tokens.comma):this._consume(V.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new qk(l,d,o)))}this._consume(V.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new di(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(V.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Kt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Kt&&(e.type=e.value.type.name==="x32"?_e.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(V.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(V.keywords.const))return null;const n=this._consume(V.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(V.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(V.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[_e.f32],d=o.constEvaluate(this._exec,u);d instanceof te&&this._validateTypeRange(d.value,u[0]),u[0]instanceof ae&&u[0].format===null&&d.typeInfo instanceof Us&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=_e.f16:d.typeInfo.format.name==="f32"?u[0].format=_e.f32:d.typeInfo.format.name==="i32"?u[0].format=_e.i32:d.typeInfo.format.name==="u32"?u[0].format=_e.u32:d.typeInfo.format.name==="bool"?u[0].format=_e.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new Kt(d,u[0])),this._exec.context.setVariable(n.toString(),d)}catch{s=o}if(i!==null&&s instanceof Kt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Kt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:_e.f32,i===_e.x32&&(i=_e.i32));const l=this._updateNode(new bf(n.toString(),i,"","",s),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(V.keywords.let))return null;const e=this._currentLine,n=this._consume(V.tokens.name,"Expected variable name");let r=null;if(this._match(V.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(V.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Kt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Kt&&(r=i.type.name==="x32"?_e.i32:i.type);return i instanceof Kt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new Yl(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(V.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(V.tokens.less_than)&&(n=this._consume(V.storage_class,"Expected storage_class.").toString(),this._match(V.tokens.comma)&&(r=this._consume(V.access_mode,"Expected access_mode.").toString()),this._consume(V.tokens.greater_than,"Expected '>'."));const i=this._consume(V.tokens.name,"Expected variable name");let s=null;if(this._match(V.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new pi(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(V.keywords.override))return null;const e=this._consume(V.tokens.name,"Expected variable name");let n=null;if(this._match(V.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new D1(e.toString(),n,null))}_diagnostic(){this._consume(V.tokens.paren_left,"Expected '('");const e=this._consume(V.tokens.ident,"Expected severity control name.");this._consume(V.tokens.comma,"Expected ','");let n=this._consume(V.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(V.tokens.period)&&(n+=`.${this._consume(V.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(V.tokens.paren_right,"Expected ')'"),this._updateNode(new EP(e.toString(),n))}_enable_directive(){const e=this._consume(V.tokens.ident,"identity expected.");return this._updateNode(new sX(e.toString()))}_requires_directive(){const e=[this._consume(V.tokens.ident,"identity expected.").toString()];for(;this._match(V.tokens.comma);){const n=this._consume(V.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new aX(e))}_type_alias(){const e=this._consume(V.tokens.ident,"identity expected.");this._consume(V.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new L1(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([V.tokens.ident,...V.texel_format,V.keywords.bool,V.keywords.f32,V.keywords.i32,V.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new Fk(r));return this._forwardTypeCount++,i}return this._updateNode(new _e(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(V.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(V.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(V.tokens.comma)&&(s=this._consume(V.access_mode,"Expected access_mode for pointer").toString()),this._consume(V.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ae(r,i,s))}if(this._match(V.keywords.ptr)){let r=this._previous().toString();this._consume(V.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(V.storage_class,"Expected storage_class for pointer");this._consume(V.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(V.tokens.comma)&&(o=this._consume(V.access_mode,"Expected access_mode for pointer").toString()),this._consume(V.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new xf(r,i.toString(),s,o))}const n=this._attribute();if(this._match(V.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(V.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(V.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(V.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const l=this._updateNode(new Gl(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(V.sampler_type))return this._updateNode(new zl(this._previous().toString(),null,null));if(this._match(V.depth_texture_type))return this._updateNode(new zl(this._previous().toString(),null,null));if(this._match(V.sampled_texture_type)||this._match(V.multisampled_texture_type)){const e=this._previous();this._consume(V.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(V.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new zl(e.toString(),n,null))}if(this._match(V.storage_texture_type)){const e=this._previous();this._consume(V.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(V.texel_format,"Invalid texel format.").toString();this._consume(V.tokens.comma,"Expected ',' after texel format.");const r=this._consume(V.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(V.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new zl(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(V.tokens.attr);){const n=this._consume(V.attribute_name,"Expected attribute name"),r=this._updateNode(new PP(n.toString(),null));if(this._match(V.tokens.paren_left)){if(r.value=this._consume(V.literal_or_ident,"Expected attribute value").toString(),this._check(V.tokens.comma)){this._advance();do{const i=this._consume(V.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(V.tokens.comma))}this._consume(V.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class wX extends Vr{constructor(e){super(),e&&this.update(e)}update(e){const n=new xX().parse(e);this.updateAST(n)}}function TX(t){var s;const e={attributes:[],bindings:[]};let n;try{n=SX(t)}catch(o){return be.error(o.message)(),e}for(const o of n.uniforms){const l=[];for(const u of((s=o.type)==null?void 0:s.members)||[])l.push({name:u.name,type:Hk(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const l=r.inputs[o];if(l.locationType==="location"){const u=Hk(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function Hk(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function SX(t){try{return new wX(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const EX={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...EX}};const fr=globalThis.mathgl.config;function AX(t,{precision:e=fr.precision}={}){return t=RX(t),`${parseFloat(t.toPrecision(e))}`}function fo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Gn(t,e,n){return NX(t,r=>Math.max(e,Math.min(n,r)))}function Jf(t,e,n){return fo(t)?t.map((r,i)=>Jf(r,e[i],n)):n*e+(1-n)*t}function fc(t,e,n){const r=fr.EPSILON;try{if(t===e)return!0;if(fo(t)&&fo(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!fc(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=fr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{fr.EPSILON=r}}function RX(t){return Math.round(t/fr.EPSILON)*fr.EPSILON}function CX(t){return t.clone?t.clone():new Array(t.length)}function NX(t,e,n){if(fo(t)){const r=t;n=n||CX(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class DP extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:fo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(fr)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+AX(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!fc(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(fr.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function kX(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Xn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function fx(t,e,n=""){if(fr.debug&&!kX(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Wk(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class MX extends DP{get x(){return this[0]}set x(e){this[0]=Xn(e)}get y(){return this[1]}set y(e){this[1]=Xn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Xn(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Xn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Wk(e>=0&&e<this.ELEMENTS,"index is out of range"),Xn(this[e])}setComponent(e,n){return Wk(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Tf=1e-6;let ho=typeof Float32Array<"u"?Float32Array:Array;function IX(){const t=new ho(2);return ho!=Float32Array&&(t[0]=0,t[1]=0),t}function Xk(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function OX(t,e){return t[0]=-e[0],t[1]=-e[1],t}function jP(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function PX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=IX();return function(e,n,r,i,s,o){let l,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],s(t,t,o),e[l]=t[0],e[l+1]=t[1];return e}})();function DX(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function LP(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function jX(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function LX(){const t=new ho(3);return ho!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function BX(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function UX(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function FX(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zX(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],l=n[1],u=n[2];return t[0]=i*u-s*l,t[1]=s*o-r*u,t[2]=r*l-i*o,t}function BP(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function qX(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function VX(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],l=e[0],u=e[1],d=e[2];let h=i*d-s*u,g=s*l-r*d,_=r*u-i*l,y=i*_-s*g,T=s*h-r*_,w=r*g-i*h;const x=o*2;return h*=x,g*=x,_*=x,y*=2,T*=2,w*=2,t[0]=l+h+y,t[1]=u+g+T,t[2]=d+_+w,t}function $X(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function HX(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function WX(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function XX(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],l=e[2],u=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+l*l)),d=u&&FX(t,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const YX=BX;(function(){const t=LX();return function(e,n,r,i,s,o){let l,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const dx=[0,0,0];let rf;class Hr extends MX{static get ZERO(){return rf||(rf=new Hr(0,0,0),Object.freeze(rf)),rf}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&fo(e)?this.copy(e):(fr.debug&&(Xn(e),Xn(n),Xn(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return fr.debug&&(Xn(e.x),Xn(e.y),Xn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Xn(e)}angle(e){return XX(this,e)}cross(e){return zX(this,this,e),this.check()}rotateX({radians:e,origin:n=dx}){return $X(this,this,n,e),this.check()}rotateY({radians:e,origin:n=dx}){return HX(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=dx}){return WX(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return BP(this,this,e),this.check()}transformAsVector(e){return LP(this,this,e),this.check()}transformByMatrix3(e){return qX(this,this,e),this.check()}transformByMatrix2(e){return jX(this,this,e),this.check()}transformByQuaternion(e){return VX(this,this,e),this.check()}}class GX extends DP{toString(){let e="[";if(fr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Xn(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function KX(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ZX(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function p0(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],u=e[6],d=e[7],h=e[8],g=e[9],_=e[10],y=e[11],T=e[12],w=e[13],x=e[14],S=e[15],A=n*l-r*o,R=n*u-i*o,E=n*d-s*o,C=r*u-i*l,I=r*d-s*l,O=i*d-s*u,M=h*w-g*T,P=h*x-_*T,N=h*S-y*T,B=g*x-_*w,z=g*S-y*w,Q=_*S-y*x;let H=A*Q-R*z+E*B+C*N-I*P+O*M;return H?(H=1/H,t[0]=(l*Q-u*z+d*B)*H,t[1]=(i*z-r*Q-s*B)*H,t[2]=(w*O-x*I+S*C)*H,t[3]=(_*I-g*O-y*C)*H,t[4]=(u*N-o*Q-d*P)*H,t[5]=(n*Q-i*N+s*P)*H,t[6]=(x*E-T*O-S*R)*H,t[7]=(h*O-_*E+y*R)*H,t[8]=(o*z-l*N+d*M)*H,t[9]=(r*N-n*z-s*M)*H,t[10]=(T*I-w*E+S*A)*H,t[11]=(g*E-h*I-y*A)*H,t[12]=(l*P-o*B-u*M)*H,t[13]=(n*B-r*P+i*M)*H,t[14]=(w*R-T*C-x*A)*H,t[15]=(h*C-g*R+_*A)*H,t):null}function QX(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],l=t[6],u=t[7],d=t[8],h=t[9],g=t[10],_=t[11],y=t[12],T=t[13],w=t[14],x=t[15],S=e*o-n*s,A=e*l-r*s,R=n*l-r*o,E=d*T-h*y,C=d*w-g*y,I=h*w-g*T,O=e*I-n*C+r*E,M=s*I-o*C+l*E,P=d*R-h*A+g*S,N=y*R-T*A+w*S;return u*O-i*M+x*P-_*N}function Ps(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],d=e[6],h=e[7],g=e[8],_=e[9],y=e[10],T=e[11],w=e[12],x=e[13],S=e[14],A=e[15];let R=n[0],E=n[1],C=n[2],I=n[3];return t[0]=R*r+E*l+C*g+I*w,t[1]=R*i+E*u+C*_+I*x,t[2]=R*s+E*d+C*y+I*S,t[3]=R*o+E*h+C*T+I*A,R=n[4],E=n[5],C=n[6],I=n[7],t[4]=R*r+E*l+C*g+I*w,t[5]=R*i+E*u+C*_+I*x,t[6]=R*s+E*d+C*y+I*S,t[7]=R*o+E*h+C*T+I*A,R=n[8],E=n[9],C=n[10],I=n[11],t[8]=R*r+E*l+C*g+I*w,t[9]=R*i+E*u+C*_+I*x,t[10]=R*s+E*d+C*y+I*S,t[11]=R*o+E*h+C*T+I*A,R=n[12],E=n[13],C=n[14],I=n[15],t[12]=R*r+E*l+C*g+I*w,t[13]=R*i+E*u+C*_+I*x,t[14]=R*s+E*d+C*y+I*S,t[15]=R*o+E*h+C*T+I*A,t}function ed(t,e,n){const r=n[0],i=n[1],s=n[2];let o,l,u,d,h,g,_,y,T,w,x,S;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],l=e[1],u=e[2],d=e[3],h=e[4],g=e[5],_=e[6],y=e[7],T=e[8],w=e[9],x=e[10],S=e[11],t[0]=o,t[1]=l,t[2]=u,t[3]=d,t[4]=h,t[5]=g,t[6]=_,t[7]=y,t[8]=T,t[9]=w,t[10]=x,t[11]=S,t[12]=o*r+h*i+T*s+e[12],t[13]=l*r+g*i+w*s+e[13],t[14]=u*r+_*i+x*s+e[14],t[15]=d*r+y*i+S*s+e[15]),t}function V1(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function JX(t,e,n,r){let i=r[0],s=r[1],o=r[2],l=Math.sqrt(i*i+s*s+o*o),u,d,h,g,_,y,T,w,x,S,A,R,E,C,I,O,M,P,N,B,z,Q,H,W;return l<Tf?null:(l=1/l,i*=l,s*=l,o*=l,d=Math.sin(n),u=Math.cos(n),h=1-u,g=e[0],_=e[1],y=e[2],T=e[3],w=e[4],x=e[5],S=e[6],A=e[7],R=e[8],E=e[9],C=e[10],I=e[11],O=i*i*h+u,M=s*i*h+o*d,P=o*i*h-s*d,N=i*s*h-o*d,B=s*s*h+u,z=o*s*h+i*d,Q=i*o*h+s*d,H=s*o*h-i*d,W=o*o*h+u,t[0]=g*O+w*M+R*P,t[1]=_*O+x*M+E*P,t[2]=y*O+S*M+C*P,t[3]=T*O+A*M+I*P,t[4]=g*N+w*B+R*z,t[5]=_*N+x*B+E*z,t[6]=y*N+S*B+C*z,t[7]=T*N+A*B+I*z,t[8]=g*Q+w*H+R*W,t[9]=_*Q+x*H+E*W,t[10]=y*Q+S*H+C*W,t[11]=T*Q+A*H+I*W,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function UP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],l=e[6],u=e[7],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+d*r,t[5]=o*i+h*r,t[6]=l*i+g*r,t[7]=u*i+_*r,t[8]=d*i-s*r,t[9]=h*i-o*r,t[10]=g*i-l*r,t[11]=_*i-u*r,t}function eY(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[8],h=e[9],g=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-d*r,t[1]=o*i-h*r,t[2]=l*i-g*r,t[3]=u*i-_*r,t[8]=s*r+d*i,t[9]=o*r+h*i,t[10]=l*r+g*i,t[11]=u*r+_*i,t}function FP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],l=e[2],u=e[3],d=e[4],h=e[5],g=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+d*r,t[1]=o*i+h*r,t[2]=l*i+g*r,t[3]=u*i+_*r,t[4]=d*i-s*r,t[5]=h*i-o*r,t[6]=g*i-l*r,t[7]=_*i-u*r,t}function tY(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,l=r+r,u=i+i,d=n*o,h=r*o,g=r*l,_=i*o,y=i*l,T=i*u,w=s*o,x=s*l,S=s*u;return t[0]=1-g-T,t[1]=h+S,t[2]=_-x,t[3]=0,t[4]=h-S,t[5]=1-d-T,t[6]=y+w,t[7]=0,t[8]=_+x,t[9]=y-w,t[10]=1-d-g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nY(t,e,n,r,i,s,o){const l=1/(n-e),u=1/(i-r),d=1/(s-o);return t[0]=s*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(i+r)*u,t[10]=(o+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*d,t[15]=0,t}function rY(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const iY=rY;function sY(t,e,n,r,i,s,o){const l=1/(e-n),u=1/(r-i),d=1/(s-o);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*l,t[13]=(i+r)*u,t[14]=(o+s)*d,t[15]=1,t}const aY=sY;function oY(t,e,n,r){let i,s,o,l,u,d,h,g,_,y;const T=e[0],w=e[1],x=e[2],S=r[0],A=r[1],R=r[2],E=n[0],C=n[1],I=n[2];return Math.abs(T-E)<Tf&&Math.abs(w-C)<Tf&&Math.abs(x-I)<Tf?KX(t):(g=T-E,_=w-C,y=x-I,i=1/Math.sqrt(g*g+_*_+y*y),g*=i,_*=i,y*=i,s=A*y-R*_,o=R*g-S*y,l=S*_-A*g,i=Math.sqrt(s*s+o*o+l*l),i?(i=1/i,s*=i,o*=i,l*=i):(s=0,o=0,l=0),u=_*l-y*o,d=y*s-g*l,h=g*o-_*s,i=Math.sqrt(u*u+d*d+h*h),i?(i=1/i,u*=i,d*=i,h*=i):(u=0,d=0,h=0),t[0]=s,t[1]=u,t[2]=g,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=l,t[9]=h,t[10]=y,t[11]=0,t[12]=-(s*T+o*w+l*x),t[13]=-(u*T+d*w+h*x),t[14]=-(g*T+_*w+y*x),t[15]=1,t)}function lY(){const t=new ho(4);return ho!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function cY(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Nc(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=lY();return function(e,n,r,i,s,o){let l,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,l=r;l<u;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],s(t,t,o),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var g0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(g0||(g0={}));const uY=45*Math.PI/180,fY=1,hx=.1,px=500,dY=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Nr extends GX{static get IDENTITY(){return pY()}static get ZERO(){return hY()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return g0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=l,this[7]=u,this[8]=d,this[9]=h,this[10]=g,this[11]=_,this[12]=y,this[13]=T,this[14]=w,this[15]=x,this.check()}setRowMajor(e,n,r,i,s,o,l,u,d,h,g,_,y,T,w,x){return this[0]=e,this[1]=s,this[2]=d,this[3]=y,this[4]=n,this[5]=o,this[6]=h,this[7]=T,this[8]=r,this[9]=l,this[10]=g,this[11]=w,this[12]=i,this[13]=u,this[14]=_,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(dY)}fromObject(e){return this.check()}fromQuaternion(e){return tY(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=hx,far:l=px}=e;return l===1/0?gY(this,n,r,i,s,o):nY(this,n,r,i,s,o,l),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return oY(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=hx,far:l=px}=e;return aY(this,n,r,i,s,o,l),this.check()}orthographic(e){const{fovy:n=uY,aspect:r=fY,focalDistance:i=1,near:s=hx,far:o=px}=e;Yk(n);const l=n/2,u=i*Math.tan(l),d=u*r;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Yk(n),iY(this,n,r,i,s),this.check()}determinant(){return QX(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return ZX(this,this),this.check()}invert(){return p0(this,this),this.check()}multiplyLeft(e){return Ps(this,e,this),this.check()}multiplyRight(e){return Ps(this,this,e),this.check()}rotateX(e){return UP(this,this,e),this.check()}rotateY(e){return eY(this,this,e),this.check()}rotateZ(e){return FP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return JX(this,this,e,n),this.check()}scale(e){return V1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ed(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Nc(n||[-0,-0,-0,-0],e,this),fx(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=PX(n||[-0,-0],e,this);break;case 3:i=BP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fx(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=DX(n||[-0,-0],e,this);break;case 3:r=LP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fx(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let sf,af;function hY(){return sf||(sf=new Nr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(sf)),sf}function pY(){return af||(af=new Nr,Object.freeze(af)),af}function Yk(t){if(t>Math.PI*2)throw Error("expected radians")}function gY(t,e,n,r,i,s){const o=2*s/(n-e),l=2*s/(i-r),u=(n+e)/(n-e),d=(i+r)/(i-r),h=-1,g=-1,_=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=u,t[9]=d,t[10]=h,t[11]=g,t[12]=0,t[13]=0,t[14]=_,t[15]=0,t}function zP(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function mY(t){return t-Math.fround(t)}function _Y(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;zP(t[r*4+n],e,i*2)}return e}const vY=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,yY={name:"fp32",vs:vY},bY=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,xY={ONE:1},wY={name:"fp64arithmetic",vs:bY,defaultUniforms:xY,uniformTypes:{ONE:"f32"},fp64ify:zP,fp64LowPart:mY,fp64ifyMatrix4:_Y},TY=[0,1,1,1],SY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,EY=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Gk={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:TY},vs:SY,fs:EY,getUniforms:AY};function AY(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const Kk=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,RY={name:"layer",vs:Kk,fs:Kk,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},CY=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,qP="#define SMOOTH_EDGE_RADIUS 0.5",NY=`${qP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,kY=`${qP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,VP={name:"geometry",source:CY,vs:NY,fs:kY},MY=25;var $t;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})($t||($t={}));var Zt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Zt||(Zt={}));var je;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(je||(je={}));const IY="compute",OY="auto",m0="manipulation",Sf="none",_0="pan-x",v0="pan-y";function PY(t){if(t.includes(Sf))return Sf;const e=t.includes(_0),n=t.includes(v0);return e&&n?Sf:e||n?e?_0:v0:t.includes(m0)?m0:OY}class DY{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===IY&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return PY(e.join(" "))}}function td(t){return t.trim().split(/\s+/g)}function gx(t,e,n){if(t)for(const r of td(e))t.addEventListener(r,n,!1)}function mx(t,e,n){if(t)for(const r of td(e))t.removeEventListener(r,n,!1)}function Zk(t){return(t.ownerDocument||t).defaultView}function jY(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function $P(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function Qk(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:$P(e),deltaX:t.deltaX,deltaY:t.deltaY}}function HP(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function Jk(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function LY(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function e4(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function WP(t,e){return t===e?Zt.None:Math.abs(t)>=Math.abs(e)?t<0?Zt.Left:Zt.Right:e<0?Zt.Up:Zt.Down}function BY(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===$t.Start||(s==null?void 0:s.eventType)===$t.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function XP(t,e,n){return{x:e/t||0,y:n/t||0}}function UY(t,e){return Jk(e[0],e[1])/Jk(t[0],t[1])}function FY(t,e){return e4(e[1],e[0])-e4(t[1],t[0])}function zY(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,l;if(e.eventType!==$t.Cancel&&(r>MY||n.velocity===void 0)){const u=e.deltaX-n.deltaX,d=e.deltaY-n.deltaY,h=XP(r,u,d);s=h.x,o=h.y,i=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,l=WP(u,d),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,l=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=l}function qY(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=Qk(e)),i>1&&!n.firstMultiple?n.firstMultiple=Qk(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,l=o?o.center:s.center,u=e.center=$P(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=LY(l,u),e.distance=HP(l,u);const{deltaX:d,deltaY:h}=BY(n,e);e.deltaX=d,e.deltaY=h,e.offsetDirection=WP(e.deltaX,e.deltaY);const g=XP(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=g.x,e.overallVelocityY=g.y,e.overallVelocity=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,e.scale=o?UY(o.pointers,r):1,e.rotation=o?FY(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let _=t.element;return jY(e.srcEvent.target,_)&&(_=e.srcEvent.target),e.target=_,zY(n,e),e}function VY(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&$t.Start&&r-i===0,o=e&($t.End|$t.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const l=qY(t,n);t.emit("hammer.input",l),t.recognize(l),t.session.prevInput=l}let $Y=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){VY(this.manager,e,n)}init(){gx(this.element,this.evEl,this.domHandler),gx(this.target,this.evTarget,this.domHandler),gx(Zk(this.element),this.evWin,this.domHandler)}destroy(){mx(this.element,this.evEl,this.domHandler),mx(this.target,this.evTarget,this.domHandler),mx(Zk(this.element),this.evWin,this.domHandler)}};const HY={pointerdown:$t.Start,pointermove:$t.Move,pointerup:$t.End,pointercancel:$t.Cancel,pointerout:$t.Cancel},WY="pointerdown",XY="pointermove pointerup pointercancel";class YY extends $Y{constructor(e){super(e),this.evEl=WY,this.evWin=XY,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=HY[e.type],s=e.pointerType,o=s==="touch";let l=n.findIndex(u=>u.pointerId===e.pointerId);i&$t.Start&&(e.buttons||o)?l<0&&(n.push(e),l=n.length-1):i&($t.End|$t.Cancel)&&(r=!0),!(l<0)&&(n[l]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(l,1))}}const GY=["","webkit","Moz","MS","ms","o"];function KY(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of GY){const i=r?r+n:e;if(i in t)return i}}const ZY=1,t4=2,n4={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class QY{constructor(e,n){this.options={...n4,...n,cssProps:{...n4.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new YY(this),this.touchAction=new DY(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?t4:ZY}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&je.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==t4&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(je.Began|je.Changed|je.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of td(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of td(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=KY(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let JY=1;function eG(){return JY++}function r4(t){return t&je.Cancelled?"cancel":t&je.Ended?"end":t&je.Changed?"move":t&je.Began?"start":""}class YP{constructor(e){this.options=e,this.id=eG(),this.state=je.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<je.Ended&&this.manager.emit(this.options.event+r4(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=je.Ended&&this.manager.emit(this.options.event+r4(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=je.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(je.Failed|je.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=je.Failed;return}this.state&(je.Recognized|je.Cancelled|je.Failed)&&(this.state=je.Possible),this.state=this.process(n),this.state&(je.Began|je.Changed|je.Ended|je.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class GP extends YP{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(je.Began|je.Changed),s=this.attrTest(e);return i&&(r&$t.Cancel||!s)?n|je.Cancelled:i||s?r&$t.End?n|je.Ended:n&je.Began?n|je.Changed:je.Began:je.Failed}}class i4 extends YP{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[m0]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&$t.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==$t.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,l=!this.pCenter||HP(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=je.Recognized,this.tryEmit(this._input)},n.interval),je.Began):je.Recognized}return je.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=je.Failed},this.options.interval),je.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===je.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const tG=["","start","move","end","cancel","up","down","left","right"];class s4 extends GP{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Zt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&Zt.Horizontal&&n.push(v0),e&Zt.Vertical&&n.push(_0),n}getEventNames(){return tG.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,l=e.deltaY;return s&n.direction||(n.direction&Zt.Horizontal?(s=o===0?Zt.None:o<0?Zt.Left:Zt.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=l===0?Zt.None:l<0?Zt.Up:Zt.Down,r=l!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&je.Began)||!(this.state&je.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=Zt[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const nG=["","start","move","end","cancel","in","out"];class rG extends GP{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Sf]}getEventNames(){return nG.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&je.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class nh{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const iG=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",sG=iG.indexOf("firefox")!==-1,a4=4.000244140625,aG=40,oG=.25;class lG extends nh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(sG&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=aG)),s!==0&&s%a4===0&&(s=Math.floor(s/a4)),i.shiftKey&&s&&(s=s*oG),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const o4=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class cG extends nh{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,o4.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){o4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const l4=["keydown","keyup"];class uG extends nh{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",l4.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){l4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class fG extends nh{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const c4=1,y0=2,u4=4,dG={pointerdown:c4,pointermove:y0,pointerup:u4,mousedown:c4,mousemove:y0,mouseup:u4},hG=0,pG=1,gG=2,mG=1,_G=2,vG=4;function yG(t){const e=dG[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===y0?(i=!!(n&mG),s=!!(n&vG),o=!!(n&_G)):(i=r===hG,s=r===pG,o=r===gG),{leftButton:i,middleButton:s,rightButton:o}}function bG(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const xG={srcElement:"root",priority:0};class wG{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:l}=this,u={...xG,...r};let d=l.get(u.srcElement);d||(d=[],l.set(u.srcElement,d));const h={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let g=d.length-1;for(;g>=0&&!(d[g].priority>=h.priority);)g--;d.splice(g+1,0,h)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const l=i.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},l=[];for(let u=0;u<r.length;u++){const{type:d,handler:h,once:g}=r[u];if(h({...e,type:d,stopPropagation:s,stopImmediatePropagation:o}),g&&l.push(r[u]),i)break}for(let u=0;u<l.length;u++){const{type:d,handler:h}=l[u];this.remove(d,h)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...yG(e),...bG(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function TG(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class SG{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new QY(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=TG(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new lG(e,this._onOtherEvent,{enable:!1}),this.moveInput=new cG(e,this._onOtherEvent,{enable:!1}),this.keyInput=new uG(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new fG(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,l,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(l=this.keyInput)==null||l.enableEventType(e,n),(u=this.contextmenuInput)==null||u.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[d,h]of Object.entries(e))this._addEventHandler(d,h,r,i,s);return}const{manager:o,events:l}=this;if(!o)return;let u=l.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new wG(this,d),l.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const l of r.values())if(l.recognizerName===s&&!l.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const Je={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Je,"IDENTITY",{get:()=>(_t.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const cr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},zs={common:0,meters:1,pixels:2},b0={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},f4={multipan:[s4,{threshold:10,direction:Zt.Vertical,pointers:2}],pinch:[rG,{},null,["multipan"]],pan:[s4,{threshold:1},["pinch"],["multipan"]],dblclick:[i4,{event:"dblclick",taps:2}],click:[i4,{event:"click"},null,["dblclick"]]};function EG(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function kc(t){let e={},n;return r=>{for(const i in r)if(!EG(r[i],e[i])){n=t(r),e=r;break}return n}}const d4=[0,0,0,0],AG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],KP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RG=[0,0,0],ZP=[0,0,0],CG=kc(MG);function QP(t,e,n=ZP){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===Je.LNGLAT_OFFSETS||e===Je.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case cr.WEB_MERCATOR:(e===Je.LNGLAT||e===Je.CARTESIAN)&&(i=[0,0,0],s=!1);break;case cr.WEB_MERCATOR_AUTO_OFFSET:e===Je.LNGLAT?r=i:e===Je.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case cr.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case cr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function NG(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,l=d4,u=d4,d=t.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:g,offsetMode:_}=QP(t,e,n);return _&&(u=t.projectPosition(h||g),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,l=Nc([],u,o),s=r||s,o=Ps([],i,s),o=Ps([],o,AG)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:g,geospatialOrigin:h}}function kG({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=Je.DEFAULT,coordinateOrigin:i=ZP,autoWrapLongitude:s=!1}){r===Je.DEFAULT&&(r=t.isGeospatial?Je.LNGLAT:Je.CARTESIAN);const o=CG({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||KP,o}function MG({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:u,geospatialOrigin:d}=NG(t,n,r),h=t.getDistanceScales(),g=[t.width*e,t.height*e],_=Nc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,y={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:g,devicePixelRatio:e,focalDistance:_,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:RG,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:KP,cameraPosition:l};if(d){const T=t.getDistanceScales(d);switch(n){case Je.METER_OFFSETS:y.commonUnitsPerWorldUnit=T.unitsPerMeter,y.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case Je.LNGLAT:case Je.LNGLAT_OFFSETS:t._pseudoMeters||(y.commonUnitsPerMeter=T.unitsPerMeter),y.commonUnitsPerWorldUnit=T.unitsPerDegree,y.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case Je.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return y}const IG=Object.keys(Je).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Je[t]};`).join(""),OG=Object.keys(cr).map(t=>`const PROJECTION_MODE_${t}: i32 = ${cr[t]};`).join(""),PG=Object.keys(zs).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${zs[t]};`).join(""),DG=`${IG}
${OG}
${PG}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,jG=`${DG}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,LG=Object.keys(Je).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Je[t]};`).join(""),BG=Object.keys(cr).map(t=>`const int PROJECTION_MODE_${t} = ${cr[t]};`).join(""),UG=Object.keys(zs).map(t=>`const int UNIT_${t.toUpperCase()} = ${zs[t]};`).join(""),FG=`${LG}
${BG}
${UG}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,zG={};function qG(t=zG){return"viewport"in t?kG(t):{}}const $1={name:"project",dependencies:[yY,VP],source:jG,vs:FG,getUniforms:qG,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},VG=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,$G=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,JP={name:"project32",dependencies:[$1],source:VG,vs:$G};function HG(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function io(t,e){const n=Nc([],e,t);return cY(n,n,1/n[3]),n}function h4(t,e){const n=t%e;return n<0?e+n:n}function x0(t,e,n){return t<e?e:t>n?n:t}function WG(t){return Math.log(t)*Math.LOG2E}const H1=Math.log2||WG;function _i(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ar=Math.PI,eD=Ar/4,dr=Ar/180,w0=180/Ar,po=512,nd=4003e4,p4=85.051129,XG=1.5;function YG(t){return H1(t)}function rd(t){const[e,n]=t;_i(Number.isFinite(e)),_i(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*dr,i=n*dr,s=po*(r+Ar)/(2*Ar),o=po*(Ar+Math.log(Math.tan(eD+i*.5)))/(2*Ar);return[s,o]}function go(t){const[e,n]=t,r=e/po*(2*Ar)-Ar,i=2*(Math.atan(Math.exp(n/po*(2*Ar)-Ar))-eD);return[r*w0,i*w0]}function GG(t){const{latitude:e}=t;_i(Number.isFinite(e));const n=Math.cos(e*dr);return YG(nd*n)-9}function _x(t){const e=Math.cos(t*dr);return po/nd/e}function T0(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;_i(Number.isFinite(e)&&Number.isFinite(n));const i=po,s=Math.cos(e*dr),o=i/360,l=o/s,u=i/nd/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,l,u],degreesPerUnit:[1/o,1/l,1/u]};if(r){const h=dr*Math.tan(e*dr)/s,g=o*h/2,_=i/nd*h,y=_/l*u;d.unitsPerDegree2=[0,g,_],d.unitsPerMeter2=[y,0,y]}return d}function tD(t,e){const[n,r,i]=t,[s,o,l]=e,{unitsPerMeter:u,unitsPerMeter2:d}=T0({longitude:n,latitude:r,highPrecision:!0}),h=rd(t);h[0]+=s*(u[0]+d[0]*o),h[1]+=o*(u[1]+d[1]*o);const g=go(h),_=(i||0)+(l||0);return Number.isFinite(i)||Number.isFinite(l)?[g[0],g[1],_]:g}function KG(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,l=HG();ed(l,l,[0,0,-i]),UP(l,l,-n*dr),FP(l,l,r*dr);const u=s/e;return V1(l,l,[u,u,u]),o&&ed(l,l,UX([],o)),l}function ZG(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:l,nearZMultiplier:u=1,farZMultiplier:d=1}=t;let{fovy:h=id(XG)}=t;r!==void 0&&(h=id(r));const g=h*dr,_=i*dr,y=W1(h);let T=y;o&&(T+=o[2]*l/Math.cos(_)/n);const w=g*(.5+(s?s[1]:0)/n),x=Math.sin(w)*T/Math.sin(x0(Math.PI/2-_-w,.01,Math.PI-.01)),S=Math.sin(_)*x+T,A=T*10,R=Math.min(S*d,A);return{fov:g,aspect:e/n,focalDistance:y,near:u,far:R}}function id(t){return 2*Math.atan(.5/t)*w0}function W1(t){return .5/Math.tan(.5*t*dr)}function nD(t,e){const[n,r,i=0]=t;return _i(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),io(e,[n,r,i,1])}function rh(t,e,n=0){const[r,i,s]=t;if(_i(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return io(e,[r,i,s,1]);const o=io(e,[r,i,0,1]),l=io(e,[r,i,1,1]),u=o[2],d=l[2],h=u===d?0:((n||0)-u)/(d-u);return jP([],o,l,h)}function QG(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[l,u],[d,h]]=r,g=JG(t.padding),_=rd([l,x0(h,-85.051129,p4)]),y=rd([d,x0(u,-85.051129,p4)]),T=[Math.max(Math.abs(y[0]-_[0]),i),Math.max(Math.abs(y[1]-_[1]),i)],w=[e-g.left-g.right-Math.abs(o[0])*2,n-g.top-g.bottom-Math.abs(o[1])*2];_i(w[0]>0&&w[1]>0);const x=w[0]/T[0],S=w[1]/T[1],A=(g.right-g.left)/2/x,R=(g.top-g.bottom)/2/S,E=[(y[0]+_[0])/2+A,(y[1]+_[1])/2+R],C=go(E),I=Math.min(s,H1(Math.abs(Math.min(x,S))));return _i(Number.isFinite(I)),{longitude:C[0],latitude:C[1],zoom:I}}function JG(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(_i(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const g4=Math.PI/180;function eK(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),l=i([n,r],s);let u,d;const h=t.fovy?.5*t.fovy*g4:Math.atan(.5/t.altitude),g=(90-t.pitch)*g4;return h>g-.01?(u=m4(t,0,e),d=m4(t,n,e)):(u=i([0,0],s),d=i([n,0],s)),[o,l,d,u]}function m4(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=io(r,[e,0,1,1]),s=io(r,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=jP([],i,s,l),d=go(u);return d.push(n),d}const _4=512;function tK(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:l=0}=t;(i<-180||i>180)&&(i=h4(i+180,360)-180),(l<-180||l>180)&&(l=h4(l+180,360)-180);const u=H1(n/_4);if(o<=u)o=u,s=0;else{const d=n/2/Math.pow(2,o),h=go([0,d])[1];if(s<h)s=h;else{const g=go([0,_4-d])[1];s>g&&(s=g)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:l}}const rD=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,nK=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,rK=`
${rD}
${nK}
`,iK=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,sK=`
${rD}
${iK}
`,aK=kc(fK),oK=kc(dK),lK=[0,0,0,1],cK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function uK(t,e){const[n,r,i]=t,s=rh([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function fK({viewport:t,center:e}){return new Nr(t.viewProjectionMatrix).invert().transform(e)}function dK({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>uK(o,r));for(const o of e){const l=o.clone().translate(new Hr(t.center).negate()),u=s.map(h=>l.transform(h)),d=new Nr().ortho({left:Math.min(...u.map(h=>h[0])),right:Math.max(...u.map(h=>h[0])),bottom:Math.min(...u.map(h=>h[1])),top:Math.max(...u.map(h=>h[1])),near:Math.min(...u.map(h=>-h[2])),far:Math.max(...u.map(h=>-h[2]))});n.push(d.multiplyRight(o))}return n}function hK(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=$1.getUniforms(n),i=aK({viewport:n.viewport,center:r.center}),s=[],o=oK({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const d=o[u],h=d.clone().translate(new Hr(n.viewport.center).negate());r.coordinateSystem===Je.LNGLAT&&r.projectionMode===cr.WEB_MERCATOR?(o[u]=h,s[u]=i):(o[u]=d.clone().multiplyRight(cK),s[u]=h.transform(i))}const l={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||lK,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<o.length;u++)l[`viewProjectionMatrix${u}`]=o[u],l[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)l[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return l}const v4={name:"shadow",dependencies:[$1],vs:rK,fs:sK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:hK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},iD={...Gk,defaultUniforms:{...Gk.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},pK=[VP],gK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],mK=[];function _K(t){const e=zf.getDefaultShaderAssembler();for(const r of pK)e.addDefaultModule(r);const n=t==="glsl"?gK:mK;for(const r of n)e.addShaderHook(r);return e}const vK=[255,255,255],yK=1;let bK=0;class xK{constructor(e={}){this.type="ambient";const{color:n=vK}=e,{intensity:r=yK}=e;this.id=e.id||`ambient-${bK++}`,this.color=n,this.intensity=r}}const wK=[255,255,255],TK=1,SK=[0,0,-1];let EK=0;class y4{constructor(e={}){this.type="directional";const{color:n=wK}=e,{intensity:r=TK}=e,{direction:i=SK}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${EK++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Hr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class AK{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class X1 extends AK{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,l=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,n,r]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(h,e)}finally{h.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:l,clearStack:u=!0}=n;n.pass=n.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const h of s){const g=o&&o[h.id];l==null||l(h);const _=this._getDrawLayerParams(h,n),y=h.subViewports||[h];for(const T of y){const w=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:T,view:g,pass:n.pass,layers:n.layers},_);d.push(w)}}return d}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:u},d=!1){var T;const h=[],g=sD(this._lastRenderIndex+1),_={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},y={};for(let w=0;w<n.length;w++){const x=n[w],S=this._shouldDrawLayer(x,_,s,y),A={shouldDrawLayer:S};S&&!d&&(A.shouldDrawLayer=!0,A.layerRenderIndex=g(x,S),A.shaderModuleProps=this._getShaderModuleProps(x,l,r,u),A.layerParameters={...(T=x.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(x,w,e)}),h[w]=A}return h}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:l},u){const d=RK(this.device,{shaderModuleProps:r,target:s,viewport:o});if(l&&l.props.clear){const g=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:g.color?[0,0,0,0]:!1,clearDepth:g.depth?1:!1}).end()}const h={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let g=0;g<n.length;g++){const _=n[g],y=u[g],{shouldDrawLayer:T}=y;if(T&&_.props.pickable&&h.pickableCount++,_.isComposite&&h.compositeCount++,_.isDrawable&&y.shouldDrawLayer){const{layerRenderIndex:w,shaderModuleProps:x,layerParameters:S}=y;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,w),x.project&&(x.project.viewport=o),_.context.renderPass=e;try{_._drawLayer({renderPass:e,shaderModuleProps:x,uniforms:{layerIndex:w},parameters:S})}catch(A){_.raiseError(A,`drawing ${_} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const l=n.layer.id;if(l in i||(i[l]=r(n)),!i[l])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var u,d;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,l={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const h of n)b4(l,(d=h.getShaderModuleProps)==null?void 0:d.call(h,e,l));return b4(l,this.getShaderModuleProps(e,n,l),i)}}function sD(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,l=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&r(i.parent,!1),u in n){const h=n[u]=n[u]||sD(e[u],e);d=h(i,s),n[l]=h}else Number.isFinite(o)?(d=o+(e[u]||0),n[l]=null):d=t;return s&&d>=t&&(t=d+1),e[l]=d,d};return r}function RK(t,{shaderModuleProps:e,target:n,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,l=r;return[l.x*i,o-(l.y+l.height)*i,l.width*i,l.height*i]}function b4(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class CK extends X1{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,l=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:l,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const NK={color:[255,255,255],intensity:1},x4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],kK=[0,0,0,200/255];class aD{constructor(e={}){this.id="lighting-effect",this.shadowColor=kK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(v4),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(v4))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Nr().lookAt({eye:new Hr(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new CK(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new xK(NK),this.directionalLights.push(new y4(x4[0]),new y4(x4[1])))}}class MK{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,h=n*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,h)}let g=1/0;u&&(g=u*r+s);const _=this._allocate(d,h,l,g);return e&&o?_.set(e):l||_.fill(0,0,4),this._release(e),_}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,l=e.BYTES_PER_ELEMENT*s,u=o.findIndex(d=>d.byteLength>=l);if(u>=0){const d=new e(o.splice(u,1)[0],0,s);return r&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const dc=new MK;function ql(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function IK(t,e){const n=t%e;return n<0?e+n:n}function OK(t){return[t[12],t[13],t[14]]}function PK(t){return{left:Ha(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ha(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ha(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ha(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ha(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ha(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const w4=new Hr;function Ha(t,e,n,r){w4.set(t,e,n);const i=w4.len();return{distance:r/i,normal:new Hr(-t/i,-e/i,-n/i)}}function DK(t){return t-Math.fround(t)}let kl;function vx(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;kl=dc.allocate(kl,s,{type:Float32Array,size:n*2});let o=r,l=0;for(;o<i;){for(let u=0;u<n;u++){const d=t[o++];kl[l+u]=d,kl[l+u+n]=DK(d)}l+=n*2}return kl.subarray(0,s*n*2)}function jK(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const LK=Math.PI/180,BK=ql(),T4=[0,0,0],UK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function FK({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:l}){const u=t/e,d=n?new Nr().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:l}):new Nr().perspective({fovy:r,aspect:u,near:o,far:l});if(s){const{left:h=0,right:g=0,top:_=0,bottom:y=0}=s,T=Gn((h+t-g)/2,0,t)-t/2,w=Gn((_+e-y)/2,0,e)-e/2;d[8]-=T*2/t,d[9]+=w*2/e}return d}class Ao{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||UK,this.focalDistance=e.focalDistance||1,this.position=e.position||T4,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?cr.WEB_MERCATOR:cr.WEB_MERCATOR_AUTO_OFFSET:cr.IDENTITY}equals(e){return e instanceof Ao?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&fc(e.projectionMatrix,this.projectionMatrix)&&fc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=nD(r,this.pixelProjectionMatrix),[s,o]=i,l=n?o:this.height-o;return e.length===2?[s,l]:[s,l,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,l=n?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],d=rh([i,l,o],this.pixelUnprojectionMatrix,u),[h,g,_]=this.unprojectPosition(d);return Number.isFinite(o)?[h,g,_]:Number.isFinite(r)?[h,g,r]:[h,g]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=rd(e);return n[1]=Gn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?go(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?T0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,PK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=GG({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||T0({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let l=T4;if(s&&(l=o?new Nr(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new Hr(l).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=BK,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:u=1e3,padding:d=null,focalDistance:h=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Nr().multiplyRight(n).translate(new Hr(this.center).negate()),this.projectionMatrix=r||FK({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*LK,focalDistance:h,padding:d,near:l,far:u});const g=ql();Ps(g,g,this.projectionMatrix),Ps(g,g,this.viewMatrix),this.viewProjectionMatrix=g,this.viewMatrixInverse=p0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=OK(this.viewMatrixInverse);const _=ql(),y=ql();V1(_,_,[this.width/2,-this.height/2,1]),ed(_,_,[1,-1,0]),Ps(y,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=p0(ql(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||_t.warn("Pixel project matrix not invertible")()}}Ao.displayName="Viewport";class mo extends Ao{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:u=1.01,nearZ:d,farZ:h,orthographic:g=!1,projectionMatrix:_,repeat:y=!1,worldOffset:T=0,position:w,padding:x,legacyMeterSizes:S=!1}=e;let{width:A,height:R,altitude:E=1.5}=e;const C=Math.pow(2,i);A=A||1,R=R||1;let I,O=null;if(_)E=_[5]/2,I=id(E);else{e.fovy?(I=e.fovy,E=W1(I)):I=id(E);let P;if(x){const{top:N=0,bottom:B=0}=x;P=[0,Gn((N+R-B)/2,0,R)-R/2]}O=ZG({width:A,height:R,scale:C,center:w&&[0,0,w[2]*_x(n)],offset:P,pitch:s,fovy:I,nearZMultiplier:l,farZMultiplier:u}),Number.isFinite(d)&&(O.near=d),Number.isFinite(h)&&(O.far=h)}let M=KG({height:R,pitch:s,bearing:o,scale:C,altitude:E});T&&(M=new Nr().translate([512*T,0,0]).multiplyLeft(M)),super({...e,width:A,height:R,viewMatrix:M,longitude:r,latitude:n,zoom:i,...O,fovy:I,focalDistance:E}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=I,this.orthographic=g,this._subViewports=y?[]:null,this._pseudoMeters=S,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new mo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*_x(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/_x(r);return[n,r,i]}addMetersToLngLat(e,n){return tD(e,n)}panByPosition(e,n){const r=rh(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=Xk([],i,OX([],r)),o=Xk([],this.center,s),[l,u]=this.unprojectFlat(o);return{longitude:l,latitude:u}}getBounds(e={}){const n=eK(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:l}=QG({width:r,height:i,bounds:e,...n});return new mo({width:r,height:i,longitude:s,latitude:o,zoom:l})}}mo.displayName="WebMercatorViewport";const S4=[0,0,0];function yx(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof mo){const[i,s,o=0]=t,l=e.getDistanceScales([i,s]);r[2]=o*l.unitsPerMeter[2]}return r}function zK(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===Je.DEFAULT&&(i=e.isGeospatial?Je.LNGLAT:Je.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function oD(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,l,u=0]=t;switch(n&&([o,l,u]=Nc([],[o,l,u,1],n)),r){case Je.LNGLAT:return yx([o,l,u],e,s);case Je.LNGLAT_OFFSETS:return yx([o+i[0],l+i[1],u+(i[2]||0)],e,s);case Je.METER_OFFSETS:return yx(tD(i,[o,l,u]),e,s);case Je.CARTESIAN:default:return e.isGeospatial?[o+i[0],l+i[1],u+i[2]]:e.projectPosition([o,l,u])}}function qK(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=zK(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=S4,shaderCoordinateOrigin:h=S4,offsetMode:g=!1}=u?QP(n,r,i):{},_=oD(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:g});if(g){const y=n.projectPosition(d||h);YX(_,_,y)}return _}let VK=1,$K=1;class lD{constructor(){j(this,"time",0);j(this,"channels",new Map);j(this,"animations",new Map);j(this,"playing",!1);j(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=VK++,l={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=$K++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function HK(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function WK(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let XK=0;const YK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:r0.stats.get(`animation-loop-${XK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class GK{constructor(e){j(this,"device",null);j(this,"canvas",null);j(this,"props");j(this,"animationProps",null);j(this,"timeline",null);j(this,"stats");j(this,"cpuTime");j(this,"gpuTime");j(this,"frameRate");j(this,"display");j(this,"needsRedraw","initialized");j(this,"_initialized",!1);j(this,"_running",!1);j(this,"_animationFrameId",null);j(this,"_nextFramePromise",null);j(this,"_resolveNextFrame",null);j(this,"_cpuStartTime",0);j(this,"_error",null);if(this.props={...YK,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Jd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=HK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(WK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,l,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const bx={};function ih(t="id"){bx[t]=bx[t]||1;const e=bx[t]++;return`${t}-${e}`}class E4{constructor(e){j(this,"id");j(this,"userData",{});j(this,"topology");j(this,"bufferLayout",[]);j(this,"vertexCount");j(this,"indices");j(this,"attributes");if(this.id=e.id||ih("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&wt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function KK(t,e){if(e instanceof E4)return e;const n=ZK(t,e),{attributes:r,bufferLayout:i}=QK(t,e);return new E4({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function ZK(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:wt.INDEX,data:n})}function QK(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){r[l]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:d,normalized:h}=o;n.push({name:l,format:XW(u,d,h)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const Ed=class Ed{constructor(e){j(this,"device");j(this,"destroyPolicy");j(this,"_hashCounter",0);j(this,"_hashes",{});j(this,"_renderPipelineCache",{});j(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Ed(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...co.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Wf.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Wf?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};j(Ed,"defaultProps",{...co.defaultProps});let S0=Ed;const Ad=class Ad{constructor(e){j(this,"device");j(this,"destroyPolicy");j(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Ad(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};j(Ad,"defaultProps",{...Vf.defaultProps});let E0=Ad;function JK(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let sn=null,Ss=null;function eZ(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){sn||(sn=document.createElement("canvas"),sn.id=e,sn.title=e,sn.style.zIndex="100",sn.style.position="absolute",sn.style.top=i,sn.style.left=s,sn.style.border="blue 5px solid",sn.style.transform="scaleY(-1)",document.body.appendChild(sn),Ss=sn.getContext("2d")),(sn.width!==t.width||sn.height!==t.height)&&(sn.width=t.width/2,sn.height=t.height/2,sn.style.width="400px",sn.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),u=Ss==null?void 0:Ss.createImageData(t.width,t.height);if(u){for(let h=0;h<l.length;h+=4)u.data[0+h+0]=l[h+0]*o,u.data[0+h+1]=l[h+1]*o,u.data[0+h+2]=l[h+2]*o,u.data[0+h+3]=r?255:l[h+3]*o;Ss==null||Ss.putImageData(u,0,0)}}function A0(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!A0(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!A0(t[s],e[s],n-1))return!1;return!0}return!1}function tZ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function nZ(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function cD(t){return tZ(t)||nZ(t)}function rZ(t){return cD(t)||typeof t=="number"||typeof t=="boolean"}function uD(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];rZ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class iZ{constructor(e,n){j(this,"options",{disableWarnings:!1});j(this,"modules");j(this,"moduleUniforms");j(this,"moduleBindings");Object.assign(this.options,n);const r=I1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;be.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&be.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||be.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],d=((n=o.getUniforms)==null?void 0:n.call(o,s,l))||s,{uniforms:h,bindings:g}=uD(d);this.moduleUniforms[i]={...l,...h},this.moduleBindings[i]={...u,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let sZ="";async function aZ(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:sZ+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class xx{constructor(e,n){j(this,"device");j(this,"id");j(this,"texture");j(this,"sampler");j(this,"view");j(this,"ready");j(this,"isReady",!1);j(this,"destroyed",!1);j(this,"resolveReady",()=>{});j(this,"rejectReady",()=>{});this.device=e,this.id=n.id||ih("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:aZ(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data;let r;try{r=await fD(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function fD(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(fD));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const Es=2,oZ=1e4,Rd=class Rd{constructor(e,n){j(this,"device");j(this,"id");j(this,"source");j(this,"vs");j(this,"fs");j(this,"pipelineFactory");j(this,"shaderFactory");j(this,"userData",{});j(this,"parameters");j(this,"topology");j(this,"bufferLayout");j(this,"isInstanced");j(this,"instanceCount",0);j(this,"vertexCount");j(this,"indexBuffer",null);j(this,"bufferAttributes",{});j(this,"constantAttributes",{});j(this,"bindings",{});j(this,"uniforms",{});j(this,"vertexArray");j(this,"transformFeedback",null);j(this,"pipeline");j(this,"shaderInputs");j(this,"_uniformStore");j(this,"_attributeInfos",{});j(this,"_gpuGeometry",null);j(this,"_getModuleUniforms");j(this,"props");j(this,"_pipelineNeedsUpdate","newly created");j(this,"_needsRedraw","initializing");j(this,"_destroyed",!1);j(this,"_lastDrawTimestamp",-1);j(this,"_lastLogTime",0);j(this,"_logOpen",!1);j(this,"_drawCount",0);var u,d,h,g;this.props={...Rd.defaultProps,...n},n=this.props,this.id=n.id||ih("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(_=>[_.name,_]))||[]),i=n.shaderInputs||new iZ(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=cZ(e),o=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(h=this.shaderInputs)==null?void 0:h.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:_,getUniforms:y}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=_,this._getModuleUniforms=y,(g=this.props).shaderLayout||(g.shaderLayout=TX(this.source))}else{const{vs:_,fs:y,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=_,this.fs=y,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||S0.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||E0.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return be.info(Es,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),R0(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&KK(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new lx(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new lx(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){A0(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new WW(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(lZ(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&be.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=YW(this.pipeline.shaderLayout,this.bufferLayout);const i=new lx(this.bufferLayout);for(const[s,o]of Object.entries(e)){const l=i.getBufferLayout(s);if(!l){r||be.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(l);let d=!1;for(const h of u){const g=this._attributeInfos[h];if(g){const _=this.device.type==="webgpu"?i.getBufferIndex(g.bufferName):g.location;this.vertexArray.setBuffer(_,o),d=!0}}!d&&!r&&be.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||be.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){R0(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=uD(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof xx&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof xx?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof qf?e=Math.max(e,n.texture.updateTimestamp):n instanceof wt||n instanceof It?e=Math.max(e,n.updateTimestamp):n instanceof xx?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof $f||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(be.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=uP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=be.level>3?0:oZ;be.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,be.group(Es,`>>> DRAWING MODEL ${this.id}`,{collapsed:be.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=JK(this.pipeline.shaderLayout,this.id);be.table(Es,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};be.table(Es,n)();const r=this._getAttributeDebugTable();be.table(Es,this._attributeInfos)(),be.table(Es,r)(),be.groupEnd(Es)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&eZ(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=hP(n);return(e instanceof wt?new r(e.debugData):e).toString()}};j(Rd,"defaultProps",{...co.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:zf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let _o=Rd;function lZ(t){return!!(t.uniformTypes&&!R0(t.uniformTypes))}function cZ(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function R0(t){for(const e in t)return!1;return!0}const tc=class tc{constructor(e,n=tc.defaultProps){j(this,"device");j(this,"model");j(this,"transformFeedback");if(!tc.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new _o(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||GH(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof wt)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};j(tc,"defaultProps",{..._o.defaultProps,outputs:void 0,feedbackBuffers:void 0});let hc=tc;class dD{constructor(e){j(this,"id");j(this,"topology");j(this,"vertexCount");j(this,"indices");j(this,"attributes");j(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||ih("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:l}=i;!l&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const uZ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class hD extends X1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:u,width:d,height:h},cullRect:g,effects:_,pass:y="picking",pickZ:T,shaderModuleProps:w}){this.pickZ=T;const x=this._resetColorEncoder(T),S=[l,u,d,h],A=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:g,effects:_==null?void 0:_.filter(E=>E.useInPicking),pass:y,isPicking:!0,shaderModuleProps:w,clearColor:[0,0,0,0],colorMask:15,scissorRect:S});return this._colorEncoderState=null,{decodePickingColor:x&&dZ.bind(null,x),stats:A}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,uZ),i.blend=!0,i.blendColor=fZ(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function fZ(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(_t.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function dZ(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Ga={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},sd=Symbol.for("component"),Ds=Symbol.for("propTypes"),wx=Symbol.for("deprecatedProps"),so=Symbol.for("asyncPropDefaults"),qs=Symbol.for("asyncPropOriginal"),ns=Symbol.for("asyncPropResolved");function pD(t,e=()=>!0){return Array.isArray(t)?gD(t,e,[]):e(t)?[t]:[]}function gD(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?gD(i,e,n):e(i)&&n.push(i)}return n}function hZ({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let l=n;o<i;o++)t[l++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class pZ{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Kx(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class gZ{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new pZ(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=s[e];if(this._track(r,i,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let l=o[n];const u=l&&l.resourceId&&this._resources[l.resourceId];u&&(u.unsubscribe(l),this.prune()),r&&(l?(l.onChange=i,l.resourceId=r.id):l={onChange:i,resourceId:r.id},o[n]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const mZ="layerManager.setLayers",_Z="layerManager.activateViewport";class vZ{constructor(e,n){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Sn(_Z,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new gZ({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:_K(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[RY],renderPass:void 0,stats:i||new Jd({id:"deck.gl"}),viewport:s||new Ao({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new lD,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Sn(mZ,this,n,e),this._lastRenderedLayers=e;const r=pD(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?_t.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&_t.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(l){this._handleError("matching",l,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ga.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Ga.MATCHED,n!==e&&(e.lifecycle=Ga.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ga.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ga.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Rr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Rr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Rr(t[s],e[s],n-1))return!1;return!0}return!1}class yZ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const l=e.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=pD(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Rr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):_t.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=n[s.id];const d=!!s.controller;d&&!u&&(r=!0),(r||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,l,u),l&&this._viewports.unshift(l)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const bZ=/([0-9]+\.?[0-9]*)(%|px)/;function Vi(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=bZ.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function $i(t,e){return t.relative?Math.round(t.position*e):t.position}class Vs{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:l=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Vi(r),this._y=Vi(i),this._width=Vi(s),this._height=Vi(o),this._padding=l&&{left:Vi(l.left||0),right:Vi(l.right||0),top:Vi(l.top||0),bottom:Vi(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Rr(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:$i(this._x,e),y:$i(this._y,n),width:$i(this._width,e),height:$i(this._height,n)};return this._padding&&(r.padding={left:$i(this._padding.left,e),top:$i(this._padding.top,n),right:$i(this._padding.right,e),bottom:$i(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class sh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const A4=()=>{},C0={BREAK:1,SNAP_TO_END:2,IGNORE:3},xZ=t=>t,wZ=C0.BREAK;class TZ{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:l,easing:u}}=n,d=u(r/l),h=i.interpolateProps(s,o,d);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new sh(e.timeline),this.onViewStateChange=e.onViewStateChange||A4,this.onStateChange=e.onStateChange||A4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===C0.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===C0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const l=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:n.transitionEasing||xZ,interpolator:s,interruption:n.transitionInterruption||wZ,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function bn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class SZ{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!fc(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];bn(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const EZ=["longitude","latitude","zoom","bearing","pitch"],AZ=["longitude","latitude","zoom"];class Y1 extends SZ{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:EZ,required:AZ},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),l=i(n),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:l.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Jf(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Jf(e.around,n.around,r)))}return i}}const Hi={transitionDuration:0},RZ=300,of=t=>1-(1-t)*(1-t),Wa={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},As={};class mD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new TZ({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?RZ:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:u=!1,keyboard:d=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(Wa.WHEEL,h&&r),this.toggleEvents(Wa.PAN,h),this.toggleEvents(Wa.PINCH,h&&(l||u)),this.toggleEvents(Wa.MULTI_PAN,h&&u),this.toggleEvents(Wa.DOUBLE_CLICK,h&&o),this.toggleEvents(Wa.KEYBOARD,h&&d),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Hi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Hi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:of},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Hi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:of},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Hi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Hi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:of},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return As._startPinchRotation=e.rotation,As._lastPinchEvent=e,this.updateViewport(r,Hi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:As._startPinchRotation-r})}return this.updateViewport(n,Hi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),As._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=As;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),l=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+l*n/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:of},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return As._startPinchRotation=null,As._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=n?l.zoomOut(r).zoomOut(r):l.zoomOut(r),d.isZooming=!0;break;case"Equal":u=n?l.zoomIn(r).zoomIn(r):l.zoomIn(r),d.isZooming=!0;break;case"ArrowLeft":n?(u=l.rotateLeft(s),d.isRotating=!0):(u=l.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":n?(u=l.rotateRight(s),d.isRotating=!0):(u=l.moveRight(i),d.isPanning=!0);break;case"ArrowUp":n?(u=l.rotateUp(o),d.isRotating=!0):(u=l.moveUp(i),d.isPanning=!0);break;case"ArrowDown":n?(u=l.rotateDown(o),d.isRotating=!0):(u=l.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Hi:e?{...n,transitionInterpolator:new Y1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class _D{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const R4=5,CZ=1.2;class NZ extends _D{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l=0,pitch:u=0,altitude:d=1.5,position:h=[0,0,0],maxZoom:g=20,minZoom:_=0,maxPitch:y=60,minPitch:T=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E,normalize:C=!0}=e;bn(Number.isFinite(s)),bn(Number.isFinite(i)),bn(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:l,pitch:u,altitude:d,maxZoom:g,minZoom:_,maxPitch:y,minPitch:T,normalize:C,position:h},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:S,startBearing:A,startPitch:R,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let l;return e?l=this._getNewRotation(e,i,o,s):l={bearing:s+n,pitch:o+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:l}=this.getViewportProps();let u=i+Math.log2(r);u=Gn(u,l,o);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Gn(i,r,n);const{maxPitch:s,minPitch:o,pitch:l}=e;e.pitch=Gn(l,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,tK(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],l=e[1],u=n[1],{width:d,height:h}=this.getViewportProps(),g=s/d;let _=0;o>0?Math.abs(h-u)>R4&&(_=o/(u-h)*CZ):o<0&&u>R4&&(_=1-l/u),_=Gn(_,-1,1);const{minPitch:y,maxPitch:T}=this.getViewportProps(),w=i+180*g;let x=r;return _>0?x=r+_*(T-r):_<0&&(x=r-_*(y-r)),{pitch:x,bearing:w}}}class kZ extends mD{constructor(){super(...arguments),this.ControllerState=NZ,this.transition={transitionDuration:300,transitionInterpolator:new Y1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class vD extends Vs{constructor(e={}){super(e)}getViewportType(){return mo}get ControllerType(){return kZ}}vD.displayName="MapView";const MZ=new aD;function IZ(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class OZ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>IZ(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Rr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof aD)||this._resolvedEffects.push(MZ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class PZ extends X1{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const DZ="deckRenderer.renderLayers";class jZ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new PZ(e),this.pickLayersPass=new hD(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Sn(DZ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const LZ={pickedColor:null,pickedObjectIndex:-1};function BZ({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:l,width:u,height:d}=s;let h=i*i,g=-1,_=0;for(let y=0;y<d;y++){const T=y+l-r,w=T*T;if(w>h)_+=4*u;else for(let x=0;x<u;x++){if(t[_+3]-1>=0){const A=x+o-n,R=A*A+w;R<=h&&(h=R,g=_)}_+=4}}if(g>=0){const y=t.slice(g,g+4),T=e(y);if(T){const w=Math.floor(g/4/u),x=g/4-w*u;return{...T,pickedColor:y,pickedX:o+x,pickedY:l+w}}_t.error("Picked non-existent layer. Is picking buffer corrupt?")()}return LZ}function UZ({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const l=e(s);l?n.set(o,{...l,color:s}):_t.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function yD({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=zZ((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let l;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),l=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function FZ(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=e,u=o?[o]:[];if(r==="hover"){const g=n.index,_=n.layerId,y=o?o.props.id:null;if(y!==_||l!==g){if(y!==_){const T=i.find(w=>w.props.id===_);T&&u.unshift(T)}n.layerId=y,n.index=l,n.info=null}}const d=yD(t),h=new Map;return h.set(null,d),u.forEach(g=>{let _={...d};g===o&&(_.color=s,_.index=l,_.picked=!0),_=bD({layer:g,info:_,mode:r});const y=_.layer;g===o&&r==="hover"&&(n.info=_),h.set(y.id,_),r==="hover"&&y.updateAutoHighlight(_)}),h}function bD({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function zZ(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class qZ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new hD(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,u=o?r.find(_=>_.id===o):null,d=l&&i.find(_=>_.id===l)||i[0],h=d&&d.unproject([e-d.x,n-d.y]);return{...s,...{x:e,y:n,viewport:d,coordinate:h,layer:u}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:l=1,mode:u="query",unproject3D:d,onViewportActive:h,effects:g}){const _=this.device.canvasContext.cssToDeviceRatio(),y=this._getPickable(e);if(!y||r.length===0)return{result:[],emptyInfo:yD({viewports:r,x:i,y:s,pixelRatio:_})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],x=Math.round(o*_),{width:S,height:A}=this.pickingFBO,R=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:S,deviceHeight:A}),E={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let C;const I=[],O=new Set;for(let M=0;M<l;M++){let P;if(R){const B=this._drawAndSample({layers:y,views:n,viewports:r,onViewportActive:h,deviceRect:R,cullRect:E,effects:g,pass:`picking:${u}`});P=BZ({...B,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:R})}else P={pickedColor:null,pickedObjectIndex:-1};let N;if(P.pickedLayer&&d&&this.depthFBO){const{pickedColors:B}=this._drawAndSample({layers:[P.pickedLayer],views:n,viewports:r,onViewportActive:h,deviceRect:{x:P.pickedX,y:P.pickedY,width:1,height:1},cullRect:E,effects:g,pass:`picking:${u}:z`},!0);B[3]&&(N=B[0])}P.pickedLayer&&M+1<l&&(O.add(P.pickedLayer),P.pickedLayer.disablePickingIndex(P.pickedObjectIndex)),C=FZ({pickInfo:P,lastPickedInfo:this.lastPickedInfo,mode:u,layers:y,viewports:r,x:i,y:s,z:N,pixelRatio:_});for(const B of C.values())B.layer&&I.push(B);if(!P.pickedColor)break}for(const M of O)M.restorePickingColors();return{result:I,emptyInfo:C.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:l=1,mode:u="query",maxObjects:d=null,onViewportActive:h,effects:g}){const _=this._getPickable(e);if(!_||r.length===0)return[];this._resizeBuffer();const y=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([i,s],!0),w=T.x,x=T.y+T.height,S=this.device.canvasContext.cssToDevicePixels([i+o,s+l],!0),A=S.x+S.width,R=S.y,E={x:w,y:R,width:A-w,height:x-R},C=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:h,deviceRect:E,cullRect:{x:i,y:s,width:o,height:l},effects:g,pass:`picking:${u}`}),I=UZ(C),O=new Map,M=[],P=Number.isFinite(d);for(let N=0;N<I.length&&!(P&&M.length>=d);N++){const B=I[N];let z={color:B.pickedColor,layer:null,index:B.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:y};z=bD({layer:B.pickedLayer,info:z,mode:u});const Q=z.layer.id;O.has(Q)||O.set(Q,new Set);const H=O.get(Q),W=z.object??z.index;H.has(W)||(H.add(W),M.push(z))}return M}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:l,pass:u},d=!1){const h=d?this.depthFBO:this.pickingFBO,g={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:l,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const A of l)A.useInPicking&&(g.preRenderStats[A.id]=A.preRender(g));const{decodePickingColor:_}=this.pickLayersPass.render(g),{x:y,y:T,width:w,height:x}=s,S=new(d?Float32Array:Uint8Array)(w*x*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:y,sourceY:T,sourceWidth:w,sourceHeight:x,target:S}),{pickedColors:S,decodePickingColor:_}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),l=Math.max(0,n-r),u=Math.min(i,e+r+1)-o,d=Math.min(s,n+r+1)-l;return u<=0||d<=0?null:{x:o,y:l,width:u,height:d}}}const VZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},$Z="top-left",C4="__root";class HZ{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Rr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=$Z}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||C4;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,VZ[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===C4||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const u=r[l];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:n}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=b0[n.type];if(r)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}}const WZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class XZ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,WZ),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var Za;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Za||(Za={}));const G1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},zt=(t,e,n)=>e?t.enable(n):t.disable(n),N4=(t,e,n)=>t.hint(n,e),Hn=(t,e,n)=>t.pixelStorei(n,e),k4=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},Ml=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function Tx(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const YZ={3042:zt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:zt,2885:(t,e)=>t.cullFace(e),2929:zt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:zt,35723:N4,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:k4,36010:k4,34964:Ml,36662:Ml,36663:Ml,35053:Ml,35055:Ml,2886:(t,e)=>t.frontFace(e),33170:N4,2849:(t,e)=>t.lineWidth(e),32823:zt,32824:"polygonOffset",10752:"polygonOffset",35977:zt,32926:zt,32928:zt,32938:"sampleCoverage",32939:"sampleCoverage",3089:zt,3088:(t,e)=>t.scissor(...e),2960:zt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:zt,10754:zt,12288:zt,12289:zt,12290:zt,12291:zt,12292:zt,12293:zt,12294:zt,12295:zt,3333:Hn,3317:Hn,37440:Hn,37441:Hn,37443:Hn,3330:Hn,3332:Hn,3331:Hn,3314:Hn,32878:Hn,3316:Hn,3315:Hn,32877:Hn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Tx(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Tx(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,l)},stencilOp:(t,e)=>{e=Tx(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,l]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,l)},viewport:(t,e)=>t.viewport(...e)};function Mt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const GZ={blendEquation:(t,e,n)=>t.blendEquationSeparate(Mt(32777,e,n),Mt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Mt(32969,e,n),Mt(32968,e,n),Mt(32971,e,n),Mt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Mt(32824,e,n),Mt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Mt(32938,e,n),Mt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Mt(2962,e,n),Mt(2967,e,n),Mt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Mt(34816,e,n),Mt(36003,e,n),Mt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Mt(2964,e,n),Mt(2965,e,n),Mt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Mt(34817,e,n),Mt(34818,e,n),Mt(34819,e,n))},M4={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Ur=(t,e)=>t.isEnabled(e),I4={3042:Ur,2884:Ur,2929:Ur,3024:Ur,32823:Ur,32926:Ur,32928:Ur,3089:Ur,2960:Ur,35977:Ur},KZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ro(t,e){if(QZ(e))return;const n={};for(const i in e){const s=Number(i),o=YZ[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=GZ[i];s(t,e,r)}}function xD(t,e=G1){if(typeof e=="number"){const i=e,s=I4[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=I4[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function ZZ(t){Ro(t,G1)}function QZ(t){for(const e in t)return!1;return!0}function JZ(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class js{constructor(e,n){j(this,"gl");j(this,"program",null);j(this,"stateStack",[]);j(this,"enable",!0);j(this,"cache",null);j(this,"log");j(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Ro(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?xD(e):Object.assign({},G1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,tQ(e);for(const r in M4){const i=M4[r];eQ(e,r,i)}O4(e,"getParameter"),O4(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],l=this.cache[s];JZ(o,l)||(n=!0,r=l,i&&!(s in i)&&(i[s]=l),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function O4(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||KZ.has(i))return n(i);const s=js.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function eQ(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=js.get(t),{valueChanged:l,oldValue:u}=n(o._updateCache,...s);return l&&r(...s),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function tQ(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=js.get(t);i.program!==r&&(e(r),i.program=r)}}function nQ(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:l}=e;return t.addEventListener("webglcontextlost",u=>o(u),!1),t.addEventListener("webglcontextrestored",u=>l(u),!1),s.luma||(s.luma={}),s}function vo(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function rQ(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);vo(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),l=s||n,u=o||r,d=t.getParameter(7938),h=wD(l,u),g=iQ(l,u),_=sQ(l,u);return{type:"webgl",gpu:h,gpuType:_,gpuBackend:g,vendor:l,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function wD(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function iQ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function sQ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(wD(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function TD(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Vl="WEBGL_compressed_texture_s3tc",$l="WEBGL_compressed_texture_s3tc_srgb",Qa="EXT_texture_compression_rgtc",Ja="EXT_texture_compression_bptc",aQ="WEBGL_compressed_texture_etc",oQ="WEBGL_compressed_texture_astc",lQ="WEBGL_compressed_texture_etc1",cQ="WEBGL_compressed_texture_pvrtc",uQ="WEBGL_compressed_texture_atc",P4="EXT_texture_norm16",D4="EXT_render_snorm",fQ="EXT_color_buffer_float",K1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[D4],"norm16-renderable-webgl":[P4],"snorm16-renderable-webgl":[P4,D4],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Vl,$l,Qa,Ja],"texture-compression-bc5-webgl":[Qa],"texture-compression-bc7-webgl":[Ja],"texture-compression-etc2":[aQ],"texture-compression-astc":[oQ],"texture-compression-etc1-webgl":[lQ],"texture-compression-pvrtc-webgl":[cQ],"texture-compression-atc-webgl":[uQ]};function dQ(t){return t in K1}function hQ(t,e,n){return(K1[e]||[]).every(i=>vo(t,i,n))}const Z1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:fQ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Vl},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:$l},"bc1-rgba-unorm":{gl:33777,x:Vl},"bc1-rgba-unorm-srgb":{gl:35916,x:$l},"bc2-rgba-unorm":{gl:33778,x:Vl},"bc2-rgba-unorm-srgb":{gl:35918,x:$l},"bc3-rgba-unorm":{gl:33779,x:Vl},"bc3-rgba-unorm-srgb":{gl:35919,x:$l},"bc4-r-unorm":{gl:36283,x:Qa},"bc4-r-snorm":{gl:36284,x:Qa},"bc5-rg-unorm":{gl:36285,x:Qa},"bc5-rg-snorm":{gl:36286,x:Qa},"bc6h-rgb-ufloat":{gl:36495,x:Ja},"bc6h-rgb-float":{gl:36494,x:Ja},"bc7-rgba-unorm":{gl:36492,x:Ja},"bc7-rgba-unorm-srgb":{gl:36493,x:Ja},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function pQ(t,e,n){let r=e.create;const i=Z1[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!vo(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function SD(t){var i;const e=Z1[t],n=_Q(t),r=O1(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||mQ(r.channels,r.integer,r.normalized,n),type:r.dataType?TD(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function gQ(t){switch(O1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function mQ(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function _Q(t){const e=Z1[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const j4={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class vQ extends fW{constructor(n,r,i){super([],i);j(this,"gl");j(this,"extensions");j(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,vo(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),dQ(n)&&hQ(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(j4),...Object.keys(K1)]}getWebGLFeature(n){const r=j4[n];return typeof r=="string"?!!vo(this.gl,r,this.extensions):!!r}}class yQ extends uW{constructor(n){super();j(this,"gl");j(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class Kl extends Hf{constructor(n,r){super(n,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"colorAttachments",[]);j(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=gQ(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${xQ(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,l);break;case 34067:const u=bQ(l);i.framebufferTexture2D(36160,n,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function bQ(t){return t<34069?t+34069:t}function xQ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class wQ extends i0{constructor(n,r){super(r);j(this,"device");j(this,"format","rgba8unorm");j(this,"depthStencilFormat","depth24plus");j(this,"presentationSize");j(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Kl(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function ED(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const TQ=1;let dt=null,L4=!1;const Q1={debugSpectorJS:be.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function SQ(t){if(!globalThis.SPECTOR)try{await ED(t.debugSpectorJSUrl||Q1.debugSpectorJSUrl)}catch(e){be.warn(String(e))}}function EQ(t){var e;if(t={...Q1,...t},!t.debugSpectorJS)return null;if(!dt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){be.probe(TQ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;dt=new n,globalThis.luma&&(globalThis.luma.spector=dt)}if(!dt)return null;if(L4||(L4=!0,dt.spyCanvases(),dt==null||dt.onCaptureStarted.add(n=>be.info("Spector capture started:",n)()),dt==null||dt.onCapture.add(n=>{be.info("Spector capture complete:",n)(),dt==null||dt.getResultUI(),dt==null||dt.resultView.display(),dt==null||dt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;dt==null||dt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{be.info("Spector capture stopped after 2 seconds")(),dt==null||dt.stopCapture()})}return dt}const AQ="https://unpkg.com/webgl-debug@2.0.1/index.js";function AD(t){return t.luma=t.luma||{},t.luma}async function RQ(){Ks()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await ED(AQ))}function CQ(t,e={}){return e.debugWebGL||e.traceWebGL?kQ(t,e):NQ(t)}function NQ(t){const e=AD(t);return e.realContext?e.realContext:t}function kQ(t,e){if(!globalThis.WebGLDebugUtils)return be.warn("webgl-debug not loaded")(),t;const n=AD(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...Za,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,MQ.bind(null,e),IQ.bind(null,e));for(const o in Za)!(o in r)&&typeof Za[o]=="number"&&(r[o]=Za[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function B4(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function MQ(t,e,n,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;be.error(o)();debugger}function IQ(t,e,n){let r="";be.level>=1&&(r=B4(e,n),t.traceWebGL&&be.log(1,r)());for(const i of n)if(i===void 0){r=r||B4(e,n);debugger}}const Sx={};function OQ(t="id"){Sx[t]=Sx[t]||1;const e=Sx[t]++;return`${t}-${e}`}class Zl extends wt{constructor(n,r={}){super(n,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"glTarget");j(this,"glUsage");j(this,"glIndexType",5123);j(this,"byteLength");j(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=PQ(this.props.usage),this.glUsage=DQ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function PQ(t){return t&wt.INDEX?34963:t&wt.VERTEX?34962:t&wt.UNIFORM?35345:34962}function DQ(t){return t&wt.INDEX||t&wt.VERTEX?35044:t&wt.UNIFORM?35048:35044}function jQ(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[g,_]=i;n.push({message:_.trim(),type:U4(g),lineNum:0,linePos:0});continue}const[s,o,l,...u]=i;let d=parseInt(l,10);isNaN(d)&&(d=0);let h=parseInt(o,10);isNaN(h)&&(h=0),n.push({message:u.join(":").trim(),type:U4(s),lineNum:d,linePos:h})}return n}function U4(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class LQ extends Vf{constructor(n,r){super(n,r);j(this,"device");j(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?jQ(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}be.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),be.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function BQ(t,e,n,r){if(qQ(e))return r(t);const i=t;i.pushState();try{return UQ(t,e),Ro(i.gl,n),r(t)}finally{i.popState()}}function UQ(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Ls("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Ls("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Ls("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(zQ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(N0("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&be.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=N0("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Ex("stencilPassOperation",e.stencilPassOperation),s=Ex("stencilFailOperation",e.stencilFailOperation),o=Ex("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=F4("blendColorOperation",e.blendColorOperation||"add"),s=F4("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=lf("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=lf("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=lf("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=lf("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,l,u,d)}}function N0(t,e){return Ls(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Ex(t,e){return Ls(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function F4(t,e){return Ls(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function lf(t,e){return Ls(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function FQ(t,e){return`Illegal parameter ${e} for ${t}`}function Ls(t,e,n){if(!(e in n))throw new Error(FQ(t,e));return n[e]}function zQ(t,e){return e}function qQ(t){let e=!0;for(const n in t){e=!1;break}return e}function RD(t){const e={};return t.addressModeU&&(e[10242]=Ax(t.addressModeU)),t.addressModeV&&(e[10243]=Ax(t.addressModeV)),t.addressModeW&&(e[32882]=Ax(t.addressModeW)),t.magFilter&&(e[10240]=k0(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=VQ(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=N0("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Ax(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function k0(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function VQ(t,e="none"){if(!e)return k0(t);switch(e){case"none":return k0(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class M0 extends $f{constructor(n,r){super(n,r);j(this,"device");j(this,"handle");j(this,"parameters");this.device=n,this.parameters=RD(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class eo extends qf{constructor(n,r){super(n,{...It.defaultProps,...r});j(this,"device");j(this,"gl");j(this,"handle");j(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const $Q="Failed to deduce GL constant from typed array";function HQ(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error($Q)}}function WQ(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function CD(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function XQ(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function ad(t,e,n){if(YQ(e))return n(t);const{nocatch:r=!0}=e,i=js.get(t);i.push(),Ro(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function YQ(t){for(const e in t)return!1;return!0}function GQ(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:l}=n,u=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,l,i,s,o);break;default:t.texStorage2D(u,e,l,i,s)}}function z4(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:l=0,mipLevel:u=0}=r,{x:d=0,y:h=0,z:g=0}=r,{glFormat:_,glType:y}=r,T=ND(r.glTarget,o,l),w=r.flipY?{37440:!0}:{};ad(t,w,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(T,e),t.texSubImage3D(T,u,d,h,g,i,s,l,_,y,n),t.bindTexture(T,null);break;case"2d":case"cube":t.bindTexture(T,e),t.texSubImage2D(T,u,d,h,i,s,_,y,n),t.bindTexture(T,null);break;default:throw new Error(o)}})}function q4(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:l=0,byteOffset:u=0}=n,{x:d=0,y:h=0,z:g=0}=n,{glFormat:_,glType:y,compressed:T}=n,w=ND(n.glTarget,r,o);switch(r){case"2d-array":case"3d":T?t.compressedTexSubImage3D(w,l,d,h,g,i,s,o,_,e,u):t.texSubImage3D(w,l,d,h,g,i,s,o,_,y,e,u);break;case"2d":case"cube":T?t.compressedTexSubImage2D(w,l,d,h,i,s,_,e,u):t.texSubImage2D(w,l,d,h,i,s,_,y,e,u);break;default:throw new Error(r)}}function KQ(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function ND(t,e,n){return e==="cube"?34069+n:t}function ZQ(t,e){var S;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:l,sourceDepth:u,sourceFormat:d,sourceType:h}=e||{};const{framebuffer:g,deleteFramebuffer:_}=kD(t),{gl:y,handle:T}=g;o||(o=g.width),l||(l=g.height);const w=(S=g.colorAttachments[i])==null?void 0:S.texture;if(!w)throw new Error(`Invalid framebuffer attachment ${i}`);u=(w==null?void 0:w.depth)||1,d||(d=(w==null?void 0:w.glFormat)||6408),h||(h=(w==null?void 0:w.glType)||5121),s=eJ(s,h,d,o,l),h=h||HQ(s);const x=y.bindFramebuffer(36160,T);return y.readBuffer(36064+i),y.readPixels(n,r,o,l,d,h,s),y.readBuffer(36064),y.bindFramebuffer(36160,x||null),_&&g.destroy(),s}function QQ(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:l,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:h,deleteFramebuffer:g}=kD(t);l=l||h.width,u=u||h.height;const _=h;d=d||5121;let y=n;if(!y){const w=CD(s),x=XQ(d),S=o+l*u*w*x;y=_.device.createBuffer({byteLength:S})}const T=t.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:t,width:l,height:u,origin:[r,i],destinationBuffer:y,byteOffset:o}),T.destroy(),g&&h.destroy(),y}function kD(t){return t instanceof Hf?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:JQ(t),deleteFramebuffer:!0}}function JQ(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function eJ(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=WQ(e,{clamped:!1}),l=CD(n);return new o(r*i*l)}class Ql extends It{constructor(n,r){super(n,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"sampler");j(this,"view");j(this,"mipmaps");j(this,"compressed");j(this,"glTarget");j(this,"glFormat");j(this,"glType");j(this,"glInternalFormat");j(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=KQ(this.props.dimension);const s=SD(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=It.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new eo(this.device,{...this.props,texture:this}),this.bind(),GQ(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new eo(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof M0?(this.sampler=n,r=n.props):(this.sampler=new M0(this.device,n),r=n);const i=RD(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(be.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){be.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=It.getExternalImageSize(n.image),i={...It.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:l,x:u,y:d,z:h,flipY:g}=i;let{width:_,height:y}=i;const{dimension:T,glTarget:w,glFormat:x,glInternalFormat:S,glType:A}=this;if(_=Math.min(_,this.width-u),y=Math.min(y,this.height-d),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return z4(this.device.gl,this.handle,s,{dimension:T,mipLevel:l,x:u,y:d,z:h,width:_,height:y,depth:o,glFormat:x,glType:A,glTarget:w,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=It.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&be.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),q4(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of It.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&be.warn(`${this.id} has mipmap and multiple LODs.`)();const s=It.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:l,format:u=6408,type:d=5121}=n,{gl:h}=this,g=o||l;this.bind(),g instanceof Promise?g.then(_=>this.setImageDataForFace(Object.assign({},n,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,u,i,s,0,u,d,g):h.texImage2D(r,0,u,u,d,g)}_getImageDataMap(n){for(let r=0;r<It.CubeFaces.length;++r){const i=It.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){be.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(It.isExternalImage(i)){z4(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(It.isTextureLevelData(i)){q4(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const tJ=[1,2,4,8];class nJ extends s0{constructor(n,r){var o;super(n,r);j(this,"device");j(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:l,height:u}=r.framebuffer;i=[0,0,l,u]}else{const[l,u]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,l,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,d)=>36064+d);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=tJ.map(i=>!!(i&n.colorMask))),this.glParameters=r,Ro(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&ad(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){ad(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function rJ(t){return iJ.includes(t)}const iJ=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],MD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function ID(t){const e=MD[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function sJ(t){const e=MD[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function aJ(t,e){const n={attributes:[],bindings:[]};n.attributes=oJ(t,e);const r=uJ(t,e);for(const l of r){const u=l.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));n.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:u})}const i=cJ(t,e);let s=0;for(const l of i)if(rJ(l.type)){const{viewDimension:u,sampleType:d}=dJ(l.type);n.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:u,sampleType:d}),l.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=lJ(t,e);return o!=null&&o.length&&(n.varyings=o),n}function oJ(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,u=t.getAttribLocation(e,o);if(u>=0){const{attributeType:d}=sJ(l),h=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:u,stepMode:h,type:d})}}return n.sort((i,s)=>i.location-s.location),n}function lJ(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:u}=s,{glType:d,components:h}=ID(l),g={location:i,name:o,type:d,size:u*h};n.push(g)}return n.sort((i,s)=>i.location-s.location),n}function cJ(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:u}=s,{name:d,isArray:h}=hJ(o);let g=t.getUniformLocation(e,d);const _={location:g,name:d,size:l,type:u,isArray:h};if(n.push(_),_.size>1)for(let y=0;y<_.size;y++){const T=`${d}[${y}]`;g=t.getUniformLocation(e,T);const w={..._,name:T,location:g};n.push(w)}}return n}function uJ(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},l=n(s,35395)||[],u=t.getActiveUniforms(e,l,35383),d=t.getActiveUniforms(e,l,35384),h=t.getActiveUniforms(e,l,35387),g=t.getActiveUniforms(e,l,35388);for(let _=0;_<o.uniformCount;++_){const y=t.getActiveUniform(e,l[_]);if(!y)throw new Error("activeInfo");o.uniforms.push({name:y.name,format:ID(u[_]).format,type:u[_],arrayLength:d[_],byteOffset:h[_],byteStride:g[_]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const fJ={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function dJ(t){const e=fJ[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function hJ(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function pJ(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function gJ(t){return cD(t)!==null||typeof t=="number"||typeof t=="boolean"}function mJ(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];gJ(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function _J(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function vJ(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const V4=4;class yJ extends co{constructor(n,r){super(n,r);j(this,"device");j(this,"handle");j(this,"vs");j(this,"fs");j(this,"introspectedLayout");j(this,"uniforms",{});j(this,"bindings",{});j(this,"varyings",null);j(this,"_uniformCount",0);j(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),be.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=aJ(this.device.gl,this.handle),be.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=bJ(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!o){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||be.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||be.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Zl)&&!(s.buffer instanceof Zl))throw new Error("buffer value");break;case"texture":if(!(s instanceof eo||s instanceof Ql||s instanceof Kl))throw new Error("texture value");break;case"sampler":be.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var x;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:u,isInstanced:d=!1,firstVertex:h=0,transformFeedback:g}=n,_=_J(s),y=!!o.indexBuffer,T=(x=o.indexBuffer)==null?void 0:x.glIndexType;if(this.linkStatus!=="success")return be.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return be.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=r;return BQ(this.device,i,w.glParameters,()=>{y&&d?this.device.gl.drawElementsInstanced(_,l||0,T,h,u||0):y?this.device.gl.drawElements(_,l||0,T,h):d?this.device.gl.drawArraysInstanced(_,h,l||0,u||0):this.device.gl.drawArrays(_,h,l||0),g&&g.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=mJ(n);Object.keys(r).forEach(i=>{be.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),be.time(V4,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),be.timeEnd(V4,`linkProgram for ${this.id}`)(),be.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}be.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),be.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(be.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=n.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);n.uniformBlockBinding(this.handle,i,u),o instanceof Zl?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof eo||o instanceof Ql||o instanceof Kl))throw new Error("texture");let d;if(o instanceof eo)d=o.texture;else if(o instanceof Ql)d=o;else if(o instanceof Kl&&o.colorAttachments[0]instanceof eo)be.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(d.glTarget,d.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,l=this.uniforms[r]??o;l!==void 0&&pJ(this.device.gl,i,s,l)}}}function bJ(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):be.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class xJ extends o0{constructor(n){super(n,{});j(this,"device");j(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":wJ(this.device,r.options);break;case"copy-buffer-to-texture":TJ(this.device,r.options);break;case"copy-texture-to-buffer":SJ(this.device,r.options);break;case"copy-texture-to-texture":EJ(this.device,r.options);break;default:throw new Error(r.name)}}}function wJ(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function TJ(t,e){throw new Error("Not implemented")}function SJ(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:u=[0,0],destinationBuffer:d,byteOffset:h=0,bytesPerRow:g,rowsPerImage:_}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||g||_)throw new Error("not implemented");const{framebuffer:y,destroyFramebuffer:T}=OD(n);let w;try{const x=d,S=s||y.width,A=o||y.height,R=SD(y.colorAttachments[0].texture.props.format),E=R.format,C=R.type;t.gl.bindBuffer(35051,x.handle),w=t.gl.bindFramebuffer(36160,y.handle),t.gl.readPixels(u[0],u[1],S,A,E,C,h)}finally{t.gl.bindBuffer(35051,null),w!==void 0&&t.gl.bindFramebuffer(36160,w),T&&y.destroy()}}function EJ(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:l=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:h}=OD(n),[g,_]=i,[y,T,w]=s,x=t.gl.bindFramebuffer(36160,d.handle);let S=null,A;if(o instanceof Ql)S=o,l=Number.isFinite(l)?l:S.width,u=Number.isFinite(u)?u:S.height,S.bind(0),A=S.glTarget;else throw new Error("invalid destination");switch(A){case 3553:case 34067:t.gl.copyTexSubImage2D(A,r,y,T,g,_,l,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(A,r,y,T,w,g,_,l,u);break}S&&S.unbind(),t.gl.bindFramebuffer(36160,x),h&&d.destroy()}function OD(t){if(t instanceof It){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class AJ extends a0{constructor(n,r){super(n,r);j(this,"device");j(this,"commandBuffer");this.device=n,this.commandBuffer=new xJ(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function RJ(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let l=0;for(let u=r;l<s;l++)e[u++]=n[l];for(;l<o;)l<o-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+o-l),l=o);return t.target}class J1 extends l0{constructor(n,r){super(n,r);j(this,"device");j(this,"handle");j(this,"buffer",null);j(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return eV()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:l,offset:u,normalized:d,integer:h,divisor:g}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(n,s,o,l,u):this.device.gl.vertexAttribPointer(n,s,o,d,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,g||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=TD(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=J1.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=CJ(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l=l||!NJ(i,this.bufferValue),l){const u=FW(r.constructor,o);RJ({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function CJ(t){return Array.isArray(t)?new Float32Array(t):t}function NJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class kJ extends c0{constructor(n,r){super(n,r);j(this,"device");j(this,"gl");j(this,"handle");j(this,"layout");j(this,"buffers",{});j(this,"unusedBuffers",{});j(this,"bindOnUse",!0);j(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(vJ(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:l}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,be.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,o)}getBuffer(n){if($4(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Zl)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if($4(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function $4(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class MJ extends u0{constructor(n,r){super(n,r);j(this,"device");j(this,"handle");j(this,"target",null);j(this,"_queryPending",!1);j(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class to extends rs{constructor(n){var g,_;super({...n,id:n.id||OQ("webgl-device")});j(this,"type","webgl");j(this,"handle");j(this,"features");j(this,"limits");j(this,"info");j(this,"canvasContext");j(this,"lost");j(this,"_resolveContextLost");j(this,"gl");j(this,"debug",!1);j(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});j(this,"_extensions",{});j(this,"_polyfilled",!1);j(this,"spectorJS");j(this,"renderPass",null);j(this,"_constants");const r=rs._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(_=(g=r.canvas)==null?void 0:g.gl)==null?void 0:_.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new wQ(this,r),this.lost=new Promise(y=>{this._resolveContextLost=y});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const l=this.props._handle||nQ(this.canvasContext.canvas,{onContextLost:y=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:y=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(n._reuseDevices)return be.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=EQ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=rQ(this.gl,this._extensions),this.limits=new yQ(this.gl),this.features=new vQ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new js(this.gl,{log:(...y)=>be.log(1,...y)()}).trackState(this.gl,{copyState:!1});const d=n.debugWebGL||n.debug,h=n.debugWebGL;d&&(this.gl=CQ(this.gl,{debugWebGL:d,traceWebGL:h}),be.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(be.level=Math.max(be.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new Zl(this,r)}createTexture(n){return new Ql(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new M0(this,n)}createShader(n){return new LQ(this,n)}createFramebuffer(n){return new Kl(this,n)}createVertexArray(n){return new J1(this,n)}createTransformFeedback(n){return new kJ(this,n)}createQuerySet(n){return new MJ(this,n)}createRenderPipeline(n){return new yJ(this,n)}beginRenderPass(n){return new nJ(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new AJ(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return ZQ(n,r)}readPixelsToBufferWebGL(n,r){return QQ(n,r)}setParametersWebGL(n){Ro(this.gl,n)}getParametersWebGL(n){return xD(this.gl,n)}withParametersWebGL(n,r){return ad(this.gl,n,r)}resetWebGL(){be.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),ZZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return pQ(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){js.get(this.gl).push()}popState(){js.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&DJ(s,r)&&be.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:IJ(this,n,r);break;case Int32Array:OJ(this,n,r);break;case Uint32Array:PJ(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return vo(this.gl,n,this._extensions),this._extensions}}function IJ(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function OJ(t,e,n){t.gl.vertexAttribI4iv(e,n)}function PJ(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function DJ(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const jJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},LJ=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),BJ=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),UJ=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function FJ(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&zJ(i),i}return this.originalGetContext(n,r)}}function zJ(t){t.getExtension("EXT_color_buffer_float");const e={...jJ,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:LJ(t),OES_vertex_array_object:BJ(t),ANGLE_instanced_arrays:UJ(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const cf=1;class qJ extends mW{constructor(){super();j(this,"type","webgl");rs.defaultProps={...rs.defaultProps,...Q1},to.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){FJ(n)}async attach(n){if(n instanceof to)return n;if((n==null?void 0:n.device)instanceof rs)return n.device;if(!VJ(n))throw new Error("Invalid WebGL2RenderingContext");return new to({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){be.groupCollapsed(cf,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(RQ()),n.debugSpectorJS&&r.push(SQ(n));const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&be.error(`Failed to initialize debug libraries ${l.reason}`)();const s=new to(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return be.probe(cf,o)(),be.table(cf,s.info)(),be.groupEnd(cf)(),s}}function VJ(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const H4=new qJ;function Wi(){}const $J=({isDragging:t})=>t?"grabbing":"grab",PD={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Wi,onWebGLInitialized:Wi,onResize:Wi,onViewStateChange:Wi,onInteractionStateChange:Wi,onBeforeRender:Wi,onAfterRender:Wi,onLoad:Wi,onError:t=>_t.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$J,getTooltip:null,debug:!1,drawPickingColors:!1};class e2{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Jd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=b0[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=l,d=u&&(u[i]||u.props[i]),h=this.props[i];let g=!1;d&&(g=d.call(u,l,r)),g||(h==null||h(l,r),this.widgetManager.onEvent(l,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...PD,...e},e=this.props,e.viewState&&e.initialViewState&&_t.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&_t.error("WebGL1 context not supported.")(),n=H4.attach(e.gl)),n||(n=r0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[H4],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&dc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,l,u,d,h;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&_t.removed("onLayerHover","onHover")(),"onLayerClick"in e&&_t.removed("onLayerClick","onClick")(),e.initialViewState&&!Rr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return bn(this.viewManager),this.viewManager.views}getViewports(e){return bn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){bn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),bn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new GK({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new vD({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=l,d=!1;for(const h of o)u=h,d=((r=h.layer)==null?void 0:r.onHover(h,e.event))||d;d||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new lD;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new SG(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(f4).map(o=>{var y;const[l,u,d,h]=f4[o],g=(y=this.props.eventRecognizerOptions)==null?void 0:y[o],_={...u,...g,event:o};return{recognizer:new l(_),recognizeWith:d,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in b0)this.eventManager.on(o,this._onEvent);this.viewManager=new yZ({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new vZ(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new OZ({deck:this,device:this.device}),this.deckRenderer=new jZ(this.device),this.deckPicker=new qZ(this.device),this.widgetManager=new HZ({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new XZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),_t.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=r0.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}e2.defaultProps=PD;e2.VERSION=xH;function HJ(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return hP(t)}}const WJ=dP;function uf(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function ks(t){return t.stride||t.size*t.bytesPerElement}function XJ(t,e){return t.type===e.type&&t.size===e.size&&ks(t)===ks(e)&&(t.offset||0)===(e.offset||0)}function I0(t,e){e.offset&&_t.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=ks(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function YJ(t,e){const n=I0(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class GJ{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!i&&n.isIndexed?l="uint32":l=i||"float32";let u=HJ(i||l);this.doublePrecision=s,s&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:o,logicalType:i,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ks(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),dc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=I0(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,l=s.size||this.size;r[e]=i.subarray(o,o+l)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:ks(r),attributes:i};if(this.doublePrecision){const o=YJ(r,n||{});i.push(uf(e,{...r,...o.high},this.device.type),uf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=I0(r,n);i.push(uf(e,{...r,...o},this.device.type))}else i.push(uf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),l=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const h=n[u++];h<o[d]&&(o[d]=h),h>l[d]&&(l[d]=h)}e=[o,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof wt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=WJ(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=ks(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const l=ks(i),u=(i.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=vx(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const d=s.byteLength+u+l*2;(!o||o.byteLength<d)&&(o=this._createBuffer(d)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?vx(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=dc.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),n&&i&&l.write(i instanceof Float64Array?vx(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&_t.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?wt.INDEX:wt.VERTEX)|wt.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const W4=[],X4=[];function KJ(t,e=0,n=1/0){let r=W4;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(X4.length=t.length,r=X4):r=W4,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function DD(t){return t&&t[Symbol.asyncIterator]}function ZJ(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,l=t.BYTES_PER_ELEMENT,u=r?r/l:n,d=i?i/l:0,h=Math.floor((t.length-d)/u);return(g,{index:_,target:y})=>{if(!s){const S=_*u+d;for(let A=0;A<n;A++)y[A]=t[S+A];return y}const T=s[_],w=s[_+1]||h;let x;if(o){x=new Array(w-T);for(let S=T;S<w;S++){const A=S*u+d;y=new Array(n);for(let R=0;R<n;R++)y[R]=t[A+R];x[S-T]=y}}else if(u===n)x=t.subarray(T*n+d,w*n+d);else{x=new t.constructor((w-T)*n);let S=0;for(let A=T;A<w;A++){const R=A*u+d;for(let E=0;E<n;E++)x[S++]=t[R+E]}}return x}}const QJ=[],Ef=[[0,1/0]];function JJ(t,e){if(t===Ef||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const eee={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function jD(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...eee[n],...e,...t,type:n}}class LD extends GJ{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ef}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!XJ(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return jD(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=JJ(this.state.updateRanges,[r,i])}else this.state.updateRanges=Ef}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=QJ}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Ef),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let u=!0;if(o){for(const[d,h]of s)o.call(i,this,{data:n,startRow:d,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,h]of s){const g=Number.isFinite(d)?this.getVertexOffset(d):0,_=Number.isFinite(h)?this.getVertexOffset(h):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:g,endOffset:_})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;bn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const l=!!o.size&&o.size!==this.size;return r.binaryAccessor=ZJ(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:u,value:d,size:h,startIndices:g}=e,{accessor:_,transform:y}=l;let T=u.binaryAccessor||(typeof _=="function"?_:s[_]);typeof T!="function"&&(T=()=>T),bn(typeof T=="function",`accessor "${_}" is not a function`);let w=e.getVertexOffset(r);const{iterable:x,objectInfo:S}=KJ(n,r,i);for(const A of x){S.index++;let R=T(A,S);if(y&&(R=y.call(this,R)),g){const E=(S.index<g.length-1?g[S.index+1]:o)-g[S.index];if(R&&Array.isArray(R[0])){let C=w;for(const I of R)e._normalizeValue(I,d,C),C+=h}else R&&R.length>h?d.set(R,w):(e._normalizeValue(R,S.target,0),hZ({target:d,source:S.target,start:w,count:E}));w+=E*h}else e._normalizeValue(R,d,w),w+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Rx(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,l=e.length,u=o-r;if(l>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!s)return;let d=l;for(;d<u;){const h=s(d,e);for(let g=0;g<i;g++)n[r+d]=h[g]||0,d++}}function tee({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Rx({source:t,target:e,size:n,getData:r}),e;let o=0,l=0;const u=r&&((h,g)=>r(h+l,g)),d=Math.min(i.length,s.length);for(let h=1;h<d;h++){const g=i[h]*n,_=s[h]*n;Rx({source:t.subarray(o,g),target:e,start:l,end:_,size:n,getData:u}),o=g,l=_}return l<e.length&&Rx({source:[],target:e,start:l,size:n,getData:u}),e}function nee(t){const{device:e,settings:n,value:r}=t,i=new LD(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function BD(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function UD(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function FD(t){t.push(t.shift())}function ree(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let l=0;const{shaderAttributes:u}=t.settings;if(u)for(const d of Object.values(u))l=Math.max(l,d.vertexOffset??0);return(r.noAlloc?i.length:(e+l)*s)*o}function zD({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function qD({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=l=>l}){const l=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*l,d=n.byteOffset,h=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,g=n.startIndices,_=s&&g,y=n.isConstant;if(!_&&e&&r>=i)return e;const T=n.value instanceof Float64Array?Float32Array:n.value.constructor,w=y?n.value:new T(n.getBuffer().readSyncWebGL(d,i*T.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!y){const R=o;o=(E,C)=>n.normalizeConstant(R(E,C))}const x=y?(R,E)=>o(w,E):(R,E)=>o(w.subarray(R+d,R+d+u),E),S=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),A=new Float32Array(i);return tee({source:S,target:A,sourceStartIndices:s,targetStartIndices:g,size:u,getData:x}),(!e||e.byteLength<A.byteLength+h)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:A.byteLength+h,usage:35050})),e.write(A,h),e}class VD{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new sh(r),this.attribute=n,this.attributeInTransition=nee(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=ree(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class iee extends VD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=lee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;FD(s),s[0]=qD({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=zD({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,u=l.model;let d=Math.floor(this.currentLength/o.size);$D(o)&&(d/=2),u.setVertexCount(d),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const see=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Y4={name:"interpolation",vs:see,uniformTypes:{time:"f32"}},aee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,oee=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function $D(t){return t.doublePrecision&&t.value instanceof Float64Array}function lee(t,e){const n=e.size,r=BD(n),i=UD(n),s=e.getBufferLayout();return $D(e)?new hc(t,{vs:oee,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[wY,Y4],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new hc(t,{vs:aee,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[Y4],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class cee extends VD{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=gee(e),this.framebuffer=mee(e,this.texture),this.transform=pee(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=qD({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=zD({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),FD(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const uee=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,fee={name:"spring",vs:uee,uniformTypes:{damping:"f32",stiffness:"f32"}},dee=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,hee=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function pee(t,e){const n=BD(e.size),r=UD(e.size);return new hc(t,{vs:dee,fs:hee,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[fee],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function gee(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function mee(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const _ee={interpolation:iee,spring:cee};class vee{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=_ee[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(_t.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const G4="attributeManager.invalidate",yee="attributeManager.updateStart",bee="attributeManager.updateEnd",xee="attribute.updateStart",wee="attribute.allocate",Tee="attribute.updateEnd";class See{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=kc(jK),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new vee(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Sn(G4,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Sn(G4,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:l={}}){let u=!1;Sn(yee,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const h=this.attributes[d],g=h.settings.accessor;h.startIndices=r,h.numInstances=n,s[d]&&_t.removed(`props.${d}`,`data.attributes.${d}`)(),h.setExternalBuffer(o[d])||h.setBinaryValue(typeof g=="string"?o[g]:void 0,e.startIndices)||typeof g=="string"&&!o[g]&&h.setConstantValue(s[g])||h.needsUpdate()&&(u=!0,this._updateAttribute({attribute:h,numInstances:n,data:e,props:s,context:l})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}u&&Sn(bee,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new LD(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const l=r[o];l&&l.setNeedsUpdate(l.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Sn(xee,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Sn(wee,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Sn(Tee,n,r))}}class Eee extends sh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Jf(n,r,o)}}const K4=1e-5;function Z4(t,e,n,r,i){const s=e-t,l=(n-e)*i,u=-s*r;return l+u+s+e}function Aee(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Z4(t[o],e[o],n[o],r,i);return s}return Z4(t,e,n,r,i)}function Q4(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class Ree extends sh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let l=Aee(s,o,n,r,i);const u=Q4(l,n),d=Q4(l,o);u<K4&&d<K4&&(l=n,this.end()),this._prevValue=o,this._currValue=l}}const Cee={interpolation:Eee,spring:Ree};class Nee{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;n=d,this.remove(e)}if(i=jD(i),!i)return;const o=Cee[i.type];if(!o){_t.error(`unsupported transition type '${i.type}'`)();return}const l=new o(this.timeline);l.start({...i,fromValue:n,toValue:r}),s.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function kee(t){const e=t[Ds];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function Mee(t,e){const n=HD({newProps:t,oldProps:e,propTypes:t[Ds],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=Oee(t,e);let i=!1;return r||(i=Pee(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:Dee(t,e),transitionsChanged:Iee(t,e)}}function Iee(t,e){if(!t.transitions)return!1;const n={},r=t[Ds];let i=!1;for(const s in t.transitions){const o=r[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&O0(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function HD({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=O0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=O0(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function O0(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function Oee(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function Pee(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&J4(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&J4(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function Dee(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function J4(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},HD({oldProps:i,newProps:r,triggerName:n})}const jee="count(): argument not an object",Lee="count(): argument not a container";function Bee(t){if(!Fee(t))throw new Error(jee);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Uee(t))return Object.keys(t).length;throw new Error(Lee)}function Uee(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Fee(t){return t!==null&&typeof t=="object"}function eM(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const zee={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},P0={};function qee(t,e,n,r){if(n instanceof It)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...zee,...i,...r},mipmaps:!0});return P0[s.id]=t,s}function Vee(t,e){!e||!(e instanceof It)||P0[e.id]===t&&(e.delete(),delete P0[e.id])}const $ee={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||D0(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Rr(t,e,1)}},accessor:{validate(t,e){const n=od(t);return n==="function"||n===od(e.value)},equal(t,e,n){return typeof e=="function"?!0:Rr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||D0(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Rr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Rr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:qee(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{Vee(n.id,t)}}};function Hee(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const l=Wee(i,s);e[i]=l,n[i]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function Wee(t,e){switch(od(e)){case"object":return Il(t,e);case"array":return Il(t,{type:"array",value:e,compare:!1});case"boolean":return Il(t,{type:"boolean",value:e});case"number":return Il(t,{type:"number",value:e});case"function":return Il(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Il(t,e){return"type"in e?{name:t,...$ee[e.type],...e}:"value"in e?{name:t,type:od(e.value),...e}:{name:t,type:"object",value:e}}function D0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function od(t){return D0(t)?"array":t===null?"null":typeof t}function Xee(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=j0(t.constructor,n),i=Object.create(r);i[sd]=t,i[qs]={},i[ns]={};for(let s=0;s<e.length;++s){const o=e[s];for(const l in o)i[l]=o[l]}return Object.freeze(i),i}const Yee="_mergedDefaultProps";function j0(t,e){if(!(t instanceof ah.constructor))return{};let n=Yee;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=WD(t,n);return r||(t[n]=Gee(t,e||[]))}function Gee(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=j0(r),s=WD(t,"defaultProps")||{},o=Hee(s),l=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[Ds],o.propTypes),d=Object.assign(Object.create(null),i==null?void 0:i[wx],o.deprecatedProps);for(const h of e){const g=j0(h.constructor);g&&(Object.assign(l,g),Object.assign(u,g[Ds]),Object.assign(d,g[wx]))}return Kee(l,t),Qee(l,u),Zee(l,d),l[Ds]=u,l[wx]=d,e.length===0&&!t2(t,"_propTypes")&&(t._propTypes=u),l}function Kee(t,e){const n=ete(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function Zee(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])t2(this,s)||(this[s]=r);_t.deprecated(i,e[n].join("/"))()}})}function Qee(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:l}=s;s.async&&(n[o]=l,r[o]=Jee(o))}t[so]=n,t[qs]={},Object.defineProperties(t,r)}function Jee(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||DD(e)?this[qs][t]=e:this[ns][t]=e},get(){if(this[ns]){if(t in this[ns])return this[ns][t]||this[so][t];if(t in this[qs]){const e=this[sd]&&this[sd].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[so][t]}}return this[so][t]}}}function t2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function WD(t,e){return t2(t,e)&&t[e]}function ete(t){const e=t.componentName;return e||_t.warn(`${t.name}.componentName not specified`)(),e||t.name}let tte=0;class ah{constructor(...e){this.props=Xee(this,e),this.id=this.props.id,this.count=tte++}clone(e){const{props:n}=this,r={};for(const i in n[so])i in n[ns]?r[i]=n[ns][i]:i in n[qs]&&(r[i]=n[qs][i]);return new this.constructor({...n,...r,...e})}}ah.componentName="Component";ah.defaultProps={};const nte=Object.freeze({});class rte{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||nte}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[sd]||this.component;const n=e[ns]||{},r=e[qs]||e,i=e[so]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(DD(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const l of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Ds];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class ite extends rte{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const ste="layer.changeFlag",ate="layer.initialize",ote="layer.update",lte="layer.finalize",cte="layer.matched",tM=2**24-1,ute=Object.freeze([]),fte=kc(({oldViewport:t,viewport:e})=>t.equals(e));let wr=new Uint8ClampedArray(0);const dte={data:{type:"data",value:ute,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:Kx(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:u=>{var d;return(d=n.internalState)==null?void 0:d.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):Kx(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Je.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Mc extends ah{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ga.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){bn(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=oD(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=nD(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return bn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){bn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return qK(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Je.DEFAULT||e===Je.LNGLAT||e===Je.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){bn(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Bee(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=eM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=eM(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:u}=n.attributes,d=l||u;d&&(o&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!o&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!fte({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(wr.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>tM&&_t.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),wr=dc.allocate(wr,n,{size:4,copy:!0,maxCount:Math.max(n,tM)});const i=Math.floor(wr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),wr[o*4+0]=s[0],wr[o*4+1]=s[1],wr[o*4+2]=s[2],wr[o*4+3]=0}e.value=wr.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var l;if(!Object.keys(n).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),n=u.getAttributes()}const i=((l=e.userData)==null?void 0:l.excludeAttributes)||{},s={},o={};for(const u in n){if(i[u])continue;const d=n[u].getValue();for(const h in d){const g=d[h];g instanceof wt?n[u].settings.isIndexed?e.setIndexBuffer(g):s[h]=g:g&&(o[h]=g)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const l=o.value,u=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const h=s.getVertexOffset(d);l[h]===u[0]&&l[h+1]===u[1]&&l[h+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==wr.buffer&&(r.value=wr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){bn(!this.internalState),bn(Number.isFinite(this.props.coordinateSystem)),Sn(ate,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ite({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(_t.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Nee(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Sn(cte,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Sn(ote,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const l=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const h of this.props.extensions)h.updateState.call(this,l,h);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(l,d)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Sn(lte,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device instanceof to&&o.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(o.device instanceof to)o.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,d,h);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],l=n[i];o&&Array.isArray(l)&&(n.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Sn(ste,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=Mee(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){kee(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new See(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:u}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==l||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(n||i.autoHighlight!==o||l!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Mc.defaultProps=dte;Mc.layerName="Layer";const Cx=Math.PI/180;function hte({height:t,focalDistance:e,orbitAxis:n,rotationX:r,rotationOrbit:i,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],l=n==="Z"?[0,-e,0]:[0,0,e],u=new Nr().lookAt({eye:l,up:o});u.rotateX(r*Cx),n==="Z"?u.rotateZ(i*Cx):u.rotateY(i*Cx);const d=Math.pow(2,s)/t;return u.scale(d),u}class pte extends Ao{constructor(e){const{height:n,projectionMatrix:r,fovy:i=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:l=0,rotationOrbit:u=0,zoom:d=0}=e,h=r?r[5]/2:W1(i);super({...e,longitude:void 0,viewMatrix:hte({height:n||1,focalDistance:h,orbitAxis:s,rotationX:l,rotationOrbit:u,zoom:d}),fovy:i,focalDistance:h,position:o,zoom:d}),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[r,i,s=this.projectedCenter[2]]=e,o=n?i:this.height-i,[l,u,d]=rh([r,o,s],this.pixelUnprojectionMatrix);return[l,u,d]}panByPosition(e,n){const r=this.project(e),i=[this.width/2+r[0]-n[0],this.height/2+r[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}class gte extends _D{constructor(e){const{width:n,height:r,rotationX:i=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:l=0,minRotationX:u=-90,maxRotationX:d=90,minZoom:h=-1/0,maxZoom:g=1/0,startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}=e;super({width:n,height:r,rotationX:i,rotationOrbit:s,target:o,zoom:l,minRotationX:u,maxRotationX:d,minZoom:h,maxZoom:g},{startPanPosition:_,startRotatePos:y,startRotationX:T,startRotationOrbit:w,startZoomPosition:x,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const r=this.getState().startPanPosition||n;if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:l,height:u}=this.getViewportProps();if(!i||s===void 0||o===void 0)return this;let d;if(e){let h=(e[0]-i[0])/l;const g=(e[1]-i[1])/u;(s<-90||s>90)&&(h*=-1),d={rotationX:s+g*180,rotationOrbit:o+h*180}}else d={rotationX:s+r,rotationOrbit:o+n};return this._getUpdatedState(d)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{rotationOrbit:i}=r;return Math.abs(i-n.rotationOrbit)>180&&(r.rotationOrbit=i<0?i+360:i-360),r}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomPosition:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:r,startZoom:i}),l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:r,minZoom:i}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return Gn(s,i,r)}_panFromCenter(e){const{width:n,height:r,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i,maxRotationX:s,minRotationX:o,rotationOrbit:l}=e;return e.zoom=Array.isArray(i)?[Gn(i[0],r,n),Gn(i[1],r,n)]:Gn(i,r,n),e.rotationX=Gn(e.rotationX,o,s),(l<-180||l>180)&&(e.rotationOrbit=IK(l+180,360)-180),e}}class mte extends mD{constructor(){super(...arguments),this.ControllerState=gte,this.transition={transitionDuration:300,transitionInterpolator:new Y1({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class XD extends Vs{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}getViewportType(){return pte}get ControllerType(){return mte}}XD.displayName="OrbitView";const _te=typeof window<"u"?U.useLayoutEffect:U.useEffect;function ld(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const vte={position:"absolute",zIndex:-1};function YD(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>YD(n,e));if(oh(t)){if(yte(t))return e.style=vte,U.cloneElement(t,e);if(bte(t))return U.cloneElement(t,e)}return t}function oh(t){return t&&typeof t=="object"&&"type"in t||!1}function yte(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function bte(t){const e=t.type;return e&&e.deckGLViewProps}function L0(t){if(typeof t=="function")return U.createElement(Vs,{},t);if(Array.isArray(t))return t.map(L0);if(oh(t)){if(t.type===U.Fragment)return L0(t.props.children);if(ld(t.type,Vs))return t}return t}function xte({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return U.Children.forEach(L0(t),o=>{if(oh(o)){const l=o.type;if(ld(l,Mc)){const u=wte(l,o.props);i.push(u)}else r.push(o);if(ld(l,Vs)&&l!==Vs&&o.props.id){const u=new l(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function wte(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const Tte=U.createContext();function Ste({children:t,deck:e,ContextProvider:n=Tte.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let l=s,u=o;oh(o)&&ld(o.type,Vs)&&(l=o.props.id||s,u=o.props.children);const d=r.getViewport(l),h=r.getViewState(l);if(d){h.padding=d.padding;const{x:g,y:_,width:y,height:T}=d;u=YD(u,{x:g,y:_,width:y,height:T,viewport:d,viewState:h}),i[l]||(i[l]={viewport:d,children:[]}),i[l].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:l,children:u}=i[o],{x:d,y:h,width:g,height:_}=l,y={position:"absolute",left:d,top:h,width:g,height:_},T=`view-${o}`,w=U.createElement("div",{key:T,id:T,style:y},...u),x={deck:e,viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:A=>{A.viewId=o,e._onViewStateChange(A)},widgets:[]},S=`view-${o}-context`;return U.createElement(n,{key:S,value:x},w)})}const Ete={mixBlendMode:null};function Ate({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in Ete?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function Rte(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function GD(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Cte(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:l=>{t.redrawReason=l;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():GD(t)}});return r}function Nte(t,e){const[n,r]=U.useState(0),s=U.useRef({control:null,version:n,forceUpdate:()=>r(C=>C+1)}).current,o=U.useRef(null),l=U.useRef(null),u=U.useMemo(()=>xte(t),[t.layers,t.views,t.children]);let d=!0;const h=C=>{var I;return d&&t.viewState?(s.viewStateUpdateRequested=C,null):(s.viewStateUpdateRequested=null,(I=t.onViewStateChange)==null?void 0:I.call(t,C))},g=C=>{var I;d?s.interactionStateUpdateRequested=C:(s.interactionStateUpdateRequested=null,(I=t.onInteractionStateChange)==null||I.call(t,C))},_=U.useMemo(()=>{const C={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:l.current,layers:u.layers,views:u.views,onViewStateChange:h,onInteractionStateChange:g};return delete C._customRender,s.deck&&s.deck.setProps(C),C},[t]);U.useEffect(()=>{const C=t.Deck||e2;return s.deck=Cte(s,C,{..._,parent:o.current,canvas:l.current}),()=>{var I;return(I=s.deck)==null?void 0:I.finalize()}},[]),_te(()=>{GD(s);const{viewStateUpdateRequested:C,interactionStateUpdateRequested:I}=s;C&&h(C),I&&g(I)}),U.useImperativeHandle(e,()=>Rte(s),[]);const y=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:w="100%",height:x="100%",id:S,style:A}=t,{containerStyle:R,canvasStyle:E}=U.useMemo(()=>Ate({width:w,height:x,style:A}),[w,x,A]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===y||s.version!==n){s.lastRenderedViewports=y,s.version=n;const C=Ste({children:u.children,deck:s.deck,ContextProvider:T}),I=U.createElement("canvas",{key:"canvas",id:S||"deckgl-overlay",ref:l,style:E});s.control=U.createElement("div",{id:`${S||"deckgl"}-wrapper`,ref:o,style:R},[I,C])}return d=!1,s.control}const kte=U.forwardRef(Nte),Mte=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,nM=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Ite={name:"line",source:Mte,vs:nM,fs:nM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},Ote=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Pte=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Dte=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,jte=[0,0,0,255],Lte={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:jte},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Jl extends Mc{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Pte,fs:Dte,source:Ote,modules:[JP,iD,Ite]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:n,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,u={widthUnits:zs[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:u}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...u,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new _o(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new dD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Jl.layerName="LineLayer";Jl.defaultProps=Lte;const rM=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Bte={name:"scatterplot",vs:rM,fs:rM,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Ute=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Fte=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zte=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,iM=[0,0,0,255],qte={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:iM},getLineColor:{type:"accessor",value:iM},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class n2 extends Mc{getShaders(){return super.getShaders({vs:Ute,fs:Fte,source:zte,modules:[JP,iD,Bte]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:l,billboard:u,antialiasing:d,lineWidthUnits:h,lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y}=this.props,T={stroked:o,filled:l,billboard:u,antialiasing:d,radiusUnits:zs[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:zs[h],lineWidthScale:g,lineWidthMinPixels:_,lineWidthMaxPixels:y},w=this.state.model;w.shaderInputs.setProps({scatterplot:T}),w.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new _o(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new dD({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}n2.defaultProps=qte;n2.layerName="ScatterplotLayer";function r2(t,e,n=160,r=[100,100,100,255],i=2){const s=[];if(!t||!t.coordinates)return s;const o=t.bounds||KD(t),[l,u,d,h]=o,g=(l+d)/2,_=(u+h)/2,y=Math.max(d-l,h-u)||1,T=(x,S)=>{const A=(x-g)/y*n,R=(S-_)/y*n;return[A,R]},w=x=>{for(let S=0;S<x.length-1;S++){const[A,R]=T(x[S][0],x[S][1]),[E,C]=T(x[S+1][0],x[S+1][1]);s.push({source:[A,R,e],target:[E,C,e],color:r,width:i})}};switch(t.type){case"Polygon":const x=t.coordinates;if(x.length>0){w(x[0]);for(let R=1;R<x.length;R++)w(x[R])}break;case"MultiPolygon":const S=t.coordinates;for(const R of S)if(R.length>0){w(R[0]);for(let E=1;E<R.length;E++)w(R[E])}break;case"LineString":Array.isArray(t.coordinates)&&t.coordinates.length>0&&Array.isArray(t.coordinates[0])&&typeof t.coordinates[0][0]=="number"&&w(t.coordinates);break;case"MultiLineString":const A=t.coordinates;for(const R of A)w(R);break;case"GeometryCollection":if("geometries"in t){const R=t.geometries;for(const E of R)E.type==="LineString"&&E.coordinates&&w(E.coordinates)}break;default:console.warn(`Unsupported geometry type: ${t.type}`)}return s}function KD(t){let e=1/0,n=1/0,r=-1/0,i=-1/0;const s=o=>{if(typeof o[0]=="number"){const[l,u]=o;e=Math.min(e,l),n=Math.min(n,u),r=Math.max(r,l),i=Math.max(i,u)}else for(const l of o)s(l)};if(t.coordinates&&s(t.coordinates),"geometries"in t){const o=t.geometries;for(const l of o)l.coordinates&&s(l.coordinates)}return[e,n,r,i]}function ZD(t,e,n=12,r=160,i=[100,100,100],s,o){const l=[];if(!s||!t)return l;const u=o??.1,d=120,h=2,g=[i[0],i[1],i[2],d],_=r2(t,u,r,g,h);return l.push(..._),l}function B0(t=10,e=160){const n=[];for(let r=0;r<=t;r++){const i=r/t;n.push({type:"LineString",coordinates:[[i,0],[i,1]]})}for(let r=0;r<=t;r++){const i=r/t;n.push({type:"LineString",coordinates:[[0,i],[1,i]]})}return{type:"GeometryCollection",coordinates:[],crs:"unit_grid",name:`${t}x${t} Unit Grid`,bounds:[0,0,1,1],geometries:n}}const sM=Object.freeze(Object.defineProperty({__proto__:null,calculateShapeBounds:KD,convertShapeToLines3D:r2,createGeographicTemporalPlanes:ZD,createUnitGridShape:B0},Symbol.toStringTag,{value:"Module"}));function Vte(t,e,n){if(!t.location||!e.location||t.location.x!==e.location.x||t.location.y!==e.location.y)return!1;const r=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===t.id||d===t.id}),i=n.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return u===e.id||d===e.id});if(r.length!==i.length)return!1;const s=new Set,o=new Set;if(r.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==t.id&&s.add(u),d!==t.id&&s.add(d)}),i.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;u!==e.id&&o.add(u),d!==e.id&&o.add(d)}),s.size!==o.size)return!1;for(const l of s)if(!o.has(l))return!1;return!0}function QD(t,e){const n=new Set,r=[],i=[],s=new Map;for(let l=0;l<t.length;l++){if(n.has(t[l].id))continue;const u=t[l],d=[u];if(u.is_sample){r.push(u),s.set(u.id,u.id),n.add(u.id);continue}for(let h=l+1;h<t.length;h++){const g=t[h];n.has(g.id)||g.is_sample||u.time===g.time&&u.is_sample===g.is_sample&&Vte(u,g,e)&&(d.push(g),n.add(g.id))}if(d.length>1){const h={...u,id:u.id,is_combined:!0,combined_nodes:d.map(g=>g.id)};r.push(h),d.forEach(g=>s.set(g.id,h.id))}else r.push(u),s.set(u.id,u.id);n.add(u.id)}const o=new Set;return e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id,h=s.get(u),g=s.get(d);if(h!==void 0&&g!==void 0&&h!==g){const _=`${Math.min(h,g)}-${Math.max(h,g)}`;o.has(_)||(o.add(_),i.push({...l,source:h,target:g}))}}),{nodes:r,edges:i}}const Ic=(t,e,n)=>{const r=n.some(s=>(typeof s.target=="number"?s.target:s.target.id)===t.id),i=n.some(s=>(typeof s.source=="number"?s.source:s.source.id)===t.id);return!r&&i},$te=(t,e,n)=>n?`Lat: ${e.toFixed(3)}, Lon: ${t.toFixed(3)}`:`(${t.toFixed(2)}, ${e.toFixed(2)})`,pt={AUTO_FIT_ZOOM:1.8,MIN_ZOOM:.01,MAX_ZOOM:50,NODE_OPACITY:.85,NODE_RADIUS_SCALE:6,MIN_NODE_RADIUS:1,EDGE_WIDTH:2,JITTER_SCALE:.001,JITTER_RANGE:.02,JITTER_OFFSET:.01,BASE_ELEVATION:.1,SELECTED_NODE_SCALE:1.5,TEMPORAL_FADE_OPACITY:.5,EDGE_FADE_OPACITY:.2,EDGE_PARTIAL_FADE_OPACITY:.5,REDUCED_OPACITY_MULTIPLIER:.3,GEOGRAPHIC_OPACITY_SCALE:2.5,GEOGRAPHIC_REDUCED_OPACITY:.3,TEMPORAL_OPACITY_SCALE:.3,GRID_EXTENSION:2,UNIT_GRID_SIZE:10},Hl={SAMPLE:4,COMBINED:3,ROOT:4,DEFAULT:3},Zi={GEOGRAPHIC_ACTIVE:.5,GEOGRAPHIC_NORMAL:3,TIME_SLICE_ACTIVE:.5,TIME_SLICE_NORMAL:1.5,NODE_OUTLINE_SELECTED:2,NODE_OUTLINE_ROOT:1.5,NODE_OUTLINE_SAMPLE:.8,MAX_NODE_OUTLINE:4},Hte=t=>t*pt.JITTER_SCALE%pt.JITTER_RANGE-pt.JITTER_OFFSET,Wte=(t,e,n)=>t.is_sample?Hl.SAMPLE:t.is_combined?Hl.COMBINED:Ic(t,e,n)?Hl.ROOT:Hl.DEFAULT,Xte=(t,e,n,r)=>{if(n!=="planes"||!e)return r;const[i,s]=e;return t>=i&&t<=s?r:r*pt.TEMPORAL_FADE_OPACITY},Yte=(t,e,n,r,i)=>{if(r!=="planes"||!n)return i;const[s,o]=n,l=t.time>=s&&t.time<=o,u=e.time>=s&&e.time<=o;return!l&&!u?i*pt.EDGE_FADE_OPACITY:!l||!u?i*pt.EDGE_PARTIAL_FADE_OPACITY:i},aM=(t,e,n)=>t||(e==="unit_grid"?B0(pt.UNIT_GRID_SIZE,n):e==="eastern_hemisphere"?(console.warn("Eastern hemisphere mode selected but no geographic shape provided"),null):B0(pt.UNIT_GRID_SIZE,n)),Gte=(t,e,n)=>{const{nodes:r}=QD(t,[]),i=r.filter(w=>{var x,S;return((x=w.location)==null?void 0:x.x)!==void 0&&((S=w.location)==null?void 0:S.y)!==void 0});if(i.length===0)return null;const s=i.map(w=>w.location.x),o=i.map(w=>w.location.y),l=Math.min(...s),u=Math.max(...s),d=Math.min(...o),h=Math.max(...o);let g,_,y;if((e==="eastern_hemisphere"||e==="custom")&&(n==null?void 0:n.bounds)){const w=n.bounds,[x,S,A,R]=w;g=(x+A)/2,_=(S+R)/2,y=Math.max(A-x,R-S)||1}else g=(l+u)/2,_=(d+h)/2,y=Math.max(u-l,h-d)||1;return{spatialNodes:i,centerX:g,centerY:_,maxScale:y,dataBounds:{minX:l,maxX:u,minY:d,maxY:h}}},Kte=t=>{const e=Array.from(new Set(t.map(n=>n.time))).sort((n,r)=>n-r);return new Map(e.map((n,r)=>[n,r]))};function JD(t,e,n,r){if(e.length<=1)return 0;switch(r){case"equal":return e.indexOf(t)*n;case"log":const s=Math.max(1e-4,e[0]),o=e[e.length-1],l=Math.log(s),u=Math.log(o);return(Math.log(Math.max(1e-4,t))-l)/(u-l)*(e.length-1)*n;case"linear":const g=e[0],_=e[e.length-1];return(t-g)/(_-g)*(e.length-1)*n}}const Zte=(t,e,n,r,i,s,o,l,u)=>{const{centerX:d,centerY:h,maxScale:g}=e,_=Kte(t);return t.map(y=>{const T=(y.location.x-d)/g*r,w=(y.location.y-h)/g*r;_.get(y.time);const x=Hte(y.id),S=JD(y.time,l,n,u)+pt.BASE_ELEVATION+x,A=Wte(y,s,o);let R;return y.is_sample?R=i.nodeSample:y.is_combined?R=i.nodeCombined:Ic(y,s,o)?R=i.nodeRoot:R=i.nodeDefault,{...y,position:[T,w,S],color:R,size:A}})},Qte=(t,e,n,r,i)=>t.filter(s=>{const o=e.get(typeof s.source=="object"?s.source.id:s.source),l=e.get(typeof s.target=="object"?s.target.id:s.target);return o&&l}).map(s=>{const o=typeof s.source=="object"?s.source.id:s.source,l=typeof s.target=="object"?s.target.id:s.target,u=e.get(o),d=e.get(l),h=Yte(u,d,n,r,i.edgeDefault[3]);return{source:u.position,target:d.position,color:[i.edgeDefault[0],i.edgeDefault[1],i.edgeDefault[2],h]}}),Jte=(t,e,n,r,i)=>{if(e&&t.id===e.id)return i.nodeSelected;const o=Xte(t.time,n,r,t.color[3]);return[t.color[0],t.color[1],t.color[2],o]},ene=(t,e,n,r,i,s)=>{const o=e&&t.id===e.id,l=Ic(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]);let u=1;if(i==="planes"&&r){const[d,h]=r;t.time>=d&&t.time<=h||(u=pt.REDUCED_OPACITY_MULTIPLIER)}if(o)return s.nodeSelected;if(l)return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],s.nodeSelected[3]*u];if(t.is_sample){const d=s.background==="#ffffff"?0:255;return[d,d,d,255*u]}return[s.nodeSelected[0],s.nodeSelected[1],s.nodeSelected[2],0]},tne=(t,e,n)=>{const r=e&&t.id===e.id,i=Ic(t,(n==null?void 0:n.nodes)||[],(n==null?void 0:n.edges)||[]),o=(r?t.size*pt.SELECTED_NODE_SCALE:t.size)/Hl.DEFAULT;return r?Math.max(1,Zi.NODE_OUTLINE_SELECTED*o):i?Math.max(.8,Zi.NODE_OUTLINE_ROOT*o):t.is_sample?Math.max(.5,Zi.NODE_OUTLINE_SAMPLE*o):0},nne=(t,e,n,r)=>{var s;let i="";return t.is_sample?i="Sample Node":t.is_combined?i=`Combined Node (contains: ${(s=t.combined_nodes)==null?void 0:s.join(", ")})`:Ic(t,(e==null?void 0:e.nodes)||[],(e==null?void 0:e.edges)||[])?i="Root Node":i="Internal Node",{html:`
      <div style="background: ${r.tooltipBackground}; color: ${r.tooltipText}; padding: 8px; border-radius: 4px; font-size: 12px;">
        <strong>Node ${t.id}</strong><br/>
        Time: ${t.time.toFixed(3)}<br/>
        ${i}<br/>
        ${t.location?`Location: ${$te(t.location.x,t.location.y,n==="eastern_hemisphere")}`:""}
      </div>
    `,style:{backgroundColor:"transparent",color:r.tooltipText}}},ej=nc.forwardRef(({data:t,width:e,height:n,onNodeClick:r,onNodeRightClick:i,selectedNode:s,temporalRange:o,showTemporalPlanes:l=!1,temporalFilterMode:u=null,temporalSpacing:d=12,spatialSpacing:h=160,geographicShape:g=null,geographicMode:_="unit_grid",temporalGridOpacity:y=30,geographicShapeOpacity:T=70,maxNodeRadius:w=25,onViewStateChange:x,externalViewState:S,temporalSpacingMode:A="equal"},R)=>{const E=U.useRef(null),{colors:C}=Ht(),[I,O]=U.useState({target:[0,0,0],zoom:pt.AUTO_FIT_ZOOM,minZoom:pt.MIN_ZOOM,maxZoom:pt.MAX_ZOOM,rotationX:30,rotationOrbit:0,orbitAxis:"Y"});nc.useEffect(()=>{S&&O(W=>({...W,...S}))},[S]);const M=U.useMemo(()=>!t||!t.nodes.length?null:Gte(t.nodes,_,g),[t,_,g==null?void 0:g.bounds]),{nodes3D:P,edges3D:N,bounds:B}=U.useMemo(()=>{if(!M)return{nodes3D:[],edges3D:[],bounds:null};const{nodes:W,edges:q}=QD(t.nodes,t.edges),ee=Array.from(new Set(W.map(oe=>oe.time))).sort((oe,ie)=>oe-ie),de=Zte(M.spatialNodes,M,d,h,C,W,q,ee,A),Z=new Map;de.forEach(oe=>Z.set(oe.id,oe));const D=Qte(q,Z,o||null,u||null,C),G={minX:Math.min(...de.map(oe=>oe.position[0])),maxX:Math.max(...de.map(oe=>oe.position[0])),minY:Math.min(...de.map(oe=>oe.position[1])),maxY:Math.max(...de.map(oe=>oe.position[1])),minZ:Math.min(...de.map(oe=>oe.position[2])),maxZ:Math.max(...de.map(oe=>oe.position[2]))};return{nodes3D:de,edges3D:D,bounds:G}},[M,d,h,A,u,o,C]),z=U.useMemo(()=>{if(!l||!o||!B)return[];const W=aM(g,_,h);if(!W)return[];const q=Array.from(new Set(P.map(D=>D.time))).sort((D,G)=>D-G),ee=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2]],de=(o[0]+o[1])/2,Z=JD(de,q,d,A);return ZD(W,q,d,h,ee,o,Z)},[l,o,B,P,d,A,h,C.textSecondary,g,_]),Q=U.useMemo(()=>{if(!B||!P.length)return[];const W=aM(g,_,h);if(!W)return[];const q=l&&u==="planes",ee=T??70,de=ee>0?q?Math.max(ee*pt.GEOGRAPHIC_REDUCED_OPACITY,8):ee*pt.GEOGRAPHIC_OPACITY_SCALE:0,Z=q?Zi.GEOGRAPHIC_ACTIVE:Zi.GEOGRAPHIC_NORMAL,D=[C.geographicGrid[0],C.geographicGrid[1],C.geographicGrid[2],de],oe=[...de>0?r2(W,0,h,D,Z):[]],ie=Array.from(new Set(P.map(Se=>Se.time))).sort((Se,ke)=>Se-ke),F=new Map(ie.map((Se,ke)=>[Se,ke])),$=y??30,Y=q?Math.min($*pt.TEMPORAL_OPACITY_SCALE,8):$,ue=q?Zi.TIME_SLICE_ACTIVE:Zi.TIME_SLICE_NORMAL,ye=[C.temporalGrid[0],C.temporalGrid[1],C.temporalGrid[2],Y];return Y>0&&ie.forEach(Se=>{const Ue=(F.get(Se)||0)*d;Ue!==0&&(oe.push({source:[B.minX-pt.GRID_EXTENSION,0,Ue],target:[B.maxX+pt.GRID_EXTENSION,0,Ue],color:ye,width:ue}),oe.push({source:[0,B.minY-pt.GRID_EXTENSION,Ue],target:[0,B.maxY+pt.GRID_EXTENSION,Ue],color:ye,width:ue}))}),oe},[B,C.textSecondary,P,d,h,g,_,l,u,y,T]),H=[...Q.length>0?[new Jl({id:"geographic-lines",data:Q,pickable:!1,getSourcePosition:W=>W.source,getTargetPosition:W=>W.target,getColor:W=>W.color,getWidth:W=>W.width||.5})]:[],...l&&z.length>0?[new Jl({id:"temporal-plane-lines",data:z,pickable:!1,getSourcePosition:W=>W.source,getTargetPosition:W=>W.target,getColor:W=>W.color,getWidth:W=>W.width})]:[],new Jl({id:"edges",data:N,pickable:!1,getSourcePosition:W=>W.source,getTargetPosition:W=>W.target,getColor:W=>W.color,getWidth:pt.EDGE_WIDTH}),new n2({id:"nodes",data:P,pickable:!0,opacity:pt.NODE_OPACITY,stroked:!0,filled:!0,radiusScale:pt.NODE_RADIUS_SCALE,radiusMinPixels:pt.MIN_NODE_RADIUS,radiusMaxPixels:w,lineWidthMinPixels:pt.MIN_NODE_RADIUS,lineWidthMaxPixels:Zi.MAX_NODE_OUTLINE,getPosition:W=>W.position,getRadius:W=>s&&W.id===s.id?W.size*pt.SELECTED_NODE_SCALE:W.size,getFillColor:W=>Jte(W,s||null,o||null,u||null,C),getLineColor:W=>ene(W,s||null,t,o||null,u||null,C),getLineWidth:W=>tne(W,s||null,t),onClick:(W,q)=>{q.srcEvent.preventDefault(),W.object&&r&&r(W.object)},onHover:W=>{W.rightButton&&W.object&&i&&i(W.object)}})];return!t||P.length===0?m.jsx("div",{className:"flex items-center justify-center border rounded bg-sp-very-dark-blue text-sp-white border-sp-dark-blue",style:{width:e,height:n},children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-lg mb-2",children:"No spatial data available"}),m.jsx("p",{className:"text-sm text-sp-white/75",children:"This ARG does not contain 2D spatial information required for 3D visualization."})]})}):m.jsx("div",{style:{width:e,height:n},className:"relative bg-sp-very-dark-blue","data-3d-visualization":"true",ref:W=>{W&&typeof R=="function"?R(W):W&&R&&"current"in R&&(R.current=W),W&&(W.getExportData=()=>({nodes:P,edges:N,bounds:B,currentViewState:I}),W.setViewState=q=>{O(ee=>({...ee,...q}))})},onContextMenu:W=>{W.preventDefault();const q=W.currentTarget.getBoundingClientRect(),ee=W.clientX-q.left,de=W.clientY-q.top;if(E.current){const Z=E.current.pickObject({x:ee,y:de,radius:10});Z!=null&&Z.object&&i&&i(Z.object)}},children:m.jsx(kte,{ref:E,width:e,height:n,views:new XD,viewState:I,onViewStateChange:({viewState:W})=>{O(W),x==null||x(W)},controller:{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0},layers:H,getCursor:()=>"crosshair",style:{backgroundColor:C.background},getTooltip:({object:W})=>W?nne(W,t,_,C):null})})});ej.displayName="SpatialArg3DVisualization";const i2=({initialPosition:t={x:0,y:0},onPositionChange:e,dragHandleRef:n}={})=>{const[r,i]=U.useState({position:t,isDragging:!1,dragOffset:{x:0,y:0},hasMoved:!1,startTime:0}),s=U.useRef(null),o=U.useCallback(h=>{var T;if(n!=null&&n.current&&!n.current.contains(h.target))return;const g=(T=s.current)==null?void 0:T.getBoundingClientRect();if(!g)return;const _=r.position.x===0&&r.position.y===0?{x:g.left,y:g.top}:r.position,y={x:h.clientX-g.left,y:h.clientY-g.top};i(w=>({...w,position:_,isDragging:!0,dragOffset:y,hasMoved:!1,startTime:Date.now()})),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"},[n,r.position]),l=U.useCallback(h=>{var S;if(!r.isDragging)return;const g={x:h.clientX-r.dragOffset.x,y:h.clientY-r.dragOffset.y},_=window.innerWidth,y=window.innerHeight,T=(S=s.current)==null?void 0:S.getBoundingClientRect();T&&(g.x=Math.max(0,Math.min(_-T.width,g.x)),g.y=Math.max(0,Math.min(y-T.height,g.y)));const w=Date.now()-r.startTime>150,x=Math.abs(g.x-r.position.x)>3||Math.abs(g.y-r.position.y)>3;i(A=>({...A,position:g,hasMoved:A.hasMoved||w||x})),e==null||e(g)},[r.isDragging,r.dragOffset,r.startTime,r.position,e]),u=U.useCallback(()=>{i(h=>({...h,isDragging:!1})),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(r.isDragging)return document.addEventListener("mousemove",l),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)}},[r.isDragging,l,u]);const d=r.position.x!==0||r.position.y!==0;return{position:r.position,isDragging:r.isDragging,hasMoved:r.hasMoved,isRepositioned:d,elementRef:s,dragProps:{onMouseDown:o,style:d?{position:"fixed",left:r.position.x,top:r.position.y,cursor:r.isDragging?"grabbing":"grab",zIndex:r.isDragging?9999:void 0}:{cursor:"grab"}},setPosition:h=>{i(g=>({...g,position:h})),e==null||e(h)}}},rne=({temporalSpacing:t,onTemporalSpacingChange:e,temporalSpacingMode:n,onTemporalSpacingModeChange:r,spatialSpacing:i,onSpatialSpacingChange:s,temporalGridOpacity:o,onTemporalGridOpacityChange:l,geographicShapeOpacity:u,onGeographicShapeOpacityChange:d,maxNodeRadius:h,onMaxNodeRadiusChange:g,geographicMode:_,onGeographicModeChange:y,customShapeFile:T,onCustomShapeFileChange:w,isLoadingGeographic:x,currentShape:S,showCrsWarning:A,crsDetection:R,onDismissCrsWarning:E})=>{const{colors:C}=Ht(),[I,O]=U.useState(!0),M=U.useRef(null),{elementRef:P,dragProps:N,hasMoved:B,isRepositioned:z}=i2({initialPosition:{x:0,y:0},dragHandleRef:M}),Q=W=>{y(W)},H=W=>{var ee;const q=(ee=W.target.files)==null?void 0:ee[0];q&&w(q)};return m.jsxs("div",{ref:P,className:`border rounded-lg shadow-lg z-30 ${z?"":"absolute top-4 left-4"}`,style:{backgroundColor:`${C.background}F0`,borderColor:C.border,color:C.text,...N.style},onMouseDown:N.onMouseDown,children:[m.jsxs("div",{ref:M,onClick:()=>!B&&O(!I),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:I?"transparent":`${C.containerBackground}80`},onMouseEnter:W=>{I||(W.currentTarget.style.backgroundColor=`${C.border}40`)},onMouseLeave:W=>{I||(W.currentTarget.style.backgroundColor=`${C.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:C.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),"3D Visualization Controls"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${I?"rotate-180":""}`,style:{color:C.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),I&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Geographic Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Geographic Mode"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[m.jsx("button",{onClick:()=>Q("unit_grid"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="unit_grid"?C.accentPrimary:C.containerBackground,color:_==="unit_grid"?C.background:C.text},children:"Unit Grid"}),m.jsx("button",{onClick:()=>Q("eastern_hemisphere"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="eastern_hemisphere"?C.accentPrimary:C.containerBackground,color:_==="eastern_hemisphere"?C.background:C.text},children:"Eastern Hemisphere"}),m.jsx("button",{onClick:()=>Q("custom"),className:"flex-1 px-3 py-1.5 text-xs font-medium transition-colors",style:{backgroundColor:_==="custom"?C.accentPrimary:C.containerBackground,color:_==="custom"?C.background:C.text},children:"Custom"})]})]}),_==="custom"&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-xs",style:{color:C.accentPrimary},children:"Upload Shapefile (.zip)"}),m.jsx("input",{type:"file",accept:".zip",onChange:H,className:"w-full text-xs border rounded px-2 py-1 transition-colors",style:{color:C.text,backgroundColor:C.containerBackground,borderColor:`${C.accentPrimary}33`},onMouseEnter:W=>{W.currentTarget.style.borderColor=`${C.accentPrimary}66`},onMouseLeave:W=>{W.currentTarget.style.borderColor=`${C.accentPrimary}33`}}),T&&m.jsxs("p",{className:"text-xs",style:{color:C.accentPrimary},children:["Selected: ",T.name]})]}),x&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:C.accentPrimary}}),m.jsx("span",{className:"text-xs",style:{color:C.text},children:"Loading geographic data..."})]}),S&&m.jsxs("div",{className:"text-xs",style:{color:`${C.text}B3`},children:[m.jsxs("div",{children:["Shape: ",S.name]}),S.bounds&&m.jsx("div",{children:"Shape loaded successfully"})]}),A&&R&&m.jsxs("div",{className:"border rounded p-3 space-y-2",style:{backgroundColor:`${C.background}33`,borderColor:`${C.accentPrimary}4D`},children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("h5",{className:"text-xs font-bold",style:{color:C.accentPrimary},children:"Coordinate System Detected"}),m.jsx("button",{onClick:E,className:"text-xs",style:{color:`${C.accentPrimary}B3`},onMouseEnter:W=>{W.currentTarget.style.color=C.accentPrimary},onMouseLeave:W=>{W.currentTarget.style.color=`${C.accentPrimary}B3`},children:""})]}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:`${C.accentPrimary}E6`},children:[m.jsxs("div",{children:["CRS: ",R.crs]}),m.jsxs("div",{children:["Confidence: ",(R.confidence*100).toFixed(1),"%"]}),m.jsxs("div",{children:["Land coverage: ",(R.landPercentage*100).toFixed(1),"%"]}),m.jsx("div",{className:"italic",children:R.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Temporal Spacing"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("label",{className:"text-xs font-medium",style:{color:C.text},children:"Spacing Mode"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:C.containerBackground},children:[m.jsx("button",{onClick:()=>r("equal"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="equal"?C.accentPrimary:C.containerBackground,color:n==="equal"?C.background:C.text},children:"Equal"}),m.jsx("button",{onClick:()=>r("log"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="log"?C.accentPrimary:C.containerBackground,color:n==="log"?C.background:C.text},children:"Log"}),m.jsx("button",{onClick:()=>r("linear"),className:"px-2 py-1 text-xs font-medium transition-colors",style:{backgroundColor:n==="linear"?C.accentPrimary:C.containerBackground,color:n==="linear"?C.background:C.text},children:"Linear"})]})]}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("label",{className:"text-xs font-medium",style:{color:C.text},children:["Spacing: ",t]})}),m.jsx("input",{type:"range",min:5,max:50,step:1,value:t,onChange:W=>e(Number(W.target.value)),className:"w-full h-1 rounded-lg cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(t-5)/45*100}%, ${C.border} ${(t-5)/45*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),m.jsxs("div",{className:"text-xs",style:{color:`${C.text}CC`},children:[n==="equal"&&m.jsx("div",{children:" Time points are spaced equally"}),n==="log"&&m.jsx("div",{children:" Time points are spaced logarithmically based on their actual values"}),n==="linear"&&m.jsx("div",{children:" Time points are spaced according to their actual time values"})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Spacing"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Spatial Spacing: ",i]}),m.jsx("input",{type:"range",min:50,max:500,step:10,value:i,onChange:W=>s(Number(W.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(i-50)/450*100}%, ${C.border} ${(i-50)/450*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Opacity"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Temporal Grid: ",o,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:o,onChange:W=>l(Number(W.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${o}%, ${C.border} ${o}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Geographic Shape: ",u,"%"]}),m.jsx("input",{type:"range",min:0,max:100,step:5,value:u,onChange:W=>d(Number(W.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${u}%, ${C.border} ${u}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:C.text},children:"Node Settings"}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-xs",style:{color:C.accentPrimary},children:["Max Node Radius: ",h,"px"]}),m.jsx("input",{type:"range",min:10,max:50,step:1,value:h,onChange:W=>g(Number(W.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${C.accentPrimary} 0%, ${C.accentPrimary} ${(h-10)/40*100}%, ${C.border} ${(h-10)/40*100}%, ${C.border} 100%)`,accentColor:C.accentPrimary}})]})]})]})]})},ine=({originalNodeCount:t,originalEdgeCount:e,subargNodeCount:n,subargEdgeCount:r,displayedNodeCount:i,displayedEdgeCount:s,crsDetection:o})=>{const{colors:l}=Ht(),[u,d]=U.useState(!0),h=U.useRef(null),{elementRef:g,dragProps:_,hasMoved:y,isRepositioned:T}=i2({initialPosition:{x:0,y:0},dragHandleRef:h}),w=t&&n?(n/t*100).toFixed(1):null,x=e&&r?(r/e*100).toFixed(1):null;return t||n||i||o?m.jsxs("div",{ref:g,className:`border rounded-lg shadow-lg z-10 ${T?"":"absolute top-4 right-4"}`,style:{backgroundColor:`${l.background}F0`,borderColor:l.border,color:l.text,maxWidth:"280px",..._.style},onMouseDown:_.onMouseDown,children:[m.jsxs("div",{ref:h,onClick:()=>!y&&d(!u),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:u?"transparent":`${l.containerBackground}80`},onMouseEnter:A=>{u||(A.currentTarget.style.backgroundColor=`${l.border}40`)},onMouseLeave:A=>{u||(A.currentTarget.style.backgroundColor=`${l.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:l.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"ARG Information"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:l.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[(t||n||i)&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Graph Statistics"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[t&&e&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Original ARG:"}),m.jsxs("span",{style:{color:l.text},children:[t.toLocaleString()," nodes, ",e.toLocaleString()," edges"]})]}),n&&r&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"SubARG:"}),m.jsxs("span",{style:{color:l.text},children:[n.toLocaleString()," nodes (",w,"%), ",r.toLocaleString()," edges (",x,"%)"]})]}),i&&s&&(i!==n||s!==r)&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Displayed:"}),m.jsxs("span",{style:{color:l.text},children:[i.toLocaleString()," nodes, ",s.toLocaleString()," edges"]})]}),i&&t&&i!==t&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Reduction:"}),m.jsxs("span",{style:{color:l.text},children:[((1-i/t)*100).toFixed(1),"% fewer nodes"]})]})]})]}),o&&m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Coordinate System"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Detected CRS:"}),m.jsx("span",{style:{color:l.text},children:o.crs})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Confidence:"}),m.jsxs("span",{style:{color:l.text},children:[(o.confidence*100).toFixed(1),"%"]})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{style:{color:l.accentPrimary},children:"Land Coverage:"}),m.jsxs("span",{style:{color:l.text},children:[(o.landPercentage*100).toFixed(1),"%"]})]}),o.description&&m.jsxs("div",{className:"mt-2",children:[m.jsx("div",{className:"mb-1",style:{color:l.accentPrimary},children:"Description:"}),m.jsx("div",{className:"text-xs italic",style:{color:`${l.text}CC`},children:o.description})]})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"View Controls"}),m.jsxs("div",{className:"space-y-1 text-xs",style:{color:`${l.text}CC`},children:[m.jsx("div",{children:" Drag: Rotate view"}),m.jsx("div",{children:" Shift+drag: Pan view"}),m.jsx("div",{children:" Scroll: Zoom in/out"}),m.jsx("div",{children:" Left click: Select node"}),m.jsx("div",{children:" Right click: Show ancestors"})]})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:l.text},children:"Node Types"}),m.jsxs("div",{className:"space-y-2 text-xs",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:`rgb(${l.nodeSample[0]}, ${l.nodeSample[1]}, ${l.nodeSample[2]})`,borderColor:l.background,borderWidth:"0.5px"}}),m.jsx("span",{style:{color:l.text},children:"Sample Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeDefault[0]}, ${l.nodeDefault[1]}, ${l.nodeDefault[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Internal Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${l.nodeCombined[0]}, ${l.nodeCombined[1]}, ${l.nodeCombined[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Combined Nodes"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full border-2",style:{backgroundColor:`rgb(${l.nodeRoot[0]}, ${l.nodeRoot[1]}, ${l.nodeRoot[2]})`,borderColor:`rgb(${l.nodeSelected[0]}, ${l.nodeSelected[1]}, ${l.nodeSelected[2]})`}}),m.jsx("span",{style:{color:l.text},children:"Root Nodes"})]})]})]})]})]}):null},Nx={FIT:1.8,MEDIUM:1.2,FAR:.8},sne=({currentViewState:t,bounds:e,onViewStateChange:n})=>{const{colors:r}=Ht(),[i,s]=U.useState(!0),o=U.useRef(null),{elementRef:l,dragProps:u,hasMoved:d,isRepositioned:h}=i2({initialPosition:{x:0,y:0},dragHandleRef:o}),g=()=>e?[(e.minX+e.maxX)/2,(e.minY+e.maxY)/2,(e.minZ+e.maxZ)/2]:[0,0,0],_=(S,A,R)=>{const E=g();n({target:E,rotationOrbit:S,rotationX:A,zoom:R})},y=()=>{const S=g();n({target:S})},T=[{value:Nx.FIT,label:"Fit All",icon:""},{value:Nx.MEDIUM,label:"Medium",icon:""},{value:Nx.FAR,label:"Far",icon:""}],w=S=>{const A=S%360;_(A,t.rotationX,t.zoom)},x=S=>{const A=Math.max(0,Math.min(90,S));_(t.rotationOrbit,A,t.zoom)};return m.jsxs("div",{ref:l,className:`border rounded-lg shadow-lg z-20 ${h?"":"absolute"}`,style:{backgroundColor:`${r.background}F0`,borderColor:r.border,color:r.text,...h?{}:{top:16,right:300},...u.style},onMouseDown:u.onMouseDown,children:[m.jsxs("div",{ref:o,onClick:()=>!d&&s(!i),className:"flex items-center justify-between p-4 cursor-pointer rounded-t-lg transition-colors",style:{backgroundColor:i?"transparent":`${r.containerBackground}80`},onMouseEnter:S=>{i||(S.currentTarget.style.backgroundColor=`${r.border}40`)},onMouseLeave:S=>{i||(S.currentTarget.style.backgroundColor=`${r.containerBackground}80`)},children:[m.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",style:{color:r.text},children:[m.jsx("svg",{className:"w-3 h-3 opacity-50",fill:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2z"})}),m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Preset Views"]}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`,style:{color:r.accentPrimary},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&m.jsxs("div",{className:"p-4 pt-0 space-y-4 max-h-96 overflow-y-auto",children:[m.jsx("div",{className:"space-y-2",children:m.jsxs("button",{onClick:y,className:"w-full px-2 py-1.5 text-xs font-medium rounded transition-colors flex items-center justify-center gap-1",style:{backgroundColor:r.accentPrimary,color:r.background,border:`1px solid ${r.accentPrimary}`},onMouseEnter:S=>{S.currentTarget.style.opacity="0.8"},onMouseLeave:S=>{S.currentTarget.style.opacity="1"},children:[m.jsxs("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v18m0 0l-4-4m4 4l4-4"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12h18m0 0l-4-4m4 4l-4 4"})]}),"Center ARG"]})}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Rotation"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationOrbit),""]}),m.jsx("input",{type:"range",min:0,max:360,step:1,value:t.rotationOrbit,onChange:S=>w(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationOrbit/360*100}%, ${r.border} ${t.rotationOrbit/360*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:360,value:Math.round(t.rotationOrbit),onChange:S=>w(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"View Angle"}),m.jsx("div",{className:"space-y-2",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("label",{className:"text-xs flex-shrink-0",style:{color:r.accentPrimary},children:[Math.round(t.rotationX),""]}),m.jsx("input",{type:"range",min:0,max:90,step:1,value:t.rotationX,onChange:S=>x(Number(S.target.value)),className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${r.accentPrimary} 0%, ${r.accentPrimary} ${t.rotationX/90*100}%, ${r.border} ${t.rotationX/90*100}%, ${r.border} 100%)`,accentColor:r.accentPrimary}}),m.jsx("input",{type:"number",min:0,max:90,value:Math.round(t.rotationX),onChange:S=>x(Number(S.target.value)),className:"w-12 px-1 py-0.5 text-xs border rounded",style:{color:r.text,backgroundColor:r.containerBackground,borderColor:r.border}})]})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Zoom Level"}),m.jsx("div",{className:"space-y-2",children:T.map(S=>m.jsxs("button",{onClick:()=>_(t.rotationOrbit,t.rotationX,S.value),className:"w-full px-3 py-2 text-xs font-medium rounded transition-colors flex items-center gap-2",style:{backgroundColor:Math.abs(t.zoom-S.value)<.1?r.accentPrimary:r.containerBackground,color:Math.abs(t.zoom-S.value)<.1?r.background:r.text,border:`1px solid ${r.border}`},title:`Set zoom to ${S.label}`,onMouseEnter:A=>{Math.abs(t.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.border)},onMouseLeave:A=>{Math.abs(t.zoom-S.value)>=.1&&(A.currentTarget.style.backgroundColor=r.containerBackground)},children:[m.jsx("span",{children:S.icon}),m.jsx("span",{children:S.label})]},S.value))})]}),m.jsxs("div",{className:"space-y-2 pt-2 border-t",style:{borderTopColor:r.border},children:[m.jsx("h4",{className:"text-sm font-bold",style:{color:r.text},children:"Current View"}),m.jsxs("div",{className:"text-xs space-y-1",style:{color:r.textSecondary},children:[m.jsxs("div",{children:["Rotation: ",Math.round(t.rotationOrbit),""]}),m.jsxs("div",{children:["Pan: ",Math.round(Math.abs(t.rotationX))," ",t.rotationX<0?"above":t.rotationX>0?"below":"level"]}),m.jsxs("div",{children:["Zoom: ",t.zoom.toFixed(2),"x"]})]})]})]})]})},ane=({min:t,max:e,step:n=.001,value:r,onChange:i,formatValue:s=u=>u.toFixed(3),className:o="",height:l=400})=>{const{colors:u}=Ht(),[d,h]=U.useState(null),[g,_]=U.useState({y:0,startValue:[0,0]}),[y,T]=U.useState(!1),[w,x]=U.useState(null),S=U.useRef(null);U.useEffect(()=>{const P=B=>{if(B.key==="Shift"){if(T(!0),w===null){const z=Math.abs(r[1]-r[0]);x(Math.max(z,n))}document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none"}},N=B=>{B.key==="Shift"&&(T(!1),x(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect="")};return document.addEventListener("keydown",P),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",P),document.removeEventListener("keyup",N),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""}},[r,w,n]);const A=U.useCallback(P=>{if(!S.current)return e;const N=S.current.getBoundingClientRect(),B=Math.max(0,Math.min(1,(N.bottom-P)/N.height)),z=t+B*(e-t);return Math.round(z/n)*n},[t,e,n]),R=U.useCallback(P=>(e-P)/(e-t)*100,[t,e]),E=U.useCallback((P,N)=>{P.preventDefault(),P.stopPropagation(),document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",document.body.style.msUserSelect="none",h(N),_({y:P.clientY,startValue:r})},[r]),C=U.useCallback(P=>{if(!d||!S.current)return;const N=A(P.clientY),[B,z]=r;if(d==="top"){const Q=Math.max(t,Math.min(e,N));Q<B?i([Q,B]):i([B,Q])}else if(d==="bottom"){const Q=Math.max(t,Math.min(e,N));Q>z?i([z,Q]):i([Q,z])}else if(d==="range"){const Q=P.clientY-g.y,H=S.current.getBoundingClientRect(),W=-(Q/H.height)*(e-t),[q,ee]=g.startValue;let de=Math.abs(ee-q);y&&w!==null&&(de=w);const D=(q+ee)/2+W;let G,oe;y&&w!==null?(G=D-de/2,oe=D+de/2):(G=q+W,oe=ee+W),G<t&&(G=t,oe=t+de),oe>e&&(oe=e,G=e-de),i([Math.round(G/n)*n,Math.round(oe/n)*n])}},[d,r,i,A,t,e,n,g,y,w]),I=U.useCallback(()=>{h(null),document.body.style.userSelect="",document.body.style.webkitUserSelect="",document.body.style.msUserSelect=""},[]);U.useEffect(()=>{if(d)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",I),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",I)}},[d,C,I]);const O=R(r[1]),M=R(r[0]);return m.jsxs("div",{className:`flex items-center gap-3 ${o}`,style:{height:l,userSelect:"none"},children:[m.jsxs("div",{className:"flex flex-col justify-between text-xs",style:{color:u.text,height:l},children:[m.jsx("span",{children:s(e)}),m.jsx("span",{children:s(r[1])}),m.jsx("span",{className:"flex-1"}),m.jsx("span",{children:s(r[0])}),m.jsx("span",{children:s(t)})]}),m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsxs("div",{ref:S,className:"relative w-4 rounded-full cursor-pointer",style:{height:l-40,backgroundColor:u.containerBackground},onMouseDown:P=>{const N=A(P.clientY),[B,z]=r,Q=Math.abs(N-B),H=Math.abs(N-z);y||Math.abs(z-B)<n*2?E(P,"range"):Q<H?E(P,"bottom"):E(P,"top")},children:[m.jsx("div",{className:`absolute w-full rounded-full transition-opacity ${y?"cursor-grabbing":"cursor-grab"} active:cursor-grabbing`,style:{top:`${O}%`,height:`${M-O}%`,backgroundColor:y?u.text:u.textSecondary,opacity:y?.8:1,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"range")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${O}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"top")}}),m.jsx("div",{className:"absolute w-6 h-6 border-2 rounded-full transform -translate-x-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing shadow-md",style:{top:`${M}%`,left:"50%",backgroundColor:u.background,borderColor:u.textSecondary,userSelect:"none"},onMouseDown:P=>{P.preventDefault(),P.stopPropagation(),E(P,"bottom")}})]}),m.jsxs("div",{className:"mt-2 text-xs text-center",style:{color:u.text},children:[m.jsx("div",{children:"Temporal"}),m.jsx("div",{children:"Filter"}),m.jsx("div",{className:"mt-1 h-4 flex items-center justify-center",children:y?m.jsx("div",{className:"px-1 py-0.5 rounded text-xs opacity-80",style:{backgroundColor:u.textSecondary,color:u.background,fontSize:"10px"},children:"Fixed"}):null})]})]})]})},Wn={DEFAULT_DIMENSIONS:{width:800,height:600},DEBOUNCE_DELAY:500,GENOMIC_STEP_DIVISOR:1e3,PERCENTAGE_PRECISION:1,TIME_PRECISION:3,TEMPORAL_STEP_DIVISOR:1e3,TEMPORAL_SLIDER_HEIGHT:350,UNIT_GRID_SIZE:10},one={temporalSpacing:12,spatialSpacing:160,temporalGridOpacity:30,geographicShapeOpacity:70,maxNodeRadius:25,isFilterSectionCollapsed:!0,temporalSpacingMode:"equal"},cd=t=>t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),oM=(t,e)=>(t/e*100).toFixed(Wn.PERCENTAGE_PRECISION),lne=t=>t.map(([e,n,r])=>({index:e,left:n,right:r})),tj=(t,e,n)=>{const r=new Set,i=new Set,s=[t.id];for(;s.length>0;){const o=s.shift();i.has(o)||(i.add(o),e.forEach(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;if(n==="descendants"?u===o&&!i.has(d):d===o&&!i.has(u)){const g=n==="descendants"?d:u;r.add(g),s.push(g)}}))}return r},cne=(t,e)=>tj(t,e,"descendants"),une=(t,e)=>tj(t,e,"ancestors"),lM=t=>t.nodes.filter(n=>{var r,i;return((r=n.location)==null?void 0:r.x)!==void 0&&((i=n.location)==null?void 0:i.y)!==void 0}).length>0,fne=t=>{if(!(t!=null&&t.length))return{minTime:0,maxTime:1,range:[0,1]};const e=t.map(i=>i.time),n=Math.min(...e),r=Math.max(...e);return{minTime:n,maxTime:r,range:[n,n]}},dne=(t,e,n)=>{const r={maxSamples:n};return t.mode==="genomic"&&(t.genomicRange[0]!==0||t.genomicRange[1]!==e.sequenceLength)?(r.genomicStart=t.genomicRange[0],r.genomicEnd=t.genomicRange[1]):t.mode==="tree"&&(t.treeRange[0]!==0||t.treeRange[1]!==e.treeIntervals.length-1)&&(r.treeStartIdx=t.treeRange[0],r.treeEndIdx=t.treeRange[1]),r},hne=(t,e,n)=>{if(!n)return t;const r=i=>{const s=t.nodes.filter(l=>i.has(l.id)),o=t.edges.filter(l=>{const u=typeof l.source=="number"?l.source:l.source.id,d=typeof l.target=="number"?l.target:l.target.id;return i.has(u)&&i.has(d)});return{...t,nodes:s,edges:o,metadata:{...t.metadata,is_subset:!0}}};switch(e){case"subgraph":{const i=cne(n,t.edges);return i.add(n.id),r(i)}case"ancestors":{const i=une(n,t.edges);return i.add(n.id),r(i)}default:return t}},pne=(t,e)=>{if(!e.isActive||e.mode!=="hide")return t;const[n,r]=e.range;if(n===e.minTime&&r===e.maxTime)return t;const s=t.nodes.filter(u=>u.time>=n&&u.time<=r),o=new Set(s.map(u=>u.id)),l=t.edges.filter(u=>{const d=typeof u.source=="number"?u.source:u.source.id,h=typeof u.target=="number"?u.target:u.target.id;return o.has(d)&&o.has(h)});return{...t,nodes:s,edges:l,metadata:{...t.metadata,is_subset:!0}}},gne=(t,e,n,r)=>!t||!e||!n||!r?null:{originalNodes:e.metadata.original_num_nodes||r.num_nodes,originalEdges:e.metadata.original_num_edges||r.num_edges,subArgNodes:t.nodes.length,subArgEdges:t.edges.length,displayedNodes:n.nodes.length,displayedEdges:n.edges.length},mne=(t,e,n,r)=>{let i="";switch(t){case"subgraph":i=`3D SubARG at Root ${e==null?void 0:e.id}`;break;case"ancestors":i=`3D Parent ARG of Node ${e==null?void 0:e.id}`;break;default:i="3D Full ARG"}return n.isActive&&(r==null?void 0:r.metadata.genomic_start)!==void 0&&(r==null?void 0:r.metadata.genomic_end)!==void 0&&(i+=` (${cd(r.metadata.genomic_start)} - ${cd(r.metadata.genomic_end)})`),i},_ne=({data:t,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,temporalSpacingMode:u,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,viewState:x})=>{const S=U.useRef(null),[A,R]=U.useState(Wn.DEFAULT_DIMENSIONS);return U.useEffect(()=>{const E=()=>{if(S.current){const{clientWidth:I,clientHeight:O}=S.current;R({width:I||Wn.DEFAULT_DIMENSIONS.width,height:O||Wn.DEFAULT_DIMENSIONS.height})}};E(),window.addEventListener("resize",E);let C=null;return window.ResizeObserver&&S.current&&(C=new ResizeObserver(E),C.observe(S.current)),()=>{window.removeEventListener("resize",E),C&&C.disconnect()}},[]),m.jsx("div",{ref:S,className:"w-full h-full",children:m.jsx(ej,{data:t,width:A.width,height:A.height,onNodeClick:e,onNodeRightClick:n,selectedNode:r,temporalRange:i,showTemporalPlanes:s,temporalFilterMode:o,temporalSpacing:l,spatialSpacing:d,geographicShape:h,geographicMode:g,temporalGridOpacity:_,geographicShapeOpacity:y,maxNodeRadius:T,onViewStateChange:w,externalViewState:x,temporalSpacingMode:u})})},vne=({filename:t,max_samples:e})=>{const{colors:n}=Ht(),{treeSequence:r}=Hs(),[i,s]=U.useState(null),[o,l]=U.useState(null),[u,d]=U.useState(!0),[h,g]=U.useState(null),[_,y]=U.useState("full"),[T,w]=U.useState(null),[x,S]=U.useState({isActive:!1,mode:"genomic",genomicRange:[0,0],treeRange:[0,0]}),[A,R]=U.useState({isActive:!1,mode:"planes",range:[0,1],minTime:0,maxTime:1}),[E,C]=U.useState({sequenceLength:0,treeIntervals:[]}),[I,O]=U.useState(one),[M,P]=U.useState({target:[0,0,0],zoom:1.8,rotationX:30,rotationOrbit:0,orbitAxis:"Y"}),[N,B]=U.useState({mode:"unit_grid",currentShape:null,customShapeFile:null,isLoading:!1,showCrsWarning:!1}),z=U.useCallback(async()=>{try{if(B(F=>({...F,isLoading:!0})),N.mode==="unit_grid"){const{createUnitGridShape:F}=await rk(async()=>{const{createUnitGridShape:Y}=await Promise.resolve().then(()=>sM);return{createUnitGridShape:Y}},void 0),$=F(Wn.UNIT_GRID_SIZE);B(Y=>({...Y,currentShape:$}))}else if(N.mode==="custom"&&N.customShapeFile){const F=await mt.uploadShapefile(N.customShapeFile);console.log("Custom shapefile uploaded:",F.data)}else try{const F=await mt.getShapeData(N.mode);B($=>({...$,currentShape:F.data}))}catch{console.warn(`Failed to load ${N.mode}, using fallback`);const{createUnitGridShape:$}=await rk(async()=>{const{createUnitGridShape:ue}=await Promise.resolve().then(()=>sM);return{createUnitGridShape:ue}},void 0),Y=$(Wn.UNIT_GRID_SIZE);B(ue=>({...ue,currentShape:Y}))}}catch(F){console.error("Error loading geographic data:",F)}finally{B(F=>({...F,isLoading:!1}))}},[N.mode,N.customShapeFile]);U.useEffect(()=>{z()},[z]),U.useEffect(()=>{(async()=>{var $,Y;try{d(!0);const ye=(await mt.getGraphData(t,{maxSamples:e})).data;if(ye.metadata.sequence_length&&(C(Se=>({...Se,sequenceLength:ye.metadata.sequence_length})),S(Se=>({...Se,genomicRange:[0,ye.metadata.sequence_length]}))),($=ye.metadata.tree_intervals)!=null&&$.length){const Se=lne(ye.metadata.tree_intervals);C(ke=>({...ke,treeIntervals:Se})),S(ke=>({...ke,treeRange:[0,Se.length-1]}))}if((Y=ye.nodes)!=null&&Y.length){const Se=fne(ye.nodes);R(ke=>({...ke,...Se}))}if(!lM(ye))g("No spatial data found in this ARG. This visualization requires nodes with 2D spatial coordinates.");else if(s(ye),l(ye),G(ye),ye.metadata.suggested_geographic_mode){const Se=ye.metadata.suggested_geographic_mode;B(ke=>({...ke,mode:Se}))}}catch(ue){console.error("Error fetching 3D graph data:",ue),g(ue instanceof Error?ue.message:"Unknown error occurred")}finally{d(!1)}})()},[t,e]);const Q=U.useRef(null);U.useEffect(()=>{if(!(!x.isActive||u))return Q.current&&clearTimeout(Q.current),Q.current=setTimeout(async()=>{try{d(!0);const F=dne(x,E,e),Y=(await mt.getGraphData(t,F)).data;lM(Y)?(s(Y),g(null),G(Y)):g("No spatial data found in this range.")}catch(F){console.error("Error fetching filtered data:",F),g(F instanceof Error?F.message:"An error occurred while fetching graph data")}finally{d(!1)}},Wn.DEBOUNCE_DELAY),()=>{Q.current&&clearTimeout(Q.current)}},[x,t,e,E.sequenceLength,E.treeIntervals.length]),U.useEffect(()=>{O(F=>({...F,isFilterSectionCollapsed:!x.isActive&&!A.isActive}))},[x.isActive,A.isActive]);const H=()=>{if(!i)return i;const F=pne(i,A);return hne(F,_,T)},W=F=>{_==="full"?(w(F),y("subgraph")):(T==null?void 0:T.id)===F.id?(y("full"),w(null)):(w(F),y("subgraph"))},q=F=>{w(F),y("ancestors")},ee=()=>{y("full"),w(null)},de=F=>{P($=>({...$,...F}))},Z=F=>{P($=>({...$,...F}))},D=F=>{if(!F||!F.nodes.length)return null;const $=F.nodes.filter(Ye=>{var xe,Re;return((xe=Ye.location)==null?void 0:xe.x)!==void 0&&((Re=Ye.location)==null?void 0:Re.y)!==void 0});if($.length===0)return null;const Y=$.map(Ye=>Ye.location.x),ue=$.map(Ye=>Ye.location.y),ye=$.map(Ye=>Ye.time),Se=Math.min(...Y),ke=Math.max(...Y),Ue=Math.min(...ue),yt=Math.max(...ue),We=(Se+ke)/2,Fe=(Ue+yt)/2,De=Math.max(ke-Se,yt-Ue)||1,Jt=(Se-We)/De*I.spatialSpacing,Ne=(ke-We)/De*I.spatialSpacing,xn=(Ue-Fe)/De*I.spatialSpacing,Xt=(yt-Fe)/De*I.spatialSpacing,Cn=Array.from(new Set(ye)).sort((Ye,xe)=>Ye-xe),jt=0,fn=(Cn.length-1)*I.temporalSpacing;return{minX:Jt,maxX:Ne,minY:xn,maxY:Xt,minZ:jt,maxZ:fn}},G=F=>{const $=D(F);if($){const Y=[($.minX+$.maxX)/2,($.minY+$.maxY)/2,($.minZ+$.maxZ)/2];P(ue=>({...ue,target:Y}))}};if(u)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderColor:n.accentPrimary}}),m.jsx("p",{style:{color:n.text},children:"Loading 3D spatial ARG visualization..."})]})});if(h)return m.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:n.background},children:m.jsxs("div",{className:"text-center",style:{color:n.text},children:[m.jsx("p",{className:"text-lg mb-2",children:"Error loading visualization"}),m.jsx("p",{className:"text-sm",style:{color:`${n.text}B3`},children:h})]})});const oe=H(),ie=gne(o,i,oe,r);return m.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",style:{backgroundColor:n.background},children:[m.jsx("div",{className:"flex-shrink-0 border-b px-4 py-2",style:{backgroundColor:n.background,borderBottomColor:n.border},children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("div",{className:"flex flex-col gap-2",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-lg font-semibold",style:{color:n.headerText},children:mne(_,T,x,i)}),(E.sequenceLength>0||E.treeIntervals.length>0)&&m.jsxs("div",{className:"flex items-center gap-4",children:[E.sequenceLength>0&&m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[m.jsx("input",{type:"checkbox",checked:x.isActive,onChange:()=>S(F=>({...F,isActive:!F.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Genomic Range"]}),m.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",style:{color:n.headerText},children:[m.jsx("input",{type:"checkbox",checked:A.isActive,onChange:()=>R(F=>({...F,isActive:!F.isActive})),className:"w-4 h-4 rounded focus:ring-2",style:{accentColor:n.accentPrimary}}),"Filter Temporal Range"]})]}),_!=="full"&&m.jsx("button",{onClick:ee,className:"font-medium px-3 py-1 rounded text-sm transition-colors border",style:{backgroundColor:n.containerBackground,color:n.text,borderColor:`${n.accentPrimary}33`},onMouseEnter:F=>{F.currentTarget.style.borderColor=`${n.accentPrimary}66`,F.currentTarget.style.backgroundColor=`${n.containerBackground}CC`},onMouseLeave:F=>{F.currentTarget.style.borderColor=`${n.accentPrimary}33`,F.currentTarget.style.backgroundColor=n.containerBackground},children:"Return to Full ARG"})]})}),m.jsxs("div",{className:"flex items-center gap-6",children:[(x.isActive||A.isActive)&&m.jsxs("button",{onClick:()=>O(F=>({...F,isFilterSectionCollapsed:!F.isFilterSectionCollapsed})),className:"flex items-center gap-2 px-3 py-1 rounded text-sm font-medium transition-colors",style:{backgroundColor:n.accentPrimary,color:n.background},onMouseEnter:F=>{F.currentTarget.style.opacity="0.8"},onMouseLeave:F=>{F.currentTarget.style.opacity="1"},children:[m.jsx("span",{children:I.isFilterSectionCollapsed?"Show Controls":"Hide Controls"}),m.jsx("svg",{className:`w-4 h-4 transition-transform ${I.isFilterSectionCollapsed?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:n.headerText},children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border",style:{backgroundColor:`rgb(${n.nodeSample[0]}, ${n.nodeSample[1]}, ${n.nodeSample[2]})`,borderColor:n.background,borderWidth:"0.5px"}}),m.jsx("span",{children:"Sample"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeDefault[0]}, ${n.nodeDefault[1]}, ${n.nodeDefault[2]})`}}),m.jsx("span",{children:"Internal"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:`rgb(${n.nodeCombined[0]}, ${n.nodeCombined[1]}, ${n.nodeCombined[2]})`}}),m.jsx("span",{children:"Combined"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{backgroundColor:`rgb(${n.nodeRoot[0]}, ${n.nodeRoot[1]}, ${n.nodeRoot[2]})`,borderColor:`rgb(${n.nodeSelected[0]}, ${n.nodeSelected[1]}, ${n.nodeSelected[2]})`}}),m.jsx("span",{children:"Root"})]})]}),m.jsx("div",{className:"text-xs border-l pl-4",style:{color:n.headerText,borderLeftColor:n.border},children:"Left click: Subgraph  Right click: Ancestors"})]})]})}),(x.isActive||A.isActive)&&m.jsx("div",{className:"flex-shrink-0 border-b",style:{backgroundColor:n.background,borderBottomColor:n.border},children:!I.isFilterSectionCollapsed&&m.jsxs("div",{className:"px-4 py-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-6",children:[m.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0 min-w-0",children:[x.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Genomic Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[m.jsx("button",{onClick:()=>S(F=>({...F,mode:"genomic"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="genomic"?n.accentPrimary:n.containerBackground,color:x.mode==="genomic"?n.background:n.text},children:"Genomic"}),E.treeIntervals.length>0&&m.jsx("button",{onClick:()=>S(F=>({...F,mode:"tree"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:x.mode==="tree"?n.accentPrimary:n.containerBackground,color:x.mode==="tree"?n.background:n.text},children:"Tree Index"})]})]}),A.isActive&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm whitespace-nowrap",style:{color:n.text},children:"Temporal Mode:"}),m.jsxs("div",{className:"flex rounded overflow-hidden",style:{backgroundColor:n.containerBackground},children:[m.jsx("button",{onClick:()=>R(F=>({...F,mode:"hide"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="hide"?n.accentPrimary:n.containerBackground,color:A.mode==="hide"?n.background:n.text},children:"Hide Others"}),m.jsx("button",{onClick:()=>R(F=>({...F,mode:"planes"})),className:"px-3 py-1 text-xs font-medium transition-colors",style:{backgroundColor:A.mode==="planes"?n.accentPrimary:n.containerBackground,color:A.mode==="planes"?n.background:n.text},children:"Dim Others"})]})]})]}),x.isActive&&m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx("div",{className:"flex-1 max-w-md min-w-0",children:x.mode==="genomic"&&E.sequenceLength>0?m.jsx(TO,{min:0,max:E.sequenceLength,step:Math.max(1,Math.floor(E.sequenceLength/Wn.GENOMIC_STEP_DIVISOR)),value:x.genomicRange,onChange:F=>S($=>({...$,genomicRange:F})),formatValue:cd,className:"w-full"}):x.mode==="tree"&&E.treeIntervals.length>0?m.jsx(SO,{treeIntervals:E.treeIntervals,value:x.treeRange,onChange:F=>S($=>({...$,treeRange:F})),className:"w-full"}):null}),m.jsxs("div",{className:"text-xs flex-shrink-0",style:{color:n.text},children:[x.mode==="genomic"?m.jsxs("span",{children:[cd(x.genomicRange[1]-x.genomicRange[0])," bp (",oM(x.genomicRange[1]-x.genomicRange[0],E.sequenceLength),"%)",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",i.metadata.num_local_trees," trees"]})]}):x.mode==="tree"&&E.treeIntervals.length>0?m.jsxs("span",{children:["Trees ",x.treeRange[0],"-",x.treeRange[1]," (",x.treeRange[1]-x.treeRange[0]+1," of ",E.treeIntervals.length,")",(i==null?void 0:i.metadata.num_local_trees)!==void 0&&m.jsxs(m.Fragment,{children:["  ",i.metadata.expected_tree_count??i.metadata.num_local_trees," displayed"]}),(i==null?void 0:i.metadata.tree_count_mismatch)&&m.jsxs(m.Fragment,{children:["  (actual: ",i.metadata.num_local_trees,")"]})]}):null,u&&m.jsx("div",{className:"inline-block ml-2 animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})]})]}),A.isActive&&m.jsx("div",{className:"text-xs mt-3",style:{color:n.text},children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("span",{children:["Temporal Range: ",A.range[0].toFixed(Wn.TIME_PRECISION)," - ",A.range[1].toFixed(Wn.TIME_PRECISION)," ","(",oM(A.range[1]-A.range[0],A.maxTime-A.minTime),"% of time range)  Hold Shift + drag to maintain window size"]}),u&&m.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-t-transparent",style:{borderColor:n.accentPrimary}})]})})]})}),m.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[A.isActive&&!I.isFilterSectionCollapsed&&m.jsx("div",{className:"flex-shrink-0 border-r px-3 py-4 flex items-center justify-center",style:{backgroundColor:n.background,borderRightColor:n.border},children:m.jsx(ane,{min:A.minTime,max:A.maxTime,step:(A.maxTime-A.minTime)/Wn.TEMPORAL_STEP_DIVISOR,value:A.range,onChange:F=>R($=>({...$,range:F})),formatValue:F=>F.toFixed(Wn.TIME_PRECISION),height:Wn.TEMPORAL_SLIDER_HEIGHT})}),m.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[m.jsx(_ne,{data:oe,onNodeClick:W,onNodeRightClick:q,selectedNode:T,temporalRange:A.isActive?A.range:null,showTemporalPlanes:A.isActive&&A.mode==="planes",temporalFilterMode:A.isActive?A.mode:null,temporalSpacing:I.temporalSpacing,temporalSpacingMode:I.temporalSpacingMode,spatialSpacing:I.spatialSpacing,geographicShape:N.currentShape,geographicMode:N.mode,temporalGridOpacity:I.temporalGridOpacity,geographicShapeOpacity:I.geographicShapeOpacity,maxNodeRadius:I.maxNodeRadius,onViewStateChange:de,viewState:M}),m.jsx(sne,{currentViewState:M,bounds:D(oe),onViewStateChange:Z}),m.jsx(rne,{temporalSpacing:I.temporalSpacing,onTemporalSpacingChange:F=>O($=>({...$,temporalSpacing:F})),temporalSpacingMode:I.temporalSpacingMode,onTemporalSpacingModeChange:F=>O($=>({...$,temporalSpacingMode:F})),spatialSpacing:I.spatialSpacing,onSpatialSpacingChange:F=>O($=>({...$,spatialSpacing:F})),temporalGridOpacity:I.temporalGridOpacity,onTemporalGridOpacityChange:F=>O($=>({...$,temporalGridOpacity:F})),geographicShapeOpacity:I.geographicShapeOpacity,onGeographicShapeOpacityChange:F=>O($=>({...$,geographicShapeOpacity:F})),maxNodeRadius:I.maxNodeRadius,onMaxNodeRadiusChange:F=>O($=>({...$,maxNodeRadius:F})),geographicMode:N.mode,onGeographicModeChange:F=>B($=>({...$,mode:F})),customShapeFile:N.customShapeFile,onCustomShapeFileChange:F=>B($=>({...$,customShapeFile:F})),isLoadingGeographic:N.isLoading,currentShape:N.currentShape,showCrsWarning:N.showCrsWarning,crsDetection:i==null?void 0:i.metadata.coordinate_system_detection,onDismissCrsWarning:()=>B(F=>({...F,showCrsWarning:!1}))}),m.jsx(ine,{originalNodeCount:ie==null?void 0:ie.originalNodes,originalEdgeCount:ie==null?void 0:ie.originalEdges,subargNodeCount:ie==null?void 0:ie.subArgNodes,subargEdgeCount:ie==null?void 0:ie.subArgEdges,displayedNodeCount:ie==null?void 0:ie.displayedNodes,displayedEdgeCount:ie==null?void 0:ie.displayedEdges,crsDetection:i!=null&&i.metadata.coordinate_system_detection?{crs:i.metadata.coordinate_system_detection.likely_crs,confidence:i.metadata.coordinate_system_detection.confidence,landPercentage:i.metadata.coordinate_system_detection.land_percentage,description:i.metadata.coordinate_system_detection.reasoning}:void 0,isTemporalSliderVisible:A.isActive})]})]})]})};function yne(){const{filename:t}=LM(),e=mc(),{maxSamples:n,treeSequence:r,setTreeSequence:i}=Hs(),{colors:s,setCurrentVisualizationType:o}=Ht(),l=U.useRef(null),[u,d]=U.useState(!1);if(U.useEffect(()=>{o("spatial-3d")},[o]),!t)return m.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("h1",{className:"text-3xl font-bold mb-4",children:"No filename provided"}),m.jsx("button",{className:"font-bold py-2 px-6 rounded-lg mt-4 transition-colors",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:()=>e("/result"),children:"Back to Results"})]});const h=decodeURIComponent(t),g=y=>{Ee.user.action("switch-tree-sequence-spatial",{treeSequence:y},"SpatialArg3DVisualizationPage"),i(y),d(!1),e(`/visualize-spatial/${encodeURIComponent(y.filename)}`)},_=async()=>{if(l.current)try{const y=`${h.replace(/\.(trees|tsz)$/,"")}_3d_spatial_arg.png`,T={text:"ARGscape",subtext:h,position:"bottom-center",color:s.accentPrimary,backgroundColor:s.background+"CC"},w=l.current.querySelector("[data-3d-visualization]");if(w!=null&&w.getExportData){const S=w.getExportData(),A=l.current.querySelector('[data-deck="true"]'),R=A?{current:A}:null;try{await qq(S,R,{filename:y,padding:50,maxWidth:8192,maxHeight:8192,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("High-resolution 3D spatial ARG image exported successfully");return}catch(E){console.warn("High-quality export failed, falling back to canvas capture:",E)}}const x=l.current.querySelector("canvas");if(!x)throw new Error("No canvas found for export");await Vq(x,{filename:y,padding:50,maxWidth:4096,maxHeight:4096,backgroundColor:s.exportBackground,scale:2,watermark:T}),console.log("3D spatial ARG image captured from canvas")}catch(y){console.error("Error downloading 3D spatial ARG image:",y)}};return m.jsxs("div",{className:"h-screen flex flex-col overflow-hidden font-sans",style:{backgroundColor:s.background,color:s.text},children:[m.jsx("header",{className:"border-b p-4 shadow-md flex-shrink-0",style:{backgroundColor:s.background,borderBottomColor:s.border},children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-4",children:[m.jsxs("button",{className:"absolute left-0 inline-flex items-center gap-2 transition-colors duration-200",style:{color:s.accentPrimary},onMouseEnter:y=>{y.currentTarget.style.opacity="0.8"},onMouseLeave:y=>{y.currentTarget.style.opacity="1"},onClick:()=>e("/result"),children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Results"]}),m.jsx(_c,{size:"medium"})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[m.jsx("span",{className:"text-lg flex-shrink-0",style:{color:`${s.text}B3`},children:"3D Spatial ARG"}),m.jsx("div",{className:"text-base font-mono break-all min-w-0",style:{color:s.accentPrimary},children:h})]}),m.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[m.jsx(EO,{}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap border",style:{backgroundColor:s.containerBackground,color:s.text,borderColor:`${s.accentPrimary}33`},onMouseEnter:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}66`,y.currentTarget.style.backgroundColor=`${s.containerBackground}CC`},onMouseLeave:y=>{y.currentTarget.style.borderColor=`${s.accentPrimary}33`,y.currentTarget.style.backgroundColor=s.containerBackground},onClick:()=>d(!u),children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Switch Tree Sequence"]})}),m.jsx("button",{className:"font-medium px-4 py-2 rounded-lg text-sm transition-colors whitespace-nowrap",style:{backgroundColor:s.containerBackground,color:s.text},onMouseEnter:y=>{y.currentTarget.style.backgroundColor=s.accentPrimary,y.currentTarget.style.color=s.background},onMouseLeave:y=>{y.currentTarget.style.backgroundColor=s.containerBackground,y.currentTarget.style.color=s.text},onClick:_,title:"Download 3D visualization as PNG",children:"Download Image"}),r&&m.jsx(X0,{filename:r.filename})]})]})]})}),m.jsx(Y0,{isOpen:u,onClose:()=>d(!1),onSelect:g}),m.jsx("main",{className:"flex-1 overflow-hidden",children:m.jsx("div",{ref:l,className:"w-full h-full",children:U.useMemo(()=>m.jsx(vne,{filename:h,max_samples:n}),[h,n])})})]})}function bne(){return m.jsx("div",{className:"absolute top-0 left-0 w-full h-1/2 overflow-hidden pointer-events-none",children:m.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 1200 400",children:[m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.3s_both]",children:[m.jsx("line",{x1:"200",y1:"30",x2:"200",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.4s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"140",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.5s_both]"}),m.jsx("line",{x1:"200",y1:"90",x2:"260",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.55s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.6s_both]"}),m.jsx("line",{x1:"140",y1:"150",x2:"180",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.65s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"220",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.7s_both]"}),m.jsx("line",{x1:"260",y1:"150",x2:"300",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_0.75s_both]"}),m.jsx("circle",{cx:"200",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_0.8s_both]"}),m.jsx("circle",{cx:"140",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.85s_both]"}),m.jsx("circle",{cx:"260",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_0.9s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_0.7s_both]",children:[m.jsx("line",{x1:"600",y1:"30",x2:"600",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_0.8s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"540",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.9s_both]"}),m.jsx("line",{x1:"600",y1:"90",x2:"660",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_0.95s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"500",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1s_both]"}),m.jsx("line",{x1:"540",y1:"150",x2:"580",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.05s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"620",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.1s_both]"}),m.jsx("line",{x1:"660",y1:"150",x2:"700",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.15s_both]"}),m.jsx("circle",{cx:"600",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.2s_both]"}),m.jsx("circle",{cx:"540",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.25s_both]"}),m.jsx("circle",{cx:"660",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.3s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.8s_ease-out_1.1s_both]",children:[m.jsx("line",{x1:"1000",y1:"30",x2:"1000",y2:"90",stroke:"rgba(134, 239, 172, 0.15)",strokeWidth:"4",className:"animate-[drawLine_0.7s_ease-out_1.2s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"940",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.3s_both]"}),m.jsx("line",{x1:"1000",y1:"90",x2:"1060",y2:"150",stroke:"rgba(134, 239, 172, 0.13)",strokeWidth:"3.5",className:"animate-[drawLine_0.6s_ease-out_1.35s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"900",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.4s_both]"}),m.jsx("line",{x1:"940",y1:"150",x2:"980",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.45s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1020",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.5s_both]"}),m.jsx("line",{x1:"1060",y1:"150",x2:"1100",y2:"210",stroke:"rgba(134, 239, 172, 0.11)",strokeWidth:"3",className:"animate-[drawLine_0.5s_ease-out_1.55s_both]"}),m.jsx("circle",{cx:"1000",cy:"90",r:"5",fill:"rgba(134, 239, 172, 0.35)",className:"animate-[fadeInScale_0.3s_ease-out_1.6s_both]"}),m.jsx("circle",{cx:"940",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.65s_both]"}),m.jsx("circle",{cx:"1060",cy:"150",r:"4",fill:"rgba(134, 239, 172, 0.3)",className:"animate-[fadeInScale_0.3s_ease-out_1.7s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_1.5s_both]",children:[m.jsx("circle",{cx:"100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.7s_both]"}),m.jsx("circle",{cx:"180",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.75s_both]"}),m.jsx("circle",{cx:"220",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.8s_both]"}),m.jsx("circle",{cx:"300",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.85s_both]"}),m.jsx("circle",{cx:"500",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.9s_both]"}),m.jsx("circle",{cx:"580",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_1.95s_both]"}),m.jsx("circle",{cx:"620",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2s_both]"}),m.jsx("circle",{cx:"700",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.05s_both]"}),m.jsx("circle",{cx:"900",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.1s_both]"}),m.jsx("circle",{cx:"980",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.15s_both]"}),m.jsx("circle",{cx:"1020",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.2s_both]"}),m.jsx("circle",{cx:"1100",cy:"210",r:"5",fill:"rgba(134, 239, 172, 0.8)",className:"animate-[fadeIn_0.4s_ease-out_2.25s_both]"})]}),m.jsxs("g",{className:"animate-[fadeIn_0.6s_ease-out_2.3s_both]",children:[m.jsx("line",{x1:"400",y1:"20",x2:"400",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"}),m.jsx("line",{x1:"800",y1:"20",x2:"800",y2:"230",stroke:"rgba(255, 182, 193, 0.4)",strokeWidth:"3",strokeDasharray:"10,10"})]})]})})}function cM({onComplete:t,isTransitioning:e=!1}){const[n,r]=U.useState(!1),[i,s]=U.useState(!1);return U.useEffect(()=>{if(e){r(!0),s(!0);return}r(!0);const o=setTimeout(()=>{s(!0)},2300),l=setTimeout(()=>{t()},2600);return()=>{clearTimeout(o),clearTimeout(l)}},[t,e]),m.jsxs(m.Fragment,{children:[m.jsx("style",{children:`
        @keyframes drawLine {
          from { stroke-dasharray: 1000; stroke-dashoffset: 1000; }
          to { stroke-dasharray: 1000; stroke-dashoffset: 0; }
        }
        @keyframes drawPath {
          from { stroke-dasharray: 200; stroke-dashoffset: 200; }
          to { stroke-dasharray: 200; stroke-dashoffset: 0; }
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeInScale {
          from { opacity: 0; transform: scale(0); }
          to { opacity: 1; transform: scale(1); }
        }
      `}),m.jsxs("div",{className:`
        ${e?"absolute":"fixed"} inset-0 bg-sp-very-dark-blue flex items-center justify-center z-50
        transition-all duration-2000 ease-in-out
        ${i?"opacity-0":"opacity-100"}
      `,children:[m.jsx("div",{className:`
          transition-opacity duration-1000 ease-in-out
          ${e?"opacity-0":"opacity-100"}
        `,children:m.jsx(bne,{})}),m.jsxs("div",{className:`
          transform transition-all duration-2000 ease-in-out relative z-10
          ${e?"scale-50 -translate-y-32":n?"scale-100 opacity-100":"scale-75 opacity-0"}
        `,children:[m.jsxs("h1",{className:"text-[6rem] md:text-[8rem] lg:text-[10rem] font-extrabold tracking-tight text-center select-none",style:{letterSpacing:"-0.04em"},children:[m.jsx("span",{className:"text-white",children:"ARG"}),m.jsx("span",{className:"text-sp-pale-green",children:"scape"})]}),m.jsx("div",{className:`
            mt-8 text-center transition-opacity duration-1000 ease-in-out
            ${e?"opacity-0":"opacity-100"}
          `,children:m.jsx("div",{className:"text-sp-pale-green text-2xl md:text-3xl lg:text-4xl font-bold",children:"Visualizing Ancestral Recombination Graphs"})})]})]})]})}function uM({onOptionSelect:t,isTransitioning:e=!1}){const[n,r]=U.useState([]),[i,s]=U.useState(!0),[o,l]=U.useState(!e);U.useEffect(()=>{(async()=>{try{Ee.data.processing("fetch-available-tree-sequences","LandingPage");const g=(await mt.getUploadedFiles()).data;r(g.uploaded_tree_sequences||[])}catch(h){Ee.error("Failed to fetch available tree sequences",{component:"LandingPage",error:h instanceof Error?h:new Error(String(h))}),r([])}finally{s(!1)}})()},[]),U.useEffect(()=>{if(e){const d=setTimeout(()=>{l(!0)},100);return()=>clearTimeout(d)}else l(!0)},[e]);const u=d=>{d==="load"&&n.length===0||t(d)};return m.jsxs("div",{className:`
      text-sp-white min-h-screen flex flex-col items-center justify-center px-4 font-sans
      ${e?"absolute inset-0 z-40":""}
    `,children:[m.jsxs("div",{className:`
        text-center mb-12 transition-all duration-2000 ease-in-out
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx(_c,{size:"large",className:"mb-4"}),m.jsx("p",{className:"text-lg md:text-xl text-sp-white/70 mb-6",children:"Visualizing Ancestral Recombination Graphs"}),m.jsxs("a",{href:"/docs",className:"inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200 text-sm font-medium",children:[" View Documentation",m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),m.jsxs("div",{className:`
        w-full max-w-2xl space-y-4 transition-all duration-2000 ease-in-out delay-500
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:[m.jsx("button",{onClick:()=>u("upload"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Upload a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Upload your own .trees or .tsz file to visualize"})]})]})}),m.jsx("button",{onClick:()=>u("simulate"),className:"w-full bg-sp-dark-blue hover:bg-sp-dark-blue/80 border border-sp-pale-green/20 hover:border-sp-pale-green/40 rounded-xl p-6 text-left transition-all duration-200 group",children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-sp-pale-green/10 rounded-lg flex items-center justify-center group-hover:bg-sp-pale-green/20 transition-colors duration-200",children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Simulate a tree sequence"}),m.jsx("p",{className:"text-sp-white/60 text-sm",children:"Generate new data using msprime simulation"})]})]})}),m.jsx("button",{onClick:()=>u("load"),disabled:n.length===0,className:`w-full border rounded-xl p-6 text-left transition-all duration-200 group ${n.length===0?"bg-sp-dark-blue/50 border-sp-pale-green/10 cursor-not-allowed opacity-50":"bg-sp-dark-blue hover:bg-sp-dark-blue/80 border-sp-pale-green/20 hover:border-sp-pale-green/40"}`,children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors duration-200 ${n.length===0?"bg-sp-pale-green/5":"bg-sp-pale-green/10 group-hover:bg-sp-pale-green/20"}`,children:m.jsx("svg",{className:"w-6 h-6 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-xl font-semibold text-sp-white mb-1",children:"Load a tree sequence"}),m.jsxs("p",{className:"text-sp-white/60 text-sm",children:["Choose from existing uploaded sequences",i?m.jsx("span",{className:"ml-2",children:m.jsx("span",{className:"animate-pulse",children:"Loading..."})}):m.jsxs("span",{className:`ml-2 font-medium ${n.length===0?"text-red-400":"text-sp-pale-green"}`,children:["(",n.length," available)"]})]})]})]})})]}),m.jsx("div",{className:`
        bg-amber-900/15 border border-amber-700/25 rounded-lg p-3 mt-12 max-w-2xl mx-auto
        transition-all duration-2000 ease-in-out delay-1000
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `,children:m.jsxs("p",{className:"text-amber-200 text-xs md:text-sm text-center leading-relaxed",children:[m.jsx("span",{className:"font-semibold",children:" Beta Notice:"})," Tree sequences are stored on a secure server for up to 24 hours. This is a beta application and data may be wiped during updates. Please download your results and respect our limited resources."]})}),m.jsx("div",{className:`
        mt-8 text-center
        transition-all duration-2000 ease-in-out delay-1200
        ${e&&!o?"opacity-0 translate-y-8":"opacity-100 translate-y-0"}
      `})]})}var kx={exports:{}},Mx,fM;function xne(){if(fM)return Mx;fM=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Mx=t,Mx}var Ix,dM;function wne(){if(dM)return Ix;dM=1;var t=xne();function e(){}function n(){}return n.resetWarningCache=e,Ix=function(){function r(o,l,u,d,h,g){if(g!==t){var _=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw _.name="Invariant Violation",_}}r.isRequired=r;function i(){return r}var s={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:e};return s.PropTypes=s,s},Ix}var hM;function Tne(){return hM||(hM=1,kx.exports=wne()()),kx.exports}var Sne=Tne();const ht=$0(Sne);function Js(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function l(h){try{d(r.next(h))}catch(g){o(g)}}function u(h){try{d(r.throw(h))}catch(g){o(g)}}function d(h){h.done?s(h.value):i(h.value).then(l,u)}d((r=r.apply(t,e||[])).next())})}const Ene=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function yo(t,e,n){const r=Ane(t),{webkitRelativePath:i}=t,s=typeof e=="string"?e:typeof i=="string"&&i.length>0?i:`./${t.name}`;return typeof r.path!="string"&&pM(r,"path",s),pM(r,"relativePath",s),r}function Ane(t){const{name:e}=t;if(e&&e.lastIndexOf(".")!==-1&&!t.type){const r=e.split(".").pop().toLowerCase(),i=Ene.get(r);i&&Object.defineProperty(t,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return t}function pM(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!0})}const Rne=[".DS_Store","Thumbs.db"];function Cne(t){return Js(this,void 0,void 0,function*(){return ud(t)&&Nne(t.dataTransfer)?One(t.dataTransfer,t.type):kne(t)?Mne(t):Array.isArray(t)&&t.every(e=>"getFile"in e&&typeof e.getFile=="function")?Ine(t):[]})}function Nne(t){return ud(t)}function kne(t){return ud(t)&&ud(t.target)}function ud(t){return typeof t=="object"&&t!==null}function Mne(t){return U0(t.target.files).map(e=>yo(e))}function Ine(t){return Js(this,void 0,void 0,function*(){return(yield Promise.all(t.map(n=>n.getFile()))).map(n=>yo(n))})}function One(t,e){return Js(this,void 0,void 0,function*(){if(t.items){const n=U0(t.items).filter(i=>i.kind==="file");if(e!=="drop")return n;const r=yield Promise.all(n.map(Pne));return gM(nj(r))}return gM(U0(t.files).map(n=>yo(n)))})}function gM(t){return t.filter(e=>Rne.indexOf(e.name)===-1)}function U0(t){if(t===null)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];e.push(r)}return e}function Pne(t){if(typeof t.webkitGetAsEntry!="function")return mM(t);const e=t.webkitGetAsEntry();return e&&e.isDirectory?rj(e):mM(t,e)}function nj(t){return t.reduce((e,n)=>[...e,...Array.isArray(n)?nj(n):[n]],[])}function mM(t,e){return Js(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof t.getAsFileSystemHandle=="function"){const s=yield t.getAsFileSystemHandle();if(s===null)throw new Error(`${t} is not a File`);if(s!==void 0){const o=yield s.getFile();return o.handle=s,yo(o)}}const r=t.getAsFile();if(!r)throw new Error(`${t} is not a File`);return yo(r,(n=e==null?void 0:e.fullPath)!==null&&n!==void 0?n:void 0)})}function Dne(t){return Js(this,void 0,void 0,function*(){return t.isDirectory?rj(t):jne(t)})}function rj(t){const e=t.createReader();return new Promise((n,r)=>{const i=[];function s(){e.readEntries(o=>Js(this,void 0,void 0,function*(){if(o.length){const l=Promise.all(o.map(Dne));i.push(l),s()}else try{const l=yield Promise.all(i);n(l)}catch(l){r(l)}}),o=>{r(o)})}s()})}function jne(t){return Js(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.file(r=>{const i=yo(r,t.fullPath);e(i)},r=>{n(r)})})})}var ff={},_M;function Lne(){return _M||(_M=1,ff.__esModule=!0,ff.default=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(",");if(n.length===0)return!0;var r=t.name||"",i=(t.type||"").toLowerCase(),s=i.replace(/\/.*$/,"");return n.some(function(o){var l=o.trim().toLowerCase();return l.charAt(0)==="."?r.toLowerCase().endsWith(l):l.endsWith("/*")?s===l.replace(/\/.*$/,""):i===l})}return!0}),ff}var Bne=Lne();const Ox=$0(Bne);function vM(t){return zne(t)||Fne(t)||sj(t)||Une()}function Une(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fne(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function zne(t){if(Array.isArray(t))return F0(t)}function yM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function bM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yM(Object(n),!0).forEach(function(r){ij(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ij(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pc(t,e){return $ne(t)||Vne(t,e)||sj(t,e)||qne()}function qne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sj(t,e){if(t){if(typeof t=="string")return F0(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F0(t,e)}}function F0(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Vne(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function $ne(t){if(Array.isArray(t))return t}var Hne=typeof Ox=="function"?Ox:Ox.default,Wne="file-invalid-type",Xne="file-too-large",Yne="file-too-small",Gne="too-many-files",Kne=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=e.split(","),r=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:Wne,message:"File type must be ".concat(r)}},xM=function(e){return{code:Xne,message:"File is larger than ".concat(e," ").concat(e===1?"byte":"bytes")}},wM=function(e){return{code:Yne,message:"File is smaller than ".concat(e," ").concat(e===1?"byte":"bytes")}},Zne={code:Gne,message:"Too many files"};function aj(t,e){var n=t.type==="application/x-moz-file"||Hne(t,e);return[n,n?null:Kne(e)]}function oj(t,e,n){if(Rs(t.size))if(Rs(e)&&Rs(n)){if(t.size>n)return[!1,xM(n)];if(t.size<e)return[!1,wM(e)]}else{if(Rs(e)&&t.size<e)return[!1,wM(e)];if(Rs(n)&&t.size>n)return[!1,xM(n)]}return[!0,null]}function Rs(t){return t!=null}function Qne(t){var e=t.files,n=t.accept,r=t.minSize,i=t.maxSize,s=t.multiple,o=t.maxFiles,l=t.validator;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(u){var d=aj(u,n),h=pc(d,1),g=h[0],_=oj(u,r,i),y=pc(_,1),T=y[0],w=l?l(u):null;return g&&T&&!w})}function fd(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function df(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function TM(t){t.preventDefault()}function Jne(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function ere(t){return t.indexOf("Edge/")!==-1}function tre(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Jne(t)||ere(t)}function Fr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return e.some(function(l){return!fd(r)&&l&&l.apply(void 0,[r].concat(s)),fd(r)})}}function nre(){return"showOpenFilePicker"in window}function rre(t){if(Rs(t)){var e=Object.entries(t).filter(function(n){var r=pc(n,2),i=r[0],s=r[1],o=!0;return lj(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),o=!1),(!Array.isArray(s)||!s.every(cj))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),o=!1),o}).reduce(function(n,r){var i=pc(r,2),s=i[0],o=i[1];return bM(bM({},n),{},ij({},s,o))},{});return[{description:"Files",accept:e}]}return t}function ire(t){if(Rs(t))return Object.entries(t).reduce(function(e,n){var r=pc(n,2),i=r[0],s=r[1];return[].concat(vM(e),[i],vM(s))},[]).filter(function(e){return lj(e)||cj(e)}).join(",")}function sre(t){return t instanceof DOMException&&(t.name==="AbortError"||t.code===t.ABORT_ERR)}function are(t){return t instanceof DOMException&&(t.name==="SecurityError"||t.code===t.SECURITY_ERR)}function lj(t){return t==="audio/*"||t==="video/*"||t==="image/*"||t==="text/*"||t==="application/*"||/\w+\/[-+.\w]+/g.test(t)}function cj(t){return/^.*\.[\w]+$/.test(t)}var ore=["children"],lre=["open"],cre=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],ure=["refKey","onChange","onClick"];function fre(t){return pre(t)||hre(t)||uj(t)||dre()}function dre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function pre(t){if(Array.isArray(t))return z0(t)}function Px(t,e){return _re(t)||mre(t,e)||uj(t,e)||gre()}function gre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uj(t,e){if(t){if(typeof t=="string")return z0(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z0(t,e)}}function z0(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mre(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,l;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(u){s=!0,l=u}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw l}}return r}}function _re(t){if(Array.isArray(t))return t}function SM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Rt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SM(Object(n),!0).forEach(function(r){q0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SM(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function q0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dd(t,e){if(t==null)return{};var n=vre(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function vre(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var s2=U.forwardRef(function(t,e){var n=t.children,r=dd(t,ore),i=Af(r),s=i.open,o=dd(i,lre);return U.useImperativeHandle(e,function(){return{open:s}},[s]),nc.createElement(U.Fragment,null,n(Rt(Rt({},o),{},{open:s})))});s2.displayName="Dropzone";var fj={disabled:!1,getFilesFromEvent:Cne,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};s2.defaultProps=fj;s2.propTypes={children:ht.func,accept:ht.objectOf(ht.arrayOf(ht.string)),multiple:ht.bool,preventDropOnDocument:ht.bool,noClick:ht.bool,noKeyboard:ht.bool,noDrag:ht.bool,noDragEventsBubbling:ht.bool,minSize:ht.number,maxSize:ht.number,maxFiles:ht.number,disabled:ht.bool,getFilesFromEvent:ht.func,onFileDialogCancel:ht.func,onFileDialogOpen:ht.func,useFsAccessApi:ht.bool,autoFocus:ht.bool,onDragEnter:ht.func,onDragLeave:ht.func,onDragOver:ht.func,onDrop:ht.func,onDropAccepted:ht.func,onDropRejected:ht.func,onError:ht.func,validator:ht.func};var V0={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Af(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rt(Rt({},fj),t),n=e.accept,r=e.disabled,i=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,l=e.multiple,u=e.maxFiles,d=e.onDragEnter,h=e.onDragLeave,g=e.onDragOver,_=e.onDrop,y=e.onDropAccepted,T=e.onDropRejected,w=e.onFileDialogCancel,x=e.onFileDialogOpen,S=e.useFsAccessApi,A=e.autoFocus,R=e.preventDropOnDocument,E=e.noClick,C=e.noKeyboard,I=e.noDrag,O=e.noDragEventsBubbling,M=e.onError,P=e.validator,N=U.useMemo(function(){return ire(n)},[n]),B=U.useMemo(function(){return rre(n)},[n]),z=U.useMemo(function(){return typeof x=="function"?x:EM},[x]),Q=U.useMemo(function(){return typeof w=="function"?w:EM},[w]),H=U.useRef(null),W=U.useRef(null),q=U.useReducer(yre,V0),ee=Px(q,2),de=ee[0],Z=ee[1],D=de.isFocused,G=de.isFileDialogActive,oe=U.useRef(typeof window<"u"&&window.isSecureContext&&S&&nre()),ie=function(){!oe.current&&G&&setTimeout(function(){if(W.current){var Re=W.current.files;Re.length||(Z({type:"closeDialog"}),Q())}},300)};U.useEffect(function(){return window.addEventListener("focus",ie,!1),function(){window.removeEventListener("focus",ie,!1)}},[W,G,Q,oe]);var F=U.useRef([]),$=function(Re){H.current&&H.current.contains(Re.target)||(Re.preventDefault(),F.current=[])};U.useEffect(function(){return R&&(document.addEventListener("dragover",TM,!1),document.addEventListener("drop",$,!1)),function(){R&&(document.removeEventListener("dragover",TM),document.removeEventListener("drop",$))}},[H,R]),U.useEffect(function(){return!r&&A&&H.current&&H.current.focus(),function(){}},[H,A,r]);var Y=U.useCallback(function(xe){M?M(xe):console.error(xe)},[M]),ue=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Cn(xe),F.current=[].concat(fre(F.current),[xe.target]),df(xe)&&Promise.resolve(i(xe)).then(function(Re){if(!(fd(xe)&&!O)){var et=Re.length,Ve=et>0&&Qne({files:Re,accept:N,minSize:o,maxSize:s,multiple:l,maxFiles:u,validator:P}),Ke=et>0&&!Ve;Z({isDragAccept:Ve,isDragReject:Ke,isDragActive:!0,type:"setDraggedFiles"}),d&&d(xe)}}).catch(function(Re){return Y(Re)})},[i,d,Y,O,N,o,s,l,u,P]),ye=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Cn(xe);var Re=df(xe);if(Re&&xe.dataTransfer)try{xe.dataTransfer.dropEffect="copy"}catch{}return Re&&g&&g(xe),!1},[g,O]),Se=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Cn(xe);var Re=F.current.filter(function(Ve){return H.current&&H.current.contains(Ve)}),et=Re.indexOf(xe.target);et!==-1&&Re.splice(et,1),F.current=Re,!(Re.length>0)&&(Z({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),df(xe)&&h&&h(xe))},[H,h,O]),ke=U.useCallback(function(xe,Re){var et=[],Ve=[];xe.forEach(function(Ke){var vt=aj(Ke,N),dn=Px(vt,2),Yr=dn[0],_r=dn[1],Lt=oj(Ke,o,s),Bt=Px(Lt,2),Nn=Bt[0],vr=Bt[1],Zn=P?P(Ke):null;if(Yr&&Nn&&!Zn)et.push(Ke);else{var we=[_r,vr];Zn&&(we=we.concat(Zn)),Ve.push({file:Ke,errors:we.filter(function(st){return st})})}}),(!l&&et.length>1||l&&u>=1&&et.length>u)&&(et.forEach(function(Ke){Ve.push({file:Ke,errors:[Zne]})}),et.splice(0)),Z({acceptedFiles:et,fileRejections:Ve,isDragReject:Ve.length>0,type:"setFiles"}),_&&_(et,Ve,Re),Ve.length>0&&T&&T(Ve,Re),et.length>0&&y&&y(et,Re)},[Z,l,N,o,s,u,_,y,T,P]),Ue=U.useCallback(function(xe){xe.preventDefault(),xe.persist(),Cn(xe),F.current=[],df(xe)&&Promise.resolve(i(xe)).then(function(Re){fd(xe)&&!O||ke(Re,xe)}).catch(function(Re){return Y(Re)}),Z({type:"reset"})},[i,ke,Y,O]),yt=U.useCallback(function(){if(oe.current){Z({type:"openDialog"}),z();var xe={multiple:l,types:B};window.showOpenFilePicker(xe).then(function(Re){return i(Re)}).then(function(Re){ke(Re,null),Z({type:"closeDialog"})}).catch(function(Re){sre(Re)?(Q(Re),Z({type:"closeDialog"})):are(Re)?(oe.current=!1,W.current?(W.current.value=null,W.current.click()):Y(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):Y(Re)});return}W.current&&(Z({type:"openDialog"}),z(),W.current.value=null,W.current.click())},[Z,z,Q,S,ke,Y,B,l]),We=U.useCallback(function(xe){!H.current||!H.current.isEqualNode(xe.target)||(xe.key===" "||xe.key==="Enter"||xe.keyCode===32||xe.keyCode===13)&&(xe.preventDefault(),yt())},[H,yt]),Fe=U.useCallback(function(){Z({type:"focus"})},[]),De=U.useCallback(function(){Z({type:"blur"})},[]),Jt=U.useCallback(function(){E||(tre()?setTimeout(yt,0):yt())},[E,yt]),Ne=function(Re){return r?null:Re},xn=function(Re){return C?null:Ne(Re)},Xt=function(Re){return I?null:Ne(Re)},Cn=function(Re){O&&Re.stopPropagation()},jt=U.useMemo(function(){return function(){var xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=xe.refKey,et=Re===void 0?"ref":Re,Ve=xe.role,Ke=xe.onKeyDown,vt=xe.onFocus,dn=xe.onBlur,Yr=xe.onClick,_r=xe.onDragEnter,Lt=xe.onDragOver,Bt=xe.onDragLeave,Nn=xe.onDrop,vr=dd(xe,cre);return Rt(Rt(q0({onKeyDown:xn(Fr(Ke,We)),onFocus:xn(Fr(vt,Fe)),onBlur:xn(Fr(dn,De)),onClick:Ne(Fr(Yr,Jt)),onDragEnter:Xt(Fr(_r,ue)),onDragOver:Xt(Fr(Lt,ye)),onDragLeave:Xt(Fr(Bt,Se)),onDrop:Xt(Fr(Nn,Ue)),role:typeof Ve=="string"&&Ve!==""?Ve:"presentation"},et,H),!r&&!C?{tabIndex:0}:{}),vr)}},[H,We,Fe,De,Jt,ue,ye,Se,Ue,C,I,r]),fn=U.useCallback(function(xe){xe.stopPropagation()},[]),Ye=U.useMemo(function(){return function(){var xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Re=xe.refKey,et=Re===void 0?"ref":Re,Ve=xe.onChange,Ke=xe.onClick,vt=dd(xe,ure),dn=q0({accept:N,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Ne(Fr(Ve,Ue)),onClick:Ne(Fr(Ke,fn)),tabIndex:-1},et,W);return Rt(Rt({},dn),vt)}},[W,n,l,Ue,r]);return Rt(Rt({},de),{},{isFocused:D&&!r,getRootProps:jt,getInputProps:Ye,rootRef:H,inputRef:W,open:Ne(yt)})}function yre(t,e){switch(e.type){case"focus":return Rt(Rt({},t),{},{isFocused:!0});case"blur":return Rt(Rt({},t),{},{isFocused:!1});case"openDialog":return Rt(Rt({},V0),{},{isFileDialogActive:!0});case"closeDialog":return Rt(Rt({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":return Rt(Rt({},t),{},{isDragActive:e.isDragActive,isDragAccept:e.isDragAccept,isDragReject:e.isDragReject});case"setFiles":return Rt(Rt({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections,isDragReject:e.isDragReject});case"reset":return Rt({},V0);default:return t}}function EM(){}function bre({onUploadComplete:t,setLoading:e}){const[n,r]=U.useState(null),[i,s]=U.useState("none"),[o,l]=U.useState({sampleLocations:null,nodeLocations:null}),[u,d]=U.useState({}),h=U.useCallback(O=>{O.length>0&&(r(O[0]),s("none"),l({sampleLocations:null,nodeLocations:null}),d({}))},[]),{getRootProps:g,getInputProps:_,isDragActive:y}=Af({onDrop:h,multiple:!1,accept:Eg.ACCEPTED_FORMATS}),T=U.useCallback(O=>{O.length>0&&l(M=>({...M,sampleLocations:O[0]}))},[]),w=Af({onDrop:T,multiple:!1,accept:Eg.CSV_FORMATS}),x=U.useCallback(O=>{O.length>0&&l(M=>({...M,nodeLocations:O[0]}))},[]),S=Af({onDrop:x,multiple:!1,accept:Eg.CSV_FORMATS}),A=async()=>{if(n){e(!0);try{Ee.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone");const O=await mt.uploadTreeSequence(n);Ee.info("File upload completed successfully",{component:"Dropzone",data:{filename:n.name,result:O}}),t&&t(O.data)}catch(O){Ee.error("File upload failed",{component:"Dropzone",error:O instanceof Error?O:new Error(String(O)),data:{filename:n.name}}),alert(`Upload failed: ${O instanceof Error?O.message:"Unknown error"}`)}finally{e(!1)}}},R=()=>{s("add-locations")},E=async(O,M)=>{try{const P=await mt.uploadLocationCSV(O,M);return d(N=>({...N,[M]:P.data.filename})),P.data.filename}catch(P){throw Ee.error("CSV upload failed",{component:"Dropzone",error:P instanceof Error?P:new Error(String(P)),data:{filename:O.name,csvType:M}}),P}},C=async()=>{if(!(!n||!o.sampleLocations||!o.nodeLocations)){e(!0);try{Ee.user.action("upload-start",{filename:n.name,size:n.size},"Dropzone"),await mt.uploadTreeSequence(n);let O=u.sample_locations,M=u.node_locations;if(!O&&o.sampleLocations&&(O=await E(o.sampleLocations,"sample_locations")),!M&&o.nodeLocations&&(M=await E(o.nodeLocations,"node_locations")),!O||!M)throw new Error("Failed to upload CSV files");console.log("Starting tree sequence update...");const P=await mt.updateTreeSequenceLocations({tree_sequence_filename:n.name,sample_locations_filename:O,node_locations_filename:M});console.log("Tree sequence update completed:",P),Ee.info("Tree sequence updated with custom locations",{component:"Dropzone",data:{originalFilename:n.name,newFilename:P.data.new_filename}}),t&&(console.log("Calling onUploadComplete with:",P.data),t(P.data))}catch(O){Ee.error("Tree sequence update failed",{component:"Dropzone",error:O instanceof Error?O:new Error(String(O)),data:{filename:n.name}}),alert(`Update failed: ${O instanceof Error?O.message:"Unknown error"}`)}finally{e(!1)}}},I=n&&o.sampleLocations&&o.nodeLocations;return m.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[m.jsxs("div",{...g(),className:`w-full h-48 border-2 border-dashed rounded-xl flex items-center justify-center text-xl transition-colors cursor-pointer select-none
          ${y?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{..._()}),n?m.jsx("span",{className:"truncate max-w-full px-2",children:n.name}):y?m.jsx("span",{children:"Drop the file here"}):m.jsxs("span",{className:"text-center",children:["Drag and drop to select a file",m.jsx("br",{}),m.jsx("span",{className:"text-base text-sp-pale-green",children:"or click to browse"}),m.jsx("br",{}),m.jsx("span",{className:"text-sm text-sp-very-pale-green mt-1",children:"Supported formats: .trees, .tsz"})]})]}),n&&i==="none"&&m.jsxs("div",{className:"w-full flex flex-col gap-3",children:[m.jsxs("button",{type:"button",onClick:A,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Load as-is"]}),m.jsxs("button",{type:"button",onClick:R,className:"bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center justify-center gap-2",children:[m.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Add locations"]})]}),i==="add-locations"&&m.jsxs("div",{className:"w-full space-y-4",children:[m.jsx("div",{className:"text-center text-sp-white/70 text-sm mb-4",children:"Upload CSV files with node locations (required columns: node_id, x, y, z)"}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Sample Locations"}),m.jsxs("div",{...w.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${w.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...w.getInputProps()}),o.sampleLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.sampleLocations.name}):w.isDragActive?m.jsx("span",{children:"Drop CSV here"}):m.jsx("span",{children:"Click or drag CSV with sample locations"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sp-white font-semibold text-sm",children:"Node Locations"}),m.jsxs("div",{...S.getRootProps(),className:`w-full h-24 border-2 border-dashed rounded-lg flex items-center justify-center text-sm transition-colors cursor-pointer select-none
                ${S.isDragActive?"border-sp-pale-green bg-sp-dark-blue text-sp-white":"border-sp-dark-blue bg-sp-very-dark-blue text-sp-very-pale-green"}`,tabIndex:0,children:[m.jsx("input",{...S.getInputProps()}),o.nodeLocations?m.jsx("span",{className:"truncate max-w-full px-2 text-sp-pale-green",children:o.nodeLocations.name}):S.isDragActive?m.jsx("span",{children:"Drop CSV here"}):m.jsx("span",{children:"Click or drag CSV with node locations"})]})]}),m.jsxs("button",{type:"button",onClick:C,disabled:!I,className:`w-full font-bold py-3 px-6 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 ${I?"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue transform hover:scale-105 hover:shadow-lg":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Update Tree Sequence"]}),m.jsxs("button",{type:"button",onClick:()=>{s("none"),l({sampleLocations:null,nodeLocations:null}),d({})},className:"w-full bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white border border-sp-pale-green/20 font-bold py-2.5 px-4 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})]})]})}const qt={num_samples:25,sequence_length:1e6,max_time:100,model:"dtwf",filename_prefix:"simulated",crs:"EPSG:4326",ploidy:2,mutation_rate:1e-8,recombination_rate:1e-8},dj=t=>{switch(t){case"dtwf":return"dtwf";case"hudson":return"hud";case"smc":return"smc";case"smc_prime":return"smcp";default:return t.slice(0,4)}},hj=t=>{switch(t){case"EPSG:4326":return"4326";case"unit_grid":return"ug";case"EPSG:3857":return"3857";default:return t.replace(/[^a-zA-Z0-9]/g,"").slice(0,4)}},xre=t=>{const e=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),r=String(t.getFullYear()).slice(-2),i=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return`${e}${n}${r}${i}${s}`},Dx=(t,e,n=!1)=>{const r=dj(t.model||"dtwf"),i=hj(t.crs||"EPSG:4326"),o=`r${e??Math.floor(Math.random()*1e3)}`;let l=`s${t.num_samples}_m${r}_t${t.sequence_length}_p${t.ploidy}_c${i}_${o}`;if(n){const d=xre(new Date);l+=`_d${d}`}return l},Xa=t=>t.toExponential(8),Ya=t=>t>=1e6?`${(t/1e6).toFixed(1)}Mb`:t>=1e3?`${(t/1e3).toFixed(1)}kb`:`${t}bp`,AM=t=>{const e=t.toLowerCase().trim();return e.endsWith("mb")?Math.round(parseFloat(e.slice(0,-2))*1e6):e.endsWith("kb")?Math.round(parseFloat(e.slice(0,-2))*1e3):e.endsWith("bp")?Math.round(parseFloat(e.slice(0,-2))):Math.round(parseFloat(e))};function wre({onSimulationComplete:t,setLoading:e}){var C,I,O,M,P;const[n,r]=U.useState({...qt,filename_prefix:Dx(qt)}),[i,s]=U.useState(!1),[o,l]=U.useState(!0),[u,d]=U.useState(!1),[h,g]=U.useState({num_samples:qt.num_samples.toString(),sequence_length:Ya(qt.sequence_length),max_time:qt.max_time.toString(),ploidy:((C=qt.ploidy)==null?void 0:C.toString())||"2",random_seed:((I=qt.random_seed)==null?void 0:I.toString())||"42",population_size:((O=qt.population_size)==null?void 0:O.toString())||"",mutation_rate:((M=qt.mutation_rate)==null?void 0:M.toString())||Xa(qt.mutation_rate),recombination_rate:((P=qt.recombination_rate)==null?void 0:P.toString())||Xa(qt.recombination_rate)}),_=(N,B)=>{r(z=>({...z,[N]:B}))},y=(N,B)=>{g(z=>({...z,[N]:B}))},T=(N,B,z,Q,H)=>{if(y(N,B),B==="")return;const W=parseInt(B);isNaN(W)||_(N,W)},w=(N,B,z,Q,H)=>{const W=parseInt(B);let q=H;isNaN(W)||(q=Math.max(z,Math.min(Q,W))),_(N,q),y(N,q.toString())},x=N=>{N.key==="Enter"&&(N.preventDefault(),E())},S=N=>{g(B=>({...B,sequence_length:N}));try{const B=AM(N);!isNaN(B)&&B>0&&r(z=>({...z,sequence_length:B}))}catch{}},A=N=>{try{const B=AM(N);isNaN(B)||B<=0?(g(z=>({...z,sequence_length:Ya(qt.sequence_length)})),r(z=>({...z,sequence_length:qt.sequence_length}))):(g(z=>({...z,sequence_length:Ya(B)})),r(z=>({...z,sequence_length:B})))}catch{g(z=>({...z,sequence_length:Ya(qt.sequence_length)})),r(z=>({...z,sequence_length:qt.sequence_length}))}},R=()=>o?Dx(n,i?n.random_seed:void 0):n.filename_prefix,E=async()=>{e(!0);try{Ee.user.action("simulate-start",{params:n},"TreeSequenceSimulator");const N={...n,population_size:n.num_samples*(n.ploidy??2),random_seed:i?n.random_seed:void 0,filename_prefix:o?Dx(n,i?n.random_seed:void 0,!0):n.filename_prefix},B=await mt.simulateTreeSequence(N),Q={...(await mt.getTreeSequenceMetadata(B.data.filename)).data,num_mutations:B.data.num_mutations,crs:B.data.crs};Ee.info("Tree sequence simulation completed successfully",{component:"TreeSequenceSimulator",data:{params:N,result:B,metadata:Q}}),t&&t(Q)}catch(N){Ee.error("Tree sequence simulation failed",{component:"TreeSequenceSimulator",error:N instanceof Error?N:new Error(String(N)),data:{params:n}}),alert(`Simulation failed: ${N instanceof Error?N.message:"Unknown error"}`)}finally{e(!1)}};return m.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[m.jsxs("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl p-5",children:[m.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[m.jsx("div",{className:"w-8 h-8 bg-sp-pale-green/10 rounded-lg flex items-center justify-center",children:m.jsx("svg",{className:"w-4 h-4 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-sp-white",children:"Simulation Parameters"}),m.jsx("p",{className:"text-sp-white/60 text-xs",children:"Configure the tree sequence simulation settings"})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sample individuals"}),m.jsx("input",{type:"number",min:"2",max:"500",value:h.num_samples,onChange:N=>T("num_samples",N.target.value),onBlur:N=>w("num_samples",N.target.value,2,500,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Range: 2-500"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Ploidy"}),m.jsx("input",{type:"number",min:"1",max:"10",value:h.ploidy,onChange:N=>T("ploidy",N.target.value),onBlur:N=>w("ploidy",N.target.value,1,10,2),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-10 (2=diploid)"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Sequence Length (e.g., 1Mb, 100kb, 1000bp)"}),m.jsx("input",{type:"text",value:h.sequence_length,onChange:N=>S(N.target.value),onBlur:N=>A(N.target.value),className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:Ya(n.sequence_length)})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Max generations"}),m.jsx("input",{type:"number",min:"1",max:"1000",value:h.max_time,onChange:N=>T("max_time",N.target.value),onBlur:N=>w("max_time",N.target.value,1,1e3,1),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm"}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"1-1000"})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Model"}),m.jsxs("select",{value:n.model||"dtwf",onChange:N=>_("model",N.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"dtwf",children:"Discrete Wright-Fisher"}),m.jsx("option",{value:"hudson",children:"Hudson"}),m.jsx("option",{value:"smc",children:"SMC"}),m.jsx("option",{value:"smc_prime",children:"SMC'"})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1",children:"Coordinate System"}),m.jsxs("select",{value:n.crs||"EPSG:4326",onChange:N=>_("crs",N.target.value),onKeyDown:x,className:"px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",children:[m.jsx("option",{value:"EPSG:4326",children:"WGS84 Geographic"}),m.jsx("option",{value:"unit_grid",children:"Unit Grid (0-1)"}),m.jsx("option",{value:"EPSG:3857",children:"Web Mercator"})]}),m.jsx("span",{className:"text-xs text-sp-white/60 mt-0.5",children:"Spatial coordinate system"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[m.jsxs("div",{className:"bg-sp-pale-green/10 border border-sp-pale-green/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Population Summary"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{children:"Total haplotypes:"}),m.jsx("span",{className:"font-bold text-sp-pale-green",children:n.num_samples*(n.ploidy??2)})]}),m.jsxs("div",{className:"text-xs text-sp-white/60",children:[n.num_samples," individuals  ",n.ploidy??2," ploidy"]})]})]}),m.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),m.jsx("h4",{className:"font-medium text-sp-white text-sm",children:"Output Filename"})]}),m.jsxs("div",{className:"text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sp-pale-green break-all text-xs",children:R()}),m.jsx("div",{className:"text-xs text-sp-white/60",children:o?m.jsx("button",{onClick:()=>d(!0),className:"underline hover:text-sp-pale-green transition-colors cursor-pointer",children:"Auto-generated from parameters"}):"Custom filename"})]})]})]}),m.jsx("div",{className:"bg-sp-dark-blue border border-sp-pale-green/20 rounded-xl overflow-hidden",children:m.jsxs("details",{className:"group",children:[m.jsx("summary",{className:"px-5 py-3 cursor-pointer hover:bg-sp-pale-green/5 transition-colors duration-200 border-b border-sp-pale-green/10 group-open:border-b-0 list-none",children:m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-6 h-6 bg-sp-pale-green/10 rounded flex items-center justify-center",children:m.jsx("svg",{className:"w-3 h-3 text-sp-pale-green transition-transform duration-200 group-open:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),m.jsx("span",{className:"font-medium text-sp-white text-sm",children:"Advanced Options"})]})})}),m.jsxs("div",{className:"px-5 py-3 space-y-3 bg-sp-very-dark-blue/50",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useAutoFilename",checked:o,onChange:N=>l(N.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useAutoFilename",className:"text-sm font-medium text-sp-white",children:"Auto-generate filename"})]}),!o&&m.jsxs("div",{className:"ml-6",children:[m.jsx("label",{className:"text-sm font-medium text-sp-white mb-1 block",children:"Custom filename prefix"}),m.jsx("input",{type:"text",value:n.filename_prefix,onChange:N=>_("filename_prefix",N.target.value),onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"simulated"})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",id:"useCustomSeed",checked:i,onChange:N=>s(N.target.checked),onKeyDown:x,className:"mr-2 w-4 h-4 text-sp-pale-green bg-sp-very-dark-blue border-sp-pale-green/30 rounded focus:ring-sp-pale-green focus:ring-2"}),m.jsx("label",{htmlFor:"useCustomSeed",className:"text-sm font-medium text-sp-white",children:"Use custom random seed"})]}),i?m.jsx("div",{className:"ml-6",children:m.jsx("input",{type:"number",value:h.random_seed,onChange:N=>{const B=N.target.value;if(y("random_seed",B),B!==""){const z=parseInt(B);isNaN(z)||_("random_seed",z)}},onBlur:N=>{const B=parseInt(N.target.value),z=isNaN(B)?42:B;_("random_seed",z),y("random_seed",z.toString())},onKeyDown:x,className:"w-full px-3 py-2 bg-sp-very-dark-blue border border-sp-pale-green/20 rounded-lg text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green focus:border-transparent transition-all duration-200 text-sm",placeholder:"42"})}):m.jsx("div",{className:"ml-6 text-xs text-sp-white/60",children:"Random seed will be generated automatically"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{htmlFor:"population-size",className:"block text-sm font-medium text-sp-white/80",children:"Population Size (optional)"}),m.jsx("input",{type:"number",id:"population-size",value:h.population_size,onChange:N=>T("population_size",N.target.value),onBlur:N=>w("population_size",N.target.value,1,1e6,1e3),className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green",placeholder:"1000"}),m.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1000 (effective population size)"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{htmlFor:"mutation-rate",className:"block text-sm font-medium text-sp-white/80",children:"Mutation Rate (per base pair per generation)"}),m.jsx("input",{type:"text",id:"mutation-rate",value:h.mutation_rate,onChange:N=>{g(z=>({...z,mutation_rate:N.target.value}));const B=parseFloat(N.target.value);!isNaN(B)&&B>0&&r(z=>({...z,mutation_rate:B}))},onBlur:N=>{const B=parseFloat(N.target.value);isNaN(B)||B<=0?(g(z=>({...z,mutation_rate:Xa(qt.mutation_rate)})),r(z=>({...z,mutation_rate:qt.mutation_rate}))):(g(z=>({...z,mutation_rate:Xa(B)})),r(z=>({...z,mutation_rate:B})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),m.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{htmlFor:"recombination-rate",className:"block text-sm font-medium text-sp-white/80",children:"Recombination Rate (per base pair per generation)"}),m.jsx("input",{type:"text",id:"recombination-rate",value:h.recombination_rate,onChange:N=>{g(z=>({...z,recombination_rate:N.target.value}));const B=parseFloat(N.target.value);!isNaN(B)&&B>0&&r(z=>({...z,recombination_rate:B}))},onBlur:N=>{const B=parseFloat(N.target.value);isNaN(B)||B<=0?(g(z=>({...z,recombination_rate:Xa(qt.recombination_rate)})),r(z=>({...z,recombination_rate:qt.recombination_rate}))):(g(z=>({...z,recombination_rate:Xa(B)})),r(z=>({...z,recombination_rate:B})))},className:"w-full bg-sp-dark-blue border border-sp-pale-green/20 rounded px-3 py-2 text-sp-white focus:outline-none focus:ring-2 focus:ring-sp-pale-green font-mono",placeholder:"1e-8"}),m.jsx("p",{className:"text-xs text-sp-white/60",children:"Default: 1e-8 (0.00000001)"})]})]})]})}),m.jsx("div",{className:"flex justify-center pt-2",children:m.jsxs("button",{type:"button",onClick:E,className:"bg-sp-pale-green hover:bg-sp-very-pale-green text-sp-very-dark-blue font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 hover:shadow-lg flex items-center gap-2",children:[m.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Simulate Tree Sequence"]})}),u&&m.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"bg-sp-very-dark-blue border border-sp-pale-green/30 rounded-xl p-5 max-w-lg w-full shadow-2xl",children:[m.jsxs("div",{className:"flex justify-between items-start mb-3",children:[m.jsx("h3",{className:"text-lg font-bold text-sp-white",children:"Filename Format Explained"}),m.jsx("button",{onClick:()=>d(!1),className:"text-sp-white/60 hover:text-sp-white transition-colors text-2xl leading-none",children:""})]}),m.jsxs("div",{className:"space-y-3 text-sm text-sp-white",children:[m.jsx("div",{className:"font-mono text-sm text-sp-pale-green bg-sp-dark-blue rounded-lg p-3 break-all",children:R()}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["s",n.num_samples]})," - Sample individuals (2-500)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["m",dj(n.model||"dtwf")]})," - Model (dtwf, hud, smc, smcp)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["t",n.sequence_length]})," - Sequence Length (",Ya(n.sequence_length),")"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["g",n.max_time]})," - Max generations (1-1000)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["p",n.ploidy??2]})," - Ploidy (1-4)"]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-bold text-sp-pale-green",children:["c",hj(n.crs||"EPSG:4326")]})," - Coordinate system"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"r###"})," - Random seed (0-999)"]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-bold text-sp-pale-green",children:"d##########"})," - Timestamp (MMDDYYHHMM)"]})]})]}),m.jsx("button",{onClick:()=>d(!1),className:"w-full mt-4 bg-sp-dark-blue hover:bg-sp-pale-green hover:text-sp-very-dark-blue text-sp-white font-medium py-2.5 rounded-lg transition-colors duration-200",children:"Close"})]})})]})}function Tre({selectedOption:t,onBack:e}){const n=mc(),[r,i]=U.useState(!1),[s,o]=U.useState(0),{setTreeSequence:l}=Hs();U.useEffect(()=>{if(r){const T=setInterval(()=>{o(w=>(w+1)%4)},DB.LOADING_DOTS_INTERVAL);return()=>clearInterval(T)}else o(0)},[r]);const u=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},d=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},h=T=>{l(T),n("/result",{state:{fromIntermediate:t}})},g=()=>{switch(t){case"upload":return"Upload a Tree Sequence";case"simulate":return"Simulate a Tree Sequence";case"load":return"Load a Tree Sequence";default:return""}},_=()=>{switch(t){case"upload":return"Upload your own .trees file to visualize";case"simulate":return"Generate new data using msprime simulation";case"load":return"Choose from existing uploaded sequences";default:return""}},y=()=>{if(r)return m.jsxs("div",{className:"flex flex-col items-center text-xl text-sp-white space-y-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sp-pale-green"}),m.jsxs("span",{children:["Processing",Array(s+1).join(".")]})]});switch(t){case"upload":return m.jsx(bre,{onUploadComplete:u,setLoading:i});case"simulate":return m.jsx(wre,{onSimulationComplete:h,setLoading:i});case"load":return m.jsx(GM,{onSelect:d});default:return null}};return m.jsxs("div",{className:"bg-sp-very-dark-blue text-sp-white min-h-screen px-4 pt-8 pb-20 font-sans",children:[m.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[m.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[m.jsxs("button",{onClick:e,className:"absolute left-0 inline-flex items-center gap-2 text-sp-pale-green hover:text-sp-pale-green/80 transition-colors duration-200",children:[m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to options"]}),m.jsx(_c,{size:"medium"})]}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:g()}),m.jsx("p",{className:"text-sp-white/70 text-lg",children:_()})]})]}),m.jsx("div",{className:"max-w-7xl mx-auto",children:m.jsx("div",{className:"bg-sp-very-dark-blue rounded-2xl shadow-xl border border-sp-dark-blue overflow-hidden",children:m.jsx("div",{className:"p-8 min-h-[600px] flex items-start justify-center",children:y()})})})]})}const pj="argscape_first_visit",Sre=()=>{try{return!sessionStorage.getItem(pj)}catch{return!0}},Ere=()=>{try{sessionStorage.setItem(pj,"true")}catch{console.warn("Session storage not available")}};function hf({children:t}){return m.jsxs(m.Fragment,{children:[m.jsx("main",{children:t}),m.jsx(Kq,{})]})}function Are(){const t=gc(),[e,n]=U.useState("intro"),[r,i]=U.useState(null),[s,o]=U.useState(!1),[l,u]=U.useState([]),[d,h]=U.useState(!1),[g,_]=U.useState(!1),[y,T]=U.useState(!1);U.useEffect(()=>{d||(async()=>{var R;try{Ee.data.processing("fetch-available-tree-sequences","Home");const C=(await mt.getUploadedFiles()).data;u(C.uploaded_tree_sequences||[]),Ee.info(`Found ${((R=C.uploaded_tree_sequences)==null?void 0:R.length)||0} available tree sequences for animation logic`,{component:"Home"})}catch(E){Ee.error("Failed to fetch available tree sequences",{component:"Home",error:E instanceof Error?E:new Error(String(E))}),u([])}finally{h(!0)}})()},[d]),U.useEffect(()=>{var O,M,P,N;if(!d)return;const A=(O=t.state)==null?void 0:O.fromInternal,R=(M=t.state)==null?void 0:M.fromResult,E=(P=t.state)==null?void 0:P.selectedOption,C=(N=t.state)==null?void 0:N.forceIntro;R&&E?(i(E),n("intermediate"),o(!1)):(l.length>0||R&&E||A?!1:(C||Sre(),!0))?(o(!0),n("intro"),i(null),Ere()):(n("landing"),o(!1),i(null))},[t.state,d,l.length]);const w=()=>{T(!0),n("transitioning"),setTimeout(()=>{n("landing"),o(!1),T(!1)},2e3)},x=A=>{i(A),n("intermediate")},S=()=>{i(null),n("landing")};return m.jsxs("div",{className:"bg-sp-very-dark-blue min-h-screen",children:[s&&e==="intro"&&m.jsx(cM,{onComplete:w}),e==="transitioning"&&m.jsxs("div",{className:"relative min-h-screen",children:[m.jsx(cM,{onComplete:w,isTransitioning:!0}),m.jsx(uM,{onOptionSelect:x,isTransitioning:!0})]}),e==="landing"&&m.jsx(uM,{onOptionSelect:x}),e==="intermediate"&&r&&m.jsx(Tre,{selectedOption:r,onBack:S})]})}function Rre(){return m.jsx(UB,{children:m.jsx(jB,{children:m.jsx(OB,{children:m.jsxs(kB,{children:[m.jsx(Ol,{path:"/",element:m.jsx(hf,{children:m.jsx(Are,{})})}),m.jsx(Ol,{path:"/result",element:m.jsx(hf,{children:m.jsx($B,{})})}),m.jsx(Ol,{path:"/visualize/:filename",element:m.jsx(hf,{children:m.jsx(Gq,{})})}),m.jsx(Ol,{path:"/visualize-spatial/:filename",element:m.jsx(hf,{children:m.jsx(yne,{})})})]})})})})}LL.createRoot(document.getElementById("root")).render(m.jsx(Rre,{}));
